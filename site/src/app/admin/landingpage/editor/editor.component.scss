/* landingpage/editor/editor.component.scss */

/* CSS chung cho Editor Canvas */
.editor-canvas {
  border: 1px solid #eee;
  padding: 15px;
  min-height: 500px; // Giữ chiều cao tối thiểu
  background-color: #f9f9f9;
  position: relative; // Cần cho kéo thả
}

.block-list {
  min-height: 470px; // Đảm bảo drop list có chiều cao
}

/* Container bao quanh mỗi block ở cấp cao nhất */
.block-container {
  position: relative;
  border: 1px dashed transparent;
  margin-bottom: 10px;
  background-color: #fff;
  transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.2s ease-in-out;
  padding: 5px;
  padding-left: 30px; /* Chừa chỗ cho drag handle */
  cursor: pointer; // Đổi con trỏ khi di chuột qua

  &:hover:not(.selected):not(.cdk-drag-preview):not(.cdk-drag-placeholder) { // Thêm điều kiện loại trừ
    border-color: #adb5bd; // Highlight nhẹ khi hover (nếu chưa được chọn)
    background-color: #f8f9fa;
  }

  // Hiện actions và drag handle khi hover container (nếu chưa kéo)
  &:hover:not(.cdk-drag-dragging) {
    .block-actions {
      display: inline-flex;
      opacity: 1;
    }
    .drag-handle {
      visibility: visible;
      opacity: 1;
    }
  }

  // Style cho khối được chọn
  &.selected {
    border-color: #007bff;
    border-style: solid;
    border-width: 2px;
    box-shadow: 0 0 8px rgba(0, 123, 255, 0.5);
    // Khi được chọn, vẫn hiện drag handle và actions
    .block-actions {
        display: inline-flex;
        opacity: 1;
    }
    .drag-handle {
        visibility: visible;
        opacity: 1;
    }
  }
}


/* Nút actions (sửa, xóa) */
.block-actions {
  position: absolute;
  top: -12px;
  right: -5px;
  background-color: #007bff;
  border-radius: 3px;
  padding: 3px 5px;
  display: none; /* Ẩn mặc định */
  opacity: 0; /* Ẩn mặc định */
  transition: opacity 0.2s ease-in-out;
  z-index: 10;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  gap: 5px; /* Khoảng cách giữa các nút */
  cursor: default; // Không thay đổi con trỏ trên nút

  button {
    background: none;
    border: none;
    color: white;
    cursor: pointer; // Con trỏ trên từng nút
    font-size: 14px;
    padding: 0 3px;
    line-height: 1;

    &:hover {
      opacity: 0.8;
    }
    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  }
}

/* Block không xác định */
.unknown-block {
  padding: 15px;
  background-color: #ffdddd;
  border: 1px solid #ffaaaa;
  color: #d8000c;
}

/* Palette để thêm block */
.block-palette {
  margin-top: 20px;
  padding: 15px;
  border: 1px solid #ccc;
  background-color: #f0f0f0;
  border-radius: 4px;
  flex-shrink: 0; // Không co lại khi nằm trong flex container

  h4 {
    margin-top: 0;
    margin-bottom: 10px;
  }

  button {
    margin-right: 10px;
    padding: 8px 15px;
    cursor: pointer;
    border: 1px solid #ccc;
    background-color: #fff;
    border-radius: 4px;

    &:hover {
      background-color: #e9e9e9;
    }
  }
}


/* === CSS/SCSS cho kéo thả === */

/* Tay cầm kéo thả */
.drag-handle {
  position: absolute;
  top: 50%;
  left: 5px;
  transform: translateY(-50%);
  cursor: move;
  color: #aaa;
  font-size: 18px;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  visibility: hidden; /* Ẩn mặc định */
  opacity: 0;
  transition: opacity 0.2s ease-in-out, color 0.2s ease-in-out;
  z-index: 9;

  &:hover {
    color: #333;
  }
}

/* Styling khi đang kéo (Phần tử xem trước) */
.cdk-drag-preview {
  box-sizing: border-box;
  border-radius: 4px;
  box-shadow: 0 5px 5px -3px rgba(0, 0, 0, 0.2),
              0 8px 10px 1px rgba(0, 0, 0, 0.14),
              0 3px 14px 2px rgba(0, 0, 0, 0.12);
  background: #fff;
  padding: 5px;
  padding-left: 30px; /* Giống block-container */
  cursor: grabbing; // Thay đổi con trỏ khi kéo
}

/* Placeholder nơi item sẽ được thả vào */
// Sử dụng class cụ thể thay vì chỉ cdk-drag-placeholder để tránh xung đột
.block-placeholder {
  opacity: 0.5;
  background: #e0e0e0;
  border: 2px dashed #aaa;
  min-height: 60px; // Tăng chiều cao một chút
  transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);
  margin-bottom: 10px; // Giống block-container
  padding: 5px;
  padding-left: 30px; /* Giống block-container */
  box-sizing: border-box;
  display: block;
}

/* Hiệu ứng khi đang kéo */
.cdk-drag-animating {
  transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);
}

/* Giữ khoảng cách giữa các item khác khi kéo */
.cdk-drop-list-dragging .block-container:not(.cdk-drag-placeholder) {
  transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);
}

/* Style cho layout chính - Sử dụng CSS Grid */
.editor-layout {
  display: grid;
  // Định nghĩa 3 cột: Navigator (tự động co giãn, min 200px), Canvas (chiếm phần lớn), Inspector (rộng cố định)
  grid-template-columns: minmax(200px, 1fr) 4fr minmax(300px, 1.5fr);
  gap: 15px; // Khoảng cách giữa các panel
  height: calc(100vh - 80px); // Ví dụ: Chiều cao của viewport trừ đi header/footer (điều chỉnh nếu cần)
  overflow: hidden; // Ngăn layout chính bị cuộn
}

/* Wrapper cho Navigator Panel */
.navigator-panel-wrapper {
  border-right: 1px solid #ccc;
  background-color: #f8f9fa; // Nền giống inspector
  display: flex; // Để căn chỉnh h3 và content
  flex-direction: column;
  height: 100%; // Chiếm hết chiều cao của grid cell
  overflow: hidden; // Ngăn wrapper cuộn

  h3 {
     margin: 0;
     padding: 15px 10px;
     font-size: 1.1em;
     color: #333;
     border-bottom: 1px solid #eee;
     background-color: #f1f3f5; // Nền cho header
  }

  // Container cho nội dung của navigator để nó cuộn độc lập
  app-navigator-panel {
     flex-grow: 1; // Chiếm hết không gian còn lại
     overflow-y: auto; // Cho phép cuộn nội dung navigator
     display: block; // Cần thiết để overflow hoạt động
  }
}


/* Wrapper cho Canvas */
.editor-canvas-wrapper {
  display: flex;
  flex-direction: column;
  height: 100%; // Chiếm hết chiều cao của grid cell
  overflow: hidden; // Ngăn wrapper cuộn

  h2 {
     margin: 0 0 10px 0;
     padding: 10px 0 10px 0;
     font-size: 1.2em;
     color: #333;
     text-align: center;
     border-bottom: 1px solid #eee;
     flex-shrink: 0; // Không co lại
  }

  // Container cho canvas để nó cuộn độc lập
  .editor-canvas {
      flex-grow: 1; // Chiếm hết không gian còn lại
      overflow-y: auto; // Cho phép cuộn nội dung canvas
      border: 1px solid #eee;
      padding: 15px;
      background-color: #f9f9f9;
      position: relative;
  }
  // Palette nằm bên dưới canvas
  .block-palette {
      margin-top: 10px; // Khoảng cách với canvas
      flex-shrink: 0; // Không co lại
  }
}

/* Inspector Panel */
.inspector-panel {
  border-left: 1px solid #ccc;
  background-color: #f8f9fa;
  display: flex; // Để căn chỉnh h3 và content
  flex-direction: column;
  height: 100%; // Chiếm hết chiều cao của grid cell
  overflow: hidden; // Ngăn wrapper cuộn


  h3 {
      margin: 0;
      padding: 15px; // Đồng bộ padding
      font-size: 1.1em;
      color: #333;
      border-bottom: 1px solid #eee;
      background-color: #f1f3f5; // Nền cho header
      flex-shrink: 0; // Không co lại
  }

  // Container cho nội dung inspector để cuộn độc lập
  // Áp dụng cho div bao quanh .inspector-content và #noBlockSelected
  > div {
      flex-grow: 1;
      overflow-y: auto; // Cuộn nội dung bên trong
      padding: 15px; // Padding cho nội dung
  }

  .inspector-content {
      // Bỏ padding ở đây vì đã có ở div cha
      padding: 0;

      .info-section {
         background-color: #e9ecef;
         padding: 10px;
         border-radius: 4px;
         margin-bottom: 15px;
         p { font-size: 0.85em; margin: 2px 0; word-break: break-all; }
         strong { color: #555; }
      }

     .edit-section {
         margin-bottom: 20px;
         padding-bottom: 15px;
         border-bottom: 1px solid #e0e0e0;

         &:last-of-type {
             border-bottom: none;
         }

         h4 {
             margin-top: 0; // Bỏ margin-top mặc định
             margin-bottom: 15px; // Tăng khoảng cách dưới
             font-size: 1em;
             color: #495057;
             border-bottom: 1px solid #dee2e6;
             padding-bottom: 8px; // Tăng padding dưới
         }
         h5 { // Style cho tiêu đề nhóm nhỏ (Flex Container, Spacing, Appearance)
             margin-top: 15px;
             margin-bottom: 10px; // Tăng khoảng cách dưới
             font-size: 0.95em;
             color: #343a40;
             font-weight: 600;
         }

         label {
           display: block;
           margin-top: 10px; // Khoảng cách trên label
           margin-bottom: 4px; // Khoảng cách dưới label
           font-size: 0.9em;
           color: #6c757d;
           font-weight: 500;
           &:first-child { margin-top: 0; } // Bỏ margin-top cho label đầu tiên trong section/group
         }

         input[type="text"],
         input[type="color"], // Style chung cho input
         textarea,
         select {
           width: 100%;
           padding: 6px 10px;
           margin-bottom: 10px; // Khoảng cách dưới input
           border: 1px solid #ced4da;
           border-radius: 4px;
           font-size: 0.9em;
           box-sizing: border-box;

           &:focus {
             border-color: #80bdff;
             outline: 0;
             box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
           }
         }

         input[type="color"] {
             padding: 2px 4px;
             height: 35px;
         }

         textarea {
           min-height: 60px;
           resize: vertical;
         }

         // Nhóm các tùy chọn Flexbox
         .flex-options {
             background-color: #eef2f7;
             padding: 15px; // Tăng padding
             border-radius: 4px;
             margin-top: 10px; // Tăng khoảng cách trên
             border: 1px solid #d6ddeb;
             h5 { margin-top: 0; } // Bỏ margin top cho tiêu đề đầu tiên trong nhóm
             label:first-of-type { margin-top: 0; } // Bỏ margin top cho label đầu tiên
         }

          // Phần chỉnh sửa style cột con
          .column-style-editor {
              margin-top: 15px;
              padding: 15px; // Tăng padding
              background-color: #fdfdfe;
              border: 1px solid #e9ecef;
              border-radius: 4px;

              h5 {
                  margin-top: 0;
                  font-size: 0.9em;
                  color: #495057;
                  border-bottom: 1px dashed #eee;
                  padding-bottom: 8px; // Tăng padding
                  margin-bottom: 12px; // Tăng khoảng cách dưới
              }
              label { font-size: 0.85em; }
              input, select { font-size: 0.85em; padding: 4px 8px; }
              input[type="color"] { height: 30px; }
               label:first-of-type { margin-top: 0; } // Bỏ margin top cho label đầu tiên
          }

           // Thông tin cột con trong phần Data
           .column-info-in-data {
               margin-top: 10px;
               padding: 8px 10px; // Tăng padding
               font-size: 0.85em;
               background-color: #f8f9fa;
               border: 1px solid #e9ecef;
               border-radius: 3px; // Thêm bo góc
               p { margin: 2px 0; strong { color: #555; } }
           }

          // Mục xem JSON raw
          details {
              margin-top: 20px; // Tăng khoảng cách trên
              summary {
                  cursor: pointer;
                  font-size: 0.8em;
                  color: #6c757d;
                  padding: 5px 0; // Thêm padding
                  &:hover { color: #007bff; }
              }
              pre {
                  margin-top: 8px; // Tăng khoảng cách
                  max-height: 120px;
                  background-color: #e9ecef; // Đồng bộ nền
                  padding: 8px; // Đồng bộ padding
                  border-radius: 4px;
                  font-size: 0.8em;
                  border: 1px solid #ddd;
              }
          }
          hr { // Style cho đường kẻ ngang (nếu dùng)
             border: 0;
             border-top: 1px solid #dee2e6; // Màu đậm hơn
             margin: 20px 0; // Tăng khoảng cách
          }

     } // Đóng .edit-section
  } // Đóng .inspector-content
} // Đóng .inspector-panel