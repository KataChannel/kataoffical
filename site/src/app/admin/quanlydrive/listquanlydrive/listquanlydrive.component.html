<mat-drawer-container class="w-full h-full" autosize>
  <mat-drawer #drawer class="flex flex-col lg:!w-1/2 !w-full h-full" [position]="'end'" mode="over">
    <router-outlet></router-outlet>
  </mat-drawer>
  <div class="flex flex-col space-y-2 h-screen-16 w-full p-2">
    @if (!isSearch) {
      <div class="border p-1 cursor-pointer w-full relative flex lg:flex-row lg:space-y-2 space-y-0 flex-col space-x-2 justify-between items-center bg-white rounded-lg">
        <div class="w-full flex flex-row space-x-2 items-center">
          <mat-form-field appearance="outline" subscriptSizing="dynamic">
            <mat-label>Drive ID</mat-label>
            <input matInput [(ngModel)]="driveId"  [ngModelOptions]="{ standalone: true }" placeholder="Vui lòng Nhập Drive ID" />
          </mat-form-field>
          <button (click)="LoadDulieu(driveId)" matTooltip="Load Dữ Liệu" color="primary" mat-icon-button>
            <mat-icon>sync</mat-icon>
          </button>
          <button (click)="LoadSyncDrive(driveId)" matTooltip="Load Cập Nhật Drive" color="primary" mat-icon-button>
            <mat-icon>cloud_sync</mat-icon>
          </button>
          <button matTooltip="Tìm Kiếm" color="primary" (click)="isSearch = !isSearch" mat-icon-button>
            <mat-icon>search</mat-icon>
          </button>
          <!-- <button matTooltip="Thêm mới" (click)="create()" color="primary" mat-icon-button>
          <mat-icon>add_circle</mat-icon>
        </button>
        <button matTooltip="Tải file excel Mẫu" (click)="ExportExcel(Listquanlydrive(),'Quanlydrive')" color="primary" mat-icon-button>
          <mat-icon>file_download</mat-icon>
        </button>
        <button matTooltip="Tải lên file excel" (click)="uploadfile.click()" color="primary" mat-icon-button>
          <mat-icon>file_upload</mat-icon>
        </button>
        <input class="hidden" (change)="ImporExcel($event)" type="file" #uploadfile>
        <button matTooltip="Tải dữ liệu từ drive" (click)="LoadDrive()" color="primary" mat-icon-button>
          <mat-icon>cloud_download</mat-icon>
        </button>
        <span class="lg:flex hidden whitespace-nowrap p-2 rounded-lg bg-slate-200">
          {{this.Listquanlydrive().length}} Sản Phẩm
        </span>
        <button *ngIf="EditList.length > 0" matTooltip="Xoá" (click)="openDeleteDialog(DeleteDialog)" color="warn" mat-icon-button>
          <mat-icon>delete</mat-icon>
        </button> -->
      </div>
    </div>
  }
  @if (isSearch) {
    <div class="border p-1 py-2 w-full flex flex-row space-x-2 items-center">
      <mat-form-field appearance="outline" class="lg:w-auto w-full" subscriptSizing="dynamic">
        <mat-label>Tìm Kiếm</mat-label>
        <input matInput (keyup)="applyFilter($event)"  placeholder="Vui lòng Tìm Kiếm" />
      </mat-form-field>
      <button mat-icon-button color="warn" (click)="isSearch=!isSearch"><mat-icon>cancel</mat-icon></button>
    </div>
  }
  <div class="cursor-pointer border rounded-lg w-full h-full overflow-auto p-4">

    <table class="table-auto w-full border-collapse border border-gray-300">
      <thead>
        <tr class="bg-gray-100">
          <th class="border border-gray-300 px-4 py-2 text-left">#</th>
          <th class="border border-gray-300 px-4 py-2 text-left">Tên</th>
          <th class="border border-gray-300 px-4 py-2 text-left">Email</th>
          <th class="border border-gray-300 px-4 py-2 text-left">Quyền</th>
          <th class="border border-gray-300 px-4 py-2 text-left">User ID Drive</th>
          <th class="border border-gray-300 px-4 py-2 text-left">Google ID</th>
          <th class="border border-gray-300 px-4 py-2 text-left">Thao Tác</th>

        </tr>
      </thead>
      <tbody>
        @for (item of ListTimkiem; track item; let i = $index) {
          <tr class="hover:bg-gray-50">
            <td class="border border-gray-300 px-4 py-2">{{ i + 1 }}</td>
            <td class="border border-gray-300 px-4 py-2">{{ item.name }}</td>
            <td class="border border-gray-300 px-4 py-2">{{ item.emailAddress }}</td>
            <td class="border border-gray-300 px-4 py-2">{{ item.role }}</td>
            <td class="border border-gray-300 px-4 py-2">{{ item.userIdDrive }}</td>
            <td class="border border-gray-300 px-4 py-2">{{ item.googleId }}</td>
            <td class="border border-gray-300 px-4 py-2">
              <button mat-icon-button color="warn" (click)="deleteItem(item)">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>






    <mat-tree [dataSource]="dataTreeSource" [treeControl]="treeControl">
      <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding>
        <div class="p-2 w-full flex flex-row space-x-2 items-center justify-between hover:bg-gray-50 rounded-lg">
          <div class="flex flex-row space-x-3 items-center">
            <button (click)="LoadFolder(node.node)" mat-icon-button color="primary">
              <mat-icon aria-hidden="false" matBadgeColor="warn" [color]="node.node.type=='folder'?'warn':'accent'"  matBadge="{{node?.node?.children?.length||0}}">{{node.node.type=='folder'?'folder':'description'}}</mat-icon>
            </button>
            <button (click)="LoadPermission(node.node)" mat-icon-button color="primary">
              <mat-icon aria-hidden="false" matBadge="{{node?.node?.permissions?.length||0}}">group</mat-icon>
            </button>
            <span> {{node.name}}</span>
          </div>
        </div>

      </mat-tree-node>
      <mat-tree-node *matTreeNodeDef="let node;when: hasChild" matTreeNodePadding matTreeNodeToggle [cdkTreeNodeTypeaheadLabel]="node.name">
        <div class="p-2 w-full flex flex-row space-x-2 items-center justify-between hover:bg-gray-50 rounded-lg">
          <div class="flex flex-row space-x-3 items-center">
            <button (click)="LoadFolder(node.node)" mat-icon-button color="primary">
              <mat-icon aria-hidden="false" matBadgeColor="warn" [color]="node.node.type=='folder'?'warn':'primary'"  matBadge="{{node?.node?.children?.length||0}}">{{node.node.type=='folder'?'folder':'description'}}</mat-icon>
            </button>
            <button (click)="LoadPermission(node.node)" mat-icon-button color="primary">
              <mat-icon aria-hidden="false" matBadge="{{node?.node?.permissions?.length||0}}">group</mat-icon>
            </button>
            <span> {{node.name}}</span>

          </div>
          <button  mat-icon-button color="primary" matTreeNodeToggle [attr.aria-label]="'Toggle ' + node.name">
            <mat-icon>
              {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
            </mat-icon>
          </button>
        </div>

      </mat-tree-node>
    </mat-tree>
  </div>
  <div class="cursor-pointer border rounded-lg px-3 p-1 flex flex-row space-x-2 items-center justify-between">
    <div class="w-full flex lg:p-0 p-2 lg:flex-row lg:space-x-2 lg:items-center lg:justify-between flex-col justify-center">
      <span class="w-full text-center">Đang Xem <strong>{{ (currentPage - 1) * pageSize + 1 }}</strong> - <strong>{{ currentPage * pageSize > totalItems ? totalItems : currentPage * pageSize }}</strong> trong số {{ totalItems }} mục, {{ currentPage }}/{{totalPages}} Trang</span>
      <div class="w-full flex flex-row space-x-2 items-center lg:justify-end justify-center">
        <span class="font-bold text-blue-600" [matMenuTriggerFor]="menu" #menuHienthi="matMenuTrigger">Hiện Thị : {{pageSize}} mục</span>
        <mat-menu #menu="matMenu" >
          <div class="w-full flex flex-col space-y-2 p-4" (click)="$event.stopPropagation()">
            <span>Số Lượng</span>
            <mat-form-field appearance="outline" subscriptSizing="dynamic">
              <input matInput [(ngModel)]="pageSize"  [ngModelOptions]="{ standalone: true }" placeholder="Vui lòng Nhập Số Lượng" />
            </mat-form-field>
            <button mat-flat-button color="primary" (click)="onPageSizeChange(pageSize,menuHienthi)">Áp Dụng</button>
          </div>
        </mat-menu>
        <div class="pagination-controls">
          <button mat-icon-button color="primary" [disabled]="currentPage === 1" (click)="onPreviousPage()">
            <mat-icon>keyboard_arrow_left</mat-icon>
          </button>
          <button mat-icon-button color="primary" [disabled]="currentPage === totalPages" (click)="onNextPage()">
            <mat-icon>keyboard_arrow_right</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
</mat-drawer-container>

<ng-template #DeleteDialog>
  <mat-dialog-content>
    <div class="flex flex-col space-y-8 items-center justify-center">
      <div class="font-bold">Xác Nhận</div>
      <div>Bạn chắc chắn muốn xoá không?</div>
      <div class="flex flex-row space-x-2 items-center justify-center">
        <button mat-flat-button color="primary" mat-dialog-close="true">Đồng Ý</button>
        <button mat-flat-button color="warn" mat-dialog-close="false">Huỷ Bỏ</button>
      </div>
    </div>
  </mat-dialog-content>
</ng-template>