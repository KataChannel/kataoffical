import './polyfills.server.mjs';
import{g as U,j as K,n as L,o as q,p as J,q as Q}from"./chunk-X6GNBSA7.mjs";import{l as T,m as D,n as E,r as W,t as R,y as v}from"./chunk-55QLZJI7.mjs";import{Ab as C,C as M,Fa as S,Gb as g,Ic as y,La as P,Lc as B,Mc as j,Sb as l,ac as s,bc as p,cc as z,ea as G,gc as A,jd as H,ka as V,kc as d,lc as f,ob as a,ta as w,ua as F,xc as c,yc as b}from"./chunk-RUUFMXPL.mjs";import"./chunk-KB5IWD3E.mjs";import{a as _}from"./chunk-RIAI3ORJ.mjs";var x=class n{farmPlots=P([]);plots=this.farmPlots.asReadonly();rows=5;cols=5;gameTickInterval=1e3;gameSubscription=null;crops=[{name:"carrot",growthTime:10,harvestValue:5}];constructor(){console.log("FarmService initialized"),this.initializeFarm(this.rows,this.cols),this.startGameTick()}initializeFarm(e,t){this.rows=e,this.cols=t;let o=[],i=0;for(let r=0;r<e;r++){o[r]=[];for(let m=0;m<t;m++)o[r][m]={id:i++,row:r,col:m,state:"empty",cropType:null,growthProgress:0,watered:!1}}this.farmPlots.set(o),console.log(`Farm initialized with ${e}x${t} grid`)}getCrops(){return this.crops}plantCrop(e,t,o){let r=this.farmPlots()?.[e]?.[t],m=this.crops.find(u=>u.name===o);if(r&&r.state==="empty"&&m){let u=this.farmPlots().map(O=>O.map(tt=>_({},tt))),h=u[e][t];return h.state="planted",h.cropType=o,h.growthProgress=0,h.watered=!1,this.farmPlots.set(u),console.log(`Crop ${o} planted at (${e}, ${t})`),console.log(`Planted ${o} at (${e}, ${t})`),!0}return!1}waterPlot(e,t){let i=this.farmPlots()?.[e]?.[t];if(i&&(i.state==="planted"||i.state==="growing")&&!i.watered){let r=this.farmPlots().map(m=>m.map(u=>_({},u)));return r[e][t].watered=!0,this.farmPlots.set(r),console.log(`Watered plot at (${e}, ${t})`),!0}return!1}harvestPlot(e,t){let i=this.farmPlots()?.[e]?.[t];if(i&&i.state==="ready"){let r=i.cropType;console.log(`Harvested ${r} from (${e}, ${t})`);let m=this.farmPlots().map(h=>h.map(O=>_({},O))),u=m[e][t];return u.state="empty",u.cropType=null,u.growthProgress=0,u.watered=!1,this.farmPlots.set(m),!0}return!1}startGameTick(){this.gameSubscription&&this.gameSubscription.unsubscribe(),this.gameSubscription=M(this.gameTickInterval).subscribe(()=>{this.updateGrowth()}),console.log("Game tick started")}updateGrowth(){let e=!1,t=this.farmPlots().map(o=>o.map(i=>_({},i)));for(let o=0;o<this.rows;o++)for(let i=0;i<this.cols;i++){let r=t[o][i],m=this.crops.find(u=>u.name===r.cropType);r.cropType&&(r.state==="planted"||r.state==="growing")&&m&&(r.state==="planted"&&r.growthProgress>0&&(r.state="growing",e=!0),r.watered=!1,r.growthProgress<100&&(e=!0))}this.farmPlots.set(t)}stopGameTick(){this.gameSubscription&&(this.gameSubscription.unsubscribe(),this.gameSubscription=null,console.log("Game tick stopped"))}ngOnDestroy(){this.stopGameTick()}static \u0275fac=function(t){return new(t||n)};static \u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"})};function et(n,e){n&1&&(s(0,"span"),c(1,"\u{1F331}"),p())}function ot(n,e){n&1&&(s(0,"span"),c(1,"\u{1F33F}"),p())}function nt(n,e){n&1&&(s(0,"span"),c(1,"\u{1F955}"),p())}function it(n,e){n&1&&z(0,"span")}function rt(n,e){if(n&1&&(s(0,"div",4),c(1),p()),n&2){let t=f();a(),b(t.growthProgressDisplay)}}function lt(n,e){n&1&&(s(0,"div",5),c(1,"\u{1F4A7}"),p())}var k=class n{plot;selectedAction=null;plotAction=new S;onClick(){console.log(`Plot clicked: (${this.plot.row}, ${this.plot.col}), State: ${this.plot.state}, Action: ${this.selectedAction}`),this.plotAction.emit({row:this.plot.row,col:this.plot.col,actionType:this.selectedAction})}get plotClass(){let e=`plot plot-${this.plot.state}`;return this.plot.watered&&(e+=" watered"),this.plot.cropType&&(e+=` crop-${this.plot.cropType}`),e}get growthProgressDisplay(){return this.plot.state==="growing"||this.plot.state==="ready"?`${Math.floor(this.plot.growthProgress)}%`:""}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=C({type:n,selectors:[["app-farm-plot"]],inputs:{plot:"plot",selectedAction:"selectedAction"},outputs:{plotAction:"plotAction"},decls:7,vars:7,consts:[[3,"click","ngClass"],[4,"ngIf"],["class","progress",4,"ngIf"],["class","watered-indicator",4,"ngIf"],[1,"progress"],[1,"watered-indicator"]],template:function(t,o){t&1&&(s(0,"div",0),d("click",function(){return o.onClick()}),g(1,et,2,0,"span",1)(2,ot,2,0,"span",1)(3,nt,2,0,"span",1)(4,it,1,0,"span",1)(5,rt,2,1,"div",2)(6,lt,2,0,"div",3),p()),t&2&&(l("ngClass",o.plotClass),a(),l("ngIf",o.plot.state==="planted"),a(),l("ngIf",o.plot.state==="growing"),a(),l("ngIf",o.plot.state==="ready"),a(),l("ngIf",o.plot.state==="empty"),a(),l("ngIf",o.plot.state==="growing"||o.plot.state==="ready"),a(),l("ngIf",o.plot.watered))},dependencies:[v,T,E],styles:[".plot[_ngcontent-%COMP%]{width:60px;height:60px;border:1px solid #ccc;display:flex;justify-content:center;align-items:center;cursor:pointer;position:relative;transition:background-color .2s ease}.plot[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.plot-empty[_ngcontent-%COMP%]{background-color:tan}.plot-planted[_ngcontent-%COMP%]{background-color:#a0a0a0}.plot-growing[_ngcontent-%COMP%]{background-color:#c8f0a8}.plot-ready[_ngcontent-%COMP%]{background-color:#ffecb3}.watered-indicator[_ngcontent-%COMP%]{position:absolute;top:2px;right:2px;font-size:.8em;color:#00f}.progress[_ngcontent-%COMP%]{position:absolute;bottom:2px;left:0;right:0;text-align:center;font-size:.7em;color:#333;background-color:#ffffffb3;padding:1px 0}"],changeDetection:0})};function at(n,e){if(n&1){let t=A();s(0,"app-farm-plot",3),d("plotAction",function(i){w(t);let r=f(2);return F(r.handlePlotAction(i))}),p()}if(n&2){let t=e.$implicit,o=f(2);l("plot",t)("selectedAction",o.selectedAction)}}function st(n,e){if(n&1&&(s(0,"div"),g(1,at,1,2,"app-farm-plot",2),p()),n&2){let t=e.$implicit;a(),l("ngForOf",t)}}var N=class n{plots=null;selectedAction=null;plotAction=new S;handlePlotAction(e){this.plotAction.emit(e)}get gridStyles(){let e=this.plots?.length??0,t=this.plots?.[0]?.length??0;return e>0&&t>0?{"grid-template-rows":`repeat(${e}, 60px)`,"grid-template-columns":`repeat(${t}, 60px)`}:{}}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=C({type:n,selectors:[["app-farm-grid"]],inputs:{plots:"plots",selectedAction:"selectedAction"},outputs:{plotAction:"plotAction"},decls:2,vars:2,consts:[[1,"farm-grid",3,"ngStyle"],[4,"ngFor","ngForOf"],[3,"plot","selectedAction","plotAction",4,"ngFor","ngForOf"],[3,"plotAction","plot","selectedAction"]],template:function(t,o){t&1&&(s(0,"div",0),g(1,st,2,1,"div",1),p()),t&2&&(l("ngStyle",o.gridStyles),a(),l("ngForOf",o.plots))},dependencies:[v,D,W,k],styles:['@charset "UTF-8";.farm-grid[_ngcontent-%COMP%]{display:grid;gap:5px;margin:20px auto;border:2px solid #8b4513;padding:10px;background-color:khaki;width:fit-content}'],changeDetection:0})};var I=n=>({selected:n});function pt(n,e){if(n&1&&(s(0,"option",8),c(1),B(2,"uppercase"),p()),n&2){let t=e.$implicit;l("value",t.name),a(),b(j(2,2,t.name))}}function ct(n,e){if(n&1){let t=A();s(0,"div",5),c(1," Ch\u1ECDn c\xE2y \u0111\u1EC3 gieo: "),s(2,"select",6),d("change",function(i){w(t);let r=f();return F(r.selectCrop(i))}),g(3,pt,3,4,"option",7),p()()}if(n&2){let t=f();a(2),l("ngModel",t.selectedCropName()),a(),l("ngForOf",t.availableCrops)}}var Z=class n{title="N\xF4ng Tr\u1EA1i C\u01A1 B\u1EA3n - Angular (Standalone & Signals)";farmService=V(x);plots=this.farmService.plots;availableCrops=[];selectedAction=P(null);selectedCropName=P("carrot");isPlanting=H(()=>this.selectedAction()==="plant");constructor(){}ngOnInit(){console.log("App Component initialized."),this.availableCrops=this.farmService.getCrops()}handlePlotAction(e){let{row:t,col:o,actionType:i}=e;i==="plant"&&this.selectedCropName()?this.farmService.plantCrop(t,o,this.selectedCropName()):i==="water"?this.farmService.waterPlot(t,o):i==="harvest"&&this.farmService.harvestPlot(t,o)}selectAction(e){this.selectedAction.set(e),console.log(`Selected action: ${e}`),e!=="plant"?this.selectedCropName.set(null):this.availableCrops.length>0?this.selectedCropName.set(this.availableCrops[0].name):this.selectedCropName.set(null)}selectCrop(e){let o=e.target.value;this.isPlanting()&&(this.selectedCropName.set(o),console.log(`Selected crop to plant: ${o}`))}ngOnDestroy(){this.farmService.stopGameTick()}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=C({type:n,selectors:[["app-farm"]],decls:16,vars:16,consts:[[1,"container"],[1,"toolbar"],[3,"click","ngClass"],["class","crop-selector",4,"ngIf"],[3,"plotAction","plots","selectedAction"],[1,"crop-selector"],[3,"change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,o){t&1&&(s(0,"div",0)(1,"h1"),c(2),p(),s(3,"div",1)(4,"h3"),c(5,"Ch\u1ECDn h\xE0nh \u0111\u1ED9ng:"),p(),s(6,"button",2),d("click",function(){return o.selectAction("plant")}),c(7,"\u{1F331} Gieo H\u1EA1t"),p(),s(8,"button",2),d("click",function(){return o.selectAction("water")}),c(9,"\u{1F4A7} T\u01B0\u1EDBi N\u01B0\u1EDBc"),p(),s(10,"button",2),d("click",function(){return o.selectAction("harvest")}),c(11,"\u{1F955} Thu Ho\u1EA1ch"),p(),s(12,"button",2),d("click",function(){return o.selectAction(null)}),c(13,"\u{1F6B6}\u200D\u2642\uFE0F Ch\u1ECDn (Kh\xF4ng h\xE0nh \u0111\u1ED9ng)"),p(),g(14,ct,4,2,"div",3),p(),s(15,"app-farm-grid",4),d("plotAction",function(r){return o.handlePlotAction(r)}),p()()),t&2&&(a(2),b(o.title),a(4),l("ngClass",y(8,I,o.selectedAction()==="plant")),a(2),l("ngClass",y(10,I,o.selectedAction()==="water")),a(2),l("ngClass",y(12,I,o.selectedAction()==="harvest")),a(2),l("ngClass",y(14,I,o.selectedAction()===null)),a(2),l("ngIf",o.isPlanting()),a(),l("plots",o.plots())("selectedAction",o.selectedAction()))},dependencies:[v,T,D,E,R,Q,q,J,L,U,K,N],encapsulation:2})};export{Z as FarmComponent};
