import './polyfills.server.mjs';
import{k as ie,o as ne,s as oe,t as re}from"./chunk-INK5SBFN.mjs";import{D as j,Gc as I,Hc as J,Ic as W,Jc as ee,Kc as te,Pb as E,Qb as P,Rc as R,Sb as L,Tb as X,Ub as Y,Vb as k,Wb as a,Xb as l,Yb as N,ac as D,ec as v,fb as z,fc as _,gb as d,jc as Z,kc as Q,lc as U,pa as u,qa as g,qc as M,ra as G,sa as q,sb as K,tc as p,uc as V,vc as T,wc as B,za as w}from"./chunk-LD2AVDEF.mjs";import"./chunk-W2PR56MU.mjs";import{a as C,b as H}from"./chunk-RIAI3ORJ.mjs";var me=["mapContainer"],de=(s,e)=>({"fixed h-full translate-x-0":s,"-translate-x-full fixed h-full":e,"md:relative md:translate-x-0":!0}),$=(s,e)=>({"bg-green-600 text-white shadow-inner":s,"bg-gray-200 hover:bg-gray-300":e}),he=(s,e)=>({"border-blue-600 font-bold bg-blue-100 transform scale-105":s,"border-gray-300":e}),ue=(s,e,t,i,n)=>({"hover:brightness-110":s,"hover:brightness-90":e,"bg-yellow-600":t,"bg-yellow-600 border-2 border-black z-10":i,"cursor-pointer":n});function ge(s,e){if(s&1){let t=D();a(0,"div",25),v("click",function(){u(t);let n=_();return g(n.toggleMobileSidebar())}),l()}}function fe(s,e){if(s&1){let t=D();a(0,"div",26),v("click",function(){let n=u(t).$implicit,o=_();return g(o.selectSeed(n.id))}),a(1,"span"),p(2),l(),a(3,"span",27),p(4),l()()}if(s&2){let t=e.$implicit,i=e.$index,n=_();M("border-color",n.selectedCropId()===t.id&&n.selectedTool()==="plant"?"blue":t.color||"#d1d5db"),k("ngClass",I(6,he,n.selectedCropId()===t.id&&n.selectedTool()==="plant",n.selectedCropId()!==t.id||n.selectedTool()!=="plant")),d(2),B("",i+1,". ",t.name),d(2),T("(",n.inventory()["crop"+t.id]||0,")")}}function ve(s,e){s&1&&(a(0,"span",31),p(1,"\u0110\u1EA5t"),l())}function we(s,e){if(s&1&&(a(0,"span",33),p(1),l(),a(2,"span",34),p(3),l()),s&2){let t,i,n=_(2).$implicit,o=_();M("color",((t=o.getCropById(n.cropId))==null?null:t.color)||"white"),d(),V((i=o.getCropById(n.cropId))==null||i.name==null?null:i.name.substring(0,2)),d(2),T("",o.getRemainingTime(n),"s")}}function _e(s,e){if(s&1&&(a(0,"span",33),p(1),l(),a(2,"span",34),p(3),l()),s&2){let t,i,n=_(2).$implicit,o=_();M("color",((t=o.getCropById(n.cropId))==null?null:t.color)||"white"),d(),T("",(i=o.getCropById(n.cropId))==null||i.name==null?null:i.name.substring(0,2),".."),d(2),T("",o.getRemainingTime(n),"s")}}function be(s,e){if(s&1&&(a(0,"span",35),p(1,"Ch\xEDn!"),l()),s&2){let t,i=_(2).$implicit,n=_();M("color",((t=n.getCropById(i.cropId))==null?null:t.color)||"white")}}function ye(s,e){if(s&1&&E(0,ve,2,0,"span",31)(1,we,4,4)(2,_e,4,4)(3,be,2,2,"span",32),s&2){let t,i=_().$implicit;P((t=i.state)==="empty"?0:t==="seed"?1:t==="growing"?2:t==="ready"?3:-1)}}function Ce(s,e){s&1&&(a(0,"span",29),p(1," P "),l())}function Te(s,e){s&1&&(a(0,"span",30),p(1,"~"),l())}function xe(s,e){if(s&1){let t=D();a(0,"div",28),v("click",function(){let n=u(t).$implicit,o=_();return g(o.onTileClick(n))}),E(1,ye,4,1),E(2,Ce,2,0,"span",29),E(3,Te,2,0,"span",30),l()}if(s&2){let t=e.$implicit,i=_();M("width",i.baseTileSize,"px")("height",i.baseTileSize,"px")("left",t.col*i.baseTileSize,"px")("top",t.row*i.baseTileSize,"px")("background-color",t.type==="soil"&&t.state==="empty"?i.getSoilColor(t):t.type==="soil"&&t.state!=="empty"?"#8B4513":i.getTileColor(t.type)),k("ngClass",J(14,ue,t.type!=="water",t.type==="water",t.type==="pen"&&!t.isPenTopLeft,t.isPenTopLeft,t.type!=="water")),d(),P(t.type==="soil"?1:-1),d(),P(t.type==="pen"&&t.isPenTopLeft?2:-1),d(),P(t.type==="water"?3:-1)}}function Se(s,e){if(s&1&&(a(0,"div",42)(1,"div",44),p(2),W(3,"uppercase"),l(),a(4,"div",45),p(5),l(),a(6,"div",46),p(7),l()()),s&2){let t=e.$implicit;d(),M("background-color",t.color||"#a1a1aa"),d(),V(ee(3,5,t.name.substring(0,1))),d(3),V(t.name),d(2),T("x ",t.quantity)}}function Ee(s,e){s&1&&(a(0,"div",43),p(1,"T\xFAi \u0111\u1ED3 tr\u1ED1ng tr\u01A1n..."),l())}function Pe(s,e){if(s&1){let t=D();a(0,"div",36),v("click",function(){u(t);let n=_();return g(n.toggleInventoryDialog())}),a(1,"div",37),v("click",function(n){return u(t),g(n.stopPropagation())}),a(2,"div",38)(3,"h2",39),p(4,"T\xFAi \u0110\u1ED3"),l(),a(5,"button",40),v("click",function(){u(t);let n=_();return g(n.toggleInventoryDialog())}),p(6,"\xD7"),l()(),a(7,"div",41),X(8,Se,8,7,"div",42,L),E(10,Ee,2,0,"div",43),l()()()}if(s&2){let t=_();d(8),Y(t.inventoryItems()),d(2),P(t.inventoryItems().length===0?10:-1)}}var ae=class s{rows=30;cols=30;baseTileSize=32;mapTilesSignal=w([]);tickSub;lastHarvestInfo="Ch\xE0o m\u1EEBng \u0111\u1EBFn H\xF2n \u0110\u1EA3o N\xF4ng Tr\u1EA1i!";materialDropRate=.8;seedDropRate=.5;showInventoryDialog=!1;zoomLevel=w(1);panX=w(0);panY=w(0);isPanning=w(!1);lastPanCoords={x:0,y:0};viewportWidth=w(0);viewportHeight=w(0);isMobileSidebarOpen=w(!1);lastPinchDistance=0;touchStartTime=0;tapThreshold=200;tapMoveThreshold=10;growingPlots=w([]);mapContainerRef;selectedTool=w("harvest");crops=[{id:1,name:"chanh v\xE0ng",element:"kim",growthTime:10,harvestValue:5,color:"yellow"},{id:2,name:"\u1ED5i",element:"moc",growthTime:8,harvestValue:4,color:"green"},{id:3,name:"m\u1EADn",element:"thuy",growthTime:12,harvestValue:6,color:"blue"},{id:4,name:"\u0111\xE0o",element:"hoa",growthTime:9,harvestValue:5,color:"red"},{id:5,name:"nh\xE3n",element:"tho",growthTime:11,harvestValue:7,color:"brown"}];cropMaterials={1:[{id:101,name:"S\u1EE3i chanh v\xE0ng"},{id:102,name:"Nh\u1EF1a chanh"}],2:[{id:201,name:"S\u1EE3i \u1ED5i"},{id:202,name:"L\xE1 \u1ED5i"},{id:203,name:"G\u1ED7 \u1ED5i"}],3:[{id:301,name:"S\u1EE3i m\u1EADn"},{id:302,name:"Nh\u1EF1a m\u1EADn"}],4:[{id:401,name:"S\u1EE3i \u0111\xE0o"},{id:402,name:"Hoa \u0111\xE0o"},{id:403,name:"G\u1ED7 \u0111\xE0o"}],5:[{id:501,name:"S\u1EE3i nh\xE3n"},{id:502,name:"V\u1ECF nh\xE3n"},{id:503,name:"G\u1ED7 nh\xE3n"}]};soilColors={kim:"#EFEFEF",moc:"#A0522D",thuy:"#2F4F4F",hoa:"#B22222",tho:"#DEB887"};birthMap={kim:"thuy",thuy:"moc",moc:"hoa",hoa:"tho",tho:"kim"};killMap={kim:"moc",moc:"tho",tho:"thuy",thuy:"hoa",hoa:"kim"};inventory=w({crop1:5,crop2:5,crop3:5,crop4:5,crop5:5,fruit1:0,fruit2:0,fruit3:0,fruit4:0,fruit5:0,mat101:0,mat102:0,mat201:0,mat202:0,mat203:0,mat301:0,mat302:0,mat401:0,mat402:0,mat403:0,mat501:0,mat502:0,mat503:0,soil:50,pen:20});money=w(0);playerLevel=w(1);playerXP=w(0);selectedCropId=w(this.crops[0].id);inventoryItems=R(()=>{let e=this.inventory(),t=[];return this.crops.forEach(i=>{let n=`crop${i.id}`;e[n]>0&&t.push({id:n,name:`${i.name} Seed`,quantity:e[n],type:"seed",color:i.color})}),this.crops.forEach(i=>{let n=`fruit${i.id}`;e[n]>0&&t.push({id:n,name:i.name,quantity:e[n],type:"fruit",color:i.color})}),Object.values(this.cropMaterials).flat().forEach(i=>{let n=`mat${i.id}`;e[n]>0&&t.push({id:n,name:i.name,quantity:e[n],type:"material"})}),e.soil>0&&t.push({id:"soil",name:"\u0110\u1EA5t",quantity:e.soil,type:"tool",color:"#A0522D"}),e.pen>0&&t.push({id:"pen",name:"Chu\u1ED3ng",quantity:e.pen,type:"tool",color:"#D2B48C"}),t});visibleTiles=R(()=>{let e=this.zoomLevel(),t=this.baseTileSize*e,i=this.panX(),n=this.panY(),o=this.viewportWidth(),r=this.viewportHeight(),c=this.mapTilesSignal();if(c.length===0||o===0||r===0)return[];let m=3,h=Math.max(0,Math.floor(-n/t)-m),f=Math.min(this.rows-1,Math.ceil((-n+r)/t)+m),b=Math.max(0,Math.floor(-i/t)-m),x=Math.min(this.cols-1,Math.ceil((-i+o)/t)+m),y=[];for(let S=h;S<=f;S++)for(let F=b;F<=x;F++)c[S]?.[F]&&y.push(c[S][F]);return y});mapTransform=R(()=>`translate(${this.panX()}px, ${this.panY()}px) scale(${this.zoomLevel()})`);ngOnInit(){this.initMap(),this.tickSub=j(500).subscribe(()=>this.updateGrowthOptimized()),window.addEventListener("keydown",this.onKey)}ngAfterViewInit(){this.updateViewportSize();let e=(this.viewportWidth()-this.cols*this.baseTileSize)/2,t=(this.viewportHeight()-this.rows*this.baseTileSize)/2;this.panX.set(this.clampPan(e,this.viewportWidth(),this.cols*this.baseTileSize)),this.panY.set(this.clampPan(t,this.viewportHeight(),this.rows*this.baseTileSize))}ngOnDestroy(){this.tickSub.unsubscribe(),window.removeEventListener("keydown",this.onKey)}updateViewportSize(){this.mapContainerRef&&(this.viewportWidth.set(this.mapContainerRef.nativeElement.clientWidth),this.viewportHeight.set(this.mapContainerRef.nativeElement.clientHeight))}initMap(){let e=[],t=0,i=20,n=(this.rows-i)/2,o=n+i-1,r=(this.cols-i)/2,c=r+i-1;for(let m=0;m<this.rows;m++){e[m]=[];for(let h=0;h<this.cols;h++){let f;m>=n&&m<=o&&h>=r&&h<=c?f="grass":f="water",e[m][h]={id:t++,row:m,col:h,type:f,cropId:null,growthProgress:0,effectiveGrowthTime:0,effectiveHarvestValue:0,state:void 0,soilType:void 0,isPenTopLeft:!1}}}this.mapTilesSignal.set(e),this.growingPlots.set([])}updateTile(e,t,i){this.mapTilesSignal.update(n=>{let o=n.map(r=>r.map(c=>C({},c)));return o[e][t]=C(C({},o[e][t]),i),o})}placeSoil(e){if(e.type==="water"){this.lastHarvestInfo="Kh\xF4ng th\u1EC3 \u0111\u1EB7t \u0111\u1EA5t tr\xEAn m\u1EB7t n\u01B0\u1EDBc!";return}e.type==="grass"&&this.inventory().soil>0?(this.inventory.update(t=>H(C({},t),{soil:t.soil-1})),this.updateTile(e.row,e.col,{type:"soil",state:"empty",soilType:(e.row*this.cols+e.col)%5}),this.lastHarvestInfo=`\u0110\u1EB7t 1 \xF4 \u0111\u1EA5t t\u1EA1i (${e.row}, ${e.col}).`):e.type!=="grass"?this.lastHarvestInfo="Ch\u1EC9 c\xF3 th\u1EC3 \u0111\u1EB7t \u0111\u1EA5t tr\xEAn c\u1ECF!":this.lastHarvestInfo="H\u1EBFt \u0111\u1EA5t trong t\xFAi!"}canPlacePen(e,t){let i=this.mapTilesSignal();if(e+1>=this.rows||t+1>=this.cols)return!1;for(let n=e;n<e+2;n++)for(let o=t;o<t+2;o++)if(!i[n]?.[o]||i[n][o].type!=="grass")return!1;return!0}placePen(e){if(this.inventory().pen>0&&this.canPlacePen(e.row,e.col)){this.inventory.update(t=>H(C({},t),{pen:t.pen-1}));for(let t=0;t<2;t++)for(let i=0;i<2;i++)this.updateTile(e.row+t,e.col+i,{type:"pen",isPenTopLeft:t===0&&i===0});this.lastHarvestInfo=`\u0110\u1EB7t 1 chu\u1ED3ng t\u1EA1i (${e.row}, ${e.col}).`}else this.canPlacePen(e.row,e.col)?this.lastHarvestInfo="H\u1EBFt chu\u1ED3ng trong t\xFAi!":this.lastHarvestInfo="Kh\xF4ng \u0111\u1EE7 ch\u1ED7 (c\u1EA7n 2x2 c\u1ECF) ho\u1EB7c \u0111\xE3 ra r\xECa/tr\xEAn n\u01B0\u1EDBc!"}onTileClick(e){switch(this.selectedTool()){case"place_soil":this.placeSoil(e);break;case"place_pen":this.placePen(e);break;case"plant":case"harvest":this.handlePlantHarvestClick(e);break}}handlePlantHarvestClick(e){let t=this.selectedTool();if(e.type!=="soil"){this.lastHarvestInfo="Ch\u1EC9 c\xF3 th\u1EC3 tr\u1ED3ng/thu ho\u1EA1ch tr\xEAn \u0111\u1EA5t tr\u1ED3ng!";return}let n=this.mapTilesSignal()[e.row][e.col];if(t==="plant"&&n.state==="empty"){let o=this.selectedCropId(),r=this.crops.find(y=>y.id===o),c=["kim","moc","thuy","hoa","tho"][n.soilType],m=C({},this.inventory()),h=`crop${r.id}`;if(!m[h]||m[h]<=0){this.lastHarvestInfo=`Kh\xF4ng \u0111\u1EE7 h\u1EA1t gi\u1ED1ng ${r.name}!`;return}m[h]--,this.inventory.set(m);let f=1,b=1;this.birthMap[r.element]===c?(f=1.5,b=.8):this.killMap[r.element]===c&&(f=.7,b=1.3);let x={state:"seed",cropId:r.id,effectiveGrowthTime:Math.ceil(r.growthTime*b),effectiveHarvestValue:Math.ceil(r.harvestValue*f),growthProgress:0};this.updateTile(e.row,e.col,x),this.growingPlots.update(y=>[...y,C(C({},n),x)]),this.lastHarvestInfo=`Tr\u1ED3ng ${r.name}.`}else if(t==="harvest"&&n.state==="ready"&&n.cropId!==null){let o=this.crops.find(h=>h.id===n.cropId),r=n.effectiveHarvestValue;this.money.set(this.money()+r),this.increasePlayerXP(r);let c=C({},this.inventory()),m=[];c[`fruit${o.id}`]=(c[`fruit${o.id}`]||0)+1,m.push(`${o.name}: 1`),Math.random()<this.seedDropRate&&(c[`crop${o.id}`]=(c[`crop${o.id}`]||0)+1,m.push(`${o.name} Seed: 1`)),(this.cropMaterials[o.id]||[]).forEach(h=>{Math.random()<this.materialDropRate&&(c[`mat${h.id}`]=(c[`mat${h.id}`]||0)+1,m.push(`${h.name}: 1`))}),this.inventory.set(c),this.lastHarvestInfo=`Thu ho\u1EA1ch ${o.name} (+${r} Ti\u1EC1n, +${r} XP): ${m.join(", ")}`,this.updateTile(e.row,e.col,{state:"empty",cropId:null,growthProgress:0,effectiveGrowthTime:0,effectiveHarvestValue:0}),this.growingPlots.update(h=>h.filter(f=>f.id!==e.id))}else t==="plant"&&n.state!=="empty"?this.lastHarvestInfo="\xD4 \u0111\u1EA5t n\xE0y ch\u01B0a s\u1EB5n s\xE0ng \u0111\u1EC3 tr\u1ED3ng!":t==="harvest"&&n.state!=="ready"&&(this.lastHarvestInfo="C\xE2y ch\u01B0a ch\xEDn \u0111\u1EC3 thu ho\u1EA1ch!")}updateGrowthOptimized(){let e=this.growingPlots();if(e.length===0)return;let t=this.mapTilesSignal(),i=[];e.forEach(n=>{let o=t[n.row][n.col];if((o.state==="seed"||o.state==="growing")&&o.cropId){let r=o.growthProgress+1,c=o.state;r>=o.effectiveGrowthTime?c="ready":(c="growing",i.push(H(C({},o),{growthProgress:r,state:c}))),r!==o.growthProgress||c!==o.state?this.updateTile(o.row,o.col,{growthProgress:r,state:c}):c==="growing"&&i.push(o)}}),this.growingPlots.set(i)}handleWheel(e){e.preventDefault();let t=1.1,i=this.zoomLevel(),n;if(e.deltaY<0?n=Math.min(1,i*t):n=Math.max(.5,i/t),n!==i){let r=this.mapContainerRef.nativeElement.getBoundingClientRect(),c=e.clientX-r.left,m=e.clientY-r.top,h=(c-this.panX())/i,f=(m-this.panY())/i,b=c-h*n,x=m-f*n;this.zoomLevel.set(n),this.panX.set(this.clampPan(b,this.viewportWidth(),this.cols*this.baseTileSize*n)),this.panY.set(this.clampPan(x,this.viewportHeight(),this.rows*this.baseTileSize*n))}}zoomIn(){let e=this.mapContainerRef.nativeElement,t=e.clientWidth/2,i=e.clientHeight/2;this.handleWheel({deltaY:-100,clientX:t+e.getBoundingClientRect().left,clientY:i+e.getBoundingClientRect().top,preventDefault:()=>{}})}zoomOut(){let e=this.mapContainerRef.nativeElement,t=e.clientWidth/2,i=e.clientHeight/2;this.handleWheel({deltaY:100,clientX:t+e.getBoundingClientRect().left,clientY:i+e.getBoundingClientRect().top,preventDefault:()=>{}})}clampPan(e,t,i){let o=Math.min(50,t-i-50);return Math.max(o,Math.min(50,e))}onMouseDown(e){e.preventDefault(),this.isPanning.set(!0),this.lastPanCoords={x:e.clientX,y:e.clientY},this.mapContainerRef.nativeElement.style.cursor="grabbing"}onMouseMove(e){if(!this.isPanning())return;e.preventDefault();let t=e.clientX-this.lastPanCoords.x,i=e.clientY-this.lastPanCoords.y;this.lastPanCoords={x:e.clientX,y:e.clientY};let n=this.zoomLevel(),o=this.cols*this.baseTileSize*n,r=this.rows*this.baseTileSize*n;this.panX.update(c=>this.clampPan(c+t,this.viewportWidth(),o)),this.panY.update(c=>this.clampPan(c+i,this.viewportHeight(),r))}onMouseUp(e){this.isPanning()&&(this.isPanning.set(!1),this.mapContainerRef.nativeElement.style.cursor="grab")}onMouseLeave(e){e.relatedTarget===null&&this.isPanning()&&this.onMouseUp(e)}handleTouchStart(e){e.preventDefault(),this.touchStartTime=Date.now();let t=e.touches;t.length===1?(this.isPanning.set(!0),this.lastPanCoords={x:t[0].clientX,y:t[0].clientY},this.lastPinchDistance=0):t.length===2&&(this.isPanning.set(!1),this.lastPinchDistance=this.getPinchDistance(t))}handleTouchMove(e){e.preventDefault();let t=e.touches;if(t.length===1&&this.isPanning()){let i=t[0].clientX-this.lastPanCoords.x,n=t[0].clientY-this.lastPanCoords.y;this.lastPanCoords={x:t[0].clientX,y:t[0].clientY};let o=this.zoomLevel(),r=this.cols*this.baseTileSize*o,c=this.rows*this.baseTileSize*o;this.panX.update(m=>this.clampPan(m+i,this.viewportWidth(),r)),this.panY.update(m=>this.clampPan(m+n,this.viewportHeight(),c))}else if(t.length===2&&this.lastPinchDistance>0){let i=this.getPinchDistance(t),n=i/this.lastPinchDistance;this.lastPinchDistance=i;let o=this.zoomLevel(),r=o*n;if(r=Math.max(.1,Math.min(4,r)),r!==o){let m=this.mapContainerRef.nativeElement.getBoundingClientRect(),h=(t[0].clientX+t[1].clientX)/2-m.left,f=(t[0].clientY+t[1].clientY)/2-m.top,b=(h-this.panX())/o,x=(f-this.panY())/o,y=h-b*r,S=f-x*r;this.zoomLevel.set(r),this.panX.set(this.clampPan(y,this.viewportWidth(),this.cols*this.baseTileSize*r)),this.panY.set(this.clampPan(S,this.viewportHeight(),this.rows*this.baseTileSize*r))}}}handleTouchEnd(e){e.preventDefault();let t=e.changedTouches;if(t.length===0)return;let i=t[0],n=Date.now()-this.touchStartTime,o=this.lastPanCoords.x,r=this.lastPanCoords.y,c=i.clientX,m=i.clientY,h=c-o,f=m-r,b=Math.sqrt(h*h+f*f);if(this.isPanning()&&n<this.tapThreshold&&b<this.tapMoveThreshold){let y=this.mapContainerRef.nativeElement.getBoundingClientRect(),S=i.clientX-y.left,F=i.clientY-y.top,O=this.zoomLevel(),se=(S-this.panX())/O,le=(F-this.panY())/O,ce=Math.floor(se/this.baseTileSize),pe=Math.floor(le/this.baseTileSize),A=this.mapTilesSignal()[pe]?.[ce];A&&this.onTileClick(A)}this.isPanning.set(!1),this.lastPinchDistance=0,this.mapContainerRef&&(this.mapContainerRef.nativeElement.style.cursor="grab")}getPinchDistance(e){let t=e[0].clientX-e[1].clientX,i=e[0].clientY-e[1].clientY;return Math.sqrt(t*t+i*i)}getRemainingTime=e=>Math.max(0,e.effectiveGrowthTime-e.growthProgress);getCropById=e=>this.crops.find(t=>t.id===e);getSoilColor=e=>this.soilColors[["kim","moc","thuy","hoa","tho"][e.soilType]];getTileColor(e){switch(e){case"grass":return"#66bb6a";case"water":return"#42a5f5";case"soil":return"#A0522D";case"pen":return"#D2B48C";default:return"#bdbdbd"}}selectSeed(e){this.selectedCropId.set(e),this.selectedTool.set("plant"),this.isMobileSidebarOpen.set(!1)}toggleInventoryDialog=()=>this.showInventoryDialog=!this.showInventoryDialog;increasePlayerXP(e){let t=this.playerXP(),i=this.playerLevel();for(t+=e;t>=i*20;)t-=i*20,i++;this.playerXP.set(t),this.playerLevel.set(i)}onKey=e=>{if(e.key>="1"&&e.key<="5"){let t=+e.key-1;this.crops[t]&&this.selectSeed(this.crops[t].id)}e.key.toLowerCase()==="i"&&this.toggleInventoryDialog(),e.key.toLowerCase()==="h"&&this.selectedTool.set("harvest"),e.key.toLowerCase()==="p"&&this.selectedTool.set("plant"),e.key.toLowerCase()==="d"&&this.selectedTool.set("place_soil"),e.key.toLowerCase()==="c"&&this.selectedTool.set("place_pen")};trackTileById=(e,t)=>t.id;toggleMobileSidebar(){this.isMobileSidebarOpen.update(e=>!e)}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=K({type:s,selectors:[["app-farm"]],viewQuery:function(t,i){if(t&1&&Z(me,5),t&2){let n;Q(n=U())&&(i.mapContainerRef=n.first)}},hostBindings:function(t,i){t&1&&v("resize",function(){return i.updateViewportSize()},z)("mousemove",function(o){return i.onMouseMove(o)},z)("mouseup",function(o){return i.onMouseUp(o)},z)("mouseleave",function(o){return i.onMouseLeave(o)},z)},decls:60,vars:39,consts:[["mapContainer",""],[1,"flex","w-screen","h-screen","overflow-hidden","font-sans","text-gray-900"],["aria-label","Toggle Menu",1,"md:hidden","fixed","top-2","left-2","z-50","p-2","bg-gray-700","text-white","rounded-md","shadow-lg",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6h16M4 12h16m-7 6h7"],[1,"md:hidden","fixed","inset-0","bg-black/50","z-30"],[1,"w-64","p-4","bg-gray-100","border-r","border-gray-300","flex","flex-col","gap-4","overflow-y-auto","shrink-0","transition-transform","duration-300","ease-in-out","z-40",3,"ngClass"],[1,"md:hidden","self-end","p-1","text-2xl",3,"click"],[1,"text-xl","font-bold","text-center","text-gray-800"],[1,"bg-white","p-3","rounded-lg","shadow-md"],[1,"text-lg","font-semibold","text-center","text-gray-800","mb-2"],[1,"text-sm"],[1,"font-medium"],[1,"grid","grid-cols-2","gap-2","text-sm"],[1,"p-2","rounded","transition","duration-150",3,"click","ngClass"],[1,"p-2","border-2","rounded-md","cursor-pointer","mb-1","flex","justify-between","items-center","transition","duration-200","ease-in-out","hover:bg-gray-200",3,"ngClass","borderColor"],[1,"bg-white","p-3","rounded-lg","shadow-md","flex","justify-around","items-center"],[1,"px-3","py-1","bg-blue-500","text-white","rounded","hover:bg-blue-600","text-lg","font-bold","transition","active:scale-95",3,"click"],[1,"text-sm","text-center","self-center"],[1,"w-full","p-3","bg-purple-600","text-white","rounded-md","cursor-pointer","text-center","hover:bg-purple-700","transition",3,"click"],[1,"mt-auto","p-3","bg-yellow-50","border","border-yellow-300","rounded-md","min-h-[60px]","text-sm","text-gray-800","break-words"],[1,"flex-grow","overflow-hidden","bg-gray-900","relative","cursor-grab",2,"touch-action","none",3,"wheel","mousedown","touchstart","touchmove","touchend","touchcancel"],[1,"absolute","top-0","left-0",2,"transform-origin","0 0"],[1,"absolute","border","border-black/20","box-border","flex","flex-col","items-center","justify-center","text-xs","select-none","transition-colors","duration-100",3,"width","height","left","top","backgroundColor","ngClass"],[1,"fixed","inset-0","bg-black/70","flex","justify-center","items-center","z-[100]"],[1,"md:hidden","fixed","inset-0","bg-black/50","z-30",3,"click"],[1,"p-2","border-2","rounded-md","cursor-pointer","mb-1","flex","justify-between","items-center","transition","duration-200","ease-in-out","hover:bg-gray-200",3,"click","ngClass"],[1,"text-sm","text-gray-600"],[1,"absolute","border","border-black/20","box-border","flex","flex-col","items-center","justify-center","text-xs","select-none","transition-colors","duration-100",3,"click","ngClass"],[1,"text-base","font-bold","text-gray-800/80"],[1,"text-blue-900/30","text-lg"],[1,"font-bold","text-white/70","text-[0.6rem]"],[1,"font-bold","text-[0.6rem]","animate-pulse",3,"color"],[1,"font-bold","text-center","leading-tight","text-[0.6rem]"],[1,"text-[0.5rem]","text-white","bg-black/40","px-0.5","rounded-sm"],[1,"font-bold","text-[0.6rem]","animate-pulse"],[1,"fixed","inset-0","bg-black/70","flex","justify-center","items-center","z-[100]",3,"click"],[1,"bg-white","p-5","rounded-lg","shadow-xl","w-11/12","max-w-3xl","max-h-[85vh]","relative","flex","flex-col",3,"click"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-2xl","font-bold","text-gray-800"],[1,"bg-transparent","border-none","text-3xl","cursor-pointer","text-gray-500","hover:text-black","transition",3,"click"],[1,"grid","grid-cols-2","sm:grid-cols-3","md:grid-cols-4","lg:grid-cols-5","gap-3","overflow-y-auto","p-2","border","border-gray-200","min-h-[200px]","rounded-md","bg-gray-50"],[1,"border","border-gray-300","rounded-lg","p-2","text-center","bg-white","flex","flex-col","items-center","justify-between","hover:shadow-md","transition","duration-150"],[1,"col-span-full","text-center","p-8","text-gray-400"],[1,"w-8","h-8","rounded-full","flex","justify-center","items-center","text-sm","font-bold","text-white","mb-1","shadow-inner"],[1,"text-[0.65rem]","font-semibold","mb-0.5","break-words","w-full","leading-tight"],[1,"text-xs","text-gray-500"]],template:function(t,i){if(t&1){let n=D();a(0,"div",1)(1,"button",2),v("click",function(){return u(n),g(i.toggleMobileSidebar())}),G(),a(2,"svg",3),N(3,"path",4),l()(),E(4,ge,1,0,"div",5),q(),a(5,"div",6)(6,"button",7),v("click",function(){return u(n),g(i.toggleMobileSidebar())}),p(7,"\xD7"),l(),a(8,"h1",8),p(9,"N\xF4ng Tr\u1EA1i H\xF2n \u0110\u1EA3o"),l(),a(10,"div",9)(11,"h2",10),p(12,"Tr\u1EA1ng Th\xE1i"),l(),a(13,"div",11),p(14,"Ti\u1EC1n: "),a(15,"span",12),p(16),l()(),a(17,"div",11),p(18,"C\u1EA5p \u0111\u1ED9: "),a(19,"span",12),p(20),l()(),a(21,"div",11),p(22,"Kinh nghi\u1EC7m: "),a(23,"span",12),p(24),l()()(),a(25,"div",9)(26,"h2",10),p(27,"C\xF4ng C\u1EE5 (H, P, D, C)"),l(),a(28,"div",13)(29,"button",14),v("click",function(){return u(n),i.selectedTool.set("harvest"),g(i.isMobileSidebarOpen.set(!1))}),p(30,"Thu Ho\u1EA1ch (H)"),l(),a(31,"button",14),v("click",function(){return u(n),i.selectedTool.set("plant"),g(i.isMobileSidebarOpen.set(!1))}),p(32,"Tr\u1ED3ng C\xE2y (P)"),l(),a(33,"button",14),v("click",function(){return u(n),i.selectedTool.set("place_soil"),g(i.isMobileSidebarOpen.set(!1))}),p(34),l(),a(35,"button",14),v("click",function(){return u(n),i.selectedTool.set("place_pen"),g(i.isMobileSidebarOpen.set(!1))}),p(36),l()()(),a(37,"div",9)(38,"h2",10),p(39,"Ch\u1ECDn H\u1EA1t Gi\u1ED1ng (1-5)"),l(),X(40,fe,5,9,"div",15,L),l(),a(42,"div",16)(43,"button",17),v("click",function(){return u(n),g(i.zoomIn())}),p(44,"+"),l(),a(45,"span",18),p(46),W(47,"number"),l(),a(48,"button",17),v("click",function(){return u(n),g(i.zoomOut())}),p(49,"-"),l()(),a(50,"button",19),v("click",function(){return u(n),g(i.toggleInventoryDialog())}),p(51,"M\u1EDF T\xFAi \u0110\u1ED3 (I)"),l(),a(52,"div",20),p(53),l()(),a(54,"div",21,0),v("wheel",function(r){return u(n),g(i.handleWheel(r))})("mousedown",function(r){return u(n),g(i.onMouseDown(r))})("touchstart",function(r){return u(n),g(i.handleTouchStart(r))})("touchmove",function(r){return u(n),g(i.handleTouchMove(r))})("touchend",function(r){return u(n),g(i.handleTouchEnd(r))})("touchcancel",function(r){return u(n),g(i.handleTouchEnd(r))}),a(56,"div",22),X(57,xe,4,20,"div",23,i.trackTileById,!0),l()(),E(59,Pe,11,1,"div",24),l()}t&2&&(d(4),P(i.isMobileSidebarOpen()?4:-1),d(),k("ngClass",I(24,de,i.isMobileSidebarOpen(),!i.isMobileSidebarOpen())),d(11),V(i.money()),d(4),V(i.playerLevel()),d(4),B("",i.playerXP()," / ",i.playerLevel()*20),d(5),k("ngClass",I(27,$,i.selectedTool()==="harvest",i.selectedTool()!=="harvest")),d(2),k("ngClass",I(30,$,i.selectedTool()==="plant",i.selectedTool()!=="plant")),d(2),k("ngClass",I(33,$,i.selectedTool()==="place_soil",i.selectedTool()!=="place_soil")),d(),T("\u0110\u1EB7t \u0110\u1EA5t (",i.inventory().soil||0,") (D)"),d(),k("ngClass",I(36,$,i.selectedTool()==="place_pen",i.selectedTool()!=="place_pen")),d(),T("\u0110\u1EB7t Chu\u1ED3ng (",i.inventory().pen||0,") (C)"),d(4),Y(i.crops),d(6),T("",te(47,21,i.zoomLevel(),"1.1-1"),"x"),d(7),T(" ",i.lastHarvestInfo," "),d(3),M("width",i.cols*i.baseTileSize,"px")("height",i.rows*i.baseTileSize,"px")("transform",i.mapTransform()),d(),Y(i.visibleTiles()),d(2),P(i.showInventoryDialog?59:-1))},dependencies:[re,ie,ne,oe],encapsulation:2,changeDetection:0})};export{ae as FarmComponent};
