import './polyfills.server.mjs';
import{a as Se}from"./chunk-J2EQBBPW.mjs";import{a as _e}from"./chunk-CDJMZZQA.mjs";import{a as ge,b as fe}from"./chunk-PDYHWB5Z.mjs";import{a as ue}from"./chunk-VXCLTWVW.mjs";import{a as pe,b as me}from"./chunk-DLEZTIB3.mjs";import{a as he}from"./chunk-JRWAQFBT.mjs";import{a as Gt,b as Qt,c as Jt,d as Kt,e as st,f as Xt,g as Yt,h as Zt,i as te,j as ee,k as ie,l as oe,m as ne,n as ae,o as re,p as se,q as le,r as ce,s as de,t as St}from"./chunk-YZOSTII4.mjs";import{c as Nt,d as Ot,f as Rt,h as jt}from"./chunk-T5W7XGYF.mjs";import{a as Vt,b as zt,c as Pt}from"./chunk-JCYXPMSG.mjs";import{b as Wt}from"./chunk-6I3EK2W2.mjs";import{a as qt}from"./chunk-U4C5JQFR.mjs";import{a as At}from"./chunk-RCOFY3Z4.mjs";import{a as Dt}from"./chunk-73IBRO6I.mjs";import{b as T}from"./chunk-5BGV5II6.mjs";import{a as Tt}from"./chunk-ZPDI4CY6.mjs";import{a as y}from"./chunk-7TFSUZVW.mjs";import{a as G}from"./chunk-JBY2G2QH.mjs";import{b as It,d as $}from"./chunk-5AGSEX5U.mjs";import{a as Bt,b as K,c as X,d as Y}from"./chunk-I6U7O55W.mjs";import{a as $t,b as Ut,f as ot,g as nt,i as at,j as rt}from"./chunk-MOJJCF5U.mjs";import{b as Z,g as tt,j as et,n as it}from"./chunk-O7ETER24.mjs";import{a as Q,b as J}from"./chunk-ZYDV2UQJ.mjs";import{a as U,d as W,f as q}from"./chunk-I77QNQJW.mjs";import{q as Ft}from"./chunk-PWB5C3IB.mjs";import{n as Mt,u as Ht,y as Lt}from"./chunk-3262HF7H.mjs";import{Ac as M,Bc as c,Cc as H,Db as P,Dc as x,Fc as bt,Ga as yt,Gc as L,Hc as I,Ic as D,Jb as b,Lc as F,Na as w,Pc as gt,Rc as ft,Sc as _t,Vb as _,Zb as wt,_b as B,ac as vt,bc as ht,cc as ut,dc as a,ec as l,fa as Ct,fc as N,gc as xt,hc as Et,jc as v,ka as z,la as C,nc as f,oc as m,od as kt,qb as d,ua as h,uc as O,va as u,vc as R,wc as j}from"./chunk-UMNV2BXK.mjs";import{a as k,b as V,h as mt,j as g}from"./chunk-RIAI3ORJ.mjs";var lt=class s{constructor(i,t,e,o){this._StorageService=i;this.router=t;this._ErrorLogService=e;this._sharedSocketService=o;this.socket=this._sharedSocketService.getSocket(),this.listenHoadonchitietUpdates()}socket;_snackBar=C(T);ListHoadonchitiet=w([]);DetailHoadonchitiet=w({});page=w(1);pageCount=w(1);total=w(0);pageSize=w(10);hoadonchitietId=w(null);fetchData(i){return g(this,null,function*(){let t=`https://hoadondientu.gdt.gov.vn:30000/query/invoices/detail?nbmst=${i.nbmst}&khhdon=${i.khhdon}&shdon=${i.shdon}&khmshdon=${i.khmshdon}`;try{let e={headers:{Authorization:`Bearer ${i.token}`}},o=yield fetch(t,e);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return yield o.json()}catch(e){return this._ErrorLogService.logError("Failed to CreateHoadon",e),console.error(e)}})}initDB(){return g(this,null,function*(){return yield Dt("HoadonchitietDB",4,{upgrade(i,t){t<1&&i.createObjectStore("hoadonchitiets",{keyPath:"id"}),t<3&&(i.objectStoreNames.contains("hoadonchitiets")&&i.deleteObjectStore("hoadonchitiets"),i.objectStoreNames.contains("pagination")&&i.deleteObjectStore("pagination"),i.createObjectStore("hoadonchitiets",{keyPath:"id"})),t<4}})})}saveHoadonchitiets(i,t){return g(this,null,function*(){let o=(yield this.initDB()).transaction("hoadonchitiets","readwrite"),r=o.objectStore("hoadonchitiets");yield r.clear(),yield r.put({id:"data",hoadonchitiets:i,pagination:t}),yield o.done})}getCachedData(){return g(this,null,function*(){let t=yield(yield this.initDB()).get("hoadonchitiets","data");return t&&t.hoadonchitiets?{hoadonchitiets:t.hoadonchitiets,pagination:t.pagination||{page:1,pageCount:1,total:t.hoadonchitiets.length,pageSize:10}}:{hoadonchitiets:[],pagination:{page:1,pageCount:1,total:0,pageSize:10}}})}setHoadonchitietId(i){this.hoadonchitietId.set(i)}CreateHoadonchitiet(i){return g(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(i)},e=yield fetch(`${y.APIURL}/hoadonchitiet`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let o=yield e.json();this.getAllHoadonchitiet(this.pageSize()),this.hoadonchitietId.set(o.id)}catch(t){this._ErrorLogService.logError("Failed to CreateHoadonchitiet",t),console.error(t)}})}getAllHoadonchitiet(){return g(this,arguments,function*(i=this.pageSize(),t=!1){this.pageSize.set(i);let e=yield this.getCachedData(),o=this._StorageService.getItem("hoadonchitiets_updatedAt")||"0";if(!t&&e.hoadonchitiets.length>0&&Date.now()-new Date(o).getTime()<5*60*1e3)return this.ListHoadonchitiet.set(e.hoadonchitiets),this.page.set(e.pagination.page),this.pageCount.set(e.pagination.pageCount),this.total.set(e.pagination.total),this.pageSize.set(e.pagination.pageSize),e.hoadonchitiets;try{let r={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}};if(!t){let E=yield fetch(`${y.APIURL}/hoadonchitiet/lastupdated`,r);if(!E.ok)return this.handleError(E.status),this.ListHoadonchitiet.set(e.hoadonchitiets),this.page.set(e.pagination.page),this.pageCount.set(e.pagination.pageCount),this.total.set(e.pagination.total),this.pageSize.set(e.pagination.pageSize),e.hoadonchitiets;let{updatedAt:pt}=yield E.json();if(pt<=o)return this.ListHoadonchitiet.set(e.hoadonchitiets),this.page.set(e.pagination.page),this.pageCount.set(e.pagination.pageCount),this.total.set(e.pagination.total),this.pageSize.set(e.pagination.pageSize),e.hoadonchitiets}let n=new URLSearchParams({page:this.page().toString(),limit:i.toString()}),p=yield fetch(`${y.APIURL}/hoadonchitiet?${n}`,r);if(!p.ok)return this.handleError(p.status),this.ListHoadonchitiet.set(e.hoadonchitiets),this.page.set(e.pagination.page),this.pageCount.set(e.pagination.pageCount),this.total.set(e.pagination.total),this.pageSize.set(e.pagination.pageSize),e.hoadonchitiets;let S=yield p.json();if(yield this.saveHoadonchitiets(S.data,{page:S.page||1,pageCount:S.pageCount||1,total:S.total||S.data.length,pageSize:i}),t)this._StorageService.setItem("hoadonchitiets_updatedAt",new Date().toISOString());else{let E=yield fetch(`${y.APIURL}/hoadonchitiet/lastupdated`,r),{updatedAt:pt}=yield E.json();this._StorageService.setItem("hoadonchitiets_updatedAt",pt)}return this.ListHoadonchitiet.set(S.data),this.page.set(S.page||1),this.pageCount.set(S.pageCount||1),this.total.set(S.total||S.data.length),this.pageSize.set(i),S.data}catch(r){return this._ErrorLogService.logError("Failed to getAllHoadonchitiet",r),console.error(r),this.ListHoadonchitiet.set(e.hoadonchitiets),this.page.set(e.pagination.page),this.pageCount.set(e.pagination.pageCount),this.total.set(e.pagination.total),this.pageSize.set(e.pagination.pageSize),e.hoadonchitiets}})}getUpdatedCodeIds(){return g(this,null,function*(){try{let i={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},t=yield fetch(`${y.APIURL}/hoadonchitiet/updateCodeIds`,i);t.ok||this.handleError(t.status);let e=yield t.json();return this.getAllHoadonchitiet(this.pageSize()),e.data}catch(i){this._ErrorLogService.logError("Failed to getUpdatedCodeIds",i),console.error(i)}})}listenHoadonchitietUpdates(){this.socket.off("hoadonchitiet-updated"),this.socket.on("hoadonchitiet-updated",()=>g(this,null,function*(){console.log("\u{1F504} D\u1EEF li\u1EC7u s\u1EA3n ph\u1EA9m thay \u0111\u1ED5i, c\u1EADp nh\u1EADt l\u1EA1i cache..."),this._StorageService.removeItem("hoadonchitiets_updatedAt"),yield this.getAllHoadonchitiet()}))}getHoadonchitietBy(e){return g(this,arguments,function*(i,t=this.pageSize()){this.pageSize.set(t);try{let o={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(V(k({},i),{page:this.page(),limit:t}))},r=yield fetch(`${y.APIURL}/hoadonchitiet/findby`,o);r.ok||this.handleError(r.status);let n=yield r.json();i.isOne===!0?this.DetailHoadonchitiet.set(n):(yield this.saveHoadonchitiets(n.data,{page:n.page||1,pageCount:n.pageCount||1,total:n.total||n.data.length,pageSize:t}),this._StorageService.setItem("hoadonchitiets_updatedAt",new Date().toISOString()),this.ListHoadonchitiet.set(n.data),this.page.set(n.page||1),this.pageCount.set(n.pageCount||1),this.total.set(n.total||n.data.length),this.pageSize.set(t))}catch(o){this._ErrorLogService.logError("Failed to getHoadonchitietBy",o),console.error(o);let r=yield this.getCachedData();i.isOne||(this.ListHoadonchitiet.set(r.hoadonchitiets),this.page.set(r.pagination.page),this.pageCount.set(r.pagination.pageCount),this.total.set(r.pagination.total),this.pageSize.set(r.pagination.pageSize))}})}updateHoadonchitiet(i){return g(this,null,function*(){try{let t={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(i)},e=yield fetch(`${y.APIURL}/hoadonchitiet/${i.id}`,t);e.ok||this.handleError(e.status);let o=yield e.json();this.getAllHoadonchitiet(this.pageSize()),this.getHoadonchitietBy({id:o.id,isOne:!0},this.pageSize())}catch(t){this._ErrorLogService.logError("Failed to updateHoadonchitiet",t),console.error(t)}})}DeleteHoadonchitiet(i){return g(this,null,function*(){try{let t={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},e=yield fetch(`${y.APIURL}/hoadonchitiet/${i.id}`,t);e.ok||this.handleError(e.status),this.getAllHoadonchitiet(this.pageSize())}catch(t){this._ErrorLogService.logError("Failed to DeleteHoadonchitiet",t),console.error(t)}})}handleError(i){let t="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(i){case 400:t="Th\xF4ng tin \u0111\xE3 t\u1ED3n t\u1EA1i";break;case 401:case 404:t="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:t="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:t="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}this._snackBar.open(t,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}static \u0275fac=function(t){return new(t||s)(z(G),z($),z(At),z(_e))};static \u0275prov=Ct({token:s,factory:s.\u0275fac,providedIn:"root"})};var He=()=>({standalone:!0}),ct=class s{pageSize=10;page=1;total=1;pageCount=1;emitChange=new yt;_snackBar=C(T);onPageSizeChange(i,t){i>this.total&&(this._snackBar.open(`S\u1ED1 l\u01B0\u1EE3ng t\u1ED1i \u0111a ${this.total}`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),i=this.total),this.emitChange.emit({page:1,pageSize:i}),t.closeMenu()}onPreviousPage(){this.page>1&&this.emitChange.emit({page:this.page-1,pageSize:this.pageSize})}onNextPage(){this.page<this.pageCount&&this.emitChange.emit({page:this.page+1,pageSize:this.pageSize})}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=P({type:s,selectors:[["app-sharepagination"]],inputs:{pageSize:"pageSize",page:"page",total:"total",pageCount:"pageCount"},outputs:{emitChange:"emitChange"},decls:30,vars:12,consts:[["menuHienthi","matMenuTrigger"],["menu1","matMenu"],[1,"cursor-pointer","border","rounded-lg","px-3","p-1","flex","flex-row","space-x-2","items-center","justify-between"],[1,"w-full","flex","lg:p-0","p-2","lg:flex-row","lg:space-x-2","lg:items-center","lg:justify-between","flex-col","justify-center"],[1,"w-full","text-center"],[1,"w-full","flex","flex-row","space-x-2","items-center","lg:justify-end","justify-center"],[1,"font-bold","text-blue-600",3,"matMenuTriggerFor"],[1,"w-full","flex","flex-col","space-y-2","p-4",3,"click"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp S\u1ED1 L\u01B0\u1EE3ng",3,"ngModelChange","ngModel","ngModelOptions"],["mat-flat-button","","color","primary",3,"click"],[1,"pagination-controls"],["mat-icon-button","","color","primary",3,"click","disabled"]],template:function(t,e){if(t&1){let o=v();a(0,"div",2)(1,"div",3)(2,"span",4),c(3,"\u0110ang Xem "),a(4,"strong"),c(5),l(),c(6," - "),a(7,"strong"),c(8),l(),c(9),l(),a(10,"div",5)(11,"span",6,0),c(13),l(),a(14,"mat-menu",null,1)(16,"div",7),f("click",function(n){return h(o),u(n.stopPropagation())}),a(17,"span"),c(18,"S\u1ED1 L\u01B0\u1EE3ng"),l(),a(19,"mat-form-field",8)(20,"input",9),D("ngModelChange",function(n){return h(o),I(e.pageSize,n)||(e.pageSize=n),u(n)}),l()(),a(21,"button",10),f("click",function(){h(o);let n=M(12);return u(e.onPageSizeChange(e.pageSize,n))}),c(22,"\xC1p D\u1EE5ng"),l()()(),a(23,"div",11)(24,"button",12),f("click",function(){return h(o),u(e.onPreviousPage())}),a(25,"mat-icon"),c(26,"keyboard_arrow_left"),l()(),a(27,"button",12),f("click",function(){return h(o),u(e.onNextPage())}),a(28,"mat-icon"),c(29,"keyboard_arrow_right"),l()()()()()()}if(t&2){let o=M(15);d(5),H((e.page-1)*e.pageSize+1),d(3),H(e.page*e.pageSize>e.total?e.total:e.page*e.pageSize),d(),bt(" trong s\u1ED1 ",e.total," m\u1EE5c, ",e.page,"/",e.pageCount," Trang"),d(2),_("matMenuTriggerFor",o),d(2),x("Hi\u1EC7n Th\u1ECB : ",e.pageSize," m\u1EE5c"),d(7),L("ngModel",e.pageSize),_("ngModelOptions",F(11,He)),d(4),_("disabled",e.page===1),d(3),_("disabled",e.page===e.pageCount)}},dependencies:[Y,K,X,J,Q,nt,ot,q,W,U,rt,at,it,Z,tt,et],encapsulation:2,changeDetection:0})};var Le=["drawer"],dt=()=>({standalone:!0}),Ie=(s,i)=>i.key;function De(s,i){if(s&1){let t=v();a(0,"button",41),f("click",function(){h(t);let o=m(),r=M(68);return u(o.openDeleteDialog(r))}),a(1,"mat-icon"),c(2,"delete"),l(),a(3,"span",16),c(4,"Xo\xE1"),l()()}}function Fe(s,i){if(s&1){let t=v();a(0,"button",42),f("click",function(o){let r=h(t).$implicit;return m().toggleColumn(r),u(o.stopPropagation())}),a(1,"mat-icon"),c(2),l(),a(3,"span"),c(4),l()()}if(s&2){let t=i.$implicit;d(2),H(t.isShow?"check_box":"check_box_outline_blank"),d(2),H(t.value)}}function Te(s,i){if(s&1&&(a(0,"th",43)(1,"span"),c(2),l()()),s&2){let t=m(2).$implicit,e=m();d(2),H(e.ColumnName[t])}}function Ae(s,i){s&1&&b(0,Te,3,1,"th",46)}function Ve(s,i){if(s&1){let t=v();a(0,"th",44)(1,"span",48),c(2),l(),a(3,"app-searchfilter",49),f("OutFilter",function(o){h(t);let r=m(3);return u(r.onOutFilter(o))}),l()()}if(s&2){let t=m(2).$implicit,e=m();d(2),x(" ",e.ColumnName[t]," "),d(),_("icon","filter_alt")("ListItem",e.Listhoadonchitiet())("fieldsearch",t)("ListFilter",e.ListFilter)("filterItem",e.FilterHederColumn(e.dataSource.filteredData,t))}}function ze(s,i){s&1&&b(0,Ve,4,6,"th",47)}function Pe(s,i){if(s&1){let t=v();a(0,"span",54),f("click",function(){h(t);let o=m().$implicit,r=m(2);return u(r.goToDetail(o))}),c(1),l()}if(s&2){let t=m().$implicit,e=m().$implicit;d(),x(" ",t[e]," ")}}function Be(s,i){if(s&1&&(a(0,"span",52),c(1),l()),s&2){let t=m().index;d(),x(" ",t+1," ")}}function Ne(s,i){if(s&1&&(a(0,"span",53),c(1),gt(2,"date"),l()),s&2){let t=m().$implicit,e=m().$implicit;d(),x(" ",ft(2,1,t[e],"dd/MM/yyyy")," ")}}function Oe(s,i){if(s&1&&(a(0,"span",53),c(1),l()),s&2){let t=m().$implicit,e=m().$implicit;d(),x(" ",t[e],"% ")}}function Re(s,i){s&1&&(a(0,"mat-icon",55),c(1,"check_circle"),l())}function je(s,i){s&1&&(a(0,"mat-icon",56),c(1,"cancel"),l())}function $e(s,i){if(s&1&&(a(0,"span",53),b(1,Re,2,0,"mat-icon",55)(2,je,2,0,"mat-icon",56),l()),s&2){let t=m().$implicit,e=m().$implicit;d(),B(t[e]?1:2)}}function Ue(s,i){if(s&1&&(a(0,"span",53),c(1),gt(2,"date"),l()),s&2){let t=m().$implicit,e=m().$implicit;d(),x(" ",ft(2,1,t[e],"dd/MM/yyyy")," ")}}function We(s,i){if(s&1&&(a(0,"span",53),c(1),l()),s&2){let t=m().$implicit,e=m().$implicit;d(),x(" ",t[e]," ")}}function qe(s,i){if(s&1&&(a(0,"td",50),b(1,Pe,2,1,"span",51)(2,Be,2,1,"span",52)(3,Ne,3,4,"span",53)(4,Oe,2,1,"span",53)(5,$e,3,1,"span",53)(6,Ue,3,4,"span",53)(7,We,2,1,"span",53),l()),s&2){let t,e=m().$implicit;d(),B((t=e)==="codeId"?1:t==="stt"?2:t==="createdAt"?3:t==="haohut"?4:t==="isActive"?5:t==="updatedAt"?6:7)}}function Ge(s,i){if(s&1&&(xt(0,36),b(1,Ae,1,0,"th",43)(2,ze,1,0,"th",44)(3,qe,8,1,"td",45),Et()),s&2){let t=i.$implicit;_("matColumnDef",t),d(),B(t=="stt"?1:2)}}function Qe(s,i){s&1&&N(0,"tr",57)}function Je(s,i){if(s&1){let t=v();a(0,"tr",58),f("click",function(){let o=h(t).$implicit,r=m();return u(r.AddToEdit(o))}),l()}if(s&2){let t=i.$implicit,e=m();wt("hover:bg-slate-50 ",e.CheckItemInEdit(t)?"!bg-blue-50":"","")}}function Ke(s,i){s&1&&(a(0,"tr",59)(1,"td",60),c(2,"Kh\xF4ng t\xECm th\u1EA5y"),l()())}function Xe(s,i){s&1&&(a(0,"mat-dialog-content")(1,"div",61)(2,"div",62),c(3,"X\xE1c Nh\u1EADn"),l(),a(4,"div"),c(5,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),l(),a(6,"div",63)(7,"button",64),c(8,"\u0110\u1ED3ng \xDD"),l(),a(9,"button",65),c(10,"Hu\u1EF7 B\u1ECF"),l()()()())}function Ye(s,i){if(s&1){let t=v();a(0,"mat-dialog-content",66)(1,"div",67)(2,"mat-form-field",20)(3,"mat-label"),c(4,"IdSheet"),l(),a(5,"input",68),D("ngModelChange",function(o){h(t);let r=m();return I(r.IdSheet,o)||(r.IdSheet=o),u(o)}),l()(),a(6,"mat-form-field",20)(7,"mat-label"),c(8,"SheetName"),l(),a(9,"input",69),D("ngModelChange",function(o){h(t);let r=m();return I(r.SheetName,o)||(r.SheetName=o),u(o)}),l()()(),N(10,"div",70),a(11,"div",71)(12,"button",64),c(13,"\u0110\u1ED3ng \xDD"),l(),a(14,"button",65),c(15,"Hu\u1EF7 B\u1ECF"),l()()()}if(s&2){let t=m();d(5),L("ngModel",t.IdSheet),_("ngModelOptions",F(4,dt)),d(4),L("ngModel",t.SheetName),_("ngModelOptions",F(5,dt))}}var A=class A{displayedColumns=[];ColumnName={stt:"#",ten:"T\xEAn S\u1EA3n Ph\u1EA9m",dvtinh:"\u0110\u01A1n V\u1ECB T\xEDnh",sluong:"S\u1ED1 L\u01B0\u1EE3ng",dgia:"\u0110\u01A1n Gi\xE1",thtien:"Th\xE0nh Ti\u1EC1n"};FilterColumns=JSON.parse(localStorage.getItem("HoadonchitietColFilter")||"[]");Columns=[];paginator;sort;drawer;_HoadonchitietService=C(lt);_HoadonService=C(Se);_breakpointObserver=C(Ft);_GoogleSheetService=C(he);_StorageService=C(G);_router=C($);_dialog=C(Nt);_snackBar=C(T);Listhoadonchitiet=this._HoadonchitietService.ListHoadonchitiet;page=this._HoadonchitietService.page;pageCount=this._HoadonchitietService.pageCount;total=this._HoadonchitietService.total;pageSize=this._HoadonchitietService.pageSize;hoadonchitietId=this._HoadonchitietService.hoadonchitietId;dataSource=new St([]);EditList=[];isSearch=w(!1);token=this._StorageService.getItem("token")||"";hoadon_token=this._StorageService.getItem("hoadon_token")||"";constructor(){kt(()=>{this.dataSource.data=this.Listhoadonchitiet(),this.dataSource.sort=this.sort,this.paginator&&(this.paginator.pageIndex=this.page()-1,this.paginator.pageSize=this.pageSize(),this.paginator.length=this.total())})}ngOnInit(){return g(this,null,function*(){this._HoadonchitietService.listenHoadonchitietUpdates(),yield this._HoadonchitietService.getAllHoadonchitiet(this.pageSize(),!0),this.displayedColumns=Object.keys(this.ColumnName),this.dataSource=new St(this.Listhoadonchitiet()),this.dataSource.sort=this.sort,this.initializeColumns(),this.setupDrawer()})}soluong=0;fetchData(){return g(this,null,function*(){this._StorageService.setItem("hoadon_token",this.hoadon_token);let i=yield this._HoadonService.getAllHoadon(this.soluong);for(let t of i){let e=yield this._HoadonchitietService.fetchData(k({token:this.hoadon_token},t));if(yield this.delay(1e3),e.message)this._snackBar.open(e.message,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});else if(e.hdhhdvu&&Array.isArray(e.hdhhdvu)){let o=e.hdhhdvu.map(n=>({id:n.id,idhdon:n.idhdon,dvtinh:n.dvtinh,ltsuat:n.ltsuat,sluong:n.sluong,dgia:n.dgia,stbchu:n.stbchu,stckhau:n.stckhau,stt:n.stt,tchat:n.tchat,ten:n.ten,thtcthue:n.thtcthue,thtien:n.thtien,tlckhau:n.tlckhau,tsuat:n.tsuat,tthue:n.tthue,sxep:n.sxep,dvtte:n.dvtte,tgia:n.tgia})),r=new Worker(new URL("worker-MGIFUOUW.js",import.meta.url),{type:"module"});r.postMessage({items:o,token:this.token}),r.onmessage=n=>{n.data.status==="success"?console.log("Created via worker:",n.data.item):n.data.status==="error"?console.error("Error via worker:",n.data.error,n.data.item):n.data.status==="done"&&(console.log("Worker completed processing items."),r.terminate())},r.onerror=n=>{console.error("Worker encountered an error:",n),r.terminate()}}}})}delay(i){return new Promise(t=>setTimeout(t,i))}onPageChange(i){return g(this,null,function*(){this._HoadonchitietService.page.set(i.page),yield this._HoadonchitietService.getAllHoadonchitiet(i.pageSize,!0)})}initializeColumns(){this.Columns=Object.entries(this.ColumnName).map(([i,t])=>({key:i,value:t,isShow:!0})),this.FilterColumns=this.FilterColumns.length?this.FilterColumns:this.Columns,localStorage.setItem("HoadonchitietColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(i=>i.isShow).map(i=>i.key),this.ColumnName=this.FilterColumns.reduce((i,{key:t,value:e,isShow:o})=>o?V(k({},i),{[t]:e}):i,{})}applyFilter(i){let t=i.target.value;this.dataSource.filter=t.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}getUpdatedCodeIds(){return g(this,null,function*(){yield this._HoadonchitietService.getUpdatedCodeIds()})}setupDrawer(){this._breakpointObserver.observe([Tt.Handset]).subscribe(i=>{i.matches?this.drawer.mode="over":this.drawer.mode="side"})}toggleColumn(i){let t=this.FilterColumns.find(e=>e.key===i.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}FilterHederColumn(i,t){return i.filter((o,r,n)=>r===n.findIndex(p=>p[t]===o[t]))}doFilterHederColumn(i,t){this.dataSource.filteredData=this.Listhoadonchitiet().filter(e=>e[t].toLowerCase().includes(i.target.value.toLowerCase()))}ListFilter=[];ChosenItem(i,t){let e=this.dataSource.filteredData.filter(r=>r[t]===i[t]);this.ListFilter.filter(r=>r[t]===i[t]).length>0?this.ListFilter=this.ListFilter.filter(r=>r[t]!==i[t]):this.ListFilter=[...this.ListFilter,...e]}ChosenAll(i){i.forEach(t=>{!!this.ListFilter.find(o=>o.id===t.id)?this.ListFilter=this.ListFilter.filter(o=>o.id!==t.id):this.ListFilter.push(t)})}ResetFilter(){this.ListFilter=this.Listhoadonchitiet()}EmptyFiter(){this.ListFilter=[]}CheckItem(i){return!!this.ListFilter.find(t=>t.id===i.id)}ApplyFilterColum(i){this.dataSource.data=this.Listhoadonchitiet().filter(t=>this.ListFilter.some(e=>e.id===t.id)),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,i.closeMenu()}onOutFilter(i){this.dataSource.data=i,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(i=>i.isShow).map(i=>i.key),this.ColumnName=this.FilterColumns.reduce((i,t)=>(t.isShow&&(i[t.key]=t.value),i),{}),localStorage.setItem("HoadonchitietColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(i){let t=i.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(e=>e.value.toLowerCase().includes(t))}create(){this.drawer.open(),this._router.navigate(["admin/hoadonchitiet","new"])}openDeleteDialog(i){this._dialog.open(i,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(e=>{e==="true"&&this.DeleteListItem()})}DeleteListItem(){this.EditList.forEach(i=>{this._HoadonchitietService.DeleteHoadonchitiet(i)}),this.EditList=[],this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}AddToEdit(i){this.EditList.find(e=>e.id===i.id)?this.EditList=this.EditList.filter(e=>e.id!==i.id):this.EditList.push(i)}CheckItemInEdit(i){return this.EditList.some(t=>t.id===i.id)}goToDetail(i){this.drawer.open(),this._HoadonchitietService.setHoadonchitietId(i.id),this._router.navigate(["admin/hoadonchitiet",i.id])}OpenLoadDrive(i){this._dialog.open(i,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(e=>{})}IdSheet="15npo25qyH5FmfcEjl1uyqqyFMS_vdFnmxM_kt0KYmZk";SheetName="SPImport";ImportIteam=[];ImportColumnName={};ImportdisplayedColumns=[];LoadDrive(){return g(this,null,function*(){let i={IdSheet:this.IdSheet,SheetName:this.SheetName,ApiKey:y.GSApiKey},t=yield this._GoogleSheetService.getDrive(i);this.ImportIteam=qt(t.values),this.ImportColumnName=Object.fromEntries(t.values[0].map((e,o)=>[e,t.values[1][o]])),this.ImportdisplayedColumns=t.values[0]})}DoImportData(i){return g(this,null,function*(){let t=i.map(p=>({title:p.title?.trim()||"",masp:p.masp?.trim()||"",giagoc:Number(p.giagoc)||0,dvt:p.dvt?.trim()||"",soluong:Number(p.soluong)||0,soluongkho:Number(p.soluongkho)||0,haohut:Number(p.haohut)||0,ghichu:p.ghichu?.trim()||""})),e=Array.from(new Map(t.map(p=>[p.masp,p])).values()),o=this._HoadonchitietService.ListHoadonchitiet(),r=o.map(p=>p.masp),n=e.map(p=>p.masp).filter(p=>!r.includes(p));yield Promise.all(e.map(p=>g(this,null,function*(){let S=o.find(E=>E.masp===p.masp);if(S){let E=k(k({},S),p);yield this._HoadonchitietService.updateHoadonchitiet(E)}else yield this._HoadonchitietService.CreateHoadonchitiet(p)}))),yield Promise.all(o.filter(p=>!e.some(S=>S.masp===p.masp)).map(p=>this._HoadonchitietService.updateHoadonchitiet(V(k({},p),{isActive:!1})))),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ImporExcel(i){return g(this,null,function*(){let t=yield me(i);this.DoImportData(t)})}ExportExcel(i,t){let e=i.map(o=>({title:o.title,masp:o.masp,giagoc:o.giagoc,dvt:o.dvt,soluong:o.soluong,soluongkho:o.soluongkho,haohut:o.haohut,ghichu:o.ghichu}));pe(e,t)}trackByFn(i,t){return t.id}onPageSizeChange(i,t){i>this.total()&&(this._snackBar.open(`S\u1ED1 l\u01B0\u1EE3ng t\u1ED1i \u0111a ${this.total()}`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),i=this.total()),this._HoadonchitietService.page.set(1),this._HoadonchitietService.getAllHoadonchitiet(i,!0),t.closeMenu()}onPreviousPage(){this.page()>1&&(this._HoadonchitietService.page.set(this.page()-1),this._HoadonchitietService.getAllHoadonchitiet(this.pageSize(),!0))}onNextPage(){this.page()<this.pageCount()&&(this._HoadonchitietService.page.set(this.page()+1),this._HoadonchitietService.getAllHoadonchitiet(this.pageSize(),!0))}static \u0275fac=function(t){return new(t||A)};static \u0275cmp=P({type:A,selectors:[["app-listhoadonchitiet"]],viewQuery:function(t,e){if(t&1&&(O(Jt,5),O(st,5),O(Le,7)),t&2){let o;R(o=j())&&(e.paginator=o.first),R(o=j())&&(e.sort=o.first),R(o=j())&&(e.drawer=o.first)}},decls:71,vars:17,consts:[["drawer",""],["menu","matMenu"],["uploadfile",""],["DeleteDialog",""],["LoadDriveDialog",""],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","lg:!w-1/2","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-16","w-full","p-2"],[1,"p-4","cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","bg-white","rounded-lg"],[1,"w-full","flex","flex-col","gap-2","lg:flex-row","lg:items-center","lg:justify-between"],[1,"flex","flex-row","space-x-2","items-center"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],["color","primary","matTooltip","Th\xEAm m\u1EDBi","mat-flat-button","",1,"flex","flex-row","items-center",3,"click"],[1,"whitespace-nowrap"],["class","flex flex-row items-center","color","warn","matTooltip","Xo\xE1","mat-flat-button","",3,"click",4,"ngIf"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["matTooltip","T\u1EA3i file excel M\u1EABu","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\u1EA3i l\xEAn file excel","color","primary","mat-icon-button","",3,"click"],["type","file",1,"hidden",3,"change"],["matTooltip","T\u1EA3i d\u1EEF li\u1EC7u t\u1EEB drive","color","primary","mat-icon-button","",3,"click"],["mat-icon-button","","color","primary","matTooltip","C\u1EADp Nh\u1EADt L\u1EA1i Code",3,"click"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp Token",3,"ngModelChange","ngModel","ngModelOptions"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp S\u1ED1 L\u01B0\u1EE3ng",3,"ngModelChange","ngModel","ngModelOptions"],["color","primary","matTooltip","L\u1EA5y d\u1EEF li\u1EC7u","mat-flat-button","",1,"flex","flex-row","items-center","whitespace-nowrap",3,"click"],[1,"w-full","h-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["class","border","mat-row","",3,"class","click",4,"matRowDef","matRowDefColumns"],["class","mat-row border",4,"matNoDataRow"],[3,"emitChange","pageSize","page","total","pageCount"],["color","warn","matTooltip","Xo\xE1","mat-flat-button","",1,"flex","flex-row","items-center",3,"click"],["mat-menu-item","",3,"click"],["mat-header-cell","",1,"!border","!bg-slate-100"],["mat-header-cell","","mat-sort-header","",1,"!border","whitespace-nowrap","!bg-slate-100"],["class","border","mat-cell","",4,"matCellDef"],["class","!border !bg-slate-100","mat-header-cell","",4,"matHeaderCellDef"],["class","!border whitespace-nowrap !bg-slate-100","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],[1,"max-w-40","line-clamp-4","me-4"],[3,"OutFilter","icon","ListItem","fieldsearch","ListFilter","filterItem"],["mat-cell","",1,"border"],[1,"max-w-40","line-clamp-4","font-bold","text-blue-600"],[1,""],[1,"max-w-40","line-clamp-4"],[1,"max-w-40","line-clamp-4","font-bold","text-blue-600",3,"click"],[1,"text-green-500"],[1,"text-red-500"],["mat-header-row",""],["mat-row","",1,"border",3,"click"],[1,"mat-row","border"],["colspan","4",1,"mat-cell","p-4"],[1,"flex","flex-col","space-y-8","items-center","justify-center"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary","mat-dialog-close","true"],["mat-flat-button","","color","warn","mat-dialog-close","false"],[1,"!w-screen","!h-screen","!max-h-screen","!relative","!flex","flex-col","space-y-8","items-center","justify-center"],[1,"relative","flex","flex-row","space-x-2","items-center"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp IdSheet",3,"ngModelChange","ngModel","ngModelOptions"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp SheetName",3,"ngModelChange","ngModel","ngModelOptions"],[1,"relative","h-full","w-full","overflow-auto"],[1,"relative","flex","flex-row","space-x-2","items-center","justify-center"]],template:function(t,e){if(t&1){let o=v();a(0,"mat-drawer-container",5)(1,"mat-drawer",6,0),N(3,"router-outlet"),l(),a(4,"div",7)(5,"div",8)(6,"div",9)(7,"div",10)(8,"div",11)(9,"input",12),f("keyup",function(n){return h(o),u(e.applyFilter(n))}),l(),a(10,"div",13)(11,"span",14),c(12,"search"),l()()(),a(13,"button",15),f("click",function(){return h(o),u(e.create())}),a(14,"mat-icon"),c(15,"add_circle"),l(),a(16,"span",16),c(17,"T\u1EA1o M\u1EDBi"),l()(),b(18,De,5,0,"button",17),l(),a(19,"div",10)(20,"button",18)(21,"mat-icon"),c(22,"tune"),l()(),a(23,"mat-menu",null,1)(25,"div",19)(26,"mat-form-field",20)(27,"input",21),f("input",function(n){return h(o),u(e.doFilterColumns(n))})("click",function(n){return h(o),u(n.stopPropagation())}),l(),a(28,"mat-icon",22),c(29,"search"),l()()(),a(30,"div",23),ht(31,Fe,5,2,"button",24,Ie),l()(),a(33,"button",25),f("click",function(){return h(o),u(e.ExportExcel(e.Listhoadonchitiet(),"hoadonchitiet"))}),a(34,"mat-icon"),c(35,"file_download"),l()(),a(36,"button",26),f("click",function(){h(o);let n=M(40);return u(n.click())}),a(37,"mat-icon"),c(38,"file_upload"),l()(),a(39,"input",27,2),f("change",function(n){return h(o),u(e.ImporExcel(n))}),l(),a(41,"button",28),f("click",function(){h(o);let n=M(70);return u(e.OpenLoadDrive(n))}),a(42,"mat-icon"),c(43,"cloud_download"),l()(),a(44,"button",29),f("click",function(){return h(o),u(e.getUpdatedCodeIds())}),a(45,"mat-icon"),c(46,"cached"),l()()()()(),a(47,"div",10)(48,"mat-form-field",30)(49,"mat-label"),c(50,"Token"),l(),a(51,"input",31),D("ngModelChange",function(n){return h(o),I(e.token,n)||(e.token=n),u(n)}),l()(),a(52,"mat-form-field",30)(53,"mat-label"),c(54,"S\u1ED1 L\u01B0\u1EE3ng"),l(),a(55,"input",32),D("ngModelChange",function(n){return h(o),I(e.soluong,n)||(e.soluong=n),u(n)}),l()(),a(56,"button",33),f("click",function(){return h(o),u(e.fetchData())}),a(57,"span",16),c(58,"L\u1EA5y D\u1EEF Li\u1EC7u"),l()()(),a(59,"div",34)(60,"table",35),ht(61,Ge,4,2,"ng-container",36,vt),b(63,Qe,1,0,"tr",37)(64,Je,1,3,"tr",38)(65,Ke,3,0,"tr",39),l()(),a(66,"app-sharepagination",40),f("emitChange",function(n){return h(o),u(e.onPageChange(n))}),l()()(),b(67,Xe,11,0,"ng-template",null,3,_t)(69,Ye,16,6,"ng-template",null,4,_t)}if(t&2){let o=M(24);d(),_("position","end"),d(17),_("ngIf",e.EditList.length>0),d(2),_("matMenuTriggerFor",o),d(11),ut(e.FilterColumns),d(20),L("ngModel",e.token),_("ngModelOptions",F(15,dt)),d(4),L("ngModel",e.soluong),_("ngModelOptions",F(16,dt)),d(5),_("dataSource",e.dataSource),d(),ut(e.displayedColumns),d(2),_("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),d(),_("matRowDefColumns",e.displayedColumns),d(2),_("pageSize",e.pageSize())("page",e.page())("total",e.total())("pageCount",e.pageCount())}},dependencies:[nt,ot,$t,Ut,rt,at,de,Zt,ee,ae,ie,te,re,oe,ne,se,le,ce,Yt,st,Xt,Kt,Y,K,Bt,X,Pt,Vt,zt,It,J,Q,q,W,U,Wt,Lt,Mt,Ht,it,Z,tt,et,Qt,Gt,jt,Ot,Rt,ue,ct],encapsulation:2,changeDetection:0})};mt([ge()],A.prototype,"FilterHederColumn",1),mt([fe(300)],A.prototype,"doFilterHederColumn",1);var ye=A;export{lt as a,ye as b};
