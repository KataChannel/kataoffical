import{m as re}from"./chunk-6ZJGR7X4.js";import{i as ie,k as M,m as oe,r as w}from"./chunk-Y5KLSAKG.js";import{Bc as D,Cc as x,D as R,Ec as U,Fc as q,Lb as I,Mb as G,Ob as T,Pb as v,Qb as C,Rb as m,Sb as a,Tb as s,Ub as k,Yb as O,ac as f,bc as _,eb as p,fa as Z,ka as ee,oc as A,pa as E,pc as l,qa as P,qb as h,rc as L,sc as ne,yb as te,yc as z,za as g}from"./chunk-TWMQPIMW.js";import"./chunk-EU2KAMEK.js";import{a as b,b as $}from"./chunk-47CWAPKR.js";var se={basic:{type:"basic",maxHp:50,speed:2,bounty:10},fast:{type:"fast",maxHp:30,speed:4,bounty:15}},ae={basic:{type:"basic",cost:50,range:100,damage:15,attackSpeed:30}},N=[{x:0,y:200},{x:150,y:200},{x:150,y:50},{x:400,y:50},{x:400,y:300},{x:600,y:300}],pe=[{position:{x:75,y:150}},{position:{x:250,y:100}},{position:{x:350,y:200}},{position:{x:500,y:250}}];var V=class i{money=g(100);lives=g(10);enemies=g([]);towers=g([]);buildSpots=g([]);gameStatus=g("waiting");path=N;enemyTypes=se;towerTypes=ae;gameTickInterval=30;gameSubscription=null;enemySpawnSubscription=null;nextEnemyId=0;nextTowerId=0;tickCount=0;constructor(){console.log("GameService initialized")}initializeGame(){console.log("Initializing game..."),this.money.set(100),this.lives.set(10),this.enemies.set([]),this.towers.set([]),this.gameStatus.set("waiting"),this.tickCount=0,this.nextEnemyId=0,this.nextTowerId=0;let t=pe.map((e,n)=>({id:n,position:e.position,occupiedBy:null}));this.buildSpots.set(t),console.log("Game initialized.")}startGame(){this.gameStatus()!=="playing"&&(this.gameStatus.set("playing"),console.log("Game started!"),this.startGameLoop(),this.startEnemySpawning())}stopGame(){this.gameStatus.set("gameOver"),this.stopGameLoop(),this.stopEnemySpawning(),console.log("Game stopped.")}startGameLoop(){this.gameSubscription&&this.gameSubscription.unsubscribe(),this.gameSubscription=R(this.gameTickInterval).subscribe(()=>{this.tickCount++,this.moveEnemies(),this.towersAttack(),this.checkGameStatus()}),console.log("Game loop started.")}stopGameLoop(){this.gameSubscription&&(this.gameSubscription.unsubscribe(),this.gameSubscription=null)}startEnemySpawning(){this.enemySpawnSubscription&&this.enemySpawnSubscription.unsubscribe();let t=0,e=10,n=2e3;this.enemySpawnSubscription=R(n).subscribe(()=>{t<e&&this.gameStatus()==="playing"?(this.spawnEnemy("basic"),t++,console.log(`Spawned enemy ${t}/${e}`)):t>=e&&(this.stopEnemySpawning(),console.log("Enemy spawning finished for this wave."))}),console.log("Enemy spawning started.")}stopEnemySpawning(){this.enemySpawnSubscription&&(this.enemySpawnSubscription.unsubscribe(),this.enemySpawnSubscription=null)}spawnEnemy(t){let e=this.enemyTypes[t];if(!e||this.path.length===0)return;let n=this.path[0],o=$(b({},e),{id:this.nextEnemyId++,hp:e.maxHp,pathProgress:0,position:b({},n)});this.enemies.update(r=>[...r,o])}moveEnemies(){this.enemies.update(t=>t.map(n=>{let o=b({},n),r=0,c=0;for(let y=0;y<this.path.length-1;y++){let ue=this.path[y],ge=this.path[y+1],Q=this.distance(ue,ge);if(o.pathProgress<c+Q){r=y+1;break}c+=Q,r=y+2}if(r>=this.path.length)return console.log(`Enemy ${o.id} reached the end.`),this.lives.update(y=>y-1),null;let d=this.path[r-1],S=this.path[r],u=this.distance(d,S),F=o.pathProgress-c+o.speed,de=c+F;o.pathProgress=de;let K=Math.min(1,F/u);return o.position={x:d.x+(S.x-d.x)*K,y:d.y+(S.y-d.y)*K},o}).filter(n=>n!==null))}towersAttack(){let t=this.enemies();this.towers().length===0||t.length===0||this.towers.update(e=>e.map(o=>{let r=b({},o);if(this.tickCount-r.lastFired>=r.attackSpeed){let c=this.enemies().find(d=>this.distance(r.position,d.position)<=r.range);c&&(console.log(`Tower ${r.id} attacking Enemy ${c.id}`),this.enemies.update(d=>d.map(u=>{if(u.id===c.id){let B=$(b({},u),{hp:u.hp-r.damage});return B.hp<=0?(console.log(`Enemy ${B.id} defeated!`),this.money.update(F=>F+B.bounty),null):B}return u}).filter(u=>u!==null)),r.lastFired=this.tickCount)}return r}))}buildTower(t,e){let n=this.buildSpots().find(r=>r.id===t),o=this.towerTypes[e];if(n&&n.occupiedBy===null&&o&&this.money()>=o.cost){this.money.update(c=>c-o.cost);let r=$(b({},o),{id:this.nextTowerId++,position:b({},n.position),lastFired:0});return this.towers.update(c=>[...c,r]),this.buildSpots.update(c=>{let d=[...c],S=d.find(u=>u.id===t);return S&&(S.occupiedBy=r.id),d}),console.log(`Built ${e} tower at spot ${t}. Money left: ${this.money()}`),!0}else console.log(`Could not build tower at spot ${t}. Reasons: Spot occupied? ${n?.occupiedBy!==null}, Enough money? ${this.money()>=(o?.cost||1/0)}`);return!1}checkGameStatus(){this.lives()<=0&&(this.gameStatus.set("gameOver"),this.stopGame(),console.log("Game Over! Lives: 0"))}distance(t,e){let n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)}getTowerTypesList(){return Object.values(this.towerTypes).map(t=>({type:t.type,cost:t.cost}))}ngOnDestroy(){this.stopGameLoop(),this.stopEnemySpawning(),console.log("GameService destroyed")}static \u0275fac=function(e){return new(e||i)};static \u0275prov=Z({token:i,factory:i.\u0275fac,providedIn:"root"})};var ye=(i,t)=>({"left.px":i,"top.px":t}),be=i=>({"width.%":i}),H=class i{enemy;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=h({type:i,selectors:[["app-enemy"]],inputs:{enemy:"enemy"},decls:3,vars:10,consts:[[3,"ngStyle"],[1,"hp-bar-container"],[1,"hp-bar",3,"ngStyle"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1),k(2,"div",2),s()()),e&2&&(A(z("enemy ",n.enemy.type)),m("ngStyle",x(5,ye,n.enemy.position.x-15,n.enemy.position.y-15)),p(2),m("ngStyle",D(8,be,n.enemy.hp/n.enemy.maxHp*100)))},dependencies:[w,M],styles:[".enemy[_ngcontent-%COMP%]{position:absolute;width:30px;height:30px;background-color:red;border-radius:50%;border:1px solid black;z-index:10;box-sizing:border-box;display:flex;justify-content:center;align-items:center;font-size:.8em;color:#fff;font-weight:700}.enemy.basic[_ngcontent-%COMP%]{background-color:#dc143c}.enemy.fast[_ngcontent-%COMP%]{background-color:orange}.hp-bar-container[_ngcontent-%COMP%]{position:absolute;top:-8px;left:0;width:100%;height:4px;background-color:gray;border-radius:2px;overflow:hidden}.hp-bar[_ngcontent-%COMP%]{height:100%;background-color:#32cd32;transition:width .1s linear}"],changeDetection:0})};var he=(i,t)=>({"left.px":i,"top.px":t}),W=class i{tower;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=h({type:i,selectors:[["app-tower"]],inputs:{tower:"tower"},decls:2,vars:7,consts:[[3,"ngStyle"]],template:function(e,n){e&1&&(a(0,"div",0),l(1," \u{1F6E1}\uFE0F "),s()),e&2&&(A(z("tower tower-",n.tower.type)),m("ngStyle",x(4,he,n.tower.position.x-20,n.tower.position.y-20)))},dependencies:[w,M],styles:[".tower[_ngcontent-%COMP%]{position:absolute;width:40px;height:40px;background-color:#4682b4;border:2px solid royalblue;border-radius:5px;z-index:20;display:flex;justify-content:center;align-items:center;font-size:1.2em}.tower.basic[_ngcontent-%COMP%]{background-color:#66cdaa;border-color:teal}"],changeDetection:0})};var le=(i,t)=>({"left.px":i,"top.px":t});function fe(i,t){if(i&1&&k(0,"div",2),i&2){let e=t.$implicit;m("ngStyle",x(1,le,e.x,e.y))}}function we(i,t){i&1&&(a(0,"span"),l(1,"+"),s())}function Se(i,t){if(i&1){let e=O();a(0,"div",6),f("click",function(){let o=E(e).$implicit,r=_();return P(r.onBuildSpotClick(o))}),I(1,we,2,0,"span"),s()}if(i&2){let e=t.$implicit;m("ngStyle",x(2,le,e.position.x-25,e.position.y-25)),p(),G(e.occupiedBy===null?1:-1)}}function Te(i,t){if(i&1&&k(0,"app-enemy",4),i&2){let e=t.$implicit;m("enemy",e)}}function ve(i,t){if(i&1&&k(0,"app-tower",5),i&2){let e=t.$implicit;m("tower",e)}}var Y=class i{enemies=null;towers=null;buildSpots=null;selectedTowerType=null;buildTower=new te;path=N;onBuildSpotClick(t){this.selectedTowerType&&t.occupiedBy===null?(console.log(`Build spot ${t.id} clicked, attempting to build ${this.selectedTowerType}`),this.buildTower.emit({spotId:t.id,towerType:this.selectedTowerType})):console.log(`Build spot ${t.id} clicked, cannot build. Selected type: ${this.selectedTowerType}, Occupied: ${t.occupiedBy!==null}`)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=h({type:i,selectors:[["app-game-area"]],inputs:{enemies:"enemies",towers:"towers",buildSpots:"buildSpots",selectedTowerType:"selectedTowerType"},outputs:{buildTower:"buildTower"},decls:10,vars:0,consts:[[1,"game-area"],[1,"path"],[1,"path-point",3,"ngStyle"],[1,"build-spot",3,"ngStyle"],[3,"enemy"],[3,"tower"],[1,"build-spot",3,"click","ngStyle"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"div",1),v(2,fe,1,4,"div",2,T),s(),v(4,Se,2,5,"div",3,T),v(6,Te,1,1,"app-enemy",4,T),v(8,ve,1,1,"app-tower",5,T),s()),e&2&&(p(2),C(n.path),p(2),C(n.buildSpots),p(2),C(n.enemies),p(2),C(n.towers))},dependencies:[w,M,H,W],styles:[".game-area[_ngcontent-%COMP%]{position:relative;width:600px;height:400px;border:2px solid #333;margin:20px auto;background-color:#c8e6c9;overflow:hidden}.path[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%}.path-point[_ngcontent-%COMP%]{position:absolute;width:10px;height:10px;background-color:#8b451380;border-radius:50%;transform:translate(-50%,-50%);z-index:5}.build-spot[_ngcontent-%COMP%]{position:absolute;width:50px;height:50px;background-color:#80808080;border:1px dashed #333;display:flex;justify-content:center;align-items:center;cursor:pointer;z-index:15;font-size:2em;color:#fff;font-weight:700}.build-spot[_ngcontent-%COMP%]:hover{background-color:#808080cc}.range-indicator[_ngcontent-%COMP%]{position:absolute;border:1px dashed blue;border-radius:50%;background-color:#0000ff1a;pointer-events:none;transform:translate(-50%,-50%);z-index:18}"],changeDetection:0})};var me=i=>({selected:i});function Ce(i,t){if(i&1){let e=O();a(0,"div",2)(1,"h2"),l(2,"GAME OVER!"),s(),a(3,"button",8),f("click",function(){E(e);let o=_();return P(o.restartGame())}),l(4,"Ch\u01A1i l\u1EA1i"),s()()}}function _e(i,t){if(i&1){let e=O();a(0,"div",3)(1,"button",8),f("click",function(){E(e);let o=_();return P(o.startGame())}),l(2,"B\u1EAFt \u0111\u1EA7u \u0111\u1EE3t l\xEDnh"),s()()}}function xe(i,t){if(i&1){let e=O();a(0,"button",9),f("click",function(){let o=E(e).$implicit,r=_();return P(r.selectTowerToBuild(o.type))}),l(1),U(2,"uppercase"),s()}if(i&2){let e=t.$implicit,n=_();m("disabled",n.money()<e.cost)("ngClass",D(6,me,n.selectedTowerTypeToBuild()===e.type)),p(),ne(" ",q(2,4,e.type)," (",e.cost,"\u{1F4B0}) ")}}var ce=class i{gameService=ee(V);money=this.gameService.money;lives=this.gameService.lives;enemies=this.gameService.enemies;towers=this.gameService.towers;buildSpots=this.gameService.buildSpots;gameStatus=this.gameService.gameStatus;selectedTowerTypeToBuild=g(null);towerTypesList=this.gameService.getTowerTypesList();constructor(){}ngOnInit(){console.log("TownerdefenseComponent OnInit. Initializing game..."),this.gameService.initializeGame()}startGame(){this.gameService.startGame()}restartGame(){this.gameService.initializeGame(),this.selectedTowerTypeToBuild.set(null)}selectTowerToBuild(t){this.selectedTowerTypeToBuild.set(t),console.log(`Selected tower to build: ${t}`)}handleBuildTower(t){console.log("Handling build tower event in TownerdefenseComponent",t),this.gameService.buildTower(t.spotId,t.towerType)&&this.selectedTowerTypeToBuild.set(null)}ngOnDestroy(){console.log("TownerdefenseComponent OnDestroy. Stopping game..."),this.gameService.stopGame()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=h({type:i,selectors:[["app-root"]],decls:21,vars:14,consts:[[1,"container"],[1,"game-info"],[1,"game-over"],[1,"start-game"],[1,"toolbar"],[3,"disabled","ngClass"],[3,"click","ngClass"],[3,"buildTower","enemies","towers","buildSpots","selectedTowerType"],[3,"click"],[3,"click","disabled","ngClass"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"h1"),l(2,"Simple Tower Defense"),s(),a(3,"div",1)(4,"div"),l(5),s(),a(6,"div"),l(7),s(),a(8,"div"),l(9),U(10,"uppercase"),s()(),I(11,Ce,5,0,"div",2),I(12,_e,3,0,"div",3),a(13,"div",4)(14,"h3"),l(15,"X\xE2y th\xE1p:"),s(),v(16,xe,3,8,"button",5,T),a(18,"button",6),f("click",function(){return n.selectTowerToBuild(null)}),l(19," H\u1EE7y ch\u1ECDn "),s()(),a(20,"app-game-area",7),f("buildTower",function(r){return n.handleBuildTower(r)}),s()()),e&2&&(p(5),L("\u{1F4B0} Ti\u1EC1n: ",n.money()),p(2),L("\u2764\uFE0F M\u1EA1ng: ",n.lives()),p(2),L("Tr\u1EA1ng th\xE1i: ",q(10,10,n.gameStatus())),p(2),G(n.gameStatus()==="gameOver"?11:-1),p(),G(n.gameStatus()==="waiting"?12:-1),p(4),C(n.towerTypesList),p(2),m("ngClass",D(12,me,n.selectedTowerTypeToBuild()===null)),p(2),m("enemies",n.enemies())("towers",n.towers())("buildSpots",n.buildSpots())("selectedTowerType",n.selectedTowerTypeToBuild()))},dependencies:[w,ie,oe,re,Y],styles:[".container[_ngcontent-%COMP%]{font-family:sans-serif;text-align:center;padding:20px;background-color:#f4f4f4;-webkit-user-select:none;user-select:none}h1[_ngcontent-%COMP%]{color:#333;margin-bottom:10px}.game-info[_ngcontent-%COMP%]{margin-bottom:15px;font-size:1.2em;color:#555;display:flex;justify-content:center;gap:20px}.toolbar[_ngcontent-%COMP%]{margin-top:20px;margin-bottom:20px;padding:10px;border:1px solid #ddd;background-color:#fff;display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center}.toolbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 15px;font-size:1em;cursor:pointer;border:1px solid #ccc;border-radius:4px;background-color:#e9e9e9;transition:background-color .2s ease}.toolbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#d0d0d0}.toolbar[_ngcontent-%COMP%]   button.selected[_ngcontent-%COMP%]{background-color:#a8e6cf;border-color:#5cb85c;font-weight:700}.toolbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.game-over[_ngcontent-%COMP%]{margin-top:20px;color:#dc143c}.game-over[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .start-game[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 20px;font-size:1.2em;cursor:pointer;background-color:#4caf50;color:#fff;border:none;border-radius:5px;margin-top:10px}.game-over[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .start-game[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#45a049}"]})};export{ce as TownerdefenseComponent};
