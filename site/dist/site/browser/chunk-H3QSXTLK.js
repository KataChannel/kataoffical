import{k as R,m as $,n as H,p as D,w as K}from"./chunk-WSS66JWQ.js";import{$b as u,C as k,Dc as N,Eb as C,Ec as E,La as _,Ob as l,Pb as O,Qb as I,Yb as c,Zb as s,ac as v,cc as M,gc as b,hc as d,mb as a,ta as S,tc as m,ua as x,uc as F,vc as y,xc as G,yb as V}from"./chunk-PK4LGOSM.js";import{a as h,b as P}from"./chunk-6DNLS54U.js";var A=o=>({cursor:o}),W=o=>({"background-color":o}),j=()=>({});function B(o,e){if(o&1){let t=M();u(0),c(1,"div",7),b("click",function(){let i=S(t).$implicit,r=d();return x(r.selectSeed(i.name))}),m(2),s(),v()}if(o&2){let t=e.$implicit,n=e.index,i=d();a(),O("background",t.color),I("selected",i.selectedCrop()===t.name),a(),G(" ",n+1,". ",t.name," (",i.inventory()[t.name],") ")}}function z(o,e){o&1&&(c(0,"span",15),m(1,"Empty"),s())}function U(o,e){if(o&1&&(u(0),c(1,"span",16),m(2),s(),c(3,"span",17),m(4),s(),v()),o&2){let t=d().$implicit,n=d(2);a(2),F(t.cropType),a(2),y("",n.getRemainingTime(t),"s")}}function q(o,e){if(o&1&&(u(0),c(1,"span",18),m(2),s(),c(3,"span",17),m(4),s(),v()),o&2){let t=d().$implicit,n=d(2);a(2),y("",t.growthProgress,"%"),a(2),y("",n.getRemainingTime(t),"s")}}function J(o,e){o&1&&(c(0,"span",19),m(1,"Ready"),s())}function Q(o,e){if(o&1){let t=M();c(0,"div",10),b("click",function(){let i=S(t).$implicit,r=d(2);return x(r.onPlotClick(i))}),u(1,11),C(2,z,2,0,"span",12)(3,U,5,2,"ng-container",13)(4,q,5,2,"ng-container",13)(5,J,2,0,"span",14),v(),s()}if(o&2){let t=e.$implicit,n=d(2);O("border-color",t.cropType?n.getCropColor(t.cropType):"#ccc"),l("ngStyle",t.state==="empty"?E(8,W,n.getSoilColor(t)):N(10,j)),a(),l("ngSwitch",t.state),a(),l("ngSwitchCase","empty"),a(),l("ngSwitchCase","seed"),a(),l("ngSwitchCase","growing"),a(),l("ngSwitchCase","ready")}}function X(o,e){if(o&1&&(c(0,"div",8),C(1,Q,6,11,"div",9),s()),o&2){let t=e.$implicit;a(),l("ngForOf",t)}}var L=class o{rows=10;cols=10;farmPlots=_([]);plots=this.farmPlots.asReadonly();tickSub;lastHarvestInfo="";crops=[{name:"chanh v\xE0ng",element:"kim",growthTime:10,harvestValue:5,color:"yellow"},{name:"\u1ED5i",element:"moc",growthTime:8,harvestValue:4,color:"green"},{name:"m\u1EADn",element:"thuy",growthTime:12,harvestValue:6,color:"blue"},{name:"\u0111\xE0o",element:"hoa",growthTime:9,harvestValue:5,color:"red"},{name:"nh\xE3n",element:"tho",growthTime:11,harvestValue:7,color:"brown"}];cropMaterials={"chanh v\xE0ng":["S\u1EE3i chanh v\xE0ng","Nh\u1EF1a chanh"],\u1ED5i:["S\u1EE3i \u1ED5i","L\xE1 \u1ED5i","G\u1ED7 \u1ED5i"],m\u1EADn:["S\u1EE3i m\u1EADn","Nh\u1EF1a m\u1EADn"],\u0111\u00E0o:["S\u1EE3i \u0111\xE0o","Hoa \u0111\xE0o","G\u1ED7 \u0111\xE0o"],nh\u00E3n:["S\u1EE3i nh\xE3n","V\u1ECF nh\xE3n","G\u1ED7 nh\xE3n"]};soilColors={kim:"#EFEFEF",moc:"#A0522D",thuy:"#2F4F4F",hoa:"#B22222",tho:"#DEB887"};birthMap={kim:"thuy",thuy:"moc",moc:"hoa",hoa:"tho",tho:"kim"};killMap={kim:"moc",moc:"tho",tho:"thuy",thuy:"hoa",hoa:"kim"};inventory=_({"chanh v\xE0ng":5,\u1ED5i:5,m\u1EADn:5,\u0111\u00E0o:5,nh\u00E3n:5,"S\u1EE3i chanh v\xE0ng":0,"Nh\u1EF1a chanh":0,"S\u1EE3i \u1ED5i":0,"L\xE1 \u1ED5i":0,"G\u1ED7 \u1ED5i":0,"S\u1EE3i m\u1EADn":0,"Nh\u1EF1a m\u1EADn":0,"S\u1EE3i \u0111\xE0o":0,"Hoa \u0111\xE0o":0,"G\u1ED7 \u0111\xE0o":0,"S\u1EE3i nh\xE3n":0,"V\u1ECF nh\xE3n":0,"G\u1ED7 nh\xE3n":0});money=_(0);selectedCrop=_(this.crops[0].name);ngOnInit(){this.initFarm(),this.tickSub=k(1e3).subscribe(()=>this.updateGrowth()),window.addEventListener("keydown",this.onKey)}ngOnDestroy(){this.tickSub.unsubscribe(),window.removeEventListener("keydown",this.onKey)}onKey=e=>{e.key>="1"&&e.key<="5"&&this.selectedCrop.set(this.crops[+e.key-1].name)};initFarm(){let e=[],t=0;for(let n=0;n<this.rows;n++){e[n]=[];for(let i=0;i<this.cols;i++)e[n][i]={id:t++,row:n,col:i,soilType:(n*this.cols+i)%5,state:"empty",cropType:null,growthProgress:0,effectiveGrowthTime:0,effectiveHarvestValue:0}}this.farmPlots.set(e)}onPlotClick(e){let n=this.farmPlots().map(p=>p.map(g=>h({},g))),i=this.selectedCrop(),r=this.crops.find(p=>p.name===i),T=["kim","moc","thuy","hoa","tho"][e.soilType];if(e.state==="empty"){let p=1,g=1;this.birthMap[r.element]===T?(p=1.5,g=.8):this.killMap[r.element]===T&&(p=.7,g=1.3);let f=h({},this.inventory());if(!f[i])return;f[i]--,this.inventory.set(f),n[e.row][e.col]=P(h({},n[e.row][e.col]),{state:"seed",cropType:i,growthProgress:0,effectiveGrowthTime:Math.ceil(r.growthTime*g),effectiveHarvestValue:Math.ceil(r.harvestValue*p)})}else if(e.state==="ready"){let p=e.effectiveHarvestValue;this.money.set(this.money()+p);let g=h({},this.inventory()),f=this.cropMaterials[r.name];f.forEach(w=>{g[w]=(g[w]||0)+1}),this.inventory.set(g),this.lastHarvestInfo=`Thu ho\u1EA1ch ${r.name}: `+f.map(w=>`${w}: 1`).join(", "),n[e.row][e.col]=P(h({},n[e.row][e.col]),{state:"empty",cropType:null,growthProgress:0})}this.farmPlots.set(n)}updateGrowth(){let t=this.farmPlots().map(n=>n.map(i=>h({},i)));for(let n=0;n<this.rows;n++)for(let i=0;i<this.cols;i++){let r=t[n][i];(r.state==="seed"||r.state==="growing")&&r.cropType&&(r.growthProgress++,r.state=r.growthProgress>=r.effectiveGrowthTime?"ready":"growing")}this.farmPlots.set(t)}getRemainingTime(e){return Math.max(0,e.effectiveGrowthTime-e.growthProgress)}getCropColor(e){return this.crops.find(t=>t.name===e).color}getSoilColor(e){let t=["kim","moc","thuy","hoa","tho"][e.soilType];return this.soilColors[t]}selectSeed(e){this.selectedCrop.set(e)}get cursorStyle(){let t=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                   <circle cx="8" cy="8" r="4" fill="${this.crops.find(n=>n.name===this.selectedCrop()).color}"/>
                 </svg>`;return`url("data:image/svg+xml,${encodeURIComponent(t)}") 8 8, auto`}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=V({type:o,selectors:[["app-farm"]],decls:11,vars:7,consts:[[1,"farm-container"],[1,"mb-4"],[1,"toolbar","mb-4"],[4,"ngFor","ngForOf"],[1,"money"],[1,"farm-grid",3,"ngStyle"],["class","row",4,"ngFor","ngForOf"],[1,"seed-item",3,"click"],[1,"row"],["class","plot",3,"borderColor","ngStyle","click",4,"ngFor","ngForOf"],[1,"plot",3,"click","ngStyle"],[3,"ngSwitch"],["class","empty",4,"ngSwitchCase"],[4,"ngSwitchCase"],["class","ready",4,"ngSwitchCase"],[1,"empty"],[1,"seed"],[1,"countdown"],[1,"growing"],[1,"ready"]],template:function(t,n){t&1&&(c(0,"div",0)(1,"h1",1),m(2,"N\xF4ng Tr\u1EA1i"),s(),c(3,"div",2),C(4,B,3,7,"ng-container",3),c(5,"div",4),m(6),s()(),c(7,"div",5),C(8,X,2,1,"div",6),s(),c(9,"p"),m(10),s()()),t&2&&(a(4),l("ngForOf",n.crops),a(2),y("Ti\u1EC1n: ",n.money(),""),a(),l("ngStyle",E(5,A,n.cursorStyle)),a(),l("ngForOf",n.plots()),a(2),F(n.lastHarvestInfo))},dependencies:[K,R,D,$,H],styles:[".farm-container[_ngcontent-%COMP%]{font-family:Arial,sans-serif}.farm-container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.farm-container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .seed-item[_ngcontent-%COMP%]{padding:4px 8px;border:2px solid transparent;border-radius:4px;cursor:pointer}.farm-container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .seed-item.selected[_ngcontent-%COMP%]{border-color:#333;transform:scale(1.1)}.farm-container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .money[_ngcontent-%COMP%]{margin-left:auto;font-weight:700}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]{display:grid;grid-template-rows:repeat(5,1fr);gap:4px}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr);gap:4px}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]   .plot[_ngcontent-%COMP%]{padding:4px;border:2px solid #ccc;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#f9f9f9}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]   .plot[_ngcontent-%COMP%]   .empty[_ngcontent-%COMP%]{color:#aaa}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]   .plot[_ngcontent-%COMP%]   .seed[_ngcontent-%COMP%]{color:#555;font-weight:700}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]   .plot[_ngcontent-%COMP%]   .growing[_ngcontent-%COMP%]{color:#333}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]   .plot[_ngcontent-%COMP%]   .ready[_ngcontent-%COMP%]{color:#007bff;font-weight:700}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]   .plot[_ngcontent-%COMP%]   .countdown[_ngcontent-%COMP%]{font-size:.7rem;color:#555}"]})};export{L as FarmComponent};
