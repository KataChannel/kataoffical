var g=(e,t)=>t.some(n=>e instanceof n),y,b;function L(){return y||(y=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function P(){return b||(b=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var l=new WeakMap,p=new WeakMap,I=new WeakMap,m=new WeakMap,D=new WeakMap;function S(e){let t=new Promise((n,o)=>{let s=()=>{e.removeEventListener("success",a),e.removeEventListener("error",r)},a=()=>{n(c(e.result)),s()},r=()=>{o(e.error),s()};e.addEventListener("success",a),e.addEventListener("error",r)});return t.then(n=>{n instanceof IDBCursor&&l.set(n,e)}).catch(()=>{}),D.set(t,e),t}function j(e){if(p.has(e))return;let t=new Promise((n,o)=>{let s=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",r),e.removeEventListener("abort",r)},a=()=>{n(),s()},r=()=>{o(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",a),e.addEventListener("error",r),e.addEventListener("abort",r)});p.set(e,t)}var h={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return p.get(e);if(t==="objectStoreNames")return e.objectStoreNames||I.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return c(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function B(e){h=e(h)}function x(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){let o=e.call(f(this),t,...n);return I.set(o,t.sort?t.sort():[t]),c(o)}:P().includes(e)?function(...t){return e.apply(f(this),t),c(l.get(this))}:function(...t){return c(e.apply(f(this),t))}}function T(e){return typeof e=="function"?x(e):(e instanceof IDBTransaction&&j(e),g(e,L())?new Proxy(e,h):e)}function c(e){if(e instanceof IDBRequest)return S(e);if(m.has(e))return m.get(e);let t=T(e);return t!==e&&(m.set(e,t),D.set(t,e)),t}var f=e=>D.get(e);function M(e,t,{blocked:n,upgrade:o,blocking:s,terminated:a}={}){let r=indexedDB.open(e,t),u=c(r);return o&&r.addEventListener("upgradeneeded",i=>{o(c(r.result),i.oldVersion,i.newVersion,c(r.transaction),i)}),n&&r.addEventListener("blocked",i=>n(i.oldVersion,i.newVersion,i)),u.then(i=>{a&&i.addEventListener("close",()=>a()),s&&i.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}var C=["get","getKey","getAll","getAllKeys","count"],V=["put","add","delete","clear"],w=new Map;function E(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(w.get(t))return w.get(t);let n=t.replace(/FromIndex$/,""),o=t!==n,s=V.includes(n);if(!(n in(o?IDBIndex:IDBObjectStore).prototype)||!(s||C.includes(n)))return;let a=async function(r,...u){let i=this.transaction(r,s?"readwrite":"readonly"),d=i.store;return o&&(d=d.index(u.shift())),(await Promise.all([d[n](...u),s&&i.done]))[0]};return w.set(t,a),a}B(e=>({...e,get:(t,n,o)=>E(t,n)||e.get(t,n,o),has:(t,n)=>!!E(t,n)||e.has(t,n)}));addEventListener("message",async({data:e})=>{let{records:t,batchId:n}=e;try{let s=(await M("DriveItem",1,{upgrade(r){r.createObjectStore("records",{keyPath:"id"})}})).transaction("records","readwrite"),a=s.objectStore("records");for(let r of t)await a.put(r);await s.done,postMessage({status:"success",batchId:n})}catch(o){postMessage({status:"error",batchId:n,error:o.message})}});
