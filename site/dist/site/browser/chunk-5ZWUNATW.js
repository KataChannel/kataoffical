import{j as R,k as $,m as D,n as H,p as j,w as A}from"./chunk-VJ2NH5IP.js";import{$b as c,Bb as k,Bc as I,D as T,Hb as _,Hc as G,Ic as x,Kc as N,Na as u,Rb as s,Sb as V,ac as l,cc as v,dc as w,fc as O,jc as M,kc as d,ob as a,ua as S,va as b,xc as m,yc as F,zc as y}from"./chunk-BDFDBNPH.js";import"./chunk-EU2KAMEK.js";import{a as f,b as P}from"./chunk-47CWAPKR.js";var L=o=>({cursor:o}),W=(o,e,t)=>({"rounded-lg p-2 flex items-center justify-between cursor-pointer bg-slate-100":!0,"border border-blue-600 shadow-lg":o,selected:e,"hover:bg-blue-100":t}),B=o=>({color:o}),z=o=>({"background-color":o}),U=()=>({});function q(o,e){if(o&1){let t=O();c(0,"div",8),M("click",function(){let i=S(t).$implicit,r=d();return b(r.selectSeed(i.name))}),m(1),l()}if(o&2){let t=e.$implicit,n=e.index,i=d();s("ngClass",N(5,W,i.selectedCrop()===t.name,i.selectedCrop()===t.name,i.selectedCrop()!==t.name))("ngStyle",x(9,B,t.color)),a(),I(" ",n+1,". ",t.name," (",i.inventory()[t.name],") ")}}function J(o,e){o&1&&(c(0,"span",16),m(1,"Empty"),l())}function Q(o,e){if(o&1&&(v(0),c(1,"span",17),m(2),l(),c(3,"span",18),m(4),l(),w()),o&2){let t=d().$implicit,n=d(2);a(2),F(t.cropType),a(2),y("",n.getRemainingTime(t),"s")}}function X(o,e){if(o&1&&(v(0),c(1,"span",19),m(2),l(),c(3,"span",18),m(4),l(),w()),o&2){let t=d().$implicit,n=d(2);a(2),y("",t.growthProgress,"%"),a(2),y("",n.getRemainingTime(t),"s")}}function Y(o,e){o&1&&(c(0,"span",20),m(1,"Ready"),l())}function Z(o,e){if(o&1){let t=O();c(0,"div",11),M("click",function(){let i=S(t).$implicit,r=d(2);return b(r.onPlotClick(i))}),v(1,12),_(2,J,2,0,"span",13)(3,Q,5,2,"ng-container",14)(4,X,5,2,"ng-container",14)(5,Y,2,0,"span",15),w(),l()}if(o&2){let t=e.$implicit,n=d(2);V("border-color",t.cropType?n.getCropColor(t.cropType):"#ccc"),s("ngStyle",t.state==="empty"?x(8,z,n.getSoilColor(t)):G(10,U)),a(),s("ngSwitch",t.state),a(),s("ngSwitchCase","empty"),a(),s("ngSwitchCase","seed"),a(),s("ngSwitchCase","growing"),a(),s("ngSwitchCase","ready")}}function ee(o,e){if(o&1&&(c(0,"div",9),_(1,Z,6,11,"div",10),l()),o&2){let t=e.$implicit;a(),s("ngForOf",t)}}var K=class o{rows=5;cols=5;farmPlots=u([]);plots=this.farmPlots.asReadonly();tickSub;lastHarvestInfo="";crops=[{name:"chanh v\xE0ng",element:"kim",growthTime:10,harvestValue:5,color:"yellow"},{name:"\u1ED5i",element:"moc",growthTime:8,harvestValue:4,color:"green"},{name:"m\u1EADn",element:"thuy",growthTime:12,harvestValue:6,color:"blue"},{name:"\u0111\xE0o",element:"hoa",growthTime:9,harvestValue:5,color:"red"},{name:"nh\xE3n",element:"tho",growthTime:11,harvestValue:7,color:"brown"}];cropMaterials={"chanh v\xE0ng":["S\u1EE3i chanh v\xE0ng","Nh\u1EF1a chanh"],\u1ED5i:["S\u1EE3i \u1ED5i","L\xE1 \u1ED5i","G\u1ED7 \u1ED5i"],m\u1EADn:["S\u1EE3i m\u1EADn","Nh\u1EF1a m\u1EADn"],\u0111\u00E0o:["S\u1EE3i \u0111\xE0o","Hoa \u0111\xE0o","G\u1ED7 \u0111\xE0o"],nh\u00E3n:["S\u1EE3i nh\xE3n","V\u1ECF nh\xE3n","G\u1ED7 nh\xE3n"]};soilColors={kim:"#EFEFEF",moc:"#A0522D",thuy:"#2F4F4F",hoa:"#B22222",tho:"#DEB887"};birthMap={kim:"thuy",thuy:"moc",moc:"hoa",hoa:"tho",tho:"kim"};killMap={kim:"moc",moc:"tho",tho:"thuy",thuy:"hoa",hoa:"kim"};inventory=u({"chanh v\xE0ng":5,\u1ED5i:5,m\u1EADn:5,\u0111\u00E0o:5,nh\u00E3n:5,"S\u1EE3i chanh v\xE0ng":0,"Nh\u1EF1a chanh":0,"S\u1EE3i \u1ED5i":0,"L\xE1 \u1ED5i":0,"G\u1ED7 \u1ED5i":0,"S\u1EE3i m\u1EADn":0,"Nh\u1EF1a m\u1EADn":0,"S\u1EE3i \u0111\xE0o":0,"Hoa \u0111\xE0o":0,"G\u1ED7 \u0111\xE0o":0,"S\u1EE3i nh\xE3n":0,"V\u1ECF nh\xE3n":0,"G\u1ED7 nh\xE3n":0});money=u(0);selectedCrop=u(this.crops[0].name);ngOnInit(){this.initFarm(),this.tickSub=T(1e3).subscribe(()=>this.updateGrowth()),window.addEventListener("keydown",this.onKey)}ngOnDestroy(){this.tickSub.unsubscribe(),window.removeEventListener("keydown",this.onKey)}onKey=e=>{e.key>="1"&&e.key<="5"&&this.selectedCrop.set(this.crops[+e.key-1].name)};initFarm(){let e=[],t=0;for(let n=0;n<this.rows;n++){e[n]=[];for(let i=0;i<this.cols;i++)e[n][i]={id:t++,row:n,col:i,soilType:(n*this.cols+i)%5,state:"empty",cropType:null,growthProgress:0,effectiveGrowthTime:0,effectiveHarvestValue:0}}this.farmPlots.set(e)}onPlotClick(e){let n=this.farmPlots().map(p=>p.map(g=>f({},g))),i=this.selectedCrop(),r=this.crops.find(p=>p.name===i),E=["kim","moc","thuy","hoa","tho"][e.soilType];if(e.state==="empty"){let p=1,g=1;this.birthMap[r.element]===E?(p=1.5,g=.8):this.killMap[r.element]===E&&(p=.7,g=1.3);let h=f({},this.inventory());if(!h[i])return;h[i]--,this.inventory.set(h),n[e.row][e.col]=P(f({},n[e.row][e.col]),{state:"seed",cropType:i,growthProgress:0,effectiveGrowthTime:Math.ceil(r.growthTime*g),effectiveHarvestValue:Math.ceil(r.harvestValue*p)})}else if(e.state==="ready"){let p=e.effectiveHarvestValue;this.money.set(this.money()+p);let g=f({},this.inventory()),h=this.cropMaterials[r.name];h.forEach(C=>{g[C]=(g[C]||0)+1}),this.inventory.set(g),this.lastHarvestInfo=`Thu ho\u1EA1ch ${r.name}: `+h.map(C=>`${C}: 1`).join(", "),console.log(h),n[e.row][e.col]=P(f({},n[e.row][e.col]),{state:"empty",cropType:null,growthProgress:0})}this.farmPlots.set(n)}updateGrowth(){let t=this.farmPlots().map(n=>n.map(i=>f({},i)));for(let n=0;n<this.rows;n++)for(let i=0;i<this.cols;i++){let r=t[n][i];(r.state==="seed"||r.state==="growing")&&r.cropType&&(r.growthProgress++,r.state=r.growthProgress>=r.effectiveGrowthTime?"ready":"growing")}this.farmPlots.set(t)}getRemainingTime(e){return Math.max(0,e.effectiveGrowthTime-e.growthProgress)}getCropColor(e){return this.crops.find(t=>t.name===e).color}getSoilColor(e){let t=["kim","moc","thuy","hoa","tho"][e.soilType];return this.soilColors[t]}selectSeed(e){this.selectedCrop.set(e)}get cursorStyle(){let t=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                   <circle cx="8" cy="8" r="4" fill="${this.crops.find(n=>n.name===this.selectedCrop()).color}"/>
                 </svg>`;return`url("data:image/svg+xml,${encodeURIComponent(t)}") 8 8, auto`}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=k({type:o,selectors:[["app-farm"]],decls:12,vars:7,consts:[[1,"w-full","h-full","flex","flex-col","space-y-2","justify-center","items-center","p-4"],[1,"max-w-lg","flex","flex-col","space-y-2"],[1,"mb-4"],[1,"flex","flex-row","space-x-2"],[3,"ngClass","ngStyle","click",4,"ngFor","ngForOf"],[1,"money"],[1,"mx-auto","flex","flex-row","gap-2","p-2","rounded-lg",3,"ngStyle"],["class","flex flex-col gap-2",4,"ngFor","ngForOf"],[3,"click","ngClass","ngStyle"],[1,"flex","flex-col","gap-2"],["class","w-16 h-16 border-2 rounded-lg flex flex-col items-center justify-center",3,"borderColor","ngStyle","click",4,"ngFor","ngForOf"],[1,"w-16","h-16","border-2","rounded-lg","flex","flex-col","items-center","justify-center",3,"click","ngStyle"],[3,"ngSwitch"],["class","empty",4,"ngSwitchCase"],[4,"ngSwitchCase"],["class","ready",4,"ngSwitchCase"],[1,"empty"],[1,"seed"],[1,"countdown"],[1,"growing"],[1,"ready"]],template:function(t,n){t&1&&(c(0,"div",0)(1,"div",1)(2,"h1",2),m(3,"N\xF4ng Tr\u1EA1i"),l(),c(4,"div",3),_(5,q,2,11,"div",4),l(),c(6,"div",5),m(7),l(),c(8,"div",5),m(9),l(),c(10,"div",6),_(11,ee,2,1,"div",7),l()()()),t&2&&(a(5),s("ngForOf",n.crops),a(2),y("Ti\u1EC1n: ",n.money()," - V\u1EADt Ph\u1EA9m : "),a(2),F(n.lastHarvestInfo),a(),s("ngStyle",x(5,L,n.cursorStyle)),a(),s("ngForOf",n.plots()))},dependencies:[A,R,$,j,D,H],styles:[".farm-container[_ngcontent-%COMP%]{font-family:Arial,sans-serif}.farm-container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.farm-container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .seed-item[_ngcontent-%COMP%]{padding:4px 8px;border:2px solid transparent;border-radius:4px;cursor:pointer}.farm-container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .seed-item.selected[_ngcontent-%COMP%]{border-color:#333;transform:scale(1.1)}.farm-container[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]   .money[_ngcontent-%COMP%]{margin-left:auto;font-weight:700}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]{display:grid;grid-template-rows:repeat(5,1fr);gap:4px}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr);gap:4px}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]   .plot[_ngcontent-%COMP%]{padding:4px;border:2px solid #ccc;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#f9f9f9}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]   .plot[_ngcontent-%COMP%]   .empty[_ngcontent-%COMP%]{color:#aaa}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]   .plot[_ngcontent-%COMP%]   .seed[_ngcontent-%COMP%]{color:#555;font-weight:700}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]   .plot[_ngcontent-%COMP%]   .growing[_ngcontent-%COMP%]{color:#333}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]   .plot[_ngcontent-%COMP%]   .ready[_ngcontent-%COMP%]{color:#007bff;font-weight:700}.farm-container[_ngcontent-%COMP%]   .farm-grid[_ngcontent-%COMP%]   .plot[_ngcontent-%COMP%]   .countdown[_ngcontent-%COMP%]{font-size:.7rem;color:#555}"]})};export{K as FarmComponent};
