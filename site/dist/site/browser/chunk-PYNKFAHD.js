import{j as ee,k as te,l as ie,m as ne,n as oe,r as re,v as se,w as ae}from"./chunk-ZGE73KEQ.js";import{$b as s,Ac as L,Bb as G,D as O,Hb as P,Jc as M,Lc as Q,Mc as $,Na as _,Nc as U,Oc as J,Rb as f,Sb as k,ac as l,bc as N,cc as F,cd as Y,dc as D,fc as V,jc as w,kc as b,nb as H,ob as c,qc as q,rc as K,sc as Z,ua as u,va as g,wa as A,xa as j,xc as m,yc as z,zc as C}from"./chunk-LV5BQLFP.js";import"./chunk-EU2KAMEK.js";import{a as x,b as X}from"./chunk-47CWAPKR.js";var he=["mapContainer"],ue=(a,e)=>({"fixed h-full translate-x-0":a,"-translate-x-full fixed h-full":e,"md:relative md:translate-x-0":!0}),R=(a,e)=>({"bg-green-600 text-white shadow-inner":a,"bg-gray-200 hover:bg-gray-300":e}),ge=(a,e)=>({"border-blue-600 font-bold bg-blue-100 transform scale-105":a,"border-gray-300":e}),fe=(a,e,t,i,n)=>({"hover:brightness-110":a,"hover:brightness-90":e,"bg-yellow-600":t,"bg-yellow-600 border-2 border-black z-10":i,"cursor-pointer":n});function ve(a,e){if(a&1){let t=V();s(0,"div",25),w("click",function(){u(t);let n=b();return g(n.toggleMobileSidebar())}),l()}}function we(a,e){if(a&1){let t=V();s(0,"div",26),w("click",function(){let n=u(t).$implicit,o=b();return g(o.selectSeed(n.id))}),s(1,"span"),m(2),l(),s(3,"span",27),m(4),l()()}if(a&2){let t=e.$implicit,i=e.index,n=b();k("border-color",n.selectedCropId()===t.id&&n.selectedTool()==="plant"?"blue":t.color||"#d1d5db"),f("ngClass",M(6,ge,n.selectedCropId()===t.id&&n.selectedTool()==="plant",n.selectedCropId()!==t.id||n.selectedTool()!=="plant")),c(2),L("",i+1,". ",t.name,""),c(2),C("(",n.inventory()["crop"+t.id]||0,")")}}function _e(a,e){a&1&&(s(0,"span",34),m(1,"\u0110\u1EA5t"),l())}function be(a,e){if(a&1&&(F(0),s(1,"span",35),m(2),l(),s(3,"span",36),m(4),l(),D()),a&2){let t,i,n=b(2).$implicit,o=b();c(),k("color",((t=o.getCropById(n.cropId))==null?null:t.color)||"white"),c(),z((i=o.getCropById(n.cropId))==null||i.name==null?null:i.name.substring(0,2)),c(2),C("",o.getRemainingTime(n),"s")}}function ye(a,e){if(a&1&&(F(0),s(1,"span",35),m(2),l(),s(3,"span",36),m(4),l(),D()),a&2){let t,i,n=b(2).$implicit,o=b();c(),k("color",((t=o.getCropById(n.cropId))==null?null:t.color)||"white"),c(),C("",(i=o.getCropById(n.cropId))==null||i.name==null?null:i.name.substring(0,2),".."),c(2),C("",o.getRemainingTime(n),"s")}}function Te(a,e){if(a&1&&(s(0,"span",37),m(1,"Ch\xEDn!"),l()),a&2){let t,i=b(2).$implicit,n=b();k("color",((t=n.getCropById(i.cropId))==null?null:t.color)||"white")}}function xe(a,e){if(a&1&&(F(0)(1,30),P(2,_e,2,0,"span",31)(3,be,5,4,"ng-container",32)(4,ye,5,4,"ng-container",32)(5,Te,2,2,"span",33),D()()),a&2){let t=b().$implicit;c(),f("ngSwitch",t.state),c(),f("ngSwitchCase","empty"),c(),f("ngSwitchCase","seed"),c(),f("ngSwitchCase","growing"),c(),f("ngSwitchCase","ready")}}function Ce(a,e){a&1&&(F(0),s(1,"span",38),m(2," P "),l(),D())}function Se(a,e){a&1&&(F(0),s(1,"span",39),m(2,"~"),l(),D())}function Ee(a,e){if(a&1){let t=V();s(0,"div",28),w("click",function(){let n=u(t).$implicit,o=b();return g(o.onTileClick(n))}),P(1,xe,6,5,"ng-container",29)(2,Ce,3,0,"ng-container",29)(3,Se,3,0,"ng-container",29),l()}if(a&2){let t=e.$implicit,i=b();k("width",i.baseTileSize,"px")("height",i.baseTileSize,"px")("left",t.col*i.baseTileSize,"px")("top",t.row*i.baseTileSize,"px")("background-color",t.type==="soil"&&t.state==="empty"?i.getSoilColor(t):t.type==="soil"&&t.state!=="empty"?"#8B4513":i.getTileColor(t.type)),f("ngClass",Q(14,fe,t.type!=="water",t.type==="water",t.type==="pen"&&!t.isPenTopLeft,t.isPenTopLeft,t.type!=="water")),c(),f("ngIf",t.type==="soil"),c(),f("ngIf",t.type==="pen"&&t.isPenTopLeft),c(),f("ngIf",t.type==="water")}}function Pe(a,e){if(a&1&&(s(0,"div",48)(1,"div",49),m(2),$(3,"uppercase"),l(),s(4,"div",50),m(5),l(),s(6,"div",51),m(7),l()()),a&2){let t=e.$implicit;c(),k("background-color",t.color||"#a1a1aa"),c(),z(U(3,5,t.name.substring(0,1))),c(3),z(t.name),c(2),C("x ",t.quantity,"")}}function ke(a,e){a&1&&(s(0,"div",52),m(1,"T\xFAi \u0111\u1ED3 tr\u1ED1ng tr\u01A1n..."),l())}function Me(a,e){if(a&1){let t=V();s(0,"div",40),w("click",function(){u(t);let n=b();return g(n.toggleInventoryDialog())}),s(1,"div",41),w("click",function(n){return u(t),g(n.stopPropagation())}),s(2,"div",42)(3,"h2",43),m(4,"T\xFAi \u0110\u1ED3"),l(),s(5,"button",44),w("click",function(){u(t);let n=b();return g(n.toggleInventoryDialog())}),m(6,"\xD7"),l()(),s(7,"div",45),P(8,Pe,8,7,"div",46)(9,ke,2,0,"div",47),l()()()}if(a&2){let t=b();c(8),f("ngForOf",t.inventoryItems()),c(),f("ngIf",t.inventoryItems().length===0)}}var le=class a{rows=70;cols=70;baseTileSize=32;mapTilesSignal=_([]);tickSub;lastHarvestInfo="Ch\xE0o m\u1EEBng \u0111\u1EBFn H\xF2n \u0110\u1EA3o N\xF4ng Tr\u1EA1i!";materialDropRate=.8;seedDropRate=.5;showInventoryDialog=!1;zoomLevel=_(1);panX=_(0);panY=_(0);isPanning=_(!1);lastPanCoords={x:0,y:0};viewportWidth=_(0);viewportHeight=_(0);isMobileSidebarOpen=_(!1);lastPinchDistance=0;touchStartTime=0;tapThreshold=200;tapMoveThreshold=10;growingPlots=_([]);mapContainerRef;selectedTool=_("harvest");crops=[{id:1,name:"chanh v\xE0ng",element:"kim",growthTime:10,harvestValue:5,color:"yellow"},{id:2,name:"\u1ED5i",element:"moc",growthTime:8,harvestValue:4,color:"green"},{id:3,name:"m\u1EADn",element:"thuy",growthTime:12,harvestValue:6,color:"blue"},{id:4,name:"\u0111\xE0o",element:"hoa",growthTime:9,harvestValue:5,color:"red"},{id:5,name:"nh\xE3n",element:"tho",growthTime:11,harvestValue:7,color:"brown"}];cropMaterials={1:[{id:101,name:"S\u1EE3i chanh v\xE0ng"},{id:102,name:"Nh\u1EF1a chanh"}],2:[{id:201,name:"S\u1EE3i \u1ED5i"},{id:202,name:"L\xE1 \u1ED5i"},{id:203,name:"G\u1ED7 \u1ED5i"}],3:[{id:301,name:"S\u1EE3i m\u1EADn"},{id:302,name:"Nh\u1EF1a m\u1EADn"}],4:[{id:401,name:"S\u1EE3i \u0111\xE0o"},{id:402,name:"Hoa \u0111\xE0o"},{id:403,name:"G\u1ED7 \u0111\xE0o"}],5:[{id:501,name:"S\u1EE3i nh\xE3n"},{id:502,name:"V\u1ECF nh\xE3n"},{id:503,name:"G\u1ED7 nh\xE3n"}]};soilColors={kim:"#EFEFEF",moc:"#A0522D",thuy:"#2F4F4F",hoa:"#B22222",tho:"#DEB887"};birthMap={kim:"thuy",thuy:"moc",moc:"hoa",hoa:"tho",tho:"kim"};killMap={kim:"moc",moc:"tho",tho:"thuy",thuy:"hoa",hoa:"kim"};inventory=_({crop1:5,crop2:5,crop3:5,crop4:5,crop5:5,fruit1:0,fruit2:0,fruit3:0,fruit4:0,fruit5:0,mat101:0,mat102:0,mat201:0,mat202:0,mat203:0,mat301:0,mat302:0,mat401:0,mat402:0,mat403:0,mat501:0,mat502:0,mat503:0,soil:50,pen:20});money=_(0);playerLevel=_(1);playerXP=_(0);selectedCropId=_(this.crops[0].id);inventoryItems=Y(()=>{let e=this.inventory(),t=[];return this.crops.forEach(i=>{let n=`crop${i.id}`;e[n]>0&&t.push({id:n,name:`${i.name} Seed`,quantity:e[n],type:"seed",color:i.color})}),this.crops.forEach(i=>{let n=`fruit${i.id}`;e[n]>0&&t.push({id:n,name:i.name,quantity:e[n],type:"fruit",color:i.color})}),Object.values(this.cropMaterials).flat().forEach(i=>{let n=`mat${i.id}`;e[n]>0&&t.push({id:n,name:i.name,quantity:e[n],type:"material"})}),e.soil>0&&t.push({id:"soil",name:"\u0110\u1EA5t",quantity:e.soil,type:"tool",color:"#A0522D"}),e.pen>0&&t.push({id:"pen",name:"Chu\u1ED3ng",quantity:e.pen,type:"tool",color:"#D2B48C"}),t});visibleTiles=Y(()=>{let e=this.zoomLevel(),t=this.baseTileSize*e,i=this.panX(),n=this.panY(),o=this.viewportWidth(),r=this.viewportHeight(),p=this.mapTilesSignal();if(p.length===0||o===0||r===0)return[];let d=3,h=Math.max(0,Math.floor(-n/t)-d),v=Math.min(this.rows-1,Math.ceil((-n+r)/t)+d),y=Math.max(0,Math.floor(-i/t)-d),S=Math.min(this.cols-1,Math.ceil((-i+o)/t)+d),T=[];for(let E=h;E<=v;E++)for(let I=y;I<=S;I++)p[E]?.[I]&&T.push(p[E][I]);return T});mapTransform=Y(()=>`translate(${this.panX()}px, ${this.panY()}px) scale(${this.zoomLevel()})`);ngOnInit(){this.initMap(),this.tickSub=O(500).subscribe(()=>this.updateGrowthOptimized()),window.addEventListener("keydown",this.onKey)}ngAfterViewInit(){this.updateViewportSize();let e=(this.viewportWidth()-this.cols*this.baseTileSize)/2,t=(this.viewportHeight()-this.rows*this.baseTileSize)/2;this.panX.set(this.clampPan(e,this.viewportWidth(),this.cols*this.baseTileSize)),this.panY.set(this.clampPan(t,this.viewportHeight(),this.rows*this.baseTileSize))}ngOnDestroy(){this.tickSub.unsubscribe(),window.removeEventListener("keydown",this.onKey)}updateViewportSize(){this.mapContainerRef&&(this.viewportWidth.set(this.mapContainerRef.nativeElement.clientWidth),this.viewportHeight.set(this.mapContainerRef.nativeElement.clientHeight))}initMap(){let e=[],t=0,i=50,n=(this.rows-i)/2,o=n+i-1,r=(this.cols-i)/2,p=r+i-1;for(let d=0;d<this.rows;d++){e[d]=[];for(let h=0;h<this.cols;h++){let v;d>=n&&d<=o&&h>=r&&h<=p?v="grass":v="water",e[d][h]={id:t++,row:d,col:h,type:v,cropId:null,growthProgress:0,effectiveGrowthTime:0,effectiveHarvestValue:0,state:void 0,soilType:void 0,isPenTopLeft:!1}}}this.mapTilesSignal.set(e),this.growingPlots.set([])}updateTile(e,t,i){this.mapTilesSignal.update(n=>{let o=n.map(r=>r.map(p=>x({},p)));return o[e][t]=x(x({},o[e][t]),i),o})}placeSoil(e){if(e.type==="water"){this.lastHarvestInfo="Kh\xF4ng th\u1EC3 \u0111\u1EB7t \u0111\u1EA5t tr\xEAn m\u1EB7t n\u01B0\u1EDBc!";return}e.type==="grass"&&this.inventory().soil>0?(this.inventory.update(t=>X(x({},t),{soil:t.soil-1})),this.updateTile(e.row,e.col,{type:"soil",state:"empty",soilType:(e.row*this.cols+e.col)%5}),this.lastHarvestInfo=`\u0110\u1EB7t 1 \xF4 \u0111\u1EA5t t\u1EA1i (${e.row}, ${e.col}).`):e.type!=="grass"?this.lastHarvestInfo="Ch\u1EC9 c\xF3 th\u1EC3 \u0111\u1EB7t \u0111\u1EA5t tr\xEAn c\u1ECF!":this.lastHarvestInfo="H\u1EBFt \u0111\u1EA5t trong t\xFAi!"}canPlacePen(e,t){let i=this.mapTilesSignal();if(e+1>=this.rows||t+1>=this.cols)return!1;for(let n=e;n<e+2;n++)for(let o=t;o<t+2;o++)if(!i[n]?.[o]||i[n][o].type!=="grass")return!1;return!0}placePen(e){if(this.inventory().pen>0&&this.canPlacePen(e.row,e.col)){this.inventory.update(t=>X(x({},t),{pen:t.pen-1}));for(let t=0;t<2;t++)for(let i=0;i<2;i++)this.updateTile(e.row+t,e.col+i,{type:"pen",isPenTopLeft:t===0&&i===0});this.lastHarvestInfo=`\u0110\u1EB7t 1 chu\u1ED3ng t\u1EA1i (${e.row}, ${e.col}).`}else this.canPlacePen(e.row,e.col)?this.lastHarvestInfo="H\u1EBFt chu\u1ED3ng trong t\xFAi!":this.lastHarvestInfo="Kh\xF4ng \u0111\u1EE7 ch\u1ED7 (c\u1EA7n 2x2 c\u1ECF) ho\u1EB7c \u0111\xE3 ra r\xECa/tr\xEAn n\u01B0\u1EDBc!"}onTileClick(e){switch(this.selectedTool()){case"place_soil":this.placeSoil(e);break;case"place_pen":this.placePen(e);break;case"plant":case"harvest":this.handlePlantHarvestClick(e);break}}handlePlantHarvestClick(e){let t=this.selectedTool();if(e.type!=="soil"){this.lastHarvestInfo="Ch\u1EC9 c\xF3 th\u1EC3 tr\u1ED3ng/thu ho\u1EA1ch tr\xEAn \u0111\u1EA5t tr\u1ED3ng!";return}let n=this.mapTilesSignal()[e.row][e.col];if(t==="plant"&&n.state==="empty"){let o=this.selectedCropId(),r=this.crops.find(T=>T.id===o),p=["kim","moc","thuy","hoa","tho"][n.soilType],d=x({},this.inventory()),h=`crop${r.id}`;if(!d[h]||d[h]<=0){this.lastHarvestInfo=`Kh\xF4ng \u0111\u1EE7 h\u1EA1t gi\u1ED1ng ${r.name}!`;return}d[h]--,this.inventory.set(d);let v=1,y=1;this.birthMap[r.element]===p?(v=1.5,y=.8):this.killMap[r.element]===p&&(v=.7,y=1.3);let S={state:"seed",cropId:r.id,effectiveGrowthTime:Math.ceil(r.growthTime*y),effectiveHarvestValue:Math.ceil(r.harvestValue*v),growthProgress:0};this.updateTile(e.row,e.col,S),this.growingPlots.update(T=>[...T,x(x({},n),S)]),this.lastHarvestInfo=`Tr\u1ED3ng ${r.name}.`}else if(t==="harvest"&&n.state==="ready"&&n.cropId!==null){let o=this.crops.find(h=>h.id===n.cropId),r=n.effectiveHarvestValue;this.money.set(this.money()+r),this.increasePlayerXP(r);let p=x({},this.inventory()),d=[];p[`fruit${o.id}`]=(p[`fruit${o.id}`]||0)+1,d.push(`${o.name}: 1`),Math.random()<this.seedDropRate&&(p[`crop${o.id}`]=(p[`crop${o.id}`]||0)+1,d.push(`${o.name} Seed: 1`)),(this.cropMaterials[o.id]||[]).forEach(h=>{Math.random()<this.materialDropRate&&(p[`mat${h.id}`]=(p[`mat${h.id}`]||0)+1,d.push(`${h.name}: 1`))}),this.inventory.set(p),this.lastHarvestInfo=`Thu ho\u1EA1ch ${o.name} (+${r} Ti\u1EC1n, +${r} XP): ${d.join(", ")}`,this.updateTile(e.row,e.col,{state:"empty",cropId:null,growthProgress:0,effectiveGrowthTime:0,effectiveHarvestValue:0}),this.growingPlots.update(h=>h.filter(v=>v.id!==e.id))}else t==="plant"&&n.state!=="empty"?this.lastHarvestInfo="\xD4 \u0111\u1EA5t n\xE0y ch\u01B0a s\u1EB5n s\xE0ng \u0111\u1EC3 tr\u1ED3ng!":t==="harvest"&&n.state!=="ready"&&(this.lastHarvestInfo="C\xE2y ch\u01B0a ch\xEDn \u0111\u1EC3 thu ho\u1EA1ch!")}updateGrowthOptimized(){let e=this.growingPlots();if(e.length===0)return;let t=this.mapTilesSignal(),i=[];e.forEach(n=>{let o=t[n.row][n.col];if((o.state==="seed"||o.state==="growing")&&o.cropId){let r=o.growthProgress+1,p=o.state;r>=o.effectiveGrowthTime?p="ready":(p="growing",i.push(X(x({},o),{growthProgress:r,state:p}))),r!==o.growthProgress||p!==o.state?this.updateTile(o.row,o.col,{growthProgress:r,state:p}):p==="growing"&&i.push(o)}}),this.growingPlots.set(i)}handleWheel(e){e.preventDefault();let t=1.1,i=this.zoomLevel(),n;if(e.deltaY<0?n=Math.min(4,i*t):n=Math.max(.1,i/t),n!==i){let r=this.mapContainerRef.nativeElement.getBoundingClientRect(),p=e.clientX-r.left,d=e.clientY-r.top,h=(p-this.panX())/i,v=(d-this.panY())/i,y=p-h*n,S=d-v*n;this.zoomLevel.set(n),this.panX.set(this.clampPan(y,this.viewportWidth(),this.cols*this.baseTileSize*n)),this.panY.set(this.clampPan(S,this.viewportHeight(),this.rows*this.baseTileSize*n))}}zoomIn(){let e=this.mapContainerRef.nativeElement,t=e.clientWidth/2,i=e.clientHeight/2;this.handleWheel({deltaY:-100,clientX:t+e.getBoundingClientRect().left,clientY:i+e.getBoundingClientRect().top,preventDefault:()=>{}})}zoomOut(){let e=this.mapContainerRef.nativeElement,t=e.clientWidth/2,i=e.clientHeight/2;this.handleWheel({deltaY:100,clientX:t+e.getBoundingClientRect().left,clientY:i+e.getBoundingClientRect().top,preventDefault:()=>{}})}clampPan(e,t,i){let o=Math.min(50,t-i-50);return Math.max(o,Math.min(50,e))}onMouseDown(e){e.preventDefault(),this.isPanning.set(!0),this.lastPanCoords={x:e.clientX,y:e.clientY},this.mapContainerRef.nativeElement.style.cursor="grabbing"}onMouseMove(e){if(!this.isPanning())return;e.preventDefault();let t=e.clientX-this.lastPanCoords.x,i=e.clientY-this.lastPanCoords.y;this.lastPanCoords={x:e.clientX,y:e.clientY};let n=this.zoomLevel(),o=this.cols*this.baseTileSize*n,r=this.rows*this.baseTileSize*n;this.panX.update(p=>this.clampPan(p+t,this.viewportWidth(),o)),this.panY.update(p=>this.clampPan(p+i,this.viewportHeight(),r))}onMouseUp(e){this.isPanning()&&(this.isPanning.set(!1),this.mapContainerRef.nativeElement.style.cursor="grab")}onMouseLeave(e){e.relatedTarget===null&&this.isPanning()&&this.onMouseUp(e)}handleTouchStart(e){e.preventDefault(),this.touchStartTime=Date.now();let t=e.touches;t.length===1?(this.isPanning.set(!0),this.lastPanCoords={x:t[0].clientX,y:t[0].clientY},this.lastPinchDistance=0):t.length===2&&(this.isPanning.set(!1),this.lastPinchDistance=this.getPinchDistance(t))}handleTouchMove(e){e.preventDefault();let t=e.touches;if(t.length===1&&this.isPanning()){let i=t[0].clientX-this.lastPanCoords.x,n=t[0].clientY-this.lastPanCoords.y;this.lastPanCoords={x:t[0].clientX,y:t[0].clientY};let o=this.zoomLevel(),r=this.cols*this.baseTileSize*o,p=this.rows*this.baseTileSize*o;this.panX.update(d=>this.clampPan(d+i,this.viewportWidth(),r)),this.panY.update(d=>this.clampPan(d+n,this.viewportHeight(),p))}else if(t.length===2&&this.lastPinchDistance>0){let i=this.getPinchDistance(t),n=i/this.lastPinchDistance;this.lastPinchDistance=i;let o=this.zoomLevel(),r=o*n;if(r=Math.max(.1,Math.min(4,r)),r!==o){let d=this.mapContainerRef.nativeElement.getBoundingClientRect(),h=(t[0].clientX+t[1].clientX)/2-d.left,v=(t[0].clientY+t[1].clientY)/2-d.top,y=(h-this.panX())/o,S=(v-this.panY())/o,T=h-y*r,E=v-S*r;this.zoomLevel.set(r),this.panX.set(this.clampPan(T,this.viewportWidth(),this.cols*this.baseTileSize*r)),this.panY.set(this.clampPan(E,this.viewportHeight(),this.rows*this.baseTileSize*r))}}}handleTouchEnd(e){e.preventDefault();let t=e.changedTouches;if(t.length===0)return;let i=t[0],n=Date.now()-this.touchStartTime,o=this.lastPanCoords.x,r=this.lastPanCoords.y,p=i.clientX,d=i.clientY,h=p-o,v=d-r,y=Math.sqrt(h*h+v*v);if(this.isPanning()&&n<this.tapThreshold&&y<this.tapMoveThreshold){let T=this.mapContainerRef.nativeElement.getBoundingClientRect(),E=i.clientX-T.left,I=i.clientY-T.top,B=this.zoomLevel(),ce=(E-this.panX())/B,pe=(I-this.panY())/B,me=Math.floor(ce/this.baseTileSize),de=Math.floor(pe/this.baseTileSize),W=this.mapTilesSignal()[de]?.[me];W&&this.onTileClick(W)}this.isPanning.set(!1),this.lastPinchDistance=0,this.mapContainerRef&&(this.mapContainerRef.nativeElement.style.cursor="grab")}getPinchDistance(e){let t=e[0].clientX-e[1].clientX,i=e[0].clientY-e[1].clientY;return Math.sqrt(t*t+i*i)}getRemainingTime=e=>Math.max(0,e.effectiveGrowthTime-e.growthProgress);getCropById=e=>this.crops.find(t=>t.id===e);getSoilColor=e=>this.soilColors[["kim","moc","thuy","hoa","tho"][e.soilType]];getTileColor(e){switch(e){case"grass":return"#66bb6a";case"water":return"#42a5f5";case"soil":return"#A0522D";case"pen":return"#D2B48C";default:return"#bdbdbd"}}selectSeed(e){this.selectedCropId.set(e),this.selectedTool.set("plant"),this.isMobileSidebarOpen.set(!1)}toggleInventoryDialog=()=>this.showInventoryDialog=!this.showInventoryDialog;increasePlayerXP(e){let t=this.playerXP(),i=this.playerLevel();for(t+=e;t>=i*20;)t-=i*20,i++;this.playerXP.set(t),this.playerLevel.set(i)}onKey=e=>{if(e.key>="1"&&e.key<="5"){let t=+e.key-1;this.crops[t]&&this.selectSeed(this.crops[t].id)}e.key.toLowerCase()==="i"&&this.toggleInventoryDialog(),e.key.toLowerCase()==="h"&&this.selectedTool.set("harvest"),e.key.toLowerCase()==="p"&&this.selectedTool.set("plant"),e.key.toLowerCase()==="d"&&this.selectedTool.set("place_soil"),e.key.toLowerCase()==="c"&&this.selectedTool.set("place_pen")};trackTileById=(e,t)=>t.id;toggleMobileSidebar(){this.isMobileSidebarOpen.update(e=>!e)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=G({type:a,selectors:[["app-farm"]],viewQuery:function(t,i){if(t&1&&q(he,5),t&2){let n;K(n=Z())&&(i.mapContainerRef=n.first)}},hostBindings:function(t,i){t&1&&w("resize",function(){return i.updateViewportSize()},!1,H)("mousemove",function(o){return i.onMouseMove(o)},!1,H)("mouseup",function(o){return i.onMouseUp(o)},!1,H)("mouseleave",function(o){return i.onMouseLeave(o)},!1,H)},decls:58,vars:42,consts:[["mapContainer",""],[1,"flex","w-screen","h-screen","overflow-hidden","font-sans","text-gray-900"],["aria-label","Toggle Menu",1,"md:hidden","fixed","top-2","left-2","z-50","p-2","bg-gray-700","text-white","rounded-md","shadow-lg",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6h16M4 12h16m-7 6h7"],["class","md:hidden fixed inset-0 bg-black/50 z-30",3,"click",4,"ngIf"],[1,"w-64","p-4","bg-gray-100","border-r","border-gray-300","flex","flex-col","gap-4","overflow-y-auto","shrink-0","transition-transform","duration-300","ease-in-out","z-40",3,"ngClass"],[1,"md:hidden","self-end","p-1","text-2xl",3,"click"],[1,"text-xl","font-bold","text-center","text-gray-800"],[1,"bg-white","p-3","rounded-lg","shadow-md"],[1,"text-lg","font-semibold","text-center","text-gray-800","mb-2"],[1,"text-sm"],[1,"font-medium"],[1,"grid","grid-cols-2","gap-2","text-sm"],[1,"p-2","rounded","transition","duration-150",3,"click","ngClass"],["class","p-2 border-2 rounded-md cursor-pointer mb-1 flex justify-between items-center transition duration-200 ease-in-out hover:bg-gray-200",3,"ngClass","borderColor","click",4,"ngFor","ngForOf"],[1,"bg-white","p-3","rounded-lg","shadow-md","flex","justify-around","items-center"],[1,"px-3","py-1","bg-blue-500","text-white","rounded","hover:bg-blue-600","text-lg","font-bold","transition","active:scale-95",3,"click"],[1,"text-sm","text-center","self-center"],[1,"w-full","p-3","bg-purple-600","text-white","rounded-md","cursor-pointer","text-center","hover:bg-purple-700","transition",3,"click"],[1,"mt-auto","p-3","bg-yellow-50","border","border-yellow-300","rounded-md","min-h-[60px]","text-sm","text-gray-800","break-words"],[1,"flex-grow","overflow-hidden","bg-gray-900","relative","cursor-grab",2,"touch-action","none",3,"wheel","mousedown","touchstart","touchmove","touchend","touchcancel"],[1,"absolute","top-0","left-0",2,"transform-origin","0 0"],["class","absolute border border-black/20 box-border flex flex-col items-center justify-center text-xs select-none transition-colors duration-100",3,"width","height","left","top","backgroundColor","ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","fixed inset-0 bg-black/70 flex justify-center items-center z-[100]",3,"click",4,"ngIf"],[1,"md:hidden","fixed","inset-0","bg-black/50","z-30",3,"click"],[1,"p-2","border-2","rounded-md","cursor-pointer","mb-1","flex","justify-between","items-center","transition","duration-200","ease-in-out","hover:bg-gray-200",3,"click","ngClass"],[1,"text-sm","text-gray-600"],[1,"absolute","border","border-black/20","box-border","flex","flex-col","items-center","justify-center","text-xs","select-none","transition-colors","duration-100",3,"click","ngClass"],[4,"ngIf"],[3,"ngSwitch"],["class","font-bold text-white/70 text-[0.6rem]",4,"ngSwitchCase"],[4,"ngSwitchCase"],["class","font-bold text-[0.6rem] animate-pulse",3,"color",4,"ngSwitchCase"],[1,"font-bold","text-white/70","text-[0.6rem]"],[1,"font-bold","text-center","leading-tight","text-[0.6rem]"],[1,"text-[0.5rem]","text-white","bg-black/40","px-0.5","rounded-sm"],[1,"font-bold","text-[0.6rem]","animate-pulse"],[1,"text-base","font-bold","text-gray-800/80"],[1,"text-blue-900/30","text-lg"],[1,"fixed","inset-0","bg-black/70","flex","justify-center","items-center","z-[100]",3,"click"],[1,"bg-white","p-5","rounded-lg","shadow-xl","w-11/12","max-w-3xl","max-h-[85vh]","relative","flex","flex-col",3,"click"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-2xl","font-bold","text-gray-800"],[1,"bg-transparent","border-none","text-3xl","cursor-pointer","text-gray-500","hover:text-black","transition",3,"click"],[1,"grid","grid-cols-2","sm:grid-cols-3","md:grid-cols-4","lg:grid-cols-5","gap-3","overflow-y-auto","p-2","border","border-gray-200","min-h-[200px]","rounded-md","bg-gray-50"],["class","border border-gray-300 rounded-lg p-2 text-center bg-white flex flex-col items-center justify-between hover:shadow-md transition duration-150",4,"ngFor","ngForOf"],["class","col-span-full text-center p-8 text-gray-400",4,"ngIf"],[1,"border","border-gray-300","rounded-lg","p-2","text-center","bg-white","flex","flex-col","items-center","justify-between","hover:shadow-md","transition","duration-150"],[1,"w-8","h-8","rounded-full","flex","justify-center","items-center","text-sm","font-bold","text-white","mb-1","shadow-inner"],[1,"text-[0.65rem]","font-semibold","mb-0.5","break-words","w-full","leading-tight"],[1,"text-xs","text-gray-500"],[1,"col-span-full","text-center","p-8","text-gray-400"]],template:function(t,i){if(t&1){let n=V();s(0,"div",1)(1,"button",2),w("click",function(){return u(n),g(i.toggleMobileSidebar())}),A(),s(2,"svg",3),N(3,"path",4),l()(),P(4,ve,1,0,"div",5),j(),s(5,"div",6)(6,"button",7),w("click",function(){return u(n),g(i.toggleMobileSidebar())}),m(7,"\xD7"),l(),s(8,"h1",8),m(9,"N\xF4ng Tr\u1EA1i H\xF2n \u0110\u1EA3o"),l(),s(10,"div",9)(11,"h2",10),m(12,"Tr\u1EA1ng Th\xE1i"),l(),s(13,"div",11),m(14,"Ti\u1EC1n: "),s(15,"span",12),m(16),l()(),s(17,"div",11),m(18,"C\u1EA5p \u0111\u1ED9: "),s(19,"span",12),m(20),l()(),s(21,"div",11),m(22,"Kinh nghi\u1EC7m: "),s(23,"span",12),m(24),l()()(),s(25,"div",9)(26,"h2",10),m(27,"C\xF4ng C\u1EE5 (H, P, D, C)"),l(),s(28,"div",13)(29,"button",14),w("click",function(){return u(n),i.selectedTool.set("harvest"),g(i.isMobileSidebarOpen.set(!1))}),m(30,"Thu Ho\u1EA1ch (H)"),l(),s(31,"button",14),w("click",function(){return u(n),i.selectedTool.set("plant"),g(i.isMobileSidebarOpen.set(!1))}),m(32,"Tr\u1ED3ng C\xE2y (P)"),l(),s(33,"button",14),w("click",function(){return u(n),i.selectedTool.set("place_soil"),g(i.isMobileSidebarOpen.set(!1))}),m(34),l(),s(35,"button",14),w("click",function(){return u(n),i.selectedTool.set("place_pen"),g(i.isMobileSidebarOpen.set(!1))}),m(36),l()()(),s(37,"div",9)(38,"h2",10),m(39,"Ch\u1ECDn H\u1EA1t Gi\u1ED1ng (1-5)"),l(),P(40,we,5,9,"div",15),l(),s(41,"div",16)(42,"button",17),w("click",function(){return u(n),g(i.zoomIn())}),m(43,"+"),l(),s(44,"span",18),m(45),$(46,"number"),l(),s(47,"button",17),w("click",function(){return u(n),g(i.zoomOut())}),m(48,"-"),l()(),s(49,"button",19),w("click",function(){return u(n),g(i.toggleInventoryDialog())}),m(50,"M\u1EDF T\xFAi \u0110\u1ED3 (I)"),l(),s(51,"div",20),m(52),l()(),s(53,"div",21,0),w("wheel",function(r){return u(n),g(i.handleWheel(r))})("mousedown",function(r){return u(n),g(i.onMouseDown(r))})("touchstart",function(r){return u(n),g(i.handleTouchStart(r))})("touchmove",function(r){return u(n),g(i.handleTouchMove(r))})("touchend",function(r){return u(n),g(i.handleTouchEnd(r))})("touchcancel",function(r){return u(n),g(i.handleTouchEnd(r))}),s(55,"div",22),P(56,Ee,4,20,"div",23),l()(),P(57,Me,10,2,"div",24),l()}t&2&&(c(4),f("ngIf",i.isMobileSidebarOpen()),c(),f("ngClass",M(27,ue,i.isMobileSidebarOpen(),!i.isMobileSidebarOpen())),c(11),z(i.money()),c(4),z(i.playerLevel()),c(4),L("",i.playerXP()," / ",i.playerLevel()*20,""),c(5),f("ngClass",M(30,R,i.selectedTool()==="harvest",i.selectedTool()!=="harvest")),c(2),f("ngClass",M(33,R,i.selectedTool()==="plant",i.selectedTool()!=="plant")),c(2),f("ngClass",M(36,R,i.selectedTool()==="place_soil",i.selectedTool()!=="place_soil")),c(),C("\u0110\u1EB7t \u0110\u1EA5t (",i.inventory().soil||0,") (D)"),c(),f("ngClass",M(39,R,i.selectedTool()==="place_pen",i.selectedTool()!=="place_pen")),c(),C("\u0110\u1EB7t Chu\u1ED3ng (",i.inventory().pen||0,") (C)"),c(4),f("ngForOf",i.crops),c(5),C("",J(46,24,i.zoomLevel(),"1.1-1"),"x"),c(7),C(" ",i.lastHarvestInfo," "),c(3),k("width",i.cols*i.baseTileSize,"px")("height",i.rows*i.baseTileSize,"px")("transform",i.mapTransform()),c(),f("ngForOf",i.visibleTiles())("ngForTrackBy",i.trackTileById),c(),f("ngIf",i.showInventoryDialog))},dependencies:[ae,ee,te,ie,ne,oe,re,se],encapsulation:2,changeDetection:0})};export{le as FarmComponent};
