import{n as ne}from"./chunk-WUATMGZA.js";import{j as ee,k as D,l as N,p as O,r as te,w}from"./chunk-VJ2NH5IP.js";import{$b as p,Ac as Z,Bb as b,D as H,Ga as Q,Hb as v,Ic as M,Jc as _,Lc as W,Mc as Y,Na as g,Rb as s,Vb as F,ac as a,bc as E,fa as J,fc as P,jc as h,kc as T,la as K,ob as l,ua as x,va as C,xc as c,zc as G}from"./chunk-BDFDBNPH.js";import"./chunk-EU2KAMEK.js";import{a as f,b as B}from"./chunk-47CWAPKR.js";var oe={basic:{type:"basic",maxHp:50,speed:2,bounty:10},fast:{type:"fast",maxHp:30,speed:4,bounty:15}},ie={basic:{type:"basic",cost:50,range:100,damage:15,attackSpeed:30}},$=[{x:0,y:200},{x:150,y:200},{x:150,y:50},{x:400,y:50},{x:400,y:300},{x:600,y:300}],re=[{position:{x:75,y:150}},{position:{x:250,y:100}},{position:{x:350,y:200}},{position:{x:500,y:250}}];var A=class o{money=g(100);lives=g(10);enemies=g([]);towers=g([]);buildSpots=g([]);gameStatus=g("waiting");path=$;enemyTypes=oe;towerTypes=ie;gameTickInterval=30;gameSubscription=null;enemySpawnSubscription=null;nextEnemyId=0;nextTowerId=0;tickCount=0;constructor(){console.log("GameService initialized")}initializeGame(){console.log("Initializing game..."),this.money.set(100),this.lives.set(10),this.enemies.set([]),this.towers.set([]),this.gameStatus.set("waiting"),this.tickCount=0,this.nextEnemyId=0,this.nextTowerId=0;let t=re.map((e,n)=>({id:n,position:e.position,occupiedBy:null}));this.buildSpots.set(t),console.log("Game initialized.")}startGame(){this.gameStatus()!=="playing"&&(this.gameStatus.set("playing"),console.log("Game started!"),this.startGameLoop(),this.startEnemySpawning())}stopGame(){this.gameStatus.set("gameOver"),this.stopGameLoop(),this.stopEnemySpawning(),console.log("Game stopped.")}startGameLoop(){this.gameSubscription&&this.gameSubscription.unsubscribe(),this.gameSubscription=H(this.gameTickInterval).subscribe(()=>{this.tickCount++,this.moveEnemies(),this.towersAttack(),this.checkGameStatus()}),console.log("Game loop started.")}stopGameLoop(){this.gameSubscription&&(this.gameSubscription.unsubscribe(),this.gameSubscription=null)}startEnemySpawning(){this.enemySpawnSubscription&&this.enemySpawnSubscription.unsubscribe();let t=0,e=10,n=2e3;this.enemySpawnSubscription=H(n).subscribe(()=>{t<e&&this.gameStatus()==="playing"?(this.spawnEnemy("basic"),t++,console.log(`Spawned enemy ${t}/${e}`)):t>=e&&(this.stopEnemySpawning(),console.log("Enemy spawning finished for this wave."))}),console.log("Enemy spawning started.")}stopEnemySpawning(){this.enemySpawnSubscription&&(this.enemySpawnSubscription.unsubscribe(),this.enemySpawnSubscription=null)}spawnEnemy(t){let e=this.enemyTypes[t];if(!e||this.path.length===0)return;let n=this.path[0],i=B(f({},e),{id:this.nextEnemyId++,hp:e.maxHp,pathProgress:0,position:f({},n)});this.enemies.update(r=>[...r,i])}moveEnemies(){this.enemies.update(t=>t.map(n=>{let i=f({},n),r=0,m=0;for(let y=0;y<this.path.length-1;y++){let ce=this.path[y],me=this.path[y+1],X=this.distance(ce,me);if(i.pathProgress<m+X){r=y+1;break}m+=X,r=y+2}if(r>=this.path.length)return console.log(`Enemy ${i.id} reached the end.`),this.lives.update(y=>y-1),null;let d=this.path[r-1],S=this.path[r],u=this.distance(d,S),I=i.pathProgress-m+i.speed,le=m+I;i.pathProgress=le;let q=Math.min(1,I/u);return i.position={x:d.x+(S.x-d.x)*q,y:d.y+(S.y-d.y)*q},i}).filter(n=>n!==null))}towersAttack(){let t=this.enemies();this.towers().length===0||t.length===0||this.towers.update(e=>e.map(i=>{let r=f({},i);if(this.tickCount-r.lastFired>=r.attackSpeed){let m=this.enemies().find(d=>this.distance(r.position,d.position)<=r.range);m&&(console.log(`Tower ${r.id} attacking Enemy ${m.id}`),this.enemies.update(d=>d.map(u=>{if(u.id===m.id){let k=B(f({},u),{hp:u.hp-r.damage});return k.hp<=0?(console.log(`Enemy ${k.id} defeated!`),this.money.update(I=>I+k.bounty),null):k}return u}).filter(u=>u!==null)),r.lastFired=this.tickCount)}return r}))}buildTower(t,e){let n=this.buildSpots().find(r=>r.id===t),i=this.towerTypes[e];if(n&&n.occupiedBy===null&&i&&this.money()>=i.cost){this.money.update(m=>m-i.cost);let r=B(f({},i),{id:this.nextTowerId++,position:f({},n.position),lastFired:0});return this.towers.update(m=>[...m,r]),this.buildSpots.update(m=>{let d=[...m],S=d.find(u=>u.id===t);return S&&(S.occupiedBy=r.id),d}),console.log(`Built ${e} tower at spot ${t}. Money left: ${this.money()}`),!0}else console.log(`Could not build tower at spot ${t}. Reasons: Spot occupied? ${n?.occupiedBy!==null}, Enough money? ${this.money()>=(i?.cost||1/0)}`);return!1}checkGameStatus(){this.lives()<=0&&(this.gameStatus.set("gameOver"),this.stopGame(),console.log("Game Over! Lives: 0"))}distance(t,e){let n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}getTowerTypesList(){return Object.values(this.towerTypes).map(t=>({type:t.type,cost:t.cost}))}ngOnDestroy(){this.stopGameLoop(),this.stopEnemySpawning(),console.log("GameService destroyed")}static \u0275fac=function(e){return new(e||o)};static \u0275prov=J({token:o,factory:o.\u0275fac,providedIn:"root"})};var de=(o,t)=>({"left.px":o,"top.px":t}),ue=o=>({"width.%":o}),z=class o{enemy;static \u0275fac=function(e){return new(e||o)};static \u0275cmp=b({type:o,selectors:[["app-enemy"]],inputs:{enemy:"enemy"},decls:3,vars:10,consts:[[3,"ngStyle"],[1,"hp-bar-container"],[1,"hp-bar",3,"ngStyle"]],template:function(e,n){e&1&&(p(0,"div",0)(1,"div",1),E(2,"div",2),a()()),e&2&&(F("enemy ",n.enemy.type,""),s("ngStyle",_(5,de,n.enemy.position.x-15,n.enemy.position.y-15)),l(2),s("ngStyle",M(8,ue,n.enemy.hp/n.enemy.maxHp*100)))},dependencies:[w,O],styles:[".enemy[_ngcontent-%COMP%]{position:absolute;width:30px;height:30px;background-color:red;border-radius:50%;border:1px solid black;z-index:10;box-sizing:border-box;display:flex;justify-content:center;align-items:center;font-size:.8em;color:#fff;font-weight:700}.enemy.basic[_ngcontent-%COMP%]{background-color:#dc143c}.enemy.fast[_ngcontent-%COMP%]{background-color:orange}.hp-bar-container[_ngcontent-%COMP%]{position:absolute;top:-8px;left:0;width:100%;height:4px;background-color:gray;border-radius:2px;overflow:hidden}.hp-bar[_ngcontent-%COMP%]{height:100%;background-color:#32cd32;transition:width .1s linear}"],changeDetection:0})};var ge=(o,t)=>({"left.px":o,"top.px":t}),V=class o{tower;static \u0275fac=function(e){return new(e||o)};static \u0275cmp=b({type:o,selectors:[["app-tower"]],inputs:{tower:"tower"},decls:2,vars:7,consts:[[3,"ngStyle"]],template:function(e,n){e&1&&(p(0,"div",0),c(1," \u{1F6E1}\uFE0F "),a()),e&2&&(F("tower tower-",n.tower.type,""),s("ngStyle",_(4,ge,n.tower.position.x-20,n.tower.position.y-20)))},dependencies:[w,O],styles:[".tower[_ngcontent-%COMP%]{position:absolute;width:40px;height:40px;background-color:#4682b4;border:2px solid royalblue;border-radius:5px;z-index:20;display:flex;justify-content:center;align-items:center;font-size:1.2em}.tower.basic[_ngcontent-%COMP%]{background-color:#66cdaa;border-color:teal}"],changeDetection:0})};var se=(o,t)=>({"left.px":o,"top.px":t});function ye(o,t){if(o&1&&E(0,"div",6),o&2){let e=t.$implicit;s("ngStyle",_(1,se,e.x,e.y))}}function fe(o,t){o&1&&(p(0,"span"),c(1,"+"),a())}function be(o,t){if(o&1){let e=P();p(0,"div",7),h("click",function(){let i=x(e).$implicit,r=T();return C(r.onBuildSpotClick(i))}),v(1,fe,2,0,"span",8),a()}if(o&2){let e=t.$implicit;s("ngStyle",_(2,se,e.position.x-25,e.position.y-25)),l(),s("ngIf",e.occupiedBy===null)}}function he(o,t){if(o&1&&E(0,"app-enemy",9),o&2){let e=t.$implicit;s("enemy",e)}}function we(o,t){if(o&1&&E(0,"app-tower",10),o&2){let e=t.$implicit;s("tower",e)}}var j=class o{enemies=null;towers=null;buildSpots=null;selectedTowerType=null;buildTower=new Q;path=$;onBuildSpotClick(t){this.selectedTowerType&&t.occupiedBy===null?(console.log(`Build spot ${t.id} clicked, attempting to build ${this.selectedTowerType}`),this.buildTower.emit({spotId:t.id,towerType:this.selectedTowerType})):console.log(`Build spot ${t.id} clicked, cannot build. Selected type: ${this.selectedTowerType}, Occupied: ${t.occupiedBy!==null}`)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=b({type:o,selectors:[["app-game-area"]],inputs:{enemies:"enemies",towers:"towers",buildSpots:"buildSpots",selectedTowerType:"selectedTowerType"},outputs:{buildTower:"buildTower"},decls:6,vars:4,consts:[[1,"game-area"],[1,"path"],["class","path-point",3,"ngStyle",4,"ngFor","ngForOf"],["class","build-spot",3,"ngStyle","click",4,"ngFor","ngForOf"],[3,"enemy",4,"ngFor","ngForOf"],[3,"tower",4,"ngFor","ngForOf"],[1,"path-point",3,"ngStyle"],[1,"build-spot",3,"click","ngStyle"],[4,"ngIf"],[3,"enemy"],[3,"tower"]],template:function(e,n){e&1&&(p(0,"div",0)(1,"div",1),v(2,ye,1,4,"div",2),a(),v(3,be,2,5,"div",3)(4,he,1,1,"app-enemy",4)(5,we,1,1,"app-tower",5),a()),e&2&&(l(2),s("ngForOf",n.path),l(),s("ngForOf",n.buildSpots),l(),s("ngForOf",n.enemies),l(),s("ngForOf",n.towers))},dependencies:[w,D,N,O,z,V],styles:[".game-area[_ngcontent-%COMP%]{position:relative;width:600px;height:400px;border:2px solid #333;margin:20px auto;background-color:#c8e6c9;overflow:hidden}.path[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%}.path-point[_ngcontent-%COMP%]{position:absolute;width:10px;height:10px;background-color:#8b451380;border-radius:50%;transform:translate(-50%,-50%);z-index:5}.build-spot[_ngcontent-%COMP%]{position:absolute;width:50px;height:50px;background-color:#80808080;border:1px dashed #333;display:flex;justify-content:center;align-items:center;cursor:pointer;z-index:15;font-size:2em;color:#fff;font-weight:700}.build-spot[_ngcontent-%COMP%]:hover{background-color:#808080cc}.range-indicator[_ngcontent-%COMP%]{position:absolute;border:1px dashed blue;border-radius:50%;background-color:#0000ff1a;pointer-events:none;transform:translate(-50%,-50%);z-index:18}"],changeDetection:0})};var pe=o=>({selected:o});function Se(o,t){if(o&1){let e=P();p(0,"div",8)(1,"h2"),c(2,"GAME OVER!"),a(),p(3,"button",9),h("click",function(){x(e);let i=T();return C(i.restartGame())}),c(4,"Ch\u01A1i l\u1EA1i"),a()()}}function ve(o,t){if(o&1){let e=P();p(0,"div",10)(1,"button",9),h("click",function(){x(e);let i=T();return C(i.startGame())}),c(2,"B\u1EAFt \u0111\u1EA7u \u0111\u1EE3t l\xEDnh"),a()()}}function Te(o,t){if(o&1){let e=P();p(0,"button",11),h("click",function(){let i=x(e).$implicit,r=T();return C(r.selectTowerToBuild(i.type))}),c(1),W(2,"uppercase"),a()}if(o&2){let e=t.$implicit,n=T();s("disabled",n.money()<e.cost)("ngClass",M(6,pe,n.selectedTowerTypeToBuild()===e.type)),l(),Z(" ",Y(2,4,e.type)," (",e.cost,"\u{1F4B0}) ")}}var ae=class o{gameService=K(A);money=this.gameService.money;lives=this.gameService.lives;enemies=this.gameService.enemies;towers=this.gameService.towers;buildSpots=this.gameService.buildSpots;gameStatus=this.gameService.gameStatus;selectedTowerTypeToBuild=g(null);towerTypesList=this.gameService.getTowerTypesList();constructor(){}ngOnInit(){console.log("TownerdefenseComponent OnInit. Initializing game..."),this.gameService.initializeGame()}startGame(){this.gameService.startGame()}restartGame(){this.gameService.initializeGame(),this.selectedTowerTypeToBuild.set(null)}selectTowerToBuild(t){this.selectedTowerTypeToBuild.set(t),console.log(`Selected tower to build: ${t}`)}handleBuildTower(t){console.log("Handling build tower event in TownerdefenseComponent",t),this.gameService.buildTower(t.spotId,t.towerType)&&this.selectedTowerTypeToBuild.set(null)}ngOnDestroy(){console.log("TownerdefenseComponent OnDestroy. Stopping game..."),this.gameService.stopGame()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=b({type:o,selectors:[["app-root"]],decls:20,vars:15,consts:[[1,"container"],[1,"game-info"],["class","game-over",4,"ngIf"],["class","start-game",4,"ngIf"],[1,"toolbar"],[3,"disabled","ngClass","click",4,"ngFor","ngForOf"],[3,"click","ngClass"],[3,"buildTower","enemies","towers","buildSpots","selectedTowerType"],[1,"game-over"],[3,"click"],[1,"start-game"],[3,"click","disabled","ngClass"]],template:function(e,n){e&1&&(p(0,"div",0)(1,"h1"),c(2,"Simple Tower Defense"),a(),p(3,"div",1)(4,"div"),c(5),a(),p(6,"div"),c(7),a(),p(8,"div"),c(9),W(10,"uppercase"),a()(),v(11,Se,5,0,"div",2)(12,ve,3,0,"div",3),p(13,"div",4)(14,"h3"),c(15,"X\xE2y th\xE1p:"),a(),v(16,Te,3,8,"button",5),p(17,"button",6),h("click",function(){return n.selectTowerToBuild(null)}),c(18," H\u1EE7y ch\u1ECDn "),a()(),p(19,"app-game-area",7),h("buildTower",function(r){return n.handleBuildTower(r)}),a()()),e&2&&(l(5),G("\u{1F4B0} Ti\u1EC1n: ",n.money(),""),l(2),G("\u2764\uFE0F M\u1EA1ng: ",n.lives(),""),l(2),G("Tr\u1EA1ng th\xE1i: ",Y(10,11,n.gameStatus()),""),l(2),s("ngIf",n.gameStatus()==="gameOver"),l(),s("ngIf",n.gameStatus()==="waiting"),l(4),s("ngForOf",n.towerTypesList),l(),s("ngClass",M(13,pe,n.selectedTowerTypeToBuild()===null)),l(2),s("enemies",n.enemies())("towers",n.towers())("buildSpots",n.buildSpots())("selectedTowerType",n.selectedTowerTypeToBuild()))},dependencies:[w,ee,D,N,te,ne,j],styles:[".container[_ngcontent-%COMP%]{font-family:sans-serif;text-align:center;padding:20px;background-color:#f4f4f4;-webkit-user-select:none;user-select:none}h1[_ngcontent-%COMP%]{color:#333;margin-bottom:10px}.game-info[_ngcontent-%COMP%]{margin-bottom:15px;font-size:1.2em;color:#555;display:flex;justify-content:center;gap:20px}.toolbar[_ngcontent-%COMP%]{margin-top:20px;margin-bottom:20px;padding:10px;border:1px solid #ddd;background-color:#fff;display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center}.toolbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 15px;font-size:1em;cursor:pointer;border:1px solid #ccc;border-radius:4px;background-color:#e9e9e9;transition:background-color .2s ease}.toolbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#d0d0d0}.toolbar[_ngcontent-%COMP%]   button.selected[_ngcontent-%COMP%]{background-color:#a8e6cf;border-color:#5cb85c;font-weight:700}.toolbar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.game-over[_ngcontent-%COMP%]{margin-top:20px;color:#dc143c}.game-over[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .start-game[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 20px;font-size:1.2em;cursor:pointer;background-color:#4caf50;color:#fff;border:none;border-radius:5px;margin-top:10px}.game-over[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .start-game[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#45a049}"]})};export{ae as TownerdefenseComponent};
