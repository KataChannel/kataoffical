    <script>
      const localapi="http://localhost:3105"
      const serverapi="https://apiaffiliate.tazagroup.vn"
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('8acv49xg');
            const submitButton = form.querySelector('button[type="submit"]');
            const buttonLoader = form.querySelector('.button-loader');

            // Simple phone number validation (Vietnamese format: starts with 0, followed by 9 digits)
            const validatePhoneNumber = (phone) => {
          const phoneRegex = /^0[0-9]{9}$/;
          return phoneRegex.test(phone);
            };

            // Simple name validation (non-empty and only letters/spaces)
            const validateName = (name) => {
            const nameRegex = /^[\p{L}\s]+$/u;
          return name.trim() !== '' && nameRegex.test(name);
            };

            form.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          // Show loading state
          buttonLoader.style.display = 'block';

          // Collect form data
          const formData = new FormData(form);
          const data = {
              name: formData.get('full_name')?.trim(),
              phone: formData.get('phone_number')?.trim(),
              address: formData.get('address')?.trim(),
              question_1: formData.get('question_1')?.trim(),
              select_1: formData.get('select_1')
          };
          // Validate required fields
          if (!data.name || !validateName(data.name)) {
              alert('Vui lòng nhập họ và tên hợp lệ.');
              buttonLoader.style.display = 'none';
              return;
          }

          if (!data.phone || !validatePhoneNumber(data.phone)) {
              alert('Vui lòng nhập số điện thoại hợp lệ (10 chữ số, bắt đầu bằng 0).');
              buttonLoader.style.display = 'none';
              return;
          }

          if (!data.select_1) {
              alert('Vui lòng chọn khóa học quan tâm.');
              buttonLoader.style.display = 'none';
              return;
          }

          try {
              // Replace with your actual API endpoint
              const response = await fetch(`${serverapi}/auth/register`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
              });

              if (!response.ok) {
            throw new Error('Đăng ký thất bại. Vui lòng thử lại.');
              }

              const result = await response.json();
              alert('Đăng ký thành công!');
              form.reset(); // Reset form after successful submission

              // After successful registration, call the tracking event
              if (typeof trackingService !== 'undefined' && trackingService.CreateTracking) {
            trackingService.CreateTracking({
                eventType: 'register',
                pageUrl: window.location.href,
                pageType: 'DangkyCTV',
                pageIdentifier: '',
                refCode: data.name, // Using full name as reference or update as needed
                referrer: document.referrer || undefined,
            });
              } else {
            console.warn('Tracking service is not available.');
              }
          } catch (error) {
              alert(error.message || 'Đã có lỗi xảy ra. Vui lòng thử lại.');
          } finally {
              buttonLoader.style.display = 'none';
          }
            });

        });

// https://affiliate.timona.edu.vn/ladictv/khoa-hoc-phun-xam-tham-my?ref=0977272967&codeId=AL00001&utm_source=123&utm_medium=abc&utm_campaign=456&utm_term=def&utm_content=zxc789&sharePlatform=whatsapp

(function trackPageView() {
  // Define any variables as needed; adjust slug and affiliateLinkId if necessary.
  const slug = 'unique-page-slug'; // Replace with your page identifier if available
  const affiliateLinkId = null; // Replace with actual affiliateLinkId if available

  const urlParams = new URLSearchParams(window.location.search);
  console.log('URL Parameters:', Object.fromEntries(urlParams.entries()));
  
  
  const payload = {
    eventType: 'page_view',
    pageUrl: window.location.href,
    pageType: 'LadiCTV',
    pageIdentifier: slug,
    codeId: urlParams.get('codeId') || null,
    sharePlatform: urlParams.get('sharePlatform') || null,
    refCode: (typeof this !== 'undefined' && urlParams.get('ref')) || null,
    referrer: (typeof this !== 'undefined' && urlParams.get('referrer')) || null,
    affiliateLinkId: affiliateLinkId || null
  };

  // Convert payload to a query string
  const qs = new URLSearchParams(payload).toString();
  const trackingUrl = `${serverapi}/trackingevent?${qs}`;

  // Send the POST request to record the page view
  fetch(trackingUrl, {
   method:'POST',
   headers: {
     'Content-Type': 'application/json',
   },
   body: JSON.stringify(payload),

  })
    .then(response => {
      if (response.ok) {
        console.log('Page view tracked successfully');
      } else {
        console.error('Failed to track page view');
      }
    })
    .catch(err => {
      console.error('Error tracking page view:', err);
    });
})();
  </script>