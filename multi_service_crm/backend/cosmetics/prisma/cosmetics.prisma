/// prisma/cosmetics.prisma (Cosmetics Service)
datasource db { provider = "postgresql"; url = env("COSMETICS_DATABASE_URL"); }
generator client { provider = "prisma-client-js"; output = "../node_modules/.prisma/client-cosmetics"; previewFeatures = ["extendedWhereUnique"]; }

// Enums or use strings + lookup/config
enum OrderStatus { PENDING_PAYMENT PROCESSING SHIPPED DELIVERED CANCELLED RETURNED }

// Models: Customer, Product, InventoryItem, SalesOrder, OrderItem, Activity (Cosmetics specific)
// IMPORTANT: Add Foreign Key fields referencing shared_db logically

model Customer { // Cosmetics specific data
  id            String   @id @default(cuid())
  customerId    String   @unique /// FK to shared_db.customers.id (Logical)
  loyaltyPoints Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  orders        SalesOrder[]
  activities    Activity[] @relation("ActivityCustomers")
  @@map("customers")
}

model Product {
  id          String    @id @default(cuid())
  name        String    @unique
  sku         String    @unique
  description String?
  price       Decimal
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  inventoryItems InventoryItem[]
  orderItems  OrderItem[]
  @@map("products")
}

model InventoryItem {
  id        String   @id @default(cuid())
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  location  String?  @default("default")
  quantity  Int
  lastUpdated DateTime @updatedAt
  @@unique([productId, location])
  @@map("inventory_items")
}

model SalesOrder {
  id           String      @id @default(cuid())
  orderNumber  String      @unique
  customerId   String      /// FK to cosmetics_db.customers.id (Logical)
  customer     Customer    @relation(fields: [customerId], references: [id], onDelete: Restrict)
  orderDate    DateTime    @default(now())
  status       OrderStatus // Or String
  totalAmount  Decimal
  currency     String      @default("VND")
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  items        OrderItem[]
  activities   Activity[] @relation("ActivityOrders")
  @@index([customerId])
  @@index([status])
  @@map("sales_orders")
}

model OrderItem {
  id          String     @id @default(cuid())
  orderId     String
  order       SalesOrder @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId   String
  product     Product    @relation(fields: [productId], references: [id], onDelete: Restrict)
  quantity    Int
  unitPrice   Decimal
  totalPrice  Decimal
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  @@index([orderId])
  @@index([productId])
  @@map("order_items")
}

model Activity {
  id          String     @id @default(cuid())
  subject     String
  type        String     /// Defined via config/lookup
  status      String     @default("OPEN") /// Defined via config/lookup
  dueDate     DateTime?
  description String?
  ownerId     String     /// FK to shared_db.users.id (Logical)

  customerId  String?    /// FK to cosmetics_db.customers.id
  customer    Customer?  @relation("ActivityCustomers", fields: [customerId], references: [id], onDelete: Cascade)
  orderId     String?    /// FK to cosmetics_db.sales_orders.id
  order       SalesOrder? @relation("ActivityOrders", fields: [orderId], references: [id], onDelete: Cascade)

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  @@index([ownerId])
  @@index([customerId])
  @@index([orderId])
  @@map("activities")
}