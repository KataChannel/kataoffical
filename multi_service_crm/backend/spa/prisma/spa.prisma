/// prisma/spa.prisma (Spa Service)
datasource db { provider = "postgresql"; url = env("SPA_DATABASE_URL"); }
generator client { provider = "prisma-client-js"; output = "../node_modules/.prisma/client-spa"; previewFeatures = ["extendedWhereUnique"]; }

// Enums or use strings + lookup/config
enum AppointmentStatus { SCHEDULED CONFIRMED CHECKED_IN COMPLETED CANCELLED NO_SHOW }
enum PaymentStatus { UNPAID PAID PARTIALLY_PAID REFUNDED }

// Models: Client, SpaService, Therapist, Appointment, AppointmentService, Membership, Activity (Spa specific)
// IMPORTANT: Add Foreign Key fields referencing shared_db logically

model Client { // Spa specific data
  id            String   @id @default(cuid())
  customerId    String   @unique /// FK to shared_db.customers.id (Logical)
  preferences   String?
  allergies     String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  appointments  Appointment[]
  memberships   Membership[]
  activities    Activity[] @relation("ActivityClients")
  @@map("clients")
}

model SpaService {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  durationMin Int
  price       Decimal
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  appointments AppointmentService[]
  @@map("spa_services")
}

model Therapist {
  id          String   @id @default(cuid())
  employeeId  String?  @unique /// FK to central HRM Employee ID or User ID (Logical)
  firstName   String
  lastName    String
  specialties String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  appointments Appointment[]
  @@map("therapists")
}

model Appointment {
  id           String            @id @default(cuid())
  clientId     String            /// FK to spa_db.clients.id (Logical)
  client       Client            @relation(fields: [clientId], references: [id], onDelete: Restrict)
  startTime    DateTime
  endTime      DateTime
  therapistId  String?
  therapist    Therapist?        @relation(fields: [therapistId], references: [id], onDelete: SetNull)
  status       AppointmentStatus @default(SCHEDULED) // Or String
  notes        String?
  totalAmount  Decimal?
  paymentStatus PaymentStatus?   @default(UNPAID) // Or String
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  services     AppointmentService[]
  activities   Activity[]        @relation("ActivityAppointments")
  @@index([clientId])
  @@index([therapistId])
  @@index([startTime])
  @@map("appointments")
}

model AppointmentService {
  appointmentId String
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  serviceId     String
  service       SpaService  @relation(fields: [serviceId], references: [id], onDelete: Restrict)
  @@id([appointmentId, serviceId])
  @@map("appointment_services")
}

model Membership {
  id          String    @id @default(cuid())
  clientId    String    /// FK to spa_db.clients.id (Logical)
  client      Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  packageName String
  startDate   DateTime
  endDate     DateTime?
  // status      String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  @@index([clientId])
  @@map("memberships")
}

model Activity {
  id          String     @id @default(cuid())
  subject     String
  type        String     /// Defined via config/lookup
  status      String     @default("OPEN") /// Defined via config/lookup
  dueDate     DateTime?
  description String?
  ownerId     String     /// FK to shared_db.users.id (Logical)

  clientId      String?    /// FK to spa_db.clients.id
  client        Client?    @relation("ActivityClients", fields: [clientId], references: [id], onDelete: Cascade)
  appointmentId String?    /// FK to spa_db.appointments.id
  appointment   Appointment? @relation("ActivityAppointments", fields: [appointmentId], references: [id], onDelete: Cascade)

  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  @@index([ownerId])
  @@index([clientId])
  @@index([appointmentId])
  @@map("activities")
}