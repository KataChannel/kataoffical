generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource postgres {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AuditLog {
  id            String      @id @default(uuid())
  entityName    String?
  entityId      String?
  action        AuditAction
  userId        String?
  userEmail     String?
  oldValues     Json?
  newValues     Json?
  changedFields String[]
  ipAddress     String?
  userAgent     String?
  sessionId     String?
  metadata      Json?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  status        String      @default("SUCCESS")
  errorDetails  Json?       @map("error_details")
  user          User?       @relation(fields: [userId], references: [id])

  @@index([entityName, entityId])
  @@index([userId])
  @@index([createdAt])
  @@index([action])
  @@index([status])
}

model User {
  id         String     @id @default(uuid())
  email      String?    @unique
  SDT        String?    @unique
  password   String
  provider   String?
  providerId String?    @unique
  isActive   Boolean    @default(false)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  AuditLog   AuditLog[]
  Chotkho    Chotkho[]
  profile    Profile?
  roles      UserRole[]
}

model Role {
  id          String           @id @default(uuid())
  name        String           @unique
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  permissions RolePermission[]
  users       UserRole[]
}

model UserRole {
  id     String @id @default(uuid())
  userId String
  roleId String
  role   Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Permission {
  id          String           @id @default(uuid())
  codeId      String?
  name        String           @unique
  group       String?
  description String?
  order       Int?             @default(1)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  roles       RolePermission[]
}

model RolePermission {
  id           String     @id @default(uuid())
  roleId       String
  permissionId String
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
}

model Menu {
  id        String   @id @default(uuid())
  title     String
  icon      String?
  slug      String?
  parentId  String?
  order     Int?
  isActive  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  parent    Menu?    @relation("MenuChildren", fields: [parentId], references: [id])
  children  Menu[]   @relation("MenuChildren")
}

model Profile {
  id     String  @id @default(uuid())
  userId String  @unique
  name   String
  avatar String?
  bio    String?
  user   User    @relation(fields: [userId], references: [id])
}

model Banggia {
  id        String           @id @default(uuid())
  title     String?
  mabanggia String?
  type      String?
  batdau    DateTime?
  ketthuc   DateTime?
  order     Int?             @default(1)
  ghichu    String?
  status    String?
  isActive  Boolean          @default(true)
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  isDefault Boolean          @default(false)
  sanpham   Banggiasanpham[]
  Donhang   Donhang[]
  khachhang Khachhang[]      @relation("Banggiakhachhang")
}

model Khachhang {
  id            String          @id @default(uuid())
  name          String?
  namenn        String?
  subtitle      String?
  makh          String          @unique
  makhold       String?
  diachi        String?
  sdt           String?
  mst           String?
  gionhanhang   String?
  quan          String?
  email         String?
  phone         String?
  address       String?
  loaikh        String?
  ghichu        String?
  hiengia       Boolean         @default(false)
  isActive      Boolean         @default(false)
  istitle2      Boolean         @default(false)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  tenfile       String?
  tenkh         String?
  banggiaId     String?
  isshowvat     Boolean         @default(true)
  donhang       Donhang[]
  banggia       Banggia?        @relation("Banggiakhachhang", fields: [banggiaId], references: [id])
  nhomkhachhang Nhomkhachhang[] @relation("KhachhangNhom")
}

model Nhomkhachhang {
  id          String      @id @default(uuid())
  name        String      @unique
  description String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  khachhang   Khachhang[] @relation("KhachhangNhom")
}

model Sanpham {
  id              String            @id @default(uuid())
  title           String
  title2          String?
  slug            String?           @unique
  masp            String            @unique
  subtitle        String?
  giagoc          Decimal           @default(0) @postgres.Decimal(20, 3)
  dvt             String?
  hinhanh         String?
  loadpoint       Decimal?          @default(0) @postgres.Decimal(20, 3)
  soluong         Decimal?          @default(0) @postgres.Decimal(20, 3)
  soluongkho      Decimal?          @default(0) @postgres.Decimal(20, 3)
  haohut          Decimal           @default(0) @postgres.Decimal(20, 3)
  ghichu          String?
  order           Int?              @default(1)
  isActive        Boolean           @default(false)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  giaban          Decimal           @default(0) @postgres.Decimal(20, 3)
  vat             Decimal?          @default(0) @postgres.Decimal(20, 3)
  banggia         Banggiasanpham[]
  Chotkho         Chotkho[]
  Dathangsanpham  Dathangsanpham[]
  Donhangsanpham  Donhangsanpham[]
  PhieuKhoSanpham PhieuKhoSanpham[]
  SanphamKho      SanphamKho[]
  TonKho          TonKho?
  Nhacungcap      Nhacungcap[]      @relation("NhacungcapToSanpham")
}

model Donhang {
  id          String           @id @default(uuid())
  title       String?
  type        String?
  madonhang   String           @unique
  ngaygiao    DateTime?
  ghichu      String?
  status      StatusDonhang    @default(dadat)
  khachhangId String?
  printCount  Int?             @default(0)
  order       Int?
  isActive    Boolean          @default(false)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  isshowvat   Boolean          @default(false)
  tongtien    Decimal          @default(0) @postgres.Decimal(20, 3)
  tongvat     Decimal          @default(0) @postgres.Decimal(20, 3)
  banggiaId   String?
  vat         Decimal          @default(0.5) @postgres.Decimal(20, 3)
  banggia     Banggia?         @relation(fields: [banggiaId], references: [id])
  khachhang   Khachhang?       @relation(fields: [khachhangId], references: [id])
  sanpham     Donhangsanpham[]
  PhieuKho    PhieuKho[]
}

model Donhangsanpham {
  id        String   @id @default(uuid())
  idSP      String
  sldat     Decimal  @default(0) @postgres.Decimal(20, 3)
  slgiao    Decimal  @default(0) @postgres.Decimal(20, 3)
  slnhan    Decimal  @default(0) @postgres.Decimal(20, 3)
  slhuy     Decimal  @default(0) @postgres.Decimal(20, 3)
  ttdat     Decimal  @default(0) @postgres.Decimal(20, 3)
  ttgiao    Decimal  @default(0) @postgres.Decimal(20, 3)
  ttnhan    Decimal  @default(0) @postgres.Decimal(20, 3)
  ghichu    String?
  donhangId String
  order     Int?
  isActive  Boolean? @default(false)
  giaban    Decimal  @default(0) @postgres.Decimal(20, 3)
  ttsauvat  Decimal  @default(0) @postgres.Decimal(20, 3)
  vat       Decimal  @default(0) @postgres.Decimal(20, 3)
  donhang   Donhang  @relation(fields: [donhangId], references: [id], onDelete: Cascade)
  sanpham   Sanpham  @relation(fields: [idSP], references: [id])
}

model Banggiasanpham {
  id        String  @id @default(uuid())
  giaban    Decimal  @default(0) @postgres.Decimal(20, 3)
  sanphamId String
  banggiaId String
  order     Int?
  isActive  Boolean @default(false)
  banggia   Banggia @relation(fields: [banggiaId], references: [id])
  sanpham   Sanpham @relation(fields: [sanphamId], references: [id])
}

model Nhacungcap {
  id        String    @id @default(uuid())
  name      String?
  mancc     String    @unique
  manccold  String?
  diachi    String?
  email     String?
  sdt       String?
  ghichu    String?
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  isshowvat Boolean   @default(true)
  tenfile   String?
  dathang   Dathang[]
  Sanpham   Sanpham[] @relation("NhacungcapToSanpham")
}

model Dathang {
  id           String           @id @default(uuid())
  title        String?
  type         String?
  madncc       String?          @unique
  ngaynhan     DateTime?
  ghichu       String?
  nhacungcapId String?
  order        Int?
  isActive     Boolean          @default(false)
  status       StatusDonhang    @default(dadat)
  printCount   Int?             @default(0)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime?        @updatedAt
  subtitle     String?
  khoId        String?
  kho          Kho?             @relation(fields: [khoId], references: [id])
  nhacungcap   Nhacungcap?      @relation(fields: [nhacungcapId], references: [id])
  sanpham      Dathangsanpham[]
  PhieuKho     PhieuKho[]
}

model Dathangsanpham {
  id        String  @id @default(uuid())
  idSP      String
  sldat     Decimal @default(0) @postgres.Decimal(20, 3)
  slgiao    Decimal @default(0) @postgres.Decimal(20, 3)
  slnhan    Decimal @default(0) @postgres.Decimal(20, 3)
  slhuy     Decimal @default(0) @postgres.Decimal(20, 3)
  ttdat     Decimal @default(0) @postgres.Decimal(20, 3)
  ttgiao    Decimal @default(0) @postgres.Decimal(20, 3)
  ttnhan    Decimal @default(0) @postgres.Decimal(20, 3)
  ghichu    String?
  dathangId String
  order     Int?
  isActive  Boolean @default(false)
  gianhap   Decimal @default(0) @postgres.Decimal(20, 3)
  dathang   Dathang @relation(fields: [dathangId], references: [id], onDelete: Cascade)
  sanpham   Sanpham @relation(fields: [idSP], references: [id])
}

model Congty {
  id        String   @id @default(uuid())
  name      String
  diachi    String?
  email     String?
  sdt       String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  kho       Kho[]
}

model Kho {
  id         String       @id @default(uuid())
  name       String
  makho      String?
  diachi     String?
  sdt        String?
  ghichu     String?
  congtyId   String?
  isActive   Boolean      @default(true)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  Chotkho    Chotkho[]
  Dathang    Dathang[]
  congty     Congty?      @relation(fields: [congtyId], references: [id])
  phieukho   PhieuKho[]
  sanphamKho SanphamKho[]
}

model SanphamKho {
  id        String   @id @default(uuid())
  khoId     String
  sanphamId String
  soluong   Decimal  @default(0) @postgres.Decimal(20, 3)
  ghichu    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  kho       Kho      @relation(fields: [khoId], references: [id])
  sanpham   Sanpham  @relation(fields: [sanphamId], references: [id])
}

model PhieuKho {
  id        String            @id @default(uuid())
  title     String?
  maphieu   String?           @unique
  madonhang String?
  madncc    String?
  madathang String?
  ngay      DateTime?
  type      String?
  khoId     String?
  ghichu    String?
  isActive  Boolean           @default(true)
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  isChotkho Boolean           @default(false)
  Chotkho   Chotkho[]
  kho       Kho?              @relation(fields: [khoId], references: [id])
  dathang   Dathang?          @relation(fields: [madncc], references: [madncc])
  donhang   Donhang?          @relation(fields: [madonhang], references: [madonhang])
  sanpham   PhieuKhoSanpham[]
}

model PhieuKhoSanpham {
  id         String   @id @default(uuid())
  phieuKhoId String
  sanphamId  String
  soluong    Decimal  @default(0) @postgres.Decimal(20, 3)
  ghichu     String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  phieuKho   PhieuKho @relation(fields: [phieuKhoId], references: [id])
  sanpham    Sanpham  @relation(fields: [sanphamId], references: [id])

  @@unique([phieuKhoId, sanphamId])
}

model TonKho {
  id        String    @id @default(uuid())
  sanphamId String    @unique
  slton     Decimal   @default(0) @postgres.Decimal(20, 3)
  slchogiao Decimal   @default(0) @postgres.Decimal(20, 3)
  slchonhap Decimal   @default(0) @postgres.Decimal(20, 3)
  Chotkho   Chotkho[]
  sanpham   Sanpham   @relation(fields: [sanphamId], references: [id])
}

model Chotkho {
  id         String    @id @default(uuid())
  khoId      String?
  sanphamId  String?
  tonkhoId   String?
  phieukhoId String?
  ngay       DateTime  @default(now())
  slthucte   Decimal   @postgres.Decimal(20, 3)
  slhethong  Decimal   @postgres.Decimal(20, 3)
  chenhlech  Decimal?  @postgres.Decimal(20, 3)
  ghichu     String?
  isActive   Boolean   @default(true)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  codeId     String?   @unique
  title      String?
  order      Int?      @default(1)
  userId     String?
  kho        Kho?      @relation(fields: [khoId], references: [id])
  phieukho   PhieuKho? @relation(fields: [phieukhoId], references: [id])
  sanpham    Sanpham?  @relation(fields: [sanphamId], references: [id])
  tonkho     TonKho?   @relation(fields: [tonkhoId], references: [id])
  user       User?     @relation(fields: [userId], references: [id])
}

model FileManager {
  id          String   @id @default(uuid())
  codeId      String?  @unique
  title       String?
  url         String?
  description String?
  fileType    String?
  fileSize    Int?
  metaData    Json?
  category    String?
  group       String?
  order       Int?     @default(1)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ChatAIMessage {
  id        String   @id @default(uuid())
  userId    String
  message   String
  reply     String
  createdAt DateTime @default(now())
}

model ChatAIHistory {
  id        String   @id @default(uuid())
  userId    String
  message   String
  sender    String
  createdAt DateTime @default(now())
}

model File {
  id        String   @id @default(uuid())
  fileName  String?
  fileUrl   String?
  jsonData  Json?
  createdAt DateTime @default(now())
}

model ErrorLog {
  id        String   @id @default(uuid())
  timestamp DateTime
  message   String
  details   Json?
  source    String
  createdAt DateTime @default(now())
}

model UserguidBlock {
  id          String        @id @default(uuid())
  codeId      String?       @unique
  type        String
  title       String?
  description String?
  listItems   String?
  imageUrl    String?
  imageAlt    String?
  videoUrl    String?
  videoType   String?
  stepId      String?
  order       Int?          @default(1)
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  step        UserguidStep? @relation(fields: [stepId], references: [id], onDelete: Cascade)
}

model UserguidStep {
  id             String          @id @default(uuid())
  codeId         String?         @unique
  time           String?
  title          String?
  description    String?
  order          Int?            @default(1)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  UserguidBlocks UserguidBlock[]

  @@index([id])
}

model ImportHistory {
  id         String   @id @default(uuid())
  caseDetail Json?
  importTime DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  codeId     String?  @unique
  order      Int?     @default(1)
  createdBy  String?  @default("system")
  status     String?
  title      String?
  type       String?
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  ACCESS
  READ
  IMPORT
}

enum StatusDonhang {
  dadat
  dagiao
  danhan
  huy
  hoanthanh
}
