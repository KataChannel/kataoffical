<div class="farm-container bg-farm-bg min-h-screen p-6">
    <!-- User Info -->
    <div class="user-info bg-white/90 p-4 rounded-lg shadow-md mb-6">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <img [src]="user.avatarUrl" alt="Avatar" class="w-12 h-12 rounded-full">
          <div>
            <span class="font-bold text-lg">{{ user.username }}</span>
            <div class="text-sm text-gray-600">Level: {{ user.level }} | XP: {{ user.xp }}</div>
            <div class="text-sm text-gray-600">Tokens: {{ user.tokens }}</div>
            <div *ngIf="user.vip" class="text-sm text-green-600">VIP until: {{ formatVipExpiry(user.vipExpiry) }}</div>
          </div>
        </div>
        <div class="flex gap-2">
          <button (click)="waterCrops()" [disabled]="!canWater()" 
                  class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-400">
            Tưới nước {{ canWater() ? '' : '(' + waterCooldownRemaining() + 's)' }}
          </button>
          <button (click)="harvestCrops()" [disabled]="!canHarvest()" 
                  class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600 disabled:bg-gray-400">
            Thu hoạch ({{ countMatureCrops() }})
          </button>
          <button (click)="watchAd()" 
                  class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600">
            Xem quảng cáo
          </button>
        </div>
      </div>
    </div>
  
    <!-- Seed Inventory -->
    <div class="seed-inventory bg-white/90 p-4 rounded-lg shadow-md mb-6">
      <h2 class="text-lg font-bold mb-2">Hạt giống</h2>
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
        <div *ngFor="let seedKey of getSeedKeys()" class="seed-item p-2 border rounded-lg text-center">
          <span class="font-bold">{{ seedCatalog[seedKey]?.name }}</span>
          <div class="text-sm">Số lượng: {{ user?.seeds[seedKey] }}</div>
          <button (click)="plantCrop(seedKey)" [disabled]="user.seeds[seedKey] <= 0 || user.crops.length >= user.unlocks.maxPlots"
                  class="mt-2 px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-400">
            Trồng
          </button>
        </div>
      </div>
    </div>
  
    <!-- Crop Plots -->
    <div class="crop-plots-area section bg-white/90 p-4 rounded-lg shadow-md">
      <div *ngIf="!user?.crops?.length" class="no-crops text-center text-gray-500 py-5 italic">
        Chưa có cây nào. Hãy trồng cây mới!
      </div>
      <div class="crop-plots grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
        <div *ngFor="let crop of user.crops; let i = index"
             class="crop-plot group relative border-2 border-farm-earth rounded-lg p-3 pt-1 flex flex-col items-center text-center bg-white/80 min-h-[200px] justify-between transition-all duration-300 overflow-hidden"
             [class.border-farm-secondary]="isMature(crop)"
             [class.ring-2]="isMature(crop)"
             [class.ring-farm-secondary]="isMature(crop)"
             [class.ring-offset-2]="isMature(crop)"
             [attr.data-tooltip]="getCropTooltip(crop)">
          <div class="crop-visual-container relative w-16 h-16 my-2 flex items-center justify-center">
            <img [src]="cropImages[crop.name]"
                 [alt]="crop.name"
                 class="crop-image w-full h-full object-contain group-hover:scale-105 transition-transform duration-300 origin-bottom"
                 [style.transform]="'scale(' + getGrowthScale(crop) + ')'"
                 [class.harvesting-effect-img]="crop.isHarvesting">
            <div class="watering-effect absolute inset-0 rounded-full pointer-events-none"
                 [class.active]="crop.isWatering"></div>
            <div *ngIf="crop.isHarvesting" class="harvest-reward-effect absolute -top-2 left-1/2 transform -translate-x-1/2 text-xs font-bold text-yellow-600 whitespace-nowrap">
              +{{ getHarvestXP(crop) }} XP ✨
            </div>
          </div>
          <div class="crop-info w-full mt-auto">
            <span class="crop-name font-bold text-sm text-gray-800 mb-1 block"
                  [class.text-red-600]="isMature(crop)">
              {{ crop.name }}
            </span>
            <div class="progress-bar-container w-full h-2.5 bg-gray-300 rounded-full overflow-hidden my-1">
              <div class="progress-bar h-full bg-farm-primary rounded-full transition-all duration-500 ease-out"
                   [style.width.%]="calculateProgress(crop)">
              </div>
            </div>
            <span class="time-remaining text-xs text-gray-600 block mb-1">
              {{ getTimeRemaining(crop) }}
            </span>
            <button *ngIf="isMature(crop) && !crop.isHarvesting" (click)="harvestSingleCrop(i)"
                    class="harvest-single-button mt-1 px-2 py-0.5 text-xs bg-farm-secondary text-white rounded shadow hover:bg-orange-500 transition">
              Thu hoạch
            </button>
            <span *ngIf="crop.isHarvesting" class="text-xs italic text-gray-500 mt-1 block">Đang thu hoạch...</span>
          </div>
        </div>
        <!-- Empty Plots -->
        <div *ngFor="let _ of emptyPlots()" 
             class="empty-plot border-2 border-dashed border-gray-300 rounded-lg p-3 flex items-center justify-center text-gray-500 italic min-h-[200px]">
          Ô trống
        </div>
      </div>
    </div>
  </div>