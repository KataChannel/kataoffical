<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sheet1 to Sheet2 Real-time Conversion</title>
    <style>
        body { font-family: sans-serif; display: flex; gap: 20px; padding: 15px; }
        table { border-collapse: collapse; font-size: 12px; }
        th, td { border: 1px solid #ccc; padding: 5px 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        td[contenteditable="true"] { background-color: #ffffdd; }
        .output-section { margin-top: 20px; }
         #sheet1Table td, #sheet2Table td { white-space: nowrap; }
         #sheet1Table th, #sheet2Table th { position: sticky; top: 0; background-color: #f2f2f2; }
         .table-container { max-height: 70vh; overflow: auto; border: 1px solid #ccc;}
    </style>
</head>
<body>

<div>
    <h2>Input (Sheet1 Format - Editable)</h2>
    <div class="table-container">
        <table id="sheet1Table">
            <thead>
                <tr>
                    <th>NGÀY</th>
                    <th>MÃ KHÁCH HÀNG</th>
                    <th>TÊN KHÁCH HÀNG</th>
                    <th>MÃ ĐƠN HÀNG</th>
                    <th>TỔNG TIỀN</th>
                    <th>MÃ HÀNG</th>
                    <th>TÊN HÀNG</th>
                    <th>ĐVT</th>
                    <th>SỐ LƯỢNG</th>
                    <th>ĐƠN GIÁ</th>
                    <th>THÀNH TIỀN</th>
                    <th>GHI CHÚ</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>
</div>

<div>
    <h2>Output (Sheet2 Format - Real-time)</h2>
     <div class="table-container">
        <table id="sheet2Table">
            <thead>
                <tr>
                    <th>NGÀY</th>
                    <th>MÃ KHÁCH HÀNG</th>
                    <th>TÊN KHÁCH HÀNG</th>
                    <th>MÃ HÀNG</th>
                    <th>TÊN HÀNG</th>
                    <th>ĐVT</th>
                    <th>SỐ LƯỢNG</th>
                    <th>GHI CHÚ</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>
</div>

<script>
    // Initial data based on your Sheet1.csv structure
    const initialSheet1Data = [
        ["2025-04-01", "C100854", "Hyakumi Ramen", "16", "472500", "I100039", "Cà rốt", "Kg", "1", "22000", "22000", ""],
        ["", "", "", "", "", "I100099", "Hành Paro", "Kg", "5", "50000", "250000", ""],
        ["", "", "", "", "", "I100101", "Hành tây", "Kg", "4", "22000", "88000", ""],
        ["", "", "", "", "", "I100167", "Ớt hiểm đỏ", "Kg", "1.5", "75000", "112500", ""],
        ["2025-04-01", "C100001", "NHÀ HÀNG GÀ TRỐNG", "722", "424800", "I100030", "Bông so đũa", "Kg", "0.5", "55000", "27500", ""],
        ["", "", "", "", "", "I100039", "Cà rốt", "Kg", "5", "22000", "110000", ""],
        ["", "", "", "", "", "I100058", "Cần tàu", "Kg", "0.3", "40000", "12000", ""],
        ["", "", "", "", "", "I100100", "Hành lá", "Kg", "0.2", "40000", "8000", ""],
        ["", "", "", "", "", "I100101", "Hành tây", "Kg", "5", "22000", "110000", ""],
        ["", "", "", "", "", "I100156", "Ngò gai ", "Kg", "0.3", "55000", "16500", ""],
        ["", "", "", "", "", "I100157", "Ngò rí ", "Kg", "0.3", "55000", "16500", ""],
        ["", "", "", "", "", "I100167", "Ớt hiểm đỏ", "Kg", "0.2", "75000", "15000", ""],
        ["", "", "", "", "", "I100168", "Ớt sừng ", "Kg", "0.3", "55000", "16500", ""],
        ["", "", "", "", "", "I100188", "Rau om ", "Kg", "0.3", "55000", "16500", ""],
        ["", "", "", "", "", "I100205", "Sả cây", "Kg", "5", "15000", "75000", ""],
        ["", "", "", "", "", "I100211", "Tắc", "Kg", "0.1", "13000", "1300", "Tắc xanh"],
        ["2025-04-01", "C100683", "CÔNG TY TNHH THƯƠNG MẠI DỊCH VỤ ÂN NAM", "1560", "427950", "I100119", "Khoai tây ", "Kg", "10", "23000", "230000", "Khoai tây ĐL"],
        ["", "", "", "", "", "I100146", "Me chín ", "Kg", "0.5", "45000", "22500", "Me chín ko hạt"],
        ["", "", "", "", "", "I100167", "Ớt hiểm đỏ", "Kg", "0.1", "75000", "7500", ""],
        ["", "", "", "", "", "I100168", "Ớt sừng ", "Kg", "0.3", "55000", "16500", "Ớt sừng xanh"],
        ["", "", "", "", "", "I100211", "Tắc", "Kg", "10.1", "13000", "131450", "Tắc xanh"]
    ];

    const sheet1TableBody = document.getElementById('sheet1Table').querySelector('tbody');
    const sheet2TableBody = document.getElementById('sheet2Table').querySelector('tbody');

    // --- Populate Initial Sheet1 Table ---
    function populateSheet1() {
        sheet1TableBody.innerHTML = ''; // Clear existing rows
        initialSheet1Data.forEach(rowData => {
            const row = sheet1TableBody.insertRow();
            rowData.forEach((cellData, index) => {
                const cell = row.insertCell();
                cell.textContent = cellData;
                // Make all cells editable except potentially calculated ones if needed
                // Let's make Mã hàng, Tên hàng, ĐVT, Số Lượng, Ghi chú editable
                 // Indexes: 0:NGÀY, 1:MÃ KH, 2:TÊN KH, 3:MÃ ĐH, 4:TỔNG TIỀN, 5:MÃ HÀNG, 6:TÊN HÀNG, 7:ĐVT, 8:SỐ LƯỢNG, 9:ĐƠN GIÁ, 10:THÀNH TIỀN, 11:GHI CHÚ
                if ([0,1,2,3,4,5,6,7,8,9,10,11].includes(index)) { // Make relevant cells editable
                   cell.setAttribute('contenteditable', 'true');
                }
            });
        });
         // Add event listener for real-time updates
         sheet1TableBody.addEventListener('input', debounce(updateSheet2, 300)); // Debounce to avoid too frequent updates
    }


    // --- Transformation and Sheet2 Update Logic ---
    function updateSheet2() {
        const sheet1Rows = sheet1TableBody.querySelectorAll('tr');
        const sheet2Data = [];
        let currentNgay = '';
        let currentMaKH = '';
        let currentTenKH = '';

        sheet1Rows.forEach(row => {
            const cells = Array.from(row.querySelectorAll('td')).map(td => td.textContent.trim());

            // If the first cell (NGÀY) has data, it's a new order header
            if (cells[0]) {
                currentNgay = cells[0];
                currentMaKH = cells[1];
                currentTenKH = cells[2];
            }

            // Extract item details - Adjust indices based on Sheet1 columns
            const maHang = cells[5];
            const tenHang = cells[6];
            const dvt = cells[7];
            const soLuong = cells[8];
            const ghiChu = cells[11]; // GHI CHÚ is the 12th column (index 11)

            // Add row to Sheet2 data, using the carried-over header info
            sheet2Data.push([
                currentNgay,
                currentMaKH,
                currentTenKH,
                maHang,
                tenHang,
                dvt,
                soLuong,
                ghiChu
            ]);
        });

        // --- Populate Sheet2 Table ---
        sheet2TableBody.innerHTML = ''; // Clear existing rows
        sheet2Data.forEach(rowData => {
            const row = sheet2TableBody.insertRow();
            rowData.forEach(cellData => {
                const cell = row.insertCell();
                cell.textContent = cellData;
            });
        });
         console.log("Sheet2 Updated");
    }

     // --- Debounce Function ---
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
            clearTimeout(timeout);
            func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }


    // --- Initial Population ---
    populateSheet1();
    updateSheet2(); // Initial conversion

</script>

</body>
</html>