import{a as q}from"./chunk-DFEBKCCY.js";import{b as Jt,g as Ut,h as Y}from"./chunk-CD7SNJ5S.js";import{a as It,b as Vt,c as $,d as Gt,e as At}from"./chunk-2PVH7Z6P.js";import{a as Tt}from"./chunk-ZW44ZSN2.js";import{a as ut,b as ht,c as dt}from"./chunk-Z2ZDGSWT.js";import{a as xt,b as yt,c as Ct,d as bt}from"./chunk-UQRYBWA2.js";import{a as Zt}from"./chunk-YGTKRZ2Q.js";import{a as Et,b as Dt,c as Pt,d as $t,e as qt,g as Ot,h as Ht,j as Rt,k as Nt,m as Kt,n as zt,p as jt,q as Yt,r as Qt,s as j}from"./chunk-POPZSE3V.js";import{b as Lt}from"./chunk-POHUA43U.js";import{n as wt,p as St,r as vt,v as kt,w as Bt,y as Mt,z as Ft}from"./chunk-A3B3GZND.js";import{a as _t,b as ft}from"./chunk-MGAKVDEP.js";import{a as pt,b as gt}from"./chunk-CBIWJPH2.js";import{a as lt,c as ct,e as mt}from"./chunk-K4TPENAW.js";import{y as ot,z as st}from"./chunk-27DT4LBZ.js";import{b as rt,c as P}from"./chunk-VF6Z3BLE.js";import{l as et,m as it,r as at,v as nt}from"./chunk-CNCZQRZQ.js";import{$b as D,Cc as M,Db as U,Dc as c,Ec as w,Fc as _,Kb as C,Ra as E,Sc as S,Ub as f,Uc as v,Yb as W,bc as X,cc as K,dc as z,ec as o,fc as l,gc as I,hc as Z,ic as tt,ja as J,kc as b,oa as N,pa as y,pc as d,rb as m,rc as s,xc as V,ya as g,yc as G,za as u,zc as A}from"./chunk-TAKLKH4V.js";import{a as B,b as L,g as Xt,h as R,j as h}from"./chunk-WJTR2IJE.js";var T=Xt(Zt());var O=class r{constructor(e,t){this._StorageService=e;this.router=t}_GraphqlService=y(q);ListBanggia=E([]);DetailBanggia=E({});banggiaId=E(null);setBanggiaId(e){this.banggiaId.set(e)}CreateBanggia(e){return h(this,null,function*(){try{let t={title:e.title,mabanggia:e.mabanggia||this.generateMaBanggia(),type:e.type||"bansi",batdau:e.batdau?new Date(e.batdau).toISOString():new Date().toISOString(),ketthuc:e.ketthuc?new Date(e.ketthuc).toISOString():new Date(Date.now()+2592e6).toISOString(),order:e.order||1,ghichu:e.ghichu||"",status:e.status||"baogia",isActive:e.isActive!==!1,isDefault:e.isDefault||!1,sanpham:e.sanpham?{create:e.sanpham.map(n=>({sanphamId:n.sanphamId||n.id,giaban:Number(n.giaban)||0,order:n.order||1,isActive:n.isActive!==!1}))}:void 0,khachhang:e.khachhang?{connect:e.khachhang.map(n=>({id:n.id||n}))}:void 0},i={sanpham:{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0}}}},khachhang:{select:{id:!0,name:!0,makh:!0}}},a=yield this._GraphqlService.createOne("banggia",t,{include:i});return this.banggiaId.set(a.id),this.DetailBanggia.set(a),yield this.getAllBanggia(),a}catch(t){throw console.error("L\u1ED7i t\u1EA1o b\u1EA3ng gi\xE1:",t),t}})}updateBanggia(e){return h(this,null,function*(){try{let t={title:e.title,mabanggia:e.mabanggia,type:e.type,batdau:e.batdau?new Date(e.batdau).toISOString():void 0,ketthuc:e.ketthuc?new Date(e.ketthuc).toISOString():void 0,order:e.order,ghichu:e.ghichu,status:e.status,isActive:e.isActive,isDefault:e.isDefault,sanpham:e.sanpham?{deleteMany:{},create:e.sanpham.map(n=>({sanphamId:n.sanphamId||n.id,giaban:Number(n.giaban)||0,order:n.order||1,isActive:n.isActive!==!1}))}:void 0,khachhang:e.khachhang?{set:e.khachhang.map(n=>({id:n.id||n}))}:void 0};Object.keys(t).forEach(n=>{t[n]===void 0&&delete t[n]});let i={sanpham:{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0}}}},khachhang:{select:{id:!0,name:!0,makh:!0,diachi:!0,sdt:!0,email:!0}}},a=yield this._GraphqlService.updateOne("banggia",{id:e.id},t,{include:i});return this.DetailBanggia.set(a),yield this.getAllBanggia(),a}catch(t){throw console.error("L\u1ED7i c\u1EADp nh\u1EADt b\u1EA3ng gi\xE1:",t),t}})}getAllBanggia(){return h(this,null,function*(){try{let e={where:{},orderBy:{order:"asc"},include:{sanpham:{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0}}}},khachhang:{select:{id:!0,name:!0,makh:!0}},_count:{select:{sanpham:!0,khachhang:!0}}}},t=yield this._GraphqlService.findMany("banggia",e);return this.ListBanggia.set(t),t}catch(e){throw console.error("L\u1ED7i l\u1EA5y danh s\xE1ch b\u1EA3ng gi\xE1:",e),e}})}getBanggiaByid(e){return h(this,null,function*(){try{let t={include:{sanpham:{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0,giagoc:!0}}},orderBy:{order:"asc"},take:99999},khachhang:{select:{id:!0,name:!0,makh:!0,diachi:!0,sdt:!0,email:!0,loaikh:!0,isActive:!0},take:99999}}},i=yield this._GraphqlService.findUnique("banggia",{id:e},t),a=this.transformDetailBanggia(i);return console.log(a),this.DetailBanggia.set(a),i}catch(t){throw console.error("L\u1ED7i l\u1EA5y chi ti\u1EBFt b\u1EA3ng gi\xE1:",t),t}})}transformDetailBanggia(e){console.log(e);let t=e.sanpham?.map(i=>L(B({},i),{giaban:Number(i.giaban)||0,title:i.sanpham.title,masp:i.sanpham.masp,dvt:i.sanpham.dvt}))||[];return L(B({},e),{sanpham:t})}DeleteBanggia(e){return h(this,null,function*(){try{yield this._GraphqlService.deleteOne("banggia",{id:e.id}),yield this.getAllBanggia()}catch(t){throw console.error("L\u1ED7i x\xF3a b\u1EA3ng gi\xE1:",t),t}})}addKHtoBG(e){return h(this,null,function*(){try{let t={khachhang:{connect:e.khachhangIds.map(i=>({id:i}))}};yield this._GraphqlService.updateOne("banggia",{id:e.banggiaId},t),yield this.getBanggiaByid(e.banggiaId)}catch(t){throw console.error("L\u1ED7i th\xEAm kh\xE1ch h\xE0ng v\xE0o b\u1EA3ng gi\xE1:",t),t}})}removeKHfromBG(e){return h(this,null,function*(){try{let t={khachhang:{disconnect:e.khachhangIds.map(i=>({id:i}))}};yield this._GraphqlService.updateOne("banggia",{id:e.banggiaId},t),yield this.getBanggiaByid(e.banggiaId)}catch(t){throw console.error("L\u1ED7i x\xF3a kh\xE1ch h\xE0ng kh\u1ECFi b\u1EA3ng gi\xE1:",t),t}})}getAllBGSP(){return h(this,null,function*(){try{let e={include:{banggia:{select:{id:!0,title:!0,mabanggia:!0,status:!0}},sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0}}},orderBy:{order:"asc"}};return yield this._GraphqlService.findMany("banggiasanpham",e)}catch(e){throw console.error("L\u1ED7i l\u1EA5y b\u1EA3ng gi\xE1 s\u1EA3n ph\u1EA9m:",e),e}})}getAllBGKH(){return h(this,null,function*(){try{let e={where:{banggiaId:{not:null}},include:{banggia:{select:{id:!0,title:!0,mabanggia:!0,status:!0}}},orderBy:{name:"asc"}};return yield this._GraphqlService.findMany("khachhang",e)}catch(e){throw console.error("L\u1ED7i l\u1EA5y kh\xE1ch h\xE0ng theo b\u1EA3ng gi\xE1:",e),e}})}ImportBanggia(e){return h(this,null,function*(){try{let i=[];for(let a=0;a<e.length;a+=10)i.push(e.slice(a,a+10));for(let a of i){let n=a.map(p=>this._GraphqlService.createOne("banggia",{title:p.title,mabanggia:p.mabanggia||this.generateMaBanggia(),type:p.type||"bansi",status:p.status||"baogia",isActive:p.isActive!==!1}));yield Promise.all(n)}yield this.getAllBanggia()}catch(t){throw console.error("L\u1ED7i import b\u1EA3ng gi\xE1:",t),t}})}importSPBG(e){return h(this,null,function*(){try{let i=[];for(let a=0;a<e.length;a+=10)i.push(e.slice(a,a+10));for(let a of i){let n=a.map(p=>this._GraphqlService.createOne("banggiasanpham",{banggiaId:p.banggiaId,sanphamId:p.sanphamId,giaban:Number(p.giaban)||0,order:p.order||1,isActive:p.isActive!==!1}));yield Promise.all(n)}yield this.getAllBanggia()}catch(t){throw console.error("L\u1ED7i import s\u1EA3n ph\u1EA9m b\u1EA3ng gi\xE1:",t),t}})}importBGKH(e){return h(this,null,function*(){try{let t=e.map(i=>this._GraphqlService.updateOne("khachhang",{id:i.khachhangId},{banggiaId:i.banggiaId}));yield Promise.all(t),yield this.getAllBanggia()}catch(t){throw console.error("L\u1ED7i import b\u1EA3ng gi\xE1 kh\xE1ch h\xE0ng:",t),t}})}generateMaBanggia(){let e=new Date,t=e.getFullYear().toString().slice(-2),i=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0"),n=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`BG${t}${i}${a}${n}`}handleError(e){let t="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(e){case 401:t="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:t="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:t="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}let i=JSON.stringify({code:e,title:t});this.router.navigate(["/errorserver"],{queryParams:{data:i}})}static \u0275fac=function(t){return new(t||r)(N(gt),N(P))};static \u0275prov=J({token:r,factory:r.\u0275fac,providedIn:"root"})};var ee=["drawer"],ie=(r,e)=>e.key;function ae(r,e){if(r&1){let t=b();o(0,"button",31),d("click",function(a){let n=g(t).$implicit;return s(2).toggleColumn(n),u(a.stopPropagation())}),o(1,"mat-icon"),c(2),l(),o(3,"span"),c(4),l()()}if(r&2){let t=e.$implicit;m(2),w(t.isShow?"check_box":"check_box_outline_blank"),m(2),w(t.value)}}function ne(r,e){if(r&1){let t=b();o(0,"div",15)(1,"div",16)(2,"button",17),d("click",function(){g(t);let a=s();return u(a.create())}),o(3,"mat-icon"),c(4,"add_circle"),l(),o(5,"span",18),c(6,"T\u1EA1o M\u1EDBi"),l()(),o(7,"button",19)(8,"mat-icon"),c(9,"tune"),l()(),o(10,"mat-menu",null,1)(12,"div",20)(13,"mat-form-field",21)(14,"input",22),d("input",function(a){g(t);let n=s();return u(n.doFilterColumns(a))})("click",function(a){return g(t),u(a.stopPropagation())}),l(),o(15,"mat-icon",23),c(16,"search"),l()()(),o(17,"div",24),K(18,ae,5,2,"button",25,ie),l()(),o(20,"button",26),d("click",function(){g(t);let a=s();return u(a.isSearch=!a.isSearch)}),o(21,"mat-icon"),c(22,"search"),l()(),o(23,"button",27),d("click",function(){g(t);let a=s();return u(a.ExportExcel(a.dataSource.data,"Banggia"))}),o(24,"mat-icon"),c(25,"file_download"),l()(),o(26,"button",28),d("click",function(){g(t);let a=M(30);return u(a.click())}),o(27,"mat-icon"),c(28,"file_upload"),l()(),o(29,"input",29,2),d("change",function(a){g(t);let n=s();return u(n.ImportExcel(a))}),l(),o(31,"span",30),c(32),l()()()}if(r&2){let t=M(11),i=s();m(7),f("matMenuTriggerFor",t),m(11),z(i.FilterColumns),m(14),_(" ",i.CountItem," B\u1EA3ng Gi\xE1 ")}}function re(r,e){if(r&1){let t=b();o(0,"div",32)(1,"mat-form-field",21)(2,"mat-label"),c(3,"T\xECm Ki\u1EBFm"),l(),o(4,"input",33),d("keyup",function(a){g(t);let n=s();return u(n.applyFilter(a))}),l()(),o(5,"button",34),d("click",function(){g(t);let a=s();return u(a.isSearch=!a.isSearch)}),o(6,"mat-icon"),c(7,"cancel"),l()()()}}function oe(r,e){r&1&&(o(0,"span",54),c(1,"check"),l())}function se(r,e){if(r&1&&(o(0,"span"),c(1),S(2,"date"),l()),r&2){let t=s().$implicit,i=s(2).$implicit;m(),w(v(2,1,t[i],"dd/MM/yyyy"))}}function le(r,e){if(r&1&&(o(0,"span"),c(1),S(2,"date"),l()),r&2){let t=s().$implicit,i=s(2).$implicit;m(),w(v(2,1,t[i],"dd/MM/yyyy"))}}function ce(r,e){if(r&1&&(o(0,"span"),c(1),l()),r&2){let t=s().$implicit,i=s(2).$implicit;m(),_("",t[i],"%")}}function me(r,e){if(r&1&&(o(0,"span"),c(1),l()),r&2){let t=s().$implicit,i=s(2).$implicit;m(),_(" ",t[i]||"Tr\u1ED1ng","")}}function pe(r,e){if(r&1){let t=b();o(0,"div",52),d("click",function(){let a=g(t).$implicit,n=s(2).$implicit,p=s();return u(p.ChosenItem(a,n))}),C(1,oe,2,0,"span",53)(2,se,3,4,"span")(3,le,3,4,"span")(4,ce,2,1,"span")(5,me,2,1,"span"),l()}if(r&2){let t,i=e.$implicit,a=s(2).$implicit,n=s();m(),f("ngIf",n.CheckItem(i)),m(),D((t=a)==="createdAt"?2:t==="updatedAt"?3:t==="haohut"?4:5)}}function ge(r,e){if(r&1){let t=b();o(0,"th",37)(1,"span",38),c(2),l(),o(3,"span",39,3),c(5," filter_alt "),l(),o(6,"mat-menu",null,1)(8,"div",40),d("click",function(a){return g(t),u(a.stopPropagation())}),o(9,"div",41)(10,"input",42),d("keyup",function(a){g(t);let n=s().$implicit,p=s();return u(p.doFilterHederColumn(a,n))}),l(),o(11,"div",43)(12,"span",44),c(13,"search"),l()()(),o(14,"div",45)(15,"div",16)(16,"span",46),d("click",function(){g(t);let a=s().$implicit,n=s();return u(n.ChosenAll(n.FilterHederColumn(n.dataSource.filteredData,a)))}),c(17),l(),o(18,"span",46),d("click",function(){g(t);let a=s(2);return u(a.EmptyFiter())}),c(19,"Xo\xE1"),l()(),o(20,"span",46),d("click",function(){g(t);let a=s(2);return u(a.ResetFilter())}),c(21,"Reset"),l()(),o(22,"div",47),C(23,pe,6,2,"div",48),l(),o(24,"div",49)(25,"button",50),d("click",function(){g(t);let a=M(4);return u(a.closeMenu())}),c(26,"\u0110\xF3ng"),l(),o(27,"button",51),d("click",function(){g(t);let a=M(4),n=s(2);return u(n.ApplyFilterColum(a))}),c(28,"\xC1p D\u1EE5ng"),l()()()()()}if(r&2){let t=M(7),i=s().$implicit,a=s();m(2),_(" ",a.ColumnName[i]," "),m(),f("matMenuTriggerFor",t),m(14),_("Ch\u1ECDn T\u1EA5t C\u1EA3 ",a.FilterHederColumn(a.dataSource.filteredData,i).length||0,""),m(6),f("ngForOf",a.FilterHederColumn(a.dataSource.filteredData,i))("ngForTrackBy",a.trackByFn)}}function ue(r,e){if(r&1&&(o(0,"span",56),c(1),l()),r&2){let t=s().index;m(),_(" ",t+1," ")}}function he(r,e){if(r&1){let t=b();o(0,"span",57)(1,"mat-icon",60),d("click",function(){g(t);let a=s().$implicit,n=s(2);return u(n.Banggiamacdinh(a))}),c(2,"bookmark"),l(),o(3,"span"),c(4),l()()}if(r&2){let t=s().$implicit,i=s().$implicit;m(),W("!z-10 ",t.isDefault?"!text-blue-600":"text-gray-600",""),m(3),w(t[i])}}function de(r,e){if(r&1){let t=b();o(0,"span",58)(1,"span",60),d("click",function(){g(t);let a=s().$implicit,n=s(2);return u(n.goToDetail(a))}),c(2),l()()}if(r&2){let t=s().$implicit,i=s().$implicit;m(2),w(t[i])}}function _e(r,e){if(r&1&&(o(0,"span",56),c(1),l()),r&2){let t=s().$implicit,i=s().$implicit;m(),_(" ",t[i]," ")}}function fe(r,e){if(r&1&&(o(0,"span",56),c(1),l()),r&2){let t,i=s().$implicit,a=s().$implicit,n=s();m(),_(" ",(t=n.getName(n.ListStatus,"value",i[a]))==null?null:t.title," ")}}function xe(r,e){if(r&1&&(o(0,"span",56),c(1),S(2,"date"),l()),r&2){let t=s().$implicit,i=s().$implicit;m(),_(" ",v(2,1,t[i],"dd/MM/yyyy")," ")}}function ye(r,e){if(r&1&&(o(0,"span",56),c(1),S(2,"date"),l()),r&2){let t=s().$implicit,i=s().$implicit;m(),_(" ",v(2,1,t[i],"dd/MM/yyyy")," ")}}function Ce(r,e){if(r&1&&(o(0,"span",59),c(1),S(2,"date"),l()),r&2){let t=s().$implicit,i=s().$implicit;m(),_(" ",v(2,1,t[i],"HH:mm:ss dd/MM/yyyy")," ")}}function be(r,e){r&1&&(o(0,"mat-icon",61),c(1,"check_circle"),l())}function we(r,e){r&1&&(o(0,"mat-icon",62),c(1,"cancel"),l())}function Se(r,e){if(r&1&&(o(0,"span",56),C(1,be,2,0,"mat-icon",61)(2,we,2,0,"mat-icon",62),l()),r&2){let t=s().$implicit,i=s().$implicit;m(),D(t[i]?1:2)}}function ve(r,e){if(r&1&&(o(0,"span",59),c(1),S(2,"date"),l()),r&2){let t=s().$implicit,i=s().$implicit;m(),_(" ",v(2,1,t[i],"HH:mm:ss dd/MM/yyyy")," ")}}function ke(r,e){if(r&1&&(o(0,"span",56),c(1),l()),r&2){let t=s().$implicit,i=s().$implicit;m(),_(" ",t[i]," ")}}function Be(r,e){if(r&1&&(o(0,"td",55),C(1,ue,2,1,"span",56)(2,he,5,4,"span",57)(3,de,3,1,"span",58)(4,_e,2,1,"span",56)(5,fe,2,1,"span",56)(6,xe,3,4,"span",56)(7,ye,3,4,"span",56)(8,Ce,3,4,"span",59)(9,Se,3,1,"span",56)(10,ve,3,4,"span",59)(11,ke,2,1,"span",56),l()),r&2){let t,i=s().$implicit;m(),D((t=i)==="STT"?1:t==="mabanggia"?2:t==="title"?3:t==="sanpham"?4:t==="status"?5:t==="batdau"?6:t==="ketthuc"?7:t==="createdAt"?8:t==="isActive"?9:t==="updatedAt"?10:11)}}function Me(r,e){if(r&1&&(Z(0,11),C(1,ge,29,5,"th",35)(2,Be,12,1,"td",36),tt()),r&2){let t=e.$implicit;f("matColumnDef",t)}}function Fe(r,e){r&1&&I(0,"tr",63)}function Le(r,e){r&1&&I(0,"tr",64)}function Te(r,e){r&1&&(o(0,"tr",65)(1,"td",66),c(2,"Kh\xF4ng t\xECm th\u1EA5y"),l()())}var F=class F{Detail={};displayedColumns=["mabanggia","title","type","sanpham","khachhang","batdau","ketthuc","status","createdAt"];ColumnName={mabanggia:"M\xE3 B\u1EA3ng Gi\xE1",title:"Ti\xEAu \u0110\u1EC1",type:"Lo\u1EA1i",sanpham:"S\u1EA3n Ph\u1EA9m",khachhang:"Kh\xE1ch H\xE0ng",batdau:"B\u1EAFt \u0110\u1EA7u",ketthuc:"K\u1EBFt Th\xFAc",status:"T\xECnh Tr\u1EA1ng",createdAt:"Ng\xE0y T\u1EA1o"};FilterColumns=JSON.parse(localStorage.getItem("BanggiaColFilter")||"[]");Columns=[];paginator;sort;drawer;filterValues={};_BanggiaGraphqlService=y(O);_GraphqlService=y(q);_breakpointObserver=y(ot);_router=y(P);dataSource=new j([]);_snackBar=y(pt);CountItem=0;isSearch=!1;constructor(){this.displayedColumns.forEach(e=>{this.filterValues[e]=""})}applyFilter(e){let t=e.target.value;this.dataSource.filter=t.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}ngOnInit(){return h(this,null,function*(){try{let t=(yield this._GraphqlService.findMany("banggia",{include:{khachhang:{select:{id:!0,name:!0}},sanpham:{select:{id:!0,sanphamId:!0}}},take:99999,orderBy:{createdAt:"desc"}})).map(i=>L(B({},i),{sanpham:i.sanpham.length,khachhang:i.khachhang.length}));this.CountItem=t.length,this.dataSource=new j(t),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.initializeColumns(),this.setupDrawer(),this.paginator._intl.itemsPerPageLabel="S\u1ED1 l\u01B0\u1EE3ng 1 trang",this.paginator._intl.nextPageLabel="Ti\u1EBFp Theo",this.paginator._intl.previousPageLabel="V\u1EC1 Tr\u01B0\u1EDBc",this.paginator._intl.firstPageLabel="Trang \u0110\u1EA7u",this.paginator._intl.lastPageLabel="Trang Cu\u1ED1i"}catch(e){console.error("L\u1ED7i kh\u1EDFi t\u1EA1o danh s\xE1ch b\u1EA3ng gi\xE1:",e)}})}refresh(){return h(this,null,function*(){try{let e=yield this._GraphqlService.findMany("banggia",{include:{banggiaKhachhang:{include:{khachhang:{select:{id:!0,title:!0,ma:!0}}}},banggiaSanpham:{include:{sanpham:{select:{id:!0,title:!0,masp:!0}}}}},orderBy:{createdAt:"desc"}});this.dataSource.data=e,this.CountItem=e.length}catch(e){console.error("L\u1ED7i l\xE0m m\u1EDBi danh s\xE1ch b\u1EA3ng gi\xE1:",e),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi l\xE0m m\u1EDBi danh s\xE1ch","\u0110\xF3ng",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"],duration:3e3})}})}Banggiamacdinh(e){return h(this,null,function*(){try{let t=yield this._GraphqlService.findMany("banggiasanpham",{where:{banggiaId:e.id},include:{sanpham:{select:{id:!0,masp:!0,title:!0}}}}),i=t.map(a=>this._GraphqlService.updateOne("sanpham",{id:a.sanphamId},{giaban:a.giaban}));yield Promise.all(i),this._snackBar.open(`\u0110\xE3 c\u1EADp nh\u1EADt gi\xE1 b\xE1n m\u1EB7c \u0111\u1ECBnh cho ${t.length} s\u1EA3n ph\u1EA9m t\u1EEB b\u1EA3ng gi\xE1 ${e.title}`,"\u0110\xF3ng",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"],duration:3e3})}catch(t){console.error("L\u1ED7i c\u1EADp nh\u1EADt gi\xE1 b\xE1n m\u1EB7c \u0111\u1ECBnh:",t),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi c\u1EADp nh\u1EADt gi\xE1 b\xE1n","\u0110\xF3ng",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"],duration:3e3})}})}initializeColumns(){this.Columns=Object.keys(this.ColumnName).map(e=>({key:e,value:this.ColumnName[e],isShow:!0})),this.FilterColumns.length===0?this.FilterColumns=this.Columns:localStorage.setItem("BanggiaColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{})}setupDrawer(){this._breakpointObserver.observe([st.Handset]).subscribe(e=>{e.matches?(this.drawer.mode="over",this.paginator.hidePageSize=!0):this.drawer.mode="side"})}toggleColumn(e){let t=this.FilterColumns.find(i=>i.key===e.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}FilterHederColumn(e,t){return e.filter((a,n,p)=>n===p.findIndex(k=>k[t]===a[t]))}doFilterHederColumn(e,t){this.dataSource.filteredData=this.dataSource.data.filter(a=>Tt(a[t]).includes(e.target.value.toLowerCase())||a[t].toLowerCase().includes(e.target.value.toLowerCase()));let i=e.target.value.toLowerCase()}ListFilter=[];ChosenItem(e,t){let i=this.dataSource.filteredData.filter(n=>n[t]===e[t]);this.ListFilter.filter(n=>n[t]===e[t]).length>0?this.ListFilter=this.ListFilter.filter(n=>n[t]!==e[t]):this.ListFilter=[...this.ListFilter,...i]}ChosenAll(e){e.forEach(t=>{!!this.ListFilter.find(a=>a.id===t.id)?this.ListFilter=this.ListFilter.filter(a=>a.id!==a.id):this.ListFilter.push(t)})}ResetFilter(){this.ListFilter=this.dataSource.data,this.dataSource.data=this.dataSource.data,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}EmptyFiter(){this.ListFilter=[]}CheckItem(e){return!!this.ListFilter.find(t=>t.id===e.id)}ApplyFilterColum(e){this.dataSource.data=this.dataSource.data.filter(t=>this.ListFilter.some(i=>i.id===t.id)),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,e.closeMenu()}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("BanggiaColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(i=>i.value.toLowerCase().includes(t))}create(){this.drawer.open(),this._router.navigate(["admin/banggia","new"])}goToDetail(e){this._BanggiaGraphqlService.setBanggiaId(e.id),this.drawer.open(),this._router.navigate(["admin/banggia",e.id])}convertDataToData1(e){return!e||e.length===0?[]:Object.keys(e[0]).filter(a=>!["masp","title","giagoc"].includes(a)).map(a=>({mabanggia:a,title:`B\u1EA3ng gi\xE1 ${a.replace("BG","")}`,sanpham:e.map(n=>({masp:n.masp,title:n.title,giagoc:n.giagoc,giaban:n[a]||0}))}))}DoImportData(e){return h(this,null,function*(){try{if(!e.SPBG||!e.BG||!e.BGKH){this._snackBar.open("SPBG ho\u1EB7c BG ho\u1EB7c BGKH kh\xF4ng t\u1ED3n t\u1EA1i","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}let t=(e.BG||[]).map(n=>({mabanggia:n.mabanggia,type:n.type,batdau:(0,T.default)(Y(n.batdau)).toDate(),ketthuc:(0,T.default)(Y(n.ketthuc)).toDate(),ghichu:n.ghichu,status:n.status})).filter(n=>n.mabanggia!==void 0&&n.mabanggia!==null&&n.mabanggia!=="");for(let n of t)yield this._GraphqlService.createOne("banggia",{mabanggia:n.mabanggia,type:n.type,batdau:n.batdau,ketthuc:n.ketthuc,ghichu:n.ghichu,status:n.status});let i=this.convertDataToData1(e.SPBG);for(let n of i)yield this._GraphqlService.createOne("banggiasanpham",n);let a=(e.BGKH||[]).map(n=>({mabanggia:n.mabanggia,name:n.name,makh:n.makh}));for(let n of a)yield this._GraphqlService.createOne("banggiaKhachhang",n);this._snackBar.open("Import Th\xE0nh C\xF4ng","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),yield this.refresh()}catch(t){console.error("L\u1ED7i import d\u1EEF li\u1EC7u:",t),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import d\u1EEF li\u1EC7u","\u0110\xF3ng",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"],duration:3e3})}})}ImportExcel(e){return h(this,null,function*(){let t=yield Ut(e);this.DoImportData(t)})}ExportExcel(e,t){return h(this,null,function*(){try{let i=yield this._GraphqlService.findMany("sanpham",{select:{id:!0,masp:!0,title:!0,giaban:!0}}),a=this.convertToData3(e,i),n=yield this._GraphqlService.findMany("banggia",{include:{banggiaKhachhang:{include:{khachhang:{select:{id:!0,ma:!0,title:!0}}}}}}),p=n.reduce((x,H)=>(Array.isArray(H.banggiaKhachhang)&&H.banggiaKhachhang.forEach(Q=>{x.push({mabanggia:H.mabanggia,makh:Q.khachhang.ma,name:Q.khachhang.title})}),x),[]),k=n.map(x=>({mabanggia:x.mabanggia,type:x.type,batdau:(0,T.default)(x.batdau).format("DD/MM/YYYY"),ketthuc:(0,T.default)(x.ketthuc).format("DD/MM/YYYY"),ghichu:x.ghichu,status:x.status}));Jt({SPBG:{data:a},BG:{data:k},BGKH:{data:p}},t)}catch(i){console.error("L\u1ED7i export Excel:",i),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi export d\u1EEF li\u1EC7u","\u0110\xF3ng",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"],duration:3e3})}})}convertToData3(e,t){let i=new Set(e.map(a=>a.mabanggia));return t.map(a=>B({masp:a.masp,title:a.title,giaban:a.giaban.toString()},Array.from(i).reduce((n,p)=>(n[p]=a.giaban.toString(),n),{})))}trackByFn(e,t){return t.id}ListStatus=[{value:"baogia",title:"B\xE1o Gi\xE1"},{value:"dangban",title:"\u0110ang B\xE1n"},{value:"ngungban",title:"Ng\u1EEBng B\xE1n"}];getName(e,t,i){return e.find(a=>a[t]===i)}static \u0275fac=function(t){return new(t||F)};static \u0275cmp=U({type:F,selectors:[["app-listbanggia"]],viewQuery:function(t,i){if(t&1&&(V(It,5),V($,5),V(ee,7)),t&2){let a;G(a=A())&&(i.paginator=a.first),G(a=A())&&(i.sort=a.first),G(a=A())&&(i.drawer=a.first)}},decls:14,vars:7,consts:[["drawer",""],["menu","matMenu"],["uploadfile",""],["menuTrigger","matMenuTrigger"],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-12","w-full","p-2"],["class","cursor-pointer w-full relative flex lg:flex-row lg:space-y-2 space-y-0 flex-col space-x-2 justify-between items-center p-2 bg-white rounded-lg",4,"ngIf"],["class","py-2 w-full flex flex-row space-x-2 items-center",4,"ngIf"],[1,"w-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","h-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:bg-slate-100",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[1,"cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","p-2","bg-white","rounded-lg"],[1,"flex","flex-row","space-x-2","items-center"],["matTooltip","Th\xEAm m\u1EDBi","mat-flat-button","",1,"flex","flex-row","items-center","btn-primary",3,"click"],[1,"whitespace-nowrap"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["matTooltip","T\xECm Ki\u1EBFm","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\u1EA3i file excel M\u1EABu","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\u1EA3i l\xEAn file excel","color","primary","mat-icon-button","",3,"click"],["type","file",1,"hidden",3,"change"],[1,"lg:flex","hidden","whitespace-nowrap","p-2","rounded-lg","bg-slate-200"],["mat-menu-item","",3,"click"],[1,"py-2","w-full","flex","flex-row","space-x-2","items-center"],["matInput","","placeholder","Vui l\xF2ng T\xECm Ki\u1EBFm",3,"keyup"],["mat-icon-button","","color","warn",3,"click"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"max-w-40","line-clamp-4","me-4"],[1,"z-10","material-symbols-outlined","text-gray-500",3,"matMenuTriggerFor"],[1,"cursor-pointer","flex","flex-col","space-y-4","p-3",3,"click"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[1,"flex","flex-row","space-x-2","items-center","justify-between"],[1,"text-xs","text-blue-600","underline",3,"click"],[1,"w-full","flex","flex-col","space-y-2","max-h-44","overflow-auto"],["class","flex flex-row space-x-2 items-center p-2 rounded-lg hover:bg-slate-100",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-row","space-x-2","items-end","justify-end"],["mat-flat-button","","color","warn",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"flex","flex-row","space-x-2","items-center","p-2","rounded-lg","hover:bg-slate-100",3,"click"],["class","material-symbols-outlined text-blue-600",4,"ngIf"],[1,"material-symbols-outlined","text-blue-600"],["mat-cell",""],[1,"max-w-40","line-clamp-4"],[1,"flex","gap-2","max-w-40","line-clamp-4","items-center"],[1,"flex","max-w-40","line-clamp-4","font-bold","text-blue-700"],[1,"max-w-40","line-clamp-4","text-xs"],[3,"click"],[1,"text-green-500"],[1,"text-red-500"],["mat-header-row",""],["mat-row","",1,"hover:bg-slate-100"],[1,"mat-row"],["colspan","4",1,"mat-cell","p-4"]],template:function(t,i){t&1&&(o(0,"mat-drawer-container",4)(1,"mat-drawer",5,0),I(3,"router-outlet"),l(),o(4,"div",6),C(5,ne,33,2,"div",7)(6,re,8,0,"div",8),o(7,"div",9)(8,"table",10),K(9,Me,3,1,"ng-container",11,X),C(11,Fe,1,0,"tr",12)(12,Le,1,0,"tr",13)(13,Te,3,0,"tr",14),l()()()()),t&2&&(m(),f("position","end"),m(4),f("ngIf",!i.isSearch),m(),f("ngIf",i.isSearch),m(2),f("dataSource",i.dataSource),m(),z(i.displayedColumns),m(2),f("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),m(),f("matRowDefColumns",i.displayedColumns))},dependencies:[Bt,kt,St,vt,Ft,Mt,Qt,Pt,qt,Nt,Ot,$t,Kt,Ht,Rt,zt,jt,Yt,At,$,Gt,Vt,bt,yt,xt,Ct,dt,ut,ht,rt,ft,_t,mt,lt,ct,Lt,nt,et,it,at,wt,Dt,Et],encapsulation:2,changeDetection:0})};R([Ee()],F.prototype,"FilterHederColumn",1),R([De(300)],F.prototype,"doFilterHederColumn",1);var Wt=F;function Ee(){return function(r,e,t){let i=t.value,a=new Map;return t.value=function(...n){let p=JSON.stringify(n);if(a.has(p))return a.get(p);let k=i.apply(this,n);return a.set(p,k),k},t}}function De(r=300){return function(e,t,i){let a=i.value,n;return i.value=function(...p){clearTimeout(n),n=setTimeout(()=>{a.apply(this,p)},r)},i}}export{O as a,Wt as b};
