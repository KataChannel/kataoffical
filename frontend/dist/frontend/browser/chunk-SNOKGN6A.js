import{a as ue}from"./chunk-T3I7LD2D.js";import"./chunk-3K5YEGKC.js";import"./chunk-EMZOMTTG.js";import{a as he,b as ce}from"./chunk-UPQ5OBSG.js";import{a as G}from"./chunk-EOEI42HP.js";import{a as H}from"./chunk-HVTWWBOW.js";import{h as ee}from"./chunk-VY3VMUK4.js";import"./chunk-SXROZ6BE.js";import"./chunk-4RMR2YQR.js";import"./chunk-GXQFLAMA.js";import"./chunk-EF567M4M.js";import"./chunk-RKSUXRSP.js";import"./chunk-H2G5L6SK.js";import{b as oe}from"./chunk-GZGTJBDK.js";import{d as se,e as T}from"./chunk-NVPNJQEU.js";import{a as R}from"./chunk-H54S5G77.js";import"./chunk-FGFEII7E.js";import"./chunk-TRYEEDFV.js";import"./chunk-D4QDDQOA.js";import{a as F,b as W,d as j}from"./chunk-VNKEAMBS.js";import{b as X,g as Q,j as Y,l as Z,n as $,p as te,u as ie,v as ae,x as ne,y as re}from"./chunk-6CYPKWCK.js";import"./chunk-MZWUMQWW.js";import{a as z,b as K}from"./chunk-R3HJY4YP.js";import{a as S}from"./chunk-AQK6ZTVG.js";import{a as U}from"./chunk-N7CMVMO3.js";import"./chunk-T3Q3DASN.js";import"./chunk-R6Q2HSJ3.js";import{a as J,c as E}from"./chunk-VRKGIU2A.js";import"./chunk-E733KNN5.js";import{m as O,q}from"./chunk-2CV4OV4X.js";import{Ab as V,Ac as I,Gc as _,Hb as M,Hc as y,Ic as P,Na as v,Rb as p,ac as r,bc as o,dc as k,ec as A,fa as L,fd as N,gc as D,ka as b,la as C,lc as f,nc as l,ob as u,ua as g,va as d,zc as h}from"./chunk-FKNCN4IQ.js";import{j as s}from"./chunk-XXD5T5ZZ.js";var x=class c{constructor(n,t){this._StorageService=n;this.router=t}ListPhieuchiahang=v([]);DetailPhieuchiahang=v({});phieuchiahangId=v(null);setPhieuchiahangId(n){this.phieuchiahangId.set(n)}socket=G(`${S.APIURL}`,{transports:["websocket"],reconnectionAttempts:5,timeout:5e3});CreatePhieuchiahang(n){return s(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},e=yield fetch(`${S.APIURL}/phieuchiahang`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let i=yield e.json();if(!e.ok)if(e.status===401){let a=JSON.stringify({code:e.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else if(e.status===403){let a=JSON.stringify({code:e.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else if(e.status===500){let a=JSON.stringify({code:e.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else{let a=JSON.stringify({code:e.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}this.getAllPhieuchiahang(),this.phieuchiahangId.set(i.id)}catch(t){return console.error(t)}})}getAllPhieuchiahang(){return s(this,null,function*(){let t=yield(yield this.initDB()).getAll("phieuchiahangs"),e=parseInt(localStorage.getItem("updatedAt")||"0");try{let i={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")}},a=yield fetch(`${S.APIURL}/phieuchiahang`,i);if(!a.ok)if(a.status===401){let m=JSON.stringify({code:a.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:m}})}else if(a.status===403){let m=JSON.stringify({code:a.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:m}})}else if(a.status===500){let m=JSON.stringify({code:a.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:m}})}else{let m=JSON.stringify({code:a.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:m}})}let w=yield a.json(),B=w.reduce((m,ge)=>Math.max(m,new Date(ge.updatedAt).getTime()),0);return B>e&&(yield this.savePhieuchiahangs(w),localStorage.setItem("lastUpdated",B),localStorage.setItem("phieuchiahangs",JSON.stringify(w))),this.ListPhieuchiahang.set(w),t.length>0?t:w}catch(i){return console.error(i)}})}listenPhieuchiahangUpdates(){this.socket.on("phieuchiahang-updated",()=>s(this,null,function*(){console.log("\u{1F504} D\u1EEF li\u1EC7u s\u1EA3n ph\u1EA9m thay \u0111\u1ED5i, c\u1EADp nh\u1EADt l\u1EA1i cache..."),yield this.getAllPhieuchiahang()}))}initDB(){return s(this,null,function*(){return yield H("PhieuchiahangDB",1,{upgrade(n){n.createObjectStore("phieuchiahangs",{keyPath:"id"})}})})}savePhieuchiahangs(n){return s(this,null,function*(){let e=(yield this.initDB()).transaction("phieuchiahangs","readwrite"),i=e.objectStore("phieuchiahangs");yield i.clear(),n.forEach(a=>i.put(a)),yield e.done})}getPhieuchiahangByid(n){return s(this,null,function*(){try{let t={method:"GET",headers:{"Content-Type":"application/json"}},e=yield fetch(`${S.APIURL}/phieuchiahang/findid/${n}`,t);if(!e.ok)if(e.status===401){let a=JSON.stringify({code:e.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else if(e.status===403){let a=JSON.stringify({code:e.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else if(e.status===500){let a=JSON.stringify({code:e.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else{let a=JSON.stringify({code:e.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}let i=yield e.json();this.DetailPhieuchiahang.set(i)}catch(t){return console.error(t)}})}updatePhieuchiahang(n){return s(this,null,function*(){try{let t={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},e=yield fetch(`${S.APIURL}/phieuchiahang/${n.id}`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let i=yield e.json();if(!e.ok)if(e.status===401){let a=JSON.stringify({code:e.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else if(e.status===403){let a=JSON.stringify({code:e.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else if(e.status===500){let a=JSON.stringify({code:e.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else{let a=JSON.stringify({code:e.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}this.getAllPhieuchiahang(),this.getPhieuchiahangByid(n.id)}catch(t){return console.error(t)}})}DeletePhieuchiahang(n){return s(this,null,function*(){try{let t={method:"DELETE",headers:{"Content-Type":"application/json"}},e=yield fetch(`${S.APIURL}/phieuchiahang/${n.id}`,t);if(!e.ok)if(e.status===401){let i=JSON.stringify({code:e.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:i}})}else if(e.status===403){let i=JSON.stringify({code:e.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:i}})}else if(e.status===500){let i=JSON.stringify({code:e.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:i}})}else{let i=JSON.stringify({code:e.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:i}})}this.getAllPhieuchiahang()}catch(t){return console.error(t)}})}static \u0275fac=function(t){return new(t||c)(b(U),b(E))};static \u0275prov=L({token:c,factory:c.\u0275fac,providedIn:"root"})};function pe(c,n){if(c&1){let t=D();r(0,"button",1),f("click",function(){g(t);let i=l();return d(i.handlePhieuchiahangAction())}),r(1,"mat-icon"),h(2,"save"),o()()}}function me(c,n){if(c&1){let t=D();r(0,"button",1),f("click",function(){g(t);let i=l();return d(i.toggleEdit())}),r(1,"mat-icon"),h(2,"edit"),o()()}}function fe(c,n){if(c&1){let t=D();k(0),r(1,"div",9)(2,"div",10),h(3,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),o(),r(4,"div",11)(5,"button",12),f("click",function(){g(t);let i=l();return d(i.DeleteData())}),h(6,"\u0110\u1ED3ng \xDD"),o(),r(7,"button",13),f("click",function(){g(t);let i=l();return d(i.toggleDelete())}),h(8,"Hu\u1EF7 B\u1ECF"),o()()(),A()}}function _e(c,n){if(c&1){let t=D();k(0)(1),r(2,"mat-form-field",14)(3,"mat-label"),h(4,"Ti\xEAu \u0110\u1EC1"),o(),r(5,"input",15),P("ngModelChange",function(i){g(t);let a=l();return y(a.DetailPhieuchiahang().title,i)||(a.DetailPhieuchiahang().title=i),d(i)}),f("input",function(){g(t);let i=l();return d(i.FillSlug())}),o()(),r(6,"mat-form-field",14)(7,"mat-label"),h(8,"M\xE3 S\u1EA3n Ph\u1EA9m"),o(),r(9,"input",16),P("ngModelChange",function(i){g(t);let a=l();return y(a.DetailPhieuchiahang().masp,i)||(a.DetailPhieuchiahang().masp=i),d(i)}),o()(),r(10,"mat-form-field",14)(11,"mat-label"),h(12,"Gi\xE1 G\u1ED1c"),o(),r(13,"input",17),P("ngModelChange",function(i){g(t);let a=l();return y(a.DetailPhieuchiahang().giagoc,i)||(a.DetailPhieuchiahang().giagoc=i),d(i)}),o()(),r(14,"mat-form-field",14)(15,"mat-label"),h(16,"\u0110\u01A1n V\u1ECB T\xEDnh"),o(),r(17,"input",16),P("ngModelChange",function(i){g(t);let a=l();return y(a.DetailPhieuchiahang().dvt,i)||(a.DetailPhieuchiahang().dvt=i),d(i)}),o()(),r(18,"div",18)(19,"mat-form-field",14)(20,"mat-label"),h(21,"S\u1ED1 L\u01B0\u1EE3ng"),o(),r(22,"input",19),P("ngModelChange",function(i){g(t);let a=l();return y(a.DetailPhieuchiahang().soluong,i)||(a.DetailPhieuchiahang().soluong=i),d(i)}),o()(),r(23,"mat-form-field",14)(24,"mat-label"),h(25,"S\u1ED1 L\u01B0\u1EE3ng Kho"),o(),r(26,"input",19),P("ngModelChange",function(i){g(t);let a=l();return y(a.DetailPhieuchiahang().soluongkho,i)||(a.DetailPhieuchiahang().soluongkho=i),d(i)}),o()()(),A()()}if(c&2){let t=l();u(5),_("ngModel",t.DetailPhieuchiahang().title),p("disabled",!t.isEdit()),u(4),_("ngModel",t.DetailPhieuchiahang().masp),p("disabled",!t.isEdit()),u(4),_("ngModel",t.DetailPhieuchiahang().giagoc),p("disabled",!t.isEdit()),u(4),_("ngModel",t.DetailPhieuchiahang().dvt),p("disabled",!t.isEdit()),u(5),_("ngModel",t.DetailPhieuchiahang().soluong),p("disabled",!t.isEdit()),u(4),_("ngModel",t.DetailPhieuchiahang().soluongkho),p("disabled",!t.isEdit())}}var le=class c{_ListphieuchiahangComponent=C(ue);_PhieuchiahangService=C(x);_route=C(J);_router=C(E);_snackBar=C(R);constructor(){this._route.paramMap.subscribe(n=>{let t=n.get("id");this._PhieuchiahangService.setPhieuchiahangId(t)}),N(()=>s(this,null,function*(){let n=this._PhieuchiahangService.phieuchiahangId();n||(this._router.navigate(["/admin/phieuchiahang"]),this._ListphieuchiahangComponent.drawer.close()),n==="0"?(this.DetailPhieuchiahang.set({title:T(8,!1),slug:T(8,!1)}),this._ListphieuchiahangComponent.drawer.open(),this.isEdit.update(t=>!t),this._router.navigate(["/admin/phieuchiahang","0"])):(yield this._PhieuchiahangService.getPhieuchiahangByid(n),this._ListphieuchiahangComponent.drawer.open(),this._router.navigate(["/admin/phieuchiahang",n]))}))}DetailPhieuchiahang=this._PhieuchiahangService.DetailPhieuchiahang;isEdit=v(!1);isDelete=v(!1);phieuchiahangId=this._PhieuchiahangService.phieuchiahangId;ngOnInit(){return s(this,null,function*(){})}handlePhieuchiahangAction(){return s(this,null,function*(){this.phieuchiahangId()==="0"?yield this.createPhieuchiahang():yield this.updatePhieuchiahang()})}createPhieuchiahang(){return s(this,null,function*(){try{yield this._PhieuchiahangService.CreatePhieuchiahang(this.DetailPhieuchiahang()),this._snackBar.open("T\u1EA1o M\u1EDBi Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(n=>!n)}catch(n){console.error("L\u1ED7i khi t\u1EA1o phieuchiahang:",n)}})}updatePhieuchiahang(){return s(this,null,function*(){try{yield this._PhieuchiahangService.updatePhieuchiahang(this.DetailPhieuchiahang()),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(n=>!n)}catch(n){console.error("L\u1ED7i khi c\u1EADp nh\u1EADt phieuchiahang:",n)}})}DeleteData(){return s(this,null,function*(){try{yield this._PhieuchiahangService.DeletePhieuchiahang(this.DetailPhieuchiahang()),this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this._router.navigate(["/admin/phieuchiahang"])}catch(n){console.error("L\u1ED7i khi x\xF3a phieuchiahang:",n)}})}goBack(){this._router.navigate(["/admin/phieuchiahang"]),this._ListphieuchiahangComponent.drawer.close()}trackByFn(n,t){return t.id}toggleEdit(){this.isEdit.update(n=>!n)}toggleDelete(){this.isDelete.update(n=>!n)}FillSlug(){this.DetailPhieuchiahang.update(n=>(n.slug=se(n.title),n))}static \u0275fac=function(t){return new(t||c)};static \u0275cmp=V({type:c,selectors:[["app-detailphieuchiahang"]],decls:17,vars:8,consts:[[1,"flex","flex-row","justify-between","items-center","space-x-2","p-2"],["mat-icon-button","","color","primary",3,"click"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center"],[3,"ngModelChange","ngModel","disabled"],["mat-icon-button","","color","primary",3,"click",4,"ngIf"],["mat-icon-button","","color","warn",3,"click"],[1,"relative","flex","flex-col","w-full","p-4","overflow-auto"],[4,"ngIf"],[1,"flex","flex-col","space-y-4","items-center","justify-center"],[1,"font-bold","text-2xl"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],["appearance","outline"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp Ti\xEAu \u0110\u1EC1",3,"ngModelChange","input","ngModel","disabled"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp M\xE3 S\u1EA3n Ph\u1EA9m",3,"ngModelChange","ngModel","disabled"],["matInput","","type","number","placeholder","Vui l\xF2ng nh\u1EADp Gi\xE1 G\u1ED1c",3,"ngModelChange","ngModel","disabled"],[1,"flex","flex-row","space-x-2"],["matInput","","type","number","placeholder","Vui l\xF2ng nh\u1EADp M\xE3 S\u1EA3n Ph\u1EA9m",3,"ngModelChange","ngModel","disabled"]],template:function(t,e){if(t&1&&(r(0,"div",0)(1,"button",1),f("click",function(){return e.goBack()}),r(2,"mat-icon"),h(3,"arrow_back"),o()(),r(4,"div",2),h(5),o(),r(6,"div",3)(7,"mat-slide-toggle",4),P("ngModelChange",function(a){return y(e.DetailPhieuchiahang().isActive,a)||(e.DetailPhieuchiahang().isActive=a),a}),h(8),o(),M(9,pe,3,0,"button",5)(10,me,3,0,"button",5),r(11,"button",6),f("click",function(){return e.toggleDelete()}),r(12,"mat-icon"),h(13,"delete"),o()()()(),r(14,"div",7),M(15,fe,9,0,"ng-container",8)(16,_e,27,12,"ng-container",8),o()),t&2){let i;u(5),I(((i=e.DetailPhieuchiahang())==null?null:i.title)||"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),u(2),_("ngModel",e.DetailPhieuchiahang().isActive),p("disabled",!e.isEdit()),u(),I(e.DetailPhieuchiahang().isActive?"Hi\u1EC3n Th\u1ECB":"\u1EA8n"),u(),p("ngIf",e.isEdit()),u(),p("ngIf",!e.isEdit()),u(5),p("ngIf",e.isDelete()),u(),p("ngIf",!e.isDelete())}},dependencies:[ae,ie,te,re,ne,$,X,Z,Q,Y,K,z,j,F,W,oe,ee,q,O,ce,he],encapsulation:2})};export{le as DetailPhieuchiahangComponent};
