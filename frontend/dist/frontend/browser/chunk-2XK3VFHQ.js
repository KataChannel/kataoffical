import{a as re,b as it}from"./chunk-GLRN4W5E.js";import{a as ne,b as tt}from"./chunk-J3IYQA4G.js";import{a as te}from"./chunk-SCGPCYBL.js";import{a as $e}from"./chunk-BFIAAR4D.js";import"./chunk-XLFIXRGG.js";import"./chunk-LTIMMLFX.js";import{d as ze,e as Ne}from"./chunk-STTHC4C4.js";import"./chunk-ZW44ZSN2.js";import"./chunk-BQNHPUMH.js";import{a as be,b as Se,c as we,d as Re}from"./chunk-SLRDYDMI.js";import{a as Pe}from"./chunk-N7PBUGTM.js";import{a as Je,b as Ye,d as Ze,f as et}from"./chunk-W4IWOATG.js";import{c as Ke,e as Xe,f as z}from"./chunk-SNPDHAIQ.js";import{b as Ue,c as De,d as Me,e as Ie}from"./chunk-ZECXV4P7.js";import{b as He}from"./chunk-TPFOWWOO.js";import"./chunk-TDAACTQD.js";import{h as Be}from"./chunk-INJUMOX2.js";import"./chunk-H7UDLENL.js";import{a as ye}from"./chunk-GD7IEZTW.js";import"./chunk-DP4FJZ2N.js";import"./chunk-QIIVLJEC.js";import{a as Ce,c as Ee}from"./chunk-RFYKARPR.js";import{a as je,b as We}from"./chunk-IKSNCL6N.js";import{a as O,b as V,c as G,d as ie,f as Q,g as q}from"./chunk-LAM2JYAU.js";import"./chunk-B52A5VRT.js";import{b as qe}from"./chunk-6S4AGD7B.js";import{A as Qe,b as Te,g as ke,j as Fe,o as Ae,q as Le,w as Oe,x as Ve,z as Ge}from"./chunk-KWM4OIFF.js";import"./chunk-KBSHTQVA.js";import{a as B,b as L}from"./chunk-4KMAECDD.js";import"./chunk-B5XVARHK.js";import"./chunk-KY47JUDC.js";import"./chunk-2PPFUFFT.js";import{a as F,c as ee,e as A}from"./chunk-5RXGINDA.js";import"./chunk-RO6MDUJX.js";import"./chunk-HMVCX5BQ.js";import{m as Z,w as k}from"./chunk-RGQ7KTVF.js";import{$b as C,Cc as K,Db as D,Dc as s,Ec as b,Fc as E,Ic as X,J as _e,Jc as J,Kb as _,Kc as Y,Na as W,Ra as f,Ub as p,Vb as fe,Wb as he,Xb as xe,ac as ue,cc as S,d as de,dc as w,ec as o,fc as r,gc as M,hc as I,ic as T,ja as H,kc as P,kd as R,md as ve,oa as ge,pa as y,pc as v,q as j,rb as m,rc as c,v as pe,ya as h,za as x}from"./chunk-OL5DVADB.js";import"./chunk-LWLSKGAV.js";import{a as U,b as N,j as g}from"./chunk-6DYNGEAS.js";var oe=class i{constructor(t){this.storageService=t}_allRoles=f([]);_searchTerm=f("");_currentPage=f(1);_pageSize=f(50);_isLoading=f(!1);_selectedRoles=f(new Set);_statusFilter=f("all");searchResults=R(()=>{let t=this._allRoles(),e=this._searchTerm().toLowerCase();return e&&(t=t.filter(n=>n.name.toLowerCase().includes(e))),t});allRoles=this._allRoles.asReadonly();filteredRoles=this.searchResults;searchTerm=this._searchTerm.asReadonly();currentPage=this._currentPage.asReadonly();pageSize=this._pageSize.asReadonly();isLoading=this._isLoading.asReadonly();selectedRoles=this._selectedRoles.asReadonly();statusFilter=this._statusFilter.asReadonly();totalItems=R(()=>this.searchResults().length);totalPages=R(()=>Math.ceil(this.totalItems()/this._pageSize()));paginatedRoles=R(()=>{let t=(this._currentPage()-1)*this._pageSize(),e=t+this._pageSize();return this.searchResults().slice(t,e)});graphqlService=y($e);loadAllRoles(t=!1){return g(this,null,function*(){if(!t&&this._allRoles().length>0)return this._allRoles();this._isLoading.set(!0);try{let e={orderBy:{name:"asc"},include:{permissions:{include:{permission:{select:{id:!0,name:!0,codeId:!0}}}},users:{include:{user:{include:{profile:{select:{name:!0,avatar:!0,bio:!0}}}}}}}},n=yield this.graphqlService.findMany("role",e);return this._allRoles.set(n),this._currentPage.set(1),n}catch(e){throw console.error("Error loading roles:",e),e}finally{this._isLoading.set(!1)}})}createRole(t){return g(this,null,function*(){this._isLoading.set(!0);try{let e={name:t.name},n=yield this.graphqlService.createOne("role",{data:e,include:{permissions:{include:{permission:{select:{id:!0,name:!0,codeId:!0}}}},users:{include:{user:{include:{profile:{select:{name:!0,avatar:!0,bio:!0}}}}}}}});if(t.permissionIds&&t.permissionIds.length>0){yield this.assignPermissionsToRole(n.id,t.permissionIds);let l=yield this.getRoleById(n.id);if(l){let d=this._allRoles();return this._allRoles.set([l,...d.filter(u=>u.id!==n.id)]),l}}let a=this._allRoles();return this._allRoles.set([n,...a]),n}catch(e){throw console.error("Error creating role:",e),e}finally{this._isLoading.set(!1)}})}updateRole(t,e){return g(this,null,function*(){this._isLoading.set(!0);try{let n=yield this.graphqlService.updateOne("role",{id:t},e,{include:{permissions:{include:{permission:{select:{id:!0,name:!0,codeId:!0}}}},users:{include:{user:{include:{profile:{select:{name:!0,avatar:!0,bio:!0}}}}}}}}),a=this._allRoles(),l=a.findIndex(d=>d.id===t);if(l!==-1){let d=[...a];d[l]=n,this._allRoles.set(d)}return n}catch(n){throw console.error("Error updating role:",n),n}finally{this._isLoading.set(!1)}})}deleteRole(t){return g(this,null,function*(){this._isLoading.set(!0);try{yield this.graphqlService.deleteOne("role",{id:t});let n=this._allRoles().filter(l=>l.id!==t);this._allRoles.set(n);let a=new Set(this._selectedRoles());a.delete(t),this._selectedRoles.set(a)}catch(e){throw console.error("Error deleting role:",e),e}finally{this._isLoading.set(!1)}})}getRoleById(t){return g(this,null,function*(){try{return yield this.graphqlService.findUnique("role",{id:t},{include:{permissions:{include:{permission:{select:{id:!0,name:!0,codeId:!0}}}},users:{include:{user:{include:{profile:{select:{name:!0,avatar:!0,bio:!0}}}}}}}})}catch(e){return console.error("Error getting role by id:",e),null}})}assignPermissionsToRole(t,e){return g(this,null,function*(){this._isLoading.set(!0);try{let n=e.map(l=>({roleId:t,permissionId:l}));yield this.graphqlService.batchCreate("rolePermission",n);let a=yield this.getRoleById(t);if(a){let l=this._allRoles(),d=l.findIndex(u=>u.id===t);if(d!==-1){let u=[...l];u[d]=a,this._allRoles.set(u)}}}catch(n){throw console.error("Error assigning permissions to role:",n),n}finally{this._isLoading.set(!1)}})}removePermissionFromRole(t,e){return g(this,null,function*(){this._isLoading.set(!0);try{let a=(yield this.getRoleById(t))?.permissions?.find(l=>l.permissionId===e);if(a){yield this.graphqlService.deleteOne("rolePermission",{id:a.id});let l=yield this.getRoleById(t);if(l){let d=this._allRoles(),u=d.findIndex($=>$.id===t);if(u!==-1){let $=[...d];$[u]=l,this._allRoles.set($)}}}}catch(n){throw console.error("Error removing permission from role:",n),n}finally{this._isLoading.set(!1)}})}setSearchTerm(t){this._searchTerm.set(t),this._currentPage.set(1)}setStatusFilter(t){this._statusFilter.set(t),this._currentPage.set(1)}setPage(t){t>=1&&t<=this.totalPages()&&this._currentPage.set(t)}setPageSize(t){this._pageSize.set(t),this._currentPage.set(1)}nextPage(){this._currentPage()<this.totalPages()&&this._currentPage.set(this._currentPage()+1)}previousPage(){this._currentPage()>1&&this._currentPage.set(this._currentPage()-1)}toggleRoleSelection(t){let e=new Set(this._selectedRoles());e.has(t)?e.delete(t):e.add(t),this._selectedRoles.set(e)}selectAllCurrentPage(){let t=new Set(this._selectedRoles());this.paginatedRoles().forEach(e=>{t.add(e.id)}),this._selectedRoles.set(t)}deselectAllCurrentPage(){let t=new Set(this._selectedRoles());this.paginatedRoles().forEach(e=>{t.delete(e.id)}),this._selectedRoles.set(t)}clearSelection(){this._selectedRoles.set(new Set)}isSelected(t){return this._selectedRoles().has(t)}get selectedCount(){return this._selectedRoles().size}get selectedIds(){return Array.from(this._selectedRoles())}findRoleById(t){return this._allRoles().find(e=>e.id===t)}getRolesByPermission(t){return this._allRoles().filter(e=>e.permissions?.some(n=>n.permissionId===t))}getRolePermissions(t){let e=this.findRoleById(t);return!e||!e.permissions?[]:e.permissions.map(n=>n.permission)}hasPermission(t,e){return this.getRolePermissions(t).some(a=>a.codeId===e)}getRolesByGroup(t){return this._allRoles().filter(e=>e.permissions?.some(n=>n.permission.group===t))}getUsersInRole(t){let e=this.findRoleById(t);return!e||!e.users?[]:e.users.map(n=>n.user)}clearCache(){this._allRoles.set([]),this._searchTerm.set(""),this._currentPage.set(1),this.clearSelection()}refreshData(){return this.loadAllRoles(!0)}static \u0275fac=function(e){return new(e||i)(ge(Pe))};static \u0275prov=H({token:i,factory:i.\u0275fac,providedIn:"root"})};var ae=class i{userPermissionService=y(ne);permissionService=y(tt);userService=y(re);cachedUsers=new Map;cachedPermissions=[];getUserPermissionDetails(t){return!t||t==="new"?j(null):this.cachedUsers.has(t)?j(this.cachedUsers.get(t)):this.loadUserWithPermissions(t).pipe(pe(e=>(e&&this.cachedUsers.set(t,e),e)),_e(e=>(console.error("Error loading user permission details:",e),j(null))))}getAllPermissions(){return this.cachedPermissions.length>0?j(this.cachedPermissions):new de(t=>{this.permissionService.loadAllPermissions().then(()=>{this.cachedPermissions=this.permissionService.allPermissions(),t.next(this.cachedPermissions),t.complete()}).catch(e=>{console.error("Error loading permissions:",e),t.next([]),t.complete()})})}getPermissionSummary(t){let e=this.extractRolePermissions(t.roles),n=t.userPermissions.filter(d=>d.isGranted),a=t.userPermissions.filter(d=>!d.isGranted),l=this.calculateEffectivePermissions(e,n.map(d=>d.permission),a.map(d=>d.permission));return{totalRolePermissions:e.length,grantedPermissions:n.length,deniedPermissions:a.length,effectivePermissions:l,rolePermissions:e,userGranted:n,userDenied:a}}clearCache(){this.cachedUsers.clear(),this.cachedPermissions=[]}clearUserCache(t){this.cachedUsers.delete(t)}loadUserWithPermissions(t){return new de(e=>{this.loadUserWithPermissionsAsync(t).then(n=>{e.next(n),e.complete()}).catch(n=>{console.error("Error in loadUserWithPermissions:",n),e.next(null),e.complete()})})}loadUserWithPermissionsAsync(t){return g(this,null,function*(){try{let e=yield this.userService.getUserById(t);if(!e)return null;let n=yield this.userPermissionService.getUserPermissions(t);return{id:e.id,email:e.email,SDT:e.SDT,isActive:e.isActive,profile:e.profile,roles:e.roles||[],userPermissions:n.map(l=>({id:l.id,isGranted:l.isGranted,permission:l.permission?{id:l.permission.id,name:l.permission.name,code:l.permission.codeId||"",description:l.permission.description,isActive:!0,createdAt:new Date,updatedAt:new Date}:{id:"",name:"Unknown Permission",code:"",description:"",isActive:!1,createdAt:new Date,updatedAt:new Date},createdAt:l.createdAt?.toISOString(),updatedAt:l.updatedAt?.toISOString()}))}}catch(e){return console.error("Error in loadUserWithPermissionsAsync:",e),null}})}extractRolePermissions(t){let e=new Map;return t.forEach(n=>{let a=n.role;a&&a.permissions&&a.permissions.forEach(l=>{if(l&&l.id){let d={id:l.id,name:l.name,code:l.codeId||l.code||"",description:l.description,isActive:!0,createdAt:new Date,updatedAt:new Date};e.set(l.id,d)}})}),Array.from(e.values())}calculateEffectivePermissions(t,e,n){let a=new Map;return t.forEach(l=>{a.set(l.id,l)}),e.forEach(l=>{if(l&&l.id){let d={id:l.id,name:l.name,code:l.codeId||l.code||"",description:l.description,isActive:!0,createdAt:new Date,updatedAt:new Date};a.set(l.id,d)}}),n.forEach(l=>{l&&l.id&&a.delete(l.id)}),Array.from(a.values())}static \u0275fac=function(e){return new(e||i)};static \u0275prov=H({token:i,factory:i.\u0275fac,providedIn:"root"})};var lt=(i,t)=>t.id||t.roleId,mt=(i,t)=>t.id||t.name;function ct(i,t){if(i&1&&(o(0,"p",11),s(1),r()),i&2){let e=c().$implicit;m(),E(" ",(e.role==null?null:e.role.description)||e.description," ")}}function dt(i,t){if(i&1&&(o(0,"span",12),s(1),r()),i&2){let e=c().$implicit,n=c(2);m(),E(" ",n.getRolePermissions(e).length," quy\u1EC1n ")}}function ut(i,t){if(i&1&&(o(0,"span",17),s(1),r()),i&2){let e=t.$implicit;p("title",e.description||e.name),m(),E(" ",e.name," ")}}function pt(i,t){if(i&1){let e=P();o(0,"button",19),v("click",function(){h(e);let a=c(2).$implicit,l=c(2);return x(l.toggleShowPermissions(a.id||a.roleId))}),s(1),r()}if(i&2){let e=c(2).$implicit,n=c(2);m(),E(" ",n.showAllPermissions[e.id||e.roleId]?"Thu g\u1ECDn":"..."+(n.getRolePermissions(e).length-4)+" n\u1EEFa"," ")}}function _t(i,t){if(i&1&&(o(0,"div",13)(1,"div",16),S(2,ut,2,2,"span",17,mt),_(4,pt,2,1,"button",18),r()()),i&2){let e=c().$implicit,n=c(2);m(2),w(n.getRolePermissions(e).slice(0,n.showAllPermissions[e.id||e.roleId]?n.getRolePermissions(e).length:4)),m(2),C(n.getRolePermissions(e).length>4?4:-1)}}function gt(i,t){i&1&&(o(0,"div",14)(1,"mat-icon",20),s(2,"block"),r(),o(3,"p"),s(4,"Kh\xF4ng c\xF3 quy\u1EC1n"),r()())}function ft(i,t){if(i&1&&(o(0,"div",15)(1,"mat-icon",21),s(2,"schedule"),r(),o(3,"span",22),s(4),r()()),i&2){let e=c().$implicit,n=c(2);m(4),E(" G\xE1n l\xFAc: ",n.formatDate(e.assignedAt||e.createdAt)," ")}}function ht(i,t){if(i&1&&(o(0,"div",6)(1,"div",7)(2,"div",8)(3,"mat-icon",9),s(4),r(),o(5,"div")(6,"h4",10),s(7),r(),_(8,ct,2,1,"p",11),r()(),_(9,dt,2,1,"span",12),r(),_(10,_t,5,1,"div",13)(11,gt,5,0,"div",14)(12,ft,5,1,"div",15),r()),i&2){let e=t.$implicit,n=c(2);m(3),xe(n.getRoleIcon((e.role==null?null:e.role.name)||e.name)),m(),E(" ",n.getRoleIcon((e.role==null?null:e.role.name)||e.name)," "),m(3),E(" ",(e.role==null?null:e.role.name)||e.name," "),m(),C(e.role!=null&&e.role.description||e.description?8:-1),m(),C(n.getRolePermissions(e).length>0?9:-1),m(),C(n.getRolePermissions(e).length>0?10:11),m(2),C(e.assignedAt||e.createdAt?12:-1)}}function xt(i,t){if(i&1&&(o(0,"div",4),S(1,ht,13,8,"div",6,lt),r()),i&2){let e=c();m(),w(e.user().roles)}}function vt(i,t){i&1&&(o(0,"div",5)(1,"mat-icon",23),s(2,"person_outline"),r(),o(3,"p",24),s(4,"Ch\u01B0a c\xF3 vai tr\xF2 n\xE0o"),r(),o(5,"p",3),s(6,"User n\xE0y ch\u01B0a \u0111\u01B0\u1EE3c g\xE1n vai tr\xF2 n\xE0o"),r()())}var le=class i{user=W();showAllPermissions={};getRolePermissions(t){return t.role?.permissions||t.permissions||t.role?.rolePermissions?.map(e=>e.permission)||[]}getRoleIcon(t){if(!t)return"person";let e=t.toLowerCase();return e.includes("admin")?"admin_panel_settings":e.includes("manager")||e.includes("qu\u1EA3n l\xFD")?"manage_accounts":e.includes("user")||e.includes("ng\u01B0\u1EDDi d\xF9ng")?"person":e.includes("guest")||e.includes("kh\xE1ch")?"person_outline":e.includes("moderator")?"gavel":e.includes("editor")?"edit":e.includes("viewer")?"visibility":"group"}toggleShowPermissions(t){this.showAllPermissions[t]=!this.showAllPermissions[t]}formatDate(t){return t?new Date(t).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=D({type:i,selectors:[["app-user-roles-info"]],inputs:{user:[1,"user"]},decls:11,vars:2,consts:[[1,"roles-info"],[1,"text-sm","font-medium","flex","items-center"],[1,"mr-2","text-blue-500"],[1,"text-xs"],[1,"space-y-4"],[1,"text-center","py-6","text-gray-500"],[1,"border","rounded-lg","p-3","bg-gray-50"],[1,"flex","items-center","justify-between","mb-2"],[1,"flex","items-center"],[1,"mr-2","text-blue-600"],[1,"font-medium","text-sm","text-gray-800"],[1,"text-xs","text-gray-600"],[1,"px-2","py-1","text-xs","bg-blue-100","text-blue-800","rounded-full"],[1,"mt-2"],[1,"text-center","text-gray-400","text-xs","py-2"],[1,"flex","items-center","mt-2","pt-2","border-t","border-gray-200"],[1,"flex","flex-wrap","gap-1"],[1,"px-2","py-1","text-xs","bg-white","border","border-blue-200","text-blue-700","rounded",3,"title"],["mat-button","",1,"!text-xs","!p-1","!min-w-0","text-blue-600"],["mat-button","",1,"!text-xs","!p-1","!min-w-0","text-blue-600",3,"click"],[1,"text-gray-300"],[1,"mr-1","text-gray-400",2,"font-size","14px"],[1,"text-xs","text-gray-500"],[1,"text-4xl","text-gray-300"],[1,"mt-2","text-sm"]],template:function(e,n){if(e&1&&(o(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title",1)(3,"mat-icon",2),s(4,"groups"),r(),s(5," Vai Tr\xF2 & Quy\u1EC1n "),r(),o(6,"mat-card-subtitle",3),s(7),r()(),o(8,"mat-card-content"),_(9,xt,3,0,"div",4)(10,vt,7,0,"div",5),r()()),e&2){let a,l;m(7),E(" ",((a=n.user())==null||a.roles==null?null:a.roles.length)||0," vai tr\xF2 \u0111\u01B0\u1EE3c g\xE1n "),m(2),C((l=n.user())!=null&&l.roles&&n.user().roles.length>0?9:10)}},dependencies:[k,q,O,G,Q,ie,V,L,B,z,A,F],styles:[".roles-info[_ngcontent-%COMP%]{border-left:4px solid #2196f3}.roles-info[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{padding-bottom:8px}.roles-info[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{font-size:12px}.roles-info[_ngcontent-%COMP%]   .border[_ngcontent-%COMP%]:hover{border-color:#2196f3;background-color:#f3f4f6}"]})};var ce=(i,t)=>t.id;function Et(i,t){i&1&&M(0,"mat-spinner",4)}function yt(i,t){i&1&&(o(0,"div",6),M(1,"mat-spinner",10),o(2,"p",11),s(3,"\u0110ang t\u1EA3i th\xF4ng tin quy\u1EC1n..."),r()())}function Pt(i,t){if(i&1){let e=P();o(0,"div",7)(1,"mat-icon",12),s(2,"error"),r(),o(3,"p",13),s(4),r(),o(5,"button",14),v("click",function(){h(e);let a=c();return x(a.loadPermissionData())}),o(6,"mat-icon"),s(7,"refresh"),r(),s(8," Th\u1EED l\u1EA1i "),r()()}if(i&2){let e=c();m(4),b(e.error())}}function bt(i,t){i&1&&(o(0,"mat-icon",58),s(1,"groups"),r(),s(2," Roles & Nh\xF3m Quy\u1EC1n "))}function St(i,t){if(i&1&&M(0,"app-user-roles-info",59),i&2){let e=c(2);p("user",e.user())}}function wt(i,t){i&1&&(o(0,"mat-icon",58),s(1,"dashboard"),r(),s(2," T\u1ED5ng Quan "))}function Rt(i,t){if(i&1&&(o(0,"span",60),s(1),r()),i&2){let e=t.$implicit;p("title",e.description||e.name),m(),E(" ",e.name," ")}}function Ut(i,t){if(i&1&&(o(0,"div",36),S(1,Rt,2,2,"span",60,ce),r()),i&2){let e=c(2);m(),w(e.currentSummary().rolePermissions)}}function Dt(i,t){i&1&&(o(0,"p",37),s(1,"Kh\xF4ng c\xF3 quy\u1EC1n t\u1EEB roles"),r())}function Mt(i,t){if(i&1&&(o(0,"span",61),s(1),r()),i&2){let e=t.$implicit;p("title",e.description||e.name),m(),E(" ",e.name," ")}}function It(i,t){if(i&1&&(o(0,"div",36),S(1,Mt,2,2,"span",61,ce),r()),i&2){let e=c(2);m(),w(e.currentSummary().effectivePermissions)}}function Tt(i,t){i&1&&(o(0,"div",9)(1,"mat-icon",62),s(2,"block"),r(),o(3,"p",63),s(4,"Ng\u01B0\u1EDDi d\xF9ng kh\xF4ng c\xF3 quy\u1EC1n n\xE0o"),r()())}function kt(i,t){i&1&&(o(0,"mat-icon",58),s(1,"settings"),r(),s(2," Qu\u1EA3n L\xFD "))}function Ft(i,t){if(i&1){let e=P();o(0,"div",64)(1,"span",24),s(2),r(),o(3,"button",65),v("click",function(){let a=h(e).$implicit,l=c(3);return x(l.revokePermission(a))}),o(4,"mat-icon",5),s(5,"close"),r()()()}if(i&2){let e=t.$implicit,n=c(3);m(2),b(e.permission.name),m(),p("disabled",n.isUpdatingPermission())}}function At(i,t){if(i&1&&(o(0,"div",36),S(1,Ft,6,2,"div",64,ce),r()),i&2){let e=c(2);m(),w(e.currentSummary().userGranted)}}function Bt(i,t){i&1&&(o(0,"p",45),s(1,"Ch\u01B0a c\xF3 quy\u1EC1n n\xE0o \u0111\u01B0\u1EE3c c\u1EA5p ri\xEAng"),r())}function Lt(i,t){if(i&1){let e=P();o(0,"div",66)(1,"span",27),s(2),r(),o(3,"button",67),v("click",function(){let a=h(e).$implicit,l=c(3);return x(l.restorePermission(a))}),o(4,"mat-icon",5),s(5,"refresh"),r()()()}if(i&2){let e=t.$implicit,n=c(3);m(2),b(e.permission.name),m(),p("disabled",n.isUpdatingPermission())}}function Ot(i,t){if(i&1&&(o(0,"div",36),S(1,Lt,6,2,"div",66,ce),r()),i&2){let e=c(2);m(),w(e.currentSummary().userDenied)}}function Vt(i,t){i&1&&(o(0,"p",50),s(1,"Kh\xF4ng c\xF3 quy\u1EC1n n\xE0o b\u1ECB t\u1EEB ch\u1ED1i"),r())}function Gt(i,t){if(i&1){let e=P();o(0,"mat-tab-group",8)(1,"mat-tab"),_(2,bt,3,0,"ng-template",15),o(3,"div",16),_(4,St,1,1,"app-user-roles-info",17),r()(),o(5,"mat-tab"),_(6,wt,3,0,"ng-template",15),o(7,"div",16)(8,"div",18)(9,"div",19)(10,"div",20),s(11),r(),o(12,"div",21),s(13,"T\u1EEB Roles"),r()(),o(14,"div",22)(15,"div",23),s(16),r(),o(17,"div",24),s(18,"\u0110\u01B0\u1EE3c C\u1EA5p"),r()(),o(19,"div",25)(20,"div",26),s(21),r(),o(22,"div",27),s(23,"B\u1ECB T\u1EEB Ch\u1ED1i"),r()(),o(24,"div",28)(25,"div",29),s(26),r(),o(27,"div",30),s(28,"Cu\u1ED1i C\xF9ng"),r()()(),o(29,"div",31)(30,"mat-expansion-panel",32)(31,"mat-expansion-panel-header")(32,"mat-panel-title",33)(33,"mat-icon",34),s(34,"groups"),r(),s(35),r()(),o(36,"div",35),_(37,Ut,3,0,"div",36)(38,Dt,2,0,"p",37),r()(),o(39,"mat-expansion-panel",38)(40,"mat-expansion-panel-header")(41,"mat-panel-title",33)(42,"mat-icon",39),s(43,"verified_user"),r(),s(44),r()(),o(45,"div",35),_(46,It,3,0,"div",36)(47,Tt,5,0,"div",9),r()()()()(),o(48,"mat-tab"),_(49,kt,3,0,"ng-template",15),o(50,"div",16)(51,"div",31)(52,"div",40)(53,"div",41)(54,"div",33)(55,"mat-icon",42),s(56,"add_circle"),r(),o(57,"h3",43),s(58,"Quy\u1EC1n \u0110\u01B0\u1EE3c C\u1EA5p Ri\xEAng"),r()(),o(59,"span",44),s(60),r()(),_(61,At,3,0,"div",36)(62,Bt,2,0,"p",45),r(),o(63,"div",46)(64,"div",41)(65,"div",33)(66,"mat-icon",47),s(67,"remove_circle"),r(),o(68,"h3",48),s(69,"Quy\u1EC1n B\u1ECB T\u1EEB Ch\u1ED1i"),r()(),o(70,"span",49),s(71),r()(),_(72,Ot,3,0,"div",36)(73,Vt,2,0,"p",50),r(),o(74,"div",51)(75,"div",52)(76,"mat-icon",53),s(77,"add_task"),r(),o(78,"h3",54),s(79,"C\u1EA5p Quy\u1EC1n M\u1EDBi"),r()(),o(80,"div",55)(81,"p",56),s(82,"Ch\u1ECDn quy\u1EC1n \u0111\u1EC3 c\u1EA5p ri\xEAng cho ng\u01B0\u1EDDi d\xF9ng n\xE0y (override quy\u1EC1n t\u1EEB roles)"),r(),o(83,"button",57),v("click",function(){h(e);let a=c();return x(a.openPermissionSelector())}),o(84,"mat-icon"),s(85,"add"),r(),s(86," Th\xEAm Quy\u1EC1n "),r()()()()()()()}if(i&2){let e=c();m(4),p("ngIf",e.user()),m(7),b(e.currentSummary().totalRolePermissions),m(5),b(e.currentSummary().grantedPermissions),m(5),b(e.currentSummary().deniedPermissions),m(5),b(e.currentSummary().effectivePermissions.length),m(4),p("expanded",!0),m(5),E(" Quy\u1EC1n t\u1EEB Roles (",e.currentSummary().rolePermissions.length,") "),m(2),C(e.currentSummary().rolePermissions.length>0?37:38),m(7),E(" Quy\u1EC1n Cu\u1ED1i C\xF9ng (",e.currentSummary().effectivePermissions.length,") "),m(2),C(e.currentSummary().effectivePermissions.length>0?46:47),m(14),E(" ",e.currentSummary().userGranted.length," "),m(),C(e.currentSummary().userGranted.length>0?61:62),m(10),E(" ",e.currentSummary().userDenied.length," "),m(),C(e.currentSummary().userDenied.length>0?72:73),m(11),p("disabled",e.isUpdatingPermission())}}function Qt(i,t){i&1&&(o(0,"div",9)(1,"mat-icon",62),s(2,"info"),r(),o(3,"p",63),s(4,"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u quy\u1EC1n"),r()())}var me=class i{userPermissionService=y(ae);userPermissionGraphQLService=y(ne);userId=W.required();user=W();isLoading=f(!1);isUpdatingPermission=f(!1);summary=f(null);error=f(null);currentSummary=R(()=>this.summary());constructor(){ve(()=>{let t=this.userId();t&&t!=="new"?(this.error.set(null),this.summary.set(null),setTimeout(()=>{this.loadPermissionData()},0)):(this.summary.set(null),this.error.set(null))})}loadPermissionData(){return g(this,null,function*(){let t=this.userId();if(!t||t==="new"){this.summary.set(null),this.error.set(null);return}this.isLoading.set(!0),this.error.set(null);try{let e=yield new Promise((n,a)=>{this.userPermissionService.getUserPermissionDetails(t).subscribe({next:l=>n(l),error:l=>a(l)})});if(e){let n=this.userPermissionService.getPermissionSummary(e);this.summary.set(n),this.error.set(null)}else this.summary.set(null),this.error.set("Kh\xF4ng t\xECm th\u1EA5y d\u1EEF li\u1EC7u ng\u01B0\u1EDDi d\xF9ng")}catch(e){console.error("Error loading permission data:",e),this.summary.set(null),this.error.set("L\u1ED7i khi t\u1EA3i th\xF4ng tin quy\u1EC1n. Vui l\xF2ng th\u1EED l\u1EA1i.")}finally{this.isLoading.set(!1)}})}revokePermission(t){return g(this,null,function*(){if(!(!t||this.isUpdatingPermission())){this.isUpdatingPermission.set(!0);try{yield this.userPermissionGraphQLService.updateUserPermission(t.id,{isGranted:!1,grantedBy:"system",reason:"Revoked by admin"}),yield this.loadPermissionData()}catch(e){console.error("Error revoking permission:",e),this.error.set("L\u1ED7i khi thu h\u1ED3i quy\u1EC1n")}finally{this.isUpdatingPermission.set(!1)}}})}restorePermission(t){return g(this,null,function*(){if(!(!t||this.isUpdatingPermission())){this.isUpdatingPermission.set(!0);try{yield this.userPermissionGraphQLService.updateUserPermission(t.id,{isGranted:!0,grantedBy:"system",reason:"Restored by admin"}),yield this.loadPermissionData()}catch(e){console.error("Error restoring permission:",e),this.error.set("L\u1ED7i khi kh\xF4i ph\u1EE5c quy\u1EC1n")}finally{this.isUpdatingPermission.set(!1)}}})}openPermissionSelector(){console.log("Open permission selector dialog")}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=D({type:i,selectors:[["app-user-permission-overview"]],inputs:{userId:[1,"userId"],user:[1,"user"]},decls:15,vars:2,consts:[[1,"permission-overview"],[1,"permission-main-card"],[1,"text-lg","font-medium","flex","items-center"],[1,"mr-2","text-indigo-500"],["diameter","16",1,"ml-2"],[1,"text-sm"],[1,"text-center","py-8"],[1,"text-center","py-8","text-red-500"],["animationDuration","300ms"],[1,"text-center","py-8","text-gray-500"],["diameter","48"],[1,"mt-4","text-gray-600"],[1,"text-4xl","text-red-400"],[1,"mt-2","font-medium"],["mat-raised-button","","color","primary",1,"mt-4",3,"click"],["mat-tab-label",""],[1,"py-4"],[3,"user",4,"ngIf"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mb-6"],[1,"text-center","p-4","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"text-2xl","font-bold","text-blue-600"],[1,"text-sm","text-blue-800","font-medium"],[1,"text-center","p-4","bg-green-50","rounded-lg","border","border-green-200"],[1,"text-2xl","font-bold","text-green-600"],[1,"text-sm","text-green-800","font-medium"],[1,"text-center","p-4","bg-red-50","rounded-lg","border","border-red-200"],[1,"text-2xl","font-bold","text-red-600"],[1,"text-sm","text-red-800","font-medium"],[1,"text-center","p-4","bg-purple-50","rounded-lg","border","border-purple-200"],[1,"text-2xl","font-bold","text-purple-600"],[1,"text-sm","text-purple-800","font-medium"],[1,"space-y-6"],[1,"permission-section",3,"expanded"],[1,"flex","items-center"],[1,"mr-2","text-blue-500"],[1,"pt-4"],[1,"flex","flex-wrap","gap-2"],[1,"text-gray-500","text-center","py-4"],[1,"permission-section"],[1,"mr-2","text-purple-500"],[1,"bg-green-50","rounded-lg","p-4","border","border-green-200"],[1,"flex","items-center","justify-between","mb-4"],[1,"mr-2","text-green-600"],[1,"text-lg","font-medium","text-green-800"],[1,"px-3","py-1","bg-green-200","text-green-800","rounded-full","text-sm","font-medium"],[1,"text-green-700","text-center","py-4"],[1,"bg-red-50","rounded-lg","p-4","border","border-red-200"],[1,"mr-2","text-red-600"],[1,"text-lg","font-medium","text-red-800"],[1,"px-3","py-1","bg-red-200","text-red-800","rounded-full","text-sm","font-medium"],[1,"text-red-700","text-center","py-4"],[1,"bg-gray-50","rounded-lg","p-4","border","border-gray-200"],[1,"flex","items-center","mb-4"],[1,"mr-2","text-gray-600"],[1,"text-lg","font-medium","text-gray-800"],[1,"space-y-3"],[1,"text-sm","text-gray-600"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"mr-2"],[3,"user"],[1,"px-3","py-1","text-sm","bg-blue-100","text-blue-800","rounded-full","border","border-blue-200",3,"title"],[1,"px-3","py-1","text-sm","bg-purple-100","text-purple-800","rounded-full","border","border-purple-200","font-medium",3,"title"],[1,"text-4xl","text-gray-400"],[1,"mt-2"],[1,"flex","items-center","bg-white","rounded-lg","px-3","py-2","border","border-green-300"],["mat-icon-button","","color","warn","title","Thu h\u1ED3i quy\u1EC1n",1,"ml-2","w-6","h-6",3,"click","disabled"],[1,"flex","items-center","bg-white","rounded-lg","px-3","py-2","border","border-red-300"],["mat-icon-button","","color","primary","title","Kh\xF4i ph\u1EE5c quy\u1EC1n",1,"ml-2","w-6","h-6",3,"click","disabled"]],template:function(e,n){e&1&&(o(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title",2)(4,"mat-icon",3),s(5,"admin_panel_settings"),r(),s(6," Qu\u1EA3n L\xFD Quy\u1EC1n H\u1EA1n "),_(7,Et,1,0,"mat-spinner",4),r(),o(8,"mat-card-subtitle",5),s(9," T\xF3m t\u1EAFt v\xE0 qu\u1EA3n l\xFD quy\u1EC1n chi ti\u1EBFt cho ng\u01B0\u1EDDi d\xF9ng "),r()(),o(10,"mat-card-content"),_(11,yt,4,0,"div",6)(12,Pt,9,1,"div",7)(13,Gt,87,15,"mat-tab-group",8)(14,Qt,5,0,"div",9),r()()()),e&2&&(m(7),C(n.isLoading()?7:-1),m(4),C(n.isLoading()?11:n.error()?12:n.currentSummary()?13:14))},dependencies:[k,Z,q,O,G,Q,ie,V,L,B,z,We,je,A,F,ee,te,et,Je,Ye,Ze,Ie,Ue,De,Me,le],styles:[".permission-overview[_ngcontent-%COMP%]{width:100%}.permission-main-card[_ngcontent-%COMP%]{border-left:4px solid #4f46e5;box-shadow:0 4px 6px -1px #0000001a}.permission-section[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a}.permission-section[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]{background-color:#f8fafc}  .mat-mdc-tab-group .mat-mdc-tab-header{border-bottom:2px solid #e2e8f0}"]})};function qt(i,t){if(i&1){let e=P();o(0,"button",3),v("click",function(){h(e);let a=c();return x(a.handleUserAction())}),o(1,"mat-icon"),s(2,"save"),r()()}}function zt(i,t){if(i&1){let e=P();o(0,"button",3),v("click",function(){h(e);let a=c();return x(a.toggleEdit())}),o(1,"mat-icon"),s(2,"edit"),r()()}}function Nt(i,t){if(i&1){let e=P();o(0,"button",10),v("click",function(){h(e);let a=c();return x(a.toggleDelete())}),o(1,"mat-icon"),s(2,"delete"),r()()}}function jt(i,t){if(i&1){let e=P();I(0),o(1,"div",11)(2,"div",12),s(3,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),r(),o(4,"div",13)(5,"button",14),v("click",function(){h(e);let a=c();return x(a.DeleteData())}),s(6,"\u0110\u1ED3ng \xDD"),r(),o(7,"button",15),v("click",function(){h(e);let a=c();return x(a.toggleDelete())}),s(8,"Hu\u1EF7 B\u1ECF"),r()()(),T()}}function Wt(i,t){i&1&&(I(0),o(1,"mat-icon",39),s(2,"refresh"),r(),s(3," \u0110ang th\xEAm... "),T())}function $t(i,t){i&1&&(I(0),o(1,"mat-icon"),s(2,"add"),r(),s(3," Th\xEAm Nh\xF3m "),T())}function Ht(i,t){i&1&&(o(0,"mat-icon",43),s(1,"refresh"),r())}function Kt(i,t){if(i&1){let e=P();o(0,"mat-icon",45),v("click",function(){h(e);let a=c().$implicit,l=c(3);return x(l.handleRemoveRole(a))}),s(1," close "),r()}i&2&&fe("cursor","pointer")}function Xt(i,t){if(i&1&&(o(0,"mat-chip-listbox")(1,"mat-chip-option",40)(2,"div",41)(3,"span",42),s(4),r(),_(5,Ht,2,0,"mat-icon",43)(6,Kt,2,2,"mat-icon",44),r()()()),i&2){let e=t.$implicit,n=c(3);m(),he("opacity-50",n.isRemovingRole()),m(3),b((e==null||e.role==null?null:e.role.name)||(e==null?null:e.name)),m(),C(n.isRemovingRole()?5:n.isEdit()?6:-1)}}function Jt(i,t){if(i&1&&(o(0,"div",28),S(1,Xt,7,4,"mat-chip-listbox",null,ue),r()),i&2){let e=c(2);m(),w(e.DetailUser().roles)}}function Yt(i,t){if(i&1&&(o(0,"button",48),I(1),o(2,"mat-icon"),s(3,"add"),r(),s(4," Th\xEAm nh\xF3m \u0111\u1EA7u ti\xEAn "),T(),r()),i&2){c(2);let e=K(34);p("matMenuTriggerFor",e)}}function Zt(i,t){if(i&1&&(o(0,"div",29)(1,"mat-icon",46),s(2,"group_off"),r(),o(3,"p",47),s(4,"Ch\u01B0a c\xF3 nh\xF3m quy\u1EC1n n\xE0o"),r(),_(5,Yt,5,1,"button",48),r()),i&2){let e=c(2);m(5),C(e.isEdit()?5:-1)}}function ei(i,t){if(i&1){let e=P();o(0,"button",49),v("click",function(){let a=h(e).$implicit,l=c(2);return x(l.handleAddRole(a))}),s(1),r()}if(i&2){let e=t.$implicit;m(),b(e.name)}}function ti(i,t){if(i&1&&M(0,"app-user-permission-overview",54),i&2){let e,n=c(3);p("userId",(e=n.DetailUser())==null?null:e.id)("user",n.DetailUser())}}function ii(i,t){i&1&&(o(0,"div",55)(1,"mat-icon",56),s(2,"refresh"),r(),o(3,"p",57),s(4,"\u0110ang t\u1EA3i th\xF4ng tin quy\u1EC1n..."),r()())}function ni(i,t){if(i&1&&(o(0,"div",50)(1,"div",51),_(2,ti,1,2,"app-user-permission-overview",52)(3,ii,5,0,"div",53),r()()),i&2){let e,n=c(2);m(2),p("ngIf",n.DetailUser()&&((e=n.DetailUser())==null?null:e.id)&&!n.isLoading()),m(),p("ngIf",n.isLoading())}}function ri(i,t){i&1&&(o(0,"div",50)(1,"div",51)(2,"div",58)(3,"mat-icon",59),s(4,"info"),r(),o(5,"p",60),s(6,"L\u01B0u user tr\u01B0\u1EDBc \u0111\u1EC3 qu\u1EA3n l\xFD quy\u1EC1n \u0111\u1EB7c bi\u1EC7t"),r(),o(7,"p",61),s(8,"Sau khi t\u1EA1o user, b\u1EA1n c\xF3 th\u1EC3 c\u1EA5p/thu h\u1ED3i quy\u1EC1n ri\xEAng"),r()()()())}function oi(i,t){if(i&1){let e=P();I(0),o(1,"div",16)(2,"mat-form-field",17)(3,"mat-label"),s(4,"Email"),r(),o(5,"input",18),Y("ngModelChange",function(a){h(e);let l=c();return J(l.DetailUser().email,a)||(l.DetailUser().email=a),x(a)}),r()(),o(6,"mat-form-field",17)(7,"mat-label"),s(8,"H\u1ECD V\xE0 T\xEAn"),r(),o(9,"input",19),v("input",function(a){h(e);let l=c();return x(l.updateUserName(a))}),r()(),o(10,"mat-form-field",17)(11,"mat-label"),s(12,"S\u1ED1 \u0110i\u1EC7n Tho\u1EA1i"),r(),o(13,"input",20),Y("ngModelChange",function(a){h(e);let l=c();return J(l.DetailUser().SDT,a)||(l.DetailUser().SDT=a),x(a)}),r()(),o(14,"mat-form-field",17)(15,"mat-label"),s(16,"M\u1EADt Kh\u1EA9u "),r(),o(17,"input",21),Y("ngModelChange",function(a){h(e);let l=c();return J(l.DetailUser().password,a)||(l.DetailUser().password=a),x(a)}),r()(),o(18,"div",22)(19,"button",23,0),_(21,Wt,4,0,"ng-container")(22,$t,4,0,"ng-container"),r()(),o(23,"div",24)(24,"mat-card",25)(25,"mat-card-header")(26,"mat-card-title",26)(27,"mat-icon",27),s(28,"groups"),r(),s(29),r()(),o(30,"mat-card-content"),_(31,Jt,3,0,"div",28)(32,Zt,6,1,"div",29),r()()(),o(33,"mat-menu",null,1)(35,"div",30),v("click",function(a){return h(e),x(a.stopPropagation())}),o(36,"div",31)(37,"input",32),v("keyup",function(a){h(e);let l=c();return x(l.doFilterHederColumn(a))}),r(),o(38,"div",33)(39,"span",34),s(40,"search"),r()()(),o(41,"div",35),S(42,ei,2,1,"button",36,ue),r(),o(44,"div",37)(45,"button",15),v("click",function(){h(e);let a=K(20);return x(a.closeMenu())}),s(46,"\u0110\xF3ng"),r()()()(),_(47,ni,4,2,"div",38)(48,ri,9,0,"div",38),r(),T()}if(i&2){let e,n,a,l,d=K(34),u=c();m(5),X("ngModel",u.DetailUser().email),p("disabled",!u.isEdit()),m(4),p("value",((e=u.DetailUser())==null||e.profile==null?null:e.profile.name)||"")("disabled",!u.isEdit()),m(4),X("ngModel",u.DetailUser().SDT),p("disabled",!u.isEdit()),m(4),X("ngModel",u.DetailUser().password),p("disabled",!u.isEdit()),m(2),p("disabled",!u.isEdit()||u.isAddingRole())("matMenuTriggerFor",d),m(2),C(u.isAddingRole()?21:22),m(8),E(" Nh\xF3m Quy\u1EC1n (",((n=u.DetailUser().roles)==null?null:n.length)||0,") "),m(2),C(u.DetailUser().roles&&u.DetailUser().roles.length>0?31:32),m(11),w(u.FilterRole()),m(5),p("ngIf",((a=u.DetailUser())==null?null:a.id)&&((a=u.DetailUser())==null?null:a.id)!=="new"),m(),p("ngIf",((l=u.DetailUser())==null?null:l.id)==="new")}}var at=class i{_ListuserComponent=y(it);_UserGraphQLService=y(re);_RoleGraphQLService=y(oe);_route=y(Ce);_router=y(Ee);_snackBar=y(ye);constructor(){this._route.paramMap.subscribe(t=>{let e=t.get("id");e==="new"?this.userId.set(e):e&&!this._UserGraphQLService.currentUser()&&this.userId.set(e)})}DetailUser=f(null);isEdit=f(!1);isDelete=f(!1);isLoading=f(!1);isAddingRole=f(!1);isRemovingRole=f(!1);userId=f(null);ListRole=f([]);FilterRole=f([]);getUserById(t){return g(this,null,function*(){try{let e=yield this._UserGraphQLService.getUserById(t);e&&this.DetailUser.set(N(U({},e),{SDT:e.SDT||""}))}catch(e){console.error("Error loading user:",e),this._snackBar.open("L\u1ED7i khi t\u1EA3i th\xF4ng tin ng\u01B0\u1EDDi d\xF9ng","\u0110\xF3ng",{duration:3e3})}})}ngOnInit(){return g(this,null,function*(){let t=this.userId();if(!t){this._router.navigate(["/admin/user"]),this._ListuserComponent.drawer.close();return}if(t==="new")this.DetailUser.set({id:"new",email:"",password:"",SDT:"",name:"",isActive:!0,roles:[],profile:{name:"",avatar:"",bio:""}}),this._ListuserComponent?.drawer?.open(),this.isEdit.set(!0);else if(t)try{yield this.getUserById(t),this._ListuserComponent?.drawer?.open(),this._router.navigate(["/admin/user",t])}catch(e){console.error("Error loading user:",e),this._snackBar.open("L\u1ED7i khi t\u1EA3i th\xF4ng tin ng\u01B0\u1EDDi d\xF9ng","\u0110\xF3ng",{duration:3e3}),this._router.navigate(["/admin/user"]);return}try{yield this._RoleGraphQLService.loadAllRoles(),this.ListRole.set(this._RoleGraphQLService.allRoles()),this.updateFilterRole()}catch(e){console.error("Error loading roles:",e)}})}updateFilterRole(){let t=this.ListRole()||[],n=this.DetailUser()?.roles||[];if(t.length===0){this.FilterRole.set([]);return}let a=t.filter(l=>!l||!l.id?!1:!n.some(d=>d?d.roleId===l.id||d.role?.id===l.id:!1));this.FilterRole.set(a)}updateUserName(t){let e=t.target.value,n=this.DetailUser();n&&(n.profile||(n.profile={name:"",avatar:"",bio:""}),n.profile.name=e,this.DetailUser.set(U({},n)))}handleUserAction(){return g(this,null,function*(){this.userId()==="new"?yield this.createUser():yield this.updateUser()})}createUser(){return g(this,null,function*(){try{if(!this.DetailUser().password||this.DetailUser().password.trim()===""){this._snackBar.open("Vui l\xF2ng nh\u1EADp password","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}if(!this.DetailUser().SDT||this.DetailUser().SDT.trim()===""){this._snackBar.open("Vui l\xF2ng nh\u1EADp SDT","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}yield this._UserGraphQLService.createUser(this.DetailUser()),this._snackBar.open("T\u1EA1o M\u1EDBi Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(t=>!t)}catch(t){console.error("L\u1ED7i khi t\u1EA1o user:",t)}})}updateUser(){return g(this,null,function*(){try{yield this._UserGraphQLService.updateUser(this.DetailUser().id,this.DetailUser()),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(t=>!t)}catch(t){console.error("L\u1ED7i khi c\u1EADp nh\u1EADt user:",t)}})}DeleteData(){return g(this,null,function*(){try{yield this._UserGraphQLService.deleteUser(this.DetailUser().id),this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this._router.navigate(["/admin/user"])}catch(t){console.error("L\u1ED7i khi x\xF3a user:",t)}})}FillSlug(){this.DetailUser.update(t=>N(U({},t),{slug:ze(t.title)}))}doFilterHederColumn(t){let e=this.ListRole();this.FilterRole.set(e.filter(n=>n.name.toLowerCase().includes(t.target.value.toLowerCase())))}handleAddRole(t){return g(this,null,function*(){if(!t||!t.id||this.isAddingRole()){(!t||!t.id)&&this._snackBar.open("D\u1EEF li\u1EC7u vai tr\xF2 kh\xF4ng h\u1EE3p l\u1EC7","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}this.isAddingRole.set(!0);try{if((this.DetailUser()?.roles||[]).some(a=>a.roleId===t.id||a.role?.id===t.id)){this._snackBar.open("Vai tr\xF2 \u0111\xE3 \u0111\u01B0\u1EE3c th\xEAm","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}yield this._UserGraphQLService.assignRolesToUser(this.DetailUser().id,[t.id]),this.DetailUser.update(a=>N(U({},a),{roles:[...a.roles||[],{id:Ne(8,!1),userId:this.DetailUser().id,roleId:t.id,role:t}]})),this.updateFilterRole(),this._snackBar.open("Th\xEAm vai tr\xF2 th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(e){console.error("Error adding role:",e),this._snackBar.open("L\u1ED7i khi th\xEAm vai tr\xF2","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isAddingRole.set(!1)}})}handleRemoveRole(t){return g(this,null,function*(){if(!t||this.isRemovingRole()){t||this._snackBar.open("D\u1EEF li\u1EC7u vai tr\xF2 kh\xF4ng h\u1EE3p l\u1EC7","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}this.isRemovingRole.set(!0);try{let e=t.role?.id||t.roleId;if(!e){this._snackBar.open("Kh\xF4ng th\u1EC3 x\xE1c \u0111\u1ECBnh ID vai tr\xF2","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}yield this._UserGraphQLService.removeRoleFromUser(this.DetailUser().id,e),this.DetailUser.update(n=>N(U({},n),{roles:(n.roles||[]).filter(a=>(a.role?.id||a.roleId)!==e)})),this.updateFilterRole(),this._snackBar.open("X\xF3a vai tr\xF2 th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(e){console.error("Error removing role:",e),this._snackBar.open("L\u1ED7i khi x\xF3a vai tr\xF2","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isRemovingRole.set(!1)}})}goBack(){this._UserGraphQLService.clearCurrentUser(),this._ListuserComponent.drawer.close(),this._router.navigate(["/admin/user"])}trackByFn(t,e){return e.id}toggleEdit(){this.isEdit.update(t=>!t)}toggleDelete(){this.isDelete.update(t=>!t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=D({type:i,selectors:[["app-detailuser"]],decls:13,vars:6,consts:[["menuTrigger","matMenuTrigger"],["menu","matMenu"],[1,"flex","flex-row","justify-between","items-center","space-x-2","p-2"],["mat-icon-button","","color","primary",3,"click"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center"],["mat-icon-button","","color","primary",3,"click",4,"ngIf"],["mat-icon-button","","color","warn",3,"click",4,"ngIf"],[1,"relative","flex","flex-col","w-full","p-4","overflow-auto"],[4,"ngIf"],["mat-icon-button","","color","warn",3,"click"],[1,"flex","flex-col","space-y-4","items-center","justify-center"],[1,"font-bold","text-2xl"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],[1,"w-full","flex","flex-col","space-y-2"],["appearance","outline"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp Email",3,"ngModelChange","ngModel","disabled"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp H\u1ECD V\xE0 T\xEAn",3,"input","value","disabled"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp S\u1ED1 \u0110i\u1EC7n Tho\u1EA1i",3,"ngModelChange","ngModel","disabled"],["matInput","","type","password","placeholder","Vui l\xF2ng nh\u1EADp M\u1EADt kh\u1EA9u",3,"ngModelChange","ngModel","disabled"],[1,"w-full","flex","flex-wrap","gap-2","space-x-2"],["mat-flat-button","","color","primary",3,"disabled","matMenuTriggerFor"],[1,"mb-4"],[1,"bg-blue-50"],[1,"text-sm","font-medium","flex","items-center"],[1,"mr-2","text-blue-500"],[1,"flex","flex-row","flex-wrap","gap-2"],[1,"text-center","text-gray-500","py-4"],[1,"cursor-pointer","flex","flex-col","space-y-4","p-3",3,"click"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[1,"w-full","flex","flex-col","space-y-2","max-h-44","overflow-auto"],["mat-menu-item",""],[1,"flex","flex-row","space-x-2","items-center","justify-end"],["class","mt-8",4,"ngIf"],[1,"animate-spin"],[1,"bg-blue-100"],[1,"flex","items-center"],[1,"mr-2"],[1,"animate-spin","text-gray-500","text-sm"],["color","warn",1,"text-sm","hover:text-red-600",3,"cursor"],["color","warn",1,"text-sm","hover:text-red-600",3,"click"],[1,"text-gray-400"],[1,"text-sm","mt-1"],["mat-stroked-button","","color","primary",1,"mt-2",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"mt-8"],[1,"border-t","pt-6"],[3,"userId","user",4,"ngIf"],["class","p-8 text-center",4,"ngIf"],[3,"userId","user"],[1,"p-8","text-center"],[1,"animate-spin","text-4xl","text-gray-400"],[1,"text-lg","text-gray-500","mt-4"],[1,"text-center","text-gray-500","py-8"],[1,"text-4xl","text-gray-400"],[1,"mt-2"],[1,"text-xs"]],template:function(e,n){if(e&1&&(o(0,"div",2)(1,"button",3),v("click",function(){return n.goBack()}),o(2,"mat-icon"),s(3,"arrow_back"),r()(),o(4,"div",4),s(5),r(),o(6,"div",5),_(7,qt,3,0,"button",6)(8,zt,3,0,"button",6)(9,Nt,3,0,"button",7),r()(),o(10,"div",8),_(11,jt,9,0,"ng-container",9)(12,oi,49,15,"ng-container",9),r()),e&2){let a;m(5),b(((a=n.DetailUser())==null?null:a.email)||"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),m(2),p("ngIf",n.isEdit()&&n.DetailUser()),m(),p("ngIf",!n.isEdit()&&n.DetailUser()),m(),p("ngIf",n.DetailUser()),m(2),p("ngIf",n.isDelete()),m(),p("ngIf",!n.isDelete()&&n.DetailUser())}},dependencies:[Ve,Oe,Le,Qe,Ge,Ae,Te,ke,Fe,L,B,A,F,ee,qe,Be,k,Z,He,Re,Se,be,we,q,O,G,Q,V,te,z,Xe,Ke,me],styles:[".permission-management[_ngcontent-%COMP%]{border-left:4px solid #4caf50}.permission-management[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{padding-bottom:8px}.permission-management[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{font-size:12px}"]})};export{at as DetailUserComponent};
