import{a as p}from"./chunk-4ZVJO4SQ.js";import{a as S}from"./chunk-JNVUT6FC.js";import{a as i}from"./chunk-VUZTNYK4.js";import{b as y}from"./chunk-7U2T4VS7.js";import{c as l}from"./chunk-WDMWHZJL.js";import{Ra as o,ia as d,na as g}from"./chunk-OSJESZB6.js";import{a as h,g as m,j as n}from"./chunk-6DYNGEAS.js";var c=m(S());var f=class u{constructor(r,a){this._StorageService=r;this.router=a}ListDathang=o([]);DetailDathang=o({});page=o(1);pageCount=o(1);total=o(0);pageSize=o(50);dathangId=o(null);setDathangId(r){this.dathangId.set(r)}ImportDathang(r){return n(this,null,function*(){try{let a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},t=yield fetch(`${i.APIURL}/dathang/import`,a);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let e=yield t.json();t.ok||console.log(t.status),this.getAllDathang()}catch(a){return console.error(a)}})}CreateDathang(r){return n(this,null,function*(){try{let a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},t=yield fetch(`${i.APIURL}/dathang`,a);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let e=yield t.json();if(!t.ok)if(t.status===401){let s=JSON.stringify({code:t.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}else if(t.status===403){let s=JSON.stringify({code:t.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}else if(t.status===500){let s=JSON.stringify({code:t.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}else{let s=JSON.stringify({code:t.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}this.getAllDathang(),this.dathangId.set(e.id)}catch(a){return console.error(a)}})}CreateByNhucau(r){return n(this,null,function*(){try{let a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},t=yield fetch(`${i.APIURL}/dathang/bynhucau`,a);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let e=yield t.json();if(!t.ok)if(t.status===401){let s=JSON.stringify({code:t.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}else if(t.status===403){let s=JSON.stringify({code:t.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}else if(t.status===500){let s=JSON.stringify({code:t.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}else{let s=JSON.stringify({code:t.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}this.getAllDathang(),this.dathangId.set(e.id)}catch(a){return console.error(a)}})}getSLChonhap(r){return n(this,null,function*(){let a=h({},r);a.Batdau=(0,c.default)(a.Batdau).utc(),a.Ketthuc=(0,c.default)(a.Ketthuc).utc();try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(a)},e=yield fetch(`${i.APIURL}/dathang/getchonhap`,t);return e.ok,yield e.json()}catch(t){return console.error(t)}})}searchDathang(r){return n(this,null,function*(){let a=h({},r);a.Batdau=(0,c.default)(a.Batdau).utc(),a.Ketthuc=(0,c.default)(a.Ketthuc).utc();try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(a)},e=yield fetch(`${i.APIURL}/dathang/search`,t);e.ok;let s=yield e.json();return this.ListDathang.set(s.data),s}catch(t){return console.error(t)}})}getAllDathang(){return n(this,null,function*(){try{let r={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")}},a=yield fetch(`${i.APIURL}/dathang?`,r);if(!a.ok)if(a.status===401){let e=JSON.stringify({code:a.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:e}})}else if(a.status===403){let e=JSON.stringify({code:a.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:e}})}else if(a.status===500){let e=JSON.stringify({code:a.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:e}})}else{let e=JSON.stringify({code:a.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:e}})}let t=yield a.json();return this.ListDathang.set(t),t}catch(r){return console.error(r)}})}getDathangByid(r){return n(this,null,function*(){try{let a={method:"GET",headers:{"Content-Type":"application/json"}},t=yield fetch(`${i.APIURL}/dathang/findid/${r}`,a);if(!t.ok)if(t.status===401){let s=JSON.stringify({code:t.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}else if(t.status===403){let s=JSON.stringify({code:t.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}else if(t.status===500){let s=JSON.stringify({code:t.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}else{let s=JSON.stringify({code:t.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}let e=yield t.json();this.DetailDathang.set(e)}catch(a){return console.error(a)}})}findbysanpham(r){return n(this,null,function*(){try{let a={method:"GET",headers:{"Content-Type":"application/json"}},t=yield fetch(`${i.APIURL}/dathang/findbysanpham/${r}`,a);return t.ok||this.handleError(t.status),yield t.json()}catch(a){return console.error(a)}})}updateDathang(r){return n(this,null,function*(){try{let a={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},t=yield fetch(`${i.APIURL}/dathang/${r.id}`,a);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let e=yield t.json();if(!t.ok)if(t.status===401){let s=JSON.stringify({code:t.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}else if(t.status===403){let s=JSON.stringify({code:t.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}else if(t.status===500){let s=JSON.stringify({code:t.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}else{let s=JSON.stringify({code:t.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}this.getAllDathang(),this.getDathangByid(r.id)}catch(a){return console.error(a)}})}DeleteDathang(r){return n(this,null,function*(){try{let a={method:"DELETE",headers:{"Content-Type":"application/json"}},t=yield fetch(`${i.APIURL}/dathang/${r.id}`,a);if(!t.ok)if(t.status===401){let e=JSON.stringify({code:t.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:e}})}else if(t.status===403){let e=JSON.stringify({code:t.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:e}})}else if(t.status===500){let e=JSON.stringify({code:t.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:e}})}else{let e=JSON.stringify({code:t.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:e}})}this.getAllDathang()}catch(a){return console.error(a)}})}getDathangBy(r){return n(this,null,function*(){try{let a={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(h({},r))},t=yield fetch(`${i.APIURL}/dathang/findby`,a);t.ok||this.handleError(t.status);let e=yield t.json();r.isOne===!0?this.DetailDathang.set(e):(yield this.saveDathangs(e.data,{page:e.page||1,pageCount:e.pageCount||1,total:e.total||e.data.length,pageSize:this.pageSize()}),this._StorageService.setItem("dathangs_updatedAt",new Date().toISOString()),this.ListDathang.set(e.data),this.page.set(e.page||1),this.pageCount.set(e.pageCount||1),this.total.set(e.total||e.data.length),this.pageSize.set(this.pageSize()))}catch{let t=yield this.getCachedData();r.isOne||(this.ListDathang.set(t.dathangs),this.page.set(t.pagination.page),this.pageCount.set(t.pagination.pageCount),this.total.set(t.pagination.total),this.pageSize.set(t.pagination.pageSize))}})}saveDathangs(r,a){return n(this,null,function*(){let e=(yield this.initDB()).transaction("dathangs","readwrite"),s=e.objectStore("dathangs");yield s.clear(),yield s.put({id:"data",dathangs:r,pagination:a}),yield e.done})}getCachedData(){return n(this,null,function*(){let a=yield(yield this.initDB()).get("dathangs","data");return a&&a.dathangs?{dathangs:a.dathangs,pagination:a.pagination||{page:1,pageCount:1,total:a.dathangs.length,pageSize:10}}:{dathangs:[],pagination:{page:1,pageCount:1,total:0,pageSize:10}}})}initDB(){return n(this,null,function*(){return yield p("DathangDB",4,{upgrade(r,a){a<1&&r.createObjectStore("dathangs",{keyPath:"id"}),a<3&&(r.objectStoreNames.contains("dathangs")&&r.deleteObjectStore("dathangs"),r.objectStoreNames.contains("pagination")&&r.deleteObjectStore("pagination"),r.createObjectStore("dathangs",{keyPath:"id"})),a<4}})})}handleError(r){let a="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(r){case 400:a="Th\xF4ng tin \u0111\xE3 t\u1ED3n t\u1EA1i";break;case 401:case 404:a="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:a="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:a="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}}static \u0275fac=function(a){return new(a||u)(g(y),g(l))};static \u0275prov=d({token:u,factory:u.\u0275fac,providedIn:"root"})};export{f as a};
