import{a as ne,b as ie}from"./chunk-MH5KOPAC.js";import{g as oe,n as ae}from"./chunk-ZUE3IRRM.js";import"./chunk-ASU7WRMJ.js";import"./chunk-YBNECWU6.js";import{a as ee}from"./chunk-JNUSRN4Y.js";import"./chunk-4ZVJO4SQ.js";import"./chunk-BCTQYTXK.js";import"./chunk-BFIAAR4D.js";import"./chunk-7YCPS63B.js";import"./chunk-NULFSBS2.js";import"./chunk-EW7C5QHK.js";import"./chunk-HTC52XHQ.js";import{d as At}from"./chunk-STTHC4C4.js";import{a as M}from"./chunk-ZW44ZSN2.js";import"./chunk-BQNHPUMH.js";import{b as yt,c as vt,d as Dt}from"./chunk-SLRDYDMI.js";import"./chunk-N7PBUGTM.js";import"./chunk-HYI77ASG.js";import{b as te}from"./chunk-73CYRDOZ.js";import{a as z,b as Rt,c as zt}from"./chunk-TDAACTQD.js";import{c as It,h as Tt}from"./chunk-INJUMOX2.js";import"./chunk-H7UDLENL.js";import{a as xt}from"./chunk-GD7IEZTW.js";import"./chunk-DP4FJZ2N.js";import{a as Pt,b as Bt,c as Nt,k as $t}from"./chunk-LA7HCZ4I.js";import{a as _t,c as ft}from"./chunk-RFYKARPR.js";import"./chunk-IKSNCL6N.js";import{c as Ht,d as Wt,e as jt,g as Kt,h as Xt,j as Ot,k as qt,m as Qt,n as Gt,p as Ut,q as Jt,r as Yt,s as Zt}from"./chunk-B52A5VRT.js";import{b as Vt}from"./chunk-QO4YM336.js";import{b as bt,g as Et,j as wt,n as St,p as G,s as Ft,v as U,w as Lt,y as J,z as Mt}from"./chunk-WDSRARXB.js";import"./chunk-KBSHTQVA.js";import{a as Q,b as kt}from"./chunk-4KMAECDD.js";import"./chunk-B5XVARHK.js";import"./chunk-KY47JUDC.js";import"./chunk-2PPFUFFT.js";import{a as O,c as q,e as Ct}from"./chunk-5RXGINDA.js";import{_ as gt}from"./chunk-RO6MDUJX.js";import"./chunk-HMVCX5BQ.js";import{l as mt,m as X,u as ut,w as pt}from"./chunk-RGQ7KTVF.js";import{$b as nt,Cc as L,Db as Y,Dc as h,Ec as K,Fc as k,Gc as ct,Hc as ht,Ic as N,Jc as $,Kb as D,Kc as R,Ra as V,Rb as Z,Sb as tt,Sc as I,Ub as u,Uc as T,Xb as et,bc as it,cc as ot,dc as at,ec as r,fc as l,gc as A,hc as P,ic as B,kc as E,md as dt,pa as S,pc as C,rb as c,rc as s,xc as rt,ya as _,yc as lt,za as f,zc as st}from"./chunk-OL5DVADB.js";import"./chunk-LWLSKGAV.js";import{a as v,b,j as x}from"./chunk-6DYNGEAS.js";var le=()=>[U,G,J,Q,O,q,yt,vt,mt,X];function se(o,e){if(o&1){let t=E();r(0,"button",6),C("click",function(){_(t);let i=s();return f(i.handleChotkhoAction())}),r(1,"mat-icon"),h(2,"save"),l()()}}function ce(o,e){if(o&1){let t=E();r(0,"button",6),C("click",function(){_(t);let i=s();return f(i.toggleEdit())}),r(1,"mat-icon"),h(2,"edit"),l()()}}function he(o,e){if(o&1){let t=E();P(0),r(1,"div",12)(2,"div",13),h(3,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),l(),r(4,"div",14)(5,"button",15),C("click",function(){_(t);let i=s();return f(i.DeleteData())}),h(6,"\u0110\u1ED3ng \xDD"),l(),r(7,"button",16),C("click",function(){_(t);let i=s();return f(i.toggleDelete())}),h(8,"Hu\u1EF7 B\u1ECF"),l()()(),B()}}function de(o,e){if(o&1){let t=E();r(0,"div",19)(1,"h3",20),h(2,"Th\xF4ng tin ch\u1ED1t kho"),l(),r(3,"div",21)(4,"mat-form-field",22)(5,"mat-label"),h(6,"Ti\xEAu \u0110\u1EC1"),l(),r(7,"input",23),R("ngModelChange",function(i){_(t);let a=s(2);return $(a.DetailChotkho().title,i)||(a.DetailChotkho().title=i),f(i)}),l()(),r(8,"mat-form-field",22)(9,"mat-label"),h(10,"Ng\xE0y Ch\u1ED1t"),l(),r(11,"input",24),R("ngModelChange",function(i){_(t);let a=s(2);return $(a.DetailChotkho().ngaychot,i)||(a.DetailChotkho().ngaychot=i),f(i)}),l(),A(12,"mat-datepicker-toggle",25)(13,"mat-datepicker",null,0),l(),r(15,"mat-form-field",26)(16,"mat-label"),h(17,"Ghi Ch\xFA"),l(),r(18,"textarea",27),R("ngModelChange",function(i){_(t);let a=s(2);return $(a.DetailChotkho().ghichu,i)||(a.DetailChotkho().ghichu=i),f(i)}),l()()()()}if(o&2){let t=L(14),n=s(2);c(7),N("ngModel",n.DetailChotkho().title),u("disabled",!n.isEdit()),c(4),u("matDatepicker",t),N("ngModel",n.DetailChotkho().ngaychot),u("disabled",!n.isEdit()),c(),u("for",t),c(6),N("ngModel",n.DetailChotkho().ghichu),u("disabled",!n.isEdit())}}function me(o,e){o&1&&(r(0,"span",67),h(1,"check_box"),l())}function ue(o,e){o&1&&(r(0,"span",68),h(1,"check_box_outline_blank"),l())}function pe(o,e){if(o&1){let t=E();r(0,"div",61),C("click",function(){let i=_(t).$implicit,a=s(5);return f(a.ChosenItem(i))}),D(1,me,2,0,"span",62)(2,ue,2,0,"span",63),r(3,"div",64)(4,"span",65),h(5),l(),r(6,"span",66),h(7),l()()()}if(o&2){let t=e.$implicit,n=s(5);c(),u("ngIf",n.CheckItem(t)),c(),u("ngIf",!n.CheckItem(t)),c(3),K(t.title||"Ch\u01B0a C\xF3 T\xEAn"),c(2),ct("M\xE3: ",t.masp," - \u0110VT: ",t.dvt,"")}}function _e(o,e){o&1&&(r(0,"div",69),h(1," Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m kh\u1EA3 d\u1EE5ng "),l())}function fe(o,e){if(o&1){let t=E();r(0,"div",37)(1,"div",38)(2,"button",39,1)(4,"mat-icon"),h(5,"inventory"),l(),h(6),l(),r(7,"mat-menu",null,2)(9,"div",40),C("click",function(i){return _(t),f(i.stopPropagation())}),r(10,"div",41)(11,"div",42),h(12,"T\xECnh tr\u1EA1ng s\u1EA3n ph\u1EA9m:"),l(),r(13,"div",43),h(14),l()(),r(15,"div",44)(16,"input",45,3),C("keyup",function(i){_(t);let a=s(4);return f(a.doFilterSanpham(i))}),l(),r(18,"div",46)(19,"span",47),h(20,"search"),l()()(),r(21,"div",48)(22,"div",8)(23,"span",49),C("click",function(){_(t);let i=s(4);return f(i.ChosenAll(i.ListSanpham))}),h(24),l(),r(25,"span",50),C("click",function(){_(t);let i=s(4);return f(i.EmptyFiter())}),h(26,"Xo\xE1 T\u1EA5t C\u1EA3"),l()(),r(27,"span",51),C("click",function(){_(t);let i=s(4);return f(i.ResetFilter())}),h(28,"L\xE0m M\u1EDBi"),l()(),r(29,"div",52),D(30,pe,8,5,"div",53)(31,_e,2,0,"div",54),l(),r(32,"div",55)(33,"button",16),C("click",function(){_(t);let i=L(3);return f(i.closeMenu())}),h(34,"\u0110\xF3ng"),l(),r(35,"button",15),C("click",function(){_(t);let i=L(3),a=s(4);return f(a.ApplyFilterColum(i))}),h(36,"\xC1p D\u1EE5ng"),l()()()(),r(37,"div",56)(38,"mat-form-field",22)(39,"mat-label"),h(40,"T\xECm Ki\u1EBFm"),l(),r(41,"input",57),C("keyup",function(i){_(t);let a=s(4);return f(a.applyFilter(i))}),l()(),r(42,"button",58),C("click",function(){_(t);let i=L(46);return f(i.click())}),r(43,"mat-icon"),h(44,"file_upload"),l()(),r(45,"input",59,4),C("change",function(i){_(t);let a=s(4);return f(a.ImportExcel(i))}),l(),r(47,"button",60),C("click",function(){_(t);let i=s(4);return f(i.EmptyCart())}),r(48,"mat-icon"),h(49,"delete"),l()()()()()}if(o&2){let t=L(8),n=s(4);c(2),u("disabled",!n.isEdit())("matMenuTriggerFor",t),c(4),k(" ",n.ListFilter.length," S\u1EA3n Ph\u1EA9m \u0110\xE3 Ch\u1ECDn "),c(8),ht(" \u2022 ",n.ListFilter.length," s\u1EA3n ph\u1EA9m \u0111\xE3 ch\u1ECDn \u2022 ",n.ListSanpham.length-n.ListFilter.length," s\u1EA3n ph\u1EA9m kh\u1EA3 d\u1EE5ng \u2022 ",n.ListSanpham.length," t\u1ED5ng s\u1EA3n ph\u1EA9m "),c(10),k("Ch\u1ECDn T\u1EA5t C\u1EA3 (",n.ListSanpham.length-n.ListFilter.length," s\u1EA3n ph\u1EA9m kh\u1EA3 d\u1EE5ng)"),c(6),u("ngForOf",n.getFilteredSanpham())("ngForTrackBy",n.trackByFn),c(),u("ngIf",n.ListSanpham.length===0),c(16),u("disabled",!n.isEdit())}}function ge(o,e){o&1&&(r(0,"div",36),D(1,fe,50,11),Z(2,1,le),tt(),l())}function Ce(o,e){if(o&1&&(r(0,"th",72)(1,"span",73),h(2),l()()),o&2){let t=s().$implicit,n=s(3);c(2),k(" ",n.ColumnName[t]," ")}}function xe(o,e){if(o&1){let t=E();r(0,"span",75)(1,"span"),h(2),l(),r(3,"button",79),C("click",function(){_(t);let i=s().$implicit,a=s(4);return f(a.RemoveSanpham(i))}),r(4,"mat-icon"),h(5,"delete"),l()()()}if(o&2){let t=s().index,n=s(4);c(2),k("",t+1," "),c(),u("disabled",!n.isEdit())}}function ke(o,e){if(o&1){let t=E();r(0,"div",82),C("blur",function(i){_(t);let a=s(2),d=a.$implicit,m=a.index,p=s(4);return f(p.updateValue(i,m,d,"sltonthucte","number"))})("keydown.enter",function(i){_(t);let a=s(2),d=a.$implicit,m=a.index,p=s(4);return f(p.updateValue(i,m,d,"sltonthucte","number"))}),h(1),I(2,"number"),l()}if(o&2){let t=s(2).$implicit,n=s().$implicit;u("contentEditable",!0),c(),k(" ",T(2,2,t[n]||0,"1.0-3")," ")}}function ye(o,e){if(o&1&&(r(0,"span",78),h(1),I(2,"number"),l()),o&2){let t=s(2).$implicit,n=s().$implicit;c(),k(" ",T(2,1,t[n],"1.0-3")," ")}}function ve(o,e){if(o&1&&D(0,ke,3,5,"div",80)(1,ye,3,4,"span",81),o&2){let t=s(5);u("ngIf",t.isEdit()),c(),u("ngIf",!t.isEdit())}}function De(o,e){if(o&1){let t=E();r(0,"div",84),C("blur",function(i){_(t);let a=s(2),d=a.$implicit,m=a.index,p=s(4);return f(p.updateValue(i,m,d,"slhuy","number"))})("keydown.enter",function(i){_(t);let a=s(2),d=a.$implicit,m=a.index,p=s(4);return f(p.updateValue(i,m,d,"slhuy","number"))}),h(1),I(2,"number"),l()}if(o&2){let t=s(2).$implicit,n=s().$implicit;u("contentEditable",!0),c(),k(" ",T(2,2,t[n]||0,"1.0-3")," ")}}function be(o,e){if(o&1&&(r(0,"span",78),h(1),I(2,"number"),l()),o&2){let t=s(2).$implicit,n=s().$implicit;c(),k(" ",T(2,1,t[n],"1.0-3")," ")}}function Ee(o,e){if(o&1&&D(0,De,3,5,"div",83)(1,be,3,4,"span",81),o&2){let t=s(5);u("ngIf",t.isEdit()),c(),u("ngIf",!t.isEdit())}}function we(o,e){if(o&1&&(r(0,"span",78),h(1),I(2,"number"),l()),o&2){let t=s().$implicit,n=s().$implicit;et(t[n]>0?"text-green-600":t[n]<0?"text-red-600":"text-yellow-600"),c(),k(" ",T(2,3,t[n],"1.0-3")," ")}}function Se(o,e){if(o&1&&(r(0,"span",77),h(1),l()),o&2){let t=s().$implicit;c(),k(" ",t.title||(t.sanpham==null?null:t.sanpham.title)," ")}}function Ie(o,e){if(o&1&&(r(0,"span",77),h(1),l()),o&2){let t=s().$implicit;c(),k(" ",t.masp||(t.sanpham==null?null:t.sanpham.masp)," ")}}function Te(o,e){if(o&1&&(r(0,"span",77),h(1),l()),o&2){let t=s().$implicit;c(),k(" ",t.dvt||(t.sanpham==null?null:t.sanpham.dvt)," ")}}function Fe(o,e){if(o&1&&(r(0,"span",78),h(1),I(2,"number"),l()),o&2){let t=s().$implicit,n=s().$implicit;c(),k(" ",T(2,1,t[n],"1.0-3")," ")}}function Le(o,e){if(o&1&&(r(0,"span",77),h(1),l()),o&2){let t=s().$implicit,n=s().$implicit;c(),k(" ",t[n]," ")}}function Me(o,e){if(o&1&&(r(0,"td",74),D(1,xe,6,2,"span",75)(2,ve,2,2)(3,Ee,2,2)(4,we,3,6,"span",76)(5,Se,2,1,"span",77)(6,Ie,2,1,"span",77)(7,Te,2,1,"span",77)(8,Fe,3,4,"span",78)(9,Le,2,1,"span",77),l()),o&2){let t,n=s().$implicit;c(),nt((t=n)==="STT"?1:t==="sltonthucte"?2:t==="slhuy"?3:t==="chenhlech"?4:t==="title"?5:t==="masp"?6:t==="dvt"?7:t==="sltonhethong"?8:9)}}function Ve(o,e){if(o&1&&(P(0,32),D(1,Ce,3,1,"th",70)(2,Me,10,1,"td",71),B()),o&2){let t=e.$implicit;u("matColumnDef",t)}}function Ae(o,e){o&1&&A(0,"tr",85)}function Pe(o,e){o&1&&A(0,"tr",86)}function Be(o,e){o&1&&(r(0,"tr",87)(1,"td",88),h(2,"Kh\xF4ng t\xECm th\u1EA5y d\u1EEF li\u1EC7u"),l()())}function Ne(o,e){if(o&1&&(r(0,"div",28),D(1,ge,4,0,"div",29),r(2,"div",30)(3,"table",31),ot(4,Ve,3,1,"ng-container",32,it),D(6,Ae,1,0,"tr",33)(7,Pe,1,0,"tr",34)(8,Be,3,0,"tr",35),l()()()),o&2){let t=s(2);c(),u("ngIf",t.isEdit()),c(2),u("dataSource",t.dataSource()),c(),at(t.displayedColumns),c(2),u("matHeaderRowDef",t.displayedColumns),c(),u("matRowDefColumns",t.displayedColumns)}}function $e(o,e){if(o&1&&(P(0),D(1,de,19,8,"div",17)(2,Ne,9,4,"div",18),B()),o&2){let t=s();c(),u("ngIf",t.DetailChotkho()),c(),u("ngIf",t.DetailChotkho())}}var re=class o{_ListChotkhoComponent=S(ie);_ChotkhoService=S(ne);_SanphamService=S(ee);_route=S(_t);_router=S(ft);_snackBar=S(xt);_dialog=S(It);sort;dataSource=V(new Zt([]));displayedColumns=["STT","title","masp","dvt","sltonhethong","sltonthucte","slhuy","chenhlech"];ColumnName={STT:"STT",title:"T\xEAn S\u1EA3n Ph\u1EA9m",masp:"M\xE3 SP",dvt:"\u0110\u01A1n V\u1ECB",sltonhethong:"SL H\u1EC7 Th\u1ED1ng",sltonthucte:"SL Th\u1EF1c T\u1EBF",slhuy:"SL H\u1EE7y",chenhlech:"Ch\xEAnh L\u1EC7ch"};DetailChotkho=V({id:void 0,title:"",ngaychot:new Date,ghichu:"",khoId:"",userId:"",isActive:!0,details:[]});constructor(){this._route.paramMap.subscribe(e=>{let t=e.get("id");this._ChotkhoService.setChotkhoId(t)}),dt(()=>x(this,null,function*(){let e=this._ChotkhoService.DetailChotkho();e&&(this.DetailChotkho.set(e),this.dataSource.update(t=>(t.data=e.details||[],t)),this.ListFilter=e.details||[],this.ListSanpham.length>0&&this.updateAvailableProducts())}))}isEdit=V(!1);isDelete=V(!1);chotkhoId=this._ChotkhoService.chotkhoId;ListSanpham=[];filterSanpham=[];ListFilter=[];searchTerm="";getFilteredSanpham(){if(!this.searchTerm||this.searchTerm.length<2)return this.ListSanpham;let e=M(this.searchTerm.toLowerCase());return this.ListSanpham.filter(t=>{let n=M(t.title?.toLowerCase()||""),i=M(t.masp?.toLowerCase()||"");return n.includes(e)||i.includes(e)||t.title?.toLowerCase().includes(this.searchTerm)||t.masp?.toLowerCase().includes(this.searchTerm)})}ngOnInit(){return x(this,null,function*(){let e=this._ChotkhoService.chotkhoId();if(e||(this._router.navigate(["/admin/chotkho"]),this._ListChotkhoComponent.drawer.close()),e==="new"){this.loadNewSanphamList();let t={title:"Ch\u1ED1t Kho Ng\xE0y "+new Date().toLocaleDateString(),ngaychot:new Date,ghichu:"",khoId:"",userId:"",isActive:!0,details:[]};this.DetailChotkho.set(t),this._ChotkhoService.DetailChotkho.set(t),this._ListChotkhoComponent.drawer.open(),this.isEdit.update(n=>!0),this._router.navigate(["/admin/chotkho","new"])}else e&&(yield this._ChotkhoService.getChotkhoById(e),yield this.loadSanphamList(),setTimeout(()=>{let t=this._ChotkhoService.DetailChotkho()},1e3),this._ListChotkhoComponent.drawer.open(),this._router.navigate(["/admin/chotkho",e]))})}handleChotkhoAction(){return x(this,null,function*(){this.chotkhoId()==="new"?yield this.createChotkho():yield this.updateChotkho()})}createChotkho(){return x(this,null,function*(){try{let e=this.DetailChotkho(),t=yield this._ChotkhoService.createChotkhoWithDetails(e);t&&t.id&&this._router.navigate(["/admin/chotkho",t.id]),this._snackBar.open("T\u1EA1o ch\u1ED1t kho th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(n=>!1)}catch(e){console.error("L\u1ED7i khi t\u1EA1o ch\u1ED1t kho:",e),this._snackBar.open("L\u1ED7i khi t\u1EA1o ch\u1ED1t kho","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}updateChotkho(){return x(this,null,function*(){try{let e=this.DetailChotkho();e?.id&&(yield this._ChotkhoService.updateChotkhoWithDetails(e.id,e),this._snackBar.open("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(t=>!1))}catch(e){console.error("L\u1ED7i khi c\u1EADp nh\u1EADt ch\u1ED1t kho:",e),this._snackBar.open("L\u1ED7i khi c\u1EADp nh\u1EADt ch\u1ED1t kho","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}DeleteData(){return x(this,null,function*(){try{let e=this.DetailChotkho();e?.id&&(yield this._ChotkhoService.deleteChotkho(e.id),this._snackBar.open("X\xF3a th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this._router.navigate(["/admin/chotkho"]))}catch(e){console.error("L\u1ED7i khi x\xF3a ch\u1ED1t kho:",e),this._snackBar.open("L\u1ED7i khi x\xF3a ch\u1ED1t kho","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}onQuantityChange(){let e=this.DetailChotkho();if(e){let t=Number(e.sltonhethong)||0,n=Number(e.sltonthucte)||0,i=Number(e.slhuy)||0,a=t-n-i;this.DetailChotkho.update(d=>b(v({},d),{chenhlech:a}))}}detailDisplayedColumns=["sanpham","sltonhethong","sltonthucte","slhuy","chenhlech","actions"];removeDetail(e){let n=(this.DetailChotkho().details||[]).filter(i=>i!==e);this.DetailChotkho.update(i=>b(v({},i),{details:n}))}deleteDetailFromDatabase(e){return x(this,null,function*(){try{e.id&&this.DetailChotkho().id?(yield this._ChotkhoService.deleteChotkhoDetail(e.id,this.DetailChotkho().id))&&this._snackBar.open("X\xF3a chi ti\u1EBFt th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}):this.removeDetail(e)}catch(t){console.error("L\u1ED7i khi x\xF3a chi ti\u1EBFt:",t),this._snackBar.open("L\u1ED7i khi x\xF3a chi ti\u1EBFt","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}updateChenhLech(e){let t=Number(e.sltonhethong)||0,n=Number(e.sltonthucte)||0,i=Number(e.slhuy)||0;e.chenhlech=t-n-i}goBack(){this._router.navigate(["/admin/chotkho"]),this._ListChotkhoComponent.drawer.close()}trackByFn(e,t){return t.id||e}toggleEdit(){this.isEdit.update(e=>!e)}toggleDelete(){this.isDelete.update(e=>!e)}FillSlug(){this.DetailChotkho.update(e=>(e.slug=At(e.title),e))}loadNewSanphamList(){return x(this,null,function*(){try{let t=(yield this._ChotkhoService.getAllProducts()).map(n=>({id:n.id,sanphamId:n.id,title:n.title,masp:n.masp,dvt:n.dvt,sltonhethong:n.tonkho?.slton||0,sltonthucte:n.tonkho?.sltinhthucte||0,slhuy:n.tonkho?.slhuy||0,chenhlech:(n.tonkho?.slton||0)-(n.tonkho?.sltinhthucte||0)-(n.slhuy||0),dongia:n.dongia}));this.ListSanpham=t,this.filterSanpham=this.ListSanpham.filter(n=>!this.ListFilter.find(i=>i.id===n.id)),this.updateAvailableProducts()}catch(e){console.error("Error loading sanpham list:",e),this._snackBar.open("L\u1ED7i khi t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m","\u0110\xF3ng",{duration:3e3,panelClass:["snackbar-error"]})}})}loadSanphamList(){return x(this,null,function*(){try{let t=(yield this._ChotkhoService.getAllProducts()).map(n=>({id:n.id,sanphamId:n.id,title:n.title,masp:n.masp,dvt:n.dvt,sltonhethong:n.sltonhethong||0,sltonthucte:n.sltonthucte||0,slhuy:n.slhuy||0,chenhlech:(n.sltonhethong||0)-(n.sltonthucte||0)-(n.slhuy||0),dongia:n.dongia}));this.ListSanpham=t,this.filterSanpham=this.ListSanpham.filter(n=>!this.ListFilter.find(i=>i.id===n.id)),this.updateAvailableProducts()}catch(e){console.error("Error loading sanpham list:",e),this._snackBar.open("L\u1ED7i khi t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m","\u0110\xF3ng",{duration:3e3,panelClass:["snackbar-error"]})}})}DoOutFilter(e){return x(this,null,function*(){console.log("C\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m cho ch\u1ED1t kho:",e);try{this.DetailChotkho.update(n=>b(v({},n),{details:e.map(i=>({sanphamId:i.sanphamId||i.id,sanpham:{id:i.sanphamId||i.id,masp:i.masp,title:i.title,dvt:i.dvt,dongia:i.dongia},sltonhethong:Number(i.sltonhethong)||0,sltonthucte:Number(i.sltonthucte)||0,slhuy:Number(i.slhuy)||0,chenhlech:Number(i.chenhlech)||0,ghichu:i.ghichu||"",isActive:!0,title:i.title,masp:i.masp,dvt:i.dvt}))})),this.filterSanpham=this.DetailChotkho().details,this.dataSource.update(n=>(n.data=[...this.DetailChotkho().details],n.sort=this.sort,n));let t=e.map(n=>n.sanphamId||n.id);this.ListSanpham=this.ListSanpham.filter(n=>!t.includes(n.id||n.sanphamId)),this._snackBar.open("C\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(t){console.error("L\u1ED7i c\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m:",t),this._snackBar.open("L\u1ED7i c\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}EmptyCart(){let e=this.DetailChotkho().details||[];this.DetailChotkho.update(t=>b(v({},t),{details:[]})),this.dataSource.update(t=>(t.data=[],t)),e.forEach(t=>{let n={id:t.sanphamId||t.id,sanphamId:t.sanphamId||t.id,title:t.title||t.sanpham?.title,masp:t.masp||t.sanpham?.masp,dvt:t.dvt||t.sanpham?.dvt,sltonhethong:t.sltonhethong||0,sltonthucte:t.sltonthucte||0,slhuy:t.slhuy||0,chenhlech:t.chenhlech||0,dongia:t.dongia||t.sanpham?.dongia||0};this.ListSanpham.some(a=>a.id===n.id||a.sanphamId===n.id)||this.ListSanpham.push(n)}),console.log("Restored products to ListSanpham:",this.ListSanpham),this._snackBar.open("\u0110\xE3 x\xF3a t\u1EA5t c\u1EA3 s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}RemoveSanpham(e){let n=(this.DetailChotkho().details||[]).filter(m=>m.id!==e.id&&m.sanphamId!==e.sanphamId);this.DetailChotkho.update(m=>b(v({},m),{details:n})),this.dataSource.update(m=>(m.data=[...n],m));let i=e.sanphamId||e.id,a={id:i,sanphamId:i,title:e.title||e.sanpham?.title,masp:e.masp||e.sanpham?.masp,dvt:e.dvt||e.sanpham?.dvt,sltonhethong:e.sltonhethong||0,sltonthucte:e.sltonthucte||0,slhuy:e.slhuy||0,chenhlech:e.chenhlech||0,dongia:e.dongia||e.sanpham?.dongia||0};this.ListSanpham.some(m=>m.id===i||m.sanphamId===i)||(this.ListSanpham.push(a),console.log("Added product back to ListSanpham:",a)),this._snackBar.open("\u0110\xE3 x\xF3a s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}updateValue(e,t,n,i,a){e.preventDefault(),e.stopPropagation();let d=e.target.innerText.trim();if(a==="number"){let p=d.replace(/,/g,"").replace(/[^0-9.-]/g,"");d=Number(p)||0}this.DetailChotkho.update(p=>{let g=(p.details||[]).map((y,F)=>{if(F===t||y.sanphamId===n.sanphamId){let w=v({},y);if(w[i]=d,i==="sltonthucte"||i==="slhuy"){let H=Number(w.sltonhethong)||0,W=Number(w.sltonthucte)||0,j=Number(w.slhuy)||0;w.chenhlech=H-W-j}return w}return y});return b(v({},p),{details:g})});let m=this.DetailChotkho().details||[];this.dataSource.update(p=>(p.data=[...m],p))}doFilterSanpham(e){return x(this,null,function*(){let t=e.target.value.trim().toLowerCase();if(this.searchTerm=t,e.key==="Enter"){let n=this.getFilteredSanpham();if(n.length>0){let i=n.find(a=>!this.CheckItem(a));i&&(this.ChosenItem(i),e.target.value="",this.searchTerm="")}}})}ChosenItem(e){let t=this.filterSanpham.find(i=>i.id===e.id);if(this.ListFilter.find(i=>i.id===e.id||i.sanphamId===e.id))this.ListFilter=this.ListFilter.filter(i=>i.id!==e.id&&i.sanphamId!==e.id),console.log(`Removed product: ${e.title}`);else if(t){let i=b(v({},t),{sanphamId:t.id,sltonhethong:t.sltonhethong||0,sltonthucte:t.sltonthucte||0,slhuy:t.slhuy||0,chenhlech:t.chenhlech||0,order:this.ListFilter.length+1});this.ListFilter.findIndex(d=>d.id===e.id||d.sanphamId===e.id)===-1&&this.ListFilter.push(i)}}ChosenAll(e){return x(this,null,function*(){let n=e.filter(i=>!this.ListFilter.find(a=>a.id===i.id||a.sanphamId===i.id)).map((i,a)=>b(v({},i),{sanphamId:i.id,sltonhethong:i.sltonhethong||0,sltonthucte:i.sltonthucte||0,slhuy:i.slhuy||0,chenhlech:i.chenhlech||0,order:this.ListFilter.length+a+1}));this.ListFilter=[...this.ListFilter,...n],console.log(`Added ${n.length} unique products. Total: ${this.ListFilter.length} products`)})}ResetFilter(){this.filterSanpham=this.ListSanpham.filter(e=>!this.ListFilter.find(t=>t.id===e.id)),console.log(`Reset filter. Showing ${this.filterSanpham.length} available products`)}EmptyFiter(){this.ListFilter=[],this.updateAvailableProducts(),console.log("Cleared all selected products")}updateAvailableProducts(){}CheckItem(e){return!!this.ListFilter.find(t=>t.id===e.id||t.sanphamId===e.id)}ApplyFilterColum(e){this.DetailChotkho.update(t=>(t.details=[...this.ListFilter],t)),this.dataSource.update(t=>(t.data=[...this.ListFilter],t)),e.closeMenu(),console.log("Applied filter. Selected products:",this.ListFilter.length)}applyFilter(e){let t=e.target.value;this.dataSource().filter=t.trim().toLowerCase()}ImportExcel(e){return x(this,null,function*(){try{let t=e.target.files[0];if(!t){this._snackBar.open("Vui l\xF2ng ch\u1ECDn file Excel","\u0110\xF3ng",{duration:3e3,panelClass:["snackbar-error"]});return}if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","application/octet-stream"].includes(t.type)&&!t.name.endsWith(".xlsx")&&!t.name.endsWith(".xls")){this._snackBar.open("Vui l\xF2ng ch\u1ECDn file Excel (.xlsx ho\u1EB7c .xls)","\u0110\xF3ng",{duration:3e3,panelClass:["snackbar-error"]});return}this._snackBar.open("\u0110ang x\u1EED l\xFD file Excel...","",{duration:2e3,panelClass:["snackbar-info"]});let i=yield this.readExcelFile(t);if(!i||i.length===0){this._snackBar.open("File Excel kh\xF4ng c\xF3 d\u1EEF li\u1EC7u ho\u1EB7c kh\xF4ng h\u1EE3p l\u1EC7","\u0110\xF3ng",{duration:3e3,panelClass:["snackbar-error"]});return}this.ListSanpham.length===0&&(yield this.loadNewSanphamList());let a=yield this.processExcelData(i);if(a.length===0){this._snackBar.open("Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m n\xE0o kh\u1EDBp v\u1EDBi m\xE3 s\u1EA3n ph\u1EA9m trong file Excel","\u0110\xF3ng",{duration:4e3,panelClass:["snackbar-warning"]});return}this.DetailChotkho.update(d=>{let p=[...d.details||[]];return a.forEach(g=>{let y=p.findIndex(F=>F.sanphamId===g.sanphamId);y>=0?p[y]=b(v(v({},p[y]),g),{chenhlech:this.calculateChenhLech(g.sltonhethong||p[y].sltonhethong||0,g.sltonthucte||0,g.slhuy||0)}):p.push(g)}),b(v({},d),{details:p})}),this.dataSource.update(d=>(d.data=[...this.DetailChotkho().details],d.sort=this.sort,d)),this.ListFilter=this.DetailChotkho().details||[],e.target.value="",this._snackBar.open(`Import th\xE0nh c\xF4ng ${a.length} s\u1EA3n ph\u1EA9m t\u1EEB Excel`,"\u0110\xF3ng",{duration:4e3,panelClass:["snackbar-success"]}),console.log("Excel import completed:",{importedItems:a.length,totalDetails:this.DetailChotkho().details?.length||0})}catch(t){console.error("Error importing Excel:",t),this._snackBar.open(`L\u1ED7i khi import Excel: ${t instanceof Error?t.message:"Unknown error"}`,"\u0110\xF3ng",{duration:5e3,panelClass:["snackbar-error"]})}})}readExcelFile(e){return x(this,null,function*(){return new Promise((t,n)=>{let i=new FileReader;i.onload=a=>{try{let d=new Uint8Array(a.target.result),m=oe(d,{type:"array"}),p=m.SheetNames[0],g=m.Sheets[p],y=ae.sheet_to_json(g,{header:1,defval:"",raw:!1});t(y)}catch{n(new Error("Kh\xF4ng th\u1EC3 \u0111\u1ECDc file Excel. Vui l\xF2ng ki\u1EC3m tra \u0111\u1ECBnh d\u1EA1ng file."))}},i.onerror=()=>{n(new Error("L\u1ED7i khi \u0111\u1ECDc file"))},i.readAsArrayBuffer(e)})})}processExcelData(e){return x(this,null,function*(){try{if(!e||e.length<2)throw new Error("File Excel ph\u1EA3i c\xF3 \xEDt nh\u1EA5t 2 d\xF2ng (header + data)");let t=e[0].map(d=>M(String(d).toLowerCase().trim())),n={masp:this.findColumnIndex(t,["masp","ma sp","ma san pham","product code"]),sltonthucte:this.findColumnIndex(t,["sltonthucte","sl ton thuc te","so luong ton thuc te","actual stock"]),slhuy:this.findColumnIndex(t,["slhuy","sl huy","so luong huy","damaged quantity"])};if(n.masp===-1)throw new Error('Kh\xF4ng t\xECm th\u1EA5y c\u1ED9t "masp" trong file Excel');let i=[],a=[];for(let d=1;d<e.length;d++){let m=e[d];if(!m||m.length===0)continue;let p=String(m[n.masp]||"").trim();if(!p)continue;let g=this.ListSanpham.find(j=>j.masp?.toLowerCase().trim()===p.toLowerCase().trim());if(!g){a.push(p);continue}let y=this.parseNumber(m[n.sltonthucte]),F=this.parseNumber(m[n.slhuy]),w=g.sltonhethong||0,H=this.calculateChenhLech(w,y,F),W={id:void 0,sanphamId:g.id,sanpham:{id:g.id,masp:g.masp,title:g.title,dvt:g.dvt,dongia:g.dongia},sltonhethong:w,sltonthucte:y,slhuy:F,chenhlech:H,ghichu:`Import t\u1EEB Excel - ${new Date().toLocaleString()}`,isActive:!0,title:g.title,masp:g.masp,dvt:g.dvt};i.push(W)}return a.length>0&&(console.warn("Products not found in system:",a),this._snackBar.open(`C\u1EA3nh b\xE1o: ${a.length} s\u1EA3n ph\u1EA9m kh\xF4ng t\xECm th\u1EA5y trong h\u1EC7 th\u1ED1ng`,"Xem chi ti\u1EBFt",{duration:5e3,panelClass:["snackbar-warning"]}).onAction().subscribe(()=>{console.log("Not found products:",a.join(", "))})),i}catch(t){throw console.error("Error processing Excel data:",t),t}})}findColumnIndex(e,t){for(let n of t){let i=M(n.toLowerCase().trim()),a=e.findIndex(d=>d.includes(i));if(a!==-1)return a}return-1}parseNumber(e){if(e==null||e==="")return 0;let t=String(e).replace(/,/g,"").replace(/\s/g,""),n=parseFloat(t);return isNaN(n)?0:Math.floor(n)}calculateChenhLech(e,t,n){return(e||0)-(t||0)-(n||0)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=Y({type:o,selectors:[["app-detailchotkho"]],viewQuery:function(t,n){if(t&1&&rt(z,5),t&2){let i;lt(i=st())&&(n.sort=i.first)}},decls:12,vars:5,consts:[["picker",""],["menuTrigger","matMenuTrigger"],["menu","matMenu"],["searchInput",""],["uploadfile",""],[1,"flex","flex-row","justify-between","items-center","space-x-2","p-2"],["mat-icon-button","","color","primary",3,"click"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center"],["mat-icon-button","","color","primary",3,"click",4,"ngIf"],[1,"relative","flex","flex-col","w-full","p-4","overflow-auto"],[4,"ngIf"],[1,"flex","flex-col","space-y-4","items-center","justify-center"],[1,"font-bold","text-2xl"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],["class","p-4 rounded-lg mb-4",4,"ngIf"],["class","bg-white p-4 rounded-lg border",4,"ngIf"],[1,"p-4","rounded-lg","mb-4"],[1,"text-lg","font-semibold","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp ti\xEAu \u0111\u1EC1",3,"ngModelChange","ngModel","disabled"],["matInput","","placeholder","Ch\u1ECDn ng\xE0y ch\u1ED1t",3,"ngModelChange","matDatepicker","ngModel","disabled"],["matSuffix","",3,"for"],["appearance","outline","subscriptSizing","dynamic",1,"md:col-span-2"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp ghi ch\xFA","rows","2",3,"ngModelChange","ngModel","disabled"],[1,"bg-white","p-4","rounded-lg","border"],["class","w-full flex flex-col overflow-y-auto mb-4",4,"ngIf"],[1,"w-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[1,"w-full","flex","flex-col","overflow-y-auto","mb-4"],[1,"cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","p-2","bg-white","rounded-lg"],[1,"w-full","flex","lg:flex-row","flex-col","gap-2","items-center"],["mat-flat-button","","color","primary",3,"disabled","matMenuTriggerFor"],[1,"cursor-pointer","flex","flex-col","space-y-4","p-3",3,"click"],[1,"bg-blue-50","p-2","rounded-lg"],[1,"text-sm","font-medium","text-blue-800"],[1,"text-xs","text-blue-600"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[1,"flex","flex-row","space-x-2","items-center","justify-between"],[1,"text-xs","text-blue-600","underline",3,"click"],[1,"text-xs","text-red-600","underline",3,"click"],[1,"text-xs","text-green-600","underline",3,"click"],[1,"w-full","flex","flex-col","space-y-2","max-h-44","overflow-auto"],["class","flex flex-row space-x-2 items-center p-2 rounded-lg hover:bg-slate-100 cursor-pointer",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],["class","text-center text-gray-500 p-4",4,"ngIf"],[1,"flex","flex-row","space-x-2","items-end","justify-end"],[1,"flex","flex-row","gap-2","justify-items-center"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"keyup"],["matTooltip","T\u1EA3i l\xEAn file excel","color","primary","mat-icon-button","",3,"click"],["multiple","","type","file",1,"hidden",3,"change"],["matTooltip","L\xE0m Tr\u1ED1ng Gi\u1ECF H\xE0ng","color","warn","mat-icon-button","",3,"click","disabled"],[1,"flex","flex-row","space-x-2","items-center","p-2","rounded-lg","hover:bg-slate-100","cursor-pointer",3,"click"],["class","material-symbols-outlined text-green-600",4,"ngIf"],["class","material-symbols-outlined text-gray-400",4,"ngIf"],[1,"flex","flex-col","flex-1"],[1,"font-medium"],[1,"text-xs","text-gray-500"],[1,"material-symbols-outlined","text-green-600"],[1,"material-symbols-outlined","text-gray-400"],[1,"text-center","text-gray-500","p-4"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"line-clamp-4","me-4"],["mat-cell",""],[1,"max-w-20","line-clamp-4","flex","flex-row","items-center"],[1,"max-w-20","line-clamp-4",3,"class"],[1,"max-w-40","line-clamp-4"],[1,"max-w-20","line-clamp-4"],["mat-icon-button","","color","warn",3,"click","disabled"],["class","sltonthucte-input p-2 min-w-28 bg-slate-200 focus:border rounded-lg focus:border-blue-600 focus:bg-slate-100 focus:outline-none cursor-text",3,"contentEditable","blur","keydown.enter",4,"ngIf"],["class","max-w-20 line-clamp-4",4,"ngIf"],[1,"sltonthucte-input","p-2","min-w-28","bg-slate-200","focus:border","rounded-lg","focus:border-blue-600","focus:bg-slate-100","focus:outline-none","cursor-text",3,"blur","keydown.enter","contentEditable"],["class","slhuy-input p-2 min-w-28 bg-slate-200 focus:border rounded-lg focus:border-blue-600 focus:bg-slate-100 focus:outline-none cursor-text",3,"contentEditable","blur","keydown.enter",4,"ngIf"],[1,"slhuy-input","p-2","min-w-28","bg-slate-200","focus:border","rounded-lg","focus:border-blue-600","focus:bg-slate-100","focus:outline-none","cursor-text",3,"blur","keydown.enter","contentEditable"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","8",1,"mat-cell","p-4"]],template:function(t,n){if(t&1&&(r(0,"div",5)(1,"button",6),C("click",function(){return n.goBack()}),r(2,"mat-icon"),h(3,"arrow_back"),l()(),r(4,"div",7),h(5),l(),r(6,"div",8),D(7,se,3,0,"button",9)(8,ce,3,0,"button",9),l()(),r(9,"div",10),D(10,he,9,0,"ng-container",11)(11,$e,3,2,"ng-container",11),l()),t&2){let i;c(5),K(((i=n.DetailChotkho())==null?null:i.title)||"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),c(2),u("ngIf",n.isEdit()),c(),u("ngIf",!n.isEdit()),c(2),u("ngIf",n.isDelete()),c(),u("ngIf",!n.isDelete())}},dependencies:[Lt,U,G,Ft,Mt,J,St,bt,Et,wt,kt,Q,Ct,O,q,Vt,Tt,$t,Pt,Bt,Nt,gt,Yt,Ht,jt,qt,Kt,Wt,Qt,Xt,Ot,Gt,Ut,Jt,zt,z,Rt,Dt,pt,X,ut,te],encapsulation:2})};export{re as DetailChotkhoComponent};
