import{a as q}from"./chunk-EP2ZYEYI.js";import{a as $,b as j}from"./chunk-4S7DG26M.js";import{a as R}from"./chunk-YQ3XGS4L.js";import"./chunk-FLOPEQPR.js";import"./chunk-TDC46HHM.js";import"./chunk-PKTJEQ3B.js";import{a as U,b as N}from"./chunk-5SQUK3CW.js";import"./chunk-KDLSUHPH.js";import"./chunk-VR2W35LS.js";import"./chunk-DBWHEJBK.js";import"./chunk-SGYCFQGT.js";import"./chunk-LGNRZZPO.js";import{c as _,h as M}from"./chunk-7Q6IOVRA.js";import"./chunk-42KLW5LA.js";import"./chunk-Z6GF6IU5.js";import{d as O}from"./chunk-P2UNYZN7.js";import{p as I}from"./chunk-QPEFVQFW.js";import{$b as s,Fc as P,Pb as v,Qb as k,Rb as D,Tc as A,Vb as B,Xb as C,Yb as S,Zb as i,_b as e,bd as L,ka as E,mb as d,vc as r,wc as f,xc as T,yc as F,zb as w}from"./chunk-5F46NTIF.js";import"./chunk-LWLSKGAV.js";import{a as x,b as y,j as b}from"./chunk-47CWAPKR.js";var K=()=>["../"],W=(p,o)=>o.key;function z(p,o){if(p&1&&(i(0,"div")(1,"div",52)(2,"span",53),r(3),e(),i(4,"span",54),r(5),e()(),i(6,"div",55),s(7,"div",56),e()()),p&2){let t=o.$implicit;d(3),F("",t.key," (",t==null||t.value==null?null:t.value.count," )"),d(),D("text-blue-600",t.key==="Unknown")("text-green-600",t.key==="website")("text-teal-500",t.key==="whatsapp"),d(),T(" ",t==null||t.value==null?null:t.value.ratio," "),d(2),k("width",t==null||t.value==null?null:t.value.ratio),D("bg-blue-600",t.key==="Unknown")("bg-green-600",t.key==="website")("bg-teal-500",t.key==="whatsapp")}}function H(p,o){if(p&1&&(i(0,"tr")(1,"td",57)(2,"div",58),r(3),e()(),i(4,"td",57)(5,"div",58),r(6),e()()()),p&2){let t=o.$implicit;d(3),f(t.pageIdentifier),d(3),f(t.count)}}var Y=class p{_TrackingService=E(q);_UserService=E(R);cdr=E(A);profile=this._UserService.profile;ListTracking=this._TrackingService.ListTracking;Unique=0;BounceRate=0;groupedByPlatform=[];groupByPages=[];startDay=new Date(new Date().setDate(new Date().getDate()-7));endDay=new Date;ThoigianTruycap={};barChartSeries=[{name:"L\u01B0\u1EE3t Truy C\u1EADp",data:[]}];barChartOptions={chart:{type:"bar",height:350},colors:["#2196F3"],xaxis:{categories:[],title:{text:"Ng\xE0y"}},yaxis:{title:{text:"S\u1ED1 L\u01B0\u1EE3t Truy C\u1EADp"},min:0},title:{text:"L\u01B0\u1EE3t Truy C\u1EADp Theo Th\u1EDDi Gian",align:"center"},legend:{position:"top"}};pieChartSeries=[];pieChartOptions={chart:{type:"pie",height:350},labels:[],colors:["#4CAF50","#2196F3","#FF9800","#9C27B0","#E91E63","#F44336"],title:{text:"Ph\xE2n B\u1ED1 Ngu\u1ED3n Truy C\u1EADp",align:"center"},legend:{position:"bottom"}};constructor(){L(()=>b(this,null,function*(){try{yield this._UserService.getProfile(),yield this._TrackingService.getTrackingBy({refCode:this.profile().phone,eventType:"page_view"}),this.processTrackingData(),setTimeout(()=>{this.updateChartData()},100)}catch(o){console.error("Error loading tracking data:",o)}}))}ngOnInit(){return b(this,null,function*(){this.updateChartData()})}processTrackingData(){let o=this.ListTracking();this.Unique=o.reduce((a,l)=>(a.includes(l.ipAddress)||a.push(l.ipAddress),a),[]).length,this.BounceRate=this.calculateBounceRate(o),this.ThoigianTruycap=o.reduce((a,l)=>{let u=new Date(l.createdAt),g=`${u.getDate().toString().padStart(2,"0")}/${(u.getMonth()+1).toString().padStart(2,"0")}/${u.getFullYear()}`;return a[g]?a[g]++:a[g]=1,a},{});let t=o.length,n=o.reduce((a,l)=>{let u=l.sharePlatform||"Website";return a[u]=(a[u]||0)+1,a},{});this.groupedByPlatform=Object.entries(n).map(([a,l])=>({key:a,value:{count:l,ratio:t?(l/t*100).toFixed(2)+"%":"0%"}}));let c=o.reduce((a,l)=>{let u=l.pageIdentifier||"Unknown";return a[u]=(a[u]||0)+1,a},{});this.groupByPages=Object.entries(c).map(([a,l])=>({pageIdentifier:a,count:l}))}updateChartData(){let o=[],t=[],n=new Date(this.startDay),c=new Date(this.endDay);for(;n<=c;){let a=`${n.getDate().toString().padStart(2,"0")}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getFullYear()}`;o.push(a),t.push(this.ThoigianTruycap[a]||0),n.setDate(n.getDate()+1)}this.barChartOptions=y(x({},this.barChartOptions),{xaxis:y(x({},this.barChartOptions.xaxis),{categories:o})}),this.barChartSeries=[{name:"L\u01B0\u1EE3t Truy C\u1EADp",data:t}],this.updatePieChartData(),this.cdr.detectChanges()}updatePieChartData(){if(this.groupedByPlatform.length>0){let o=this.groupedByPlatform.map(a=>a.key),t=this.groupedByPlatform.map(a=>a.value.count),n={Website:"#4CAF50",TikTok:"#2196F3",Facebook:"#FF9800",Email:"#9C27B0",Instagram:"#E91E63",YouTube:"#F44336",Twitter:"#00BCD4",LinkedIn:"#3F51B5"},c=o.map(a=>n[a]||"#9E9E9E");this.pieChartSeries=t,this.pieChartOptions=y(x({},this.pieChartOptions),{labels:o,colors:c})}}calculateBounceRate(o){o.sort((m,h)=>new Date(m.createdAt).getTime()-new Date(h.createdAt).getTime());let t=[],n=[],c=null,a=30*60*1e3,l=(m,h)=>m.ipAddress===h.ipAddress&&m.userAgent===h.userAgent;o.forEach(m=>{let h=new Date(m.createdAt);!c||h.getTime()-c.getTime()<=a&&n.length>0&&l(m,o[n[0]])?n.push(o.indexOf(m)):(n.length>0&&t.push(n),n=[o.indexOf(m)]),c=h}),n.length>0&&t.push(n);let u=t.filter(m=>m.length===1).length,g=t.length,G=g>0?u/g*100:0;return{totalSessions:g,bouncedSessions:u,bounceRate:G.toFixed(2)}}static \u0275fac=function(t){return new(t||p)};static \u0275cmp=w({type:p,selectors:[["app-luottruycap"]],decls:104,vars:12,consts:[[1,"container","mx-auto","md:p-8"],[1,"flex","flex-row","space-x-2","mb-6"],["mat-icon-button","","color","primary",3,"routerLink"],[1,"flex","flex-col"],[1,"text-xl","font-bold","text-gray-800"],[1,"text-gray-600"],[1,"mb-8","p-4","bg-white","rounded-lg","shadow"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between"],[1,"text-lg","font-semibold","text-gray-700","mb-3","sm:mb-0"],[1,"flex","flex-row","items-center","gap-2"],["id","filterDay",1,"date-filter-button","bg-gray-200","hover:bg-gray-300","text-gray-700","font-medium","p-2","rounded-md","text-sm"],[1,"fas","fa-calendar-day","mr-2"],["id","filterMonth",1,"date-filter-button","bg-gray-200","hover:bg-gray-300","text-gray-700","font-medium","p-2","rounded-md","text-sm","active"],[1,"fas","fa-calendar-alt","mr-2"],["id","filterCustom",1,"date-filter-button","bg-gray-200","hover:bg-gray-300","text-gray-700","font-medium","p-2","rounded-md","text-sm"],[1,"fas","fa-calendar-edit","mr-2"],["id","customDateRange",1,"mt-4","hidden"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","items-end"],["for","startDate",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","date","id","startDate","name","startDate",1,"date-input","mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-indigo-500","focus:ring-indigo-500","sm:text-sm","p-2"],["for","endDate",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","date","id","endDate","name","endDate",1,"date-input","mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-indigo-500","focus:ring-indigo-500","sm:text-sm","p-2"],["id","applyCustomDate",1,"bg-indigo-600","hover:bg-indigo-700","text-white","font-medium","p-2","rounded-md","text-sm","h-10","md:mt-0","mt-4"],[1,"fas","fa-check","mr-2"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6","mb-8"],[1,"metric-card","bg-white","p-6","rounded-lg","shadow-md"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-gray-500"],[1,"text-3xl","font-bold","text-indigo-600"],[1,"bg-indigo-100","p-3","rounded-full"],[1,"fas","fa-eye","fa-2x","text-indigo-600"],[1,"text-xs","text-green-500","mt-2","flex","items-center"],[1,"fas","fa-arrow-up","mr-1"],[1,"text-3xl","font-bold","text-green-600"],[1,"bg-green-100","p-3","rounded-full"],[1,"fas","fa-users","fa-2x","text-green-600"],[1,"text-3xl","font-bold","text-red-600"],[1,"bg-red-100","p-3","rounded-full"],[1,"fas","fa-sign-out-alt","fa-2x","text-red-600"],[1,"text-xs","text-red-500","mt-2","flex","items-center"],[1,"lg:col-span-2","bg-white","p-6","rounded-lg","shadow-md"],[1,"text-xl","font-semibold","text-gray-700","mb-4"],[3,"series","chart","xaxis","yaxis","title","legend","colors"],[1,"bg-white","p-6","rounded-lg","shadow-md"],[1,"space-y-4"],[1,"chart-placeholder","h-40","mt-6"],[1,"text-center"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],[1,"flex","justify-between","mb-1"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-sm","font-medium"],[1,"w-full","bg-gray-200","rounded-full","h-2.5"],[1,"h-2.5","rounded-full"],[1,"px-6","py-4","whitespace-nowrap"],[1,"text-sm","text-gray-900"]],template:function(t,n){t&1&&(i(0,"div",0)(1,"header",1)(2,"button",2)(3,"mat-icon"),r(4,"arrow_back"),e()(),i(5,"div",3)(6,"span",4),r(7,"Landing Page"),e(),i(8,"span",5),r(9,"T\u1ED5ng quan hi\u1EC7u su\u1EA5t c\xE1c trang \u0111\xEDch c\u1EE7a b\u1EA1n."),e()()(),i(10,"section",6)(11,"div",7)(12,"h2",8),r(13,"Ch\u1ECDn Khung Th\u1EDDi Gian"),e(),i(14,"div",9)(15,"button",10),s(16,"i",11),r(17,"1 Ng\xE0y "),e(),i(18,"button",12),s(19,"i",13),r(20,"1 Th\xE1ng "),e(),i(21,"button",14),s(22,"i",15),r(23,"T\xF9y Ch\u1EC9nh "),e()()(),i(24,"div",16)(25,"div",17)(26,"div")(27,"label",18),r(28,"T\u1EEB ng\xE0y"),e(),s(29,"input",19),e(),i(30,"div")(31,"label",20),r(32,"\u0110\u1EBFn ng\xE0y"),e(),s(33,"input",21),e(),i(34,"button",22),s(35,"i",23),r(36,"\xC1p D\u1EE5ng "),e()()()(),i(37,"main")(38,"section",24)(39,"div",25)(40,"div",26)(41,"div")(42,"p",27),r(43,"T\u1ED5ng L\u01B0\u1EE3t Truy C\u1EADp"),e(),i(44,"p",28),r(45),e()(),i(46,"div",29),s(47,"i",30),e()(),i(48,"p",31),s(49,"i",32),r(50," 12.5% so v\u1EDBi k\u1EF3 tr\u01B0\u1EDBc "),e()(),i(51,"div",25)(52,"div",26)(53,"div")(54,"p",27),r(55,"Kh\xE1ch Truy C\u1EADp Duy Nh\u1EA5t"),e(),i(56,"p",33),r(57),e()(),i(58,"div",34),s(59,"i",35),e()(),i(60,"p",31),s(61,"i",32),r(62," 8.2% so v\u1EDBi k\u1EF3 tr\u01B0\u1EDBc "),e()(),i(63,"div",25)(64,"div",26)(65,"div")(66,"p",27),r(67,"T\u1EF7 L\u1EC7 Tho\xE1t"),e(),i(68,"p",36),r(69),e()(),i(70,"div",37),s(71,"i",38),e()(),i(72,"p",39),s(73,"i",32),r(74," 1.5% so v\u1EDBi k\u1EF3 tr\u01B0\u1EDBc "),e()()(),i(75,"section",24)(76,"div",40)(77,"h2",41),r(78,"Ngu\u1ED3n L\u01B0u L\u01B0\u1EE3ng Truy C\u1EADp"),e(),i(79,"div"),s(80,"apx-chart",42),e()(),i(81,"div",43)(82,"h2",41),r(83,"Ph\xE2n Lo\u1EA1i N\u1EC1n T\u1EA3ng"),e(),i(84,"div",44),C(85,z,8,17,"div",null,W),e(),i(87,"div",45)(88,"p",46),r(89,"Bi\u1EC3u \u0111\u1ED3 tr\xF2n ph\xE2n lo\u1EA1i thi\u1EBFt b\u1ECB."),e()()()(),i(90,"section",43)(91,"h2",41),r(92,"Top Pages"),e(),i(93,"div",47)(94,"table",48)(95,"thead",49)(96,"tr")(97,"th",50),r(98," T\xEAn Trang "),e(),i(99,"th",50),r(100," L\u01B0\u1EE3t Truy C\u1EADp "),e()()(),i(101,"tbody",51),C(102,H,7,2,"tr",null,B),e()()()()()()),t&2&&(d(2),v("routerLink",P(11,K)),d(43),f(n.ListTracking().length),d(12),f(n.Unique),d(12),T("",n.BounceRate.bounceRate,"%"),d(11),v("series",n.barChartSeries)("chart",n.barChartOptions.chart)("xaxis",n.barChartOptions.xaxis)("yaxis",n.barChartOptions.yaxis)("title",n.barChartOptions.title)("legend",n.barChartOptions.legend)("colors",n.barChartOptions.colors),d(5),S(n.groupedByPlatform),d(17),S(n.groupByPages))},dependencies:[M,_,N,U,O,I,j,$],encapsulation:2})};export{Y as LuottruycapComponent};
