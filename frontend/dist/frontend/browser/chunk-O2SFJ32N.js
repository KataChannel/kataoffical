import{a as Xt}from"./chunk-2U2B76XG.js";import{a as Yt,b as Ut}from"./chunk-ACXME3FN.js";import{a as Zt}from"./chunk-6WCXM3RR.js";import{a as It,b as Vt,c as L,d as Nt,e as I,f as At,g as Pt,h as $t,i as Bt,j as Ot,k as Rt,l as zt,m as Ht,n as Qt,o as qt,p as Jt,q as Gt,r as Kt,s as jt,t as Wt}from"./chunk-SHIHHHDL.js";import{a as mt,b as ct,c as pt}from"./chunk-QPOPWS4R.js";import{b as Ft,d as kt,e as Lt}from"./chunk-TQXDHTI6.js";import{b as bt}from"./chunk-5BO7UND7.js";import{a as st}from"./chunk-P66YLRZ3.js";import{a as _t,b as ht,c as gt,d as ft}from"./chunk-6HSV7XR6.js";import{a as ut,b as dt}from"./chunk-N6KP6FVW.js";import{b as Ct,g as xt,j as wt,n as yt,p as Dt,q as St,u as vt,v as Mt,x as Et,y as Tt}from"./chunk-RLIVLHJL.js";import{a as ot,b as rt,d as lt}from"./chunk-4AC7DX4U.js";import{y as nt,z as at}from"./chunk-PCFIUFHV.js";import{b as et,c as it}from"./chunk-QLCA2AHS.js";import{l as Y,m as U,o as X,q as tt}from"./chunk-OT2AILUN.js";import{$b as N,Dc as $,Eb as O,Ec as m,Fc as b,Gc as f,Hc as G,Lb as y,Lc as K,Mc as j,Nc as W,Pc as B,Uc as F,Vb as h,Wc as k,Yb as R,Zb as z,bc as H,cc as A,dc as P,ec as a,fc as o,gc as v,hc as Q,ic as q,id as Z,kc as S,oa as D,pc as g,rb as l,rc as s,vc as J,xa as d,xc as M,ya as _,yc as E,zc as T}from"./chunk-RLTLDDHR.js";import{a as V,j as w}from"./chunk-6DYNGEAS.js";var ae=["drawer"],oe=()=>[5,10,25,100],re=()=>({standalone:!0}),le=(n,e)=>e.key;function se(n,e){if(n&1){let t=S();a(0,"button",31),g("click",function(r){let p=d(t).$implicit;return s().toggleColumn(p),_(r.stopPropagation())}),a(1,"mat-icon"),m(2),o(),a(3,"span"),m(4),o()()}if(n&2){let t=e.$implicit;l(2),b(t.isShow?"check_box":"check_box_outline_blank"),l(2),b(t.value)}}function me(n,e){if(n&1){let t=S();a(0,"mat-form-field",34)(1,"mat-label"),m(2),o(),a(3,"input",35),g("keyup",function(){d(t);let r=s(2);return _(r.applyFilter())}),W("ngModelChange",function(r){let p=d(t).$implicit,u=s(2);return j(u.filterValues[p],r)||(u.filterValues[p]=r),_(r)}),o()()}if(n&2){let t=e.$implicit,i=s(2);l(2),b(i.ColumnName[t]),l(),J("placeholder","Vui l\xF2ng Nh\u1EADp ",t,""),K("ngModel",i.filterValues[t]),h("ngModelOptions",B(5,re))}}function ce(n,e){if(n&1&&(a(0,"div",32),y(1,me,4,6,"mat-form-field",33),o()),n&2){let t=s();l(),h("ngForOf",t.displayedColumns)}}function pe(n,e){if(n&1&&(a(0,"th",38)(1,"span",39),m(2),o()()),n&2){let t=s().$implicit,i=s();l(2),f(" ",i.ColumnName[t]," ")}}function ue(n,e){if(n&1&&(a(0,"span",41),m(1),o()),n&2){let t=s().index;l(),f(" ",t+1," ")}}function de(n,e){if(n&1&&(a(0,"span",41),m(1),o()),n&2){let t=s().$implicit,i=s().$implicit;l(),f(" ",t[i].length," ")}}function _e(n,e){if(n&1&&(a(0,"span",41),m(1),o()),n&2){let t=s().$implicit,i=s().$implicit;l(),G(" (",t[i].mancc,") ",t[i].name," ")}}function he(n,e){if(n&1&&(a(0,"span",41),m(1),F(2,"date"),o()),n&2){let t=s().$implicit,i=s().$implicit;l(),f(" ",k(2,1,t[i],"dd/MM/yyyy")," ")}}function ge(n,e){if(n&1&&(a(0,"span",41),m(1),F(2,"date"),o()),n&2){let t=s().$implicit,i=s().$implicit;l(),f(" ",k(2,1,t[i],"dd/MM/yyyy")," ")}}function fe(n,e){n&1&&(a(0,"mat-icon",42),m(1,"check_circle"),o())}function Ce(n,e){n&1&&(a(0,"mat-icon",43),m(1,"cancel"),o())}function xe(n,e){if(n&1&&(a(0,"span",41),y(1,fe,2,0,"mat-icon",42)(2,Ce,2,0,"mat-icon",43),o()),n&2){let t=s().$implicit,i=s().$implicit;l(),N(t[i]?1:2)}}function we(n,e){if(n&1&&(a(0,"span",41),m(1),F(2,"date"),o()),n&2){let t=s().$implicit,i=s().$implicit;l(),f(" ",k(2,1,t[i],"dd/MM/yyyy")," ")}}function ye(n,e){if(n&1&&(a(0,"span",41),m(1),o()),n&2){let t=s().$implicit,i=s().$implicit;l(),f(" ",t[i]," ")}}function De(n,e){if(n&1&&(a(0,"td",40),y(1,ue,2,1,"span",41)(2,de,2,1,"span",41)(3,_e,2,2,"span",41)(4,he,3,4,"span",41)(5,ge,3,4,"span",41)(6,xe,3,1,"span",41)(7,we,3,4,"span",41)(8,ye,2,1,"span",41),o()),n&2){let t,i=s().$implicit;l(),N((t=i)==="STT"?1:t==="sanpham"?2:t==="nhacungcap"?3:t==="ngaynhan"?4:t==="createdAt"?5:t==="isActive"?6:t==="updatedAt"?7:8)}}function Se(n,e){if(n&1&&(Q(0,26),y(1,pe,3,1,"th",36)(2,De,9,1,"td",37),q()),n&2){let t=e.$implicit;h("matColumnDef",t)}}function ve(n,e){n&1&&v(0,"tr",44)}function Me(n,e){if(n&1){let t=S();a(0,"tr",45),g("click",function(){let r=d(t).$implicit,p=s();return _(p.goToDetail(r))}),o()}if(n&2){let t=e.$implicit,i=s();z("hover:bg-slate-100 ",i.dathangId()==t.id?"!bg-slate-200":"","")}}function Ee(n,e){n&1&&(a(0,"tr",46)(1,"td",47),m(2,"Kh\xF4ng t\xECm th\u1EA5y"),o()())}var te=class n{Detail={};displayedColumns=["STT","madncc","nhacungcap","sanpham","ngaynhan","ghichu","isActive","createdAt","updatedAt"];ColumnName={STT:"STT",madncc:"M\xE3 \u0110\u01A1n Nh\u1EADp",nhacungcap:"Nh\xE0 Cung C\u1EA5p",sanpham:"S\u1EA3n Ph\u1EA9m",ngaynhan:"Ng\xE0y Nh\u1EADn",ghichu:"Ghi Ch\xFA",isActive:"Tr\u1EA1ng Th\xE1i",createdAt:"Ng\xE0y T\u1EA1o",updatedAt:"Ng\xE0y C\u1EADp Nh\u1EADt"};FilterColumns=JSON.parse(localStorage.getItem("DathangColFilter")||"[]");Columns=[];isFilter=!1;paginator;sort;drawer;filterValues={};_DathangService=D(Xt);_breakpointObserver=D(nt);_GoogleSheetService=D(Zt);_router=D(it);Listdathang=this._DathangService.ListDathang;dataSource=Z(()=>{let e=new Wt(this.Listdathang());return e.filterPredicate=this.createFilter(),e.paginator=this.paginator,e.sort=this.sort,e});dathangId=this._DathangService.dathangId;_snackBar=D(st);CountItem=0;constructor(){this.displayedColumns.forEach(e=>{this.filterValues[e]=""})}createFilter(){return(e,t)=>{let i=JSON.parse(t),r=!0;return this.displayedColumns.forEach(p=>{if(i[p]){let u=e[p]?e[p].toString().toLowerCase():"";r=r&&u.includes(i[p].toLowerCase())}}),r}}applyFilter(){this.dataSource().filter=JSON.stringify(this.filterValues)}ngOnInit(){return w(this,null,function*(){yield this._DathangService.getAllDathang(),this.CountItem=this.Listdathang().length,this.initializeColumns(),this.setupDrawer(),this.paginator._intl.itemsPerPageLabel="S\u1ED1 l\u01B0\u1EE3ng 1 trang",this.paginator._intl.nextPageLabel="Ti\u1EBFp Theo",this.paginator._intl.previousPageLabel="V\u1EC1 Tr\u01B0\u1EDBc",this.paginator._intl.firstPageLabel="Trang \u0110\u1EA7u",this.paginator._intl.lastPageLabel="Trang Cu\u1ED1i"})}refresh(){return w(this,null,function*(){yield this._DathangService.getAllDathang()})}initializeColumns(){this.Columns=Object.keys(this.ColumnName).map(e=>({key:e,value:this.ColumnName[e],isShow:!0})),this.FilterColumns.length===0?this.FilterColumns=this.Columns:localStorage.setItem("DathangColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{})}setupDrawer(){this._breakpointObserver.observe([at.Handset]).subscribe(e=>{e.matches?(this.drawer.mode="over",this.paginator.hidePageSize=!0):this.drawer.mode="side"})}toggleColumn(e){let t=this.FilterColumns.find(i=>i.key===e.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("DathangColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(i=>i.value.toLowerCase().includes(t))}create(){this.drawer.open(),this._router.navigate(["admin/dathang",0])}goToDetail(e){this._DathangService.setDathangId(e.id),this.drawer.open(),this._router.navigate(["admin/dathang",e.id])}LoadDrive(){return w(this,null,function*(){let e={IdSheet:"15npo25qyH5FmfcEjl1uyqqyFMS_vdFnmxM_kt0KYmZk",SheetName:"SPImport",ApiKey:"AIzaSyD33kgZJKdFpv1JrKHacjCQccL_O0a2Eao"},t=yield this._GoogleSheetService.getDrive(e),i=Ft(t.values);console.log(i),this.DoImportData(i)})}DoImportData(e){console.log(e);let i=e.map(c=>({title:c.title?.trim()||"",masp:c.masp?.trim()||"",slug:`${kt(c?.title?.trim()||"")}_${Lt(5,!1)}`,giagoc:Number(c.giagoc)||0,dvt:c.dvt||"",soluong:Number(c.soluong)||0,soluongkho:Number(c.soluongkho)||0,ghichu:c.ghichu||"",order:Number(c.order)||0})).filter((c,C,x)=>C===x.findIndex(ne=>ne.masp===c.masp)),r=i.map(c=>c.masp),p=this._DathangService.ListDathang().map(c=>c.masp),u=r.filter(c=>!p.includes(c)),ee=i.map(c=>w(this,null,function*(){let C=this._DathangService.ListDathang().find(x=>x.masp===c.masp);if(C){let x=V(V({},C),c);yield this._DathangService.updateDathang(x)}else yield this._DathangService.CreateDathang(c)})),ie=u.map(c=>w(this,null,function*(){let C=this._DathangService.ListDathang().find(x=>x.masp===c);C.isActive=!1,yield this._DathangService.updateDathang(C)}));Promise.all([...ee,...ie]).then(()=>{this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ImporExcel(e){return w(this,null,function*(){let t=yield Ut(e);this.DoImportData(t)})}ExportExcel(e,t){Yt(e,t)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=O({type:n,selectors:[["app-listdathang"]],viewQuery:function(t,i){if(t&1&&(M(L,5),M(I,5),M(ae,7)),t&2){let r;E(r=T())&&(i.paginator=r.first),E(r=T())&&(i.sort=r.first),E(r=T())&&(i.drawer=r.first)}},decls:50,vars:12,consts:[["drawer",""],["menu","matMenu"],["uploadfile",""],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-12","w-full","p-2"],[1,"cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","p-2","bg-white","rounded-lg"],[1,"flex","flex-row","space-x-2","items-center"],["matTooltip","Th\xEAm m\u1EDBi","mat-flat-button","",1,"flex","flex-row","items-center","btn-primary",3,"click"],[1,"whitespace-nowrap"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["matTooltip","B\u1ED9 L\u1ECDc","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\u1EA3i file excel M\u1EABu","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\u1EA3i l\xEAn file excel","color","primary","mat-icon-button","",3,"click"],["type","file",1,"hidden",3,"change"],["matTooltip","T\u1EA3i d\u1EEF li\u1EC7u t\u1EEB drive","color","primary","mat-icon-button","",3,"click"],[1,"lg:flex","hidden","whitespace-nowrap","p-2","rounded-lg","bg-slate-200"],["class","w-full grid grid-cols-2 gap-2 lg:flex lg:flex-row lg:space-x-2 items-center",4,"ngIf"],[1,"w-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"class","click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSizeOptions"],["mat-menu-item","",3,"click"],[1,"w-full","grid","grid-cols-2","gap-2","lg:flex","lg:flex-row","lg:space-x-2","items-center"],["appearance","outline","subscriptSizing","dynamic",4,"ngFor","ngForOf"],["appearance","outline","subscriptSizing","dynamic"],["matInput","",3,"keyup","ngModelChange","ngModel","ngModelOptions","placeholder"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"max-w-40","line-clamp-4","me-4"],["mat-cell",""],[1,"max-w-40","line-clamp-4"],[1,"text-green-500"],[1,"text-red-500"],["mat-header-row",""],["mat-row","",3,"click"],[1,"mat-row"],["colspan","4",1,"mat-cell","p-4"]],template:function(t,i){if(t&1){let r=S();a(0,"mat-drawer-container",3)(1,"mat-drawer",4,0),v(3,"router-outlet"),o(),a(4,"div",5)(5,"div",6)(6,"div",7)(7,"button",8),g("click",function(){return d(r),_(i.create())}),a(8,"mat-icon"),m(9,"add_circle"),o(),a(10,"span",9),m(11,"T\u1EA1o M\u1EDBi"),o()(),a(12,"button",10)(13,"mat-icon"),m(14,"tune"),o()(),a(15,"mat-menu",null,1)(17,"div",11)(18,"mat-form-field",12)(19,"input",13),g("input",function(u){return d(r),_(i.doFilterColumns(u))})("click",function(u){return d(r),_(u.stopPropagation())}),o(),a(20,"mat-icon",14),m(21,"search"),o()()(),a(22,"div",15),A(23,se,5,2,"button",16,le),o()(),a(25,"button",17),g("click",function(){return d(r),_(i.isFilter=!i.isFilter)}),a(26,"mat-icon"),m(27,"filter_list"),o()(),a(28,"button",18),g("click",function(){return d(r),_(i.ExportExcel(i.Listdathang(),"Dathang"))}),a(29,"mat-icon"),m(30,"file_download"),o()(),a(31,"button",19),g("click",function(){d(r);let u=$(35);return _(u.click())}),a(32,"mat-icon"),m(33,"file_upload"),o()(),a(34,"input",20,2),g("change",function(u){return d(r),_(i.ImporExcel(u))}),o(),a(36,"button",21),g("click",function(){return d(r),_(i.LoadDrive())}),a(37,"mat-icon"),m(38,"cloud_download"),o()(),a(39,"span",22),m(40),o()()(),y(41,ce,2,1,"div",23),a(42,"div",24)(43,"table",25),A(44,Se,3,1,"ng-container",26,H),y(46,ve,1,0,"tr",27)(47,Me,1,3,"tr",28)(48,Ee,3,0,"tr",29),o(),v(49,"mat-paginator",30),o()()()}if(t&2){let r=$(16);l(),h("position","end"),l(11),h("matMenuTriggerFor",r),l(11),P(i.FilterColumns),l(2),R(i.isFilter?"!bg-slate-200":""),l(15),f(" ",i.CountItem," S\u1EA3n Ph\u1EA9m "),l(),h("ngIf",i.isFilter),l(2),h("dataSource",i.dataSource()),l(),P(i.displayedColumns),l(2),h("matHeaderRowDef",i.displayedColumns),l(),h("matRowDefColumns",i.displayedColumns),l(2),h("pageSizeOptions",B(11,oe))}},dependencies:[Mt,vt,Dt,St,Tt,Et,jt,$t,Ot,Qt,Rt,Bt,qt,zt,Ht,Jt,Gt,Kt,Pt,I,At,Nt,L,ft,ht,_t,gt,pt,mt,ct,et,dt,ut,lt,ot,rt,bt,tt,Y,U,X,yt,Ct,xt,wt,Vt,It],encapsulation:2})};export{te as a};
