import{a as N}from"./chunk-Q3KOS33T.js";import{ja as m,oa as y}from"./chunk-OL5DVADB.js";var b=class g{constructor(n){this.snackBar=n}fieldMappings={donhang:{sldat:{fieldType:"sldat",inputClassName:".sldat-input",focusNext:!0,syncFields:["slgiao","slnhan"]},slgiao:{fieldType:"slgiao",inputClassName:".slgiao-input",focusNext:!0,validation:(n,t)=>t<n.sldat?"S\u1ED1 l\u01B0\u1EE3ng giao ph\u1EA3i l\u1EDBn h\u01A1n s\u1ED1 l\u01B0\u1EE3ng \u0111\u1EB7t":null},slnhan:{fieldType:"slnhan",inputClassName:".slnhan-input",focusNext:!0},ghichu:{fieldType:"ghichu",inputClassName:".ghichu-input",focusNext:!0}},dathang:{sldat:{fieldType:"sldat",inputClassName:".sldat-input",focusNext:!0,syncFields:["slgiao","slnhan"]},slgiao:{fieldType:"slgiao",inputClassName:".slgiao-input",focusNext:!0,validation:(n,t)=>t<n.sldat?"S\u1ED1 l\u01B0\u1EE3ng giao ph\u1EA3i l\u1EDBn h\u01A1n s\u1ED1 l\u01B0\u1EE3ng \u0111\u1EB7t":null},slnhan:{fieldType:"slnhan",inputClassName:".slnhan-input",focusNext:!0,calculateFields:{ttnhan:(n,t)=>parseFloat((n.gianhap*parseFloat(t.toString())).toFixed(3))||0}},gianhap:{fieldType:"gianhap",inputClassName:".gianhap-input",focusNext:!0,calculateFields:{ttnhan:(n,t)=>parseFloat((parseFloat(t.toString())*n.slnhan).toFixed(3))||0}},ghichu:{fieldType:"ghichu",inputClassName:".ghichu-input",focusNext:!0}},phieugiaohang:{sldat:{fieldType:"sldat",inputClassName:".sldat-input",focusNext:!0,syncFields:["slgiao","slnhan"],calculateFields:{ttgiao:(n,t)=>Number(t)*(n.giaban||0)}},slgiao:{fieldType:"slgiao",inputClassName:".slgiao-input",focusNext:!0,syncFields:["slnhan"],calculateFields:{ttgiao:(n,t)=>Number(t)*(n.giaban||0)}},slnhan:{fieldType:"slnhan",inputClassName:".slnhan-input",focusNext:!0},giaban:{fieldType:"giaban",inputClassName:".giaban-input",focusNext:!0,calculateFields:{ttgiao:(n,t)=>(n.slgiao||0)*Number(t)}},ghichu:{fieldType:"ghichu",inputClassName:".ghichu-input",focusNext:!0}}};parseDecimalValue(n){return Number(n.replace(/,/g,"."))||0}handleKeyboardEvent(n,t){if(n.key==="Enter"&&!n.shiftKey)return n.preventDefault(),!0;if(t==="number"){let e=["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Enter","0","1","2","3","4","5","6","7","8","9",".",",","Home","End","PageUp","PageDown"],i=n.target.innerText.trim(),a=n.key==="."||n.key===",",r=i.includes(".")||i.includes(","),s=/^[0-9]$/.test(n.key),l=n.code&&n.code.startsWith("Numpad")&&/Numpad[0-9]/.test(n.code),o=e.includes(n.key);if(!s&&!l&&!(a&&!r)&&!o)return n.preventDefault(),!1}return!0}focusNextInput(n,t,e){if(t<e-1){let a=document.querySelectorAll(n)[t+1];a&&(a instanceof HTMLInputElement&&(a.focus(),a.select()),setTimeout(()=>{if(document.createRange&&window.getSelection){let r=document.createRange();r.selectNodeContents(a);let s=window.getSelection();s?.removeAllRanges(),s?.addRange(r)}},10))}}onInputFocus(n){let t=n.target;t&&t.isContentEditable&&setTimeout(()=>{if(document.createRange&&window.getSelection){let e=document.createRange();e.selectNodeContents(t);let i=window.getSelection();i?.removeAllRanges(),i?.addRange(e)}},10)}updateValue(n,t,e,i,a,r,s,l,o){let u=n.target,c;r==="number"?c=this.parseDecimalValue(u.innerText.trim()):c=u.innerText.trim();let p=n;this.handleKeyboardEvent(p,r);let d=this.fieldMappings[t]?.[a];if(!d){this.updateSimpleField(e,i,a,c,s,l);return}if(d.validation&&e!==null){let f=this.findItemInArray(i,s),h=d.validation(f,c);h&&(this.snackBar.open(h,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),a==="slgiao"&&(c=f?.sldat||0))}this.updateFieldWithConfig(e,i,a,c,d,s,l),d.focusNext&&e!==null&&this.focusNextInput(d.inputClassName,e,o)}updateBlurValue(n,t,e,i,a,r,s,l){let o=n.target,u;r==="number"?u=this.parseDecimalValue(o.innerText.trim()):u=o.innerText.trim();let c=this.fieldMappings[t]?.[a];if(!c){this.updateSimpleField(e,i,a,u,s,l);return}if(c.validation&&e!==null){let p=this.findItemInArray(i,s),d=c.validation(p,u);d&&(this.snackBar.open(d,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),a==="slgiao"&&(u=p?.sldat||0))}this.updateFieldWithConfig(e,i,a,u,c,s,l)}findItemInArray(n,t){return n?.id?t.find(e=>e.id===n.id):n}updateFieldWithConfig(n,t,e,i,a,r,s){if(n!==null){let l=r.findIndex(o=>o.id===t.id);if(l===-1)return;s(o=>(o.sanpham[l][e]=i,a.syncFields&&a.syncFields.forEach(u=>{o.sanpham[l][u]=i}),a.calculateFields&&Object.entries(a.calculateFields).forEach(([u,c])=>{o.sanpham[l][u]=c(o.sanpham[l],i)}),o))}else s(l=>(l[e]=i,l))}updateSimpleField(n,t,e,i,a,r){if(n!==null){let s=a.findIndex(l=>l.id===t.id);if(s===-1)return;r(l=>(l.sanpham[s][e]=i,l))}else r(s=>(s[e]=i,s))}static \u0275fac=function(t){return new(t||g)(y(N))};static \u0275prov=m({token:g,factory:g.\u0275fac,providedIn:"root"})};export{b as a};
