import{a as xt}from"./chunk-6FC2GRWJ.js";import{a as At}from"./chunk-VRX3PFHD.js";import{a as Et}from"./chunk-2THUL5RA.js";import{a as vt}from"./chunk-AJ5JTY7X.js";import{a as Dt}from"./chunk-GPXTOZIJ.js";import{a as Bt}from"./chunk-UCPSMH2E.js";import{a as Pt}from"./chunk-XRNIFLBZ.js";import{a as ut}from"./chunk-LPL33NWN.js";import{a as lt}from"./chunk-MC2RAUNI.js";import{a as dt}from"./chunk-4ZVJO4SQ.js";import{a as St}from"./chunk-DO444VEW.js";import{c as ht,h as ct}from"./chunk-6T5DLZAF.js";import{a as It,g as Ct,h as A}from"./chunk-EHGCZ4C4.js";import{a as _t}from"./chunk-H3TTFDG6.js";import{b as ft,c as yt,d as kt,e as bt,g as Lt,s as wt}from"./chunk-AYBK3TLN.js";import{c as et}from"./chunk-QR3VZXMW.js";import{b as mt}from"./chunk-OCCYRB3G.js";import{a as Ht}from"./chunk-JNVUT6FC.js";import{d as st}from"./chunk-5NUPTYVB.js";import{a as nt,b as ot}from"./chunk-WCQZDYIS.js";import{n as rt,v as pt,y as gt}from"./chunk-2G4G76BL.js";import{a as k}from"./chunk-VUZTNYK4.js";import{a as O,b as it}from"./chunk-LCSHMLYS.js";import{a as tt,e as at}from"./chunk-M4K2YFJY.js";import{y as Z}from"./chunk-INKYKFQH.js";import{c as H}from"./chunk-4TLJXXI3.js";import{l as J,m as X,t as W}from"./chunk-4KYRHQES.js";import{Cc as q,Dc as f,Eb as U,Ec as x,Lb as N,Ra as y,Vb as M,Zb as V,dc as m,ec as d,ia as T,id as Q,jc as $,na as B,oa as p,oc as C,qc as R,rb as L,wc as z,xa as _,xc as K,ya as I,yc as j}from"./chunk-6QR2UCJZ.js";import{a as w,b as v,g as jt,j as c}from"./chunk-6DYNGEAS.js";var F=class h{socket;constructor(){this.socket=lt(`${k.APIURL}`,{transports:["websocket"],reconnectionAttempts:5,timeout:5e3})}getSocket(){return this.socket}static \u0275fac=function(a){return new(a||h)};static \u0275prov=T({token:h,factory:h.\u0275fac,providedIn:"root"})};var Y=class h{constructor(e,a,i,t){this._StorageService=e;this.router=a;this._ErrorLogService=i;this._sharedSocketService=t;this.socket=this._sharedSocketService.getSocket(),this.listenImportdataUpdates()}socket;_snackBar=p(O);ListImportdata=y([]);DetailImportdata=y({});page=y(1);pageCount=y(1);total=y(0);pageSize=y(10);importdataId=y(null);initDB(){return c(this,null,function*(){return yield dt("ImportdataDB",4,{upgrade(e,a){a<1&&e.createObjectStore("importdatas",{keyPath:"id"}),a<3&&(e.objectStoreNames.contains("importdatas")&&e.deleteObjectStore("importdatas"),e.objectStoreNames.contains("pagination")&&e.deleteObjectStore("pagination"),e.createObjectStore("importdatas",{keyPath:"id"})),a<4}})})}saveImportdatas(e,a){return c(this,null,function*(){let t=(yield this.initDB()).transaction("importdatas","readwrite"),o=t.objectStore("importdatas");yield o.clear(),yield o.put({id:"data",importdatas:e,pagination:a}),yield t.done})}getCachedData(){return c(this,null,function*(){let a=yield(yield this.initDB()).get("importdatas","data");return a&&a.importdatas?{importdatas:a.importdatas,pagination:a.pagination||{page:1,pageCount:1,total:a.importdatas.length,pageSize:10}}:{importdatas:[],pagination:{page:1,pageCount:1,total:0,pageSize:10}}})}setImportdataId(e){this.importdataId.set(e)}CreateImportdata(e){return c(this,null,function*(){try{let a={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(e)},i=yield fetch(`${k.APIURL}/importdata`,a);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);let t=yield i.json();this.getAllImportdata(this.pageSize()),this.importdataId.set(t.id)}catch(a){this._ErrorLogService.logError("Failed to CreateImportdata",a),console.error(a)}})}getAllImportdata(){return c(this,arguments,function*(e=this.pageSize(),a=!1){this.pageSize.set(e);let i=yield this.getCachedData(),t=this._StorageService.getItem("importdatas_updatedAt")||"0";if(!a&&i.importdatas.length>0&&Date.now()-new Date(t).getTime()<5*60*1e3)return this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas;try{let o={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}};if(!a){let b=yield fetch(`${k.APIURL}/importdata/lastupdated`,o);if(!b.ok)return this.handleError(b.status),this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas;let{updatedAt:E}=yield b.json();if(E<=t)return this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas}let s=new URLSearchParams({page:this.page().toString(),limit:e.toString()}),u=yield fetch(`${k.APIURL}/importdata?${s}`,o);if(!u.ok)return this.handleError(u.status),this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas;let g=yield u.json();if(yield this.saveImportdatas(g.data,{page:g.page||1,pageCount:g.pageCount||1,total:g.total||g.data.length,pageSize:e}),a)this._StorageService.setItem("importdatas_updatedAt",new Date().toISOString());else{let b=yield fetch(`${k.APIURL}/importdata/lastupdated`,o),{updatedAt:E}=yield b.json();this._StorageService.setItem("importdatas_updatedAt",E)}return this.ListImportdata.set(g.data),this.page.set(g.page||1),this.pageCount.set(g.pageCount||1),this.total.set(g.total||g.data.length),this.pageSize.set(e),g.data}catch(o){return this._ErrorLogService.logError("Failed to getAllImportdata",o),console.error(o),this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas}})}getUpdatedCodeIds(){return c(this,null,function*(){try{let e={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},a=yield fetch(`${k.APIURL}/importdata/updateCodeIds`,e);a.ok||this.handleError(a.status);let i=yield a.json();return this.getAllImportdata(this.pageSize()),i.data}catch(e){this._ErrorLogService.logError("Failed to getUpdatedCodeIds",e),console.error(e)}})}listenImportdataUpdates(){this.socket.off("importdata-updated"),this.socket.on("importdata-updated",()=>c(this,null,function*(){console.log("\u{1F504} D\u1EEF li\u1EC7u s\u1EA3n ph\u1EA9m thay \u0111\u1ED5i, c\u1EADp nh\u1EADt l\u1EA1i cache..."),this._StorageService.removeItem("importdatas_updatedAt"),yield this.getAllImportdata()}))}getImportdataBy(i){return c(this,arguments,function*(e,a=this.pageSize()){this.pageSize.set(a);try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(v(w({},e),{page:this.page(),limit:a}))},o=yield fetch(`${k.APIURL}/importdata/findby`,t);o.ok||this.handleError(o.status);let s=yield o.json();e.isOne===!0?this.DetailImportdata.set(s):(yield this.saveImportdatas(s.data,{page:s.page||1,pageCount:s.pageCount||1,total:s.total||s.data.length,pageSize:a}),this._StorageService.setItem("importdatas_updatedAt",new Date().toISOString()),this.ListImportdata.set(s.data),this.page.set(s.page||1),this.pageCount.set(s.pageCount||1),this.total.set(s.total||s.data.length),this.pageSize.set(a))}catch(t){this._ErrorLogService.logError("Failed to getImportdataBy",t),console.error(t);let o=yield this.getCachedData();e.isOne||(this.ListImportdata.set(o.importdatas),this.page.set(o.pagination.page),this.pageCount.set(o.pagination.pageCount),this.total.set(o.pagination.total),this.pageSize.set(o.pagination.pageSize))}})}updateImportdata(e){return c(this,null,function*(){try{let a={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(e)},i=yield fetch(`${k.APIURL}/importdata/${e.id}`,a);i.ok||this.handleError(i.status);let t=yield i.json();this.getAllImportdata(this.pageSize()),this.getImportdataBy({id:t.id,isOne:!0},this.pageSize())}catch(a){this._ErrorLogService.logError("Failed to updateImportdata",a),console.error(a)}})}DeleteImportdata(e){return c(this,null,function*(){try{let a={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},i=yield fetch(`${k.APIURL}/importdata/${e.id}`,a);i.ok||this.handleError(i.status),this.getAllImportdata(this.pageSize())}catch(a){this._ErrorLogService.logError("Failed to DeleteImportdata",a),console.error(a)}})}handleError(e){let a="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(e){case 400:a="Th\xF4ng tin \u0111\xE3 t\u1ED3n t\u1EA1i";break;case 401:case 404:a="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:a="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:a="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}this._snackBar.open(a,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}static \u0275fac=function(a){return new(a||h)(B(it),B(H),B(ut),B(F))};static \u0275prov=T({token:h,factory:h.\u0275fac,providedIn:"root"})};var l=jt(Ht());var Ft=["drawer"];function Yt(h,e){if(h&1&&(m(0,"div",15)(1,"span",16),f(2),d(),m(3,"span"),f(4),d(),m(5,"span",17),f(6),d()()),h&2){let a=e.$implicit;L(2),x(a.type),L(2),x(a.title),L(2),x(a.description)}}function Gt(h,e){h&1&&(m(0,"mat-icon"),f(1,"check"),d())}function $t(h,e){if(h&1){let a=$();m(0,"span",18),C("click",function(){let t=_(a).$implicit,o=R();return I(o.toggleItem(t))}),N(1,Gt,2,0,"mat-icon",19),m(2,"span"),f(3),d()()}if(h&2){let a=e.$implicit,i=R();V("",i.CheckItem(a)?"bg-blue-100":""," cursor-pointer flex flex-row space-x-2 items-center p-4 rounded-lg border"),L(),M("ngIf",i.CheckItem(a)),L(2),x(a.title)}}var Nt=class h{displayedColumns=[];ColumnName={stt:"#",codeId:"Code",name:"Ti\xEAu \u0110\u1EC1",group:"Nh\xF3m",description:"M\xF4 T\u1EA3",status:"Tr\u1EA1ng Th\xE1i",order:"Th\u1EE9 T\u1EF1",createdAt:"Ng\xE0y T\u1EA1o",updatedAt:"Ng\xE0y C\u1EADp Nh\u1EADt"};FilterColumns=JSON.parse(localStorage.getItem("ImportdataColFilter")||"[]");Columns=[];paginator;sort;drawer;_BanggiaService=p(vt);_SanphamService=p(Bt);_KhachhangService=p(Dt);_NhacungcapService=p(Pt);_DonhangService=p(St);_DathangService=p(Et);_PhieukhoService=p(xt);_KhoService=p(At);_ImportdataService=p(Y);_breakpointObserver=p(Z);_GoogleSheetService=p(_t);_router=p(H);_dialog=p(ht);_snackBar=p(O);ListImportType=y([{id:1,title:"S\u1EA3n Ph\u1EA9m",value:"sanpham",status:!0},{id:2,title:"Kh\xE1ch H\xE0ng",value:"khachhang",status:!0},{id:3,title:"Nh\xE0 Cung C\u1EA5p",value:"nhacungcap",status:!0},{id:4,title:"B\u1EA3ng Gi\xE1",value:"banggia",status:!0},{id:5,title:"\u0110\u01A1n H\xE0ng",value:"donhang",status:!0},{id:6,title:"\u0110\u1EB7t H\xE0ng",value:"dathang",status:!0},{id:7,title:"B\u1EA3ng Gi\xE1 Kh\xE1ch H\xE0ng",value:"banggiakhachhang",status:!0},{id:8,title:"B\u1EA3ng Gi\xE1 S\u1EA3n Ph\u1EA9m",value:"banggiasanpham",status:!0},{id:9,title:"Nh\xE0 Cung C\u1EA5p S\u1EA3n Ph\u1EA9m",value:"nhacungcapsanpham",status:!0},{id:10,title:"Xu\u1EA5t Nh\u1EADp T\u1ED3n",value:"xuatnhapton",status:!0}]);ListEdit=y([]);ListImportdata=this._ImportdataService.ListImportdata;TitleExport="export";rawListSP=[];rawListKH=[];rawListNCC=[];rawListBG=[];rawListDH=[];rawListDathang=[];rawListTonkho=[];constructor(){Q(()=>c(this,null,function*(){yield this._ImportdataService.getAllImportdata(100,!0),yield this._SanphamService.getAllSanpham(),this.rawListSP=this._SanphamService.ListSanpham(),yield this._KhachhangService.getAllKhachhang(),this.rawListKH=this._KhachhangService.ListKhachhang(),yield this._NhacungcapService.getAllNhacungcap(),this.rawListNCC=this._NhacungcapService.ListNhacungcap(),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),yield this._DonhangService.getAllDonhang(),this.rawListDH=this._DonhangService.ListDonhang(),yield this._DathangService.getAllDathang(),this.rawListDathang=this._DathangService.ListDathang(),yield this._KhoService.getTonKho("1","1000").then(e=>{this.rawListTonkho=e.data})}))}ngOnInit(){return c(this,null,function*(){yield this._ImportdataService.getAllImportdata(100,!0),console.log(this.ListImportdata()),yield this._SanphamService.getAllSanpham(),this.rawListSP=this._SanphamService.ListSanpham(),yield this._KhachhangService.getAllKhachhang(),this.rawListKH=this._KhachhangService.ListKhachhang(),yield this._NhacungcapService.getAllNhacungcap(),this.rawListNCC=this._NhacungcapService.ListNhacungcap(),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),yield this._DonhangService.getAllDonhang(),this.rawListDH=this._DonhangService.ListDonhang(),yield this._DathangService.getAllDathang(),this.rawListDathang=this._DathangService.ListDathang(),yield this._KhoService.getTonKho("1","1000").then(e=>{this.rawListTonkho=e.data})})}applyFilter(e){}toggleAll(){this.ListEdit().length===this.ListImportType().length?(this.ListEdit.set([]),this.TitleExport="export"):(this.ListEdit.set(this.ListImportType()),this.TitleExport="export_all")}toggleItem(e){this.ListEdit().findIndex(i=>i.id===e.id)===-1?(this.TitleExport+="_"+e.value,this.ListEdit.update(i=>[...i,e])):(this.TitleExport=this.TitleExport.replace("_"+e.value,""),this.ListEdit.update(i=>i.filter(t=>t.id!==e.id)))}CheckItem(e){return this.ListEdit().findIndex(i=>i.id===e.id)!==-1}ExportExcel(e){return c(this,null,function*(){let a=Array.isArray(this.rawListSP)&&this.rawListSP.length?this.rawListSP.map(n=>({masp:n.masp,subtitle:n.subtitle,title:n.title,title2:n.title2,giaban:n.giaban,giagoc:n.giagoc,dvt:n.dvt,haohut:n.haohut,ghichu:n.ghichu})):[{masp:"",subtitle:"",title:"",title2:"",giaban:"",giagoc:"",dvt:"",haohut:"",ghichu:""}],i=Array.isArray(this.rawListKH)&&this.rawListKH.length?this.rawListKH.map(n=>({name:n.name?.trim()||"",makh:n.makh?.trim()||"",namenn:n.namenn?.trim()||"",diachi:n.diachi?.trim()||"",quan:n.quan?.trim()||"",email:n.email?.trim()||"",sdt:n.sdt?.toString().trim()||"",mst:n.mst?.toString().trim()||"",gionhanhang:n.gionhanhang?.toString().trim()||"",loaikh:n.loaikh?.toString().trim()||"khachsi",hiengia:n.hiengia||!0,ghichu:n.ghichu?.toString().trim()||""})):[{name:"",makh:"",namenn:"",diachi:"",quan:"",email:"",sdt:"",mst:"",gionhanhang:"",loaikh:"khachsi",hiengia:!0,ghichu:""}],t=Array.isArray(this.rawListNCC)&&this.rawListNCC.length>0?this.rawListNCC.map(n=>({name:n.name?.trim()||"",mancc:n.mancc?.trim()||"",diachi:n.diachi?.trim()||"",email:n.email?.trim()||"",sdt:n.sdt?.toString().trim()||"",ghichu:n.ghichu?.toString().trim()||""})):[{name:"",mancc:"",diachi:"",email:"",sdt:"",ghichu:""}],o=Array.isArray(this.rawListBG)&&this.rawListBG.length>0?this.rawListBG.map(n=>({title:n.title?.trim()||"",mabanggia:n.mabanggia?.trim()||"",type:n.type?.trim()||"",batdau:n.batdau?.trim()||"",ketthuc:n.ketthuc?.trim()||"",ghichu:n.ghichu?.trim()||"",status:n.status?.trim()||""})):[{title:"",mabanggia:"",type:"",batdau:"",ketthuc:"",ghichu:"",status:""}],s=Array.isArray(this.rawListDH)&&this.rawListDH.length>0?this.rawListDH.flatMap(n=>Array.isArray(n.sanpham)?n.sanpham.map(r=>({ngaygiao:(0,l.default)(n.ngaygiao).format("DD/MM/YYYY"),makh:n.khachhang?.makh,name:n.khachhang?.name,mabanggia:n.khachhang?.banggia?.[0]?.mabanggia,masp:r.masp,tensp:r.title,sldat:r.sldat,slgiao:r.slgiao,slnhan:r.slnhan,ghichu:r.ghichu})):[]):[{ngaygiao:(0,l.default)().format("DD/MM/YYYY"),makh:"",mabanggia:"",masp:"",tensp:"",sldat:0,slgiao:0,slnhan:0,ghichu:""}],u=Array.isArray(this.rawListDathang)&&this.rawListDathang.length>0?this.rawListDathang.flatMap(n=>Array.isArray(n.sanpham)?n.sanpham.map(r=>({ngaynhan:(0,l.default)(n.ngaynhan).format("DD/MM/YYYY"),mancc:n.nhacungcap?.mancc,name:n.nhacungcap?.name,mabanggia:n.banggia?.[0]?.mabanggia,masp:r.masp,tensp:r.title,sldat:r.sldat,slgiao:r.slgiao,slnhan:r.slnhan,ghichu:r.ghichu})):[]):[{ngaynhan:(0,l.default)().format("DD/MM/YYYY"),mancc:"",name:"",mabanggia:"",masp:"",tensp:"",sldat:0,slgiao:0,slnhan:0,ghichu:""}],g=this.convertBGSPToExport(this.rawListBG,this.rawListSP),b=this.rawListKH.map(n=>{let r={makh:n.makh||"",name:n.name||""},D=1;for(let P of this.rawListBG)n.banggia?.some(G=>G.mabanggia===P.mabanggia)&&(r[D]=P.mabanggia,D++);return r}),E=this.rawListSP.reduce((n,r)=>(r&&r.masp&&(n[r.masp]=""),n),{}),Mt=this.rawListNCC.map(n=>{let r={mancc:n.mancc||"",name:n.name||""},D=1;for(let P of Object.keys(E))n.Sanpham?.some(G=>G.masp===P)&&(r[D]=P,D++);return r}),zt=this.rawListTonkho.map(n=>({masp:n.masp,title:n.title,dvt:n.dvt,slton:n.slton})),S={};if(this.ListEdit().some(n=>n.value==="sanpham")&&(S.sanpham={data:a}),this.ListEdit().some(n=>n.value==="khachhang")&&(S.khachhang={data:i}),this.ListEdit().some(n=>n.value==="nhacungcap")&&(S.nhacungcap={data:t}),this.ListEdit().some(n=>n.value==="banggia")&&(S.banggia={data:o}),this.ListEdit().some(n=>n.value==="donhang")&&(S.donhang={data:s}),this.ListEdit().some(n=>n.value==="dathang")&&(S.dathang={data:u}),this.ListEdit().some(n=>n.value==="banggiasanpham")&&(S.banggiasanpham={data:g}),this.ListEdit().some(n=>n.value==="banggiakhachhang")&&(S.banggiakhachhang={data:b}),this.ListEdit().some(n=>n.value==="nhacungcapsanpham")&&(S.nhacungcapsanpham={data:Mt}),this.ListEdit().some(n=>n.value==="xuatnhapton")&&(S.xuatnhapton={data:zt}),Object.keys(S).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});return}It(S,e)})}convertBGSPToExport(e,a){let i=new Set(e.map(t=>t.mabanggia));return a.map(t=>w({masp:t.masp,title:t.title,giaban:t.giaban.toString()},Array.from(i).reduce((o,s)=>(o[s]=t.giaban.toString(),o),{})))}convertBGSPToImport(e){return!e||e.length===0?[]:Object.keys(e[0]).filter(t=>!["masp","title","giagoc"].includes(t)).map(t=>({mabanggia:t,title:`B\u1EA3ng gi\xE1 ${t.replace("BG","")}`,sanpham:e.map(o=>({masp:o.masp,title:o.title,giagoc:o.giagoc,giaban:o[t]||0}))}))}convertBHKHToImport(e){if(!e||e.length===0)return[];let a=Object.keys(e[0]).filter(i=>!["makh","name"].includes(i));return e.forEach(i=>{i.banggia=[];for(let t of a)i[t]!==void 0&&i[t]!==null&&i[t]!==""&&i.banggia.push(i[t]),delete i[t]}),e}convertNCCSPToImport(e){if(!e||e.length===0)return[];let a=Object.keys(e[0]).filter(i=>!["mancc","name"].includes(i));return e.forEach(i=>{i.Sanpham=[];for(let t of a)i[t]!==void 0&&i[t]!==null&&i[t]!==""&&i.Sanpham.push(i[t]),delete i[t]}),e}ImportExcel(e){return c(this,null,function*(){let a=yield Ct(e);this.DoImportData(a)})}DoImportData(e){return c(this,null,function*(){if(Object.keys(this.ListEdit()).length===0){this._snackBar.open("Ch\u01B0a Ch\u1ECDn Lo\u1EA1i D\u1EEF Li\u1EC7u","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});return}if(Object.keys(e).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 nh\u1EADp","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});return}if(e.sanpham&&e.sanpham.length>0&&this.ListEdit().some(a=>a.value==="sanpham")){let a=(e.sanpham||[]).map(t=>({masp:t.masp,subtitle:t.subtitle.toString(),title:t.title,title2:t.title2,giaban:Number(t.giaban)||Number(t.giagoc)||0,giagoc:Number(t.giagoc)||0,dvt:t.dvt,haohut:Number(t.haohut)||0,ghichu:t.ghichu})).filter(t=>t.masp!==void 0&&t.masp!==null&&t.masp!==""),i=this._snackBar.open("\u0110ang import S\u1EA3n ph\u1EA9m...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._SanphamService.ImportSanpham(a),i.dismiss(),this._snackBar.open("Import S\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.khachhang&&e.khachhang.length>0&&this.ListEdit().some(a=>a.value==="khachhang")){let a=(e.khachhang||[]).map(t=>({name:t.name,makh:t.makh,namenn:t.namenn,diachi:t.diachi,quan:t.quan,email:t.email,sdt:t.sdt.toString(),mst:t.mst.toString(),gionhanhang:t.gionhanhang.toString(),loaikh:t.loaikh,ghichu:t.ghichu})).filter(t=>t.makh!==void 0&&t.makh!==null&&t.makh!==""),i=this._snackBar.open("\u0110ang import Kh\xE1ch h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._KhachhangService.ImportKhachhang(a),i.dismiss(),this._snackBar.open("Import Kh\xE1ch h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.nhacungcap&&e.nhacungcap.length>0&&this.ListEdit().some(a=>a.value==="nhacungcap")){let a=(e.nhacungcap||[]).map(t=>({name:t.name,mancc:t.mancc,diachi:t.diachi,email:t.email,sdt:t.sdt.toString(),ghichu:t.ghichu})).filter(t=>t.mancc!==void 0&&t.mancc!==null&&t.mancc!==""),i=this._snackBar.open("\u0110ang import Nh\xE0 cung c\u1EA5p...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._NhacungcapService.ImportNhacungcap(a),i.dismiss(),this._snackBar.open("Import Nh\xE0 cung c\u1EA5p th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.banggia&&e.banggia.length>0&&this.ListEdit().some(a=>a.value==="banggia")){let a=(e.banggia||[]).map(t=>({title:"B\u1EA3ng Gi\xE1 "+t.mabanggia,mabanggia:t.mabanggia,type:t.type,batdau:(0,l.default)(A(t.batdau)).toDate(),ketthuc:(0,l.default)(A(t.ketthuc)).toDate(),ghichu:t.ghichu,status:t.status})).filter(t=>t.mabanggia!==void 0&&t.mabanggia!==null&&t.mabanggia!==""),i=this._snackBar.open("\u0110ang import B\u1EA3ng gi\xE1...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._BanggiaService.ImportBanggia(a),i.dismiss(),this._snackBar.open("Import B\u1EA3ng gi\xE1 th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.donhang&&e.donhang.length>0&&this.ListEdit().some(a=>a.value==="donhang")){let a=(e.donhang||[]).map(t=>({ngay:t.ngay,makh:t.makh,mabangia:t.mabangia,masp:t.masp,sldat:Number(t.sldat),slgiao:Number(t.slgiao),slnhan:Number(t.slnhan),ghichu:t.ghichu})).filter(t=>t.makh!==void 0&&t.makh!==null&&t.makh!==""&&t.masp!==void 0&&t.masp!==null&&t.masp!==""),i=this._snackBar.open("\u0110ang import \u0110\u01A1n h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DonhangService.ImportDonhang(a),i.dismiss(),this._snackBar.open("Import \u0110\u01A1n h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.banggiasanpham&&e.banggiasanpham.length>0&&this.ListEdit().some(a=>a.value==="banggiasanpham")){let a=this.convertBGSPToImport(e.banggiasanpham);console.log(a);let i=a.find(o=>o.mabanggia==="giaban");if(!i)return;let t=a.map(o=>{if(o.mabanggia==="giaban")return o;let s=o.sanpham.map(u=>{if(u.giaban==="0"){let g=i.sanpham.find(b=>b.masp===u.masp);return v(w({},u),{giaban:g?g.giaban:u.giaban})}return u});return v(w({},o),{sanpham:s})});yield this._BanggiaService.importSPBG(t)}if(e.banggiakhachhang&&e.banggiakhachhang.length>0&&this.ListEdit().some(a=>a.value==="banggiakhachhang")){let a=this.convertBHKHToImport(e.banggiakhachhang).filter(i=>i.banggia.length>0);yield this._KhachhangService.ImportKhachhang(a),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.nhacungcapsanpham&&e.nhacungcapsanpham.length>0&&this.ListEdit().some(a=>a.value==="nhacungcapsanpham")){let a=this.convertNCCSPToImport(e.nhacungcapsanpham);console.log(a);let i=a.filter(o=>o?.Sanpham?.length>0).map(o=>v(w({},o),{Sanpham:o?.Sanpham?.map(s=>this.rawListSP.find(u=>u?.masp===s))})),t=this._snackBar.open("\u0110ang import Nh\xE0 cung c\u1EA5p s\u1EA3n ph\u1EA9m...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._NhacungcapService.ImportNhacungcap(i),t.dismiss(),this._snackBar.open("Import Nh\xE0 cung c\u1EA5p s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.xuatnhapton&&e.xuatnhapton.length>0&&this.ListEdit().some(a=>a.value==="xuatnhapton")){let a=[],i=[];e.xuatnhapton.forEach(t=>{let o=this.rawListTonkho.find(s=>s.masp===t.masp);o&&(t.slton>o.slton?a.push({sanphamId:this.rawListSP.find(s=>s.masp===t.masp).id,soluong:t.slton-o.slton}):t.slton<o.slton&&i.push({sanphamId:this.rawListSP.find(s=>s.masp===t.masp).id,soluong:o.slton-t.slton}))}),a.length>0&&this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${(0,l.default)().format("DD/MM/YYYY ")}`,type:"nhap",sanpham:a,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${(0,l.default)().format("HH:mm:ss DD/MM/YYYY ")}`,ngay:(0,l.default)()}),i.length>0&&this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${(0,l.default)().format("DD/MM/YYYY ")}`,type:"xuat",sanpham:i,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${(0,l.default)().format("HH:mm:ss DD/MM/YYYY ")}`,ngay:(0,l.default)()}),a.length===0&&i.length===0&&this._snackBar.open("Kho kh\xF4ng thay \u0111\u1ED5i","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.dathang&&this.ListEdit().some(a=>a.value==="dathang")){let a=(e.dathang||[]).map(t=>({ngaynhan:(0,l.default)(A(t.ngaynhan)).toDate(),mancc:t.mancc,mabanggia:t.mabanggia,masp:t.masp,sldat:Number(t.sldat),slgiao:Number(t.slgiao),slnhan:Number(t.slnhan),ghichu:t.ghichu}));console.log(a);let i=this._snackBar.open("\u0110ang import \u0110\u1EB7t h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DathangService.ImportDathang(a),i.dismiss(),this._snackBar.open("Import \u0110\u1EB7t h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.donhang&&this.ListEdit().some(a=>a.value==="donhang")){let a=(e.donhang||[]).map(t=>({ngaygiao:(0,l.default)(A(t.ngaygiao)).toDate(),makh:t.makh,mabanggia:t.mabanggia,masp:t.masp,sldat:Number(t.sldat),slgiao:Number(t.slgiao),slnhan:Number(t.slnhan),ghichu:t.ghichu})),i=this._snackBar.open("\u0110ang import \u0110\u01A1n h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DonhangService.ImportDonhang(a),i.dismiss(),this._snackBar.open("Import \u0110\u01A1n h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}})}trackByFn(e,a){return a.id}static \u0275fac=function(a){return new(a||h)};static \u0275cmp=U({type:h,selectors:[["app-listimportdata"]],viewQuery:function(a,i){if(a&1&&(z(yt,5),z(bt,5),z(Ft,7)),a&2){let t;K(t=j())&&(i.paginator=t.first),K(t=j())&&(i.sort=t.first),K(t=j())&&(i.drawer=t.first)}},decls:24,vars:3,consts:[["uploadfile",""],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-4"],[1,"w-full","flex","flex-col","space-y-2","p-8"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],["class","w-full flex flex-row space-x-2 items-center border p-4 rounded-lg",4,"ngFor","ngForOf"],[1,"flex","flex-col","space-y-2","p-8"],[1,"flex","flex-row","space-x-2","items-center"],["mat-flat-button","","color","primary",3,"click"],[1,"ml-1"],["type","file",1,"hidden",3,"change"],[1,"grid","grid-cols-3","gap-4"],[3,"class","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"w-full","flex","flex-row","space-x-2","items-center","border","p-4","rounded-lg"],[1,"rounded-lg","p-2","bg-blue-100"],[1,"text-sm","text-gray-600"],[3,"click"],[4,"ngIf"]],template:function(a,i){if(a&1){let t=$();m(0,"div",1)(1,"div",2)(2,"div",3)(3,"input",4),C("keyup",function(s){return _(t),I(i.applyFilter(s))}),d(),m(4,"div",5)(5,"span",6),f(6,"search"),d()()(),N(7,Yt,7,3,"div",7),d(),m(8,"div",8)(9,"div",9)(10,"button",10),C("click",function(){return _(t),I(i.ExportExcel(i.TitleExport))}),f(11," T\u1EA3i Xu\u1ED1ng "),m(12,"mat-icon",11),f(13,"download"),d()(),m(14,"button",10),C("click",function(){_(t);let s=q(21);return I(s.click())}),f(15," T\u1EA3i L\xEAn "),m(16,"mat-icon",11),f(17,"upload"),d()(),m(18,"button",10),C("click",function(){return _(t),I(i.toggleAll())}),f(19," Ch\u1ECDn T\u1EA5t C\u1EA3 "),d(),m(20,"input",12,0),C("change",function(s){return _(t),I(i.ImportExcel(s))}),d()(),m(22,"div",13),N(23,$t,4,5,"span",14),d()()()}a&2&&(L(7),M("ngForOf",i.ListImportdata()),L(16),M("ngForOf",i.ListImportType())("ngForTrackBy",i.trackByFn))},dependencies:[pt,gt,wt,Lt,kt,st,et,ot,nt,at,tt,mt,W,J,X,rt,ft,ct],encapsulation:2,changeDetection:0})};export{Y as a,Nt as b};
