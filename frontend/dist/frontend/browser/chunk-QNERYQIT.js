import{a as Tt}from"./chunk-V34IPPTB.js";import{a as Nt}from"./chunk-WONT2R6A.js";import{a as Pt}from"./chunk-CRE5BS6I.js";import{a as xt}from"./chunk-O65RKRHS.js";import{a as Et}from"./chunk-N32XMGWZ.js";import{a as Bt}from"./chunk-N2U5MSBT.js";import{a as Dt}from"./chunk-DZVZNLOS.js";import{a as At}from"./chunk-ZCCBWMWK.js";import{a as ut}from"./chunk-4ZVJO4SQ.js";import{a as wt,f as It,g as A}from"./chunk-AK2HFJI2.js";import{a as Ct}from"./chunk-Q5FTU75I.js";import{b as ft,c as yt,d as bt,e as kt,g as _t,w as Lt}from"./chunk-WWB4WHUG.js";import{a as St}from"./chunk-UBXPXHNZ.js";import{c as ct,h as gt}from"./chunk-2G7ERXZL.js";import{a as H}from"./chunk-ZW44ZSN2.js";import{c as ot}from"./chunk-NJKT2VL6.js";import{b as dt}from"./chunk-KMKBUXPR.js";import{a as vt}from"./chunk-AU4REOLN.js";import{a as Ft}from"./chunk-JNVUT6FC.js";import{d as ht}from"./chunk-G4LL5VCW.js";import{a as rt,b as st}from"./chunk-ICUFHBRR.js";import{n as pt,v as mt,y as lt}from"./chunk-VHS3IPDU.js";import{a as _}from"./chunk-VUZTNYK4.js";import{a as Y,b as nt}from"./chunk-REAWTH4A.js";import{a as it,e as et}from"./chunk-JPSOFPPM.js";import{y as at}from"./chunk-NQNNJGTR.js";import{c as K}from"./chunk-CESPK7AW.js";import{l as W,m as Z,u as tt}from"./chunk-VXEGRUUB.js";import{Cc as O,Dc as S,Eb as V,Ec as x,Lb as P,Ra as y,Vb as B,Wc as J,Zb as U,dc as g,ec as d,gc as q,hc as Q,ia as R,jc as F,jd as X,na as E,oa as c,oc as C,qc as T,rb as k,wc as N,xa as w,xc as M,ya as I,yc as z}from"./chunk-PRJD77D5.js";import{a as L,b as v,g as jt,j as p}from"./chunk-6DYNGEAS.js";var j=class h{constructor(e,a,i,t){this._StorageService=e;this.router=a;this._ErrorLogService=i;this._sharedSocketService=t;this.socket=this._sharedSocketService.getSocket(),this.listenImportdataUpdates()}socket;_snackBar=c(Y);ListImportdata=y([]);DetailImportdata=y({});page=y(1);pageCount=y(1);total=y(0);pageSize=y(10);importdataId=y(null);initDB(){return p(this,null,function*(){return yield ut("ImportdataDB",4,{upgrade(e,a){a<1&&e.createObjectStore("importdatas",{keyPath:"id"}),a<3&&(e.objectStoreNames.contains("importdatas")&&e.deleteObjectStore("importdatas"),e.objectStoreNames.contains("pagination")&&e.deleteObjectStore("pagination"),e.createObjectStore("importdatas",{keyPath:"id"})),a<4}})})}saveImportdatas(e,a){return p(this,null,function*(){let t=(yield this.initDB()).transaction("importdatas","readwrite"),o=t.objectStore("importdatas");yield o.clear(),yield o.put({id:"data",importdatas:e,pagination:a}),yield t.done})}getCachedData(){return p(this,null,function*(){let a=yield(yield this.initDB()).get("importdatas","data");return a&&a.importdatas?{importdatas:a.importdatas,pagination:a.pagination||{page:1,pageCount:1,total:a.importdatas.length,pageSize:10}}:{importdatas:[],pagination:{page:1,pageCount:1,total:0,pageSize:10}}})}setImportdataId(e){this.importdataId.set(e)}CreateImportdata(e){return p(this,null,function*(){try{let a={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(e)},i=yield fetch(`${_.APIURL}/importdata`,a);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);let t=yield i.json();this.getAllImportdata(this.pageSize()),this.importdataId.set(t.id)}catch(a){this._ErrorLogService.logError("Failed to CreateImportdata",a),console.error(a)}})}getAllImportdata(){return p(this,arguments,function*(e=this.pageSize(),a=!1){this.pageSize.set(e);let i=yield this.getCachedData(),t=this._StorageService.getItem("importdatas_updatedAt")||"0";if(!a&&i.importdatas.length>0&&Date.now()-new Date(t).getTime()<5*60*1e3)return this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas;try{let o={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}};if(!a){let b=yield fetch(`${_.APIURL}/importdata/lastupdated`,o);if(!b.ok)return this.handleError(b.status),this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas;let{updatedAt:D}=yield b.json();if(D<=t)return this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas}let r=new URLSearchParams({page:this.page().toString(),limit:e.toString()}),u=yield fetch(`${_.APIURL}/importdata?${r}`,o);if(!u.ok)return this.handleError(u.status),this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas;let l=yield u.json();if(yield this.saveImportdatas(l.data,{page:l.page||1,pageCount:l.pageCount||1,total:l.total||l.data.length,pageSize:e}),a)this._StorageService.setItem("importdatas_updatedAt",new Date().toISOString());else{let b=yield fetch(`${_.APIURL}/importdata/lastupdated`,o),{updatedAt:D}=yield b.json();this._StorageService.setItem("importdatas_updatedAt",D)}return this.ListImportdata.set(l.data),this.page.set(l.page||1),this.pageCount.set(l.pageCount||1),this.total.set(l.total||l.data.length),this.pageSize.set(e),l.data}catch(o){return this._ErrorLogService.logError("Failed to getAllImportdata",o),console.error(o),this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas}})}getUpdatedCodeIds(){return p(this,null,function*(){try{let e={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},a=yield fetch(`${_.APIURL}/importdata/updateCodeIds`,e);a.ok||this.handleError(a.status);let i=yield a.json();return this.getAllImportdata(this.pageSize()),i.data}catch(e){this._ErrorLogService.logError("Failed to getUpdatedCodeIds",e),console.error(e)}})}listenImportdataUpdates(){this.socket.off("importdata-updated"),this.socket.on("importdata-updated",()=>p(this,null,function*(){console.log("\u{1F504} D\u1EEF li\u1EC7u s\u1EA3n ph\u1EA9m thay \u0111\u1ED5i, c\u1EADp nh\u1EADt l\u1EA1i cache..."),this._StorageService.removeItem("importdatas_updatedAt"),yield this.getAllImportdata()}))}getImportdataBy(i){return p(this,arguments,function*(e,a=this.pageSize()){this.pageSize.set(a);try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(v(L({},e),{page:this.page(),limit:a}))},o=yield fetch(`${_.APIURL}/importdata/findby`,t);o.ok||this.handleError(o.status);let r=yield o.json();e.isOne===!0?this.DetailImportdata.set(r):(yield this.saveImportdatas(r.data,{page:r.page||1,pageCount:r.pageCount||1,total:r.total||r.data.length,pageSize:a}),this._StorageService.setItem("importdatas_updatedAt",new Date().toISOString()),this.ListImportdata.set(r.data),this.page.set(r.page||1),this.pageCount.set(r.pageCount||1),this.total.set(r.total||r.data.length),this.pageSize.set(a))}catch(t){this._ErrorLogService.logError("Failed to getImportdataBy",t),console.error(t);let o=yield this.getCachedData();e.isOne||(this.ListImportdata.set(o.importdatas),this.page.set(o.pagination.page),this.pageCount.set(o.pagination.pageCount),this.total.set(o.pagination.total),this.pageSize.set(o.pagination.pageSize))}})}updateImportdata(e){return p(this,null,function*(){try{let a={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(e)},i=yield fetch(`${_.APIURL}/importdata/${e.id}`,a);i.ok||this.handleError(i.status);let t=yield i.json();this.getAllImportdata(this.pageSize()),this.getImportdataBy({id:t.id,isOne:!0},this.pageSize())}catch(a){this._ErrorLogService.logError("Failed to updateImportdata",a),console.error(a)}})}DeleteImportdata(e){return p(this,null,function*(){try{let a={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},i=yield fetch(`${_.APIURL}/importdata/${e.id}`,a);i.ok||this.handleError(i.status),this.getAllImportdata(this.pageSize())}catch(a){this._ErrorLogService.logError("Failed to DeleteImportdata",a),console.error(a)}})}handleError(e){let a="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(e){case 400:a="Th\xF4ng tin \u0111\xE3 t\u1ED3n t\u1EA1i";break;case 401:case 404:a="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:a="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:a="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}this._snackBar.open(a,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}static \u0275fac=function(a){return new(a||h)(E(nt),E(K),E(St),E(Dt))};static \u0275prov=R({token:h,factory:h.\u0275fac,providedIn:"root"})};var m=jt(Ft());var Ht=["drawer"];function Gt(h,e){if(h&1&&(g(0,"div",17)(1,"span",18),S(2),d(),g(3,"span"),S(4),d(),g(5,"span",19),S(6),d()()),h&2){let a=e.$implicit;k(2),x(a.type),k(2),x(a.title),k(2),x(a.description)}}function $t(h,e){if(h&1&&(q(0),P(1,Gt,7,3,"div",16),Q()),h&2){let a=T();k(),B("ngForOf",a.ListImportdata())}}function Rt(h,e){h&1&&(g(0,"div",20)(1,"span",21),S(2,"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),d()())}function Vt(h,e){h&1&&(g(0,"mat-icon"),S(1,"check"),d())}function Ut(h,e){if(h&1){let a=F();g(0,"span",22),C("click",function(){let t=w(a).$implicit,o=T();return I(o.toggleItem(t))}),P(1,Vt,2,0,"mat-icon",23),g(2,"span"),S(3),d()()}if(h&2){let a=e.$implicit,i=T();U("",i.CheckItem(a)?"bg-blue-100":""," cursor-pointer flex flex-row space-x-2 items-center p-4 rounded-lg border"),k(),B("ngIf",i.CheckItem(a)),k(2),x(a.title)}}var Mt=class h{displayedColumns=[];ColumnName={stt:"#",codeId:"Code",name:"Ti\xEAu \u0110\u1EC1",group:"Nh\xF3m",description:"M\xF4 T\u1EA3",status:"Tr\u1EA1ng Th\xE1i",order:"Th\u1EE9 T\u1EF1",createdAt:"Ng\xE0y T\u1EA1o",updatedAt:"Ng\xE0y C\u1EADp Nh\u1EADt"};FilterColumns=JSON.parse(localStorage.getItem("ImportdataColFilter")||"[]");Columns=[];paginator;sort;drawer;_BanggiaService=c(Et);_SanphamService=c(At);_KhachhangService=c(Bt);_NhacungcapService=c(xt);_DonhangService=c(vt);_DathangService=c(Pt);_PhieukhoService=c(Tt);_KhoService=c(Nt);_ImportdataService=c(j);_breakpointObserver=c(at);_GoogleSheetService=c(Ct);_router=c(K);_dialog=c(ct);_snackBar=c(Y);ListImportType=y([{id:1,title:"S\u1EA3n Ph\u1EA9m",value:"sanpham",status:!0},{id:2,title:"Kh\xE1ch H\xE0ng",value:"khachhang",status:!0},{id:3,title:"Nh\xE0 Cung C\u1EA5p",value:"nhacungcap",status:!0},{id:4,title:"B\u1EA3ng Gi\xE1",value:"banggia",status:!0},{id:5,title:"\u0110\u01A1n H\xE0ng",value:"donhang",status:!0},{id:6,title:"\u0110\u1EB7t H\xE0ng",value:"dathang",status:!0},{id:7,title:"B\u1EA3ng Gi\xE1 Kh\xE1ch H\xE0ng",value:"banggiakhachhang",status:!0},{id:8,title:"B\u1EA3ng Gi\xE1 S\u1EA3n Ph\u1EA9m",value:"banggiasanpham",status:!0},{id:9,title:"Nh\xE0 Cung C\u1EA5p S\u1EA3n Ph\u1EA9m",value:"nhacungcapsanpham",status:!0},{id:10,title:"Xu\u1EA5t Nh\u1EADp T\u1ED3n",value:"xuatnhapton",status:!0}]);ListEdit=y([]);ListImportdata=this._ImportdataService.ListImportdata;TitleExport="export";rawListSP=[];rawListKH=[];rawListNCC=[];rawListBG=[];rawListDH=[];rawListDathang=[];rawListTonkho=[];constructor(){X(()=>p(this,null,function*(){yield this._ImportdataService.getAllImportdata(100,!0),yield this._SanphamService.getAllSanpham({pageSize:9999},!0),this.rawListSP=this._SanphamService.ListSanpham(),yield this._KhachhangService.getAllKhachhang({pageSize:9999},!0),this.rawListKH=this._KhachhangService.ListKhachhang(),yield this._NhacungcapService.getAllNhacungcap(),this.rawListNCC=this._NhacungcapService.ListNhacungcap(),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),yield this._DonhangService.getAllDonhang(),this.rawListDH=this._DonhangService.ListDonhang(),yield this._DathangService.getAllDathang(),this.rawListDathang=this._DathangService.ListDathang(),yield this._KhoService.getTonKho("1","1000").then(e=>{this.rawListTonkho=e.data})}))}ngOnInit(){return p(this,null,function*(){yield this._ImportdataService.getAllImportdata(100,!0),yield this._SanphamService.getAllSanpham(),this.rawListSP=this._SanphamService.ListSanpham(),yield this._KhachhangService.getAllKhachhang(),this.rawListKH=this._KhachhangService.ListKhachhang(),yield this._NhacungcapService.getAllNhacungcap(),this.rawListNCC=this._NhacungcapService.ListNhacungcap(),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),yield this._DonhangService.getAllDonhang(),this.rawListDH=this._DonhangService.ListDonhang(),yield this._DathangService.getAllDathang(),this.rawListDathang=this._DathangService.ListDathang(),yield this._KhoService.getTonKho("1","1000").then(e=>{this.rawListTonkho=e.data})})}applyFilter(e){}toggleAll(){this.ListEdit().length===this.ListImportType().length?(this.ListEdit.set([]),this.TitleExport="export"):(this.ListEdit.set(this.ListImportType()),this.TitleExport="export_all")}toggleItem(e){this.ListEdit().findIndex(i=>i.id===e.id)===-1?(this.TitleExport+="_"+e.value,this.ListEdit.update(i=>[...i,e])):(this.TitleExport=this.TitleExport.replace("_"+e.value,""),this.ListEdit.update(i=>i.filter(t=>t.id!==e.id)))}CheckItem(e){return this.ListEdit().findIndex(i=>i.id===e.id)!==-1}ExportExcel(e){return p(this,null,function*(){let a=Array.isArray(this.rawListSP)&&this.rawListSP.length?this.rawListSP.map(n=>({masp:n.masp,subtitle:n.subtitle,title:n.title,title2:n.title2,giaban:n.giaban,giagoc:n.giagoc,dvt:n.dvt,haohut:n.haohut,ghichu:n.ghichu})):[{masp:"",subtitle:"",title:"",title2:"",giaban:"",giagoc:"",dvt:"",haohut:"",ghichu:""}],i=Array.isArray(this.rawListKH)&&this.rawListKH.length?this.rawListKH.map(n=>({name:n.name?.trim()||"",makh:n.makh?.trim()||"",namenn:n.namenn?.trim()||"",mabanggia:n.banggia?.mabanggia?.trim()||"",diachi:n.diachi?.trim()||"",quan:n.quan?.trim()||"",email:n.email?.trim()||"",sdt:n.sdt?.toString().trim()||"",mst:n.mst?.toString().trim()||"",gionhanhang:n.gionhanhang?.toString().trim()||"",loaikh:n.loaikh?.toString().trim()||"khachsi",hiengia:n.hiengia||!0,ghichu:n.ghichu?.toString().trim()||""})):[{name:"",makh:"",namenn:"",diachi:"",quan:"",email:"",sdt:"",mst:"",gionhanhang:"",loaikh:"khachsi",hiengia:!0,ghichu:""}],t=Array.isArray(this.rawListNCC)&&this.rawListNCC.length>0?this.rawListNCC.map(n=>({name:n.name?.trim()||"",mancc:n.mancc?.trim()||"",diachi:n.diachi?.trim()||"",email:n.email?.trim()||"",sdt:n.sdt?.toString().trim()||"",ghichu:n.ghichu?.toString().trim()||""})):[{name:"",mancc:"",diachi:"",email:"",sdt:"",ghichu:""}],o=Array.isArray(this.rawListBG)&&this.rawListBG.length>0?this.rawListBG.map(n=>({title:n.title?.trim()||"",mabanggia:n.mabanggia?.trim()||"",type:n.type?.trim()||"",batdau:(0,m.default)(n.batdau).format("DD/MM/YYYY")||"",ketthuc:(0,m.default)(n.ketthuc).format("DD/MM/YYYY")||"",ghichu:n.ghichu?.trim()||"",status:n.status?.trim()||""})):[{title:"",mabanggia:"",type:"",batdau:"",ketthuc:"",ghichu:"",status:""}],r=Array.isArray(this.rawListDH)&&this.rawListDH.length>0?this.rawListDH.flatMap(n=>Array.isArray(n.sanpham)?n.sanpham.map(s=>({ngaygiao:(0,m.default)(n.ngaygiao).format("DD/MM/YYYY"),makh:n.khachhang?.makh,name:n.khachhang?.name,mabanggia:n.khachhang?.banggia?.[0]?.mabanggia,masp:s.masp,tensp:s.title,sldat:s.sldat,slgiao:s.slgiao,slnhan:s.slnhan,ghichu:s.ghichu})):[]):[{ngaygiao:(0,m.default)().format("DD/MM/YYYY"),makh:"",mabanggia:"",masp:"",tensp:"",sldat:0,slgiao:0,slnhan:0,ghichu:""}],u=Array.isArray(this.rawListDathang)&&this.rawListDathang.length>0?this.rawListDathang.flatMap(n=>Array.isArray(n.sanpham)?n.sanpham.map(s=>({ngaynhan:(0,m.default)(n.ngaynhan).format("DD/MM/YYYY"),mancc:n.nhacungcap?.mancc,name:n.nhacungcap?.name,mabanggia:n.banggia?.[0]?.mabanggia,masp:s.masp,tensp:s.title,sldat:Number(s.sldat)||0,slgiao:Number(s.slgiao)||0,slnhan:Number(s.slnhan)||0,ghichu:s.ghichu})):[]):[{ngaynhan:(0,m.default)().format("DD/MM/YYYY"),mancc:"",name:"",mabanggia:"",masp:"",tensp:"",sldat:0,slgiao:0,slnhan:0,ghichu:""}],l=this.convertBGSPToExport(this.rawListBG,this.rawListSP),b=this.rawListKH.map(n=>({makh:n.makh||"",name:n.name||"",mabanggia:n.banggia?.mabanggia||""})),D=this.rawListSP.reduce((n,s)=>(s&&s.masp&&(n[s.masp]=""),n),{}),zt=this.rawListNCC.map(n=>{let s={mancc:n.mancc||"",name:n.name||""},G=1;for(let $ of Object.keys(D))n.Sanpham?.some(Yt=>Yt.masp===$)&&(s[G]=$,G++);return s}),Kt=this.rawListTonkho.map(n=>({masp:n.masp,title:n.title,dvt:n.dvt,slton:n.slton})),f={};if(this.ListEdit().some(n=>n.value==="sanpham")&&(f.sanpham={data:a}),this.ListEdit().some(n=>n.value==="khachhang")&&(f.khachhang={data:i}),this.ListEdit().some(n=>n.value==="nhacungcap")&&(f.nhacungcap={data:t}),this.ListEdit().some(n=>n.value==="banggia")&&(f.banggia={data:o}),this.ListEdit().some(n=>n.value==="donhang")&&(f.donhang={data:r}),this.ListEdit().some(n=>n.value==="dathang")&&(f.dathang={data:u}),this.ListEdit().some(n=>n.value==="banggiasanpham")&&(f.banggiasanpham={data:l}),this.ListEdit().some(n=>n.value==="banggiakhachhang")&&(f.banggiakhachhang={data:b}),this.ListEdit().some(n=>n.value==="nhacungcapsanpham")&&(f.nhacungcapsanpham={data:zt}),this.ListEdit().some(n=>n.value==="xuatnhapton")&&(f.xuatnhapton={data:Kt}),Object.keys(f).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});return}wt(f,e)})}convertBGSPToExport(e,a){let i=new Set(e.map(t=>t.mabanggia));return a.map(t=>L({masp:t.masp,title:t.title,giaban:t.giaban.toString()},Array.from(i).reduce((o,r)=>(o[r]=t.giaban.toString(),o),{})))}convertBGSPToImport(e){return!e||e.length===0?[]:Object.keys(e[0]).filter(t=>!["masp","title","giagoc"].includes(t)).map(t=>({mabanggia:t,title:`B\u1EA3ng gi\xE1 ${t.replace("BG","")}`,sanpham:e.map(o=>({masp:o.masp,title:o.title,giagoc:o.giagoc,giaban:o[t]||0}))}))}convertNCCSPToImport(e){if(!e||e.length===0)return[];let a=Object.keys(e[0]).filter(i=>!["mancc","name"].includes(i));return e.forEach(i=>{i.Sanpham=[];for(let t of a)i[t]!==void 0&&i[t]!==null&&i[t]!==""&&i.Sanpham.push(i[t]),delete i[t]}),e}ImportExcel(e){return p(this,null,function*(){let a=yield It(e);this.DoImportData(a)})}DoImportData(e){return p(this,null,function*(){if(Object.keys(this.ListEdit()).length===0){this._snackBar.open("Ch\u01B0a Ch\u1ECDn Lo\u1EA1i D\u1EEF Li\u1EC7u","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});return}if(Object.keys(e).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 nh\u1EADp","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});return}if(e.sanpham&&e.sanpham.length>0&&this.ListEdit().some(a=>a.value==="sanpham")){let a=(e.sanpham||[]).map(t=>({masp:t.masp,subtitle:H((t.title||"")+(t.title2||"")),title:t.title,title2:t.title2,giaban:Number(t.giaban)||Number(t.giagoc)||0,giagoc:Number(t.giagoc)||0,dvt:t.dvt,haohut:Number(t.haohut)||0,ghichu:t.ghichu})).filter(t=>t.masp!==void 0&&t.masp!==null&&t.masp!==""),i=this._snackBar.open("\u0110ang import S\u1EA3n ph\u1EA9m...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._SanphamService.ImportSanpham(a),i.dismiss(),this._snackBar.open("Import S\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.khachhang&&e.khachhang.length>0&&this.ListEdit().some(a=>a.value==="khachhang")){let a=(e.khachhang||[]).map(t=>({name:t.name.toString(),makh:t.makh,subtitle:H((t.name.toString()||"")+(t.namenn.toString()||"")),namenn:t.namenn.toString(),diachi:t.diachi,quan:t.quan,email:t.email,sdt:t.sdt.toString(),mst:t.mst.toString(),gionhanhang:t.gionhanhang.toString(),loaikh:t.loaikh,ghichu:t.ghichu,hiengia:t.hiengia,mabanggia:t.mabanggia})).filter(t=>t.makh!==void 0&&t.makh!==null&&t.makh!==""),i=this._snackBar.open("\u0110ang import Kh\xE1ch h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._KhachhangService.ImportKhachhang(a),i.dismiss(),this._snackBar.open("Import Kh\xE1ch h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.nhacungcap&&e.nhacungcap.length>0&&this.ListEdit().some(a=>a.value==="nhacungcap")){let a=(e.nhacungcap||[]).map(t=>({name:t.name,mancc:t.mancc,diachi:t.diachi,email:t.email,sdt:t.sdt.toString(),ghichu:t.ghichu})).filter(t=>t.mancc!==void 0&&t.mancc!==null&&t.mancc!==""),i=this._snackBar.open("\u0110ang import Nh\xE0 cung c\u1EA5p...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._NhacungcapService.ImportNhacungcap(a),i.dismiss(),this._snackBar.open("Import Nh\xE0 cung c\u1EA5p th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.banggia&&e.banggia.length>0&&this.ListEdit().some(a=>a.value==="banggia")){let a=(e.banggia||[]).map(t=>({title:"B\u1EA3ng Gi\xE1 "+t.mabanggia,mabanggia:t.mabanggia,type:t.type,batdau:(0,m.default)(A(t.batdau)).toDate(),ketthuc:(0,m.default)(A(t.ketthuc)).toDate(),ghichu:t.ghichu,status:t.status})).filter(t=>t.mabanggia!==void 0&&t.mabanggia!==null&&t.mabanggia!==""),i=this._snackBar.open("\u0110ang import B\u1EA3ng gi\xE1...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._BanggiaService.ImportBanggia(a),i.dismiss(),this._snackBar.open("Import B\u1EA3ng gi\xE1 th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.donhang&&e.donhang.length>0&&this.ListEdit().some(a=>a.value==="donhang")){let a=(e.donhang||[]).map(t=>({ngay:t.ngay,makh:t.makh,mabangia:t.mabangia,masp:t.masp,sldat:Number(t.sldat),slgiao:Number(t.slgiao),slnhan:Number(t.slnhan),ghichu:t.ghichu})).filter(t=>t.makh!==void 0&&t.makh!==null&&t.makh!==""&&t.masp!==void 0&&t.masp!==null&&t.masp!==""),i=this._snackBar.open("\u0110ang import \u0110\u01A1n h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DonhangService.ImportDonhang(a),i.dismiss(),this._snackBar.open("Import \u0110\u01A1n h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.banggiasanpham&&e.banggiasanpham.length>0&&this.ListEdit().some(a=>a.value==="banggiasanpham")){let a=this.convertBGSPToImport(e.banggiasanpham),i=a.find(o=>o.mabanggia==="giaban");if(!i)return;let t=a.map(o=>{if(o.mabanggia==="giaban")return o;let r=o.sanpham.map(u=>{if(u.giaban==="0"){let l=i.sanpham.find(b=>b.masp===u.masp);return v(L({},u),{giaban:l?l.giaban:u.giaban})}return u});return v(L({},o),{sanpham:r})});yield this._BanggiaService.importSPBG(t)}if(e.banggiakhachhang&&e.banggiakhachhang.length>0&&this.ListEdit().some(a=>a.value==="banggiakhachhang")){console.log("Importing banggiakhachhang data:",e.banggiakhachhang);let a=(e.banggiakhachhang||[]).map(i=>({makh:i.makh,name:i.name,mabanggia:i.mabanggia})).filter(i=>i.mabanggia!==void 0&&i.mabanggia!==null&&i.mabanggia!=="");console.log("Importing ListBGKH data:",a),yield this._KhachhangService.ImportKhachhang(a),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.nhacungcapsanpham&&e.nhacungcapsanpham.length>0&&this.ListEdit().some(a=>a.value==="nhacungcapsanpham")){let a=this.convertNCCSPToImport(e.nhacungcapsanpham);console.log(a);let i=a.filter(o=>o?.Sanpham?.length>0).map(o=>v(L({},o),{Sanpham:o?.Sanpham?.map(r=>this.rawListSP.find(u=>u?.masp===r))})),t=this._snackBar.open("\u0110ang import Nh\xE0 cung c\u1EA5p s\u1EA3n ph\u1EA9m...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._NhacungcapService.ImportNhacungcap(i),t.dismiss(),this._snackBar.open("Import Nh\xE0 cung c\u1EA5p s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.xuatnhapton&&e.xuatnhapton.length>0&&this.ListEdit().some(a=>a.value==="xuatnhapton")){let a=[],i=[];e.xuatnhapton.forEach(t=>{let o=this.rawListTonkho.find(r=>r.masp===t.masp);o&&(t.slton>o.slton?a.push({sanphamId:this.rawListSP.find(r=>r.masp===t.masp).id,soluong:t.slton-o.slton}):t.slton<o.slton&&i.push({sanphamId:this.rawListSP.find(r=>r.masp===t.masp).id,soluong:o.slton-t.slton}))}),a.length>0&&(yield this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${(0,m.default)().format("DD/MM/YYYY ")}`,type:"nhap",sanpham:a,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${(0,m.default)().format("HH:mm:ss DD/MM/YYYY ")}`,ngay:(0,m.default)()}),this._snackBar.open("C\u1EADp nh\u1EADt t\u1ED3n kho th\xE0nh c\xF4ng Th\xEAm phi\u1EBFu Nh\u1EADp Kho","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})),i.length>0&&(yield this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${(0,m.default)().format("DD/MM/YYYY ")}`,type:"xuat",sanpham:i,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${(0,m.default)().format("HH:mm:ss DD/MM/YYYY ")}`,ngay:(0,m.default)()}),this._snackBar.open("C\u1EADp nh\u1EADt t\u1ED3n kho th\xE0nh c\xF4ng Th\xEAm phi\u1EBFu Xu\u1EA5t Kho","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})),a.length===0&&i.length===0&&this._snackBar.open("Kho kh\xF4ng thay \u0111\u1ED5i","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.dathang&&this.ListEdit().some(a=>a.value==="dathang")){let a=(e.dathang||[]).filter(t=>t.mancc&&t.masp).map(t=>({ngaynhan:(0,m.default)(A(t.ngaynhan)).toDate(),mancc:t.mancc,mabanggia:t.mabanggia,masp:t.masp,sldat:Number(t.sldat),slgiao:Number(t.sldat),slnhan:Number(t.sldat),ghichu:t.ghichu}));console.log(a);let i=this._snackBar.open("\u0110ang import \u0110\u1EB7t h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DathangService.ImportDathang(a),i.dismiss(),this._snackBar.open("Import \u0110\u1EB7t h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.donhang&&this.ListEdit().some(a=>a.value==="donhang")){let a=(e.donhang||[]).filter(t=>t.makh&&t.masp).map(t=>({ngaygiao:(0,m.default)(A(t.ngaygiao)).toDate(),makh:t.makh,mabanggia:t.mabanggia,masp:t.masp,sldat:Number(t.sldat),slgiao:Number(t.slgiao),slnhan:Number(t.slnhan),ghichu:t.ghichu})),i=this._snackBar.open("\u0110ang import \u0110\u01A1n h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DonhangService.ImportDonhang(a),i.dismiss(),this._snackBar.open("Import \u0110\u01A1n h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}})}trackByFn(e,a){return a.id}static \u0275fac=function(a){return new(a||h)};static \u0275cmp=V({type:h,selectors:[["app-listimportdata"]],viewQuery:function(a,i){if(a&1&&(N(yt,5),N(kt,5),N(Ht,7)),a&2){let t;M(t=z())&&(i.paginator=t.first),M(t=z())&&(i.sort=t.first),M(t=z())&&(i.drawer=t.first)}},decls:26,vars:4,consts:[["noData",""],["uploadfile",""],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-4"],[1,"w-full","flex","flex-col","space-y-2","p-8"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[4,"ngIf","ngIfElse"],[1,"flex","flex-col","space-y-2","p-8"],[1,"flex","flex-row","space-x-2","items-center"],["mat-flat-button","","color","primary",3,"click"],[1,"ml-1"],["type","file",1,"hidden",3,"change"],[1,"grid","grid-cols-3","gap-4"],[3,"class","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","w-full flex flex-row space-x-2 items-center border p-4 rounded-lg",4,"ngFor","ngForOf"],[1,"w-full","flex","flex-row","space-x-2","items-center","border","p-4","rounded-lg"],[1,"rounded-lg","p-2","bg-blue-100"],[1,"text-sm","text-gray-600"],[1,"w-full","flex","flex-row","items-center","justify-center","border","p-4","rounded-lg","bg-gray-100"],[1,"text-gray-600"],[3,"click"],[4,"ngIf"]],template:function(a,i){if(a&1){let t=F();g(0,"div",2)(1,"div",3)(2,"div",4)(3,"input",5),C("keyup",function(r){return w(t),I(i.applyFilter(r))}),d(),g(4,"div",6)(5,"span",7),S(6,"search"),d()()(),P(7,$t,2,1,"ng-container",8)(8,Rt,3,0,"ng-template",null,0,J),d(),g(10,"div",9)(11,"div",10)(12,"button",11),C("click",function(){return w(t),I(i.ExportExcel(i.TitleExport))}),S(13," T\u1EA3i Xu\u1ED1ng "),g(14,"mat-icon",12),S(15,"download"),d()(),g(16,"button",11),C("click",function(){w(t);let r=O(23);return I(r.click())}),S(17," T\u1EA3i L\xEAn "),g(18,"mat-icon",12),S(19,"upload"),d()(),g(20,"button",11),C("click",function(){return w(t),I(i.toggleAll())}),S(21," Ch\u1ECDn T\u1EA5t C\u1EA3 "),d(),g(22,"input",13,1),C("change",function(r){return w(t),I(i.ImportExcel(r))}),d()(),g(24,"div",14),P(25,Ut,4,5,"span",15),d()()()}if(a&2){let t=O(9);k(7),B("ngIf",i.ListImportdata().length>0)("ngIfElse",t),k(18),B("ngForOf",i.ListImportType())("ngForTrackBy",i.trackByFn)}},dependencies:[mt,lt,Lt,_t,bt,ht,ot,st,rt,et,it,dt,tt,W,Z,pt,ft,gt],encapsulation:2,changeDetection:0})};export{j as a,Mt as b};
