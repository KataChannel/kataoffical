import{a as u}from"./chunk-JZ6BIVAZ.js";import{a as Wt}from"./chunk-VTCQHFRM.js";import{a as Jt}from"./chunk-3UJ4JCUC.js";import{a as Ut}from"./chunk-VCG4OAYA.js";import{a as Qt}from"./chunk-QH5IT2XE.js";import{a as jt}from"./chunk-SVUQNHA7.js";import{a as Gt}from"./chunk-J3ZTLHEN.js";import"./chunk-4ZVJO4SQ.js";import{a as vt}from"./chunk-RHYJKD3I.js";import{a as qt,b as zt}from"./chunk-NULFSBS2.js";import{a as $,b as Mt}from"./chunk-3FNN46PZ.js";import{a as Dt}from"./chunk-ZW44ZSN2.js";import{a as it,b as ot,c as rt}from"./chunk-OTBM7FCQ.js";import{a as ht,b as ct,c as pt,d as mt}from"./chunk-CDVLS2VJ.js";import"./chunk-3MD4EG7P.js";import{c as At,h as Kt}from"./chunk-N62VL4FK.js";import"./chunk-P7PTBZX5.js";import{a as P,b as kt,c as Et}from"./chunk-JNFQJYYE.js";import{c as dt,h as gt}from"./chunk-C6ZTKERY.js";import"./chunk-H7UDLENL.js";import{a as at}from"./chunk-TXVIVA74.js";import"./chunk-6WUPS4UK.js";import"./chunk-KZMYTDV6.js";import{k as wt}from"./chunk-GUGI676T.js";import{b as J}from"./chunk-PWU56VV4.js";import"./chunk-JNVUT6FC.js";import{a as Ft,b as Tt,c as bt,d as Lt,e as It,g as Xt,h as $t,j as Pt,k as Yt,m as Bt,n as Vt,p as Rt,q as Ht,r as Nt,s as Ot}from"./chunk-DRGFONJ6.js";import{b as xt}from"./chunk-WGYCBDOD.js";import{b as yt,c as Ct}from"./chunk-ZVLEUULZ.js";import{p as ut,t as _t,x as ft,y as St}from"./chunk-GPRU6KV3.js";import"./chunk-5HHQ5INI.js";import{a as st,b as lt}from"./chunk-5BIREHNW.js";import"./chunk-PR6DE2EA.js";import"./chunk-OB6UQ2BD.js";import"./chunk-2PPFUFFT.js";import{a as Z,b as tt,c as et,e as nt}from"./chunk-SKIRCMX2.js";import{y as U,z as W}from"./chunk-LXJDFCF2.js";import"./chunk-3QZHTKAG.js";import{l as q,m as z,s as Q,v as j,x as G}from"./chunk-KFQ5FW2D.js";import{$b as F,Cc as E,Db as H,Dc as p,Ec as b,Fc as d,Ka as R,Kb as w,Nc as K,Sc as C,Ub as y,Uc as x,bc as N,cc as B,dc as V,ec as r,fc as l,gc as M,hc as O,ic as A,kc as k,pa as D,pc as S,rb as c,rc as s,xc as L,ya as _,yc as I,za as f,zc as X}from"./chunk-WYL4U5YK.js";import"./chunk-LWLSKGAV.js";import{h as Y,j as v}from"./chunk-6DYNGEAS.js";var te=["drawer"],ee=o=>[10,25,100,o],ne=(o,e)=>e.key;function ae(o,e){if(o&1){let t=k();r(0,"button",26),S("click",function(a){let i=_(t).$implicit;return s().toggleColumn(i),f(a.stopPropagation())}),r(1,"mat-icon"),p(2),l(),r(3,"span"),p(4),l()()}if(o&2){let t=e.$implicit;c(2),b(t.isShow?"check_box":"check_box_outline_blank"),c(2),b(t.value)}}function ie(o,e){o&1&&(r(0,"span",43),p(1,"check"),l())}function oe(o,e){if(o&1&&(r(0,"span"),p(1),C(2,"date"),l()),o&2){let t=s().$implicit,n=s(2).$implicit;c(),b(x(2,1,t[n],"dd/MM/yyyy"))}}function re(o,e){if(o&1&&(r(0,"span"),p(1),C(2,"date"),l()),o&2){let t=s().$implicit,n=s(2).$implicit;c(),b(x(2,1,t[n],"dd/MM/yyyy"))}}function se(o,e){if(o&1&&(r(0,"span"),p(1),l()),o&2){let t=s().$implicit,n=s(2).$implicit;c(),d("",t[n],"%")}}function le(o,e){if(o&1&&(r(0,"span"),p(1),l()),o&2){let t=s().$implicit,n=s(2).$implicit;c(),d(" ",t[n]||"Tr\u1ED1ng","")}}function he(o,e){if(o&1){let t=k();r(0,"div",41),S("click",function(){let a=_(t).$implicit,i=s(2).$implicit,h=s();return f(h.ChosenItem(a,i))}),w(1,ie,2,0,"span",42)(2,oe,3,4,"span")(3,re,3,4,"span")(4,se,2,1,"span")(5,le,2,1,"span"),l()}if(o&2){let t,n=e.$implicit,a=s(2).$implicit,i=s();c(),y("ngIf",i.CheckItem(n)),c(),F((t=a)==="createdAt"?2:t==="updatedAt"?3:t==="haohut"?4:5)}}function ce(o,e){if(o&1){let t=k();r(0,"th",29)(1,"span",30),p(2),l(),r(3,"span",31,2),p(5," filter_alt "),l(),r(6,"mat-menu",null,1)(8,"div",32),S("click",function(a){return _(t),f(a.stopPropagation())}),r(9,"div",33)(10,"input",8),S("keyup",function(a){_(t);let i=s().$implicit,h=s();return f(h.doFilterHederColumn(a,i))}),l(),r(11,"div",9)(12,"span",10),p(13,"search"),l()()(),r(14,"div",34)(15,"div",6)(16,"span",35),S("click",function(){_(t);let a=s().$implicit,i=s();return f(i.ChosenAll(i.FilterHederColumn(i.dataSource.filteredData,a)))}),p(17),l(),r(18,"span",35),S("click",function(){_(t);let a=s(2);return f(a.EmptyFiter())}),p(19,"Xo\xE1"),l()(),r(20,"span",35),S("click",function(){_(t);let a=s(2);return f(a.ResetFilter())}),p(21,"Reset"),l()(),r(22,"div",36),w(23,he,6,2,"div",37),l(),r(24,"div",38)(25,"button",39),S("click",function(){_(t);let a=E(4);return f(a.closeMenu())}),p(26,"\u0110\xF3ng"),l(),r(27,"button",40),S("click",function(){_(t);let a=E(4),i=s(2);return f(i.ApplyFilterColum(a))}),p(28,"\xC1p D\u1EE5ng"),l()()()()()}if(o&2){let t=E(7),n=s().$implicit,a=s();c(2),d(" ",a.ColumnName[n]," "),c(),y("matMenuTriggerFor",t),c(14),d("Ch\u1ECDn T\u1EA5t C\u1EA3 ",a.FilterHederColumn(a.dataSource.filteredData,n).length||0,""),c(6),y("ngForOf",a.FilterHederColumn(a.dataSource.filteredData,n))("ngForTrackBy",a.trackByFn)}}function pe(o,e){if(o&1&&(r(0,"span",45),p(1),l()),o&2){let t=s().index;c(),d(" ",t+1," ")}}function me(o,e){if(o&1&&(r(0,"span"),p(1),C(2,"number"),l()),o&2){let t=s(2).$implicit,n=s().$implicit;c(),d(" + ",x(2,1,t[n],"1.0-2")," ")}}function ue(o,e){if(o&1&&(p(0),C(1,"number")),o&2){let t=s(2).$implicit,n=s().$implicit;d(" ",x(1,1,t[n],"1.0-2")," ")}}function de(o,e){if(o&1&&(r(0,"span",46)(1,"span",49),w(2,me,3,4,"span")(3,ue,2,4),r(4,"span",50),p(5),C(6,"number"),l()()()),o&2){let t=s().$implicit,n=s().$implicit;c(2),F(t[n]>0?2:3),c(3),d("(",x(6,2,t==null?null:t.slchonhaptt,"1.0-2"),")")}}function ge(o,e){if(o&1&&(r(0,"span"),p(1),C(2,"number"),l()),o&2){let t=s(2).$implicit,n=s().$implicit;c(),d("",x(2,1,t[n],"1.0-2")," ")}}function _e(o,e){if(o&1&&(p(0),C(1,"number")),o&2){let t=s(2).$implicit,n=s().$implicit;d(" ",x(1,1,t[n],"1.0-2")," ")}}function fe(o,e){if(o&1&&(r(0,"span",47)(1,"span",49),w(2,ge,3,4,"span")(3,_e,2,4),r(4,"span",50),p(5),C(6,"number"),l()()()),o&2){let t=s().$implicit,n=s().$implicit;c(2),F(t[n]>0?2:3),c(3),d("(",x(6,2,t==null?null:t.slchogiaott,"1.0-2"),")")}}function Se(o,e){if(o&1&&(r(0,"span",48),p(1),C(2,"date"),l()),o&2){let t=s().$implicit,n=s().$implicit;c(),d(" ",x(2,1,t[n],"HH:mm:ss dd/MM/yyyy")," ")}}function ye(o,e){o&1&&(r(0,"mat-icon",51),p(1,"check_circle"),l())}function Ce(o,e){o&1&&(r(0,"mat-icon",52),p(1,"cancel"),l())}function xe(o,e){if(o&1&&(r(0,"span",45),w(1,ye,2,0,"mat-icon",51)(2,Ce,2,0,"mat-icon",52),l()),o&2){let t=s().$implicit,n=s().$implicit;c(),F(t[n]?1:2)}}function De(o,e){if(o&1&&(r(0,"span",48),p(1),C(2,"date"),l()),o&2){let t=s().$implicit,n=s().$implicit;c(),d(" ",x(2,1,t[n],"HH:mm:ss dd/MM/yyyy")," ")}}function we(o,e){if(o&1&&(r(0,"span",45),p(1),l()),o&2){let t=s().$implicit,n=s().$implicit;c(),d(" ",t[n]," ")}}function ve(o,e){if(o&1&&(r(0,"td",44),w(1,pe,2,1,"span",45)(2,de,7,5,"span",46)(3,fe,7,5,"span",47)(4,Se,3,4,"span",48)(5,xe,3,1,"span",45)(6,De,3,4,"span",48)(7,we,2,1,"span",45),l()),o&2){let t,n=s().$implicit;c(),F((t=n)==="STT"?1:t==="slchonhap"?2:t==="slchogiao"?3:t==="ngaygiao"?4:t==="isActive"?5:t==="updatedAt"?6:7)}}function Fe(o,e){if(o&1&&(O(0,21),w(1,ce,29,5,"th",27)(2,ve,8,1,"td",28),A()),o&2){let t=e.$implicit;y("matColumnDef",t)}}function Te(o,e){o&1&&M(0,"tr",53)}function Me(o,e){o&1&&M(0,"tr",54)}function ke(o,e){o&1&&(r(0,"tr",55)(1,"td",56),p(2,"Kh\xF4ng t\xECm th\u1EA5y"),l()())}var T=class T{DexuatEmit=new R;Detail={};displayedColumns=["title","masp","dvt","slton","sltontt"];ColumnName={title:"T\xEAn s\u1EA3n ph\u1EA9m",masp:"M\xE3 s\u1EA3n ph\u1EA9m",dvt:"\u0110\u01A1n v\u1ECB t\xEDnh",slton:"SL t\u1ED3n",sltontt:"T\u1ED3n th\u1EF1c t\u1EBF Cu\u1ED1i Ng\xE0y"};FilterColumns=JSON.parse(localStorage.getItem("TonkhoColFilter")||"[]");Columns=[];isFilter=!1;paginator;sort;drawer;filterValues={};_PhieukhoService=D(Jt);_SanphamService=D(Gt);_DathangService=D(Qt);_DonhangService=D(jt);_GraphqlService=D(vt);_KhoService=D(Ut);_breakpointObserver=D(U);Xuatnhapton=this._PhieukhoService.ListPhieukho;dataSource=new Ot([]);_snackBar=D(at);CountItem=0;SearchParams={Batdau:u.format(u.now(),"YYYY-MM-DD"),Ketthuc:u.format(u.add(u.now(),1,"day"),"YYYY-MM-DD"),Type:"donsi"};ListDate=[{id:1,Title:"1 Ng\xE0y",value:"day"},{id:2,Title:"1 Tu\u1EA7n",value:"week"},{id:3,Title:"1 Th\xE1ng",value:"month"},{id:4,Title:"1 N\u0103m",value:"year"}];Chonthoigian="day";isSearch=!1;ListKho=[];constructor(){this.displayedColumns.forEach(e=>{this.filterValues[e]=""})}createFilter(){return(e,t)=>{let n=JSON.parse(t),a=!0;return this.displayedColumns.forEach(i=>{if(n[i]){let h=e[i]?e[i].toString().toLowerCase():"";a=a&&h.includes(n[i].toLowerCase())}}),a}}applyFilter(e){let t=e.target.value;this.dataSource.filter=t.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource?.paginator?.firstPage()}LoadDondathang(){return v(this,null,function*(){let e=yield this._DonhangService.getSLChogiao(this.SearchParams),t=yield this._DathangService.getSLChonhap(this.SearchParams);this.dataSource.data.forEach(n=>{let a=e.find(h=>h.idSP===n.sanphamId);a?n.slchogiaott=a.slchogiaott:n.slchogiaott=0;let i=t.find(h=>h.idSP===n.sanphamId);i?n.slchonhaptt=i.slchonhaptt:n.slchonhaptt=0}),this.dataSource.data=this.dataSource.data.filter(n=>n.slchogiaott>0||n.slchonhaptt>0),this.dataSource.sort=this.sort})}ngOnInit(){return v(this,null,function*(){this.LoadXuatnhapton(),this._KhoService.getTonKho("1","99999").then(e=>{this.Xuatnhapton.set(e.data),this.dataSource.data=this.Xuatnhapton(),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.initializeColumns(),this.setupDrawer(),this.paginator._intl.itemsPerPageLabel="S\u1ED1 l\u01B0\u1EE3ng 1 trang",this.paginator._intl.nextPageLabel="Ti\u1EBFp Theo",this.paginator._intl.previousPageLabel="V\u1EC1 Tr\u01B0\u1EDBc",this.paginator._intl.firstPageLabel="Trang \u0110\u1EA7u",this.paginator._intl.lastPageLabel="Trang Cu\u1ED1i"}),this._GraphqlService,this.CountItem=this.Xuatnhapton().length})}LoadXuatnhapton(){return v(this,null,function*(){let e=yield this._GraphqlService.findAll("tonkho",{aggressiveCache:!0,enableParallelFetch:!0,take:99999});console.log(e),this.Xuatnhapton.set(e.data)})}initializeColumns(){this.Columns=Object.keys(this.ColumnName).map(e=>({key:e,value:this.ColumnName[e],isShow:!0})),this.FilterColumns.length===0?this.FilterColumns=this.Columns:localStorage.setItem("TonkhoColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{})}setupDrawer(){this._breakpointObserver.observe([W.Handset]).subscribe(e=>{e.matches?(this.drawer.mode="over",this.paginator.hidePageSize=!0):this.drawer.mode="side"})}toggleColumn(e){let t=this.FilterColumns.find(n=>n.key===e.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("TonkhoColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(n=>n.value.toLowerCase().includes(t))}FilterHederColumn(e,t){return e.filter((a,i,h)=>i===h.findIndex(m=>m[t]===a[t]))}doFilterHederColumn(e,t){let n=e.target.value.toLowerCase();console.log(n),console.log(t),this.dataSource.filteredData=this.Xuatnhapton().filter(a=>Dt(a[t]).includes(n)||a[t].toLowerCase().includes(n))}trackByFn(e,t){return t.id}ListFilter=[];ChosenItem(e,t){let n=this.dataSource.filteredData.filter(i=>i[t]===e[t]);this.ListFilter.filter(i=>i[t]===e[t]).length>0?this.ListFilter=this.ListFilter.filter(i=>i[t]!==e[t]):this.ListFilter=[...this.ListFilter,...n]}ChosenAll(e){e.forEach(t=>{!!this.ListFilter.find(a=>a.id===t.id)?this.ListFilter=this.ListFilter.filter(a=>a.id!==a.id):this.ListFilter.push(t)})}ResetFilter(){this.ListFilter=this.Xuatnhapton(),this.dataSource.data=this.Xuatnhapton(),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}EmptyFiter(){this.ListFilter=[]}CheckItem(e){return!!this.ListFilter.find(t=>t.id===e.id)}ApplyFilterColum(e){this.dataSource.data=this.Xuatnhapton().filter(t=>this.ListFilter.some(n=>n.id===t.id)),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,e.closeMenu()}ExportExcel(e,t){return v(this,null,function*(){yield this._SanphamService.getAllSanpham();let n=this._SanphamService.ListSanpham().map(i=>({subtitle:i.subtitle,masp:i.masp,title:i.title,dvt:i.dvt})),a=this.Xuatnhapton().map(i=>({masp:i.masp,title:i.title,dvt:i.dvt,slton:i.slton}));At({SP:n,XNT:a},t)})}ImporExcel(e){return v(this,null,function*(){let t=Array.from(e.target.files),n=yield Kt(t[0],"XNT"),a=[],i=[];n.forEach(h=>{let m=this.Xuatnhapton().find(g=>g.masp===h.masp);m&&(h.slton>m.slton?a.push({sanphamId:this._SanphamService.ListSanpham().find(g=>g.masp===h.masp).id,soluong:h.slton-m.slton}):h.slton<m.slton&&i.push({sanphamId:this._SanphamService.ListSanpham().find(g=>g.masp===h.masp).id,soluong:m.slton-h.slton}))}),a.length>0&&this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${u.format(u.now(),"DD/MM/YYYY ")}`,type:"nhap",sanpham:a,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${u.format(u.now(),"HH:mm:ss DD/MM/YYYY ")}`,ngay:u.now()}),i.length>0&&this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${u.format(u.now(),"DD/MM/YYYY ")}`,type:"xuat",sanpham:i,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${u.format(u.now(),"HH:mm:ss DD/MM/YYYY ")}`,ngay:u.now()}),a.length>0&&this._snackBar.open(`\u0110i\u1EC1u ch\u1EC9nh nh\u1EADp kho v\u1EDBi ${a.length} s\u1EA3n ph\u1EA9m`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),i.length>0&&this._snackBar.open(`\u0110i\u1EC1u ch\u1EC9nh xu\u1EA5t kho v\u1EDBi ${i.length} s\u1EA3n ph\u1EA9m`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),a.length===0&&i.length===0&&this._snackBar.open("Kho kh\xF4ng thay \u0111\u1ED5i","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}_dialog=D(dt);Trangthaidon=Wt;ListDathang=[];ListDonhang=[];FilteredDathang=[];FilteredDonhang=[];dathangSortField="";dathangSortDirection="asc";selectedDathangStatus="";donhangSortField="";donhangSortDirection="asc";selectedDonhangStatus="";dathangStartDate="";dathangEndDate="";donhangStartDate="";donhangEndDate="";dathangSearchTimeout;donhangSearchTimeout;Object=Object;XemDathang(e,t){return v(this,null,function*(){this.ListDathang=yield this._DathangService.findbysanpham(e.sanphamId),console.log(this.ListDathang),this.FilteredDathang=[...this.ListDathang],this.selectedDathangStatus="",this.dathangSortField="",this.dathangSortDirection="asc",this.dathangStartDate="",this.dathangEndDate="",this._dialog.open(t,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(a=>{})})}XemDonhang(e,t){return v(this,null,function*(){this.ListDonhang=yield this._DonhangService.findbysanpham(e.sanphamId),console.log(this.ListDonhang),this.FilteredDonhang=[...this.ListDonhang],this.selectedDonhangStatus="",this.donhangSortField="",this.donhangSortDirection="asc",this.donhangStartDate="",this.donhangEndDate="",this._dialog.open(t,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(a=>{})})}TinhTong(e,t){return e?.reduce((n,a)=>n+(Number(a?.sanpham[t])||0),0)||0}gotoDexuat(){this.DexuatEmit.emit(!1)}ngOnDestroy(){this.dathangSearchTimeout&&clearTimeout(this.dathangSearchTimeout),this.donhangSearchTimeout&&clearTimeout(this.donhangSearchTimeout)}filterDathangList(e){this.dathangSearchTimeout&&clearTimeout(this.dathangSearchTimeout),this.dathangSearchTimeout=setTimeout(()=>{let t=e.target.value?.toLowerCase()||"";this.applyDathangFilters(t)},300)}filterDathangByStatus(e){this.selectedDathangStatus=e;let n=document.querySelector("#dathangSearch")?.value?.toLowerCase()||"";this.applyDathangFilters(n)}clearDathangFilter(){this.selectedDathangStatus="",this.dathangStartDate="",this.dathangEndDate="",this.dathangSortField="",this.dathangSortDirection="asc",this.applyDathangFilters("")}applyDathangFilters(e){let t=[...this.ListDathang];this.selectedDathangStatus&&(t=t.filter(n=>n.status===this.selectedDathangStatus)),(this.dathangStartDate||this.dathangEndDate)&&(t=this.applyDateRangeFilter(t,this.dathangStartDate,this.dathangEndDate)),e&&(t=this.applySearchFilter(t,e,"dathang")),this.FilteredDathang=t,this.applydathangCurrentSort()}applyDateRangeFilter(e,t,n){if(!t&&!n)return e;let a=t?new Date(t+"T00:00:00"):null,i=n?new Date(n+"T23:59:59"):null;return e.filter(h=>{let m=new Date(h.createdAt);return!(a&&m<a||i&&m>i)})}applySearchFilter(e,t,n){let a=t.toLowerCase();return e.filter(i=>(n==="dathang"?[i.title,i.madathang||i.madncc,i.khachhang?.name||i.nhacungcap?.name,i.sanpham?.sanpham?.title,this.Trangthaidon[i.status]]:[i.title,i.madonhang,i.khachhang?.name,i.sanpham?.sanpham?.title,this.Trangthaidon[i.status]]).some(m=>m?.toString().toLowerCase().includes(a)))}sortDathangData(e){this.dathangSortField===e?this.dathangSortDirection=this.dathangSortDirection==="asc"?"desc":"asc":(this.dathangSortField=e,this.dathangSortDirection="asc"),this.applydathangCurrentSort()}applydathangCurrentSort(){this.dathangSortField&&this.FilteredDathang.sort((e,t)=>{let n,a;if(this.dathangSortField.includes(".")){let h=this.dathangSortField.split(".");n=h.reduce((m,g)=>m&&m[g],e),a=h.reduce((m,g)=>m&&m[g],t)}else n=e[this.dathangSortField],a=t[this.dathangSortField];if(n==null&&a==null)return 0;if(n==null)return 1;if(a==null)return-1;n=String(n).toLowerCase(),a=String(a).toLowerCase();let i=n.localeCompare(a,"vi",{numeric:!0});return this.dathangSortDirection==="asc"?i:-i})}getDathangSortIcon(e){return this.dathangSortField!==e?"unfold_more":this.dathangSortDirection==="asc"?"keyboard_arrow_up":"keyboard_arrow_down"}exportDathangData(){if(this.FilteredDathang.length===0){alert("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t");return}let e=this.FilteredDathang.map(t=>({"Ti\xEAu \u0111\u1EC1":t.title||"","M\xE3 \u0110\u1EB7t H\xE0ng":t.madathang||"","Tr\u1EA1ng th\xE1i":this.Trangthaidon[t.status]||"","Kh\xE1ch H\xE0ng":t.khachhang?.name||"","T\xEAn S\u1EA3n Ph\u1EA9m":t.sanpham?.sanpham?.title||"","S\u1ED1 L\u01B0\u1EE3ng \u0110\u1EB7t":t.sanpham?.sldat||0,"S\u1ED1 L\u01B0\u1EE3ng Nh\u1EADn":t.sanpham?.slnhan||0,Ng\u00E0y:this.formatDate(t.createdAt)}));this.exportToExcel(e,"dathang-data")}filterDonhangList(e){this.donhangSearchTimeout&&clearTimeout(this.donhangSearchTimeout),this.donhangSearchTimeout=setTimeout(()=>{let t=e.target.value?.toLowerCase()||"";this.applyDonhangFilters(t)},300)}filterDonhangByStatus(e){this.selectedDonhangStatus=e;let n=document.querySelector("#donhangSearch")?.value?.toLowerCase()||"";this.applyDonhangFilters(n)}clearDonhangFilter(){this.selectedDonhangStatus="",this.donhangStartDate="",this.donhangEndDate="",this.donhangSortField="",this.donhangSortDirection="asc",this.applyDonhangFilters("")}applyDonhangFilters(e){let t=[...this.ListDonhang];this.selectedDonhangStatus&&(t=t.filter(n=>n.status===this.selectedDonhangStatus)),(this.donhangStartDate||this.donhangEndDate)&&(t=this.applyDateRangeFilter(t,this.donhangStartDate,this.donhangEndDate)),e&&(t=this.applySearchFilter(t,e,"donhang")),this.FilteredDonhang=t,this.applyDonhangCurrentSort()}sortDonhangData(e){this.donhangSortField===e?this.donhangSortDirection=this.donhangSortDirection==="asc"?"desc":"asc":(this.donhangSortField=e,this.donhangSortDirection="asc"),this.applyDonhangCurrentSort()}applyDonhangCurrentSort(){this.donhangSortField&&this.FilteredDonhang.sort((e,t)=>{let n,a;if(this.donhangSortField.includes(".")){let h=this.donhangSortField.split(".");n=h.reduce((m,g)=>m&&m[g],e),a=h.reduce((m,g)=>m&&m[g],t)}else n=e[this.donhangSortField],a=t[this.donhangSortField];if(n==null&&a==null)return 0;if(n==null)return 1;if(a==null)return-1;n=String(n).toLowerCase(),a=String(a).toLowerCase();let i=n.localeCompare(a,"vi",{numeric:!0});return this.donhangSortDirection==="asc"?i:-i})}getDonhangSortIcon(e){return this.donhangSortField!==e?"unfold_more":this.donhangSortDirection==="asc"?"keyboard_arrow_up":"keyboard_arrow_down"}exportDonhangData(){if(this.FilteredDonhang.length===0){alert("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t");return}let e=this.FilteredDonhang.map(t=>({"Ti\xEAu \u0111\u1EC1":t.title||"","M\xE3 \u0110\u01A1n H\xE0ng":t.madonhang||"","Tr\u1EA1ng th\xE1i":this.Trangthaidon[t.status]||"","Kh\xE1ch H\xE0ng":t.khachhang?.name||"","T\xEAn S\u1EA3n Ph\u1EA9m":t.sanpham?.sanpham?.title||"","S\u1ED1 L\u01B0\u1EE3ng \u0110\u1EB7t":t.sanpham?.sldat||0,"S\u1ED1 L\u01B0\u1EE3ng Nh\u1EADn":t.sanpham?.slnhan||0,Ng\u00E0y:this.formatDate(t.createdAt)}));this.exportToExcel(e,"donhang-data")}filterDathangByDateRange(){let t=document.querySelector("#dathangSearch")?.value?.toLowerCase()||"";this.applyDathangFilters(t)}filterDonhangByDateRange(){let t=document.querySelector("#donhangSearch")?.value?.toLowerCase()||"";this.applyDonhangFilters(t)}clearDathangDateFilter(){this.dathangStartDate="",this.dathangEndDate="",this.filterDathangByDateRange()}clearDonhangDateFilter(){this.donhangStartDate="",this.donhangEndDate="",this.filterDonhangByDateRange()}setDathangDateFilter(e){let t=u.format(u.now(),"YYYY-MM-DD"),n=u.format(u.subtract(u.now(),e,"day"),"YYYY-MM-DD");this.dathangStartDate=n,this.dathangEndDate=t,this.filterDathangByDateRange()}setDonhangDateFilter(e){let t=u.format(u.now(),"YYYY-MM-DD"),n=u.format(u.subtract(u.now(),e,"day"),"YYYY-MM-DD");this.donhangStartDate=n,this.donhangEndDate=t,this.filterDonhangByDateRange()}formatDate(e){if(!e)return"";try{return u.format(e,"DD/MM/YYYY HH:mm")}catch{return""}}exportToExcel(e,t){let n=this.convertToCSV(e),a=new Blob(["\uFEFF"+n],{type:"text/csv;charset=utf-8"}),i=document.createElement("a"),h=URL.createObjectURL(a);i.setAttribute("href",h),i.setAttribute("download",`${t}.csv`),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}convertToCSV(e){if(e.length===0)return"";let t=Object.keys(e[0]),n=t.join(","),a=e.map(i=>t.map(h=>{let m=i[h];return typeof m=="string"&&(m.includes(",")||m.includes('"'))?`"${m.replace(/"/g,'""')}"`:m}).join(","));return[n,...a].join(`
`)}static \u0275fac=function(t){return new(t||T)};static \u0275cmp=H({type:T,selectors:[["app-xuatnhapton"]],viewQuery:function(t,n){if(t&1&&(L($,5),L(P,5),L(te,7)),t&2){let a;I(a=X())&&(n.paginator=a.first),I(a=X())&&(n.sort=a.first),I(a=X())&&(n.drawer=a.first)}},outputs:{DexuatEmit:"DexuatEmit"},decls:34,vars:8,consts:[["drawer",""],["menu","matMenu"],["menuTrigger","matMenuTrigger"],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-14","w-full","p-2"],[1,"flex","flex-row","space-x-2","items-center"],[1,"relative"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["href","/admin/chotkho","matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-flat-button","","color","primary",1,"whitespace-nowrap"],[1,"w-full","overflow-auto"],["mat-table","","matSort","",1,"excelstyle","!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSizeOptions"],["mat-menu-item","",3,"click"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"max-w-40","line-clamp-4","me-4"],[1,"z-10","material-symbols-outlined","text-gray-500",3,"matMenuTriggerFor"],[1,"cursor-pointer","flex","flex-col","space-y-4","p-3",3,"click"],[1,"relative","w-full"],[1,"flex","flex-row","space-x-2","items-center","justify-between"],[1,"text-xs","text-blue-600","underline",3,"click"],[1,"w-full","flex","flex-col","space-y-2","max-h-44","overflow-auto"],["class","flex flex-row space-x-2 items-center p-2 rounded-lg hover:bg-slate-100",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-row","space-x-2","items-end","justify-end"],["mat-flat-button","","color","warn",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"flex","flex-row","space-x-2","items-center","p-2","rounded-lg","hover:bg-slate-100",3,"click"],["class","material-symbols-outlined text-blue-600",4,"ngIf"],[1,"material-symbols-outlined","text-blue-600"],["mat-cell",""],[1,"max-w-40","line-clamp-4"],[1,"max-w-40","line-clamp-4","text-green-700","font-bold"],[1,"max-w-40","line-clamp-4","text-red-700","font-bold"],[1,"max-w-40","line-clamp-4","text-xs"],[1,"flex","items-center","justify-between"],[1,"text-xs","text-gray-500"],[1,"text-green-500"],[1,"text-red-500"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell","p-4"]],template:function(t,n){if(t&1){let a=k();r(0,"mat-drawer-container",3)(1,"mat-drawer",4,0),M(3,"router-outlet"),l(),r(4,"div",5)(5,"div",6)(6,"div",7)(7,"input",8),S("keyup",function(h){return _(a),f(n.applyFilter(h))}),l(),r(8,"div",9)(9,"span",10),p(10,"search"),l()()(),r(11,"button",11)(12,"mat-icon"),p(13,"tune"),l()(),r(14,"mat-menu",null,1)(16,"div",12)(17,"mat-form-field",13)(18,"input",14),S("input",function(h){return _(a),f(n.doFilterColumns(h))})("click",function(h){return _(a),f(h.stopPropagation())}),l(),r(19,"mat-icon",15),p(20,"search"),l()()(),r(21,"div",16),B(22,ae,5,2,"button",17,ne),l()(),r(24,"a",18),p(25," Ch\u1ED1t Kho "),l()(),r(26,"div",19)(27,"table",20),B(28,Fe,3,1,"ng-container",21,N),w(30,Te,1,0,"tr",22)(31,Me,1,0,"tr",23)(32,ke,3,0,"tr",24),l()(),M(33,"mat-paginator",25),l()()}if(t&2){let a=E(15);c(),y("position","end"),c(10),y("matMenuTriggerFor",a),c(11),V(n.FilterColumns),c(5),y("dataSource",n.dataSource),c(),V(n.displayedColumns),c(2),y("matHeaderRowDef",n.displayedColumns),c(),y("matRowDefColumns",n.displayedColumns),c(2),y("pageSizeOptions",K(6,ee,n.dataSource.data.length))}},dependencies:[St,ft,_t,Ct,yt,Nt,bt,It,Yt,Xt,Lt,Bt,$t,Pt,Vt,Rt,Ht,Et,P,kt,Mt,$,mt,ct,ht,pt,rt,it,ot,J,lt,st,nt,tt,Z,et,xt,G,q,z,j,Q,ut,Tt,Ft,wt,gt],encapsulation:2})};Y([qt()],T.prototype,"FilterHederColumn",1),Y([zt(300)],T.prototype,"doFilterHederColumn",1);var Zt=T;export{Zt as XuatnhaptonComponent};
