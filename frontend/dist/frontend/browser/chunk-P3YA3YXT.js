import{a as Ze}from"./chunk-VCG4OAYA.js";import{a as We}from"./chunk-JCXO4TSM.js";import{a as b,b as Le}from"./chunk-L5EWSFEP.js";import{b as Ke}from"./chunk-STTHC4C4.js";import{a as se,b as me,c as ce}from"./chunk-OTBM7FCQ.js";import{a as de,b as _e,c as he,d as fe}from"./chunk-CDVLS2VJ.js";import{b as Ge,f as je}from"./chunk-N62VL4FK.js";import{a as F,b as De,c as Ie}from"./chunk-JNFQJYYE.js";import{a as le}from"./chunk-TXVIVA74.js";import{b as ee,c as te}from"./chunk-PWU56VV4.js";import{a as be,b as Fe,c as Ve,d as Ae,e as Ne,g as Pe,h as Oe,j as Be,k as Re,m as $e,n as He,p as ze,q as Qe,r as qe,s as Je}from"./chunk-DRGFONJ6.js";import{b as Ee}from"./chunk-CVPACLG4.js";import{A as ke,B as Te,b as Ce,g as ge,j as we,p as xe,r as ye,t as Se,x as ve,y as Me}from"./chunk-47GS6KMG.js";import{a as pe,b as ue}from"./chunk-5BIREHNW.js";import{a as ne,c as ae,e as re}from"./chunk-SKIRCMX2.js";import{y as ie,z as oe}from"./chunk-LXJDFCF2.js";import{l as Z,m as Y,s as U,x as X}from"./chunk-KFQ5FW2D.js";import{$b as D,Cc as A,Db as B,Dc as m,Ec as K,Fc as y,Ic as J,Jc as G,Kb as x,Kc as j,Mc as N,Sc as P,Ub as h,Uc as O,Xb as R,Yb as $,bc as H,cc as I,dc as V,ec as n,fc as r,gc as M,hc as z,ic as Q,kc as v,ld as W,pa as S,pc as f,rb as l,rc as c,vc as q,xc as k,ya as d,yc as T,za as _,zc as E}from"./chunk-WYL4U5YK.js";import{a as L,j as w}from"./chunk-6DYNGEAS.js";var tt=["drawer"],it=()=>[5,10,25,100],ot=()=>({standalone:!0}),nt=(o,e)=>e.key;function at(o,e){if(o&1){let t=v();n(0,"button",31),f("click",function(a){let s=d(t).$implicit;return c().toggleColumn(s),_(a.stopPropagation())}),n(1,"mat-icon"),m(2),r(),n(3,"span"),m(4),r()()}if(o&2){let t=e.$implicit;l(2),K(t.isShow?"check_box":"check_box_outline_blank"),l(2),K(t.value)}}function rt(o,e){if(o&1){let t=v();n(0,"mat-form-field",34)(1,"mat-label"),m(2),r(),n(3,"input",35),f("keyup",function(){d(t);let a=c(2);return _(a.applyFilter())}),j("ngModelChange",function(a){let s=d(t).$implicit,u=c(2);return G(u.filterValues[s],a)||(u.filterValues[s]=a),_(a)}),r()()}if(o&2){let t=e.$implicit,i=c(2);l(2),K(i.ColumnName[t]),l(),q("placeholder","Vui l\xF2ng Nh\u1EADp ",t,""),J("ngModel",i.filterValues[t]),h("ngModelOptions",N(5,ot))}}function lt(o,e){if(o&1&&(n(0,"div",32),x(1,rt,4,6,"mat-form-field",33),r()),o&2){let t=c();l(),h("ngForOf",t.displayedColumns)}}function st(o,e){if(o&1&&(n(0,"th",38)(1,"span",39),m(2),r()()),o&2){let t=c().$implicit,i=c();l(2),y(" ",i.ColumnName[t]," ")}}function mt(o,e){if(o&1&&(n(0,"span",41),m(1),r()),o&2){let t=c().index;l(),y(" ",t+1," ")}}function ct(o,e){if(o&1&&(n(0,"span",42),m(1),P(2,"date"),r()),o&2){let t=c().$implicit,i=c().$implicit;l(),y(" ",O(2,1,t[i],"HH:mm:ss dd/MM/yyyy")," ")}}function pt(o,e){o&1&&(n(0,"mat-icon",43),m(1,"check_circle"),r())}function ut(o,e){o&1&&(n(0,"mat-icon",44),m(1,"cancel"),r())}function dt(o,e){if(o&1&&(n(0,"span",41),x(1,pt,2,0,"mat-icon",43)(2,ut,2,0,"mat-icon",44),r()),o&2){let t=c().$implicit,i=c().$implicit;l(),D(t[i]?1:2)}}function _t(o,e){if(o&1&&(n(0,"span",42),m(1),P(2,"date"),r()),o&2){let t=c().$implicit,i=c().$implicit;l(),y(" ",O(2,1,t[i],"HH:mm:ss dd/MM/yyyy")," ")}}function ht(o,e){if(o&1&&(n(0,"span",41),m(1),r()),o&2){let t=c().$implicit,i=c().$implicit;l(),y(" ",t[i]," ")}}function ft(o,e){if(o&1&&(n(0,"td",40),x(1,mt,2,1,"span",41)(2,ct,3,4,"span",42)(3,dt,3,1,"span",41)(4,_t,3,4,"span",42)(5,ht,2,1,"span",41),r()),o&2){let t,i=c().$implicit;l(),D((t=i)==="STT"?1:t==="createdAt"?2:t==="isActive"?3:t==="updatedAt"?4:5)}}function Ct(o,e){if(o&1&&(z(0,26),x(1,st,3,1,"th",36)(2,ft,6,1,"td",37),Q()),o&2){let t=e.$implicit;h("matColumnDef",t)}}function gt(o,e){o&1&&M(0,"tr",45)}function wt(o,e){if(o&1){let t=v();n(0,"tr",46),f("click",function(){let a=d(t).$implicit,s=c();return _(s.goToDetail(a))}),r()}if(o&2){let t=e.$implicit,i=c();$("hover:bg-slate-100 ",i.khoId()==t.id?"!bg-slate-200":"","")}}function xt(o,e){o&1&&(n(0,"tr",47)(1,"td",48),m(2,"Kh\xF4ng t\xECm th\u1EA5y"),r()())}var Ye=class o{Detail={};displayedColumns=["STT","name","makho","diachi","sdt","ghichu","isActive","createdAt","updatedAt"];ColumnName={STT:"STT",name:"T\xEAn Kho",makho:"M\xE3 Kho",diachi:"\u0110\u1ECBa Ch\u1EC9",sdt:"S\u1ED1 \u0110i\u1EC7n Tho\u1EA1i",ghichu:"Ghi Ch\xFA",isActive:"Tr\u1EA1ng Th\xE1i",createdAt:"Ng\xE0y T\u1EA1o",updatedAt:"Ng\xE0y C\u1EADp Nh\u1EADt"};FilterColumns=JSON.parse(localStorage.getItem("KhoColFilter")||"[]");Columns=[];isFilter=!1;paginator;sort;drawer;filterValues={};_KhoService=S(Ze);_breakpointObserver=S(ie);_GoogleSheetService=S(We);_router=S(te);Listkho=this._KhoService.ListKho;dataSource=W(()=>{let e=new Je(this.Listkho());return e.filterPredicate=this.createFilter(),e.paginator=this.paginator,e.sort=this.sort,e});khoId=this._KhoService.khoId;_snackBar=S(le);CountItem=0;constructor(){this.displayedColumns.forEach(e=>{this.filterValues[e]=""})}createFilter(){return(e,t)=>{let i=JSON.parse(t),a=!0;return this.displayedColumns.forEach(s=>{if(i[s]){let u=e[s]?e[s].toString().toLowerCase():"";a=a&&u.includes(i[s].toLowerCase())}}),a}}applyFilter(){this.dataSource().filter=JSON.stringify(this.filterValues)}ngOnInit(){return w(this,null,function*(){yield this._KhoService.getAllKho(),this.CountItem=this.Listkho().length,this.initializeColumns(),this.setupDrawer(),this.paginator._intl.itemsPerPageLabel="S\u1ED1 l\u01B0\u1EE3ng 1 trang",this.paginator._intl.nextPageLabel="Ti\u1EBFp Theo",this.paginator._intl.previousPageLabel="V\u1EC1 Tr\u01B0\u1EDBc",this.paginator._intl.firstPageLabel="Trang \u0110\u1EA7u",this.paginator._intl.lastPageLabel="Trang Cu\u1ED1i"})}refresh(){return w(this,null,function*(){yield this._KhoService.getAllKho()})}initializeColumns(){this.Columns=Object.keys(this.ColumnName).map(e=>({key:e,value:this.ColumnName[e],isShow:!0})),this.FilterColumns.length===0?this.FilterColumns=this.Columns:localStorage.setItem("KhoColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{})}setupDrawer(){this._breakpointObserver.observe([oe.Handset]).subscribe(e=>{e.matches?(this.drawer.mode="over",this.paginator.hidePageSize=!0):this.drawer.mode="side"})}toggleColumn(e){let t=this.FilterColumns.find(i=>i.key===e.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("KhoColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(i=>i.value.toLowerCase().includes(t))}create(){this.drawer.open(),this._router.navigate(["admin/kho",0])}goToDetail(e){this._KhoService.setKhoId(e.id),this.drawer.open(),this._router.navigate(["admin/kho",e.id])}LoadDrive(){return w(this,null,function*(){let e={IdSheet:"15npo25qyH5FmfcEjl1uyqqyFMS_vdFnmxM_kt0KYmZk",SheetName:"KhoImport",ApiKey:"AIzaSyD33kgZJKdFpv1JrKHacjCQccL_O0a2Eao"},t=yield this._GoogleSheetService.getDrive(e),i=Ke(t.values);console.log(i),this.DoImportData(i)})}DoImportData(e){console.log(e);let i=e.map(p=>({name:p.name?.trim()||"",makho:p.makho?.trim()||"",diachi:p.diachi?.trim()||"",sdt:p.sdt?.trim()||"",ghichu:p.ghichu||""})).filter((p,C,g)=>C===g.findIndex(et=>et.makho===p.makho)),a=i.map(p=>p.makho),s=this._KhoService.ListKho().map(p=>p.makho),u=a.filter(p=>!s.includes(p)),Ue=i.map(p=>w(this,null,function*(){let C=this._KhoService.ListKho().find(g=>g.makho===p.makho);if(C){let g=L(L({},C),p);yield this._KhoService.updateKho(g)}else yield this._KhoService.CreateKho(p)})),Xe=u.map(p=>w(this,null,function*(){let C=this._KhoService.ListKho().find(g=>g.makho===p);C.isActive=!1,yield this._KhoService.updateKho(C)}));Promise.all([...Ue,...Xe]).then(()=>{this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ImporExcel(e){return w(this,null,function*(){let t=yield je(e);this.DoImportData(t)})}ExportExcel(e,t){Ge(e,t)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=B({type:o,selectors:[["app-listkho"]],viewQuery:function(t,i){if(t&1&&(k(b,5),k(F,5),k(tt,7)),t&2){let a;T(a=E())&&(i.paginator=a.first),T(a=E())&&(i.sort=a.first),T(a=E())&&(i.drawer=a.first)}},decls:50,vars:12,consts:[["drawer",""],["menu","matMenu"],["uploadfile",""],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-12","w-full","p-2"],[1,"cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","p-2","bg-white","rounded-lg"],[1,"flex","flex-row","space-x-2","items-center"],["matTooltip","Th\xEAm m\u1EDBi","mat-flat-button","",1,"flex","flex-row","items-center","btn-primary",3,"click"],[1,"whitespace-nowrap"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["matTooltip","B\u1ED9 L\u1ECDc","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\u1EA3i file excel M\u1EABu","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\u1EA3i l\xEAn file excel","color","primary","mat-icon-button","",3,"click"],["type","file",1,"hidden",3,"change"],["matTooltip","T\u1EA3i d\u1EEF li\u1EC7u t\u1EEB drive","color","primary","mat-icon-button","",3,"click"],[1,"lg:flex","hidden","whitespace-nowrap","p-2","rounded-lg","bg-slate-200"],["class","w-full grid grid-cols-2 gap-2 lg:flex lg:flex-row lg:space-x-2 items-center",4,"ngIf"],[1,"w-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"class","click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSizeOptions"],["mat-menu-item","",3,"click"],[1,"w-full","grid","grid-cols-2","gap-2","lg:flex","lg:flex-row","lg:space-x-2","items-center"],["appearance","outline","subscriptSizing","dynamic",4,"ngFor","ngForOf"],["appearance","outline","subscriptSizing","dynamic"],["matInput","",3,"keyup","ngModelChange","ngModel","ngModelOptions","placeholder"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"max-w-40","line-clamp-4","me-4"],["mat-cell",""],[1,"max-w-40","line-clamp-4"],[1,"max-w-40","line-clamp-4","text-xs"],[1,"text-green-500"],[1,"text-red-500"],["mat-header-row",""],["mat-row","",3,"click"],[1,"mat-row"],["colspan","4",1,"mat-cell","p-4"]],template:function(t,i){if(t&1){let a=v();n(0,"mat-drawer-container",3)(1,"mat-drawer",4,0),M(3,"router-outlet"),r(),n(4,"div",5)(5,"div",6)(6,"div",7)(7,"button",8),f("click",function(){return d(a),_(i.create())}),n(8,"mat-icon"),m(9,"add_circle"),r(),n(10,"span",9),m(11,"T\u1EA1o M\u1EDBi"),r()(),n(12,"button",10)(13,"mat-icon"),m(14,"tune"),r()(),n(15,"mat-menu",null,1)(17,"div",11)(18,"mat-form-field",12)(19,"input",13),f("input",function(u){return d(a),_(i.doFilterColumns(u))})("click",function(u){return d(a),_(u.stopPropagation())}),r(),n(20,"mat-icon",14),m(21,"search"),r()()(),n(22,"div",15),I(23,at,5,2,"button",16,nt),r()(),n(25,"button",17),f("click",function(){return d(a),_(i.isFilter=!i.isFilter)}),n(26,"mat-icon"),m(27,"filter_list"),r()(),n(28,"button",18),f("click",function(){return d(a),_(i.ExportExcel(i.Listkho(),"Kho"))}),n(29,"mat-icon"),m(30,"file_download"),r()(),n(31,"button",19),f("click",function(){d(a);let u=A(35);return _(u.click())}),n(32,"mat-icon"),m(33,"file_upload"),r()(),n(34,"input",20,2),f("change",function(u){return d(a),_(i.ImporExcel(u))}),r(),n(36,"button",21),f("click",function(){return d(a),_(i.LoadDrive())}),n(37,"mat-icon"),m(38,"cloud_download"),r()(),n(39,"span",22),m(40),r()()(),x(41,lt,2,1,"div",23),n(42,"div",24)(43,"table",25),I(44,Ct,3,1,"ng-container",26,H),x(46,gt,1,0,"tr",27)(47,wt,1,3,"tr",28)(48,xt,3,0,"tr",29),r(),M(49,"mat-paginator",30),r()()()}if(t&2){let a=A(16);l(),h("position","end"),l(11),h("matMenuTriggerFor",a),l(11),V(i.FilterColumns),l(2),R(i.isFilter?"!bg-slate-200":""),l(15),y(" ",i.CountItem," S\u1EA3n Ph\u1EA9m "),l(),h("ngIf",i.isFilter),l(2),h("dataSource",i.dataSource()),l(),V(i.displayedColumns),l(2),h("matHeaderRowDef",i.displayedColumns),l(),h("matRowDefColumns",i.displayedColumns),l(2),h("pageSizeOptions",N(11,it))}},dependencies:[Me,ve,ye,Se,Te,ke,qe,Ve,Ne,Re,Pe,Ae,$e,Oe,Be,He,ze,Qe,Ie,F,De,Le,b,fe,_e,de,he,ce,se,me,ee,ue,pe,re,ne,ae,Ee,X,Z,Y,U,xe,Ce,ge,we,Fe,be],encapsulation:2})};export{Ye as a};
