import{a as dt,b as mt}from"./chunk-NULFSBS2.js";import{a as ut}from"./chunk-4EMRUDMX.js";import{a as ct}from"./chunk-ZUQACZTZ.js";import{a as ot,b as at}from"./chunk-R6LBO2DX.js";import{a as H,b as rt,c as lt}from"./chunk-CNJR64C4.js";import{b as W,f as st}from"./chunk-N62VL4FK.js";import{b as je}from"./chunk-STTHC4C4.js";import{a as ye,b as Ce,c as Se}from"./chunk-NBRWFLNC.js";import{a as Ee,b as be,c as ve,d as Ae}from"./chunk-NJTM6TIW.js";import{a as He}from"./chunk-ZQXFRXA5.js";import{b as me,c as $}from"./chunk-3ULLR243.js";import{a as w}from"./chunk-H7UDLENL.js";import{a as j}from"./chunk-2QVTWX3V.js";import{c as De,d as Fe,f as Ie,h as Ve}from"./chunk-REZA5E6U.js";import{a as O}from"./chunk-FDTVQONQ.js";import{a as We,b as Ue,c as qe,e as Ge,f as Je,h as Qe,i as Xe,k as Ke,l as Ye,n as Ze,o as et,p as tt,q as Z}from"./chunk-DFQ3WBEG.js";import{a as it,b as nt}from"./chunk-CSLCTKA5.js";import{b as Oe}from"./chunk-WWR2OOLD.js";import{b as Re,c as $e}from"./chunk-XBYFTIM3.js";import{B as Ne,C as ze,b as Me,g as Le,j as ke,s as Te,u as Pe,x as Be}from"./chunk-5PCRWSUQ.js";import{a as we,b as xe}from"./chunk-Q4HMHGF2.js";import{a as he,c as _e,e as fe}from"./chunk-VA3CEBIV.js";import{y as pe,z as ge}from"./chunk-G22JNWMU.js";import{s as ce,x as de}from"./chunk-HUFFEFIS.js";import{Bc as I,Cc as s,Db as ie,Dc as M,Ec as S,Fc as le,Gc as se,Hc as E,Ic as b,Jc as v,Kb as x,Lc as R,Ra as y,Rc as X,Tc as K,Ub as f,Xc as Y,Yb as ne,_b as D,ac as oe,bc as J,cc as Q,dc as o,ec as r,fc as F,gc as ae,hc as re,ja as te,jc as A,md as ue,oa as P,oc as _,pa as C,qc as d,rb as c,wc as B,xc as N,ya as p,yc as z,za as g}from"./chunk-5IRI5K5U.js";import{a as k,b as V,h as G,j as h}from"./chunk-6DYNGEAS.js";var U=class a{constructor(i,e,t){this._StorageService=i;this.router=e;this._ErrorLogService=t}_snackBar=C(O);ListAuditlog=y([]);DetailAuditlog=y({});page=y(1);pageCount=y(1);total=y(0);pageSize=y(50);auditlogId=y(null);setAuditlogId(i){this.auditlogId.set(i)}CreateAuditlog(i){return h(this,null,function*(){try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(i)},t=yield fetch(`${w.APIURL}/auditlog`,e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let n=yield t.json();this.getAllAuditlog(this.pageSize()),this.auditlogId.set(n.id)}catch(e){this._ErrorLogService.logError("Failed to CreateAuditlog",e),console.error(e)}})}getAllAuditlog(){return h(this,arguments,function*(i=this.pageSize(),e=!1){try{let t={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},n=new URLSearchParams({page:this.page().toString(),limit:i.toString()}),l=yield fetch(`${w.APIURL}/auditlog?${n}`,t);l.ok||this.handleError(l.status);let u=yield l.json();return this.ListAuditlog.set(u.data),this.page.set(u.page||1),this.pageCount.set(u.pageCount||1),this.total.set(u.total||u.data.length),this.pageSize.set(i),u.data}catch(t){console.error(t)}})}getUpdatedCodeIds(){return h(this,null,function*(){try{let i={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},e=yield fetch(`${w.APIURL}/auditlog/updateCodeIds`,i);e.ok||this.handleError(e.status);let t=yield e.json();return this.getAllAuditlog(this.pageSize()),t.data}catch(i){this._ErrorLogService.logError("Failed to getUpdatedCodeIds",i),console.error(i)}})}getAuditlogBy(i){return h(this,null,function*(){i.pageSize=Number(this.pageSize()),i.page=Number(this.page());try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(i)},t=yield fetch(`${w.APIURL}/auditlog/findby`,e);t.ok||this.handleError(t.status);let n=yield t.json();i.isOne===!0?this.DetailAuditlog.set(n):(this._StorageService.setItem("auditlogs_updatedAt",new Date().toISOString()),this.ListAuditlog.set(n.data),this.page.set(n.page||1),this.pageCount.set(n.pageCount||1),this.total.set(n.total||n.data.length),this.pageSize.set(this.pageSize()))}catch{}})}updateAuditlog(i){return h(this,null,function*(){try{let e={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(i)},t=yield fetch(`${w.APIURL}/auditlog/${i.id}`,e);t.ok||this.handleError(t.status);let n=yield t.json();this.getAllAuditlog(this.pageSize()),this.getAuditlogBy({id:n.id,isOne:!0,pageSize:this.pageSize()})}catch(e){this._ErrorLogService.logError("Failed to updateAuditlog",e),console.error(e)}})}DeleteAuditlog(i){return h(this,null,function*(){try{let e={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},t=yield fetch(`${w.APIURL}/auditlog/${i.id}`,e);t.ok||this.handleError(t.status),this.getAllAuditlog(this.pageSize())}catch(e){this._ErrorLogService.logError("Failed to DeleteAuditlog",e),console.error(e)}})}handleError(i){let e="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(i){case 400:e="Th\xF4ng tin \u0111\xE3 t\u1ED3n t\u1EA1i";break;case 401:case 404:e="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:e="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:e="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}this._snackBar.open(e,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}static \u0275fac=function(e){return new(e||a)(P(j),P($),P(He))};static \u0275prov=te({token:a,factory:a.\u0275fac,providedIn:"root"})};var ht=["drawer"],ee=()=>({standalone:!0}),_t=(a,i)=>i.key;function ft(a,i){if(a&1){let e=A();o(0,"button",25),_("click",function(n){let l=p(e).$implicit;return d().toggleColumn(l),g(n.stopPropagation())}),o(1,"mat-icon"),s(2),r(),o(3,"span"),s(4),r()()}if(a&2){let e=i.$implicit;c(2),M(e.isShow?"check_box":"check_box_outline_blank"),c(2),M(e.value)}}function yt(a,i){if(a&1&&(o(0,"th",51)(1,"span"),s(2),r()()),a&2){let e=d(2).$implicit,t=d();c(2),M(t.ColumnName[e])}}function Ct(a,i){a&1&&x(0,yt,3,1,"th",54)}function St(a,i){if(a&1){let e=A();o(0,"th",52)(1,"span",56),s(2),r(),o(3,"app-searchfilter",57),_("OutFilter",function(n){p(e);let l=d(3);return g(l.onOutFilter(n))}),r()()}if(a&2){let e=d(2).$implicit,t=d();c(2),S(" ",t.ColumnName[e]," "),c(),f("icon","filter_alt")("ListItem",t.Listauditlog())("fieldsearch",e)("ListFilter",t.ListFilter)("filterItem",t.FilterHederColumn(t.dataSource.filteredData,e))}}function wt(a,i){a&1&&x(0,St,4,6,"th",55)}function xt(a,i){if(a&1){let e=A();o(0,"span",64),_("click",function(){p(e);let n=d().$implicit,l=d(2);return g(l.goToDetail(n))}),s(1),r()}if(a&2){let e=d().$implicit,t=d().$implicit;c(),S(" ",e[t]," ")}}function Et(a,i){if(a&1&&(o(0,"span",60),s(1),r()),a&2){let e=d().index;c(),S(" ",e+1," ")}}function bt(a,i){if(a&1&&(o(0,"span",61),s(1),X(2,"date"),r()),a&2){let e=d().$implicit,t=d().$implicit;c(),S(" ",K(2,1,e[t],"HH:mm:ss dd/MM/yyyy")," ")}}function vt(a,i){if(a&1&&(o(0,"span",62),s(1),r()),a&2){let e=d().$implicit,t=d().$implicit;c(),le(" ",e[t]==null?null:e[t].name," ",e[t]==null?null:e[t].email," ")}}function At(a,i){a&1&&(o(0,"mat-icon",65),s(1,"check_circle"),r())}function Mt(a,i){a&1&&(o(0,"mat-icon",66),s(1,"cancel"),r())}function Lt(a,i){if(a&1&&(o(0,"span",62),x(1,At,2,0,"mat-icon",65)(2,Mt,2,0,"mat-icon",66),r()),a&2){let e=d().$implicit,t=d().$implicit;c(),D(e[t]?1:2)}}function kt(a,i){a&1&&(o(0,"mat-icon",65),s(1,"check_circle"),r(),o(2,"span",67),s(3,"Th\xE0nh c\xF4ng"),r())}function Tt(a,i){a&1&&(o(0,"mat-icon",66),s(1,"cancel"),r(),o(2,"span",68),s(3,"L\u1ED7i"),r())}function Dt(a,i){a&1&&(o(0,"mat-icon",69),s(1,"warning"),r(),o(2,"span",70),s(3,"C\u1EA3nh b\xE1o"),r())}function Ft(a,i){if(a&1&&(o(0,"mat-icon",71),s(1,"help"),r(),o(2,"span",72),s(3),r()),a&2){let e=d(2).$implicit,t=d().$implicit;c(3),M(e[t])}}function It(a,i){if(a&1&&(o(0,"span",63),x(1,kt,4,0)(2,Tt,4,0)(3,Dt,4,0)(4,Ft,4,1),r()),a&2){let e=d().$implicit,t=d().$implicit;c(),D(e[t]==="SUCCESS"?1:e[t]==="ERROR"?2:e[t]==="WARNING"?3:4)}}function Vt(a,i){if(a&1&&(o(0,"span",61),s(1),X(2,"date"),r()),a&2){let e=d().$implicit,t=d().$implicit;c(),S(" ",K(2,1,e[t],"HH:mm:ss dd/MM/yyyy")," ")}}function Pt(a,i){if(a&1&&(o(0,"span",62),s(1),r()),a&2){let e=d().$implicit,t=d().$implicit;c(),S(" ",e[t]," ")}}function Bt(a,i){if(a&1&&(o(0,"td",58),x(1,xt,2,1,"span",59)(2,Et,2,1,"span",60)(3,bt,3,4,"span",61)(4,vt,2,2,"span",62)(5,Lt,3,1,"span",62)(6,It,5,1,"span",63)(7,Vt,3,4,"span",61)(8,Pt,2,1,"span",62),r()),a&2){let e,t=d().$implicit;c(),D((e=t)==="codeId"?1:e==="stt"?2:e==="createdAt"?3:e==="user"?4:e==="isActive"?5:e==="status"?6:e==="updatedAt"?7:8)}}function Nt(a,i){if(a&1&&(ae(0,36),x(1,Ct,1,0,"th",51)(2,wt,1,0,"th",52)(3,Bt,9,1,"td",53),re()),a&2){let e=i.$implicit;f("matColumnDef",e),c(),D(e=="stt"?1:2)}}function zt(a,i){a&1&&F(0,"tr",73)}function Rt(a,i){if(a&1){let e=A();o(0,"tr",74),_("click",function(){let n=p(e).$implicit,l=d();return g(l.goToDetail(n))}),r()}if(a&2){let e=i.$implicit,t=d();ne("hover:bg-slate-50 ",t.CheckItemInEdit(e)?"!bg-blue-50":"","")}}function $t(a,i){a&1&&(o(0,"tr",75)(1,"td",76),s(2,"Kh\xF4ng t\xECm th\u1EA5y"),r()())}function Ot(a,i){a&1&&(o(0,"mat-dialog-content")(1,"div",77)(2,"div",78),s(3,"X\xE1c Nh\u1EADn"),r(),o(4,"div"),s(5,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),r(),o(6,"div",79)(7,"button",80),s(8,"\u0110\u1ED3ng \xDD"),r(),o(9,"button",81),s(10,"Hu\u1EF7 B\u1ECF"),r()()()())}function jt(a,i){if(a&1){let e=A();o(0,"mat-dialog-content",82)(1,"div",83)(2,"mat-form-field",28)(3,"mat-label"),s(4,"IdSheet"),r(),o(5,"input",84),v("ngModelChange",function(n){p(e);let l=d();return b(l.IdSheet,n)||(l.IdSheet=n),g(n)}),r()(),o(6,"mat-form-field",28)(7,"mat-label"),s(8,"SheetName"),r(),o(9,"input",85),v("ngModelChange",function(n){p(e);let l=d();return b(l.SheetName,n)||(l.SheetName=n),g(n)}),r()()(),F(10,"div",86),o(11,"div",87)(12,"button",80),s(13,"\u0110\u1ED3ng \xDD"),r(),o(14,"button",81),s(15,"Hu\u1EF7 B\u1ECF"),r()()()}if(a&2){let e=d();c(5),E("ngModel",e.IdSheet),f("ngModelOptions",R(4,ee)),c(4),E("ngModel",e.SheetName),f("ngModelOptions",R(5,ee))}}var T=class T{displayedColumns=[];ColumnName={stt:"#",entityName:"Module",action:"H\xE0nh \u0110\u1ED9ng",status:"Tr\u1EA1ng Th\xE1i",user:"Ng\u01B0\u1EDDi D\xF9ng",ipAddress:"\u0110\u1ECBa Ch\u1EC9 IP",createdAt:"Ng\xE0y T\u1EA1o",updatedAt:"Ng\xE0y C\u1EADp Nh\u1EADt"};FilterColumns=JSON.parse(localStorage.getItem("AuditlogColFilter")||"[]");Columns=[];paginator;sort;drawer;_AuditlogService=C(U);_breakpointObserver=C(pe);_GoogleSheetService=C(ut);_router=C($);_dialog=C(De);_snackBar=C(O);_StorageService=C(j);Listauditlog=this._AuditlogService.ListAuditlog;page=this._AuditlogService.page;pageCount=this._AuditlogService.pageCount;total=this._AuditlogService.total;pageSize=this._AuditlogService.pageSize;auditlogId=this._AuditlogService.auditlogId;dataSource=new Z([]);EditList=[];isSearch=y(!1);param={};isLoading=y(!1);searchModule="";searchAction="";searchValue="";searchDateFrom="";searchDateTo="";constructor(){ue(()=>{this.dataSource.data=this.Listauditlog(),this.dataSource.sort=this.sort,this.paginator&&(this.paginator.pageIndex=this.page()-1,this.paginator.pageSize=this.pageSize(),this.paginator.length=this.total())})}ngOnInit(){return h(this,null,function*(){yield this._AuditlogService.getAuditlogBy(this.param),this.displayedColumns=Object.keys(this.ColumnName),this.dataSource=new Z(this.Listauditlog()),this.dataSource.sort=this.sort,this.initializeColumns(),this.setupDrawer()})}initializeColumns(){this.Columns=Object.entries(this.ColumnName).map(([i,e])=>({key:i,value:e,isShow:!0})),this.FilterColumns=this.FilterColumns.length?this.FilterColumns:this.Columns,localStorage.setItem("AuditlogColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(i=>i.isShow).map(i=>i.key),this.ColumnName=this.FilterColumns.reduce((i,{key:e,value:t,isShow:n})=>n?V(k({},i),{[e]:t}):i,{})}applyFilter(i){return h(this,null,function*(){let e=i.target.value;this.param.status=e,yield this._AuditlogService.getAuditlogBy(this.param)})}applySearch(){return h(this,null,function*(){this.param={},this.searchModule&&this.searchModule.trim()&&(this.param.entityName=this.searchModule.trim()),this.searchAction&&this.searchAction.trim()&&(this.param.action=this.searchAction.trim()),this.searchValue&&this.searchValue.trim()&&(this.param.searchValue=this.searchValue.trim()),this.searchDateFrom&&(this.param.createdAtFrom=this.searchDateFrom),this.searchDateTo&&(this.param.createdAtTo=this.searchDateTo),this._AuditlogService.page.set(1),this.isLoading.set(!0);try{yield this._AuditlogService.getAuditlogBy(this.param),this._snackBar.open("T\xECm ki\u1EBFm th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{this._snackBar.open("L\u1ED7i khi t\xECm ki\u1EBFm","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isLoading.set(!1)}})}clearFilters(){return h(this,null,function*(){this.searchModule="",this.searchAction="",this.searchValue="",this.searchDateFrom="",this.searchDateTo="",this.param={},this._AuditlogService.page.set(1),this.isLoading.set(!0);try{yield this._AuditlogService.getAuditlogBy(this.param),this._snackBar.open("\u0110\xE3 x\xF3a b\u1ED9 l\u1ECDc","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}finally{this.isLoading.set(!1)}})}getUpdatedCodeIds(){return h(this,null,function*(){yield this._AuditlogService.getUpdatedCodeIds()})}setupDrawer(){this._breakpointObserver.observe([ge.Handset]).subscribe(i=>{i.matches?this.drawer.mode="over":this.drawer.mode="side"})}toggleColumn(i){let e=this.FilterColumns.find(t=>t.key===i.key);e&&(e.isShow=!e.isShow,this.updateDisplayedColumns())}FilterHederColumn(i,e){return i.filter((n,l,u)=>l===u.findIndex(m=>m[e]===n[e]))}doFilterHederColumn(i,e){this.dataSource.filteredData=this.Listauditlog().filter(t=>t[e].toLowerCase().includes(i.target.value.toLowerCase()))}ListFilter=[];ChosenItem(i,e){let t=this.dataSource.filteredData.filter(l=>l[e]===i[e]);this.ListFilter.filter(l=>l[e]===i[e]).length>0?this.ListFilter=this.ListFilter.filter(l=>l[e]!==i[e]):this.ListFilter=[...this.ListFilter,...t]}ChosenAll(i){i.forEach(e=>{!!this.ListFilter.find(n=>n.id===e.id)?this.ListFilter=this.ListFilter.filter(n=>n.id!==e.id):this.ListFilter.push(e)})}ResetFilter(){this.ListFilter=this.Listauditlog()}EmptyFiter(){this.ListFilter=[]}CheckItem(i){return!!this.ListFilter.find(e=>e.id===i.id)}ApplyFilterColum(i){this.dataSource.data=this.Listauditlog().filter(e=>this.ListFilter.some(t=>t.id===e.id)),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,i.closeMenu()}onOutFilter(i){this.dataSource.data=i,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(i=>i.isShow).map(i=>i.key),this.ColumnName=this.FilterColumns.reduce((i,e)=>(e.isShow&&(i[e.key]=e.value),i),{}),localStorage.setItem("AuditlogColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(i){let e=i.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(t=>t.value.toLowerCase().includes(e))}create(){this.drawer.open(),this._router.navigate(["admin/auditlog","new"])}openDeleteDialog(i){this._dialog.open(i,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(t=>{t==="true"&&this.DeleteListItem()})}DeleteListItem(){this.EditList.forEach(i=>{this._AuditlogService.DeleteAuditlog(i)}),this.EditList=[],this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}AddToEdit(i){this.EditList.find(t=>t.id===i.id)?this.EditList=this.EditList.filter(t=>t.id!==i.id):this.EditList.push(i)}CheckItemInEdit(i){return this.EditList.some(e=>e.id===i.id)}goToDetail(i){this.drawer.open(),this._AuditlogService.setAuditlogId(i.id),this._router.navigate(["admin/auditlog",i.id])}OpenLoadDrive(i){this._dialog.open(i,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(t=>{})}IdSheet="15npo25qyH5FmfcEjl1uyqqyFMS_vdFnmxM_kt0KYmZk";SheetName="SPImport";ImportIteam=[];ImportColumnName={};ImportdisplayedColumns=[];LoadDrive(){return h(this,null,function*(){let i={IdSheet:this.IdSheet,SheetName:this.SheetName,ApiKey:w.GSApiKey},e=yield this._GoogleSheetService.getDrive(i);this.ImportIteam=je(e.values),this.ImportColumnName=Object.fromEntries(e.values[0].map((t,n)=>[t,e.values[1][n]])),this.ImportdisplayedColumns=e.values[0]})}DoImportData(i){return h(this,null,function*(){let e=i.map(m=>({title:m.title?.trim()||"",masp:m.masp?.trim()||"",giagoc:Number(m.giagoc)||0,dvt:m.dvt?.trim()||"",soluong:Number(m.soluong)||0,soluongkho:Number(m.soluongkho)||0,haohut:Number(m.haohut)||0,ghichu:m.ghichu?.trim()||""})),t=Array.from(new Map(e.map(m=>[m.masp,m])).values()),n=this._AuditlogService.ListAuditlog(),l=n.map(m=>m.masp),u=t.map(m=>m.masp).filter(m=>!l.includes(m));yield Promise.all(t.map(m=>h(this,null,function*(){let L=n.find(q=>q.masp===m.masp);if(L){let q=k(k({},L),m);yield this._AuditlogService.updateAuditlog(q)}else yield this._AuditlogService.CreateAuditlog(m)}))),yield Promise.all(n.filter(m=>!t.some(L=>L.masp===m.masp)).map(m=>this._AuditlogService.updateAuditlog(V(k({},m),{isActive:!1})))),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ImporExcel(i){return h(this,null,function*(){let e=yield st(i);this.DoImportData(e)})}ExportExcel(i,e){let t=i.map(n=>({title:n.title,masp:n.masp,giagoc:n.giagoc,dvt:n.dvt,soluong:n.soluong,soluongkho:n.soluongkho,haohut:n.haohut,ghichu:n.ghichu}));W(t,e)}exportToExcel(i="current"){if(!this.Listauditlog()||this.Listauditlog().length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}i==="all"?this.exportAllData():this.exportCurrentPage()}exportCurrentPage(){try{let i=this.prepareExportData(this.Listauditlog()),e=this.generateFilename("page");W(i,e),this._snackBar.open(`\u0110\xE3 xu\u1EA5t ${i.length} b\u1EA3n ghi ra Excel`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(i){console.error("Error exporting to Excel:",i),this._snackBar.open("L\u1ED7i khi xu\u1EA5t Excel","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}exportAllData(){return h(this,null,function*(){this.isLoading.set(!0);try{let i=V(k({},this.param),{page:1,pageSize:this.total()}),e=yield fetch(`${w.APIURL}/auditlog/findby`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(i)});if(!e.ok)throw new Error("Failed to fetch all data");let n=(yield e.json()).data||[],l=this.prepareExportData(n),u=this.generateFilename("all");W(l,u),this._snackBar.open(`\u0110\xE3 xu\u1EA5t ${l.length} b\u1EA3n ghi ra Excel`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(i){console.error("Error exporting all data to Excel:",i),this._snackBar.open("L\u1ED7i khi xu\u1EA5t to\xE0n b\u1ED9 d\u1EEF li\u1EC7u","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isLoading.set(!1)}})}prepareExportData(i){return i.map((e,t)=>({STT:t+1,Module:e.entityName||"","ID \u0110\u1ED1i T\u01B0\u1EE3ng":e.entityId||"","H\xE0nh \u0110\u1ED9ng":e.action||"","Tr\u1EA1ng Th\xE1i":e.status||"","Ng\u01B0\u1EDDi D\xF9ng":e.user?.email||e.userEmail||"",S\u0110T:e.user?.SDT||"","\u0110\u1ECBa Ch\u1EC9 IP":e.ipAddress||"","User Agent":e.userAgent||"","Session ID":e.sessionId||"","C\xE1c Tr\u01B0\u1EDDng Thay \u0110\u1ED5i":Array.isArray(e.changedFields)?e.changedFields.join(", "):"","Gi\xE1 Tr\u1ECB C\u0169":e.oldValues?JSON.stringify(e.oldValues):"","Gi\xE1 Tr\u1ECB M\u1EDBi":e.newValues?JSON.stringify(e.newValues):"","Chi Ti\u1EBFt L\u1ED7i":e.errorDetails?JSON.stringify(e.errorDetails):"",Metadata:e.metadata?JSON.stringify(e.metadata):"","Ng\xE0y T\u1EA1o":e.createdAt?this.formatDateTime(e.createdAt):"","Ng\xE0y C\u1EADp Nh\u1EADt":e.updatedAt?this.formatDateTime(e.updatedAt):""}))}generateFilename(i){let e="AuditLog";if(i==="all"?e+="_ToanBo":e+=`_Trang${this.page()}`,this.searchModule&&(e+=`_${this.searchModule}`),this.searchAction&&(e+=`_${this.searchAction}`),this.searchValue&&(e+=`_${this.searchValue.substring(0,20)}`),this.searchDateFrom||this.searchDateTo){let t=`${this.searchDateFrom||"start"}_${this.searchDateTo||"end"}`;e+=`_${t}`}return e+=`_${new Date().toISOString().split("T")[0]}`,e}formatDateTime(i){if(!i)return"";let e=new Date(i),t=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),l=e.getFullYear(),u=String(e.getHours()).padStart(2,"0"),m=String(e.getMinutes()).padStart(2,"0"),L=String(e.getSeconds()).padStart(2,"0");return`${u}:${m}:${L} ${t}/${n}/${l}`}trackByFn(i,e){return e.id}onPageSizeChange(i,e){i>this.total()&&(this._snackBar.open(`S\u1ED1 l\u01B0\u1EE3ng t\u1ED1i \u0111a ${this.total()}`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),i=this.total()),this._AuditlogService.pageSize.set(i),this._AuditlogService.page.set(1),this._AuditlogService.getAuditlogBy(this.param),e.closeMenu()}onPreviousPage(){this.page()>1&&(this._AuditlogService.page.set(this.page()-1),this._AuditlogService.getAuditlogBy(this.param))}onNextPage(){this.page()<this.pageCount()&&(this._AuditlogService.page.set(this.page()+1),this._AuditlogService.getAuditlogBy(this.param))}static \u0275fac=function(e){return new(e||T)};static \u0275cmp=ie({type:T,selectors:[["app-listauditlog"]],viewQuery:function(e,t){if(e&1&&(B(ot,5),B(H,5),B(ht,7)),e&2){let n;N(n=z())&&(t.paginator=n.first),N(n=z())&&(t.sort=n.first),N(n=z())&&(t.drawer=n.first)}},decls:104,vars:27,consts:[["drawer",""],["exportMenu","matMenu"],["menu","matMenu"],["menuHienthi","matMenuTrigger"],["menu1","matMenu"],["DeleteDialog",""],["LoadDriveDialog",""],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-16","w-full","p-2"],[1,"p-2","cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","bg-white","rounded-lg"],[1,"w-full","flex","flex-col","gap-2","lg:flex-row","lg:items-center","lg:justify-between"],[1,"flex","flex-col","lg:flex-row","space-y-2","lg:space-y-0","lg:space-x-2","items-center","w-full"],[1,"relative","w-full","lg:w-64"],["type","text","placeholder","T\xECm ki\u1EBFm module...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"ngModelChange","keyup.enter","ngModel"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],["type","text","placeholder","T\xECm ki\u1EBFm h\xE0nh \u0111\u1ED9ng...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"ngModelChange","keyup.enter","ngModel"],["type","text","placeholder","T\xECm trong d\u1EEF li\u1EC7u...","matTooltip","T\xECm ki\u1EBFm trong oldValues/newValues",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"ngModelChange","keyup.enter","ngModel"],[1,"relative","w-full","lg:w-48"],["type","date","placeholder","T\u1EEB ng\xE0y...",1,"block","w-full","pl-3","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"ngModelChange","ngModel"],["type","date","placeholder","\u0110\u1EBFn ng\xE0y...",1,"block","w-full","pl-3","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"ngModelChange","ngModel"],["matTooltip","T\xECm ki\u1EBFm","mat-icon-button","","color","primary",3,"click"],["matTooltip","X\xF3a b\u1ED9 l\u1ECDc","mat-icon-button","","color","warn",3,"click"],["matTooltip","Xu\u1EA5t Excel","mat-icon-button","","color","accent",3,"matMenuTriggerFor","disabled"],["mat-menu-item","",3,"click"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],[1,"flex","flex-row","space-x-2","items-center"],[1,"w-full","h-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["class","border","mat-row","",3,"class","click",4,"matRowDef","matRowDefColumns"],["class","mat-row border",4,"matNoDataRow"],[1,"cursor-pointer","border","rounded-lg","px-3","p-1","flex","flex-row","space-x-2","items-center","justify-between"],[1,"w-full","flex","lg:p-0","p-2","lg:flex-row","lg:space-x-2","lg:items-center","lg:justify-between","flex-col","justify-center"],[1,"w-full","text-center"],[1,"w-full","flex","flex-row","space-x-2","items-center","lg:justify-end","justify-center"],[1,"font-bold","text-blue-600",3,"matMenuTriggerFor"],[1,"w-full","flex","flex-row","space-x-2","p-4",3,"click"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp S\u1ED1 L\u01B0\u1EE3ng",3,"ngModelChange","ngModel","ngModelOptions"],["mat-icon-button","","color","primary",3,"click"],[1,"pagination-controls"],["mat-icon-button","","color","primary",3,"click","disabled"],["mat-header-cell","",1,"!border","!bg-slate-100"],["mat-header-cell","","mat-sort-header","",1,"!border","whitespace-nowrap","!bg-slate-100"],["class","border","mat-cell","",4,"matCellDef"],["class","!border !bg-slate-100","mat-header-cell","",4,"matHeaderCellDef"],["class","!border whitespace-nowrap !bg-slate-100","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],[1,"max-w-40","line-clamp-4","me-4"],[3,"OutFilter","icon","ListItem","fieldsearch","ListFilter","filterItem"],["mat-cell","",1,"border"],[1,"max-w-40","line-clamp-4","font-bold","text-blue-600"],[1,""],[1,"max-w-40","line-clamp-4","text-xs"],[1,"max-w-40","line-clamp-4"],[1,"max-w-40","line-clamp-4","flex","items-center"],[1,"max-w-40","line-clamp-4","font-bold","text-blue-600",3,"click"],[1,"text-green-500"],[1,"text-red-500"],[1,"text-green-600","font-semibold","ms-1"],[1,"text-red-600","font-semibold","ms-1"],[1,"text-yellow-500"],[1,"text-yellow-600","font-semibold","ms-1"],[1,"text-gray-400"],[1,"text-gray-500","ms-1"],["mat-header-row",""],["mat-row","",1,"border",3,"click"],[1,"mat-row","border"],["colspan","4",1,"mat-cell","p-4"],[1,"flex","flex-col","space-y-8","items-center","justify-center"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary","mat-dialog-close","true"],["mat-flat-button","","color","warn","mat-dialog-close","false"],[1,"!w-screen","!h-screen","!max-h-screen","!relative","!flex","flex-col","space-y-8","items-center","justify-center"],[1,"relative","flex","flex-row","space-x-2","items-center"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp IdSheet",3,"ngModelChange","ngModel","ngModelOptions"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp SheetName",3,"ngModelChange","ngModel","ngModelOptions"],[1,"relative","h-full","w-full","overflow-auto"],[1,"relative","flex","flex-row","space-x-2","items-center","justify-center"]],template:function(e,t){if(e&1){let n=A();o(0,"mat-drawer-container",7)(1,"mat-drawer",8,0),F(3,"router-outlet"),r(),o(4,"div",9)(5,"div",10)(6,"div",11)(7,"div",12)(8,"div",13)(9,"input",14),v("ngModelChange",function(u){return p(n),b(t.searchModule,u)||(t.searchModule=u),g(u)}),_("keyup.enter",function(){return p(n),g(t.applySearch())}),r(),o(10,"div",15)(11,"span",16),s(12,"category"),r()()(),o(13,"div",13)(14,"input",17),v("ngModelChange",function(u){return p(n),b(t.searchAction,u)||(t.searchAction=u),g(u)}),_("keyup.enter",function(){return p(n),g(t.applySearch())}),r(),o(15,"div",15)(16,"span",16),s(17,"bolt"),r()()(),o(18,"div",13)(19,"input",18),v("ngModelChange",function(u){return p(n),b(t.searchValue,u)||(t.searchValue=u),g(u)}),_("keyup.enter",function(){return p(n),g(t.applySearch())}),r(),o(20,"div",15)(21,"span",16),s(22,"search"),r()()(),o(23,"div",19)(24,"input",20),v("ngModelChange",function(u){return p(n),b(t.searchDateFrom,u)||(t.searchDateFrom=u),g(u)}),r()(),o(25,"div",19)(26,"input",21),v("ngModelChange",function(u){return p(n),b(t.searchDateTo,u)||(t.searchDateTo=u),g(u)}),r()(),o(27,"button",22),_("click",function(){return p(n),g(t.applySearch())}),o(28,"mat-icon"),s(29,"search"),r()(),o(30,"button",23),_("click",function(){return p(n),g(t.clearFilters())}),o(31,"mat-icon"),s(32,"clear"),r()(),o(33,"button",24)(34,"mat-icon"),s(35,"file_download"),r()(),o(36,"mat-menu",null,1)(38,"button",25),_("click",function(){return p(n),g(t.exportToExcel("current"))}),o(39,"mat-icon"),s(40,"description"),r(),o(41,"span"),s(42),r()(),o(43,"button",25),_("click",function(){return p(n),g(t.exportToExcel("all"))}),o(44,"mat-icon"),s(45,"library_books"),r(),o(46,"span"),s(47),r()()(),o(48,"button",26)(49,"mat-icon"),s(50,"tune"),r()(),o(51,"mat-menu",null,2)(53,"div",27)(54,"mat-form-field",28)(55,"input",29),_("input",function(u){return p(n),g(t.doFilterColumns(u))})("click",function(u){return p(n),g(u.stopPropagation())}),r(),o(56,"mat-icon",30),s(57,"search"),r()()(),o(58,"div",31),J(59,ft,5,2,"button",32,_t),r()()(),F(61,"div",33),r()(),o(62,"div",34)(63,"table",35),J(64,Nt,4,2,"ng-container",36,oe),x(66,zt,1,0,"tr",37)(67,Rt,1,3,"tr",38)(68,$t,3,0,"tr",39),r()(),o(69,"div",40)(70,"div",41)(71,"span",42),s(72,"\u0110ang Xem "),o(73,"strong"),s(74),r(),s(75," - "),o(76,"strong"),s(77),r(),s(78),r(),o(79,"div",43)(80,"span",44,3),s(82),r(),o(83,"mat-menu",null,4)(85,"div",45),_("click",function(u){return p(n),g(u.stopPropagation())}),o(86,"mat-form-field",46)(87,"mat-label"),s(88,"S\u1ED1 l\u01B0\u1EE3ng"),r(),o(89,"input",47),v("ngModelChange",function(u){return p(n),b(t.pageSize,u)||(t.pageSize=u),g(u)}),r()(),o(90,"button",48),_("click",function(){p(n);let u=I(81);return g(t.onPageSizeChange(t.pageSize(),u))}),o(91,"mat-icon"),s(92,"published_with_changes"),r()()()(),o(93,"div",49)(94,"button",50),_("click",function(){return p(n),g(t.onPreviousPage())}),o(95,"mat-icon"),s(96,"keyboard_arrow_left"),r()(),o(97,"button",50),_("click",function(){return p(n),g(t.onNextPage())}),o(98,"mat-icon"),s(99,"keyboard_arrow_right"),r()()()()()()()(),x(100,Ot,11,0,"ng-template",null,5,Y)(102,jt,16,6,"ng-template",null,6,Y)}if(e&2){let n=I(37),l=I(52),u=I(84);c(),f("position","end"),c(8),E("ngModel",t.searchModule),c(5),E("ngModel",t.searchAction),c(5),E("ngModel",t.searchValue),c(5),E("ngModel",t.searchDateFrom),c(2),E("ngModel",t.searchDateTo),c(7),f("matMenuTriggerFor",n)("disabled",t.Listauditlog().length===0),c(9),S("Xu\u1EA5t trang hi\u1EC7n t\u1EA1i (",t.Listauditlog().length," b\u1EA3n ghi)"),c(5),S("Xu\u1EA5t t\u1EA5t c\u1EA3 (",t.total()," b\u1EA3n ghi)"),c(),f("matMenuTriggerFor",l),c(11),Q(t.FilterColumns),c(4),f("dataSource",t.dataSource),c(),Q(t.displayedColumns),c(2),f("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),c(),f("matRowDefColumns",t.displayedColumns),c(7),M((t.page()-1)*t.pageSize()+1),c(3),M(t.page()*t.pageSize()>t.total()?t.total():t.page()*t.pageSize()),c(),se(" trong s\u1ED1 ",t.total()," m\u1EE5c, ",t.page(),"/",t.pageCount()," Trang"),c(2),f("matMenuTriggerFor",u),c(2),S("Hi\u1EC7n Th\u1ECB : ",t.pageSize()," m\u1EE5c"),c(7),E("ngModel",t.pageSize),f("ngModelOptions",R(26,ee)),c(5),f("disabled",t.page()===1),c(3),f("disabled",t.page()===t.pageCount())}},dependencies:[ze,Ne,Pe,Be,$e,Re,tt,We,qe,Xe,Ge,Ue,Ke,Je,Qe,Ye,Ze,et,lt,H,rt,at,Ae,be,Ee,ve,Se,ye,Ce,me,xe,we,fe,he,_e,Oe,de,ce,Te,Me,Le,ke,nt,it,Ve,Fe,Ie,ct],encapsulation:2,changeDetection:0})};G([dt()],T.prototype,"FilterHederColumn",1),G([mt(300)],T.prototype,"doFilterHederColumn",1);var pt=T;export{U as a,pt as b};
