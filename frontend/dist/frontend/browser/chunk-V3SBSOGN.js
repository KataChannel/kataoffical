import{a as V,b as U}from"./chunk-2X4XX4D4.js";import"./chunk-S4NZZWBD.js";import"./chunk-QHCPJI62.js";import"./chunk-XHVJ7NZ3.js";import"./chunk-NULFSBS2.js";import"./chunk-SR7RCIEL.js";import"./chunk-EQHO5CVZ.js";import{d as z}from"./chunk-5NC4P5UG.js";import"./chunk-ZW44ZSN2.js";import"./chunk-P7BBNZNS.js";import"./chunk-LECLUHD2.js";import"./chunk-IE4L6KDU.js";import"./chunk-KE6HBPKL.js";import{b as Q}from"./chunk-F366E334.js";import{a as E,c as x}from"./chunk-N2KOTR2C.js";import{c as w,h as I}from"./chunk-ILGJOBJG.js";import"./chunk-H7UDLENL.js";import{a as M}from"./chunk-Q3KOS33T.js";import"./chunk-DP4FJZ2N.js";import{k as F}from"./chunk-OP3J4F3V.js";import{a as f,c as S}from"./chunk-OJMQSPC3.js";import"./chunk-OZW3KHHG.js";import{r as R,s as A}from"./chunk-LXFX5R3F.js";import{b as N}from"./chunk-KJ3ORMDZ.js";import{n as L,w as B,z as T}from"./chunk-M2YCC4SP.js";import"./chunk-KBSHTQVA.js";import{b as P}from"./chunk-PYCEOLIX.js";import"./chunk-NBQTKVUV.js";import"./chunk-FME5K2LE.js";import"./chunk-2PPFUFFT.js";import{e as b}from"./chunk-BAEDUNPT.js";import{_}from"./chunk-DL37TIRW.js";import"./chunk-5LF7WV5H.js";import{v}from"./chunk-GKGVKDD5.js";import{Db as k,Ra as d,md as D,pa as r,xc as C,yc as g,zc as y}from"./chunk-OL5DVADB.js";import"./chunk-LWLSKGAV.js";import{a as h,b as s,j as n}from"./chunk-6DYNGEAS.js";var W=class m{_ListChotkhoComponent=r(U);_ChotkhoService=r(V);_route=r(f);_router=r(S);_snackBar=r(M);_dialog=r(w);sort;dataSource=d(new A([]));displayedColumns=["STT","tensanpham","masanpham","donvitinh","sltonhethong","sltonthucte","slhuy","chenhlech"];ColumnName={STT:"STT",tensanpham:"T\xEAn S\u1EA3n Ph\u1EA9m",masanpham:"M\xE3 SP",donvitinh:"\u0110\u01A1n V\u1ECB",sltonhethong:"SL H\u1EC7 Th\u1ED1ng",sltonthucte:"SL Th\u1EF1c T\u1EBF",slhuy:"SL H\u1EE7y",chenhlech:"Ch\xEAnh L\u1EC7ch"};DetailChotkho=d({id:void 0,title:"",ngaychot:new Date,ghichu:"",khoId:"",userId:"",isActive:!0,details:[]});constructor(){this._route.paramMap.subscribe(t=>{let o=t.get("id");this._ChotkhoService.setChotkhoId(o)}),D(()=>n(this,null,function*(){let t=this._ChotkhoService.DetailChotkho();t&&(this.DetailChotkho.set(t),this.dataSource.update(o=>(o.data=t.details||[],o)),this.filterSanpham=t.details||[],console.log("DetailChotkho updated from service:",t))}))}isEdit=d(!1);isDelete=d(!1);chotkhoId=this._ChotkhoService.chotkhoId;ListSanpham=[];filterSanpham=[];ngOnInit(){return n(this,null,function*(){let t=this._ChotkhoService.chotkhoId();if(t||(this._router.navigate(["/admin/chotkho"]),this._ListChotkhoComponent.drawer.close()),t==="new"){let o={id:void 0,title:"",ngaychot:new Date,ghichu:"",khoId:"",userId:"",isActive:!0,details:[]};this.DetailChotkho.set(o),this._ChotkhoService.DetailChotkho.set(o),this._ListChotkhoComponent.drawer.open(),this.isEdit.update(e=>!0),this._router.navigate(["/admin/chotkho","new"])}else t&&(console.log("Loading chotkho by id:",t),yield this._ChotkhoService.getChotkhoById(t),setTimeout(()=>{let o=this._ChotkhoService.DetailChotkho();console.log("Service data after load:",o),console.log("Component data after load:",this.DetailChotkho()),console.log("DataSource data after load:",this.dataSource().data)},1e3),this._ListChotkhoComponent.drawer.open(),this._router.navigate(["/admin/chotkho",t]));yield this.loadSanphamList()})}handleChotkhoAction(){return n(this,null,function*(){this.chotkhoId()==="new"?yield this.createChotkho():yield this.updateChotkho()})}createChotkho(){return n(this,null,function*(){try{let t=this.DetailChotkho();yield this._ChotkhoService.createChotkhoWithDetails(t),this._snackBar.open("T\u1EA1o ch\u1ED1t kho th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(o=>!1)}catch(t){console.error("L\u1ED7i khi t\u1EA1o ch\u1ED1t kho:",t),this._snackBar.open("L\u1ED7i khi t\u1EA1o ch\u1ED1t kho","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}updateChotkho(){return n(this,null,function*(){try{let t=this.DetailChotkho();t?.id&&(yield this._ChotkhoService.updateChotkhoWithDetails(t.id,t),this._snackBar.open("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(o=>!1))}catch(t){console.error("L\u1ED7i khi c\u1EADp nh\u1EADt ch\u1ED1t kho:",t),this._snackBar.open("L\u1ED7i khi c\u1EADp nh\u1EADt ch\u1ED1t kho","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}DeleteData(){return n(this,null,function*(){try{let t=this.DetailChotkho();t?.id&&(yield this._ChotkhoService.deleteChotkho(t.id),this._snackBar.open("X\xF3a th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this._router.navigate(["/admin/chotkho"]))}catch(t){console.error("L\u1ED7i khi x\xF3a ch\u1ED1t kho:",t),this._snackBar.open("L\u1ED7i khi x\xF3a ch\u1ED1t kho","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}onQuantityChange(){let t=this.DetailChotkho();if(t){let o=Number(t.sltonhethong)||0,e=Number(t.sltonthucte)||0,a=Number(t.slhuy)||0,u=o-e-a;this.DetailChotkho.update(l=>s(h({},l),{chenhlech:u}))}}detailDisplayedColumns=["sanpham","sltonhethong","sltonthucte","slhuy","chenhlech","actions"];removeDetail(t){let e=(this.DetailChotkho().details||[]).filter(a=>a!==t);this.DetailChotkho.update(a=>s(h({},a),{details:e}))}updateChenhLech(t){let o=Number(t.sltonhethong)||0,e=Number(t.sltonthucte)||0,a=Number(t.slhuy)||0;t.chenhlech=o-e-a}goBack(){this._router.navigate(["/admin/chotkho"]),this._ListChotkhoComponent.drawer.close()}trackByFn(t,o){return o.id}toggleEdit(){this.isEdit.update(t=>!t)}toggleDelete(){this.isDelete.update(t=>!t)}FillSlug(){this.DetailChotkho.update(t=>(t.slug=z(t.title),t))}loadSanphamList(){return n(this,null,function*(){try{let t=yield this._ChotkhoService.getAllProducts();this.ListSanpham=t.map(o=>({id:o.id,sanphamId:o.id,tensanpham:o.tensanpham,masanpham:o.masanpham,donvitinh:o.donvitinh,sltonhethong:o.tonkho?.slton||0,sltonthucte:o.tonkho?.sltinhthucte||0,slhuy:o.tonkho?.slhuy||0,chenhlech:(o.tonkho?.slton||0)-(o.tonkho?.sltinhthucte||0)-(o.tonkho?.slhuy||0),dongia:o.dongia})),this.filterSanpham=[...this.ListSanpham]}catch(t){console.error("Error loading sanpham list:",t),this._snackBar.open("L\u1ED7i khi t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m","\u0110\xF3ng",{duration:3e3,panelClass:["snackbar-error"]})}})}DoOutFilter(t){return n(this,null,function*(){console.log("C\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m cho ch\u1ED1t kho:",t);try{this.DetailChotkho.update(o=>s(h({},o),{details:t.map(e=>({sanphamId:e.sanphamId||e.id,sanpham:{id:e.sanphamId||e.id,masanpham:e.masanpham,tensanpham:e.tensanpham,donvitinh:e.donvitinh,dongia:e.dongia},sltonhethong:Number(e.sltonhethong)||0,sltonthucte:Number(e.sltonthucte)||0,slhuy:Number(e.slhuy)||0,chenhlech:Number(e.chenhlech)||0,ghichu:e.ghichu||"",isActive:!0,tensanpham:e.tensanpham,masanpham:e.masanpham,donvitinh:e.donvitinh}))})),this.filterSanpham=this.DetailChotkho().details,this.dataSource.update(o=>(o.data=[...this.DetailChotkho().details],o.sort=this.sort,o)),console.log("Updated DetailChotkho:",this.DetailChotkho()),this._snackBar.open("C\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(o){console.error("L\u1ED7i c\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m:",o),this._snackBar.open("L\u1ED7i c\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}EmptyCart(){this.DetailChotkho.update(t=>s(h({},t),{details:[]})),this.dataSource.update(t=>(t.data=[],t)),this._snackBar.open("\u0110\xE3 x\xF3a t\u1EA5t c\u1EA3 s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}RemoveSanpham(t){let e=(this.DetailChotkho().details||[]).filter(a=>a.id!==t.id&&a.sanphamId!==t.sanphamId);this.DetailChotkho.update(a=>s(h({},a),{details:e})),this.dataSource.update(a=>(a.data=[...e],a)),this._snackBar.open("\u0110\xE3 x\xF3a s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}updateValue(t,o,e,a,u){t.preventDefault(),t.stopPropagation();let l=t.target.innerText.trim();if(u==="number"){let i=l.replace(/,/g,"").replace(/[^0-9.-]/g,"");l=Number(i)||0}console.log(`Updating ${a} with value:`,l),this.DetailChotkho.update(i=>{let O=(i.details||[]).map((p,j)=>{if(j===o||p.sanphamId===e.sanphamId){let c=h({},p);if(c[a]=l,a==="sltonthucte"||a==="slhuy"){let q=Number(c.sltonhethong)||0,G=Number(c.sltonthucte)||0,X=Number(c.slhuy)||0;c.chenhlech=q-G-X}return c}return p});return s(h({},i),{details:O})});let H=this.DetailChotkho().details||[];this.dataSource.update(i=>(i.data=[...H],i)),console.log("Updated DetailChotkho:",this.DetailChotkho())}saveChangesToServer(){return n(this,null,function*(){try{let t=this.DetailChotkho();t?.id&&t.id!=="new"&&(yield this._ChotkhoService.updateChotkhoWithDetails(t.id,t),this._snackBar.open("\u0110\xE3 l\u01B0u thay \u0111\u1ED5i l\xEAn server","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}))}catch(t){console.error("Error saving to server:",t),this._snackBar.open("L\u1ED7i khi l\u01B0u l\xEAn server","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}static \u0275fac=function(o){return new(o||m)};static \u0275cmp=k({type:m,selectors:[["app-detailchotkho"]],viewQuery:function(o,e){if(o&1&&C(E,5),o&2){let a;g(a=y())&&(e.sort=a.first)}},decls:0,vars:0,template:function(o,e){},dependencies:[B,T,L,P,b,N,I,F,_,R,x,v,Q],encapsulation:2})};export{W as DetailChotkhoComponent};
