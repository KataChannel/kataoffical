import{e as je}from"./chunk-FRNK27WW.js";import{a as Ye}from"./chunk-GPC4UUTR.js";import{a as Ke}from"./chunk-OEIEY2BD.js";import{a as He}from"./chunk-DFEBKCCY.js";import{a as qe}from"./chunk-4AJT53I6.js";import"./chunk-QPN3VMX3.js";import{b as Le,c as Ae,g as Oe,h as Be}from"./chunk-IJTLQ3P3.js";import{b as $e}from"./chunk-RLTNMUN6.js";import{a as fe,b as Ce,c as ht,d as be,e as ye}from"./chunk-2PVH7Z6P.js";import{e as vt}from"./chunk-6FM7CICS.js";import{a as le,b as se,c as ce,d as lt,f as st,h as ct}from"./chunk-EJAZH3JY.js";import{a as Qt,b as Xt,c as Jt}from"./chunk-Z2ZDGSWT.js";import{a as Zt,b as te,c as ee,d as ne}from"./chunk-UQRYBWA2.js";import"./chunk-H7UDLENL.js";import{a as pt,b as mt}from"./chunk-EPAD3OFC.js";import{a as gt}from"./chunk-L5GX4ZSB.js";import"./chunk-AZMUMNOS.js";import{a as tn}from"./chunk-YGTKRZ2Q.js";import{a as Ge,b as Ve,c as ze,k as Re}from"./chunk-IDXNS6DX.js";import{a as dt,b as ut,c as De,d as ke,e as Se,g as Ee,h as ve,j as we,k as Te,m as Me,n as Fe,p as Ne,q as Pe,r as Ie,s as wt}from"./chunk-POPZSE3V.js";import{b as xe}from"./chunk-POHUA43U.js";import{b as ae,g as ie,j as oe,n as re,p as de,r as ue,s as he,v as pe,w as me,y as ge,z as _e}from"./chunk-A3B3GZND.js";import"./chunk-AW6ETFJX.js";import{a as ot,b as rt}from"./chunk-MGAKVDEP.js";import{a as Wt}from"./chunk-CBIWJPH2.js";import"./chunk-2NDWID3Z.js";import"./chunk-KMDUY2WI.js";import{c as qt,d as jt,g as St,h as Et,j as Ut}from"./chunk-2PPFUFFT.js";import{a as nt,c as at,e as it}from"./chunk-K4TPENAW.js";import{_ as Kt,y as Ht,z as Yt}from"./chunk-27DT4LBZ.js";import{b as Rt,c as $t}from"./chunk-VF6Z3BLE.js";import"./chunk-HB5OTZ3Y.js";import{k as Gt,l as Vt,m as zt,t as tt,v as et}from"./chunk-CNCZQRZQ.js";import{$b as S,Cc as A,Db as j,Dc as s,Ec as k,Fc as C,Gc as kt,Hc as It,Ic as X,Jc as J,Kb as D,Kc as Z,Mc as Lt,Sc as E,Tb as yt,Ub as b,Uc as v,Wb as R,Xb as Mt,Xc as At,bc as Ft,cc as $,cd as Ot,dc as H,ec as o,fc as r,gc as N,hc as Nt,ic as Pt,kc as L,ld as Bt,pa as I,pc as f,rb as u,rc as c,vc as Dt,wb as bt,xc as U,ya as g,yc as W,za as _,zc as Q}from"./chunk-TAKLKH4V.js";import{a as O,b as q,d as ft,g as Ze,h as Ct,j as M}from"./chunk-WJTR2IJE.js";var Ue=(a,e)=>e.id||a;function dn(a,e){a&1&&(o(0,"div",9)(1,"div",13),N(2,"mat-spinner",14),o(3,"p",15),s(4,"\u0110ang t\u1EA3i d\u1EEF li\u1EC7u..."),r()()())}function un(a,e){if(a&1&&(o(0,"div",23)(1,"div",29)(2,"mat-icon",30),s(3,"inbox"),r()(),o(4,"p",31),s(5,"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u \u0111\u1EB7t h\xE0ng"),r(),o(6,"p",32),s(7,"Kh\xF4ng t\xECm th\u1EA5y \u0111\u01A1n \u0111\u1EB7t h\xE0ng n\xE0o cho s\u1EA3n ph\u1EA9m n\xE0y"),r(),o(8,"div",33)(9,"p"),s(10,"M\xE3 SP: "),o(11,"span",34),s(12),r()()()()),a&2){let t=c(2);u(12),k(t.data.product==null?null:t.data.product.masp)}}function hn(a,e){if(a&1&&(o(0,"tr",39)(1,"td",40),s(2),r(),o(3,"td",41),s(4),r(),o(5,"td",42),s(6),E(7,"number"),r(),o(8,"td",43),s(9),E(10,"number"),r(),o(11,"td",44)(12,"span",45),s(13),r()()()),a&2){let t=e.$implicit,n=c(3);u(2),k(t.mancc||"N/A"),u(2),C(" ",n.formatDateForDisplay(t.ngaydat||t.createdAt,"DD/MM/YYYY")," "),u(2),C(" ",v(7,6,t.sldat||t.soluong||0,"1.0-0")," "),u(3),C(" ",v(10,9,t.slnhan||t.soluongnhan||0,"1.0-0")," "),u(3),b("ngClass",n.getDathangStatusClass(t.trangthai||t.status)),u(),C(" ",n.getStatusText(t.trangthai||t.status)," ")}}function pn(a,e){if(a&1&&(o(0,"div",24)(1,"table",35)(2,"thead")(3,"tr",36)(4,"th",37),s(5,"M\xE3 \u0110\u1EB7t H\xE0ng"),r(),o(6,"th",37),s(7,"Ng\xE0y \u0110\u1EB7t"),r(),o(8,"th",38),s(9,"SL \u0110\u1EB7t"),r(),o(10,"th",38),s(11,"SL Nh\u1EADn"),r(),o(12,"th",37),s(13,"Tr\u1EA1ng Th\xE1i"),r()()(),o(14,"tbody"),$(15,hn,14,12,"tr",39,Ue),r()()()),a&2){let t=c(2);u(15),H(t.data.dathangData)}}function mn(a,e){if(a&1&&(o(0,"div",23)(1,"div",46)(2,"mat-icon",47),s(3,"inbox"),r()(),o(4,"p",31),s(5,"Ch\u01B0a c\xF3 d\u1EEF li\u1EC7u \u0111\u01A1n h\xE0ng"),r(),o(6,"p",32),s(7,"Kh\xF4ng t\xECm th\u1EA5y \u0111\u01A1n h\xE0ng n\xE0o cho s\u1EA3n ph\u1EA9m n\xE0y"),r(),o(8,"div",33)(9,"p"),s(10,"M\xE3 SP: "),o(11,"span",34),s(12),r()()()()),a&2){let t=c(2);u(12),k(t.data.product==null?null:t.data.product.masp)}}function gn(a,e){if(a&1&&(o(0,"tr",51)(1,"td",40),s(2),r(),o(3,"td",41),s(4),r(),o(5,"td",52),s(6),E(7,"number"),r(),o(8,"td",43),s(9),E(10,"number"),r(),o(11,"td",53),s(12),E(13,"number"),r(),o(14,"td",44)(15,"span",45),s(16),r()()()),a&2){let t=e.$implicit,n=c(3);u(2),k(t.madonhang||t.id||"N/A"),u(2),C(" ",n.formatDateForDisplay(t.ngaygiao||t.deliveryDate||t.createdAt,"DD/MM/YYYY")," "),u(2),C(" ",v(7,7,t.sldat||t.soluong||0,"1.0-0")," "),u(3),C(" ",v(10,10,t.slgiao||t.soluonggiao||0,"1.0-0")," "),u(3),C(" ",v(13,13,t.slnhan||t.soluongnhan||0,"1.0-0")," "),u(3),b("ngClass",n.getDonhangStatusClass(t.trangthai||t.status)),u(),C(" ",n.getStatusText(t.trangthai||t.status)," ")}}function _n(a,e){if(a&1&&(o(0,"div",24)(1,"table",35)(2,"thead")(3,"tr",48)(4,"th",49),s(5,"M\xE3 \u0110\u01A1n H\xE0ng"),r(),o(6,"th",49),s(7,"Ng\xE0y Giao"),r(),o(8,"th",50),s(9,"SL \u0110\u1EB7t"),r(),o(10,"th",50),s(11,"SL Giao"),r(),o(12,"th",50),s(13,"SL Nh\u1EADn"),r(),o(14,"th",49),s(15,"Tr\u1EA1ng Th\xE1i"),r()()(),o(16,"tbody"),$(17,gn,17,16,"tr",51,Ue),r()()()),a&2){let t=c(2);u(17),H(t.data.donhangData)}}function xn(a,e){if(a&1&&(o(0,"div",10)(1,"div",16)(2,"div",17)(3,"div",18)(4,"div",19)(5,"button",2)(6,"mat-icon",3),s(7,"shopping_cart"),r()(),o(8,"h4",20),s(9,"\u0110\u1EB7t H\xE0ng"),r(),o(10,"span",21),s(11),r()()()(),o(12,"div",22),D(13,un,13,1,"div",23)(14,pn,17,0,"div",24),r()(),o(15,"div",25)(16,"div",26)(17,"div",18)(18,"div",19)(19,"button",2)(20,"mat-icon",3),s(21,"local_shipping"),r()(),o(22,"h4",27),s(23,"\u0110\u01A1n H\xE0ng"),r(),o(24,"span",28),s(25),r()()()(),o(26,"div",22),D(27,mn,13,1,"div",23)(28,_n,19,0,"div",24),r()()()),a&2){let t=c();u(11),C(" ",t.data.dathangData.length," "),u(2),S(t.data.dathangData.length===0?13:14),u(12),C(" ",t.data.donhangData.length," "),u(2),S(t.data.donhangData.length===0?27:28)}}var _t=class a{constructor(e,t){this.dialogRef=e;this.data=t}timezoneService=I(gt);cdr=I(Ot);ngOnInit(){console.log("Dialog initialized with data:",this.data),this.data&&(this.data.triggerChangeDetection=()=>{console.log("Triggering change detection, loading:",this.data.loading),this.cdr.detectChanges()})}triggerChangeDetection(){this.cdr.detectChanges()}closeDialog(){this.dialogRef.close()}formatDateForDisplay(e,t="DD/MM/YYYY"){return this.timezoneService.formatForDisplay(e,t)}getDathangStatusClass(e){return{"bg-green-100 text-green-800":e==="completed","bg-yellow-100 text-yellow-800":e==="pending","bg-blue-100 text-blue-800":e==="processing","bg-gray-100 text-gray-800":!e||e==="unknown"}}getDonhangStatusClass(e){return{"bg-green-100 text-green-800":e==="delivered","bg-blue-100 text-blue-800":e==="shipping","bg-yellow-100 text-yellow-800":e==="pending","bg-orange-100 text-orange-800":e==="processing","bg-gray-100 text-gray-800":!e||e==="unknown"}}getStatusText(e){return{completed:"Ho\xE0n th\xE0nh",pending:"Ch\u1EDD x\u1EED l\xFD",processing:"\u0110ang x\u1EED l\xFD",delivered:"\u0110\xE3 giao",shipping:"\u0110ang giao",cancelled:"\u0110\xE3 h\u1EE7y"}[e]||e||"Kh\xF4ng x\xE1c \u0111\u1ECBnh"}static \u0275fac=function(t){return new(t||a)(bt(le),bt(se))};static \u0275cmp=j({type:a,selectors:[["app-nested-data-dialog"]],decls:21,vars:3,consts:[[1,"flex","items-center","justify-between","p-4"],[1,"flex","items-center","space-x-3"],["mat-icon-button",""],["color","primary",1,"text-white"],[1,"text-xl","font-bold"],[1,"text-blue-100","text-sm"],[1,"font-mono","bg-white","bg-opacity-20","px-2","py-1","rounded"],["mat-icon-button","","matTooltip","\u0110\xF3ng",1,"text-white","hover:bg-white","hover:bg-opacity-20","transition-colors","duration-200",3,"click"],[1,"mat-typography"],[1,"flex","items-center","justify-center","py-16"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],["align","end",1,"flex","flex-row","justify-end"],["mat-button","","color","warn","mat-dialog-close",""],[1,"text-center"],["diameter","50",1,"mx-auto","mb-4"],[1,"text-gray-600","text-lg","animate-pulse"],[1,"bg-blue-50","rounded-lg","border","border-blue-200","overflow-hidden"],[1,"bg-blue-100","px-4","py-3","border-b","border-blue-200"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","space-x-2"],[1,"font-semibold","text-blue-800","!m-0","!p-0"],[1,"bg-blue-200","text-blue-800","px-2","py-1","rounded-full","text-xs","font-medium"],[1,"p-4","max-h-96","overflow-y-auto"],[1,"text-center","py-8"],[1,"overflow-x-auto"],[1,"bg-green-50","rounded-lg","border","border-green-200","overflow-hidden"],[1,"bg-green-100","px-4","py-3","border-b","border-green-200"],[1,"font-semibold","text-green-800","!m-0","!p-0"],[1,"bg-green-200","text-green-800","px-2","py-1","rounded-full","text-xs","font-medium"],[1,"bg-blue-100","p-4","rounded-full","w-16","h-16","mx-auto","mb-4","flex","items-center","justify-center"],[1,"text-4xl","text-blue-300"],[1,"text-gray-500","font-medium"],[1,"text-gray-400","text-sm","mt-1"],[1,"mt-3","text-xs","text-gray-400"],[1,"font-mono"],[1,"w-full","border-collapse"],[1,"border-b","border-blue-200"],[1,"text-left","p-2","text-xs","font-semibold","text-blue-800"],[1,"text-right","p-2","text-xs","font-semibold","text-blue-800"],[1,"border-b","border-blue-100","hover:bg-blue-50","transition-colors","duration-150"],[1,"p-2","font-mono","text-xs"],[1,"p-2","text-xs"],[1,"p-2","text-right","text-xs","font-semibold","text-blue-700"],[1,"p-2","text-right","text-xs","font-semibold","text-green-600"],[1,"p-2"],[1,"px-2","py-1","rounded-full","text-xs","font-medium",3,"ngClass"],[1,"bg-green-100","p-4","rounded-full","w-16","h-16","mx-auto","mb-4","flex","items-center","justify-center"],[1,"text-4xl","text-green-300"],[1,"border-b","border-green-200"],[1,"text-left","p-2","text-xs","font-semibold","text-green-800"],[1,"text-right","p-2","text-xs","font-semibold","text-green-800"],[1,"border-b","border-green-100","hover:bg-green-50","transition-colors","duration-150"],[1,"p-2","text-right","text-xs","font-semibold","text-blue-600"],[1,"p-2","text-right","text-xs","font-semibold","text-purple-600"]],template:function(t,n){t&1&&(o(0,"div",0)(1,"div",1)(2,"button",2)(3,"mat-icon",3),s(4,"inventory_2"),r()(),o(5,"div")(6,"h3",4),s(7),r(),o(8,"p",5),s(9," M\xE3 SP: "),o(10,"span",6),s(11),r()()()(),o(12,"button",7),f("click",function(){return n.closeDialog()}),o(13,"mat-icon"),s(14,"close"),r()()(),o(15,"mat-dialog-content",8),D(16,dn,5,0,"div",9)(17,xn,29,4,"div",10),r(),o(18,"div",11)(19,"button",12),s(20,"\u0110\xF3ng"),r()()),t&2&&(u(7),k((n.data.product==null?null:n.data.product.title)||"Chi ti\u1EBFt s\u1EA3n ph\u1EA9m"),u(4),k((n.data.product==null?null:n.data.product.masp)||"N/A"),u(5),S(n.data.loading?16:17))},dependencies:[et,Gt,tt,ct,lt,st,it,nt,at,rt,ot,mt,pt,ut,dt],styles:[".mat-mdc-dialog-container[_ngcontent-%COMP%]{max-width:95vw!important;max-height:95vh!important}.p-4.max-h-96.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.p-4.max-h-96.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#0000001a;border-radius:3px}.p-4.max-h-96.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#0000004d;border-radius:3px}.p-4.max-h-96.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#00000080}.border-b.hover\\:bg-blue-50[_ngcontent-%COMP%]:hover{background-color:#3b82f60d!important}.border-b.hover\\:bg-green-50[_ngcontent-%COMP%]:hover{background-color:#22c55e0d!important}.mat-mdc-dialog-content[_ngcontent-%COMP%]{padding:0 24px!important}.bg-gradient-to-r.from-blue-600.to-blue-700[_ngcontent-%COMP%]{background:linear-gradient(135deg,#2563eb,#1d4ed8)}.animate-pulse[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}.px-2.py-1.rounded-full.text-xs.font-medium[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;min-width:60px;text-align:center;font-weight:600;letter-spacing:.025em}@media (max-width: 1024px){.grid.grid-cols-1.lg\\:grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}.mat-mdc-dialog-container[_ngcontent-%COMP%]{max-width:98vw!important;margin:8px}}.text-4xl.text-blue-300[_ngcontent-%COMP%], .text-4xl.text-green-300[_ngcontent-%COMP%]{font-size:3rem;opacity:.6}"],changeDetection:0})};var Tt=Ze(tn());var fn=["drawer"],Cn=()=>({standalone:!0}),bn=(a,e)=>e.key;function yn(a,e){a&1&&(o(0,"div",40),s(1," \u26A0\uFE0F C\xF3 thay \u0111\u1ED5i ng\xE0y ch\u01B0a \u0111\u01B0\u1EE3c \xE1p d\u1EE5ng "),r())}function Dn(a,e){if(a&1){let t=L();o(0,"button",73),f("click",function(i){let d=g(t).$implicit;return c().toggleColumn(d),_(i.stopPropagation())}),o(1,"mat-icon"),s(2),r(),o(3,"span"),s(4),r()()}if(a&2){let t=e.$implicit;u(2),k(t.isShow?"check_box":"check_box_outline_blank"),u(2),k(t.value)}}function kn(a,e){a&1&&N(0,"mat-spinner",49)}function Sn(a,e){a&1&&(o(0,"mat-icon"),s(1,"file_download"),r())}function En(a,e){a&1&&N(0,"mat-spinner",49)}function vn(a,e){a&1&&(o(0,"mat-icon"),s(1,"refresh"),r())}function wn(a,e){if(a&1&&(o(0,"span",53),s(1),r()),a&2){let t=c();u(),kt(" \u{1F4C5} ",t.formatDateForDisplay(t.batdau,"DD/MM")," - ",t.formatDateForDisplay(t.ketthuc,"DD/MM")," ")}}function Tn(a,e){a&1&&(N(0,"mat-spinner",74),o(1,"span"),s(2,"\u0110ang c\u1EADp nh\u1EADt..."),r())}function Mn(a,e){a&1&&(o(0,"span"),s(1,"\u{1F4C1} C\u1EADp Nh\u1EADt T\u1ED3n Kho"),r())}function Fn(a,e){if(a&1&&(o(0,"div",56)(1,"div",75),N(2,"mat-spinner",76),o(3,"div",77)(4,"h3",78),s(5),r()()()()),a&2){let t=c();u(5),C(" ",t.isRefreshing?"\u0110ang l\xE0m m\u1EDBi...":"\u0110ang t\u1EA3i d\u1EEF li\u1EC7u..."," ")}}function Nn(a,e){a&1&&N(0,"span")}function Pn(a,e){if(a&1&&(o(0,"div",28)(1,"span",92),s(2),r(),o(3,"span",93,7),s(5," filter_alt "),r()()),a&2){c();let t=A(4),n=c().$implicit,i=c();u(2),C(" ",i.ColumnName[n]," "),u(),Dt("matTooltip","Filter ",i.ColumnName[n],""),b("matMenuTriggerFor",t)}}function In(a,e){a&1&&(o(0,"span",97),s(1,"check"),r())}function Ln(a,e){a&1&&N(0,"span",98)}function An(a,e){if(a&1&&(o(0,"span"),s(1),r()),a&2){let t=c().$implicit,n=c(2).$implicit,i=c();u(),k(i.formatDateForDisplay(t[n],"DD/MM/YYYY"))}}function On(a,e){if(a&1&&(o(0,"span"),s(1),r()),a&2){let t=c().$implicit,n=c(2).$implicit,i=c();u(),k(i.formatDateForDisplay(t[n],"DD/MM/YYYY"))}}function Bn(a,e){if(a&1&&(o(0,"span"),s(1),r()),a&2){let t=c().$implicit,n=c(2).$implicit,i=c();u(),k(i.formatDateForDisplay(t[n],"DD/MM/YYYY"))}}function Gn(a,e){if(a&1&&(o(0,"span"),s(1),E(2,"number"),r()),a&2){let t=c().$implicit,n=c(2).$implicit;u(),k(v(2,1,t[n],"1.0-0"))}}function Vn(a,e){if(a&1&&(o(0,"span"),s(1),E(2,"number"),r()),a&2){let t=c().$implicit,n=c(2).$implicit;u(),k(v(2,1,t[n],"1.0-0"))}}function zn(a,e){if(a&1&&(o(0,"span"),s(1),E(2,"number"),r()),a&2){let t=c().$implicit,n=c(2).$implicit;u(),k(v(2,1,t[n],"1.0-0"))}}function Rn(a,e){if(a&1&&(o(0,"span"),s(1),E(2,"number"),r()),a&2){let t=c().$implicit,n=c(2).$implicit;u(),k(v(2,1,t[n],"1.0-0"))}}function $n(a,e){if(a&1&&(o(0,"span"),s(1),E(2,"number"),r()),a&2){let t=c().$implicit,n=c(2).$implicit;u(),k(v(2,1,t[n],"1.0-0"))}}function Hn(a,e){if(a&1&&(o(0,"span"),s(1),r()),a&2){let t=c().$implicit,n=c(2).$implicit;u(),k(t[n]||"Tr\u1ED1ng")}}function Yn(a,e){if(a&1){let t=L();o(0,"div",94),f("click",function(){let i=g(t).$implicit,d=c(2).$implicit,l=c();return _(l.ChosenItem(i,d))}),D(1,In,2,0,"span",95)(2,Ln,1,0,"span",96)(3,An,2,1,"span")(4,On,2,1,"span")(5,Bn,2,1,"span")(6,Gn,3,4,"span")(7,Vn,3,4,"span")(8,zn,3,4,"span")(9,Rn,3,4,"span")(10,$n,3,4,"span")(11,Hn,2,1,"span"),r()}if(a&2){let t,n=e.$implicit,i=c(2).$implicit,d=c();u(),b("ngIf",d.CheckItem(n)),u(),b("ngIf",!d.CheckItem(n)),u(),S((t=i)==="createdAt"?3:t==="updatedAt"?4:t==="ngaynhan"?5:t==="slton"?6:t==="slchogiao"?7:t==="slchonhap"?8:t==="SLDat"?9:t==="SLGiao"?10:11)}}function Kn(a,e){if(a&1){let t=L();o(0,"th",81),D(1,Nn,1,0,"span")(2,Pn,6,4,"div",28),o(3,"mat-menu",82,10)(5,"div",83),f("click",function(i){return g(t),_(i.stopPropagation())}),o(6,"div",84)(7,"input",85),f("keyup",function(i){g(t);let d=c().$implicit,l=c();return _(l.doFilterHederColumn(i,d))}),r(),o(8,"div",18)(9,"span",19),s(10,"search"),r()()(),o(11,"div",86)(12,"div",87)(13,"span",88),f("click",function(){g(t);let i=c().$implicit,d=c();return _(d.ChosenAll(d.getCurrentFilteredData(i)))}),s(14),r(),o(15,"span",88),f("click",function(){g(t);let i=c(2);return _(i.EmptyFiter())}),s(16,"Xo\xE1"),r()(),o(17,"span",88),f("click",function(){g(t);let i=c(2);return _(i.ResetFilter())}),s(18,"Reset"),r()(),o(19,"div",89),D(20,Yn,12,3,"div",90),r(),o(21,"div",91)(22,"button",70),f("click",function(){g(t);let i=c(2),d=A(116);return _(i.ApplyFilterColum(d))}),s(23,"\xC1p D\u1EE5ng"),r()()()()()}if(a&2){let t=c().$implicit,n=c();u(),S(t==="expand"?1:2),u(6),Dt("placeholder","T\xECm ki\u1EBFm ",n.ColumnName[t],"..."),u(7),C(" Ch\u1ECDn T\u1EA5t C\u1EA3 (",n.getCurrentFilteredData(t).length||0,") "),u(6),b("ngForOf",n.getCurrentFilteredData(t))("ngForTrackBy",n.trackByFn)}}function qn(a,e){a&1&&(o(0,"div",116),N(1,"div",118),r())}function jn(a,e){if(a&1&&(o(0,"span",117),s(1),r()),a&2){let t=c(2).$implicit,n=c(2);u(),C(" ",n.getTotalNestedDataCount(t.masp)," ")}}function Un(a,e){if(a&1){let t=L();o(0,"div",100)(1,"button",114),f("click",function(i){g(t);let d=c().$implicit;return c(2).toggleExpanded(d),_(i.stopPropagation())}),o(2,"mat-icon",115),s(3," visibility "),r(),D(4,qn,2,0,"div",116),r(),D(5,jn,2,1,"span",117),r()}if(a&2){let t=c().$implicit,n=c(2);u(),b("matTooltip","Xem \u0111\u1EB7t h\xE0ng & \u0111\u01A1n h\xE0ng"),yt("aria-label","Xem chi ti\u1EBFt"),u(3),S(n.isAnyDataLoading(t.masp)?4:-1),u(),S(n.hasNestedData(t.masp)?5:-1)}}function Wn(a,e){if(a&1&&(o(0,"span",101),s(1),r()),a&2){let t=c().index;u(),C(" ",t+1," ")}}function Qn(a,e){if(a&1&&(o(0,"span",102),s(1),r()),a&2){let t=c().$implicit,n=c().$implicit;b("matTooltip",t[n]),u(),C(" ",t[n]," ")}}function Xn(a,e){if(a&1&&(o(0,"span",103),s(1),r()),a&2){let t=c().$implicit,n=c().$implicit;u(),C(" ",t[n]," ")}}function Jn(a,e){if(a&1&&(o(0,"span",119),s(1),E(2,"number"),r()),a&2){let t=c().$implicit,n=c().$implicit;R("text-red-600",t[n]<=0)("text-green-600",t[n]>0),u(),C(" ",v(2,5,t[n],"1.0-0")," ")}}function Zn(a,e){if(a&1&&(o(0,"span",105),s(1),E(2,"number"),r()),a&2){let t=c().$implicit,n=c().$implicit;u(),C(" ",v(2,1,t[n],"1.0-0")," ")}}function ta(a,e){if(a&1&&(o(0,"span",106),s(1),E(2,"number"),r()),a&2){let t=c().$implicit,n=c().$implicit;u(),C(" ",v(2,1,t[n],"1.0-0")," ")}}function ea(a,e){if(a&1&&(o(0,"span",107),s(1),E(2,"number"),r()),a&2){let t=c().$implicit,n=c().$implicit;u(),C(" ",v(2,1,t[n],"1.0-0")," ")}}function na(a,e){if(a&1&&(o(0,"span",108),s(1),E(2,"number"),r()),a&2){let t=c().$implicit,n=c().$implicit;u(),C(" ",v(2,1,t[n],"1.0-0")," ")}}function aa(a,e){if(a&1&&(o(0,"span",120),s(1),E(2,"number"),r()),a&2){let t=c(2).$implicit,n=c().$implicit;u(),k(v(2,1,t[n],"1.0-0"))}}function ia(a,e){if(a&1&&(o(0,"span",121),s(1),E(2,"number"),r()),a&2){let t=c(2).$implicit,n=c().$implicit,i=c();u(),C("(",v(2,1,i.GetAbs(t[n]),"1.0-0"),")")}}function oa(a,e){if(a&1&&(o(0,"span",122),s(1),E(2,"number"),r()),a&2){let t=c(2).$implicit,n=c().$implicit,i=c();u(),k(v(2,1,i.GetAbs(t[n]),"1.0-0"))}}function ra(a,e){if(a&1&&D(0,aa,3,4,"span",120)(1,ia,3,4,"span",121)(2,oa,3,4,"span",122),a&2){let t=c().$implicit,n=c().$implicit;S(t[n]>0?0:t[n]<0?1:2)}}function la(a,e){if(a&1&&(o(0,"span",109),s(1),r()),a&2){let t=c().$implicit,n=c().$implicit,i=c();u(),C(" ",i.formatDateForDisplay(t[n],"DD/MM/YYYY")," ")}}function sa(a,e){if(a&1&&(o(0,"span",109),s(1),r()),a&2){let t=c().$implicit,n=c().$implicit,i=c();u(),C(" ",i.formatDateForDisplay(t[n],"DD/MM/YYYY")," ")}}function ca(a,e){if(a&1&&(o(0,"span",109),s(1),r()),a&2){let t=c().$implicit,n=c().$implicit,i=c();u(),C(" ",i.formatDateForDisplay(t[n],"DD/MM/YYYY")," ")}}function da(a,e){a&1&&(o(0,"mat-icon",123),s(1,"check_circle"),r())}function ua(a,e){a&1&&(o(0,"mat-icon",124),s(1,"cancel"),r())}function ha(a,e){if(a&1&&(o(0,"span",110),D(1,da,2,0,"mat-icon",123)(2,ua,2,0,"mat-icon",124),r()),a&2){let t=c().$implicit,n=c().$implicit;u(),S(t[n]?1:2)}}function pa(a,e){if(a&1){let t=L();o(0,"input",128),f("keydown",function(i){g(t);let d=c(2).$implicit,l=c(2);return _(l.onFieldKeyDown(i,d,"ghichu"))})("blur",function(i){g(t);let d=c(2).$implicit,l=c(2);return _(l.onFieldBlur(i,d,"ghichu"))}),r()}if(a&2){let t=c(2).$implicit,n=c(2);b("value",n.getFieldValue(t,"ghichu"))}}function ma(a,e){a&1&&(o(0,"mat-icon",131),s(1,"edit"),r())}function ga(a,e){if(a&1){let t=L();o(0,"div",129),f("click",function(){g(t);let i=c(2).$implicit,d=c(2);return _(d.startEdit(i,"ghichu"))}),o(1,"span",130),s(2),r(),D(3,ma,2,0,"mat-icon",131),r()}if(a&2){let t=c(2).$implicit,n=c(2);R("bg-yellow-50",n.hasFieldChanged(t,"ghichu"))("border-yellow-400",n.hasFieldChanged(t,"ghichu")),b("matTooltip",n.getFieldValue(t,"ghichu")||"Click \u0111\u1EC3 ch\u1EC9nh s\u1EEDa"),u(2),C(" ",n.getFieldValue(t,"ghichu")||"---"," "),u(),S(n.hasFieldChanged(t,"ghichu")?3:-1)}}function _a(a,e){if(a&1){let t=L();o(0,"div",125),f("click",function(i){return g(t),_(i.stopPropagation())}),D(1,pa,1,1,"input",126)(2,ga,4,7,"div",127),r()}if(a&2){let t=c().$implicit,n=c(2);u(),S(n.isEditing(t,"ghichu")?1:2)}}function xa(a,e){if(a&1){let t=L();o(0,"input",135),f("keydown",function(i){g(t);let d=c(2).$implicit,l=c(2);return _(l.onFieldKeyDown(i,d,"xSLDat"))})("blur",function(i){g(t);let d=c(2).$implicit,l=c(2);return _(l.onFieldBlur(i,d,"xSLDat"))}),r()}if(a&2){let t=c(2).$implicit,n=c(2);b("value",n.getFieldValue(t,"xSLDat"))}}function fa(a,e){a&1&&(o(0,"mat-icon",131),s(1,"edit"),r())}function Ca(a,e){if(a&1){let t=L();o(0,"div",136),f("click",function(){g(t);let i=c(2).$implicit,d=c(2);return _(d.startEdit(i,"xSLDat"))}),s(1),E(2,"number"),D(3,fa,2,0,"mat-icon",131),r()}if(a&2){let t=c(2).$implicit,n=c(2);R("bg-yellow-50",n.hasFieldChanged(t,"xSLDat"))("border-yellow-400",n.hasFieldChanged(t,"xSLDat"))("text-purple-600",n.getFieldValue(t,"xSLDat")>0),u(),C(" ",v(2,8,n.getFieldValue(t,"xSLDat")||0,"1.0-0")," "),u(2),S(n.hasFieldChanged(t,"xSLDat")?3:-1)}}function ba(a,e){if(a&1){let t=L();o(0,"div",132),f("click",function(i){return g(t),_(i.stopPropagation())}),D(1,xa,1,1,"input",133)(2,Ca,4,11,"div",134),r()}if(a&2){let t=c().$implicit,n=c(2);u(),S(n.isEditing(t,"xSLDat")?1:2)}}function ya(a,e){if(a&1&&(o(0,"span",113),s(1),r()),a&2){let t=c().$implicit,n=c().$implicit;b("matTooltip",t[n]),u(),C(" ",t[n]," ")}}function Da(a,e){if(a&1&&(o(0,"td",99),D(1,Un,6,4,"div",100)(2,Wn,2,1,"span",101)(3,Qn,2,2,"span",102)(4,Xn,2,1,"span",103)(5,Jn,3,8,"span",104)(6,Zn,3,4,"span",105)(7,ta,3,4,"span",106)(8,ea,3,4,"span",107)(9,na,3,4,"span",108)(10,ra,3,1)(11,la,2,1,"span",109)(12,sa,2,1,"span",109)(13,ca,2,1,"span",109)(14,ha,3,1,"span",110)(15,_a,3,1,"div",111)(16,ba,3,1,"div",112)(17,ya,2,2,"span",113),r()),a&2){let t,n=c().$implicit;u(),S((t=n)==="expand"?1:t==="STT"?2:t==="title"?3:t==="masp"?4:t==="slton"?5:t==="slchogiao"?6:t==="slchonhap"?7:t==="SLDat"?8:t==="SLGiao"?9:t==="goiy"?10:t==="createdAt"?11:t==="updatedAt"?12:t==="ngaynhan"?13:t==="isActive"?14:t==="ghichu"?15:t==="xSLDat"?16:17)}}function ka(a,e){if(a&1&&(Nt(0,59),D(1,Kn,24,6,"th",79)(2,Da,18,1,"td",80),Pt()),a&2){let t=e.$implicit;b("matColumnDef",t)}}function Sa(a,e){a&1&&N(0,"tr",137)}function Ea(a,e){if(a&1){let t=L();o(0,"tr",138),f("click",function(){let i=g(t).$implicit,d=c();return _(d.AddToEdit(i))}),r()}if(a&2){let t=e.$implicit,n=c();R("bg-slate-200",n.CheckItemInEdit(t))}}function va(a,e){if(a&1&&(o(0,"tr",139)(1,"td",140)(2,"div",141)(3,"mat-icon",142),s(4,"search_off"),r(),o(5,"span"),s(6,"Kh\xF4ng t\xECm th\u1EA5y d\u1EEF li\u1EC7u"),r()()()()),a&2){let t=c();u(),yt("colspan",t.displayedColumns.length)}}function wa(a,e){a&1&&(o(0,"mat-dialog-content")(1,"div",143)(2,"div",144),s(3,"X\xE1c Nh\u1EADn"),r(),o(4,"div"),s(5,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),r(),o(6,"div",145)(7,"button",146),s(8,"\u0110\u1ED3ng \xDD"),r(),o(9,"button",147),s(10,"Hu\u1EF7 B\u1ECF"),r()()()())}var Y=class Y{displayedColumns=["expand","title","masp","dvt","mancc","name","ghichu","xSLDat","goiy","khachdat","khachgiao","tongkho","sltontt","kho1","kho2","kho3","kho4","kho5","kho6","haohut","slhaohut"];ColumnName={expand:"",title:"T\xEAn S\u1EA3n Ph\u1EA9m",masp:"M\xE3 S\u1EA3n Ph\u1EA9m",dvt:"\u0110VT",mancc:"M\xE3 NCC",name:"T\xEAn Nh\xE0 Cung C\u1EA5p",ghichu:"Ghi Ch\xFA",xSLDat:"SL \u0110\u1EB7t (Nh\xE0 CC)",goiy:"SL C\u1EA7n \u0110\u1EB7t (G\u1EE3i \xDD)",khachdat:"T\u1ED4NG SL KH\xC1CH \u0110\u1EB6T",khachgiao:"T\u1ED4NG SL B\xC1N",tongkho:"T\u1ED5ng Kho",sltontt:"T\u1ED3n Kho tt",kho1:"TG-LONG AN",kho2:"B\u1ED5 Sung",kho3:"TG-\u0110\xC0 L\u1EA0T",kho4:"KHO T\u1ED4NG - HCM",kho5:"SG1",kho6:"SG2",haohut:"T\u1EC9 L\u1EC7 Hao H\u1EE5t",slhaohut:"SL Hao H\u1EE5t"};FilterColumns=JSON.parse(localStorage.getItem("NhucauColFilter")||"[]");Columns=[];totalItems=0;pageSize=50;currentPage=1;totalPages=1;paginator;sort;drawer;_SanphamService=I(qe);_breakpointObserver=I(Ht);_GraphqlService=I(He);_router=I($t);_dialog=I(ce);_timezoneService=I(gt);_DathangService=I(Ye);_DonhangService=I(Ke);_snackBar=I(Wt);Listsanpham=this._SanphamService.ListSanpham;TonghopsFinal=[];TonghopsExportFinal=[];EditList=[];dataSource=new wt;ListFilter=[];ListDathang=[];isSubmit=!1;quickFilter="all";globalFilterValue="";expandedElementId=null;dathangDataMap=new Map;donhangDataMap=new Map;loadingDathang=new Set;loadingDonhang=new Set;isLoading=!1;isExportingExcel=!1;isImportingExcel=!1;isUpdatingStock=!1;isRefreshing=!1;loadingMessage="";progressPercentage=0;batdau=new Date;ketthuc=new Date;isDateRangeEnabled=!1;hasUnappliedDateChanges=!1;editingRows=new Map;tempStorage=new Map;STORAGE_KEY="nhucau_temp_edits";constructor(){Bt(()=>{let e=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();this.dataSource.data=e,this.totalItems=e.length,this.calculateTotalPages()})}ngOnInit(){return M(this,null,function*(){let e=new Date;this.batdau=new Date(e),this.ketthuc=new Date(e),this.loadTempEditsFromStorage(),this.updateDisplayData(),this.loadDonhangWithRelations(),yield this._SanphamService.getNhucau(),this.dataSource=new wt(this.Listsanpham()),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource.sortingDataAccessor=(t,n)=>{switch(n){case"slton":case"slchogiao":case"slchonhap":case"SLDat":case"SLGiao":case"kho1":case"kho2":case"kho3":case"kho4":case"kho5":case"kho6":case"haohut":case"slhaohut":return Number(t[n])||0;case"goiy":return parseFloat(this.GetGoiy(t));case"title":case"masp":case"dvt":case"mancc":case"name":case"makho":case"namekho":return t[n]?.toLowerCase()||"";default:return t[n]?.toString().toLowerCase()||""}},this.initializeColumns(),this.setupDrawer()})}GetGoiy(e){return(Number(e.khachdat)+Number(this.GetSLHaohut(e))-Number(e.tongkho)).toFixed(3)}GetAbs(e){return Math.abs(Number(e)||0).toFixed(3)}GetSLHaohut(e){return e.khachdat>0?(e.khachdat*(e.haohut||0)/100).toFixed(3):0}loadDonhangWithRelations(){return M(this,null,function*(){try{this.isLoading=!1,this.loadingMessage="\u0110ang t\u1EA3i d\u1EEF li\u1EC7u \u0111\u01A1n h\xE0ng...",this.progressPercentage=0;let e,t;if(this.isDateRangeEnabled&&this.batdau&&this.ketthuc){let h=this._timezoneService.getAPIDateRange(this.batdau,this.ketthuc);e=h.Batdau,t=h.Ketthuc}else{let h=new Date,x=this._timezoneService.getAPIDateRange(h,h);e=x.Batdau,t=x.Ketthuc}this.progressPercentage=25,this.loadingMessage="\u0110ang x\u1EED l\xFD d\u1EEF li\u1EC7u...";let[n,i,d,l]=yield Promise.all([this._GraphqlService.findAll("donhang",{enableParallelFetch:!0,batchSize:1e3,take:999999,aggressiveCache:!0,orderBy:{createdAt:"desc"},where:{ngaygiao:{gte:e,lte:t}},select:{id:!0,madonhang:!0,ngaygiao:!0,status:!0,sanpham:{select:{giaban:!0,sldat:!0,slgiao:!0,slnhan:!0,sanpham:{select:{masp:!0}}}}}}),this._GraphqlService.findAll("dathang",{enableParallelFetch:!0,batchSize:1e3,take:999999,aggressiveCache:!0,orderBy:{createdAt:"desc"},where:{ngaynhan:{gte:e,lte:t}},select:{id:!0,madncc:!0,ngaynhan:!0,nhacungcap:{select:{name:!0,mancc:!0}},sanpham:{select:{sldat:!0,slgiao:!0,slnhan:!0,sanpham:{select:{masp:!0}}}},kho:{select:{name:!0,makho:!0}}}}),this._GraphqlService.findAll("tonkho",{enableParallelFetch:!0,aggressiveCache:!0,batchSize:1e3,take:999999,select:{id:!0,sanphamId:!0,slton:!0,sltontt:!0,slchogiao:!0,slchonhap:!0,sanpham:{select:{title:!0,masp:!0,dvt:!0,haohut:!0}}}}),this._GraphqlService.findAll("sanpham",{enableParallelFetch:!0,aggressiveCache:!0,batchSize:1e3,take:999999,select:{id:!0,title:!0,masp:!0,dvt:!0,haohut:!0,Nhacungcap:{select:{mancc:!0,name:!0}}}})]),m=n.data.flatMap(h=>h.sanpham.map(x=>({type:"donhang",status:h.status,madonhang:h.madonhang,ngaygiao:h.ngaygiao,masp:x.sanpham.masp,giaban:Number(x.giaban)||0,sldat:Number(x.sldat)||0,slgiao:Number(x.slgiao)||0,slnhan:Number(x.slnhan)||0}))),T=i.data.flatMap(h=>h.sanpham.map(x=>({type:"dathang",madncc:h.madncc,mancc:h.nhacungcap.mancc,name:h.nhacungcap.name,ngaynhan:h.ngaynhan,masp:x.sanpham.masp,sldat:Number(x.sldat)||0,slgiao:Number(x.slgiao)||0,slnhan:Number(x.slnhan)||0,makho:h.kho.makho,namekho:h.kho.name}))),p=d.data.map(h=>({type:"tonkho",masp:h.sanpham.masp,title:h.sanpham.title,dvt:h.sanpham.dvt,haohut:h.sanpham.haohut||0,slton:Number(h.slton)||0,sltontt:Number(h.sltontt)||0,slchogiao:Number(h.slchogiao)||0,slchonhap:Number(h.slchonhap)||0})),F=new Map;p.forEach(h=>{F.set(h.masp,{id:vt(8,!1),ngaynhan:h.ngaynhan,mancc:h.mancc,name:h.name,masp:h.masp,title:h.title,dvt:h.dvt,haohut:h.haohut||0,slton:h.slton,sltontt:h.sltontt,slchogiao:h.slchogiao,slchonhap:h.slchonhap,SLDat:0,SLGiao:0})}),T.forEach(h=>{if(F.has(h.masp)){let x=F.get(h.masp);x.SLDat+=h.sldat,x.ngaynhan=h.ngaynhan,x.mancc=h.mancc,x.name=h.name,x.makho=h.makho,x.namekho=h.namekho}}),m.forEach(h=>{if(F.has(h.masp)){let x=F.get(h.masp);x.SLGiao+=h.slnhan}});let G=l.data,w=new Map,P=new Map,z=new Map;T.forEach(h=>{let x=w.get(h.masp)||0;w.set(h.masp,x+h.sldat)}),m.forEach(h=>{let x=P.get(h.masp)||0;P.set(h.masp,x+h.slnhan)}),p.forEach(h=>{z.set(h.masp,h)});let B=G.map(h=>{let x=z.get(h.masp),Xe=w.get(h.masp)||0,Je=P.get(h.masp)||0,K=q(O({},h),{id:h.id||vt(8,!1),mancc:h.Nhacungcap?.[0]?.mancc||"",name:h.Nhacungcap?.[0]?.name||"",SLDat:Xe,SLGiao:Je,slton:x?.slton||0,sltontt:x?.sltontt||0,slchogiao:x?.slchogiao||0,slchonhap:x?.slchonhap||0,haohut:x?.haohut||h.haohut||0,slhaohut:0,Dathangs:T.filter(xt=>xt.masp===h.masp),Donhangs:m.filter(xt=>xt.masp===h.masp)});return K.goiy=this.GetGoiy(K),K.slhaohut=this.GetSLHaohut(K),K}).filter(h=>h.masp).sort((h,x)=>parseFloat(x.Dathangs.length)-parseFloat(h.Dathangs.length));this.progressPercentage=75,this.loadingMessage="\u0110ang t\u1ED5ng h\u1EE3p d\u1EEF li\u1EC7u...";let y=yield this._GraphqlService.findAll("kho",{enableParallelFetch:!0,batchSize:1e3,take:999999,aggressiveCache:!0,orderBy:{createdAt:"desc"},select:{id:!0,name:!0,makho:!0}});this.TonghopsFinal=this.transformFinalData(B,y.data),console.log("transformFinalData",B),console.log("this.TonghopsFinal",this.TonghopsFinal),this.TonghopsFinal.forEach(h=>{h.tongkho=parseFloat(((Number(h.kho1)||0)+(Number(h.kho2)||0)+(Number(h.kho3)||0)+(Number(h.kho4)||0)+(Number(h.kho5)||0)+(Number(h.kho6)||0)+(Number(h.sltontt)||0)).toFixed(3)),h.goiy=this.GetGoiy(h),h.slhaohut=this.GetSLHaohut(h)}),this.TonghopsFinal.sort((h,x)=>parseFloat(x.goiy)-parseFloat(h.goiy)),console.log("this.transformFinalData",B);let V=(yield this.convertData(B)).flat();this.TonghopsExportFinal=this.convertKhoData(V),this.progressPercentage=90,this.loadingMessage="Ho\xE0n t\u1EA5t...",this.dataSource.data=this.TonghopsFinal,this.totalItems=this.TonghopsFinal.length,this.calculateTotalPages(),this.updateDisplayData(),this.progressPercentage=100,setTimeout(()=>{this.isLoading=!1,this.loadingMessage="",this.progressPercentage=0},500)}catch(e){console.error("Error loading data:",e),this.isLoading=!1,this.loadingMessage="",this.progressPercentage=0,this._snackBar.open("L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u","\u0110\xF3ng",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}refresh(){return M(this,null,function*(){this.isRefreshing=!0,this.loadingMessage="\u0110ang l\xE0m m\u1EDBi d\u1EEF li\u1EC7u...";try{this.expandedElementId=null,yield this._SanphamService.getAllSanpham(),yield this.loadDonhangWithRelations(),this._snackBar.open("L\xE0m m\u1EDBi d\u1EEF li\u1EC7u th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{this._snackBar.open("L\u1ED7i khi l\xE0m m\u1EDBi d\u1EEF li\u1EC7u","\u0110\xF3ng",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isRefreshing=!1,this.loadingMessage=""}})}applyFilter(e){let t=e.target.value;this.dataSource.filter=t.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}initializeColumns(){this.Columns=Object.keys(this.ColumnName).map(e=>({key:e,value:this.ColumnName[e],isShow:!0})),this.FilterColumns.length===0?this.FilterColumns=this.Columns:localStorage.setItem("NhucauColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{})}setupDrawer(){this._breakpointObserver.observe([Yt.Handset]).subscribe(e=>{e.matches?this.drawer.mode="over":this.drawer.mode="side"})}toggleColumn(e){let t=this.FilterColumns.find(n=>n.key===e.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}doFilterHederColumn(e,t){let n=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();this.dataSource.filteredData=n.filter(i=>i[t]?.toString().toLowerCase().includes(e.target.value.toLowerCase()))}applyAdvancedColumnFilter(e,t){let n=e.target.value.toLowerCase();if(!n){this.getCurrentFilteredData(t);return}let d=(this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham()).filter(l=>l[t]?.toString().toLowerCase().includes(n));this.dataSource.filteredData=d}ChosenItem(e,t){let n=this.dataSource.filteredData.filter(d=>d[t]===e[t]);this.ListFilter.filter(d=>d[t]===e[t]).length>0?this.ListFilter=this.ListFilter.filter(d=>d[t]!==e[t]):this.ListFilter=[...this.ListFilter,...n]}ChosenAll(e){e.forEach(t=>{this.ListFilter.find(i=>i.id===t.id)?this.ListFilter=this.ListFilter.filter(i=>i.id!==t.id):this.ListFilter.push(t)})}ResetFilter(){let e=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();this.ListFilter=e,this.dataSource.data=e,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}EmptyFiter(){this.ListFilter=[]}CheckItem(e){return!!this.ListFilter.find(t=>t.masp===e.masp||t.id===e.id)}ApplyFilterColum(e){let t=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();this.dataSource.data=t.filter(n=>this.ListFilter.some(i=>i.masp===n.masp)),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,e.closeMenu()}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("NhucauColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(n=>n.value.toLowerCase().includes(t))}AddToEdit(e){this.EditList.find(n=>n.masp===e.masp||n.id===e.id)?this.EditList=this.EditList.filter(n=>n.masp!==e.masp&&n.id!==e.id):this.EditList.push(e)}ChoseAllEdit(){let e=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();this.EditList=e}CheckItemInEdit(e){return this.EditList.some(t=>t.masp===e.masp||t.id===e.id)}onListDathangChange(e){this.isSubmit=e.isSubmit,this.ListDathang=e.ListDathang}ImporExcel(e){return M(this,null,function*(){let n=(yield Be(e)).map(l=>({title:l.title?.trim()||"",masp:l.masp?.trim()||"",giagoc:Number(l.giagoc)||0,dvt:l.dvt?.trim()||"",soluong:Number(l.soluong)||0,soluongkho:Number(l.soluongkho)||0,haohut:Number(l.haohut)||0,ghichu:l.ghichu?.trim()||""})),i=Array.from(new Map(n.map(l=>[l.masp,l])).values()),d=this._SanphamService.ListSanpham();yield Promise.all(i.map(l=>M(this,null,function*(){let m=d.find(T=>T.masp===l.masp);if(m){let T=O(O({},m),l);yield this._SanphamService.updateSanpham(T)}else yield this._SanphamService.CreateSanpham(l)}))),yield Promise.all(d.filter(l=>!i.some(m=>m.masp===l.masp)).map(l=>this._SanphamService.updateSanpham(q(O({},l),{isActive:!1})))),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ExportExcel(e,t){return M(this,null,function*(){try{this.isExportingExcel=!0;let n=this.TonghopsFinal.map(p=>({title:p.title||"",masp:p.masp||"",dvt:p.dvt||"",ghichu:p.ghichu||"",haohut:Number(p.haohut||0),xSLDat:p.xSLDat||0,sltontt:Number(p.sltontt||0),ngaynhan:(0,Tt.default)(p.ngaynhan).format("YYYY-MM-DD")||"",mancc:p.mancc||"",name:p.name||"",goiy:p.goiy||0,khachdat:Number(p.khachdat||0),khachgiao:Number(p.khachgiao||0),tongkho:Number(p.tongkho||0),kho1:Number(p.kho1||0),kho2:Number(p.kho2||0),kho3:Number(p.kho3||0),kho4:Number(p.kho4||0),kho5:Number(p.kho5||0),kho6:Number(p.kho6||0),slhaohut:Number(p.slhaohut||0)})),i={ngaynhan:"NG\xC0Y",mancc:"M\xC3 NCC",name:"T\xCAN NH\xC0 CUNG C\u1EA4P",title:"T\xCAN S\u1EA2N PH\u1EA8M",masp:"M\xC3 S\u1EA2N PH\u1EA8M",dvt:"\u0110VT",ghichu:"GHI CH\xDA",xSLDat:"SL \u0110\u1EB6T (NH\xC0 CC)",goiy:"SL C\u1EA6N \u0110\u1EB6T (G\u1EE2I \xDD)",khachdat:"T\u1ED4NG SL KH\xC1CH \u0110\u1EB6T",khachgiao:"T\u1ED4NG SL B\xC1N",tongkho:"T\u1ED4NG KHO",sltontt:"T\u1ED2N KHO",kho1:"TG-LONG AN",kho2:"B\u1ED4 SUNG",kho3:"TG-\u0110\xC0 L\u1EA0T",kho4:"KHO T\u1ED4NG - HCM",kho5:"SG1",kho6:"SG2",haohut:"T\u1EC8 L\u1EC6 HAO H\u1EE4T (%)",slhaohut:"SL HAO H\u1EE4T"},d=this.TonghopsExportFinal.map(p=>({title:p.title||"",masp:p.masp||"",dvt:p.dvt||"",haohut:p.haohut||0,sldat:p.sldat||0,SLDat:p.SLDat||0,SLGiao:p.SLGiao||0,sltontt:p.sltontt||0,mancc:p.mancc||"",name:p.name||"",ngaynhan:(0,Tt.default)(p.ngaynhan).format("YYYY-MM-DD")||"",goiy:p.goiy||0,kho1:p.kho1||0,kho2:p.kho2||0,kho3:p.kho3||0,kho4:p.kho4||0,kho5:p.kho5||0,kho6:p.kho6||0,slhaohut:p.slhaohut||0})),l={ngaynhan:"Ng\xE0y Nh\u1EADn",title:"T\xEAn S\u1EA3n Ph\u1EA9m",masp:"M\xE3 S\u1EA3n Ph\u1EA9m",dvt:"\u0110VT",mancc:"M\xE3 NCC",name:"T\xEAn Nh\xE0 Cung C\u1EA5p",sldat:"SL \u0110\u1EB7t (Nh\xE0 CC)",SLDat:"T\u1ED5ng \u0110\u1EB7t",goiy:"SL C\u1EA7n \u0110\u1EB7t (G\u1EE3i \xDD)",SLGiao:"SL Giao (Kh\xE1ch)",sltontt:"T\u1ED3n Kho",kho1:"TG-LONG AN",kho2:"B\u1ED5 Sung",kho3:"TG-\u0110\xC0 L\u1EA0T",kho4:"KHO T\u1ED4NG - HCM",kho5:"SG1",kho6:"SG2",haohut:"T\u1EC9 L\u1EC7 Hao H\u1EE5t (%)",slhaohut:"SL Hao H\u1EE5t"},m=d.sort((p,F)=>parseFloat(F.masp)-parseFloat(p.masp)),T={sheet1:{data:n,headers:Object.values(i),mapping:i},sheet2:{data:m,headers:Object.values(l),mapping:l}};Le(T,t),this._snackBar.open("Export Excel th\xE0nh c\xF4ng!","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(n){console.error("Error exporting Excel:",n),this._snackBar.open("L\u1ED7i khi export Excel","\u0110\xF3ng",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isExportingExcel=!1}})}Capnhattonkho(){return M(this,null,function*(){this.isUpdatingStock=!0;let e=document.createElement("input");e.type="file",e.accept=".xlsx,.xls,.csv",e.style.display="none",e.onchange=t=>M(this,null,function*(){try{if(!t.target.files[0]){this._snackBar.open("Kh\xF4ng c\xF3 file \u0111\u01B0\u1EE3c ch\u1ECDn","\u0110\xF3ng",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),this.isUpdatingStock=!1;return}this._snackBar.open("\u0110ang x\u1EED l\xFD file Excel...","",{duration:0,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-info"]});let i=yield Oe(t);if(!i||i.length===0){this._snackBar.dismiss(),this._snackBar.open("File Excel tr\u1ED1ng ho\u1EB7c kh\xF4ng h\u1EE3p l\u1EC7","\u0110\xF3ng",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}let d=[],l=[];if(console.log(i),i.forEach((y,V)=>{let h=y.masp?.toString().trim()||y.ITEMCODE?.toString().trim(),x=parseFloat(y.slton||y.QUANTITY||"0");if(!h){l.push(`D\xF2ng ${V+1}: Thi\u1EBFu m\xE3 s\u1EA3n ph\u1EA9m`);return}(isNaN(x)||x==null||x<=0)&&(x=0,console.log(`D\xF2ng ${V+1} - ${h}: slton \u0111\u01B0\u1EE3c set v\u1EC1 0 (gi\xE1 tr\u1ECB g\u1ED1c: ${y.slton})`)),d.push({masp:h,slton:x})}),l.length>0){this._snackBar.dismiss(),this._snackBar.open(`C\xF3 ${l.length} l\u1ED7i trong file. Xem console \u0111\u1EC3 bi\u1EBFt chi ti\u1EBFt.`,"\u0110\xF3ng",{duration:5e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),console.error("Validation errors:",l);return}let[m,T]=yield Promise.all([this._GraphqlService.findAll("tonkho",{take:999999,select:{id:!0,sanphamId:!0,slton:!0,sltontt:!0,slchogiao:!0,slchonhap:!0,sanpham:{select:{id:!0,masp:!0,title:!0}}}}),this._GraphqlService.findAll("sanpham",{take:999999,select:{id:!0,masp:!0,title:!0}})]),p=m.data||[],F=T.data||[],G=new Map(p.map(y=>[y.sanpham?.masp,y])),w=new Map(F.map(y=>[y.masp,y])),P=0,z=0,B=[];for(let y of d)try{let V=w.get(y.masp);if(!V){B.push(`Kh\xF4ng t\xECm th\u1EA5y s\u1EA3n ph\u1EA9m v\u1EDBi m\xE3: ${y.masp}`);continue}let h=G.get(y.masp);h?(yield this._GraphqlService.updateOne("tonkho",{id:h.id},{slton:y.slton,sltontt:y.slton}),P++,console.log(`Updated TonKho for ${y.masp}: slton = ${y.slton}`)):(yield this._GraphqlService.createOne("tonkho",{sanphamId:V.id,slton:y.slton,sltontt:y.slton,slchogiao:0,slchonhap:0}),z++,console.log(`Created new TonKho for ${y.masp}: slton = ${y.slton}`))}catch(V){B.push(`L\u1ED7i x\u1EED l\xFD ${y.masp}: ${V.message}`)}this._snackBar.dismiss(),B.length>0?(console.error("Process errors:",B),this._snackBar.open(`Ho\xE0n th\xE0nh v\u1EDBi ${B.length} l\u1ED7i. Xem console \u0111\u1EC3 bi\u1EBFt chi ti\u1EBFt.`,"\u0110\xF3ng",{duration:5e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]})):(this._snackBar.open(`C\u1EADp nh\u1EADt TonKho th\xE0nh c\xF4ng: ${P} c\u1EADp nh\u1EADt, ${z} t\u1EA1o m\u1EDBi (bao g\u1ED3m c\u1EA3 slton = 0)`,"\u0110\xF3ng",{duration:4e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),console.log(`TonKho update summary: Updated ${P}, Created ${z}`)),this.ngOnInit()}catch(n){this._snackBar.dismiss(),this._snackBar.open(`L\u1ED7i x\u1EED l\xFD file: ${n.message}`,"\u0110\xF3ng",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),console.error("Error processing Excel file:",n)}finally{this.isUpdatingStock=!1}}),e.oncancel=()=>{this.isUpdatingStock=!1},document.body.appendChild(e),e.click(),document.body.removeChild(e)})}downloadTonkhoTemplate(){return M(this,null,function*(){let e={masp:"masp",title:"title",slton:"slton"},n=(yield this._GraphqlService.findAll("sanpham",{take:999999,select:{id:!0,masp:!0,TonKho:{select:{slton:!0}}}})).data.map(i=>({masp:i.masp||"",title:i.title||"",slton:i.TonKho?.slton||0}));Ae(n,"MauCapNhatTonKho",Object.values(e),e),this._snackBar.open("\u0110\xE3 t\u1EA3i file Excel m\u1EABu","\u0110\xF3ng",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-info"]})})}convertKhoData(e){let t=[{name:"kho1",label:"TG-LONG AN"},{name:"kho2",label:"B\u1ED5 Sung"},{name:"kho3",label:"TG-\u0110\xC0 L\u1EA0T"},{name:"kho4",label:"KHO T\u1ED4NG - HCM"},{name:"kho5",label:"SG1"},{name:"kho6",label:"SG2"}];return e.map(n=>{let i=O({},n);t.forEach(l=>{i[l.name]="0"});let d=t.find(l=>l.label===n.namekho);return d&&(i[d.name]=n.sldat||"0"),i})}transformFinalData(e,t){return t=[{id:"a118c322-ddca-444e-9e41-40602d955e93",value:"kho5",name:"SG1",makho:"TG-SG1"},{id:"3344758e-c0bc-4562-9390-d58fc5717d03",value:"kho6",name:"SG2",makho:"TG-SG2"},{id:"75933b1d-2906-4591-8a46-30db60ce9258",value:"kho2",name:"B\u1ED5 Sung",makho:"TG-BS"},{id:"4cc01811-61f5-4bdc-83de-a493764e9258",value:"kho4",name:"KHO T\u1ED4NG - HCM",makho:"TG-HCM"},{id:"929d94e9-9b05-4820-aadb-0c48b991c96c",value:"kho1",name:"TG-LONG AN",makho:"TG-LA"},{id:"a24363f8-2218-4f80-b2f9-0641ace1b245",value:"kho3",name:"TG-\u0110\xC0 L\u1EA0T",makho:"TG-\u0110L"}],e.map(n=>{let G=n,{Dathangs:i,Donhangs:d}=G,l=ft(G,["Dathangs","Donhangs"]),m={};t.forEach(w=>{m[w.value]=0});let T=i&&i.length>0?i[0].ngaynhan:null;i&&i.forEach(w=>{let P=t.find(z=>z.makho===w.makho);P&&(m[P.value]+=w.sldat)});let p=d.filter(w=>w.status==="dadat").reduce((w,P)=>Number((w+Number(P.sldat||0)).toFixed(3))||0,0);console.log("Donhangs",d);let F=d.filter(w=>w.status!=="dadat").reduce((w,P)=>Number((w+Number(P.sldat||0)).toFixed(2))||0,0);return O(O(O({khachdat:p,khachgiao:F},l),T&&{ngaynhan:T}),m)})}transformFinalDataTachDathang(e,t){return t=[{id:"a118c322-ddca-444e-9e41-40602d955e93",value:"kho5",name:"SG1",makho:"TG-SG1"},{id:"3344758e-c0bc-4562-9390-d58fc5717d03",value:"kho6",name:"SG2",makho:"TG-SG2"},{id:"75933b1d-2906-4591-8a46-30db60ce9258",value:"kho2",name:"B\u1ED5 Sung",makho:"TG-BS"},{id:"4cc01811-61f5-4bdc-83de-a493764e9258",value:"kho4",name:"KHO T\u1ED4NG - HCM",makho:"TG-HCM"},{id:"929d94e9-9b05-4820-aadb-0c48b991c96c",value:"kho1",name:"TG-LONG AN",makho:"TG-LA"},{id:"a24363f8-2218-4f80-b2f9-0641ace1b245",value:"kho3",name:"TG-\u0110\xC0 L\u1EA0T",makho:"TG-\u0110L"}],e.map(n=>{let p=n,{Dathangs:i,Donhangs:d}=p,l=ft(p,["Dathangs","Donhangs"]),m={};t.forEach(F=>{m[F.value]=0});let T=i&&i.length>0?i[0].ngaynhan:null;return i&&i.forEach(F=>{let G=t.find(w=>w.makho===F.makho);G&&(m[G.value]+=F.sldat)}),q(O(O(O({},l),T&&{ngaynhan:T}),m),{Dathangs:i})})}convertData(e){return M(this,null,function*(){let n=(yield this._GraphqlService.findAll("kho",{enableParallelFetch:!0,batchSize:1e3,take:999999,aggressiveCache:!0,orderBy:{createdAt:"desc"},select:{id:!0,name:!0,makho:!0}})).data;return e.map(i=>[...this.transformItemData(n,i)])})}transformItemData(e,t){let n=[],i={};return e.forEach(d=>{i[d.makho]=d.name}),t.Dathangs.forEach(d=>{let l={id:t.id,title:t.title,masp:t.masp,dvt:t.dvt,haohut:t.haohut,slhaohut:t.slhaohut,SLDat:t.SLDat,SLGiao:t.SLGiao,sltontt:t.sltontt,slton:t.slton,slchogiao:t.slchogiao,slchonhap:t.slchonhap,mancc:d.mancc,name:d.name,ngaynhan:d.ngaynhan,sldat:d.sldat,makho:d.makho,namekho:i[d.makho]||d.namekho,goiy:t.goiy};n.push(l)}),n}trackByFn(e,t){return t.masp||t.id}calculateTotalPages(){this.totalPages=Math.ceil(this.totalItems/this.pageSize)}onPageSizeChange(e,t){let n=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();e>n.length?(this.pageSize=n.length,this._snackBar.open(`S\u1ED1 l\u01B0\u1EE3ng t\u1ED1i \u0111a ${n.length}`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})):this.pageSize=e,this.currentPage=1,this.calculateTotalPages(),this.updateDisplayData(),t.closeMenu()}onPreviousPage(){this.currentPage>1&&(this.currentPage--,this.updateDisplayData())}onNextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.updateDisplayData())}updateDisplayData(){let e=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham(),t=(this.currentPage-1)*this.pageSize,n=t+this.pageSize,i=e.slice(t,n);this.dataSource.data=i}getCurrentFilteredData(e){let t=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham(),n=new Map;return t.forEach(i=>{let d=i[e];n.has(d)||n.set(d,i)}),Array.from(n.values())}parseFloat(e){return parseFloat(e)||0}applyQuickFilter(e){this.quickFilter=e;let t=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();switch(e){case"lowStock":t=t.filter(n=>(n.slton||0)<=10);break;case"needOrder":t=t.filter(n=>parseFloat(this.GetGoiy(n))>0);break;case"pendingDelivery":t=t.filter(n=>(n.slchogiao||0)>0);break;case"all":default:break}this.globalFilterValue&&(t=this.applyGlobalFilterToData(t,this.globalFilterValue)),this.dataSource.data=t,this.totalItems=t.length,this.calculateTotalPages(),this.currentPage=1,this.updateDisplayData()}applyGlobalFilter(e){let t=e.target.value;this.globalFilterValue=t;let n=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();if(this.quickFilter!=="all"){this.applyQuickFilter(this.quickFilter);return}t&&(n=this.applyGlobalFilterToData(n,t)),this.dataSource.data=n,this.totalItems=n.length,this.calculateTotalPages(),this.currentPage=1,this.updateDisplayData()}applyGlobalFilterToData(e,t){let n=t.trim().toLowerCase();return e.filter(i=>i.title?.toLowerCase().includes(n)||i.masp?.toLowerCase().includes(n)||i.name?.toLowerCase().includes(n)||i.mancc?.toLowerCase().includes(n))}sortData(e){let t=this.dataSource.data.slice();if(!e.active||e.direction===""){this.dataSource.data=t;return}this.dataSource.data=t.sort((n,i)=>{let d=e.direction==="asc";switch(e.active){case"title":case"masp":return this.compareStrings(n[e.active],i[e.active],d);case"slton":case"slchogiao":case"slchonhap":case"SLDat":case"SLGiao":return this.compareNumbers(Number(n[e.active])||0,Number(i[e.active])||0,d);case"goiy":return this.compareNumbers(parseFloat(this.GetGoiy(n)),parseFloat(this.GetGoiy(i)),d);default:return this.compareStrings(n[e.active],i[e.active],d)}})}compareStrings(e,t,n){return(e<t?-1:1)*(n?1:-1)}compareNumbers(e,t,n){return(e-t)*(n?1:-1)}clearAllFilters(){this.quickFilter="all",this.globalFilterValue="",this.ListFilter=[];let e=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();this.dataSource.data=e,this.totalItems=e.length,this.calculateTotalPages(),this.currentPage=1,this.updateDisplayData(),document.querySelectorAll('input[type="text"]').forEach(n=>{n.placeholder.includes("T\xECm ki\u1EBFm")&&(n.value="")})}toggleDateRangeFilter(){if(this.isDateRangeEnabled=!this.isDateRangeEnabled,this.hasUnappliedDateChanges=!1,this.isDateRangeEnabled){let e=new Date;this.batdau=new Date(e),this.ketthuc=new Date(e),this.loadDonhangWithRelations()}else this.loadDonhangWithRelations()}applyDateFilter(e){if(this.isDateRangeEnabled||(this.isDateRangeEnabled=!0),!this.batdau||!this.ketthuc){this._snackBar.open("Vui l\xF2ng ch\u1ECDn kho\u1EA3ng th\u1EDDi gian h\u1EE3p l\u1EC7","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}if(this.batdau>this.ketthuc){this._snackBar.open("Ng\xE0y b\u1EAFt \u0111\u1EA7u kh\xF4ng th\u1EC3 sau ng\xE0y k\u1EBFt th\xFAc","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}this.hasUnappliedDateChanges=!1,this.loadDonhangWithRelations(),this._snackBar.open("\u0110\xE3 \xE1p d\u1EE5ng b\u1ED9 l\u1ECDc ng\xE0y","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),e.closeMenu()}onStartDateChange(e){this.batdau=e.value,this.batdau>this.ketthuc&&(this.ketthuc=new Date(this.batdau)),this.hasUnappliedDateChanges=!0}onEndDateChange(e){this.ketthuc=e.value,this.ketthuc<this.batdau&&(this.batdau=new Date(this.ketthuc)),this.hasUnappliedDateChanges=!0}setToday(e){let t=new Date;this.batdau=new Date(t),this.ketthuc=new Date(t),this.applyDateFilter(e)}setThisWeek(e){let t=new Date,n=new Date(t);n.setDate(t.getDate()-t.getDay());let i=new Date(n);i.setDate(n.getDate()+6),this.batdau=new Date(n),this.ketthuc=new Date(i),this.applyDateFilter(e)}setThisMonth(e){let t=new Date,n=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth()+1,0);this.batdau=new Date(n),this.ketthuc=new Date(i),this.applyDateFilter(e)}clearDateFilter(){this.isDateRangeEnabled=!1,this.hasUnappliedDateChanges=!1;let e=new Date;this.batdau=new Date(e),this.ketthuc=new Date(e),this.loadDonhangWithRelations(),this._snackBar.open("\u0110\xE3 x\xF3a b\u1ED9 l\u1ECDc ng\xE0y","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}formatDateForDisplay(e,t="DD/MM/YYYY"){return this._timezoneService.formatForDisplay(e,t)}convertFormDateToUTC(e){return this._timezoneService.formDateToUTC(e)}parseUserDateInput(e,t="YYYY-MM-DD"){try{return this._timezoneService.parseUserInputToUTC(e,t)}catch(n){return console.error("Invalid date format:",n),""}}toggleExpanded(e){this.openNestedDataDialog(e)}openNestedDataDialog(e){return M(this,null,function*(){let t={product:e,dathangData:[],donhangData:[],loading:!0},n=this._dialog.open(_t,{width:"95vw",maxWidth:"1200px",height:"90vh",maxHeight:"90vh",data:t,disableClose:!1,autoFocus:!1,panelClass:["nested-data-dialog-panel"]});try{yield this.loadNestedData(e),t.dathangData=this.getDathangData(e.masp),t.donhangData=this.getDonhangData(e.masp),t.loading=!1,t.triggerChangeDetection&&t.triggerChangeDetection()}catch(i){console.error("Error loading nested data:",i),t.loading=!1,t.triggerChangeDetection&&t.triggerChangeDetection(),this._snackBar.open("L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u. Vui l\xF2ng th\u1EED l\u1EA1i.","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}loadNestedData(e){return M(this,null,function*(){let t=e.masp||e.id;if(!t){console.warn("Cannot load nested data: masp is missing",e);return}yield Promise.all([this.loadDathangData(t),this.loadDonhangData(t)])})}loadDathangData(e){return M(this,null,function*(){if(!(this.dathangDataMap.has(e)||this.loadingDathang.has(e))){this.loadingDathang.add(e);try{let t,n;if(this.isDateRangeEnabled&&this.batdau&&this.ketthuc){let l=this._timezoneService.getAPIDateRange(this.batdau,this.ketthuc);t=l.Batdau,n=l.Ketthuc}else{let l=new Date,m=this._timezoneService.getAPIDateRange(l,l);t=m.Batdau,n=m.Ketthuc}let d=(yield this._GraphqlService.findAll("dathang",{enableParallelFetch:!0,batchSize:500,take:999999,aggressiveCache:!0,orderBy:{createdAt:"desc"},where:{sanpham:{some:{sanpham:{masp:{equals:e}}}},ngaynhan:{gte:t,lte:n}},select:{id:!0,madncc:!0,ngaynhan:!0,createdAt:!0,updatedAt:!0,status:!0,nhacungcap:{select:{id:!0,name:!0,mancc:!0,diachi:!0,sdt:!0}},sanpham:{where:{sanpham:{masp:{equals:e}}},select:{id:!0,sldat:!0,slgiao:!0,slnhan:!0,ttgiao:!0,sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0}}}},kho:{select:{id:!0,name:!0,makho:!0,diachi:!0}}}})).data.flatMap(l=>l.sanpham.map(m=>({id:l.id,madncc:l.madncc,ngaynhan:l.ngaynhan,createdAt:l.createdAt,updatedAt:l.updatedAt,status:l.status,sanphamId:m.sanpham.id,title:m.sanpham.title,masp:m.sanpham.masp,dvt:m.sanpham.dvt,sldat:Number(m.sldat)||0,slgiao:Number(m.slgiao)||0,slnhan:Number(m.slnhan)||0,giaban:Number(m.giaban)||0,ttgiao:Number(m.ttgiao)||0,nhacungcap:l.nhacungcap,mancc:l.nhacungcap?.mancc||"",name:l.nhacungcap?.name||"",type:"dathang"})));this.dathangDataMap.set(e,d)}catch(t){console.error("Error loading dathang data:",t),this.dathangDataMap.set(e,[]),this._snackBar.open(`L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u \u0111\u1EB7t h\xE0ng cho ${e}`,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.loadingDathang.delete(e)}}})}loadDonhangData(e){return M(this,null,function*(){if(!(this.donhangDataMap.has(e)||this.loadingDonhang.has(e))){this.loadingDonhang.add(e);try{let t,n;if(this.isDateRangeEnabled&&this.batdau&&this.ketthuc){let l=this._timezoneService.getAPIDateRange(this.batdau,this.ketthuc);t=l.Batdau,n=l.Ketthuc}else{let l=new Date,m=this._timezoneService.getAPIDateRange(l,l);t=m.Batdau,n=m.Ketthuc}let d=(yield this._GraphqlService.findAll("donhang",{enableParallelFetch:!0,batchSize:500,take:999999,aggressiveCache:!0,orderBy:{createdAt:"desc"},where:{sanpham:{some:{sanpham:{masp:{equals:e}}}},ngaygiao:{gte:t,lte:n}},select:{id:!0,madonhang:!0,ngaygiao:!0,createdAt:!0,updatedAt:!0,status:!0,khachhang:{select:{id:!0,name:!0,sdt:!0,diachi:!0,makh:!0}},sanpham:{where:{sanpham:{masp:{equals:e}}},select:{id:!0,sldat:!0,slgiao:!0,slnhan:!0,giaban:!0,ttgiao:!0,sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0}}}}}})).data.flatMap(l=>l.sanpham.map(m=>({id:l.id,madonhang:l.madonhang,ngaygiao:l.ngaygiao,createdAt:l.createdAt,updatedAt:l.updatedAt,status:l.status,sanphamId:m.sanpham.id,title:m.sanpham.title,masp:m.sanpham.masp,dvt:m.sanpham.dvt,sldat:Number(m.sldat)||0,slgiao:Number(m.slgiao)||0,slnhan:Number(m.slnhan)||0,giaban:Number(m.giaban)||0,ttgiao:Number(m.ttgiao)||0,khachhang:l.khachhang,makh:l.khachhang?.makh||"",name:l.khachhang?.name||"",type:"donhang"})));this.donhangDataMap.set(e,d)}catch(t){console.error("Error loading donhang data:",t),this.donhangDataMap.set(e,[]),this._snackBar.open(`L\u1ED7i t\u1EA3i d\u1EEF li\u1EC7u \u0111\u01A1n h\xE0ng cho ${e}`,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.loadingDonhang.delete(e)}}})}getDathangData(e){return this.dathangDataMap.get(e)||[]}getDonhangData(e){return this.donhangDataMap.get(e)||[]}isDathangLoading(e){return this.loadingDathang.has(e)}isDonhangLoading(e){return this.loadingDonhang.has(e)}clearNestedData(){this.dathangDataMap.clear(),this.donhangDataMap.clear(),this.loadingDathang.clear(),this.loadingDonhang.clear(),this.expandedElementId=null}isExpanded=(e,t)=>(t.id||t.masp)===this.expandedElementId;isElementExpanded(e){return!1}expandById(e,t){let n=this.dataSource.data.find(i=>(i.id||i.masp)===e||i.masp===t);n&&this.openNestedDataDialog(n)}collapseExpanded(){this.expandedElementId=null}isAnyDataLoading(e){return this.isDathangLoading(e)||this.isDonhangLoading(e)}getTotalNestedDataCount(e){return this.getDathangData(e).length+this.getDonhangData(e).length}hasNestedData(e){return this.getTotalNestedDataCount(e)>0}getLoadingStateSummary(){return{expandedElementId:this.expandedElementId,loadingDathang:Array.from(this.loadingDathang),loadingDonhang:Array.from(this.loadingDonhang),cachedDathang:Array.from(this.dathangDataMap.keys()),cachedDonhang:Array.from(this.donhangDataMap.keys())}}loadTempEditsFromStorage(){try{let e=localStorage.getItem(this.STORAGE_KEY);if(e){let t=JSON.parse(e);this.tempStorage=new Map(Object.entries(t))}}catch(e){console.error("Error loading temp edits from storage:",e),this.tempStorage=new Map}}saveTempEditsToStorage(){try{let e=Object.fromEntries(this.tempStorage);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){console.error("Error saving temp edits to storage:",e)}}startEdit(e,t){let n=this.getRowKey(e);this.editingRows.has(n)||this.editingRows.set(n,{}),this.editingRows.get(n)[t]=!0}stopEdit(e,t){let n=this.getRowKey(e);this.editingRows.has(n)&&(delete this.editingRows.get(n)[t],Object.keys(this.editingRows.get(n)).length===0&&this.editingRows.delete(n))}isEditing(e,t){let n=this.getRowKey(e);return this.editingRows.has(n)&&this.editingRows.get(n)[t]===!0}saveFieldValue(e,t,n){let i=this.getRowKey(e);this.tempStorage.has(i)||this.tempStorage.set(i,{masp:e.masp,title:e.title,changes:{}});let d=this.tempStorage.get(i);d.changes[t]=n,d.lastModified=new Date().toISOString(),this.saveTempEditsToStorage(),this.stopEdit(e,t),this._snackBar.open(`\u0110\xE3 l\u01B0u t\u1EA1m ${t}`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-info"]})}getFieldValue(e,t){let n=this.getRowKey(e);return this.tempStorage.has(n)&&this.tempStorage.get(n).changes[t]!==void 0?this.tempStorage.get(n).changes[t]:e[t]||""}hasFieldChanged(e,t){let n=this.getRowKey(e);return this.tempStorage.has(n)&&this.tempStorage.get(n).changes[t]!==void 0}getRowKey(e){return e.masp||e.id||""}getTempChangesCount(){return this.tempStorage.size}exportTempChanges(){return M(this,null,function*(){if(this.tempStorage.size===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u t\u1EA1m th\u1EDDi \u0111\u1EC3 xu\u1EA5t","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}try{let e=Array.from(this.tempStorage.values()).map(n=>({masp:n.masp||"",title:n.title||"",ghichu_moi:n.changes.ghichu||"",xSLDat_moi:n.changes.xSLDat||"",lastModified:n.lastModified||""})),t={masp:"M\xE3 S\u1EA3n Ph\u1EA9m",title:"T\xEAn S\u1EA3n Ph\u1EA9m",ghichu_moi:"Ghi Ch\xFA M\u1EDBi",xSLDat_moi:"SL \u0110\u1EB7t (NCC) M\u1EDBi",lastModified:"Th\u1EDDi Gian S\u1EEDa"};window.writeExcelFile(e,"DuLieuTamThoi_"+new Date().toISOString().split("T")[0],Object.values(t),t),this._snackBar.open("Xu\u1EA5t d\u1EEF li\u1EC7u t\u1EA1m th\u1EDDi th\xE0nh c\xF4ng!","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(e){console.error("Error exporting temp changes:",e),this._snackBar.open("L\u1ED7i khi xu\u1EA5t d\u1EEF li\u1EC7u t\u1EA1m th\u1EDDi","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}applyTempChanges(){return M(this,null,function*(){if(this.tempStorage.size===0){this._snackBar.open("Kh\xF4ng c\xF3 thay \u0111\u1ED5i t\u1EA1m th\u1EDDi \u0111\u1EC3 \xE1p d\u1EE5ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}try{let e=this.tempStorage.size,t=[...this.dataSource.data];for(let[n,i]of this.tempStorage.entries()){let d=t.findIndex(l=>this.getRowKey(l)===n);d!==-1&&Object.assign(t[d],i.changes)}this.dataSource.data=t,this.tempStorage.clear(),this.editingRows.clear(),this._snackBar.open(`\u0110\xE3 \xE1p d\u1EE5ng ${e} thay \u0111\u1ED5i v\xE0o d\u1EEF li\u1EC7u ch\xEDnh!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(e){console.error("Error applying temp changes:",e),this._snackBar.open("L\u1ED7i khi \xE1p d\u1EE5ng thay \u0111\u1ED5i","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}clearTempStorage(){if(this.tempStorage.size===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u t\u1EA1m th\u1EDDi \u0111\u1EC3 x\xF3a","",{duration:1500,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-info"]});return}let e=this.tempStorage.size;this.tempStorage.clear(),this.editingRows.clear(),localStorage.removeItem(this.STORAGE_KEY);let t=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();this.dataSource.data=[...t],this._snackBar.open(`\u0110\xE3 x\xF3a ${e} thay \u0111\u1ED5i t\u1EA1m th\u1EDDi v\xE0 kh\xF4i ph\u1EE5c d\u1EEF li\u1EC7u g\u1ED1c`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-info"]})}onFieldKeyDown(e,t,n){if(e.key==="Enter"){let i=e.target;this.saveFieldValue(t,n,i.value)}else e.key==="Escape"&&this.stopEdit(t,n)}onFieldBlur(e,t,n){let i=e.target;this.saveFieldValue(t,n,i.value)}static \u0275fac=function(t){return new(t||Y)};static \u0275cmp=j({type:Y,selectors:[["app-nhucaudathang"]],viewQuery:function(t,n){if(t&1&&(U(fe,5),U(ht,5),U(fn,7)),t&2){let i;W(i=Q())&&(n.paginator=i.first),W(i=Q())&&(n.sort=i.first),W(i=Q())&&(n.drawer=i.first)}},decls:136,vars:46,consts:[["drawer",""],["dateMenuTrigger","matMenuTrigger"],["dateMenu","matMenu"],["startPicker",""],["endPicker",""],["menu","matMenu"],["uploadfile",""],["menuTrigger","matMenuTrigger"],["menuHienthi","matMenu"],["DeleteDialog",""],["filterMenu","matMenu"],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","lg:!w-1/2","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-16","w-full","p-2"],[1,"border","p-1","cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","bg-white","rounded-lg"],[1,"w-full","flex","flex-wrap","space-x-2","items-center"],[1,"relative"],["type","text","placeholder","T\xECm ki\u1EBFm s\u1EA3n ph\u1EA9m, m\xE3 s\u1EA3n ph\u1EA9m...",1,"block","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[1,"flex","space-x-2","items-center"],["matTooltip","\xC1p d\u1EE5ng thay \u0111\u1ED5i t\u1EA1m th\u1EDDi","mat-raised-button","","color","accent",1,"text-sm",3,"click","disabled"],["matTooltip","X\xF3a d\u1EEF li\u1EC7u t\u1EA1m th\u1EDDi","mat-stroked-button","","color","warn",1,"text-sm",3,"click","disabled"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],["matTooltip","L\u1ECDc theo ng\xE0y","mat-icon-button","","color","primary","aria-label","Date filter menu",3,"matMenuTriggerFor"],[1,"date-filter-menu"],[1,"p-4",3,"click"],[1,"flex","flex-col","space-y-4"],[1,"flex","items-center","justify-between"],[1,"font-semibold"],[1,"flex","flex-col","space-y-3"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","readonly","","placeholder","Ch\u1ECDn ng\xE0y b\u1EAFt \u0111\u1EA7u",3,"ngModelChange","dateChange","matDatepicker","ngModel"],["matIconSuffix","",3,"for"],["matInput","","readonly","","placeholder","Ch\u1ECDn ng\xE0y k\u1EBFt th\xFAc",3,"ngModelChange","dateChange","matDatepicker","ngModel"],[1,"flex","flex-wrap","gap-2"],["mat-stroked-button","","color","primary",1,"text-xs",3,"click"],["mat-stroked-button","","color","warn",1,"text-xs",3,"click"],[1,"flex","justify-center"],["mat-raised-button","",1,"w-full",3,"click","color"],[1,"text-xs","text-orange-600","bg-orange-50","p-2","rounded","text-center"],[1,"text-sm","text-gray-600","bg-gray-50","p-2","rounded"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["matTooltip","T\u1EA3i file excel M\u1EABu","color","primary","mat-icon-button","",3,"click","disabled"],["diameter","20"],["matTooltip","L\xE0m m\u1EDBi d\u1EEF li\u1EC7u","color","primary","mat-icon-button","",3,"click","disabled"],["type","file",1,"hidden",3,"change"],[1,"flex","whitespace-nowrap","p-2","rounded-lg","bg-slate-200",3,"click"],[1,"ml-2","px-2","py-1","bg-blue-100","text-blue-800","rounded","text-xs"],["matTooltip","T\u1EA3i file Excel l\xEAn \u0111\u1EC3 c\u1EADp nh\u1EADt t\u1ED3n kho",3,"click"],["matTooltip","T\u1EA3i file Excel m\u1EABu \u0111\u1EC3 c\u1EADp nh\u1EADt t\u1ED3n kho",1,"whitespace-nowrap","p-2","border","hover:bg-slate-50","rounded-lg","cursor-pointer",3,"click"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"border","rounded-lg","w-full","h-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","","class","bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:bg-slate-100 transition-colors duration-200",3,"bg-slate-200","click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[1,"cursor-pointer","border","rounded-lg","px-3","p-1","flex","flex-row","space-x-2","items-center","justify-between"],[1,"w-full","flex","lg:p-0","p-2","lg:flex-row","lg:space-x-2","lg:items-center","lg:justify-between","flex-col","justify-center"],[1,"w-full","text-center"],[1,"w-full","flex","flex-row","space-x-2","items-center","lg:justify-end","justify-center"],[1,"font-bold","text-blue-600",3,"matMenuTriggerFor"],[1,"w-full","flex","flex-col","space-y-2","p-4",3,"click"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp S\u1ED1 L\u01B0\u1EE3ng",3,"ngModelChange","ngModel","ngModelOptions"],["mat-flat-button","","color","primary",3,"click"],[1,"pagination-controls"],["mat-icon-button","","color","primary",3,"click","disabled"],["mat-menu-item","",3,"click"],["diameter","16"],[1,"bg-white","rounded-lg","p-6","flex","flex-col","items-center","space-y-4","max-w-sm","w-full","mx-4"],["diameter","50","color","primary"],[1,"text-center"],[1,"text-lg","font-semibold","text-gray-800"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","cursor-pointer",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"filter-menu"],[1,"cursor-pointer","flex","flex-col","space-y-4","p-3",3,"click"],[1,"relative","w-full"],["type","text",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup","placeholder"],[1,"flex","flex-row","space-x-2","items-center","justify-between"],[1,"flex","flex-row","space-x-2","items-center"],[1,"text-xs","text-blue-600","underline","cursor-pointer",3,"click"],[1,"w-full","flex","flex-col","space-y-2","max-h-44","overflow-auto"],["class","flex flex-row space-x-2 items-center p-2 rounded-lg hover:bg-slate-100 cursor-pointer",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-row","space-x-2","items-end","justify-end"],[1,"max-w-32","line-clamp-2","me-2"],[1,"z-10","material-symbols-outlined","text-gray-500","cursor-pointer",3,"matMenuTriggerFor","matTooltip"],[1,"flex","flex-row","space-x-2","items-center","p-2","rounded-lg","hover:bg-slate-100","cursor-pointer",3,"click"],["class","material-symbols-outlined text-blue-600",4,"ngIf"],["class","w-6",4,"ngIf"],[1,"material-symbols-outlined","text-blue-600"],[1,"w-6"],["mat-cell","",1,"cursor-pointer"],[1,"flex","items-center","space-x-2"],[1,"max-w-16","line-clamp-1"],[1,"max-w-48","line-clamp-2",3,"matTooltip"],[1,"max-w-32","line-clamp-1","font-mono","text-sm"],[1,"max-w-20","line-clamp-1","text-end","font-semibold",3,"text-red-600","text-green-600"],[1,"max-w-20","line-clamp-1","text-end","text-orange-600","font-semibold"],[1,"max-w-20","line-clamp-1","text-end","text-blue-600","font-semibold"],[1,"max-w-20","line-clamp-1","text-end","text-purple-600","font-semibold"],[1,"max-w-20","line-clamp-1","text-end","text-indigo-600","font-semibold"],[1,"max-w-28","line-clamp-1","text-sm"],[1,"max-w-16","line-clamp-1","text-center"],[1,"max-w-48","relative"],[1,"max-w-24","relative"],[1,"max-w-32","line-clamp-2",3,"matTooltip"],["mat-icon-button","","color","primary",1,"transition-all","duration-300","ease-in-out","hover:scale-110","relative",3,"click","matTooltip"],[1,"transition-transform","duration-300","ease-in-out","text-blue-600"],[1,"absolute","-top-1","-right-1"],[1,"text-xs","bg-blue-100","text-blue-800","px-2","py-1","rounded-full","font-medium"],[1,"w-3","h-3","bg-blue-500","rounded-full","animate-pulse"],[1,"max-w-20","line-clamp-1","text-end","font-semibold"],[1,"text-red-600","font-bold"],[1,"text-green-600","font-bold"],[1,"text-gray-400","font-bold"],[1,"text-green-500"],[1,"text-red-500"],[1,"max-w-48","relative",3,"click"],["type","text","placeholder","Nh\u1EADp ghi ch\xFA...","autofocus","",1,"w-full","px-2","py-1","border","border-blue-400","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-400",3,"value"],[1,"cursor-text","px-2","py-1","min-h-[28px]","rounded","hover:bg-gray-100","border","border-transparent","hover:border-gray-300","transition-all",3,"bg-yellow-50","border-yellow-400","matTooltip"],["type","text","placeholder","Nh\u1EADp ghi ch\xFA...","autofocus","",1,"w-full","px-2","py-1","border","border-blue-400","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-400",3,"keydown","blur","value"],[1,"cursor-text","px-2","py-1","min-h-[28px]","rounded","hover:bg-gray-100","border","border-transparent","hover:border-gray-300","transition-all",3,"click","matTooltip"],[1,"line-clamp-2"],[1,"text-orange-500","text-sm","absolute","-top-1","-right-1"],[1,"max-w-24","relative",3,"click"],["type","number","placeholder","0","min","0","autofocus","",1,"w-full","px-2","py-1","border","border-blue-400","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-400","text-right",3,"value"],["matTooltip","Click \u0111\u1EC3 ch\u1EC9nh s\u1EEDa SL \u0111\u1EB7t",1,"cursor-text","px-2","py-1","min-h-[28px]","rounded","hover:bg-gray-100","border","border-transparent","hover:border-gray-300","transition-all","text-right","font-semibold",3,"bg-yellow-50","border-yellow-400","text-purple-600"],["type","number","placeholder","0","min","0","autofocus","",1,"w-full","px-2","py-1","border","border-blue-400","rounded","focus:outline-none","focus:ring-2","focus:ring-blue-400","text-right",3,"keydown","blur","value"],["matTooltip","Click \u0111\u1EC3 ch\u1EC9nh s\u1EEDa SL \u0111\u1EB7t",1,"cursor-text","px-2","py-1","min-h-[28px]","rounded","hover:bg-gray-100","border","border-transparent","hover:border-gray-300","transition-all","text-right","font-semibold",3,"click"],["mat-header-row","",1,"bg-gray-50"],["mat-row","",1,"hover:bg-slate-100","transition-colors","duration-200",3,"click"],[1,"mat-row"],[1,"mat-cell","p-8","text-center","text-gray-500"],[1,"flex","flex-col","items-center","space-y-2"],[1,"text-4xl","text-gray-300"],[1,"flex","flex-col","space-y-8","items-center","justify-center"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary","mat-dialog-close","true"],["mat-flat-button","","color","warn","mat-dialog-close","false"]],template:function(t,n){if(t&1){let i=L();o(0,"mat-drawer-container",11)(1,"mat-drawer",12,0),N(3,"router-outlet"),r(),o(4,"div",13)(5,"div",14)(6,"div",15)(7,"div",16)(8,"input",17),f("keyup",function(l){return g(i),_(n.applyGlobalFilter(l))}),r(),o(9,"div",18)(10,"span",19),s(11,"search"),r()()(),o(12,"div",20)(13,"button",21),f("click",function(){return g(i),_(n.applyTempChanges())}),o(14,"mat-icon"),s(15,"check"),r(),s(16),r(),o(17,"button",22),f("click",function(){return g(i),_(n.clearTempStorage())}),o(18,"mat-icon"),s(19,"delete"),r(),s(20," X\xF3a t\u1EA1m "),r()(),o(21,"button",23)(22,"mat-icon"),s(23,"tune"),r()(),o(24,"button",24,1)(26,"mat-icon"),s(27,"date_range"),r()(),o(28,"mat-menu",25,2)(30,"div",26),f("click",function(l){return g(i),_(l.stopPropagation())}),o(31,"div",27)(32,"div",28)(33,"span",29),s(34,"L\u1ECDc theo kho\u1EA3ng th\u1EDDi gian"),r()(),o(35,"div",30)(36,"mat-form-field",31)(37,"mat-label"),s(38,"T\u1EEB ng\xE0y"),r(),o(39,"input",32),Z("ngModelChange",function(l){return g(i),J(n.batdau,l)||(n.batdau=l),_(l)}),f("dateChange",function(l){return g(i),_(n.onStartDateChange(l))}),r(),N(40,"mat-datepicker-toggle",33)(41,"mat-datepicker",null,3),r(),o(43,"mat-form-field",31)(44,"mat-label"),s(45,"\u0110\u1EBFn ng\xE0y"),r(),o(46,"input",34),Z("ngModelChange",function(l){return g(i),J(n.ketthuc,l)||(n.ketthuc=l),_(l)}),f("dateChange",function(l){return g(i),_(n.onEndDateChange(l))}),r(),N(47,"mat-datepicker-toggle",33)(48,"mat-datepicker",null,4),r(),o(50,"div",35)(51,"button",36),f("click",function(){g(i);let l=A(25);return _(n.setToday(l))}),s(52," H\xF4m nay "),r(),o(53,"button",36),f("click",function(){g(i);let l=A(25);return _(n.setThisWeek(l))}),s(54," Tu\u1EA7n n\xE0y "),r(),o(55,"button",36),f("click",function(){g(i);let l=A(25);return _(n.setThisMonth(l))}),s(56," Th\xE1ng n\xE0y "),r(),o(57,"button",37),f("click",function(){return g(i),_(n.clearDateFilter())}),s(58," X\xF3a l\u1ECDc "),r()(),o(59,"div",38)(60,"button",39),f("click",function(){g(i);let l=A(25);return _(n.applyDateFilter(l))}),o(61,"mat-icon"),s(62),r(),s(63),r()(),D(64,yn,2,0,"div",40),o(65,"div",41)(66,"strong"),s(67,"Kho\u1EA3ng th\u1EDDi gian:"),r(),N(68,"br"),s(69),r()()()()(),o(70,"mat-menu",null,5)(72,"div",42)(73,"mat-form-field",43)(74,"input",44),f("input",function(l){return g(i),_(n.doFilterColumns(l))})("click",function(l){return g(i),_(l.stopPropagation())}),r(),o(75,"mat-icon",45),s(76,"search"),r()()(),o(77,"div",46),$(78,Dn,5,2,"button",47,bn),r()(),o(80,"button",48),f("click",function(){return g(i),_(n.ExportExcel(n.TonghopsExportFinal,"Tonghop"))}),D(81,kn,1,0,"mat-spinner",49)(82,Sn,2,0,"mat-icon"),r(),o(83,"button",50),f("click",function(){return g(i),_(n.refresh())}),D(84,En,1,0,"mat-spinner",49)(85,vn,2,0,"mat-icon"),r(),o(86,"input",51,6),f("change",function(l){return g(i),_(n.ImporExcel(l))}),r(),o(88,"span",52),f("click",function(){return g(i),n.pageSize=n.TonghopsFinal.length,_(n.updateDisplayData())}),s(89),D(90,wn,2,2,"span",53),r(),o(91,"span",54),f("click",function(){return g(i),_(!n.isUpdatingStock&&n.Capnhattonkho())}),D(92,Tn,3,0)(93,Mn,2,0,"span"),r(),o(94,"span",55),f("click",function(){return g(i),_(n.downloadTonkhoTemplate())}),s(95,"\u{1F4C4} M\u1EABu Excel"),r()()(),D(96,Fn,6,1,"div",56),o(97,"div",57)(98,"table",58),$(99,ka,3,1,"ng-container",59,Ft),D(101,Sa,1,0,"tr",60)(102,Ea,1,2,"tr",61)(103,va,7,1,"tr",62),r()(),o(104,"div",63)(105,"div",64)(106,"span",65),s(107,"\u0110ang Xem "),o(108,"strong"),s(109),r(),s(110," - "),o(111,"strong"),s(112),r(),s(113),r(),o(114,"div",66)(115,"span",67,7),s(117),r(),o(118,"mat-menu",null,8)(120,"div",68),f("click",function(l){return g(i),_(l.stopPropagation())}),o(121,"span"),s(122,"S\u1ED1 L\u01B0\u1EE3ng"),r(),o(123,"mat-form-field",31)(124,"input",69),Z("ngModelChange",function(l){return g(i),J(n.pageSize,l)||(n.pageSize=l),_(l)}),r()(),o(125,"button",70),f("click",function(){g(i);let l=A(116);return _(n.onPageSizeChange(n.pageSize,l))}),s(126,"\xC1p D\u1EE5ng"),r()()(),o(127,"div",71)(128,"button",72),f("click",function(){return g(i),_(n.onPreviousPage())}),o(129,"mat-icon"),s(130,"keyboard_arrow_left"),r()(),o(131,"button",72),f("click",function(){return g(i),_(n.onNextPage())}),o(132,"mat-icon"),s(133,"keyboard_arrow_right"),r()()()()()()()(),D(134,wa,11,0,"ng-template",null,9,At)}if(t&2){let i=A(29),d=A(42),l=A(49),m=A(71),T=A(119);u(),b("position","end"),u(12),b("disabled",n.getTempChangesCount()===0),u(3),C(" \xC1p d\u1EE5ng (",n.getTempChangesCount(),") "),u(),b("disabled",n.getTempChangesCount()===0),u(4),b("matMenuTriggerFor",m),u(3),b("matMenuTriggerFor",i),u(2),R("text-blue-600",n.isDateRangeEnabled),u(13),b("matDatepicker",d),X("ngModel",n.batdau),u(),b("for",d),u(6),b("matDatepicker",l),X("ngModel",n.ketthuc),u(),b("for",l),u(13),b("color",n.hasUnappliedDateChanges?"warn":"primary"),u(2),k(n.hasUnappliedDateChanges?"pending":"filter_alt"),u(),C(" ",n.hasUnappliedDateChanges?"C\xF3 thay \u0111\u1ED5i - \xC1p d\u1EE5ng":"\xC1p d\u1EE5ng l\u1ECDc"," "),u(),S(n.hasUnappliedDateChanges?64:-1),u(5),kt(" ",n.formatDateForDisplay(n.batdau,"DD/MM/YYYY")," - ",n.formatDateForDisplay(n.ketthuc,"DD/MM/YYYY")," "),u(9),H(n.FilterColumns),u(2),b("disabled",n.isExportingExcel),u(),S(n.isExportingExcel?81:82),u(2),b("disabled",n.isLoading||n.isRefreshing),u(),S(n.isRefreshing?84:85),u(5),C(" ",n.TonghopsFinal.length>0?n.TonghopsFinal.length:n.Listsanpham().length," S\u1EA3n Ph\u1EA9m "),u(),S(n.isDateRangeEnabled?90:-1),u(),Mt("whitespace-nowrap p-2 border rounded-lg cursor-pointer flex items-center space-x-2 "+(n.isUpdatingStock?"opacity-50 cursor-not-allowed":"hover:bg-slate-50")),u(),S(n.isUpdatingStock?92:93),u(4),S(n.isLoading||n.isRefreshing?96:-1),u(2),b("dataSource",n.dataSource),u(),H(n.displayedColumns),u(2),b("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),u(),b("matRowDefColumns",n.displayedColumns),u(7),k((n.currentPage-1)*n.pageSize+1),u(3),k(n.currentPage*n.pageSize>n.totalItems?n.totalItems:n.currentPage*n.pageSize),u(),It(" trong s\u1ED1 ",n.totalItems," m\u1EE5c, ",n.currentPage,"/",n.totalPages," Trang"),u(2),b("matMenuTriggerFor",T),u(2),C("Hi\u1EC7n Th\u1ECB : ",n.pageSize," m\u1EE5c"),u(7),X("ngModel",n.pageSize),b("ngModelOptions",Lt(45,Cn)),u(4),b("disabled",n.currentPage===1),u(3),b("disabled",n.currentPage===n.totalPages)}},dependencies:[me,pe,de,ue,he,_e,ge,Ie,De,Se,Te,Ee,ke,Me,ve,we,Fe,Ne,Pe,ye,ht,be,Ce,ne,te,Zt,ee,Jt,Qt,Xt,Rt,rt,ot,it,nt,at,xe,et,Vt,zt,tt,re,ae,ie,oe,ut,dt,ct,lt,st,Re,Ge,Ve,ze,Kt,$e,je,mt,pt],styles:[".mat-mdc-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.mat-mdc-header-cell[_ngcontent-%COMP%]{padding:8px 12px;position:sticky;top:0;background:#f8fafc;border-bottom:2px solid #e2e8f0;font-weight:600;z-index:10}.mat-mdc-cell[_ngcontent-%COMP%]{padding:8px 12px;border-bottom:1px solid #e2e8f0;vertical-align:middle}.mat-mdc-row[_ngcontent-%COMP%]:hover{background-color:#f1f5f9;transition:background-color .2s ease}.quick-filter-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap;align-items:center}.quick-filter-button[_ngcontent-%COMP%]{padding:4px 12px;font-size:12px;min-height:32px;border-radius:16px}.quick-filter-button.active[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff}.filter-menu[_ngcontent-%COMP%]{max-width:400px}.date-filter-menu[_ngcontent-%COMP%]{max-width:350px}.date-filter-menu[_ngcontent-%COMP%]   .mat-mdc-menu-content[_ngcontent-%COMP%]{padding:0!important}.date-range-indicator[_ngcontent-%COMP%]{display:inline-flex;align-items:center;padding:4px 8px;background-color:#dbeafe;color:#1e40af;border-radius:12px;font-size:11px;font-weight:500;margin-left:8px}.mat-mdc-form-field.mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-text-field-wrapper[_ngcontent-%COMP%]{background-color:#fff}.date-range-status[_ngcontent-%COMP%]{background-color:#f1f5f9;border:1px solid #e2e8f0;border-radius:6px;padding:8px;font-size:12px;color:#475569}.quick-date-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:6px}.quick-date-buttons[_ngcontent-%COMP%]   .mat-mdc-button[_ngcontent-%COMP%]{font-size:11px;min-width:auto;padding:4px 8px;height:28px;line-height:20px}.filter-menu[_ngcontent-%COMP%]   .mat-mdc-menu-content[_ngcontent-%COMP%]{padding:0}.filter-search-input[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:14px}.filter-search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 2px #3b82f61a}.filter-options[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto}.filter-option[_ngcontent-%COMP%]{padding:8px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;border-radius:4px;margin:2px 4px}.filter-option[_ngcontent-%COMP%]:hover{background-color:#f1f5f9}.filter-option.selected[_ngcontent-%COMP%]{background-color:#dbeafe;color:#1d4ed8}.column-filter-icon[_ngcontent-%COMP%]{opacity:.6;transition:opacity .2s ease;cursor:pointer}.column-filter-icon[_ngcontent-%COMP%]:hover{opacity:1;color:#3b82f6}@media (max-width: 768px){.mat-mdc-header-cell[_ngcontent-%COMP%], .mat-mdc-cell[_ngcontent-%COMP%]{padding:6px 8px;font-size:13px}.quick-filter-buttons[_ngcontent-%COMP%]{gap:4px}.quick-filter-button[_ngcontent-%COMP%]{padding:3px 8px;font-size:11px;min-height:28px}}.status-low-stock[_ngcontent-%COMP%]{color:#dc2626;font-weight:600}.status-normal-stock[_ngcontent-%COMP%]{color:#059669;font-weight:600}.status-pending[_ngcontent-%COMP%]{color:#d97706;font-weight:600}.status-suggestion[_ngcontent-%COMP%]{color:#7c3aed;font-weight:600}.mat-mdc-row[_ngcontent-%COMP%]{transition:all .2s ease}.mat-mdc-row.filtered-out[_ngcontent-%COMP%]{opacity:.5;transform:scale(.98)}.search-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.search-icon[_ngcontent-%COMP%]{position:absolute;left:12px;color:#6b7280;z-index:1}.search-input[_ngcontent-%COMP%]{padding-left:40px}.pagination-info[_ngcontent-%COMP%]{font-size:14px;color:#6b7280}.pagination-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 4px}.filter-badge[_ngcontent-%COMP%]{position:absolute;top:-2px;right:-2px;background:#dc2626;color:#fff;border-radius:50%;width:16px;height:16px;font-size:10px;display:flex;align-items:center;justify-content:center}.filter-options[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.filter-options[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.filter-options[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.filter-options[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.detail-row[_ngcontent-%COMP%]{height:0}.mat-icon.rotate-180[_ngcontent-%COMP%]{transform:rotate(180deg);transition:transform .3s ease}.mat-icon[_ngcontent-%COMP%]:not(.rotate-180){transition:transform .3s ease}.expanded-content[_ngcontent-%COMP%]{padding:16px;background-color:#f8fafc;border-top:1px solid #e2e8f0}.nested-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:14px}.nested-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .nested-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px 12px;text-align:left;border:1px solid #e2e8f0}.nested-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f1f5f9;font-weight:600;font-size:13px}.nested-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8fafc}.status-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:12px;font-size:11px;font-weight:500;text-transform:uppercase}.status-badge.completed[_ngcontent-%COMP%], .status-badge.delivered[_ngcontent-%COMP%]{background-color:#dcfce7;color:#166534}.status-badge.pending[_ngcontent-%COMP%]{background-color:#fef3c7;color:#92400e}.status-badge.shipping[_ngcontent-%COMP%]{background-color:#dbeafe;color:#1e40af}.loading-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:24px}.loading-spinner[_ngcontent-%COMP%]{margin-right:12px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:24px;color:#64748b}.empty-state[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:8px;opacity:.5}"],data:{animation:[qt("detailExpand",[Et("collapsed",St({height:"0px",minHeight:"0"})),Et("expanded",St({height:"*"})),Ut("expanded <=> collapsed",jt("225ms cubic-bezier(0.4, 0.0, 0.2, 1)"))])]},changeDetection:0})};Ct([Qe(300)],Y.prototype,"doFilterHederColumn",1),Ct([Qe(300)],Y.prototype,"applyAdvancedColumnFilter",1);var We=Y;function Qe(a=300){return function(e,t,n){let i=n.value,d;return n.value=function(...l){clearTimeout(d),d=setTimeout(()=>{i.apply(this,l)},a)},n}}export{We as NhucaudathangComponent};
