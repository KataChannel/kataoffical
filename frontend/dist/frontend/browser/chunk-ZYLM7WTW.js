import{a as St}from"./chunk-6FC2GRWJ.js";import{a as Lt}from"./chunk-VRX3PFHD.js";import{a as ut}from"./chunk-XK2GJYFF.js";import{a as pt}from"./chunk-AJ5JTY7X.js";import{a as dt}from"./chunk-GPXTOZIJ.js";import{a as ft}from"./chunk-UCPSMH2E.js";import{a as yt}from"./chunk-XRNIFLBZ.js";import{a as nt}from"./chunk-DO444VEW.js";import{c as U,h as Z}from"./chunk-6T5DLZAF.js";import{a as gt,g as lt,h as N}from"./chunk-EHGCZ4C4.js";import{a as ct}from"./chunk-H3TTFDG6.js";import{b as et,c as st,d as rt,e as ot,g as ht,s as mt}from"./chunk-AYBK3TLN.js";import{c as j}from"./chunk-QR3VZXMW.js";import{b as it}from"./chunk-OCCYRB3G.js";import{a as It}from"./chunk-JNVUT6FC.js";import{d as J}from"./chunk-5NUPTYVB.js";import{a as z,b as X}from"./chunk-WCQZDYIS.js";import{n as W,v as tt,y as at}from"./chunk-2G4G76BL.js";import{a as $}from"./chunk-LCSHMLYS.js";import{a as q,e as Q}from"./chunk-M4K2YFJY.js";import{y as R}from"./chunk-INKYKFQH.js";import{c as V}from"./chunk-4TLJXXI3.js";import{l as F,m as O,t as Y}from"./chunk-4KYRHQES.js";import{Cc as A,Dc as p,Eb as K,Ec as H,Lb as I,Ra as x,Vb as B,Zb as v,dc as m,ec as l,id as G,jc as T,oa as o,oc as L,qc as M,rb as k,wc as w,xa as f,xc as b,ya as S,yc as _}from"./chunk-6QR2UCJZ.js";import{a as E,b as P,g as xt,j as y}from"./chunk-6DYNGEAS.js";var g=xt(It());var Bt=["drawer"];function Tt(u,i){u&1&&(m(0,"mat-icon"),p(1,"check"),l())}function Mt(u,i){if(u&1){let n=T();m(0,"span",8),L("click",function(){let e=f(n).$implicit,s=M();return S(s.toggleItem(e))}),I(1,Tt,2,0,"mat-icon",9),m(2,"span"),p(3),l()()}if(u&2){let n=i.$implicit,t=M();v("",t.CheckItem(n)?"bg-blue-100":""," cursor-pointer flex flex-row space-x-2 items-center p-4 rounded-lg border"),k(),B("ngIf",t.CheckItem(n)),k(2),H(n.title)}}var kt=class u{displayedColumns=[];ColumnName={stt:"#",codeId:"Code",name:"Ti\xEAu \u0110\u1EC1",group:"Nh\xF3m",description:"M\xF4 T\u1EA3",status:"Tr\u1EA1ng Th\xE1i",order:"Th\u1EE9 T\u1EF1",createdAt:"Ng\xE0y T\u1EA1o",updatedAt:"Ng\xE0y C\u1EADp Nh\u1EADt"};FilterColumns=JSON.parse(localStorage.getItem("ImportdataColFilter")||"[]");Columns=[];paginator;sort;drawer;_BanggiaService=o(pt);_SanphamService=o(ft);_KhachhangService=o(dt);_NhacungcapService=o(yt);_DonhangService=o(nt);_DathangService=o(ut);_PhieukhoService=o(St);_KhoService=o(Lt);_breakpointObserver=o(R);_GoogleSheetService=o(ct);_router=o(V);_dialog=o(U);_snackBar=o($);ListImportdata=x([{id:1,title:"S\u1EA3n Ph\u1EA9m",value:"sanpham",status:!0},{id:2,title:"Kh\xE1ch H\xE0ng",value:"khachhang",status:!0},{id:3,title:"Nh\xE0 Cung C\u1EA5p",value:"nhacungcap",status:!0},{id:4,title:"B\u1EA3ng Gi\xE1",value:"banggia",status:!0},{id:5,title:"\u0110\u01A1n H\xE0ng",value:"donhang",status:!0},{id:6,title:"\u0110\u1EB7t H\xE0ng",value:"dathang",status:!0},{id:7,title:"B\u1EA3ng Gi\xE1 Kh\xE1ch H\xE0ng",value:"banggiakhachhang",status:!0},{id:8,title:"B\u1EA3ng Gi\xE1 S\u1EA3n Ph\u1EA9m",value:"banggiasanpham",status:!0},{id:9,title:"Nh\xE0 Cung C\u1EA5p S\u1EA3n Ph\u1EA9m",value:"nhacungcapsanpham",status:!0},{id:10,title:"Xu\u1EA5t Nh\u1EADp T\u1ED3n",value:"xuatnhapton",status:!0}]);ListEdit=x([]);TitleExport="export";rawListSP=[];rawListKH=[];rawListNCC=[];rawListBG=[];rawListDH=[];rawListDathang=[];rawListTonkho=[];constructor(){G(()=>y(this,null,function*(){yield this._SanphamService.getAllSanpham(),this.rawListSP=this._SanphamService.ListSanpham(),yield this._KhachhangService.getAllKhachhang(),this.rawListKH=this._KhachhangService.ListKhachhang(),yield this._NhacungcapService.getAllNhacungcap(),this.rawListNCC=this._NhacungcapService.ListNhacungcap(),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),yield this._DonhangService.getAllDonhang(),this.rawListDH=this._DonhangService.ListDonhang(),yield this._DathangService.getAllDathang(),this.rawListDathang=this._DathangService.ListDathang(),yield this._KhoService.getTonKho("1","1000").then(i=>{this.rawListTonkho=i.data})}))}ngOnInit(){return y(this,null,function*(){yield this._SanphamService.getAllSanpham(),this.rawListSP=this._SanphamService.ListSanpham(),yield this._KhachhangService.getAllKhachhang(),this.rawListKH=this._KhachhangService.ListKhachhang(),yield this._NhacungcapService.getAllNhacungcap(),this.rawListNCC=this._NhacungcapService.ListNhacungcap(),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),yield this._DonhangService.getAllDonhang(),this.rawListDH=this._DonhangService.ListDonhang(),yield this._DathangService.getAllDathang(),this.rawListDathang=this._DathangService.ListDathang(),yield this._KhoService.getTonKho("1","1000").then(i=>{this.rawListTonkho=i.data})})}applyFilter(i){}toggleAll(){this.ListEdit().length===this.ListImportdata().length?(this.ListEdit.set([]),this.TitleExport="export"):(this.ListEdit.set(this.ListImportdata()),this.TitleExport="export_all")}toggleItem(i){this.ListEdit().findIndex(t=>t.id===i.id)===-1?(this.TitleExport+="_"+i.value,this.ListEdit.update(t=>[...t,i])):(this.TitleExport=this.TitleExport.replace("_"+i.value,""),this.ListEdit.update(t=>t.filter(e=>e.id!==i.id))),console.log(i),console.log(this.ListEdit())}CheckItem(i){return this.ListEdit().findIndex(t=>t.id===i.id)!==-1}ExportExcel(i){return y(this,null,function*(){let n=Array.isArray(this.rawListSP)&&this.rawListSP.length?this.rawListSP.map(a=>({masp:a.masp,subtitle:a.subtitle,title:a.title,title2:a.title2,giaban:a.giaban,giagoc:a.giagoc,dvt:a.dvt,haohut:a.haohut,ghichu:a.ghichu})):[{masp:"",subtitle:"",title:"",title2:"",giaban:"",giagoc:"",dvt:"",haohut:"",ghichu:""}],t=Array.isArray(this.rawListKH)&&this.rawListKH.length?this.rawListKH.map(a=>({name:a.name?.trim()||"",makh:a.makh?.trim()||"",namenn:a.namenn?.trim()||"",diachi:a.diachi?.trim()||"",quan:a.quan?.trim()||"",email:a.email?.trim()||"",sdt:a.sdt?.toString().trim()||"",mst:a.mst?.toString().trim()||"",gionhanhang:a.gionhanhang?.toString().trim()||"",loaikh:a.loaikh?.toString().trim()||"khachsi",hiengia:a.hiengia||!0,ghichu:a.ghichu?.toString().trim()||""})):[{name:"",makh:"",namenn:"",diachi:"",quan:"",email:"",sdt:"",mst:"",gionhanhang:"",loaikh:"khachsi",hiengia:!0,ghichu:""}],e=Array.isArray(this.rawListNCC)&&this.rawListNCC.length?this.rawListNCC.map(a=>({name:a.name?.trim()||"",mancc:a.mancc?.trim()||"",diachi:a.diachi?.trim()||"",email:a.email?.trim()||"",sdt:a.sdt?.toString().trim()||"",ghichu:a.ghichu?.toString().trim()||""})):[{name:"",mancc:"",diachi:"",email:"",sdt:"",ghichu:""}],s=Array.isArray(this.rawListBG)&&this.rawListBG.length?this.rawListBG.map(a=>({title:a.title?.trim()||"",mabanggia:a.mabanggia?.trim()||"",type:a.type?.trim()||"",batdau:a.batdau?.trim()||"",ketthuc:a.ketthuc?.trim()||"",ghichu:a.ghichu?.trim()||"",status:a.status?.trim()||""})):[{title:"",mabanggia:"",type:"",batdau:"",ketthuc:"",ghichu:"",status:""}],r=Array.isArray(this.rawListDH)&&this.rawListDH.length?this.rawListDH.map(a=>({madonhang:a.madonhang?.trim()||"",makh:a.makh?.trim()||"",mancc:a.mancc?.trim()||"",masp:a.masp?.trim()||"",soluong:a.soluong?.trim()||"",giaban:a.giaban?.trim()||"",ghichu:a.ghichu?.trim()||""})):[{madonhang:"",makh:"",mancc:"",masp:"",soluong:"",giaban:"",ghichu:""}],wt=Array.isArray(this.rawListDathang)&&this.rawListDathang.length?this.rawListDathang.map(a=>({madathang:a.madathang?.trim()||"",makh:a.makh?.trim()||"",mancc:a.mancc?.trim()||"",masp:a.masp?.trim()||"",soluong:a.soluong?.trim()||"",giaban:a.giaban?.trim()||"",ghichu:a.ghichu?.trim()||""})):[{madathang:"",makh:"",mancc:"",masp:"",soluong:"",giaban:"",ghichu:""}],bt=this.convertBGSPToExport(this.rawListBG,this.rawListSP),_t=this.rawListKH.map(a=>{let c={makh:a.makh||"",name:a.name||""};for(let d of this.rawListBG){let C=a.banggia?.some(D=>D.mabanggia===d.mabanggia);c[d.mabanggia]=C?d.mabanggia:""}return c}),Ct=this.rawListSP.reduce((a,c)=>(c&&c.masp&&(a[c.masp]=""),a),{}),Dt=this.rawListNCC.map(a=>{let c={mancc:a.mancc||"",name:a.name||""};for(let d of Object.keys(Ct)){let C=a.Sanpham?.some(D=>D.masp===d);c[d]=C?d:""}return c}),Et=this.rawListTonkho.map(a=>({masp:a.masp,title:a.title,dvt:a.dvt,slton:a.slton})),h={};if(this.ListEdit().some(a=>a.value==="sanpham")&&(h.sanpham={data:n}),this.ListEdit().some(a=>a.value==="khachhang")&&(h.khachhang={data:t}),this.ListEdit().some(a=>a.value==="nhacungcap")&&(h.nhacungcap={data:e}),this.ListEdit().some(a=>a.value==="banggia")&&(h.banggia={data:s}),this.ListEdit().some(a=>a.value==="donhang")&&(h.donhang={data:r}),this.ListEdit().some(a=>a.value==="dathang")&&(h.dathang={data:wt}),this.ListEdit().some(a=>a.value==="banggiasanpham")&&(h.banggiasanpham={data:bt}),this.ListEdit().some(a=>a.value==="banggiakhachhang")&&(h.banggiakhachhang={data:_t}),this.ListEdit().some(a=>a.value==="nhacungcapsanpham")&&(h.nhacungcapsanpham={data:Dt}),this.ListEdit().some(a=>a.value==="xuatnhapton")&&(h.xuatnhapton={data:Et}),Object.keys(h).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});return}gt(h,i)})}convertBGSPToExport(i,n){let t=new Set(i.map(e=>e.mabanggia));return n.map(e=>E({masp:e.masp,title:e.title,giaban:e.giaban.toString()},Array.from(t).reduce((s,r)=>(s[r]=e.giaban.toString(),s),{})))}convertBGSPToImport(i){return!i||i.length===0?[]:Object.keys(i[0]).filter(e=>!["masp","title","giagoc"].includes(e)).map(e=>({mabanggia:e,title:`B\u1EA3ng gi\xE1 ${e.replace("BG","")}`,sanpham:i.map(s=>({masp:s.masp,title:s.title,giagoc:s.giagoc,giaban:s[e]||0}))}))}convertBHKHToImport(i){if(!i||i.length===0)return[];let n=Object.keys(i[0]).filter(t=>!["makh","name"].includes(t));return i.forEach(t=>{console.log(t),t.banggia=[];for(let e of n)t[e]!==void 0&&t[e]!==null&&t[e]!==""&&t.banggia.push(t[e]),delete t[e]}),i}convertNCCSPToImport(i){if(!i||i.length===0)return[];let n=Object.keys(i[0]).filter(t=>!["mancc","name"].includes(t));return i.forEach(t=>{t.Sanpham=[];for(let e of n)t[e]!==void 0&&t[e]!==null&&t[e]!==""&&t.Sanpham.push(t[e]),delete t[e]}),i}ImportExcel(i){return y(this,null,function*(){let n=yield lt(i);this.DoImportData(n)})}DoImportData(i){return y(this,null,function*(){if(i.sanpham&&i.sanpham.length>0&&this.ListEdit().some(n=>n.value==="sanpham")){let n=(i.sanpham||[]).map(t=>({masp:t.masp,subtitle:t.subtitle,title:t.title,title2:t.title2,giaban:t.giaban,giagoc:t.giagoc,dvt:t.dvt,haohut:t.haohut,ghichu:t.ghichu})).filter(t=>t.masp!==void 0&&t.masp!==null&&t.masp!=="");yield this._SanphamService.ImportSanpham(n)}if(i.khachhang&&i.khachhang.length>0&&this.ListEdit().some(n=>n.value==="khachhang")){let n=(i.khachhang||[]).map(t=>({name:t.name,makh:t.makh,namenn:t.namenn,diachi:t.diachi,quan:t.quan,email:t.email,sdt:t.sdt.toString(),mst:t.mst.toString(),gionhanhang:t.gionhanhang.toString(),loaikh:t.loaikh,ghichu:t.ghichu})).filter(t=>t.makh!==void 0&&t.makh!==null&&t.makh!=="");yield this._KhachhangService.ImportKhachhang(n)}if(i.nhacungcap&&i.nhacungcap.length>0&&this.ListEdit().some(n=>n.value==="nhacungcap")){let n=(i.nhacungcap||[]).map(t=>({name:t.name,mancc:t.mancc,diachi:t.diachi,email:t.email,sdt:t.sdt,ghichu:t.ghichu})).filter(t=>t.mancc!==void 0&&t.mancc!==null&&t.mancc!=="");yield this._NhacungcapService.ImportNhacungcap(n)}if(i.banggia&&i.banggia.length>0&&this.ListEdit().some(n=>n.value==="banggia")){let n=(i.banggia||[]).map(t=>({title:"B\u1EA3ng Gi\xE1 "+t.mabanggia,mabanggia:t.mabanggia,type:t.type,batdau:(0,g.default)(N(t.batdau)).toDate(),ketthuc:(0,g.default)(N(t.ketthuc)).toDate(),ghichu:t.ghichu,status:t.status})).filter(t=>t.mabanggia!==void 0&&t.mabanggia!==null&&t.mabanggia!=="");yield this._BanggiaService.ImportBanggia(n)}if(i.donhang&&i.donhang.length>0&&this.ListEdit().some(n=>n.value==="donhang")){let n=(i.donhang||[]).map(t=>({ngay:t.ngay,makh:t.makh,mabangia:t.mabangia,masp:t.masp,sldat:t.sldat,slgiao:t.slgiao,slnhan:t.slnhan,ghichu:t.ghichu})).filter(t=>t.makh!==void 0&&t.makh!==null&&t.makh!==""&&t.masp!==void 0&&t.masp!==null&&t.masp!=="");yield this._DonhangService.ImportDonhang(n)}if(i.banggiasanpham&&i.banggiasanpham.length>0&&this.ListEdit().some(n=>n.value==="banggiasanpham")){let n=this.convertBGSPToImport(i.banggiasanpham);yield this._BanggiaService.importSPBG(n)}if(i.banggiakhachhang&&i.banggiakhachhang.length>0&&this.ListEdit().some(n=>n.value==="banggiakhachhang")){let n=this.convertBHKHToImport(i.banggiakhachhang).filter(t=>t.banggia.length>0);yield this._KhachhangService.ImportKhachhang(n),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(i.nhacungcapsanpham&&i.nhacungcapsanpham.length>0&&this.ListEdit().some(n=>n.value==="nhacungcapsanpham")){let n=this.convertNCCSPToImport(i.nhacungcapsanpham);console.log(n);let t=n.filter(e=>e?.Sanpham?.length>0).map(e=>P(E({},e),{Sanpham:e?.Sanpham?.map(s=>this.rawListSP.find(r=>r?.masp===s))}));yield this._NhacungcapService.ImportNhacungcap(t),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(i.xuatnhapton&&i.xuatnhapton.length>0&&this.ListEdit().some(n=>n.value==="xuatnhapton")){let n=[],t=[];i.xuatnhapton.forEach(e=>{let s=this.rawListTonkho.find(r=>r.masp===e.masp);s&&(e.slton>s.slton?n.push({sanphamId:this.rawListSP.find(r=>r.masp===e.masp).id,soluong:e.slton-s.slton}):e.slton<s.slton&&t.push({sanphamId:this.rawListSP.find(r=>r.masp===e.masp).id,soluong:s.slton-e.slton}))}),n.length>0&&this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${(0,g.default)().format("DD/MM/YYYY ")}`,type:"nhap",sanpham:n,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${(0,g.default)().format("HH:mm:ss DD/MM/YYYY ")}`,ngay:(0,g.default)()}),t.length>0&&this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${(0,g.default)().format("DD/MM/YYYY ")}`,type:"xuat",sanpham:t,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${(0,g.default)().format("HH:mm:ss DD/MM/YYYY ")}`,ngay:(0,g.default)()}),n.length===0&&t.length===0&&this._snackBar.open("Kho kh\xF4ng thay \u0111\u1ED5i","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}})}trackByFn(i,n){return n.id}static \u0275fac=function(n){return new(n||u)};static \u0275cmp=K({type:u,selectors:[["app-listimportdata"]],viewQuery:function(n,t){if(n&1&&(w(st,5),w(ot,5),w(Bt,7)),n&2){let e;b(e=_())&&(t.paginator=e.first),b(e=_())&&(t.sort=e.first),b(e=_())&&(t.drawer=e.first)}},decls:16,vars:2,consts:[["uploadfile",""],[1,"flex","flex-col","space-y-2","p-8"],[1,"flex","flex-row","space-x-2","items-center"],["mat-flat-button","","color","primary",3,"click"],[1,"ml-1"],["type","file",1,"hidden",3,"change"],[1,"grid","grid-cols-3","gap-4"],[3,"class","click",4,"ngFor","ngForOf","ngForTrackBy"],[3,"click"],[4,"ngIf"]],template:function(n,t){if(n&1){let e=T();m(0,"div",1)(1,"div",2)(2,"button",3),L("click",function(){return f(e),S(t.ExportExcel(t.TitleExport))}),p(3," T\u1EA3i Xu\u1ED1ng T\u1EA5t C\u1EA3 "),m(4,"mat-icon",4),p(5,"download"),l()(),m(6,"button",3),L("click",function(){f(e);let r=A(13);return S(r.click())}),p(7," T\u1EA3i L\xEAn T\u1EA5t C\u1EA3 "),m(8,"mat-icon",4),p(9,"upload"),l()(),m(10,"button",3),L("click",function(){return f(e),S(t.toggleAll())}),p(11," Ch\u1ECDn T\u1EA5t C\u1EA3 "),l(),m(12,"input",5,0),L("change",function(r){return f(e),S(t.ImportExcel(r))}),l()(),m(14,"div",6),I(15,Mt,4,5,"span",7),l()()}n&2&&(k(15),B("ngForOf",t.ListImportdata())("ngForTrackBy",t.trackByFn))},dependencies:[tt,at,mt,ht,rt,J,j,X,z,Q,q,it,Y,F,O,W,et,Z],encapsulation:2,changeDetection:0})};export{kt as a};
