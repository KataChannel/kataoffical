import{a as le}from"./chunk-2ESOPHUI.js";import{a as oe,b as re}from"./chunk-IYDUJFYL.js";import"./chunk-BFIAAR4D.js";import"./chunk-FLL7JLBF.js";import"./chunk-5GVQUXE5.js";import"./chunk-AGNKQBAM.js";import"./chunk-ZW44ZSN2.js";import"./chunk-BQNHPUMH.js";import"./chunk-SLRDYDMI.js";import"./chunk-N7PBUGTM.js";import{a as ie,b as ne}from"./chunk-B7S53KSA.js";import"./chunk-TDAACTQD.js";import{h as X}from"./chunk-INJUMOX2.js";import"./chunk-H7UDLENL.js";import{a as z}from"./chunk-GD7IEZTW.js";import"./chunk-DP4FJZ2N.js";import"./chunk-CHYLEG5B.js";import{a as L,c as V}from"./chunk-RFYKARPR.js";import{a as ee,b as te}from"./chunk-IKSNCL6N.js";import"./chunk-B52A5VRT.js";import{b as Z}from"./chunk-LVDD4ZW7.js";import{A as U,B as Y,b as H,g as G,j as K,p as O,r as $,x as J,y as Q}from"./chunk-Z4P6AN2F.js";import"./chunk-KBSHTQVA.js";import{a as j,b as q}from"./chunk-4KMAECDD.js";import"./chunk-B5XVARHK.js";import"./chunk-KY47JUDC.js";import"./chunk-2PPFUFFT.js";import{a as A,c as N,e as W}from"./chunk-5RXGINDA.js";import"./chunk-RO6MDUJX.js";import"./chunk-HMVCX5BQ.js";import{m as F,w as B}from"./chunk-RGQ7KTVF.js";import{$b as P,Db as E,Dc as s,Ec as x,Gc as I,Ic as y,Jc as w,Kb as C,Kc as S,Ra as R,Ub as p,ac as b,cc as M,dc as k,ec as o,fc as l,gc as T,hc as v,ic as D,kc as f,pa as _,pc as u,rb as a,rc as c,ya as g,za as h}from"./chunk-OL5DVADB.js";import"./chunk-LWLSKGAV.js";import{j as d}from"./chunk-6DYNGEAS.js";function se(r,e){if(r&1){let t=f();o(0,"button",1),u("click",function(){g(t);let n=c();return h(n.handleRoleAction())}),o(1,"mat-icon"),s(2,"save"),l()()}}function ce(r,e){if(r&1){let t=f();o(0,"button",1),u("click",function(){g(t);let n=c();return h(n.toggleEdit())}),o(1,"mat-icon"),s(2,"edit"),l()()}}function me(r,e){if(r&1){let t=f();v(0),o(1,"div",9)(2,"div",10),s(3,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),l(),o(4,"div",11)(5,"button",12),u("click",function(){g(t);let n=c();return h(n.DeleteData())}),s(6,"\u0110\u1ED3ng \xDD"),l(),o(7,"button",13),u("click",function(){g(t);let n=c();return h(n.toggleDelete())}),s(8,"Hu\u1EF7 B\u1ECF"),l()()(),D()}}function de(r,e){r&1&&T(0,"mat-spinner",20)}function pe(r,e){if(r&1){let t=f();o(0,"div",18)(1,"mat-slide-toggle",19),u("change",function(){let n=g(t).$implicit,m=c(2);return h(m.togglePermission(n))}),s(2),l(),C(3,de,1,0,"mat-spinner",20),l()}if(r&2){let t=e.$implicit,i=c(2);a(),p("disabled",!i.isEdit()||i.isTogglingPermission()===t.id)("checked",t.hasPermission),a(),I(" ",t.name," - (",t.description||"Ch\u01B0a M\xF4 T\u1EA3",") "),a(),P(i.isTogglingPermission()===t.id?3:-1)}}function ue(r,e){if(r&1){let t=f();v(0),o(1,"div",14)(2,"mat-form-field",15)(3,"mat-label"),s(4,"T\xEAn Nh\xF3m"),l(),o(5,"input",16),S("ngModelChange",function(n){g(t);let m=c();return w(m.DetailRole.name,n)||(m.DetailRole.name=n),h(n)}),l()()(),o(6,"div",17),M(7,pe,4,5,"div",18,b),l(),D()}if(r&2){let t=c();a(5),y("ngModel",t.DetailRole.name),p("disabled",!t.isEdit()),a(2),k(t.filterPermission)}}var ae=class r{_ListroleComponent=_(re);_RoleService=_(oe);_PermissionService=_(le);_route=_(L);_router=_(V);_snackBar=_(z);ListPermission=[];filterPermission=[];idRole=0;constructor(){this._route.paramMap.subscribe(e=>d(this,null,function*(){this.idRole=e.get("id")}))}DetailRole={};isEdit=R(!1);isDelete=R(!1);isTogglingPermission=R("");ngOnInit(){return d(this,null,function*(){yield this._PermissionService.getAllPermission(1e3),this.ListPermission=this._PermissionService.ListPermission(),this.idRole?this.idRole==="new"?(this._ListroleComponent.drawer.open(),this.isEdit.update(e=>!e),this.filterPermission=this.ListPermission,this._router.navigate(["/admin/nhomuser","new"])):(yield this._RoleService.getRoleByid(this.idRole).then(()=>{this.DetailRole=this._RoleService.DetailRole(),this.filterPermission=this.ListPermission.map(e=>(this.DetailRole?.permissions?.length>0&&(e.hasPermission=!!this.DetailRole?.permissions.find(t=>t.permissionId===e.id)),e))}),this._ListroleComponent.drawer.open(),this._router.navigate(["/admin/nhomuser",this.idRole])):(this._router.navigate(["/admin/nhomuser"]),this._ListroleComponent.drawer.close()),setTimeout(()=>{console.log(this.filterPermission)},200)})}handleRoleAction(){return d(this,null,function*(){this.idRole==="new"?yield this.createRole():yield this.updateRole()})}createRole(){return d(this,null,function*(){console.log(this.DetailRole);try{yield this._RoleService.CreateRole(this.DetailRole),this._snackBar.open("T\u1EA1o M\u1EDBi Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(e=>!e)}catch(e){console.error("L\u1ED7i khi t\u1EA1o role:",e)}})}updateRole(){return d(this,null,function*(){try{yield this._RoleService.updateRole(this.DetailRole),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(e=>!e)}catch(e){console.error("L\u1ED7i khi c\u1EADp nh\u1EADt role:",e)}})}DeleteData(){return d(this,null,function*(){try{yield this._RoleService.DeleteRole(this.DetailRole),this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this._router.navigate(["/admin/nhomuser"])}catch(e){console.error("L\u1ED7i khi x\xF3a role:",e)}})}goBack(){this._router.navigate(["/admin/nhomuser"]),this._ListroleComponent.drawer.close()}trackByFn(e,t){return t.id}toggleEdit(){this.isEdit.update(e=>!e)}toggleDelete(){this.isDelete.update(e=>!e)}FillSlug(){}togglePermission(e){return d(this,null,function*(){let t=e.hasPermission,i=!e.hasPermission;this.isTogglingPermission.set(e.id),e.hasPermission=i;try{let n;i?n=yield this._RoleService.assignPermissionToRole({roleId:this.idRole,permissionId:e.id}):n=yield this._RoleService.removePermissionFromRole({roleId:this.idRole,permissionId:e.id}),n||(e.hasPermission=t,this._snackBar.open(`L\u1ED7i khi ${i?"g\xE1n":"x\xF3a"} quy\u1EC1n. Vui l\xF2ng th\u1EED l\u1EA1i.`,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}))}catch(n){e.hasPermission=t,console.error("Error toggling permission:",n),this._snackBar.open(`L\u1ED7i khi ${i?"g\xE1n":"x\xF3a"} quy\u1EC1n: ${n}`,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isTogglingPermission.set("")}})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=E({type:r,selectors:[["app-detailrole"]],decls:17,vars:8,consts:[[1,"flex","flex-row","justify-between","items-center","space-x-2","p-2"],["mat-icon-button","","color","primary",3,"click"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center"],[3,"ngModelChange","ngModel","disabled"],["mat-icon-button","","color","primary",3,"click",4,"ngIf"],["mat-icon-button","","color","warn",3,"click"],[1,"relative","flex","flex-col","w-full","p-4","overflow-auto"],[4,"ngIf"],[1,"flex","flex-col","space-y-4","items-center","justify-center"],[1,"font-bold","text-2xl"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],[1,"w-full","flex","flex-col","space-y-2"],["appearance","outline"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp T\xEAn Nh\xF3m",3,"ngModelChange","ngModel","disabled"],[1,"grid","grid-cols-3","gap-2"],[1,"flex","items-center","space-x-2"],[3,"change","disabled","checked"],["diameter","16",1,"ml-2"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"button",1),u("click",function(){return i.goBack()}),o(2,"mat-icon"),s(3,"arrow_back"),l()(),o(4,"div",2),s(5),l(),o(6,"div",3)(7,"mat-slide-toggle",4),S("ngModelChange",function(m){return w(i.DetailRole.isActive,m)||(i.DetailRole.isActive=m),m}),s(8),l(),C(9,se,3,0,"button",5)(10,ce,3,0,"button",5),o(11,"button",6),u("click",function(){return i.toggleDelete()}),o(12,"mat-icon"),s(13,"delete"),l()()()(),o(14,"div",7),C(15,me,9,0,"ng-container",8)(16,ue,9,2,"ng-container",8),l()),t&2&&(a(5),x((i.DetailRole==null?null:i.DetailRole.name)||"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),a(2),y("ngModel",i.DetailRole.isActive),p("disabled",!i.isEdit()),a(),x(i.DetailRole.isActive?"Hi\u1EC3n Th\u1ECB":"\u1EA8n"),a(),p("ngIf",i.isEdit()),a(),p("ngIf",!i.isEdit()),a(5),p("ngIf",i.isDelete()),a(),p("ngIf",!i.isDelete()))},dependencies:[Q,J,$,Y,U,O,H,G,K,q,j,W,A,N,Z,X,B,F,ne,ie,te,ee],encapsulation:2})};export{ae as DetailRoleComponent};
