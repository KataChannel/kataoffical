import{a as Yt,b as Zt}from"./chunk-5W6JYN2F.js";import"./chunk-S4NZZWBD.js";import{a as Jt}from"./chunk-53IISJN5.js";import"./chunk-QHCPJI62.js";import"./chunk-4ZVJO4SQ.js";import"./chunk-XHVJ7NZ3.js";import"./chunk-NULFSBS2.js";import"./chunk-SR7RCIEL.js";import"./chunk-EQHO5CVZ.js";import{d as Ft}from"./chunk-5NC4P5UG.js";import{a as I}from"./chunk-ZW44ZSN2.js";import"./chunk-P7BBNZNS.js";import{b as ft,c as gt,d as xt}from"./chunk-LECLUHD2.js";import"./chunk-IE4L6KDU.js";import"./chunk-KE6HBPKL.js";import{b as Xt}from"./chunk-F366E334.js";import{a as N,b as Mt,c as Lt}from"./chunk-N2KOTR2C.js";import{c as bt,h as wt}from"./chunk-ILGJOBJG.js";import"./chunk-H7UDLENL.js";import{a as pt}from"./chunk-Q3KOS33T.js";import"./chunk-DP4FJZ2N.js";import{a as Qt,b as Ut,c as qt,k as Gt}from"./chunk-OP3J4F3V.js";import{a as dt,c as _t}from"./chunk-OJMQSPC3.js";import"./chunk-OZW3KHHG.js";import{c as Vt,d as At,e as Bt,g as Pt,h as Nt,j as $t,k as Rt,m as zt,n as Ht,p as Wt,q as jt,r as Kt,s as Ot}from"./chunk-LXFX5R3F.js";import{b as Tt}from"./chunk-KJ3ORMDZ.js";import{b as kt,g as vt,j as yt,n as Dt,p as O,s as St,v as Q,w as Et,y as U,z as It}from"./chunk-M2YCC4SP.js";import"./chunk-KBSHTQVA.js";import{a as K,b as Ct}from"./chunk-PYCEOLIX.js";import"./chunk-NBQTKVUV.js";import"./chunk-FME5K2LE.js";import"./chunk-2PPFUFFT.js";import{a as W,c as j,e as ut}from"./chunk-BAEDUNPT.js";import{_ as mt}from"./chunk-DL37TIRW.js";import"./chunk-5LF7WV5H.js";import{l as st,m as H,t as ct,v as ht}from"./chunk-GKGVKDD5.js";import{$b as Y,Cc as F,Db as q,Dc as h,Ec as z,Fc as g,Gc as at,Hc as rt,Ic as A,Jc as B,Kb as x,Kc as P,Ra as T,Rb as G,Sb as X,Sc as w,Ub as d,Uc as S,Xb as J,bc as Z,cc as tt,dc as et,ec as a,fc as r,gc as M,hc as L,ic as V,kc as y,md as lt,pa as b,pc as f,rb as c,rc as l,xc as it,ya as u,yc as nt,za as p,zc as ot}from"./chunk-OL5DVADB.js";import"./chunk-LWLSKGAV.js";import{a as v,b as D,j as k}from"./chunk-6DYNGEAS.js";var ae=()=>[Q,O,U,K,W,j,ft,gt,st,H];function re(o,e){if(o&1){let t=y();a(0,"button",5),f("click",function(){u(t);let i=l();return p(i.handleChotkhoAction())}),a(1,"mat-icon"),h(2,"save"),r()()}}function le(o,e){if(o&1){let t=y();a(0,"button",5),f("click",function(){u(t);let i=l();return p(i.toggleEdit())}),a(1,"mat-icon"),h(2,"edit"),r()()}}function se(o,e){if(o&1){let t=y();L(0),a(1,"div",11)(2,"div",12),h(3,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),r(),a(4,"div",13)(5,"button",14),f("click",function(){u(t);let i=l();return p(i.DeleteData())}),h(6,"\u0110\u1ED3ng \xDD"),r(),a(7,"button",15),f("click",function(){u(t);let i=l();return p(i.toggleDelete())}),h(8,"Hu\u1EF7 B\u1ECF"),r()()(),V()}}function ce(o,e){if(o&1){let t=y();a(0,"div",18)(1,"h3",19),h(2,"Th\xF4ng tin ch\u1ED1t kho"),r(),a(3,"div",20)(4,"mat-form-field",21)(5,"mat-label"),h(6,"Ti\xEAu \u0110\u1EC1"),r(),a(7,"input",22),P("ngModelChange",function(i){u(t);let s=l(2);return B(s.DetailChotkho().title,i)||(s.DetailChotkho().title=i),p(i)}),r()(),a(8,"mat-form-field",21)(9,"mat-label"),h(10,"Ng\xE0y Ch\u1ED1t"),r(),a(11,"input",23),P("ngModelChange",function(i){u(t);let s=l(2);return B(s.DetailChotkho().ngaychot,i)||(s.DetailChotkho().ngaychot=i),p(i)}),r(),M(12,"mat-datepicker-toggle",24)(13,"mat-datepicker",null,0),r(),a(15,"mat-form-field",25)(16,"mat-label"),h(17,"Ghi Ch\xFA"),r(),a(18,"textarea",26),P("ngModelChange",function(i){u(t);let s=l(2);return B(s.DetailChotkho().ghichu,i)||(s.DetailChotkho().ghichu=i),p(i)}),r()()()()}if(o&2){let t=F(14),n=l(2);c(7),A("ngModel",n.DetailChotkho().title),d("disabled",!n.isEdit()),c(4),d("matDatepicker",t),A("ngModel",n.DetailChotkho().ngaychot),d("disabled",!n.isEdit()),c(),d("for",t),c(6),A("ngModel",n.DetailChotkho().ghichu),d("disabled",!n.isEdit())}}function he(o,e){o&1&&(a(0,"span",63),h(1,"check_box"),r())}function de(o,e){o&1&&(a(0,"span",64),h(1,"check_box_outline_blank"),r())}function _e(o,e){if(o&1){let t=y();a(0,"div",57),f("click",function(){let i=u(t).$implicit,s=l(5);return p(s.ChosenItem(i))}),x(1,he,2,0,"span",58)(2,de,2,0,"span",59),a(3,"div",60)(4,"span",61),h(5),r(),a(6,"span",62),h(7),r()()()}if(o&2){let t=e.$implicit,n=l(5);c(),d("ngIf",n.CheckItem(t)),c(),d("ngIf",!n.CheckItem(t)),c(3),z(t.title||"Ch\u01B0a C\xF3 T\xEAn"),c(2),at("M\xE3: ",t.masp," - \u0110VT: ",t.dvt,"")}}function me(o,e){o&1&&(a(0,"div",65),h(1," Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m kh\u1EA3 d\u1EE5ng "),r())}function ue(o,e){if(o&1){let t=y();a(0,"div",36)(1,"div",37)(2,"button",38,1)(4,"mat-icon"),h(5,"inventory"),r(),h(6),r(),a(7,"mat-menu",null,2)(9,"div",39),f("click",function(i){return u(t),p(i.stopPropagation())}),a(10,"div",40)(11,"div",41),h(12,"T\xECnh tr\u1EA1ng s\u1EA3n ph\u1EA9m:"),r(),a(13,"div",42),h(14),r()(),a(15,"div",43)(16,"input",44,3),f("keyup",function(i){u(t);let s=l(4);return p(s.doFilterSanpham(i))}),r(),a(18,"div",45)(19,"span",46),h(20,"search"),r()()(),a(21,"div",47)(22,"div",7)(23,"span",48),f("click",function(){u(t);let i=l(4);return p(i.ChosenAll(i.filterSanpham))}),h(24),r(),a(25,"span",49),f("click",function(){u(t);let i=l(4);return p(i.EmptyFiter())}),h(26,"Xo\xE1 T\u1EA5t C\u1EA3"),r()(),a(27,"span",50),f("click",function(){u(t);let i=l(4);return p(i.ResetFilter())}),h(28,"L\xE0m M\u1EDBi"),r()(),a(29,"div",51),x(30,_e,8,5,"div",52)(31,me,2,0,"div",53),r(),a(32,"div",54)(33,"button",15),f("click",function(){u(t);let i=F(3);return p(i.closeMenu())}),h(34,"\u0110\xF3ng"),r(),a(35,"button",14),f("click",function(){u(t);let i=F(3),s=l(4);return p(s.ApplyFilterColum(i))}),h(36,"\xC1p D\u1EE5ng"),r()()()(),a(37,"mat-form-field",21)(38,"mat-label"),h(39,"T\xECm Ki\u1EBFm"),r(),a(40,"input",55),f("keyup",function(i){u(t);let s=l(4);return p(s.applyFilter(i))}),r()(),a(41,"button",56),f("click",function(){u(t);let i=l(4);return p(i.EmptyCart())}),a(42,"mat-icon"),h(43,"delete"),r()()()()}if(o&2){let t=F(8),n=l(4);c(2),d("disabled",!n.isEdit())("matMenuTriggerFor",t),c(4),g(" ",n.ListFilter.length," S\u1EA3n Ph\u1EA9m \u0110\xE3 Ch\u1ECDn "),c(8),rt(" \u2022 ",n.ListFilter.length," s\u1EA3n ph\u1EA9m \u0111\xE3 ch\u1ECDn \u2022 ",n.filterSanpham.length," s\u1EA3n ph\u1EA9m kh\u1EA3 d\u1EE5ng \u2022 ",n.ListSanpham.length," t\u1ED5ng s\u1EA3n ph\u1EA9m "),c(10),g("Ch\u1ECDn T\u1EA5t C\u1EA3 (",n.filterSanpham.length," s\u1EA3n ph\u1EA9m kh\u1EA3 d\u1EE5ng)"),c(6),d("ngForOf",n.filterSanpham)("ngForTrackBy",n.trackByFn),c(),d("ngIf",n.filterSanpham.length===0),c(10),d("disabled",!n.isEdit())}}function pe(o,e){o&1&&(a(0,"div",35),x(1,ue,44,11),G(2,1,ae),X(),r())}function Ce(o,e){if(o&1&&(a(0,"th",68)(1,"span",69),h(2),r()()),o&2){let t=l().$implicit,n=l(3);c(2),g(" ",n.ColumnName[t]," ")}}function fe(o,e){if(o&1){let t=y();a(0,"span",71)(1,"span"),h(2),r(),a(3,"button",75),f("click",function(){u(t);let i=l().$implicit,s=l(4);return p(s.RemoveSanpham(i))}),a(4,"mat-icon"),h(5,"delete"),r()()()}if(o&2){let t=l().index,n=l(4);c(2),g("",t+1," "),c(),d("disabled",!n.isEdit())}}function ge(o,e){if(o&1){let t=y();a(0,"div",78),f("blur",function(i){u(t);let s=l(2),m=s.$implicit,_=s.index,C=l(4);return p(C.updateValue(i,_,m,"sltonthucte","number"))})("keydown.enter",function(i){u(t);let s=l(2),m=s.$implicit,_=s.index,C=l(4);return p(C.updateValue(i,_,m,"sltonthucte","number"))}),h(1),w(2,"number"),r()}if(o&2){let t=l(2).$implicit,n=l().$implicit;d("contentEditable",!0),c(),g(" ",S(2,2,t[n]||0,"1.0-3")," ")}}function xe(o,e){if(o&1&&(a(0,"span",74),h(1),w(2,"number"),r()),o&2){let t=l(2).$implicit,n=l().$implicit;c(),g(" ",S(2,1,t[n],"1.0-3")," ")}}function ke(o,e){if(o&1&&x(0,ge,3,5,"div",76)(1,xe,3,4,"span",77),o&2){let t=l(5);d("ngIf",t.isEdit()),c(),d("ngIf",!t.isEdit())}}function ve(o,e){if(o&1){let t=y();a(0,"div",80),f("blur",function(i){u(t);let s=l(2),m=s.$implicit,_=s.index,C=l(4);return p(C.updateValue(i,_,m,"slhuy","number"))})("keydown.enter",function(i){u(t);let s=l(2),m=s.$implicit,_=s.index,C=l(4);return p(C.updateValue(i,_,m,"slhuy","number"))}),h(1),w(2,"number"),r()}if(o&2){let t=l(2).$implicit,n=l().$implicit;d("contentEditable",!0),c(),g(" ",S(2,2,t[n]||0,"1.0-3")," ")}}function ye(o,e){if(o&1&&(a(0,"span",74),h(1),w(2,"number"),r()),o&2){let t=l(2).$implicit,n=l().$implicit;c(),g(" ",S(2,1,t[n],"1.0-3")," ")}}function De(o,e){if(o&1&&x(0,ve,3,5,"div",79)(1,ye,3,4,"span",77),o&2){let t=l(5);d("ngIf",t.isEdit()),c(),d("ngIf",!t.isEdit())}}function be(o,e){if(o&1&&(a(0,"span",74),h(1),w(2,"number"),r()),o&2){let t=l().$implicit,n=l().$implicit;J(t[n]>0?"text-green-600":t[n]<0?"text-red-600":"text-yellow-600"),c(),g(" ",S(2,3,t[n],"1.0-3")," ")}}function we(o,e){if(o&1&&(a(0,"span",73),h(1),r()),o&2){let t=l().$implicit;c(),g(" ",t.title||(t.sanpham==null?null:t.sanpham.title)," ")}}function Se(o,e){if(o&1&&(a(0,"span",73),h(1),r()),o&2){let t=l().$implicit;c(),g(" ",t.masp||(t.sanpham==null?null:t.sanpham.masp)," ")}}function Ee(o,e){if(o&1&&(a(0,"span",73),h(1),r()),o&2){let t=l().$implicit;c(),g(" ",t.dvt||(t.sanpham==null?null:t.sanpham.dvt)," ")}}function Ie(o,e){if(o&1&&(a(0,"span",74),h(1),w(2,"number"),r()),o&2){let t=l().$implicit,n=l().$implicit;c(),g(" ",S(2,1,t[n],"1.0-3")," ")}}function Te(o,e){if(o&1&&(a(0,"span",73),h(1),r()),o&2){let t=l().$implicit,n=l().$implicit;c(),g(" ",t[n]," ")}}function Fe(o,e){if(o&1&&(a(0,"td",70),x(1,fe,6,2,"span",71)(2,ke,2,2)(3,De,2,2)(4,be,3,6,"span",72)(5,we,2,1,"span",73)(6,Se,2,1,"span",73)(7,Ee,2,1,"span",73)(8,Ie,3,4,"span",74)(9,Te,2,1,"span",73),r()),o&2){let t,n=l().$implicit;c(),Y((t=n)==="STT"?1:t==="sltonthucte"?2:t==="slhuy"?3:t==="chenhlech"?4:t==="title"?5:t==="masp"?6:t==="dvt"?7:t==="sltonhethong"?8:9)}}function Me(o,e){if(o&1&&(L(0,31),x(1,Ce,3,1,"th",66)(2,Fe,10,1,"td",67),V()),o&2){let t=e.$implicit;d("matColumnDef",t)}}function Le(o,e){o&1&&M(0,"tr",81)}function Ve(o,e){o&1&&M(0,"tr",82)}function Ae(o,e){o&1&&(a(0,"tr",83)(1,"td",84),h(2,"Kh\xF4ng t\xECm th\u1EA5y d\u1EEF li\u1EC7u"),r()())}function Be(o,e){if(o&1&&(a(0,"div",27),x(1,pe,4,0,"div",28),a(2,"div",29)(3,"table",30),tt(4,Me,3,1,"ng-container",31,Z),x(6,Le,1,0,"tr",32)(7,Ve,1,0,"tr",33)(8,Ae,3,0,"tr",34),r()()()),o&2){let t=l(2);c(),d("ngIf",t.isEdit()),c(2),d("dataSource",t.dataSource()),c(),et(t.displayedColumns),c(2),d("matHeaderRowDef",t.displayedColumns),c(),d("matRowDefColumns",t.displayedColumns)}}function Pe(o,e){if(o&1&&(L(0),x(1,ce,19,8,"div",16)(2,Be,9,4,"div",17),V()),o&2){let t=l();c(),d("ngIf",t.DetailChotkho()),c(),d("ngIf",t.DetailChotkho())}}var te=class o{_ListChotkhoComponent=b(Zt);_ChotkhoService=b(Yt);_SanphamService=b(Jt);_route=b(dt);_router=b(_t);_snackBar=b(pt);_dialog=b(bt);sort;dataSource=T(new Ot([]));displayedColumns=["STT","title","masp","dvt","sltonhethong","sltonthucte","slhuy","chenhlech"];ColumnName={STT:"STT",title:"T\xEAn S\u1EA3n Ph\u1EA9m",masp:"M\xE3 SP",dvt:"\u0110\u01A1n V\u1ECB",sltonhethong:"SL H\u1EC7 Th\u1ED1ng",sltonthucte:"SL Th\u1EF1c T\u1EBF",slhuy:"SL H\u1EE7y",chenhlech:"Ch\xEAnh L\u1EC7ch"};DetailChotkho=T({id:void 0,title:"",ngaychot:new Date,ghichu:"",khoId:"",userId:"",isActive:!0,details:[]});constructor(){this._route.paramMap.subscribe(e=>{let t=e.get("id");this._ChotkhoService.setChotkhoId(t)}),lt(()=>k(this,null,function*(){let e=this._ChotkhoService.DetailChotkho();e&&(this.DetailChotkho.set(e),this.dataSource.update(t=>(t.data=e.details||[],t)),this.ListFilter=e.details||[],this.ListSanpham.length>0&&this.updateAvailableProducts(),console.log("DetailChotkho updated from service:",e))}))}isEdit=T(!1);isDelete=T(!1);chotkhoId=this._ChotkhoService.chotkhoId;ListSanpham=[];filterSanpham=[];ListFilter=[];ngOnInit(){return k(this,null,function*(){let e=this._ChotkhoService.chotkhoId();if(e||(this._router.navigate(["/admin/chotkho"]),this._ListChotkhoComponent.drawer.close()),e==="new"){let t={id:void 0,title:"",ngaychot:new Date,ghichu:"",khoId:"",userId:"",isActive:!0,details:[]};this.DetailChotkho.set(t),this._ChotkhoService.DetailChotkho.set(t),this._ListChotkhoComponent.drawer.open(),this.isEdit.update(n=>!0),this._router.navigate(["/admin/chotkho","new"])}else e&&(yield this._ChotkhoService.getChotkhoById(e),setTimeout(()=>{let t=this._ChotkhoService.DetailChotkho()},1e3),this._ListChotkhoComponent.drawer.open(),this._router.navigate(["/admin/chotkho",e]));yield this.loadSanphamList()})}handleChotkhoAction(){return k(this,null,function*(){this.chotkhoId()==="new"?yield this.createChotkho():yield this.updateChotkho()})}createChotkho(){return k(this,null,function*(){try{let e=this.DetailChotkho();yield this._ChotkhoService.createChotkhoWithDetails(e),this._snackBar.open("T\u1EA1o ch\u1ED1t kho th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(t=>!1)}catch(e){console.error("L\u1ED7i khi t\u1EA1o ch\u1ED1t kho:",e),this._snackBar.open("L\u1ED7i khi t\u1EA1o ch\u1ED1t kho","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}updateChotkho(){return k(this,null,function*(){try{let e=this.DetailChotkho();e?.id&&(yield this._ChotkhoService.updateChotkhoWithDetails(e.id,e),this._snackBar.open("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(t=>!1),setTimeout(()=>{window.location.reload()},100))}catch(e){console.error("L\u1ED7i khi c\u1EADp nh\u1EADt ch\u1ED1t kho:",e),this._snackBar.open("L\u1ED7i khi c\u1EADp nh\u1EADt ch\u1ED1t kho","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}DeleteData(){return k(this,null,function*(){try{let e=this.DetailChotkho();e?.id&&(yield this._ChotkhoService.deleteChotkho(e.id),this._snackBar.open("X\xF3a th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this._router.navigate(["/admin/chotkho"]))}catch(e){console.error("L\u1ED7i khi x\xF3a ch\u1ED1t kho:",e),this._snackBar.open("L\u1ED7i khi x\xF3a ch\u1ED1t kho","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}onQuantityChange(){let e=this.DetailChotkho();if(e){let t=Number(e.sltonhethong)||0,n=Number(e.sltonthucte)||0,i=Number(e.slhuy)||0,s=t-n-i;this.DetailChotkho.update(m=>D(v({},m),{chenhlech:s}))}}detailDisplayedColumns=["sanpham","sltonhethong","sltonthucte","slhuy","chenhlech","actions"];removeDetail(e){let n=(this.DetailChotkho().details||[]).filter(i=>i!==e);this.DetailChotkho.update(i=>D(v({},i),{details:n}))}updateChenhLech(e){let t=Number(e.sltonhethong)||0,n=Number(e.sltonthucte)||0,i=Number(e.slhuy)||0;e.chenhlech=t-n-i}goBack(){this._router.navigate(["/admin/chotkho"]),this._ListChotkhoComponent.drawer.close()}trackByFn(e,t){return t.id||e}toggleEdit(){this.isEdit.update(e=>!e)}toggleDelete(){this.isDelete.update(e=>!e)}FillSlug(){this.DetailChotkho.update(e=>(e.slug=Ft(e.title),e))}loadSanphamList(){return k(this,null,function*(){try{let e=yield this._ChotkhoService.getAllProducts(),t=e.map(n=>({id:n.id,sanphamId:n.id,title:n.title,masp:n.masp,dvt:n.dvt,sltonhethong:n.tonkho?.slton||0,sltonthucte:n.tonkho?.sltinhthucte||0,slhuy:n.tonkho?.slhuy||0,chenhlech:(n.tonkho?.slton||0)-(n.tonkho?.sltinhthucte||0)-(n.tonkho?.slhuy||0),dongia:n.dongia}));this.ListSanpham=t,this.updateAvailableProducts(),console.log("Loaded products:",e),console.log("Loaded ListSanpham:",this.ListSanpham.length),console.log("Current ListFilter:",this.ListFilter.length),console.log("Available products (filterSanpham):",this.filterSanpham.length)}catch(e){console.error("Error loading sanpham list:",e),this._snackBar.open("L\u1ED7i khi t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m","\u0110\xF3ng",{duration:3e3,panelClass:["snackbar-error"]})}})}DoOutFilter(e){return k(this,null,function*(){console.log("C\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m cho ch\u1ED1t kho:",e);try{this.DetailChotkho.update(n=>D(v({},n),{details:e.map(i=>({sanphamId:i.sanphamId||i.id,sanpham:{id:i.sanphamId||i.id,masp:i.masp,title:i.title,dvt:i.dvt,dongia:i.dongia},sltonhethong:Number(i.sltonhethong)||0,sltonthucte:Number(i.sltonthucte)||0,slhuy:Number(i.slhuy)||0,chenhlech:Number(i.chenhlech)||0,ghichu:i.ghichu||"",isActive:!0,title:i.title,masp:i.masp,dvt:i.dvt}))})),this.filterSanpham=this.DetailChotkho().details,this.dataSource.update(n=>(n.data=[...this.DetailChotkho().details],n.sort=this.sort,n));let t=e.map(n=>n.sanphamId||n.id);this.ListSanpham=this.ListSanpham.filter(n=>!t.includes(n.id||n.sanphamId)),console.log("Updated DetailChotkho:",this.DetailChotkho()),console.log("Updated ListSanpham (removed selected):",this.ListSanpham),this._snackBar.open("C\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(t){console.error("L\u1ED7i c\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m:",t),this._snackBar.open("L\u1ED7i c\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}EmptyCart(){let e=this.DetailChotkho().details||[];this.DetailChotkho.update(t=>D(v({},t),{details:[]})),this.dataSource.update(t=>(t.data=[],t)),e.forEach(t=>{let n={id:t.sanphamId||t.id,sanphamId:t.sanphamId||t.id,title:t.title||t.sanpham?.title,masp:t.masp||t.sanpham?.masp,dvt:t.dvt||t.sanpham?.dvt,sltonhethong:t.sltonhethong||0,sltonthucte:t.sltonthucte||0,slhuy:t.slhuy||0,chenhlech:t.chenhlech||0,dongia:t.dongia||t.sanpham?.dongia||0};this.ListSanpham.some(s=>s.id===n.id||s.sanphamId===n.id)||this.ListSanpham.push(n)}),console.log("Restored products to ListSanpham:",this.ListSanpham),this._snackBar.open("\u0110\xE3 x\xF3a t\u1EA5t c\u1EA3 s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}RemoveSanpham(e){let n=(this.DetailChotkho().details||[]).filter(_=>_.id!==e.id&&_.sanphamId!==e.sanphamId);this.DetailChotkho.update(_=>D(v({},_),{details:n})),this.dataSource.update(_=>(_.data=[...n],_));let i=e.sanphamId||e.id,s={id:i,sanphamId:i,title:e.title||e.sanpham?.title,masp:e.masp||e.sanpham?.masp,dvt:e.dvt||e.sanpham?.dvt,sltonhethong:e.sltonhethong||0,sltonthucte:e.sltonthucte||0,slhuy:e.slhuy||0,chenhlech:e.chenhlech||0,dongia:e.dongia||e.sanpham?.dongia||0};this.ListSanpham.some(_=>_.id===i||_.sanphamId===i)||(this.ListSanpham.push(s),console.log("Added product back to ListSanpham:",s)),this._snackBar.open("\u0110\xE3 x\xF3a s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}updateValue(e,t,n,i,s){e.preventDefault(),e.stopPropagation();let m=e.target.innerText.trim();if(s==="number"){let C=m.replace(/,/g,"").replace(/[^0-9.-]/g,"");m=Number(C)||0}console.log(`Updating ${i} with value:`,m),this.DetailChotkho.update(C=>{let $=(C.details||[]).map((R,ee)=>{if(ee===t||R.sanphamId===n.sanphamId){let E=v({},R);if(E[i]=m,i==="sltonthucte"||i==="slhuy"){let ie=Number(E.sltonhethong)||0,ne=Number(E.sltonthucte)||0,oe=Number(E.slhuy)||0;E.chenhlech=ie-ne-oe}return E}return R});return D(v({},C),{details:$})});let _=this.DetailChotkho().details||[];this.dataSource.update(C=>(C.data=[..._],C)),console.log("Updated DetailChotkho:",this.DetailChotkho())}doFilterSanpham(e){return k(this,null,function*(){let t=e.target.value.trim().toLowerCase();if(t.length<2){this.filterSanpham=this.ListSanpham.filter(i=>!this.ListFilter.find(s=>s.id===i.id||s.sanphamId===i.id));return}let n=I(t);this.filterSanpham=this.ListSanpham.filter(i=>{if(this.ListFilter.find(C=>C.id===i.id||C.sanphamId===i.id))return!1;let m=I(i.title?.toLowerCase()||""),_=I(i.masp?.toLowerCase()||"");return m.includes(n)||_.includes(n)||i.title?.toLowerCase().includes(t)||i.masp?.toLowerCase().includes(t)}).sort((i,s)=>{let m=i.masp?.toLowerCase()===t||i.title?.toLowerCase()===t,_=s.masp?.toLowerCase()===t||s.title?.toLowerCase()===t;if(m&&!_)return-1;if(!m&&_)return 1;let C=I(i.title||"").toLowerCase(),$=I(s.title||"").toLowerCase();return C.localeCompare($)}),e.key==="Enter"&&this.filterSanpham.length>0&&(this.ChosenItem(this.filterSanpham[0]),e.target.value="",this.updateAvailableProducts())})}ChosenItem(e){let t=this.filterSanpham.find(i=>i.id===e.id);if(this.ListFilter.find(i=>i.id===e.id||i.sanphamId===e.id))this.ListFilter=this.ListFilter.filter(i=>i.id!==e.id&&i.sanphamId!==e.id),console.log(`Removed product: ${e.title}`);else if(t){let i=D(v({},t),{sanphamId:t.id,sltonhethong:t.sltonhethong||0,sltonthucte:t.sltonthucte||0,slhuy:t.slhuy||0,chenhlech:t.chenhlech||0,order:this.ListFilter.length+1});this.ListFilter.findIndex(m=>m.id===e.id||m.sanphamId===e.id)===-1&&(this.ListFilter.push(i),console.log(`Added product: ${e.title}`))}}ChosenAll(e){return k(this,null,function*(){let n=e.filter(i=>!this.ListFilter.find(s=>s.id===i.id||s.sanphamId===i.id)).map((i,s)=>D(v({},i),{sanphamId:i.id,sltonhethong:i.sltonhethong||0,sltonthucte:i.sltonthucte||0,slhuy:i.slhuy||0,chenhlech:i.chenhlech||0,order:this.ListFilter.length+s+1}));this.ListFilter=[...this.ListFilter,...n],console.log(`Added ${n.length} unique products. Total: ${this.ListFilter.length} products`)})}ResetFilter(){this.filterSanpham=this.ListSanpham.filter(e=>!this.ListFilter.find(t=>t.id===e.id)),console.log(`Reset filter. Showing ${this.filterSanpham.length} available products`)}EmptyFiter(){this.ListFilter=[],this.updateAvailableProducts(),console.log("Cleared all selected products")}updateAvailableProducts(){this.filterSanpham=this.ListSanpham.filter(e=>!this.ListFilter.find(t=>t.id===e.id||t.sanphamId===e.id)),console.log("Updated available products:",this.filterSanpham.length,"out of",this.ListSanpham.length)}CheckItem(e){return!!this.ListFilter.find(t=>t.id===e.id||t.sanphamId===e.id)}ApplyFilterColum(e){this.DetailChotkho.update(t=>(t.details=[...this.ListFilter],t)),this.dataSource.update(t=>(t.data=[...this.ListFilter],t)),e.closeMenu(),console.log("Applied filter. Selected products:",this.ListFilter.length)}applyFilter(e){let t=e.target.value;this.dataSource().filter=t.trim().toLowerCase()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=q({type:o,selectors:[["app-detailchotkho"]],viewQuery:function(t,n){if(t&1&&it(N,5),t&2){let i;nt(i=ot())&&(n.sort=i.first)}},decls:12,vars:5,consts:[["picker",""],["menuTrigger","matMenuTrigger"],["menu","matMenu"],["searchInput",""],[1,"flex","flex-row","justify-between","items-center","space-x-2","p-2"],["mat-icon-button","","color","primary",3,"click"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center"],["mat-icon-button","","color","primary",3,"click",4,"ngIf"],[1,"relative","flex","flex-col","w-full","p-4","overflow-auto"],[4,"ngIf"],[1,"flex","flex-col","space-y-4","items-center","justify-center"],[1,"font-bold","text-2xl"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],["class","p-4 rounded-lg mb-4",4,"ngIf"],["class","bg-white p-4 rounded-lg border",4,"ngIf"],[1,"p-4","rounded-lg","mb-4"],[1,"text-lg","font-semibold","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp ti\xEAu \u0111\u1EC1",3,"ngModelChange","ngModel","disabled"],["matInput","","placeholder","Ch\u1ECDn ng\xE0y ch\u1ED1t",3,"ngModelChange","matDatepicker","ngModel","disabled"],["matSuffix","",3,"for"],["appearance","outline","subscriptSizing","dynamic",1,"md:col-span-2"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp ghi ch\xFA","rows","2",3,"ngModelChange","ngModel","disabled"],[1,"bg-white","p-4","rounded-lg","border"],["class","w-full flex flex-col overflow-y-auto mb-4",4,"ngIf"],[1,"w-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[1,"w-full","flex","flex-col","overflow-y-auto","mb-4"],[1,"cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","p-2","bg-white","rounded-lg"],[1,"w-full","flex","flex-row","space-x-2","items-center"],["mat-flat-button","","color","primary",3,"disabled","matMenuTriggerFor"],[1,"cursor-pointer","flex","flex-col","space-y-4","p-3",3,"click"],[1,"bg-blue-50","p-2","rounded-lg"],[1,"text-sm","font-medium","text-blue-800"],[1,"text-xs","text-blue-600"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[1,"flex","flex-row","space-x-2","items-center","justify-between"],[1,"text-xs","text-blue-600","underline",3,"click"],[1,"text-xs","text-red-600","underline",3,"click"],[1,"text-xs","text-green-600","underline",3,"click"],[1,"w-full","flex","flex-col","space-y-2","max-h-44","overflow-auto"],["class","flex flex-row space-x-2 items-center p-2 rounded-lg hover:bg-slate-100 cursor-pointer",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],["class","text-center text-gray-500 p-4",4,"ngIf"],[1,"flex","flex-row","space-x-2","items-end","justify-end"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"keyup"],["matTooltip","L\xE0m Tr\u1ED1ng Gi\u1ECF H\xE0ng","color","warn","mat-icon-button","",3,"click","disabled"],[1,"flex","flex-row","space-x-2","items-center","p-2","rounded-lg","hover:bg-slate-100","cursor-pointer",3,"click"],["class","material-symbols-outlined text-green-600",4,"ngIf"],["class","material-symbols-outlined text-gray-400",4,"ngIf"],[1,"flex","flex-col","flex-1"],[1,"font-medium"],[1,"text-xs","text-gray-500"],[1,"material-symbols-outlined","text-green-600"],[1,"material-symbols-outlined","text-gray-400"],[1,"text-center","text-gray-500","p-4"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"line-clamp-4","me-4"],["mat-cell",""],[1,"max-w-20","line-clamp-4","flex","flex-row","items-center"],[1,"max-w-20","line-clamp-4",3,"class"],[1,"max-w-40","line-clamp-4"],[1,"max-w-20","line-clamp-4"],["mat-icon-button","","color","warn",3,"click","disabled"],["class","sltonthucte-input p-2 min-w-28 bg-slate-200 focus:border rounded-lg focus:border-blue-600 focus:bg-slate-100 focus:outline-none cursor-text",3,"contentEditable","blur","keydown.enter",4,"ngIf"],["class","max-w-20 line-clamp-4",4,"ngIf"],[1,"sltonthucte-input","p-2","min-w-28","bg-slate-200","focus:border","rounded-lg","focus:border-blue-600","focus:bg-slate-100","focus:outline-none","cursor-text",3,"blur","keydown.enter","contentEditable"],["class","slhuy-input p-2 min-w-28 bg-slate-200 focus:border rounded-lg focus:border-blue-600 focus:bg-slate-100 focus:outline-none cursor-text",3,"contentEditable","blur","keydown.enter",4,"ngIf"],[1,"slhuy-input","p-2","min-w-28","bg-slate-200","focus:border","rounded-lg","focus:border-blue-600","focus:bg-slate-100","focus:outline-none","cursor-text",3,"blur","keydown.enter","contentEditable"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","8",1,"mat-cell","p-4"]],template:function(t,n){if(t&1&&(a(0,"div",4)(1,"button",5),f("click",function(){return n.goBack()}),a(2,"mat-icon"),h(3,"arrow_back"),r()(),a(4,"div",6),h(5),r(),a(6,"div",7),x(7,re,3,0,"button",8)(8,le,3,0,"button",8),r()(),a(9,"div",9),x(10,se,9,0,"ng-container",10)(11,Pe,3,2,"ng-container",10),r()),t&2){let i;c(5),z(((i=n.DetailChotkho())==null?null:i.codeId)||"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),c(2),d("ngIf",n.isEdit()),c(),d("ngIf",!n.isEdit()),c(2),d("ngIf",n.isDelete()),c(),d("ngIf",!n.isDelete())}},dependencies:[Et,Q,O,St,It,U,Dt,kt,vt,yt,Ct,K,ut,W,j,Tt,wt,Gt,Qt,Ut,qt,mt,Kt,Vt,Bt,Rt,Pt,At,zt,Nt,$t,Ht,Wt,jt,Lt,N,Mt,xt,ht,H,ct,Xt],encapsulation:2})};export{te as DetailChotkhoComponent};
