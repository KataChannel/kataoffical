import{a as Zt}from"./chunk-WY75HJKE.js";import{a as te}from"./chunk-7DKDHTHX.js";import{a as ie}from"./chunk-HH4LXIZC.js";import{a as O}from"./chunk-DFEBKCCY.js";import{a as ee}from"./chunk-4O4C4XYF.js";import{a as ae}from"./chunk-HYJYWSS7.js";import{b as Ut,g as Wt,h as Q}from"./chunk-ESCBPH3J.js";import{a as Xt}from"./chunk-BURIN2CY.js";import{a as $,b as Vt,c as q,d as At,e as Pt}from"./chunk-DCFSAVWL.js";import{a as Dt}from"./chunk-ZW44ZSN2.js";import{a as dt,b as _t,c as ft}from"./chunk-AQE4NBKO.js";import{a as Ct,b as bt,c as St,d as wt}from"./chunk-6KT4XQ7E.js";import{a as oe}from"./chunk-YGTKRZ2Q.js";import{a as It,b as Gt,c as $t,d as qt,e as Ot,g as Ht,h as Nt,j as Rt,k as Kt,m as zt,n as jt,p as Yt,q as Qt,r as Jt,s as Y}from"./chunk-4GW65WCG.js";import{b as Et}from"./chunk-IZCFLW2T.js";import{n as vt,p as kt,r as Bt,v as Mt,w as Ft,y as Lt,z as Tt}from"./chunk-OAFA7HHQ.js";import{a as xt,b as yt}from"./chunk-UOMYPXRQ.js";import{a as ut,b as ht}from"./chunk-NX6TSR5R.js";import{a as mt,c as pt,e as gt}from"./chunk-MJAN2OV6.js";import{y as lt,z as ct}from"./chunk-FYUVDT4C.js";import{b as st,c as P}from"./chunk-VF6Z3BLE.js";import{l as at,m as nt,r as rt,v as ot}from"./chunk-CNCZQRZQ.js";import{$b as I,Cc as M,Db as W,Dc as c,Ec as S,Fc as f,Kb as C,Nc as it,Ra as D,Sc as w,Ub as x,Uc as v,Yb as X,bc as Z,cc as z,dc as j,ec as o,fc as l,gc as T,hc as tt,ic as et,ja as U,kc as b,oa as K,pa as _,pc as d,rb as m,rc as s,xc as G,ya as g,yc as V,za as u,zc as A}from"./chunk-TAKLKH4V.js";import{a as B,b as L,g as re,h as R,j as h}from"./chunk-WJTR2IJE.js";var E=re(oe());var H=class r{constructor(e,t){this._StorageService=e;this.router=t}_GraphqlService=_(O);ListBanggia=D([]);DetailBanggia=D({});banggiaId=D(null);setBanggiaId(e){this.banggiaId.set(e)}CreateBanggia(e){return h(this,null,function*(){try{let t={title:e.title,mabanggia:e.mabanggia||this.generateMaBanggia(),type:e.type||"bansi",batdau:e.batdau?new Date(e.batdau).toISOString():new Date().toISOString(),ketthuc:e.ketthuc?new Date(e.ketthuc).toISOString():new Date(Date.now()+2592e6).toISOString(),order:e.order||1,ghichu:e.ghichu||"",status:e.status||"baogia",isActive:e.isActive!==!1,isDefault:e.isDefault||!1,sanpham:e.sanpham?{create:e.sanpham.map(n=>({sanphamId:n.sanphamId||n.id,giaban:Number(n.giaban)||0,order:n.order||1,isActive:n.isActive!==!1}))}:void 0,khachhang:e.khachhang?{connect:e.khachhang.map(n=>({id:n.id||n}))}:void 0},i={sanpham:{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0}}}},khachhang:{select:{id:!0,name:!0,makh:!0}}},a=yield this._GraphqlService.createOne("banggia",t,{include:i});return this.banggiaId.set(a.id),this.DetailBanggia.set(a),yield this.getAllBanggia(),a}catch(t){throw console.error("L\u1ED7i t\u1EA1o b\u1EA3ng gi\xE1:",t),t}})}updateBanggia(e){return h(this,null,function*(){try{let t={title:e.title,mabanggia:e.mabanggia,type:e.type,batdau:e.batdau?new Date(e.batdau).toISOString():void 0,ketthuc:e.ketthuc?new Date(e.ketthuc).toISOString():void 0,order:e.order,ghichu:e.ghichu,status:e.status,isActive:e.isActive,isDefault:e.isDefault,sanpham:e.sanpham?{deleteMany:{},create:e.sanpham.map(n=>({sanphamId:n.sanphamId||n.id,giaban:Number(n.giaban)||0,order:n.order||1,isActive:n.isActive!==!1}))}:void 0,khachhang:e.khachhang?{set:e.khachhang.map(n=>({id:n.id||n}))}:void 0};Object.keys(t).forEach(n=>{t[n]===void 0&&delete t[n]});let i={sanpham:{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0}}}},khachhang:{select:{id:!0,name:!0,makh:!0,diachi:!0,sdt:!0,email:!0}}},a=yield this._GraphqlService.updateOne("banggia",{id:e.id},t,{include:i});return this.DetailBanggia.set(a),yield this.getAllBanggia(),a}catch(t){throw console.error("L\u1ED7i c\u1EADp nh\u1EADt b\u1EA3ng gi\xE1:",t),t}})}getAllBanggia(){return h(this,null,function*(){try{let e={where:{},orderBy:{order:"asc"},include:{sanpham:{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0}}}},khachhang:{select:{id:!0,name:!0,makh:!0}},_count:{select:{sanpham:!0,khachhang:!0}}}},t=yield this._GraphqlService.findMany("banggia",e);return this.ListBanggia.set(t),t}catch(e){throw console.error("L\u1ED7i l\u1EA5y danh s\xE1ch b\u1EA3ng gi\xE1:",e),e}})}getBanggiaByid(e){return h(this,null,function*(){try{let t={include:{sanpham:{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0,giagoc:!0}}},orderBy:{order:"asc"},take:99999},khachhang:{select:{id:!0,name:!0,makh:!0,diachi:!0,sdt:!0,email:!0,loaikh:!0,isActive:!0},take:99999}}},i=yield this._GraphqlService.findUnique("banggia",{id:e},t),a=this.transformDetailBanggia(i);return console.log(a),this.DetailBanggia.set(a),i}catch(t){throw console.error("L\u1ED7i l\u1EA5y chi ti\u1EBFt b\u1EA3ng gi\xE1:",t),t}})}transformDetailBanggia(e){console.log(e);let t=e.sanpham?.map(i=>L(B({},i),{giaban:Number(i.giaban)||0,title:i.sanpham.title,masp:i.sanpham.masp,dvt:i.sanpham.dvt}))||[];return L(B({},e),{sanpham:t})}DeleteBanggia(e){return h(this,null,function*(){try{yield this._GraphqlService.deleteOne("banggia",{id:e.id}),yield this.getAllBanggia()}catch(t){throw console.error("L\u1ED7i x\xF3a b\u1EA3ng gi\xE1:",t),t}})}addKHtoBG(e){return h(this,null,function*(){try{let t={khachhang:{connect:e.khachhangIds.map(i=>({id:i}))}};yield this._GraphqlService.updateOne("banggia",{id:e.banggiaId},t),yield this.getBanggiaByid(e.banggiaId)}catch(t){throw console.error("L\u1ED7i th\xEAm kh\xE1ch h\xE0ng v\xE0o b\u1EA3ng gi\xE1:",t),t}})}removeKHfromBG(e){return h(this,null,function*(){try{let t={khachhang:{disconnect:e.khachhangIds.map(i=>({id:i}))}};yield this._GraphqlService.updateOne("banggia",{id:e.banggiaId},t),yield this.getBanggiaByid(e.banggiaId)}catch(t){throw console.error("L\u1ED7i x\xF3a kh\xE1ch h\xE0ng kh\u1ECFi b\u1EA3ng gi\xE1:",t),t}})}getAllBGSP(){return h(this,null,function*(){try{let e={include:{banggia:{select:{id:!0,title:!0,mabanggia:!0,status:!0}},sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0}}},orderBy:{order:"asc"}};return yield this._GraphqlService.findMany("banggiasanpham",e)}catch(e){throw console.error("L\u1ED7i l\u1EA5y b\u1EA3ng gi\xE1 s\u1EA3n ph\u1EA9m:",e),e}})}getAllBGKH(){return h(this,null,function*(){try{let e={where:{banggiaId:{not:null}},include:{banggia:{select:{id:!0,title:!0,mabanggia:!0,status:!0}}},orderBy:{name:"asc"}};return yield this._GraphqlService.findMany("khachhang",e)}catch(e){throw console.error("L\u1ED7i l\u1EA5y kh\xE1ch h\xE0ng theo b\u1EA3ng gi\xE1:",e),e}})}ImportBanggia(e){return h(this,null,function*(){try{let i=[];for(let a=0;a<e.length;a+=10)i.push(e.slice(a,a+10));for(let a of i){let n=a.map(p=>this._GraphqlService.createOne("banggia",{title:p.title,mabanggia:p.mabanggia||this.generateMaBanggia(),type:p.type||"bansi",status:p.status||"baogia",isActive:p.isActive!==!1}));yield Promise.all(n)}yield this.getAllBanggia()}catch(t){throw console.error("L\u1ED7i import b\u1EA3ng gi\xE1:",t),t}})}importSPBG(e){return h(this,null,function*(){try{let i=[];for(let a=0;a<e.length;a+=10)i.push(e.slice(a,a+10));for(let a of i){let n=a.map(p=>this._GraphqlService.createOne("banggiasanpham",{banggiaId:p.banggiaId,sanphamId:p.sanphamId,giaban:Number(p.giaban)||0,order:p.order||1,isActive:p.isActive!==!1}));yield Promise.all(n)}yield this.getAllBanggia()}catch(t){throw console.error("L\u1ED7i import s\u1EA3n ph\u1EA9m b\u1EA3ng gi\xE1:",t),t}})}importBGKH(e){return h(this,null,function*(){try{let t=e.map(i=>this._GraphqlService.updateOne("khachhang",{id:i.khachhangId},{banggiaId:i.banggiaId}));yield Promise.all(t),yield this.getAllBanggia()}catch(t){throw console.error("L\u1ED7i import b\u1EA3ng gi\xE1 kh\xE1ch h\xE0ng:",t),t}})}generateMaBanggia(){let e=new Date,t=e.getFullYear().toString().slice(-2),i=(e.getMonth()+1).toString().padStart(2,"0"),a=e.getDate().toString().padStart(2,"0"),n=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`BG${t}${i}${a}${n}`}handleError(e){let t="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(e){case 401:t="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:t="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:t="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}let i=JSON.stringify({code:e,title:t});this.router.navigate(["/errorserver"],{queryParams:{data:i}})}static \u0275fac=function(t){return new(t||r)(K(ht),K(P))};static \u0275prov=U({token:r,factory:r.\u0275fac,providedIn:"root"})};var le=["drawer"],ce=r=>[100,r],me=(r,e)=>e.key;function pe(r,e){if(r&1){let t=b();o(0,"button",32),d("click",function(a){let n=g(t).$implicit;return s(2).toggleColumn(n),u(a.stopPropagation())}),o(1,"mat-icon"),c(2),l(),o(3,"span"),c(4),l()()}if(r&2){let t=e.$implicit;m(2),S(t.isShow?"check_box":"check_box_outline_blank"),m(2),S(t.value)}}function ge(r,e){if(r&1){let t=b();o(0,"div",16)(1,"div",17)(2,"button",18),d("click",function(){g(t);let a=s();return u(a.create())}),o(3,"mat-icon"),c(4,"add_circle"),l(),o(5,"span",19),c(6,"T\u1EA1o M\u1EDBi"),l()(),o(7,"button",20)(8,"mat-icon"),c(9,"tune"),l()(),o(10,"mat-menu",null,1)(12,"div",21)(13,"mat-form-field",22)(14,"input",23),d("input",function(a){g(t);let n=s();return u(n.doFilterColumns(a))})("click",function(a){return g(t),u(a.stopPropagation())}),l(),o(15,"mat-icon",24),c(16,"search"),l()()(),o(17,"div",25),z(18,pe,5,2,"button",26,me),l()(),o(20,"button",27),d("click",function(){g(t);let a=s();return u(a.isSearch=!a.isSearch)}),o(21,"mat-icon"),c(22,"search"),l()(),o(23,"button",28),d("click",function(){g(t);let a=s();return u(a.ExportExcel(a.dataSource.data,"Banggia"))}),o(24,"mat-icon"),c(25,"file_download"),l()(),o(26,"button",29),d("click",function(){g(t);let a=M(30);return u(a.click())}),o(27,"mat-icon"),c(28,"file_upload"),l()(),o(29,"input",30,2),d("change",function(a){g(t);let n=s();return u(n.ImportExcel(a))}),l(),o(31,"span",31),c(32),l()()()}if(r&2){let t=M(11),i=s();m(7),x("matMenuTriggerFor",t),m(11),j(i.FilterColumns),m(14),f(" ",i.CountItem," B\u1EA3ng Gi\xE1 ")}}function ue(r,e){if(r&1){let t=b();o(0,"div",33)(1,"mat-form-field",22)(2,"mat-label"),c(3,"T\xECm Ki\u1EBFm"),l(),o(4,"input",34),d("keyup",function(a){g(t);let n=s();return u(n.applyFilter(a))}),l()(),o(5,"button",35),d("click",function(){g(t);let a=s();return u(a.isSearch=!a.isSearch)}),o(6,"mat-icon"),c(7,"cancel"),l()()()}}function he(r,e){r&1&&(o(0,"span",55),c(1,"check"),l())}function de(r,e){if(r&1&&(o(0,"span"),c(1),w(2,"date"),l()),r&2){let t=s().$implicit,i=s(2).$implicit;m(),S(v(2,1,t[i],"dd/MM/yyyy"))}}function _e(r,e){if(r&1&&(o(0,"span"),c(1),w(2,"date"),l()),r&2){let t=s().$implicit,i=s(2).$implicit;m(),S(v(2,1,t[i],"dd/MM/yyyy"))}}function fe(r,e){if(r&1&&(o(0,"span"),c(1),l()),r&2){let t=s().$implicit,i=s(2).$implicit;m(),f("",t[i],"%")}}function xe(r,e){if(r&1&&(o(0,"span"),c(1),l()),r&2){let t=s().$implicit,i=s(2).$implicit;m(),f(" ",t[i]||"Tr\u1ED1ng","")}}function ye(r,e){if(r&1){let t=b();o(0,"div",53),d("click",function(){let a=g(t).$implicit,n=s(2).$implicit,p=s();return u(p.ChosenItem(a,n))}),C(1,he,2,0,"span",54)(2,de,3,4,"span")(3,_e,3,4,"span")(4,fe,2,1,"span")(5,xe,2,1,"span"),l()}if(r&2){let t,i=e.$implicit,a=s(2).$implicit,n=s();m(),x("ngIf",n.CheckItem(i)),m(),I((t=a)==="createdAt"?2:t==="updatedAt"?3:t==="haohut"?4:5)}}function Ce(r,e){if(r&1){let t=b();o(0,"th",38)(1,"span",39),c(2),l(),o(3,"span",40,3),c(5," filter_alt "),l(),o(6,"mat-menu",null,1)(8,"div",41),d("click",function(a){return g(t),u(a.stopPropagation())}),o(9,"div",42)(10,"input",43),d("keyup",function(a){g(t);let n=s().$implicit,p=s();return u(p.doFilterHederColumn(a,n))}),l(),o(11,"div",44)(12,"span",45),c(13,"search"),l()()(),o(14,"div",46)(15,"div",17)(16,"span",47),d("click",function(){g(t);let a=s().$implicit,n=s();return u(n.ChosenAll(n.FilterHederColumn(n.dataSource.filteredData,a)))}),c(17),l(),o(18,"span",47),d("click",function(){g(t);let a=s(2);return u(a.EmptyFiter())}),c(19,"Xo\xE1"),l()(),o(20,"span",47),d("click",function(){g(t);let a=s(2);return u(a.ResetFilter())}),c(21,"Reset"),l()(),o(22,"div",48),C(23,ye,6,2,"div",49),l(),o(24,"div",50)(25,"button",51),d("click",function(){g(t);let a=M(4);return u(a.closeMenu())}),c(26,"\u0110\xF3ng"),l(),o(27,"button",52),d("click",function(){g(t);let a=M(4),n=s(2);return u(n.ApplyFilterColum(a))}),c(28,"\xC1p D\u1EE5ng"),l()()()()()}if(r&2){let t=M(7),i=s().$implicit,a=s();m(2),f(" ",a.ColumnName[i]," "),m(),x("matMenuTriggerFor",t),m(14),f("Ch\u1ECDn T\u1EA5t C\u1EA3 ",a.FilterHederColumn(a.dataSource.filteredData,i).length||0,""),m(6),x("ngForOf",a.FilterHederColumn(a.dataSource.filteredData,i))("ngForTrackBy",a.trackByFn)}}function be(r,e){if(r&1&&(o(0,"span",57),c(1),l()),r&2){let t=s().index;m(),f(" ",t+1," ")}}function Se(r,e){if(r&1){let t=b();o(0,"span",58)(1,"mat-icon",61),d("click",function(){g(t);let a=s().$implicit,n=s(2);return u(n.Banggiamacdinh(a))}),c(2,"bookmark"),l(),o(3,"span"),c(4),l()()}if(r&2){let t=s().$implicit,i=s().$implicit;m(),X("!z-10 ",t.isDefault?"!text-blue-600":"text-gray-600",""),m(3),S(t[i])}}function we(r,e){if(r&1){let t=b();o(0,"span",59)(1,"span",61),d("click",function(){g(t);let a=s().$implicit,n=s(2);return u(n.goToDetail(a))}),c(2),l()()}if(r&2){let t=s().$implicit,i=s().$implicit;m(2),S(t[i])}}function ve(r,e){if(r&1&&(o(0,"span",57),c(1),l()),r&2){let t=s().$implicit,i=s().$implicit;m(),f(" ",t[i]," ")}}function ke(r,e){if(r&1&&(o(0,"span",57),c(1),l()),r&2){let t,i=s().$implicit,a=s().$implicit,n=s();m(),f(" ",(t=n.getName(n.ListStatus,"value",i[a]))==null?null:t.title," ")}}function Be(r,e){if(r&1&&(o(0,"span",57),c(1),w(2,"date"),l()),r&2){let t=s().$implicit,i=s().$implicit;m(),f(" ",v(2,1,t[i],"dd/MM/yyyy")," ")}}function Me(r,e){if(r&1&&(o(0,"span",57),c(1),w(2,"date"),l()),r&2){let t=s().$implicit,i=s().$implicit;m(),f(" ",v(2,1,t[i],"dd/MM/yyyy")," ")}}function Fe(r,e){if(r&1&&(o(0,"span",60),c(1),w(2,"date"),l()),r&2){let t=s().$implicit,i=s().$implicit;m(),f(" ",v(2,1,t[i],"HH:mm:ss dd/MM/yyyy")," ")}}function Le(r,e){r&1&&(o(0,"mat-icon",62),c(1,"check_circle"),l())}function Te(r,e){r&1&&(o(0,"mat-icon",63),c(1,"cancel"),l())}function Ee(r,e){if(r&1&&(o(0,"span",57),C(1,Le,2,0,"mat-icon",62)(2,Te,2,0,"mat-icon",63),l()),r&2){let t=s().$implicit,i=s().$implicit;m(),I(t[i]?1:2)}}function De(r,e){if(r&1&&(o(0,"span",60),c(1),w(2,"date"),l()),r&2){let t=s().$implicit,i=s().$implicit;m(),f(" ",v(2,1,t[i],"HH:mm:ss dd/MM/yyyy")," ")}}function Ie(r,e){if(r&1&&(o(0,"span",57),c(1),l()),r&2){let t=s().$implicit,i=s().$implicit;m(),f(" ",t[i]," ")}}function Ge(r,e){if(r&1&&(o(0,"td",56),C(1,be,2,1,"span",57)(2,Se,5,4,"span",58)(3,we,3,1,"span",59)(4,ve,2,1,"span",57)(5,ke,2,1,"span",57)(6,Be,3,4,"span",57)(7,Me,3,4,"span",57)(8,Fe,3,4,"span",60)(9,Ee,3,1,"span",57)(10,De,3,4,"span",60)(11,Ie,2,1,"span",57),l()),r&2){let t,i=s().$implicit;m(),I((t=i)==="STT"?1:t==="mabanggia"?2:t==="title"?3:t==="sanpham"?4:t==="status"?5:t==="batdau"?6:t==="ketthuc"?7:t==="createdAt"?8:t==="isActive"?9:t==="updatedAt"?10:11)}}function Ve(r,e){if(r&1&&(tt(0,11),C(1,Ce,29,5,"th",36)(2,Ge,12,1,"td",37),et()),r&2){let t=e.$implicit;x("matColumnDef",t)}}function Ae(r,e){r&1&&T(0,"tr",64)}function Pe(r,e){r&1&&T(0,"tr",65)}function $e(r,e){r&1&&(o(0,"tr",66)(1,"td",67),c(2,"Kh\xF4ng t\xECm th\u1EA5y"),l()())}var F=class F{Detail={};displayedColumns=["mabanggia","title","type","sanpham","khachhang","batdau","ketthuc","status","createdAt"];ColumnName={mabanggia:"M\xE3 B\u1EA3ng Gi\xE1",title:"Ti\xEAu \u0110\u1EC1",type:"Lo\u1EA1i",sanpham:"S\u1EA3n Ph\u1EA9m",khachhang:"Kh\xE1ch H\xE0ng",batdau:"B\u1EAFt \u0110\u1EA7u",ketthuc:"K\u1EBFt Th\xFAc",status:"T\xECnh Tr\u1EA1ng",createdAt:"Ng\xE0y T\u1EA1o"};FilterColumns=JSON.parse(localStorage.getItem("BanggiaColFilter")||"[]");Columns=[];paginator;sort;drawer;filterValues={};_BanggiaGraphqlService=_(H);_SanphamService=_(ae);_KhachhangService=_(ee);_NhacungcapService=_(ie);_DonhangService=_(te);_DathangService=_(Zt);_GraphqlService=_(O);_breakpointObserver=_(lt);_GoogleSheetService=_(Xt);_router=_(P);dataSource=new Y([]);_snackBar=_(ut);CountItem=0;isSearch=!1;constructor(){this.displayedColumns.forEach(e=>{this.filterValues[e]=""})}applyFilter(e){let t=e.target.value;this.dataSource.filter=t.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}ngOnInit(){return h(this,null,function*(){try{let t=(yield this._GraphqlService.findMany("banggia",{include:{khachhang:{select:{id:!0,name:!0}},sanpham:{select:{id:!0,sanphamId:!0}}},take:99999,orderBy:{createdAt:"desc"}})).map(i=>L(B({},i),{sanpham:i.sanpham.length,khachhang:i.khachhang.length}));this.CountItem=t.length,this.dataSource=new Y(t),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.initializeColumns(),this.setupDrawer(),this.paginator._intl.itemsPerPageLabel="S\u1ED1 l\u01B0\u1EE3ng 1 trang",this.paginator._intl.nextPageLabel="Ti\u1EBFp Theo",this.paginator._intl.previousPageLabel="V\u1EC1 Tr\u01B0\u1EDBc",this.paginator._intl.firstPageLabel="Trang \u0110\u1EA7u",this.paginator._intl.lastPageLabel="Trang Cu\u1ED1i"}catch(e){console.error("L\u1ED7i kh\u1EDFi t\u1EA1o danh s\xE1ch b\u1EA3ng gi\xE1:",e)}})}refresh(){return h(this,null,function*(){try{let e=yield this._GraphqlService.findMany("banggia",{include:{banggiaKhachhang:{include:{khachhang:{select:{id:!0,title:!0,ma:!0}}}},banggiaSanpham:{include:{sanpham:{select:{id:!0,title:!0,masp:!0}}}}},orderBy:{createdAt:"desc"}});this.dataSource.data=e,this.CountItem=e.length}catch(e){console.error("L\u1ED7i l\xE0m m\u1EDBi danh s\xE1ch b\u1EA3ng gi\xE1:",e),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi l\xE0m m\u1EDBi danh s\xE1ch","\u0110\xF3ng",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"],duration:3e3})}})}Banggiamacdinh(e){return h(this,null,function*(){try{let t=yield this._GraphqlService.findMany("banggiasanpham",{where:{banggiaId:e.id},include:{sanpham:{select:{id:!0,masp:!0,title:!0}}}}),i=t.map(a=>this._GraphqlService.updateOne("sanpham",{id:a.sanphamId},{giaban:a.giaban}));yield Promise.all(i),this._snackBar.open(`\u0110\xE3 c\u1EADp nh\u1EADt gi\xE1 b\xE1n m\u1EB7c \u0111\u1ECBnh cho ${t.length} s\u1EA3n ph\u1EA9m t\u1EEB b\u1EA3ng gi\xE1 ${e.title}`,"\u0110\xF3ng",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"],duration:3e3})}catch(t){console.error("L\u1ED7i c\u1EADp nh\u1EADt gi\xE1 b\xE1n m\u1EB7c \u0111\u1ECBnh:",t),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi c\u1EADp nh\u1EADt gi\xE1 b\xE1n","\u0110\xF3ng",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"],duration:3e3})}})}initializeColumns(){this.Columns=Object.keys(this.ColumnName).map(e=>({key:e,value:this.ColumnName[e],isShow:!0})),this.FilterColumns.length===0?this.FilterColumns=this.Columns:localStorage.setItem("BanggiaColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{})}setupDrawer(){this._breakpointObserver.observe([ct.Handset]).subscribe(e=>{e.matches?(this.drawer.mode="over",this.paginator.hidePageSize=!0):this.drawer.mode="side"})}toggleColumn(e){let t=this.FilterColumns.find(i=>i.key===e.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}FilterHederColumn(e,t){return e.filter((a,n,p)=>n===p.findIndex(k=>k[t]===a[t]))}doFilterHederColumn(e,t){this.dataSource.filteredData=this.dataSource.data.filter(a=>Dt(a[t]).includes(e.target.value.toLowerCase())||a[t].toLowerCase().includes(e.target.value.toLowerCase()));let i=e.target.value.toLowerCase()}ListFilter=[];ChosenItem(e,t){let i=this.dataSource.filteredData.filter(n=>n[t]===e[t]);this.ListFilter.filter(n=>n[t]===e[t]).length>0?this.ListFilter=this.ListFilter.filter(n=>n[t]!==e[t]):this.ListFilter=[...this.ListFilter,...i]}ChosenAll(e){e.forEach(t=>{!!this.ListFilter.find(a=>a.id===t.id)?this.ListFilter=this.ListFilter.filter(a=>a.id!==a.id):this.ListFilter.push(t)})}ResetFilter(){this.ListFilter=this.dataSource.data,this.dataSource.data=this.dataSource.data,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}EmptyFiter(){this.ListFilter=[]}CheckItem(e){return!!this.ListFilter.find(t=>t.id===e.id)}ApplyFilterColum(e){this.dataSource.data=this.dataSource.data.filter(t=>this.ListFilter.some(i=>i.id===t.id)),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,e.closeMenu()}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("BanggiaColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(i=>i.value.toLowerCase().includes(t))}create(){this.drawer.open(),this._router.navigate(["admin/banggia","new"])}goToDetail(e){this._BanggiaGraphqlService.setBanggiaId(e.id),this.drawer.open(),this._router.navigate(["admin/banggia",e.id])}convertDataToData1(e){return!e||e.length===0?[]:Object.keys(e[0]).filter(a=>!["masp","title","giagoc"].includes(a)).map(a=>({mabanggia:a,title:`B\u1EA3ng gi\xE1 ${a.replace("BG","")}`,sanpham:e.map(n=>({masp:n.masp,title:n.title,giagoc:n.giagoc,giaban:n[a]||0}))}))}DoImportData(e){return h(this,null,function*(){try{if(!e.SPBG||!e.BG||!e.BGKH){this._snackBar.open("SPBG ho\u1EB7c BG ho\u1EB7c BGKH kh\xF4ng t\u1ED3n t\u1EA1i","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}let t=(e.BG||[]).map(n=>({mabanggia:n.mabanggia,type:n.type,batdau:(0,E.default)(Q(n.batdau)).toDate(),ketthuc:(0,E.default)(Q(n.ketthuc)).toDate(),ghichu:n.ghichu,status:n.status})).filter(n=>n.mabanggia!==void 0&&n.mabanggia!==null&&n.mabanggia!=="");for(let n of t)yield this._GraphqlService.createOne("banggia",{mabanggia:n.mabanggia,type:n.type,batdau:n.batdau,ketthuc:n.ketthuc,ghichu:n.ghichu,status:n.status});let i=this.convertDataToData1(e.SPBG);for(let n of i)yield this._GraphqlService.createOne("banggiasanpham",n);let a=(e.BGKH||[]).map(n=>({mabanggia:n.mabanggia,name:n.name,makh:n.makh}));for(let n of a)yield this._GraphqlService.createOne("banggiaKhachhang",n);this._snackBar.open("Import Th\xE0nh C\xF4ng","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),yield this.refresh()}catch(t){console.error("L\u1ED7i import d\u1EEF li\u1EC7u:",t),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import d\u1EEF li\u1EC7u","\u0110\xF3ng",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"],duration:3e3})}})}ImportExcel(e){return h(this,null,function*(){let t=yield Wt(e);this.DoImportData(t)})}ExportExcel(e,t){return h(this,null,function*(){try{let i=yield this._GraphqlService.findMany("sanpham",{select:{id:!0,masp:!0,title:!0,giaban:!0}}),a=this.convertToData3(e,i),n=yield this._GraphqlService.findMany("banggia",{include:{banggiaKhachhang:{include:{khachhang:{select:{id:!0,ma:!0,title:!0}}}}}}),p=n.reduce((y,N)=>(Array.isArray(N.banggiaKhachhang)&&N.banggiaKhachhang.forEach(J=>{y.push({mabanggia:N.mabanggia,makh:J.khachhang.ma,name:J.khachhang.title})}),y),[]),k=n.map(y=>({mabanggia:y.mabanggia,type:y.type,batdau:(0,E.default)(y.batdau).format("DD/MM/YYYY"),ketthuc:(0,E.default)(y.ketthuc).format("DD/MM/YYYY"),ghichu:y.ghichu,status:y.status}));Ut({SPBG:{data:a},BG:{data:k},BGKH:{data:p}},t)}catch(i){console.error("L\u1ED7i export Excel:",i),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi export d\u1EEF li\u1EC7u","\u0110\xF3ng",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"],duration:3e3})}})}convertToData3(e,t){let i=new Set(e.map(a=>a.mabanggia));return t.map(a=>B({masp:a.masp,title:a.title,giaban:a.giaban.toString()},Array.from(i).reduce((n,p)=>(n[p]=a.giaban.toString(),n),{})))}trackByFn(e,t){return t.id}ListStatus=[{value:"baogia",title:"B\xE1o Gi\xE1"},{value:"dangban",title:"\u0110ang B\xE1n"},{value:"ngungban",title:"Ng\u1EEBng B\xE1n"}];getName(e,t,i){return e.find(a=>a[t]===i)}static \u0275fac=function(t){return new(t||F)};static \u0275cmp=W({type:F,selectors:[["app-listbanggia"]],viewQuery:function(t,i){if(t&1&&(G($,5),G(q,5),G(le,7)),t&2){let a;V(a=A())&&(i.paginator=a.first),V(a=A())&&(i.sort=a.first),V(a=A())&&(i.drawer=a.first)}},decls:15,vars:10,consts:[["drawer",""],["menu","matMenu"],["uploadfile",""],["menuTrigger","matMenuTrigger"],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-12","w-full","p-2"],["class","cursor-pointer w-full relative flex lg:flex-row lg:space-y-2 space-y-0 flex-col space-x-2 justify-between items-center p-2 bg-white rounded-lg",4,"ngIf"],["class","py-2 w-full flex flex-row space-x-2 items-center",4,"ngIf"],[1,"w-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","h-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:bg-slate-100",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["pageSize","100",3,"pageSizeOptions"],[1,"cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","p-2","bg-white","rounded-lg"],[1,"flex","flex-row","space-x-2","items-center"],["matTooltip","Th\xEAm m\u1EDBi","mat-flat-button","",1,"flex","flex-row","items-center","btn-primary",3,"click"],[1,"whitespace-nowrap"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["matTooltip","T\xECm Ki\u1EBFm","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\u1EA3i file excel M\u1EABu","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\u1EA3i l\xEAn file excel","color","primary","mat-icon-button","",3,"click"],["type","file",1,"hidden",3,"change"],[1,"lg:flex","hidden","whitespace-nowrap","p-2","rounded-lg","bg-slate-200"],["mat-menu-item","",3,"click"],[1,"py-2","w-full","flex","flex-row","space-x-2","items-center"],["matInput","","placeholder","Vui l\xF2ng T\xECm Ki\u1EBFm",3,"keyup"],["mat-icon-button","","color","warn",3,"click"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"max-w-40","line-clamp-4","me-4"],[1,"z-10","material-symbols-outlined","text-gray-500",3,"matMenuTriggerFor"],[1,"cursor-pointer","flex","flex-col","space-y-4","p-3",3,"click"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[1,"flex","flex-row","space-x-2","items-center","justify-between"],[1,"text-xs","text-blue-600","underline",3,"click"],[1,"w-full","flex","flex-col","space-y-2","max-h-44","overflow-auto"],["class","flex flex-row space-x-2 items-center p-2 rounded-lg hover:bg-slate-100",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-row","space-x-2","items-end","justify-end"],["mat-flat-button","","color","warn",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"flex","flex-row","space-x-2","items-center","p-2","rounded-lg","hover:bg-slate-100",3,"click"],["class","material-symbols-outlined text-blue-600",4,"ngIf"],[1,"material-symbols-outlined","text-blue-600"],["mat-cell",""],[1,"max-w-40","line-clamp-4"],[1,"flex","gap-2","max-w-40","line-clamp-4","items-center"],[1,"flex","max-w-40","line-clamp-4","font-bold","text-blue-700"],[1,"max-w-40","line-clamp-4","text-xs"],[3,"click"],[1,"text-green-500"],[1,"text-red-500"],["mat-header-row",""],["mat-row","",1,"hover:bg-slate-100"],[1,"mat-row"],["colspan","4",1,"mat-cell","p-4"]],template:function(t,i){t&1&&(o(0,"mat-drawer-container",4)(1,"mat-drawer",5,0),T(3,"router-outlet"),l(),o(4,"div",6),C(5,ge,33,2,"div",7)(6,ue,8,0,"div",8),o(7,"div",9)(8,"table",10),z(9,Ve,3,1,"ng-container",11,Z),C(11,Ae,1,0,"tr",12)(12,Pe,1,0,"tr",13)(13,$e,3,0,"tr",14),l()(),T(14,"mat-paginator",15),l()()),t&2&&(m(),x("position","end"),m(4),x("ngIf",!i.isSearch),m(),x("ngIf",i.isSearch),m(2),x("dataSource",i.dataSource),m(),j(i.displayedColumns),m(2),x("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),m(),x("matRowDefColumns",i.displayedColumns),m(2),x("pageSizeOptions",it(8,ce,i.dataSource.data.length)))},dependencies:[Ft,Mt,kt,Bt,Tt,Lt,Jt,$t,Ot,Kt,Ht,qt,zt,Nt,Rt,jt,Yt,Qt,Pt,q,At,Vt,$,wt,bt,Ct,St,ft,dt,_t,st,yt,xt,gt,mt,pt,Et,ot,at,nt,rt,vt,Gt,It],encapsulation:2,changeDetection:0})};R([qe()],F.prototype,"FilterHederColumn",1),R([Oe(300)],F.prototype,"doFilterHederColumn",1);var ne=F;function qe(){return function(r,e,t){let i=t.value,a=new Map;return t.value=function(...n){let p=JSON.stringify(n);if(a.has(p))return a.get(p);let k=i.apply(this,n);return a.set(p,k),k},t}}function Oe(r=300){return function(e,t,i){let a=i.value,n;return i.value=function(...p){clearTimeout(n),n=setTimeout(()=>{a.apply(this,p)},r)},i}}export{H as a,ne as b};
