import{b as ut}from"./chunk-MUNCB4XH.js";import{a as dt}from"./chunk-UXY4H5GG.js";import{a as O,c as k}from"./chunk-3ULLR243.js";import{a as lt,b as pt}from"./chunk-5D3ARLRI.js";import"./chunk-H7UDLENL.js";import"./chunk-2QVTWX3V.js";import{a as w}from"./chunk-FDTVQONQ.js";import{a as tt,b as et}from"./chunk-WWR2OOLD.js";import{b as Y,c as Z}from"./chunk-XBYFTIM3.js";import{B as W,C as X,b as q,d as u,g as G,h as K,k as j,n as H,o as R,r as $,t as z,u as J,v as Q,x as U}from"./chunk-5PCRWSUQ.js";import"./chunk-VYSL3BUN.js";import{a as nt,b as it,c as at,e as ot,f as rt,g as mt}from"./chunk-UM5HDL6V.js";import{a as L,b as V}from"./chunk-Q4HMHGF2.js";import"./chunk-6HMOLWQ2.js";import"./chunk-GKYSQU3D.js";import"./chunk-2PPFUFFT.js";import{a as B,e as N}from"./chunk-VA3CEBIV.js";import{la as D}from"./chunk-G22JNWMU.js";import"./chunk-M7LBCJDI.js";import{l as I,m as T,x as A}from"./chunk-HUFFEFIS.js";import{Cc as a,Db as M,Dc as S,Ec as b,Fc as y,Kb as p,Ra as f,Ub as r,dc as n,ec as t,fc as c,oc as _,pa as g,qc as E,rb as o}from"./chunk-5IRI5K5U.js";import"./chunk-LWLSKGAV.js";import{j as h}from"./chunk-6DYNGEAS.js";function ct(i,e){i&1&&(n(0,"div",7),c(1,"mat-spinner",8),n(2,"p"),a(3,"\u0110ang t\u1EA3i d\u1EEF li\u1EC7u..."),t()())}function st(i,e){i&1&&(n(0,"mat-error"),a(1," M\xE3 ph\xF2ng ban l\xE0 b\u1EAFt bu\u1ED9c "),t())}function ht(i,e){i&1&&(n(0,"mat-error"),a(1," T\u1ED1i \u0111a 20 k\xFD t\u1EF1 "),t())}function ft(i,e){i&1&&(n(0,"mat-error"),a(1," T\xEAn ph\xF2ng ban l\xE0 b\u1EAFt bu\u1ED9c "),t())}function bt(i,e){i&1&&(n(0,"mat-error"),a(1," T\u1ED1i \u0111a 200 k\xFD t\u1EF1 "),t())}function _t(i,e){if(i&1&&(n(0,"mat-option",18),a(1),t()),i&2){let m=e.$implicit;r("value",m.value),o(),b(" ",m.label," ")}}function Et(i,e){i&1&&(n(0,"mat-error"),a(1," Lo\u1EA1i ph\xF2ng ban l\xE0 b\u1EAFt bu\u1ED9c "),t())}function Ft(i,e){i&1&&(n(0,"mat-error"),a(1," C\u1EA5p l\xE0 b\u1EAFt bu\u1ED9c "),t())}function vt(i,e){if(i&1&&(n(0,"mat-option",18),a(1),t()),i&2){let m=e.$implicit;r("value",m.id),o(),y(" ",m.ma," - ",m.ten," ")}}function xt(i,e){if(i&1&&(n(0,"mat-form-field",11)(1,"mat-label"),a(2,"Ph\xF2ng ban cha"),t(),n(3,"mat-select",22)(4,"mat-option",18),a(5,"-- Kh\xF4ng c\xF3 --"),t(),p(6,vt,2,3,"mat-option",16),t(),n(7,"mat-icon",13),a(8,"account_tree"),t()()),i&2){let m=E(2);o(4),r("value",null),o(2),r("ngForOf",m.parentPhongbans())}}function Ct(i,e){i&1&&(n(0,"mat-error"),a(1," T\u1ED1i \u0111a 1000 k\xFD t\u1EF1 "),t())}function Pt(i,e){if(i&1&&(n(0,"form",9)(1,"div",10)(2,"mat-form-field",11)(3,"mat-label"),a(4,"M\xE3 ph\xF2ng ban"),t(),c(5,"input",12),n(6,"mat-icon",13),a(7,"tag"),t(),p(8,st,2,0,"mat-error",6)(9,ht,2,0,"mat-error",6),t(),n(10,"mat-form-field",11)(11,"mat-label"),a(12,"T\xEAn ph\xF2ng ban"),t(),c(13,"input",14),n(14,"mat-icon",13),a(15,"business"),t(),p(16,ft,2,0,"mat-error",6)(17,bt,2,0,"mat-error",6),t(),n(18,"mat-form-field",11)(19,"mat-label"),a(20,"Lo\u1EA1i ph\xF2ng ban"),t(),n(21,"mat-select",15),p(22,_t,2,2,"mat-option",16),t(),n(23,"mat-icon",13),a(24,"category"),t(),p(25,Et,2,0,"mat-error",6),t(),n(26,"mat-form-field",11)(27,"mat-label"),a(28,"C\u1EA5p"),t(),n(29,"mat-select",17)(30,"mat-option",18),a(31,"C\u1EA5p 1"),t(),n(32,"mat-option",18),a(33,"C\u1EA5p 2"),t(),n(34,"mat-option",18),a(35,"C\u1EA5p 3"),t()(),n(36,"mat-icon",13),a(37,"layers"),t(),p(38,Ft,2,0,"mat-error",6),t(),p(39,xt,9,2,"mat-form-field",19),n(40,"mat-form-field",20)(41,"mat-label"),a(42,"M\xF4 t\u1EA3"),t(),c(43,"textarea",21),n(44,"mat-icon",13),a(45,"description"),t(),p(46,Ct,2,0,"mat-error",6),t()()()),i&2){let m,l,s,F,v,x,C,P,d=E();r("formGroup",d.phongbanForm),o(8),r("ngIf",(m=d.phongbanForm.get("ma"))==null?null:m.hasError("required")),o(),r("ngIf",(l=d.phongbanForm.get("ma"))==null?null:l.hasError("maxlength")),o(7),r("ngIf",(s=d.phongbanForm.get("ten"))==null?null:s.hasError("required")),o(),r("ngIf",(F=d.phongbanForm.get("ten"))==null?null:F.hasError("maxlength")),o(5),r("ngForOf",d.loaiOptions),o(3),r("ngIf",(v=d.phongbanForm.get("loai"))==null?null:v.hasError("required")),o(5),r("value",1),o(2),r("value",2),o(2),r("value",3),o(4),r("ngIf",(x=d.phongbanForm.get("level"))==null?null:x.hasError("required")),o(),r("ngIf",((C=d.phongbanForm.get("level"))==null?null:C.value)>1),o(7),r("ngIf",(P=d.phongbanForm.get("moTa"))==null?null:P.hasError("maxlength"))}}function Mt(i,e){i&1&&c(0,"mat-spinner",23)}function St(i,e){i&1&&(n(0,"mat-icon"),a(1,"save"),t())}var gt=class i{fb=g($);route=g(O);router=g(k);phongbanService=g(dt);snackBar=g(w);mode="create";id=null;loading=f(!1);submitting=f(!1);parentPhongbans=f([]);phongbanForm;loaiOptions=Object.entries(ut).map(([e,m])=>({value:e,label:m}));ngOnInit(){this.id=this.route.snapshot.paramMap.get("id"),this.mode=this.route.snapshot.data.mode||(this.id?"edit":"create"),this.initForm(),this.loadParentPhongbans(),this.mode==="edit"&&this.id&&this.loadPhongban()}initForm(){this.phongbanForm=this.fb.group({ma:["",[u.required,u.maxLength(20)]],ten:["",[u.required,u.maxLength(200)]],loai:["KHAC",u.required],level:[1,u.required],parentId:[null],moTa:["",u.maxLength(1e3)]}),this.phongbanForm.get("level")?.valueChanges.subscribe(e=>{e===1&&this.phongbanForm.get("parentId")?.setValue(null)})}loadParentPhongbans(){return h(this,null,function*(){try{let e=yield this.phongbanService.getAllPhongban({includeChildren:!1});this.parentPhongbans.set(e.filter(m=>m.level===1&&m.id!==this.id))}catch(e){console.error("Error loading parent phongbans:",e)}})}loadPhongban(){return h(this,null,function*(){if(this.id)try{this.loading.set(!0);let e=yield this.phongbanService.getPhongbanById(this.id);this.phongbanForm.patchValue({ma:e.ma,ten:e.ten,loai:e.loai,level:e.level,parentId:e.parentId,moTa:e.moTa})}catch(e){this.snackBar.open("Kh\xF4ng th\u1EC3 t\u1EA3i th\xF4ng tin ph\xF2ng ban","\u0110\xF3ng",{duration:3e3}),console.error("Error loading phongban:",e)}finally{this.loading.set(!1)}})}onSubmit(){return h(this,null,function*(){if(!this.phongbanForm.valid){this.snackBar.open("Vui l\xF2ng \u0111i\u1EC1n \u0111\u1EA7y \u0111\u1EE7 th\xF4ng tin","\u0110\xF3ng",{duration:3e3});return}try{this.submitting.set(!0);let e=this.phongbanForm.value;this.mode==="create"?(yield this.phongbanService.createPhongban(e),this.snackBar.open("T\u1EA1o ph\xF2ng ban th\xE0nh c\xF4ng!","\u0110\xF3ng",{duration:3e3})):this.id&&(yield this.phongbanService.updatePhongban(this.id,e),this.snackBar.open("C\u1EADp nh\u1EADt ph\xF2ng ban th\xE0nh c\xF4ng!","\u0110\xF3ng",{duration:3e3})),this.router.navigate(["/admin/phongban/list"])}catch(e){let m=e?.error?.message||"C\xF3 l\u1ED7i x\u1EA3y ra. Vui l\xF2ng th\u1EED l\u1EA1i.";this.snackBar.open(m,"\u0110\xF3ng",{duration:5e3}),console.error("Error submitting form:",e)}finally{this.submitting.set(!1)}})}goBack(){this.router.navigate(["/admin/phongban/list"])}static \u0275fac=function(m){return new(m||i)};static \u0275cmp=M({type:i,selectors:[["app-formphongban"]],decls:19,vars:9,consts:[[1,"container"],["class","loading-container",4,"ngIf"],[3,"formGroup",4,"ngIf"],["mat-raised-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],["diameter","20","style","display: inline-block; margin-right: 8px;",4,"ngIf"],[4,"ngIf"],[1,"loading-container"],["diameter","40"],[3,"formGroup"],[1,"form-grid"],["appearance","outline"],["matInput","","formControlName","ma","placeholder","VD: PB01"],["matPrefix",""],["matInput","","formControlName","ten","placeholder","VD: Ph\xF2ng Kinh Doanh"],["formControlName","loai"],[3,"value",4,"ngFor","ngForOf"],["formControlName","level"],[3,"value"],["appearance","outline",4,"ngIf"],["appearance","outline",1,"full-width"],["matInput","","formControlName","moTa","rows","4","placeholder","Nh\u1EADp m\xF4 t\u1EA3 v\u1EC1 ph\xF2ng ban..."],["formControlName","parentId"],["diameter","20",2,"display","inline-block","margin-right","8px"]],template:function(m,l){m&1&&(n(0,"div",0)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title")(4,"mat-icon"),a(5),t(),a(6),t()(),n(7,"mat-card-content"),p(8,ct,4,0,"div",1)(9,Pt,47,13,"form",2),t(),n(10,"mat-card-actions")(11,"button",3),_("click",function(){return l.goBack()}),n(12,"mat-icon"),a(13,"arrow_back"),t(),a(14," H\u1EE7y "),t(),n(15,"button",4),_("click",function(){return l.onSubmit()}),p(16,Mt,1,0,"mat-spinner",5)(17,St,2,0,"mat-icon",6),a(18),t()()()()),m&2&&(o(5),S(l.mode==="create"?"add":"edit"),o(),b(" ",l.mode==="create"?"Th\xEAm Ph\xF2ng Ban M\u1EDBi":"Ch\u1EC9nh S\u1EEDa Ph\xF2ng Ban"," "),o(2),r("ngIf",l.loading()),o(),r("ngIf",!l.loading()),o(2),r("disabled",l.submitting()),o(4),r("disabled",!l.phongbanForm.valid||l.submitting()),o(),r("ngIf",l.submitting()),o(),r("ngIf",!l.submitting()),o(),b(" ",l.submitting()?"\u0110ang l\u01B0u...":"L\u01B0u"," "))},dependencies:[A,I,T,z,j,q,G,K,H,R,mt,nt,ot,at,rt,it,N,B,V,L,X,W,J,Q,U,Z,Y,et,tt,D,pt,lt],styles:[".container[_ngcontent-%COMP%]{padding:24px;max-width:1200px;margin:0 auto}.loading-container[_ngcontent-%COMP%]{text-align:center;padding:60px 20px}.loading-container[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]{margin:0 auto 20px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;padding:20px 0}.form-grid[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.form-grid[_ngcontent-%COMP%]   mat-form-field.full-width[_ngcontent-%COMP%]{grid-column:1/-1}@media (max-width: 768px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}mat-card-actions[_ngcontent-%COMP%]{padding:16px;display:flex;gap:12px;justify-content:flex-end}"]})};export{gt as FormPhongbanComponent};
