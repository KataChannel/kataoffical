import{a as Jt,b as Yt}from"./chunk-3HB7FQHW.js";import"./chunk-S4NZZWBD.js";import{a as Xt}from"./chunk-53IISJN5.js";import"./chunk-QHCPJI62.js";import"./chunk-4ZVJO4SQ.js";import"./chunk-XHVJ7NZ3.js";import"./chunk-NULFSBS2.js";import"./chunk-SR7RCIEL.js";import"./chunk-EQHO5CVZ.js";import{d as Tt}from"./chunk-5NC4P5UG.js";import{a as B}from"./chunk-ZW44ZSN2.js";import"./chunk-P7BBNZNS.js";import{b as Ct,c as ft,d as gt}from"./chunk-LECLUHD2.js";import"./chunk-IE4L6KDU.js";import"./chunk-KE6HBPKL.js";import{b as Gt}from"./chunk-F366E334.js";import{a as N,b as Ft,c as Mt}from"./chunk-N2KOTR2C.js";import{c as Dt,h as bt}from"./chunk-ILGJOBJG.js";import"./chunk-H7UDLENL.js";import{a as ut}from"./chunk-Q3KOS33T.js";import"./chunk-DP4FJZ2N.js";import{a as Ot,b as Qt,c as qt,k as Ut}from"./chunk-OP3J4F3V.js";import{a as ht,c as _t}from"./chunk-OJMQSPC3.js";import"./chunk-OZW3KHHG.js";import{c as Lt,d as Vt,e as At,g as Pt,h as Bt,j as Nt,k as $t,m as Rt,n as zt,p as Ht,q as Wt,r as jt,s as Kt}from"./chunk-LXFX5R3F.js";import{b as It}from"./chunk-KJ3ORMDZ.js";import{b as xt,g as kt,j as vt,n as yt,p as K,s as wt,v as O,w as Et,y as Q,z as St}from"./chunk-M2YCC4SP.js";import"./chunk-KBSHTQVA.js";import{a as j,b as pt}from"./chunk-PYCEOLIX.js";import"./chunk-NBQTKVUV.js";import"./chunk-FME5K2LE.js";import"./chunk-2PPFUFFT.js";import{a as H,c as W,e as mt}from"./chunk-BAEDUNPT.js";import{_ as dt}from"./chunk-DL37TIRW.js";import"./chunk-5LF7WV5H.js";import{l as lt,m as z,t as st,v as ct}from"./chunk-GKGVKDD5.js";import{$b as J,Cc as T,Db as q,Dc as h,Ec as R,Fc as g,Gc as ot,Hc as at,Ic as V,Jc as A,Kb as x,Kc as P,Ra as I,Rb as U,Sb as G,Sc as w,Ub as _,Uc as E,Xb as X,bc as Y,cc as Z,dc as tt,ec as a,fc as r,gc as F,hc as M,ic as L,kc as y,md as rt,pa as b,pc as C,rb as c,rc as l,xc as et,ya as d,yc as it,za as m,zc as nt}from"./chunk-OL5DVADB.js";import"./chunk-LWLSKGAV.js";import{a as v,b as D,j as k}from"./chunk-6DYNGEAS.js";var ae=()=>[O,K,Q,j,H,W,Ct,ft,lt,z];function re(o,e){if(o&1){let t=y();a(0,"button",5),C("click",function(){d(t);let n=l();return m(n.handleChotkhoAction())}),a(1,"mat-icon"),h(2,"save"),r()()}}function le(o,e){if(o&1){let t=y();a(0,"button",5),C("click",function(){d(t);let n=l();return m(n.toggleEdit())}),a(1,"mat-icon"),h(2,"edit"),r()()}}function se(o,e){if(o&1){let t=y();M(0),a(1,"div",11)(2,"div",12),h(3,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),r(),a(4,"div",13)(5,"button",14),C("click",function(){d(t);let n=l();return m(n.DeleteData())}),h(6,"\u0110\u1ED3ng \xDD"),r(),a(7,"button",15),C("click",function(){d(t);let n=l();return m(n.toggleDelete())}),h(8,"Hu\u1EF7 B\u1ECF"),r()()(),L()}}function ce(o,e){if(o&1){let t=y();a(0,"div",18)(1,"h3",19),h(2,"Th\xF4ng tin ch\u1ED1t kho"),r(),a(3,"div",20)(4,"mat-form-field",21)(5,"mat-label"),h(6,"Ti\xEAu \u0110\u1EC1"),r(),a(7,"input",22),P("ngModelChange",function(n){d(t);let s=l(2);return A(s.DetailChotkho().title,n)||(s.DetailChotkho().title=n),m(n)}),r()(),a(8,"mat-form-field",21)(9,"mat-label"),h(10,"Ng\xE0y Ch\u1ED1t"),r(),a(11,"input",23),P("ngModelChange",function(n){d(t);let s=l(2);return A(s.DetailChotkho().ngaychot,n)||(s.DetailChotkho().ngaychot=n),m(n)}),r(),F(12,"mat-datepicker-toggle",24)(13,"mat-datepicker",null,0),r(),a(15,"mat-form-field",25)(16,"mat-label"),h(17,"Ghi Ch\xFA"),r(),a(18,"textarea",26),P("ngModelChange",function(n){d(t);let s=l(2);return A(s.DetailChotkho().ghichu,n)||(s.DetailChotkho().ghichu=n),m(n)}),r()()()()}if(o&2){let t=T(14),i=l(2);c(7),V("ngModel",i.DetailChotkho().title),_("disabled",!i.isEdit()),c(4),_("matDatepicker",t),V("ngModel",i.DetailChotkho().ngaychot),_("disabled",!i.isEdit()),c(),_("for",t),c(6),V("ngModel",i.DetailChotkho().ghichu),_("disabled",!i.isEdit())}}function he(o,e){o&1&&(a(0,"span",63),h(1,"check_box"),r())}function _e(o,e){o&1&&(a(0,"span",64),h(1,"check_box_outline_blank"),r())}function de(o,e){if(o&1){let t=y();a(0,"div",57),C("click",function(){let n=d(t).$implicit,s=l(5);return m(s.ChosenItem(n))}),x(1,he,2,0,"span",58)(2,_e,2,0,"span",59),a(3,"div",60)(4,"span",61),h(5),r(),a(6,"span",62),h(7),r()()()}if(o&2){let t=e.$implicit,i=l(5);c(),_("ngIf",i.CheckItem(t)),c(),_("ngIf",!i.CheckItem(t)),c(3),R(t.title||"Ch\u01B0a C\xF3 T\xEAn"),c(2),ot("M\xE3: ",t.masp," - \u0110VT: ",t.dvt,"")}}function me(o,e){o&1&&(a(0,"div",65),h(1," Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m kh\u1EA3 d\u1EE5ng "),r())}function ue(o,e){if(o&1){let t=y();a(0,"div",36)(1,"div",37)(2,"button",38,1)(4,"mat-icon"),h(5,"inventory"),r(),h(6),r(),a(7,"mat-menu",null,2)(9,"div",39),C("click",function(n){return d(t),m(n.stopPropagation())}),a(10,"div",40)(11,"div",41),h(12,"T\xECnh tr\u1EA1ng s\u1EA3n ph\u1EA9m:"),r(),a(13,"div",42),h(14),r()(),a(15,"div",43)(16,"input",44,3),C("keyup",function(n){d(t);let s=l(4);return m(s.doFilterSanpham(n))}),r(),a(18,"div",45)(19,"span",46),h(20,"search"),r()()(),a(21,"div",47)(22,"div",7)(23,"span",48),C("click",function(){d(t);let n=l(4);return m(n.ChosenAll(n.ListSanpham))}),h(24),r(),a(25,"span",49),C("click",function(){d(t);let n=l(4);return m(n.EmptyFiter())}),h(26,"Xo\xE1 T\u1EA5t C\u1EA3"),r()(),a(27,"span",50),C("click",function(){d(t);let n=l(4);return m(n.ResetFilter())}),h(28,"L\xE0m M\u1EDBi"),r()(),a(29,"div",51),x(30,de,8,5,"div",52)(31,me,2,0,"div",53),r(),a(32,"div",54)(33,"button",15),C("click",function(){d(t);let n=T(3);return m(n.closeMenu())}),h(34,"\u0110\xF3ng"),r(),a(35,"button",14),C("click",function(){d(t);let n=T(3),s=l(4);return m(s.ApplyFilterColum(n))}),h(36,"\xC1p D\u1EE5ng"),r()()()(),a(37,"mat-form-field",21)(38,"mat-label"),h(39,"T\xECm Ki\u1EBFm"),r(),a(40,"input",55),C("keyup",function(n){d(t);let s=l(4);return m(s.applyFilter(n))}),r()(),a(41,"button",56),C("click",function(){d(t);let n=l(4);return m(n.EmptyCart())}),a(42,"mat-icon"),h(43,"delete"),r()()()()}if(o&2){let t=T(8),i=l(4);c(2),_("disabled",!i.isEdit())("matMenuTriggerFor",t),c(4),g(" ",i.ListFilter.length," S\u1EA3n Ph\u1EA9m \u0110\xE3 Ch\u1ECDn "),c(8),at(" \u2022 ",i.ListFilter.length," s\u1EA3n ph\u1EA9m \u0111\xE3 ch\u1ECDn \u2022 ",i.ListSanpham.length-i.ListFilter.length," s\u1EA3n ph\u1EA9m kh\u1EA3 d\u1EE5ng \u2022 ",i.ListSanpham.length," t\u1ED5ng s\u1EA3n ph\u1EA9m "),c(10),g("Ch\u1ECDn T\u1EA5t C\u1EA3 (",i.ListSanpham.length-i.ListFilter.length," s\u1EA3n ph\u1EA9m kh\u1EA3 d\u1EE5ng)"),c(6),_("ngForOf",i.getFilteredSanpham())("ngForTrackBy",i.trackByFn),c(),_("ngIf",i.ListSanpham.length===0),c(10),_("disabled",!i.isEdit())}}function pe(o,e){o&1&&(a(0,"div",35),x(1,ue,44,11),U(2,1,ae),G(),r())}function Ce(o,e){if(o&1&&(a(0,"th",68)(1,"span",69),h(2),r()()),o&2){let t=l().$implicit,i=l(3);c(2),g(" ",i.ColumnName[t]," ")}}function fe(o,e){if(o&1){let t=y();a(0,"span",71)(1,"span"),h(2),r(),a(3,"button",75),C("click",function(){d(t);let n=l().$implicit,s=l(4);return m(s.RemoveSanpham(n))}),a(4,"mat-icon"),h(5,"delete"),r()()()}if(o&2){let t=l().index,i=l(4);c(2),g("",t+1," "),c(),_("disabled",!i.isEdit())}}function ge(o,e){if(o&1){let t=y();a(0,"div",78),C("blur",function(n){d(t);let s=l(2),p=s.$implicit,u=s.index,f=l(4);return m(f.updateValue(n,u,p,"sltonthucte","number"))})("keydown.enter",function(n){d(t);let s=l(2),p=s.$implicit,u=s.index,f=l(4);return m(f.updateValue(n,u,p,"sltonthucte","number"))}),h(1),w(2,"number"),r()}if(o&2){let t=l(2).$implicit,i=l().$implicit;_("contentEditable",!0),c(),g(" ",E(2,2,t[i]||0,"1.0-3")," ")}}function xe(o,e){if(o&1&&(a(0,"span",74),h(1),w(2,"number"),r()),o&2){let t=l(2).$implicit,i=l().$implicit;c(),g(" ",E(2,1,t[i],"1.0-3")," ")}}function ke(o,e){if(o&1&&x(0,ge,3,5,"div",76)(1,xe,3,4,"span",77),o&2){let t=l(5);_("ngIf",t.isEdit()),c(),_("ngIf",!t.isEdit())}}function ve(o,e){if(o&1){let t=y();a(0,"div",80),C("blur",function(n){d(t);let s=l(2),p=s.$implicit,u=s.index,f=l(4);return m(f.updateValue(n,u,p,"slhuy","number"))})("keydown.enter",function(n){d(t);let s=l(2),p=s.$implicit,u=s.index,f=l(4);return m(f.updateValue(n,u,p,"slhuy","number"))}),h(1),w(2,"number"),r()}if(o&2){let t=l(2).$implicit,i=l().$implicit;_("contentEditable",!0),c(),g(" ",E(2,2,t[i]||0,"1.0-3")," ")}}function ye(o,e){if(o&1&&(a(0,"span",74),h(1),w(2,"number"),r()),o&2){let t=l(2).$implicit,i=l().$implicit;c(),g(" ",E(2,1,t[i],"1.0-3")," ")}}function De(o,e){if(o&1&&x(0,ve,3,5,"div",79)(1,ye,3,4,"span",77),o&2){let t=l(5);_("ngIf",t.isEdit()),c(),_("ngIf",!t.isEdit())}}function be(o,e){if(o&1&&(a(0,"span",74),h(1),w(2,"number"),r()),o&2){let t=l().$implicit,i=l().$implicit;X(t[i]>0?"text-green-600":t[i]<0?"text-red-600":"text-yellow-600"),c(),g(" ",E(2,3,t[i],"1.0-3")," ")}}function we(o,e){if(o&1&&(a(0,"span",73),h(1),r()),o&2){let t=l().$implicit;c(),g(" ",t.title||(t.sanpham==null?null:t.sanpham.title)," ")}}function Ee(o,e){if(o&1&&(a(0,"span",73),h(1),r()),o&2){let t=l().$implicit;c(),g(" ",t.masp||(t.sanpham==null?null:t.sanpham.masp)," ")}}function Se(o,e){if(o&1&&(a(0,"span",73),h(1),r()),o&2){let t=l().$implicit;c(),g(" ",t.dvt||(t.sanpham==null?null:t.sanpham.dvt)," ")}}function Ie(o,e){if(o&1&&(a(0,"span",74),h(1),w(2,"number"),r()),o&2){let t=l().$implicit,i=l().$implicit;c(),g(" ",E(2,1,t[i],"1.0-3")," ")}}function Te(o,e){if(o&1&&(a(0,"span",73),h(1),r()),o&2){let t=l().$implicit,i=l().$implicit;c(),g(" ",t[i]," ")}}function Fe(o,e){if(o&1&&(a(0,"td",70),x(1,fe,6,2,"span",71)(2,ke,2,2)(3,De,2,2)(4,be,3,6,"span",72)(5,we,2,1,"span",73)(6,Ee,2,1,"span",73)(7,Se,2,1,"span",73)(8,Ie,3,4,"span",74)(9,Te,2,1,"span",73),r()),o&2){let t,i=l().$implicit;c(),J((t=i)==="STT"?1:t==="sltonthucte"?2:t==="slhuy"?3:t==="chenhlech"?4:t==="title"?5:t==="masp"?6:t==="dvt"?7:t==="sltonhethong"?8:9)}}function Me(o,e){if(o&1&&(M(0,31),x(1,Ce,3,1,"th",66)(2,Fe,10,1,"td",67),L()),o&2){let t=e.$implicit;_("matColumnDef",t)}}function Le(o,e){o&1&&F(0,"tr",81)}function Ve(o,e){o&1&&F(0,"tr",82)}function Ae(o,e){o&1&&(a(0,"tr",83)(1,"td",84),h(2,"Kh\xF4ng t\xECm th\u1EA5y d\u1EEF li\u1EC7u"),r()())}function Pe(o,e){if(o&1&&(a(0,"div",27),x(1,pe,4,0,"div",28),a(2,"div",29)(3,"table",30),Z(4,Me,3,1,"ng-container",31,Y),x(6,Le,1,0,"tr",32)(7,Ve,1,0,"tr",33)(8,Ae,3,0,"tr",34),r()()()),o&2){let t=l(2);c(),_("ngIf",t.isEdit()),c(2),_("dataSource",t.dataSource()),c(),tt(t.displayedColumns),c(2),_("matHeaderRowDef",t.displayedColumns),c(),_("matRowDefColumns",t.displayedColumns)}}function Be(o,e){if(o&1&&(M(0),x(1,ce,19,8,"div",16)(2,Pe,9,4,"div",17),L()),o&2){let t=l();c(),_("ngIf",t.DetailChotkho()),c(),_("ngIf",t.DetailChotkho())}}var Zt=class o{_ListChotkhoComponent=b(Yt);_ChotkhoService=b(Jt);_SanphamService=b(Xt);_route=b(ht);_router=b(_t);_snackBar=b(ut);_dialog=b(Dt);sort;dataSource=I(new Kt([]));displayedColumns=["STT","title","masp","dvt","sltonhethong","sltonthucte","slhuy","chenhlech"];ColumnName={STT:"STT",title:"T\xEAn S\u1EA3n Ph\u1EA9m",masp:"M\xE3 SP",dvt:"\u0110\u01A1n V\u1ECB",sltonhethong:"SL H\u1EC7 Th\u1ED1ng",sltonthucte:"SL Th\u1EF1c T\u1EBF",slhuy:"SL H\u1EE7y",chenhlech:"Ch\xEAnh L\u1EC7ch"};DetailChotkho=I({id:void 0,title:"",ngaychot:new Date,ghichu:"",khoId:"",userId:"",isActive:!0,details:[]});constructor(){this._route.paramMap.subscribe(e=>{let t=e.get("id");this._ChotkhoService.setChotkhoId(t)}),rt(()=>k(this,null,function*(){let e=this._ChotkhoService.DetailChotkho();e&&(this.DetailChotkho.set(e),this.dataSource.update(t=>(t.data=e.details||[],t)),this.ListFilter=e.details||[],this.ListSanpham.length>0&&this.updateAvailableProducts())}))}isEdit=I(!1);isDelete=I(!1);chotkhoId=this._ChotkhoService.chotkhoId;ListSanpham=[];filterSanpham=[];ListFilter=[];searchTerm="";getFilteredSanpham(){if(!this.searchTerm||this.searchTerm.length<2)return this.ListSanpham;let e=B(this.searchTerm.toLowerCase());return this.ListSanpham.filter(t=>{let i=B(t.title?.toLowerCase()||""),n=B(t.masp?.toLowerCase()||"");return i.includes(e)||n.includes(e)||t.title?.toLowerCase().includes(this.searchTerm)||t.masp?.toLowerCase().includes(this.searchTerm)})}ngOnInit(){return k(this,null,function*(){let e=this._ChotkhoService.chotkhoId();if(e||(this._router.navigate(["/admin/chotkho"]),this._ListChotkhoComponent.drawer.close()),e==="new"){let t={title:"Ch\u1ED1t Kho Ng\xE0y "+new Date().toLocaleDateString(),ngaychot:new Date,ghichu:"",khoId:"",userId:"",isActive:!0,details:[]};this.DetailChotkho.set(t),this._ChotkhoService.DetailChotkho.set(t),this._ListChotkhoComponent.drawer.open(),this.isEdit.update(i=>!0),this._router.navigate(["/admin/chotkho","new"])}else e&&(yield this._ChotkhoService.getChotkhoById(e),setTimeout(()=>{let t=this._ChotkhoService.DetailChotkho()},1e3),this._ListChotkhoComponent.drawer.open(),this._router.navigate(["/admin/chotkho",e]));yield this.loadSanphamList()})}handleChotkhoAction(){return k(this,null,function*(){this.chotkhoId()==="new"?yield this.createChotkho():yield this.updateChotkho()})}createChotkho(){return k(this,null,function*(){try{let e=this.DetailChotkho();yield this._ChotkhoService.createChotkhoWithDetails(e),this._snackBar.open("T\u1EA1o ch\u1ED1t kho th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(t=>!1)}catch(e){console.error("L\u1ED7i khi t\u1EA1o ch\u1ED1t kho:",e),this._snackBar.open("L\u1ED7i khi t\u1EA1o ch\u1ED1t kho","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}updateChotkho(){return k(this,null,function*(){try{let e=this.DetailChotkho();e?.id&&(yield this._ChotkhoService.updateChotkhoWithDetails(e.id,e),this._snackBar.open("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(t=>!1),setTimeout(()=>{window.location.reload()},100))}catch(e){console.error("L\u1ED7i khi c\u1EADp nh\u1EADt ch\u1ED1t kho:",e),this._snackBar.open("L\u1ED7i khi c\u1EADp nh\u1EADt ch\u1ED1t kho","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}DeleteData(){return k(this,null,function*(){try{let e=this.DetailChotkho();e?.id&&(yield this._ChotkhoService.deleteChotkho(e.id),this._snackBar.open("X\xF3a th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this._router.navigate(["/admin/chotkho"]))}catch(e){console.error("L\u1ED7i khi x\xF3a ch\u1ED1t kho:",e),this._snackBar.open("L\u1ED7i khi x\xF3a ch\u1ED1t kho","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}onQuantityChange(){let e=this.DetailChotkho();if(e){let t=Number(e.sltonhethong)||0,i=Number(e.sltonthucte)||0,n=Number(e.slhuy)||0,s=t-i-n;this.DetailChotkho.update(p=>D(v({},p),{chenhlech:s}))}}detailDisplayedColumns=["sanpham","sltonhethong","sltonthucte","slhuy","chenhlech","actions"];removeDetail(e){let i=(this.DetailChotkho().details||[]).filter(n=>n!==e);this.DetailChotkho.update(n=>D(v({},n),{details:i}))}updateChenhLech(e){let t=Number(e.sltonhethong)||0,i=Number(e.sltonthucte)||0,n=Number(e.slhuy)||0;e.chenhlech=t-i-n}goBack(){this._router.navigate(["/admin/chotkho"]),this._ListChotkhoComponent.drawer.close()}trackByFn(e,t){return t.id||e}toggleEdit(){this.isEdit.update(e=>!e)}toggleDelete(){this.isDelete.update(e=>!e)}FillSlug(){this.DetailChotkho.update(e=>(e.slug=Tt(e.title),e))}loadSanphamList(){return k(this,null,function*(){try{let t=(yield this._ChotkhoService.getAllProducts()).map(i=>({id:i.id,sanphamId:i.id,title:i.title,masp:i.masp,dvt:i.dvt,sltonhethong:i.tonkho?.slton||0,sltonthucte:i.tonkho?.sltinhthucte||0,slhuy:i.tonkho?.slhuy||0,chenhlech:(i.tonkho?.slton||0)-(i.tonkho?.sltinhthucte||0)-(i.tonkho?.slhuy||0),dongia:i.dongia}));this.ListSanpham=t,this.updateAvailableProducts()}catch(e){console.error("Error loading sanpham list:",e),this._snackBar.open("L\u1ED7i khi t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m","\u0110\xF3ng",{duration:3e3,panelClass:["snackbar-error"]})}})}DoOutFilter(e){return k(this,null,function*(){console.log("C\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m cho ch\u1ED1t kho:",e);try{this.DetailChotkho.update(i=>D(v({},i),{details:e.map(n=>({sanphamId:n.sanphamId||n.id,sanpham:{id:n.sanphamId||n.id,masp:n.masp,title:n.title,dvt:n.dvt,dongia:n.dongia},sltonhethong:Number(n.sltonhethong)||0,sltonthucte:Number(n.sltonthucte)||0,slhuy:Number(n.slhuy)||0,chenhlech:Number(n.chenhlech)||0,ghichu:n.ghichu||"",isActive:!0,title:n.title,masp:n.masp,dvt:n.dvt}))})),this.filterSanpham=this.DetailChotkho().details,this.dataSource.update(i=>(i.data=[...this.DetailChotkho().details],i.sort=this.sort,i));let t=e.map(i=>i.sanphamId||i.id);this.ListSanpham=this.ListSanpham.filter(i=>!t.includes(i.id||i.sanphamId)),console.log("Updated DetailChotkho:",this.DetailChotkho()),console.log("Updated ListSanpham (removed selected):",this.ListSanpham),this._snackBar.open("C\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(t){console.error("L\u1ED7i c\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m:",t),this._snackBar.open("L\u1ED7i c\u1EADp nh\u1EADt s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}EmptyCart(){let e=this.DetailChotkho().details||[];this.DetailChotkho.update(t=>D(v({},t),{details:[]})),this.dataSource.update(t=>(t.data=[],t)),e.forEach(t=>{let i={id:t.sanphamId||t.id,sanphamId:t.sanphamId||t.id,title:t.title||t.sanpham?.title,masp:t.masp||t.sanpham?.masp,dvt:t.dvt||t.sanpham?.dvt,sltonhethong:t.sltonhethong||0,sltonthucte:t.sltonthucte||0,slhuy:t.slhuy||0,chenhlech:t.chenhlech||0,dongia:t.dongia||t.sanpham?.dongia||0};this.ListSanpham.some(s=>s.id===i.id||s.sanphamId===i.id)||this.ListSanpham.push(i)}),console.log("Restored products to ListSanpham:",this.ListSanpham),this._snackBar.open("\u0110\xE3 x\xF3a t\u1EA5t c\u1EA3 s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}RemoveSanpham(e){let i=(this.DetailChotkho().details||[]).filter(u=>u.id!==e.id&&u.sanphamId!==e.sanphamId);this.DetailChotkho.update(u=>D(v({},u),{details:i})),this.dataSource.update(u=>(u.data=[...i],u));let n=e.sanphamId||e.id,s={id:n,sanphamId:n,title:e.title||e.sanpham?.title,masp:e.masp||e.sanpham?.masp,dvt:e.dvt||e.sanpham?.dvt,sltonhethong:e.sltonhethong||0,sltonthucte:e.sltonthucte||0,slhuy:e.slhuy||0,chenhlech:e.chenhlech||0,dongia:e.dongia||e.sanpham?.dongia||0};this.ListSanpham.some(u=>u.id===n||u.sanphamId===n)||(this.ListSanpham.push(s),console.log("Added product back to ListSanpham:",s)),this._snackBar.open("\u0110\xE3 x\xF3a s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}updateValue(e,t,i,n,s){e.preventDefault(),e.stopPropagation();let p=e.target.innerText.trim();if(s==="number"){let f=p.replace(/,/g,"").replace(/[^0-9.-]/g,"");p=Number(f)||0}console.log(`Updating ${n} with value:`,p),this.DetailChotkho.update(f=>{let te=(f.details||[]).map(($,ee)=>{if(ee===t||$.sanphamId===i.sanphamId){let S=v({},$);if(S[n]=p,n==="sltonthucte"||n==="slhuy"){let ie=Number(S.sltonhethong)||0,ne=Number(S.sltonthucte)||0,oe=Number(S.slhuy)||0;S.chenhlech=ie-ne-oe}return S}return $});return D(v({},f),{details:te})});let u=this.DetailChotkho().details||[];this.dataSource.update(f=>(f.data=[...u],f)),console.log("Updated DetailChotkho:",this.DetailChotkho())}doFilterSanpham(e){return k(this,null,function*(){let t=e.target.value.trim().toLowerCase();if(this.searchTerm=t,e.key==="Enter"){let i=this.getFilteredSanpham();if(i.length>0){let n=i.find(s=>!this.CheckItem(s));n&&(this.ChosenItem(n),e.target.value="",this.searchTerm="")}}})}ChosenItem(e){let t=this.filterSanpham.find(n=>n.id===e.id);if(this.ListFilter.find(n=>n.id===e.id||n.sanphamId===e.id))this.ListFilter=this.ListFilter.filter(n=>n.id!==e.id&&n.sanphamId!==e.id),console.log(`Removed product: ${e.title}`);else if(t){let n=D(v({},t),{sanphamId:t.id,sltonhethong:t.sltonhethong||0,sltonthucte:t.sltonthucte||0,slhuy:t.slhuy||0,chenhlech:t.chenhlech||0,order:this.ListFilter.length+1});this.ListFilter.findIndex(p=>p.id===e.id||p.sanphamId===e.id)===-1&&(this.ListFilter.push(n),console.log(`Added product: ${e.title}`))}}ChosenAll(e){return k(this,null,function*(){let i=e.filter(n=>!this.ListFilter.find(s=>s.id===n.id||s.sanphamId===n.id)).map((n,s)=>D(v({},n),{sanphamId:n.id,sltonhethong:n.sltonhethong||0,sltonthucte:n.sltonthucte||0,slhuy:n.slhuy||0,chenhlech:n.chenhlech||0,order:this.ListFilter.length+s+1}));this.ListFilter=[...this.ListFilter,...i],console.log(`Added ${i.length} unique products. Total: ${this.ListFilter.length} products`)})}ResetFilter(){this.filterSanpham=this.ListSanpham.filter(e=>!this.ListFilter.find(t=>t.id===e.id)),console.log(`Reset filter. Showing ${this.filterSanpham.length} available products`)}EmptyFiter(){this.ListFilter=[],this.updateAvailableProducts(),console.log("Cleared all selected products")}updateAvailableProducts(){console.log("All products are now visible with checkbox states")}CheckItem(e){return!!this.ListFilter.find(t=>t.id===e.id||t.sanphamId===e.id)}ApplyFilterColum(e){this.DetailChotkho.update(t=>(t.details=[...this.ListFilter],t)),this.dataSource.update(t=>(t.data=[...this.ListFilter],t)),e.closeMenu(),console.log("Applied filter. Selected products:",this.ListFilter.length)}applyFilter(e){let t=e.target.value;this.dataSource().filter=t.trim().toLowerCase()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=q({type:o,selectors:[["app-detailchotkho"]],viewQuery:function(t,i){if(t&1&&et(N,5),t&2){let n;it(n=nt())&&(i.sort=n.first)}},decls:12,vars:5,consts:[["picker",""],["menuTrigger","matMenuTrigger"],["menu","matMenu"],["searchInput",""],[1,"flex","flex-row","justify-between","items-center","space-x-2","p-2"],["mat-icon-button","","color","primary",3,"click"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center"],["mat-icon-button","","color","primary",3,"click",4,"ngIf"],[1,"relative","flex","flex-col","w-full","p-4","overflow-auto"],[4,"ngIf"],[1,"flex","flex-col","space-y-4","items-center","justify-center"],[1,"font-bold","text-2xl"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],["class","p-4 rounded-lg mb-4",4,"ngIf"],["class","bg-white p-4 rounded-lg border",4,"ngIf"],[1,"p-4","rounded-lg","mb-4"],[1,"text-lg","font-semibold","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp ti\xEAu \u0111\u1EC1",3,"ngModelChange","ngModel","disabled"],["matInput","","placeholder","Ch\u1ECDn ng\xE0y ch\u1ED1t",3,"ngModelChange","matDatepicker","ngModel","disabled"],["matSuffix","",3,"for"],["appearance","outline","subscriptSizing","dynamic",1,"md:col-span-2"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp ghi ch\xFA","rows","2",3,"ngModelChange","ngModel","disabled"],[1,"bg-white","p-4","rounded-lg","border"],["class","w-full flex flex-col overflow-y-auto mb-4",4,"ngIf"],[1,"w-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[1,"w-full","flex","flex-col","overflow-y-auto","mb-4"],[1,"cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","p-2","bg-white","rounded-lg"],[1,"w-full","flex","flex-row","space-x-2","items-center"],["mat-flat-button","","color","primary",3,"disabled","matMenuTriggerFor"],[1,"cursor-pointer","flex","flex-col","space-y-4","p-3",3,"click"],[1,"bg-blue-50","p-2","rounded-lg"],[1,"text-sm","font-medium","text-blue-800"],[1,"text-xs","text-blue-600"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[1,"flex","flex-row","space-x-2","items-center","justify-between"],[1,"text-xs","text-blue-600","underline",3,"click"],[1,"text-xs","text-red-600","underline",3,"click"],[1,"text-xs","text-green-600","underline",3,"click"],[1,"w-full","flex","flex-col","space-y-2","max-h-44","overflow-auto"],["class","flex flex-row space-x-2 items-center p-2 rounded-lg hover:bg-slate-100 cursor-pointer",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],["class","text-center text-gray-500 p-4",4,"ngIf"],[1,"flex","flex-row","space-x-2","items-end","justify-end"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"keyup"],["matTooltip","L\xE0m Tr\u1ED1ng Gi\u1ECF H\xE0ng","color","warn","mat-icon-button","",3,"click","disabled"],[1,"flex","flex-row","space-x-2","items-center","p-2","rounded-lg","hover:bg-slate-100","cursor-pointer",3,"click"],["class","material-symbols-outlined text-green-600",4,"ngIf"],["class","material-symbols-outlined text-gray-400",4,"ngIf"],[1,"flex","flex-col","flex-1"],[1,"font-medium"],[1,"text-xs","text-gray-500"],[1,"material-symbols-outlined","text-green-600"],[1,"material-symbols-outlined","text-gray-400"],[1,"text-center","text-gray-500","p-4"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"line-clamp-4","me-4"],["mat-cell",""],[1,"max-w-20","line-clamp-4","flex","flex-row","items-center"],[1,"max-w-20","line-clamp-4",3,"class"],[1,"max-w-40","line-clamp-4"],[1,"max-w-20","line-clamp-4"],["mat-icon-button","","color","warn",3,"click","disabled"],["class","sltonthucte-input p-2 min-w-28 bg-slate-200 focus:border rounded-lg focus:border-blue-600 focus:bg-slate-100 focus:outline-none cursor-text",3,"contentEditable","blur","keydown.enter",4,"ngIf"],["class","max-w-20 line-clamp-4",4,"ngIf"],[1,"sltonthucte-input","p-2","min-w-28","bg-slate-200","focus:border","rounded-lg","focus:border-blue-600","focus:bg-slate-100","focus:outline-none","cursor-text",3,"blur","keydown.enter","contentEditable"],["class","slhuy-input p-2 min-w-28 bg-slate-200 focus:border rounded-lg focus:border-blue-600 focus:bg-slate-100 focus:outline-none cursor-text",3,"contentEditable","blur","keydown.enter",4,"ngIf"],[1,"slhuy-input","p-2","min-w-28","bg-slate-200","focus:border","rounded-lg","focus:border-blue-600","focus:bg-slate-100","focus:outline-none","cursor-text",3,"blur","keydown.enter","contentEditable"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","8",1,"mat-cell","p-4"]],template:function(t,i){if(t&1&&(a(0,"div",4)(1,"button",5),C("click",function(){return i.goBack()}),a(2,"mat-icon"),h(3,"arrow_back"),r()(),a(4,"div",6),h(5),r(),a(6,"div",7),x(7,re,3,0,"button",8)(8,le,3,0,"button",8),r()(),a(9,"div",9),x(10,se,9,0,"ng-container",10)(11,Be,3,2,"ng-container",10),r()),t&2){let n;c(5),R(((n=i.DetailChotkho())==null?null:n.title)||"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),c(2),_("ngIf",i.isEdit()),c(),_("ngIf",!i.isEdit()),c(2),_("ngIf",i.isDelete()),c(),_("ngIf",!i.isDelete())}},dependencies:[Et,O,K,wt,St,Q,yt,xt,kt,vt,pt,j,mt,H,W,It,bt,Ut,Ot,Qt,qt,dt,jt,Lt,At,$t,Pt,Vt,Rt,Bt,Nt,zt,Ht,Wt,Mt,N,Ft,gt,ct,z,st,Gt],encapsulation:2})};export{Zt as DetailChotkhoComponent};
