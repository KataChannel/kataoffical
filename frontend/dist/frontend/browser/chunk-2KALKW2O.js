import{a as be,b as De}from"./chunk-TCBSMOK3.js";import{a as ke}from"./chunk-VTCQHFRM.js";import{a as Se}from"./chunk-FTKNQGOP.js";import{a as we}from"./chunk-JC7PYKG2.js";import{a as ge}from"./chunk-KYG2MM6K.js";import{a as O,b as Xt,c as N,d as Zt,e as Ut}from"./chunk-MRBSEOP3.js";import{b as Rt,d as Ht,e as Kt}from"./chunk-6FM7CICS.js";import{a as jt}from"./chunk-4ZPPZFHT.js";import{a as Qt}from"./chunk-ZW44ZSN2.js";import{a as St,b as wt,c as kt}from"./chunk-MGORUWWK.js";import{a as Et,b as Tt,c as Vt,d as Mt}from"./chunk-HQSQA26E.js";import"./chunk-H7UDLENL.js";import{a as A,b as vt}from"./chunk-OAFQYKWM.js";import{c as ue,g as he}from"./chunk-35TLWMLN.js";import{a as Ce,b as ve}from"./chunk-SP7LNQFP.js";import"./chunk-MN5KTOWK.js";import{a as _e,b as fe,c as xe,k as ye}from"./chunk-IHZF43U3.js";import{a as Jt,b as Wt,c as Yt,d as te,e as ee,g as ne,h as ie,j as ae,k as re,m as oe,n as se,p as le,q as ce,r as me,s as de}from"./chunk-EK5OIXPS.js";import{b as zt}from"./chunk-KC2JAF6W.js";import{b as Ft,g as Lt,j as It,n as Pt,p as Bt,r as Gt,s as qt,v as $t,w as At,y as Ot,z as Nt}from"./chunk-6K5ZWVAI.js";import"./chunk-P7TAF5VE.js";import"./chunk-DLQCLWBK.js";import"./chunk-V4FVBF4X.js";import"./chunk-2PPFUFFT.js";import{a as pe}from"./chunk-JNVUT6FC.js";import{a as bt,b as Dt}from"./chunk-T32LGCQW.js";import{a as xt,c as yt,e as Ct}from"./chunk-W4JKNNWY.js";import{y as _t,z as ft}from"./chunk-KEABJZ6V.js";import{b as gt,c as $}from"./chunk-QARTICIP.js";import"./chunk-U2MVCEOQ.js";import{k as ct,l as mt,m as dt,r as pt,t as ut,v as ht}from"./chunk-4ACAQHLL.js";import{$b as P,Cc as F,Db as tt,Dc as m,Ec as E,Fc as y,Ic as Q,Jc as j,Kb as v,Kc as J,Mc as W,Nc as ot,Ra as C,Rc as st,Sc as w,Tb as et,Ub as p,Uc as k,Yb as nt,bc as it,cc as H,dc as K,ec as r,fc as o,gc as S,hc as at,ic as rt,ja as Y,jd as lt,kc as M,pa as x,pc as f,rb as c,rc as s,xc as B,ya as h,yc as G,za as g,zc as q}from"./chunk-52B2MLDA.js";import"./chunk-LWLSKGAV.js";import{a as V,b as I,g as U,h as R,j as _}from"./chunk-6DYNGEAS.js";var X=U(pe());var z=class a{_GraphqlService=x(we);_StorageService=x(vt);_router=x($);_snackBar=x(A);_ErrorLogService=x(jt);_sharedSocketService=x(Se);socket;ListDonhang=C([]);ListVandon=C([]);DetailDonhang=C({});page=C(1);totalPages=C(1);total=C(0);pageSize=C(50);donhangId=C(null);loading=C(!1);error=C(null);constructor(){this.socket=this._sharedSocketService.getSocket(),this.socket?.on("donhang:updated",e=>{this.refreshDonhangData()})}setDonhangId(e){this.donhangId.set(e),e&&this.getOneDonhang(e)}searchDonhang(e){return _(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let t={};e.Batdau&&e.Ketthuc&&(t.ngaygiao={gte:(0,X.default)(e.Batdau).startOf("day").toISOString(),lte:(0,X.default)(e.Ketthuc).endOf("day").toISOString()}),e.Status&&(t.status=e.Status);let n=yield this._GraphqlService.findMany("donhang",{where:t,include:{khachhang:{select:{id:!0,name:!0,sdt:!0,diachi:!0}},sanpham:{select:{id:!0,idSP:!0,sldat:!0,slgiao:!0,slnhan:!0,slhuy:!0,ttdat:!0,ttgiao:!0,ttnhan:!0,ghichu:!0,order:!0,isActive:!0,giaban:!0,ttsauvat:!0,vat:!0,sanpham:{select:{id:!0,masp:!0,title:!0,giagoc:!0,dvt:!0}}}}},orderBy:{createdAt:"desc"},take:e.pageSize||9999});this.ListDonhang.set(n||[]);let i=this.createVandonList(n||[]);return this.ListVandon.set(i),this.loading.set(!1),n}catch(t){throw this.error.set(t.message||"L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u \u0111\u01A1n h\xE0ng"),this.loading.set(!1),yield this._ErrorLogService.logError(`L\u1ED7i t\xECm ki\u1EBFm \u0111\u01A1n h\xE0ng GraphQL: ${t.message||t}`),t}})}createVandonList(e){return e.flatMap((t,n)=>(t.sanpham||[]).map(i=>({id:i.id,idSP:i.idSP,sldat:i.sldat,slgiao:i.slgiao,slnhan:i.slnhan,slhuy:i.slhuy,ttdat:i.ttdat,ttgiao:i.ttgiao,ttnhan:i.ttnhan,ghichu:i.ghichu,order:i.order,isActive:i.isActive,giaban:i.giaban,ttsauvat:i.ttsauvat,vat:i.vat,masp:i.sanpham?.masp,title:i.sanpham?.title,giagoc:i.sanpham?.giagoc,dvt:i.sanpham?.dvt,madonhang:t.madonhang,khachhang:t.khachhang?.name,sdt:t.khachhang?.sdt,diachi:t.khachhang?.diachi,createdAt:t.createdAt,ngaygiao:t.ngaygiao,status:t.status}))).map((t,n)=>I(V({},t),{stt:n+1}))}getOneDonhang(e){return _(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let t=yield this._GraphqlService.findUnique("donhang",{id:e},{include:{khachhang:{select:{id:!0,name:!0,sdt:!0,diachi:!0,email:!0}},sanpham:{select:{id:!0,idSP:!0,sldat:!0,slgiao:!0,slnhan:!0,slhuy:!0,ttdat:!0,ttgiao:!0,ttnhan:!0,ghichu:!0,order:!0,isActive:!0,giaban:!0,ttsauvat:!0,vat:!0,sanpham:{select:{id:!0,masp:!0,title:!0,giagoc:!0,dvt:!0}}}},user:{select:{id:!0,email:!0,profile:{select:{name:!0}}}}}});return this.DetailDonhang.set(t||{}),this.loading.set(!1),t}catch(t){throw this.error.set(t.message||"L\u1ED7i khi t\u1EA3i chi ti\u1EBFt \u0111\u01A1n h\xE0ng"),this.loading.set(!1),yield this._ErrorLogService.logError(`L\u1ED7i l\u1EA5y chi ti\u1EBFt \u0111\u01A1n h\xE0ng GraphQL: ${t.message||t}`),t}})}CreateDonhang(e){return _(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let t={madonhang:e.madonhang||this.generateMaDonhang(),status:e.status||"dadat",tongtien:e.tongtien||0,khachhangId:e.khachhangId,ngaygiao:e.ngaygiao?new Date(e.ngaygiao).toISOString():null,ghichu:e.ghichu||"",order:e.order||1,isActive:e.isActive!==void 0?e.isActive:!0},n=yield this._GraphqlService.createOne("donhang",t);return yield this.refreshDonhangData(),this._snackBar.open("T\u1EA1o \u0111\u01A1n h\xE0ng th\xE0nh c\xF4ng","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.loading.set(!1),n}catch(t){throw this.error.set(t.message||"L\u1ED7i khi t\u1EA1o \u0111\u01A1n h\xE0ng"),this.loading.set(!1),yield this._ErrorLogService.logError(`L\u1ED7i t\u1EA1o \u0111\u01A1n h\xE0ng GraphQL: ${t.message||t}`),this._snackBar.open("L\u1ED7i khi t\u1EA1o \u0111\u01A1n h\xE0ng: "+t.message,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),t}})}updateDonhang(e){return _(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let t={madonhang:e.madonhang,status:e.status,tongtien:e.tongtien,khachhangId:e.khachhangId,ngaygiao:e.ngaygiao?new Date(e.ngaygiao).toISOString():null,ghichu:e.ghichu,order:e.order,isActive:e.isActive},n=yield this._GraphqlService.updateOne("donhang",{id:e.id},t);return yield this.refreshDonhangData(),this._snackBar.open("C\u1EADp nh\u1EADt \u0111\u01A1n h\xE0ng th\xE0nh c\xF4ng","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.loading.set(!1),n}catch(t){throw this.error.set(t.message||"L\u1ED7i khi c\u1EADp nh\u1EADt \u0111\u01A1n h\xE0ng"),this.loading.set(!1),yield this._ErrorLogService.logError(`L\u1ED7i c\u1EADp nh\u1EADt \u0111\u01A1n h\xE0ng GraphQL: ${t.message||t}`),this._snackBar.open("L\u1ED7i khi c\u1EADp nh\u1EADt \u0111\u01A1n h\xE0ng: "+t.message,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),t}})}deleteDonhang(e){return _(this,null,function*(){try{this.loading.set(!0),this.error.set(null),yield this._GraphqlService.deleteOne("donhang",{id:e}),yield this.refreshDonhangData(),this._snackBar.open("X\xF3a \u0111\u01A1n h\xE0ng th\xE0nh c\xF4ng","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.loading.set(!1)}catch(t){throw this.error.set(t.message||"L\u1ED7i khi x\xF3a \u0111\u01A1n h\xE0ng"),this.loading.set(!1),yield this._ErrorLogService.logError(`L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng GraphQL: ${t.message||t}`),this._snackBar.open("L\u1ED7i khi x\xF3a \u0111\u01A1n h\xE0ng: "+t.message,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),t}})}refreshDonhangData(){return _(this,null,function*(){this.ListDonhang().length>0&&(yield this.searchDonhang({pageSize:9999}))})}generateMaDonhang(){let e=new Date().getTime(),t=Math.floor(Math.random()*1e3);return`DH${e}${t}`}exportVandonToExcel(e){return _(this,null,function*(){try{let t=e||this.ListVandon();if(t.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let n=t.map((d,b)=>({STT:b+1,"M\xE3 \u0110\u01A1n H\xE0ng":d.madonhang||"","Kh\xE1ch H\xE0ng":d.khachhang||"","T\xEAn S\u1EA3n Ph\u1EA9m":d.title||"","\u0110\u01A1n V\u1ECB T\xEDnh":d.dvt||"","SL \u0110\u1EB7t":d.sldat||0,"SL Giao":d.slgiao||0,"SL Nh\u1EADn":d.slnhan||0,"Ng\xE0y Giao":d.ngaygiao?new Date(d.ngaygiao).toLocaleDateString("vi-VN"):"","Tr\u1EA1ng Th\xE1i":this.getStatusLabel(d.status)||""})),{writeExcelFile:i}=yield import("./chunk-3EJRJTVC.js"),l=`VanDon_${new Date().toISOString().slice(0,10)}`;i(n,l),this._snackBar.open("Xu\u1EA5t Excel th\xE0nh c\xF4ng","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(t){yield this._ErrorLogService.logError(`L\u1ED7i xu\u1EA5t Excel v\u1EADn \u0111\u01A1n: ${t.message||t}`),this._snackBar.open("L\u1ED7i khi xu\u1EA5t Excel: "+t.message,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}getStatusLabel(e){return{dadat:"\u0110\xE3 \u0110\u1EB7t",dagiao:"\u0110\xE3 Giao",danhan:"\u0110\xE3 Nh\u1EADn",hoanthanh:"Ho\xE0n Th\xE0nh",huy:"H\u1EE7y"}[e]||e}getStatistics(e){return _(this,null,function*(){try{let t={};e?.Batdau&&e?.Ketthuc&&(t.createdAt={gte:new Date(e.Batdau).toISOString(),lte:new Date(e.Ketthuc).toISOString()});let n=yield this._GraphqlService.findMany("donhang",{where:t,select:{id:!0}}),i=yield this._GraphqlService.findMany("donhang",{where:I(V({},t),{status:"hoanthanh"}),select:{id:!0}}),l=yield this._GraphqlService.findMany("donhang",{where:I(V({},t),{status:"huy"}),select:{id:!0}});return{total:n?.length||0,completed:i?.length||0,cancelled:l?.length||0,pending:(n?.length||0)-(i?.length||0)-(l?.length||0)}}catch(t){return console.error("Error getting statistics:",t),{total:0,completed:0,cancelled:0,pending:0}}})}quickSearch(e){return _(this,null,function*(){try{this.loading.set(!0);let t=yield this._GraphqlService.findMany("donhang",{where:{OR:[{madonhang:{contains:e,mode:"insensitive"}},{khachhang:{name:{contains:e,mode:"insensitive"}}},{khachhang:{sdt:{contains:e}}}]},include:{khachhang:{select:{id:!0,name:!0,sdt:!0,diachi:!0}},sanpham:{select:{id:!0,idSP:!0,sldat:!0,slgiao:!0,slnhan:!0,slhuy:!0,ttdat:!0,ttgiao:!0,ttnhan:!0,ghichu:!0,order:!0,isActive:!0,giaban:!0,ttsauvat:!0,vat:!0,sanpham:{select:{id:!0,masp:!0,title:!0,giagoc:!0,dvt:!0}}}}},orderBy:{createdAt:"desc"},take:100});this.ListDonhang.set(t||[]);let n=this.createVandonList(t||[]);return this.ListVandon.set(n),this.loading.set(!1),t}catch(t){throw this.error.set(t.message||"L\u1ED7i khi t\xECm ki\u1EBFm"),this.loading.set(!1),t}})}static \u0275fac=function(t){return new(t||a)};static \u0275prov=Y({token:a,factory:a.\u0275fac,providedIn:"root"})};var Z=U(pe());var Le=["drawer"],Ee=()=>({standalone:!0}),Ie=a=>[50,100,a],Pe=(a,e,t,n,i)=>({"text-blue-500":a,"text-yellow-500":e,"text-green-500":t,"text-purple-500":n,"text-red-500":i}),Be=(a,e)=>e.key;function Ge(a,e){a&1&&S(0,"mat-progress-bar",25)}function qe(a,e){if(a&1&&(r(0,"div",26)(1,"span",27),m(2,"L\u1ED7i:"),o(),m(3),o()),a&2){let t=s();c(3),y(" ",t.error()," ")}}function $e(a,e){if(a&1){let t=M();r(0,"button",42),f("click",function(i){let l=h(t).$implicit;return s(2).toggleColumn(l),g(i.stopPropagation())}),r(1,"mat-icon"),m(2),o(),r(3,"span"),m(4),o()()}if(a&2){let t=e.$implicit;c(2),E(t.isShow?"check_box":"check_box_outline_blank"),c(2),E(t.value)}}function Ae(a,e){a&1&&(r(0,"span",43),m(1,"(\u0110ang t\u1EA3i...)"),o())}function Oe(a,e){if(a&1){let t=M();r(0,"div",28)(1,"div",29)(2,"button",30)(3,"mat-icon"),m(4,"tune"),o()(),r(5,"mat-menu",null,3)(7,"div",31)(8,"mat-form-field",32)(9,"input",33),f("input",function(i){h(t);let l=s();return g(l.doFilterColumns(i))})("click",function(i){return h(t),g(i.stopPropagation())}),o(),r(10,"mat-icon",34),m(11,"search"),o()()(),r(12,"div",35),H(13,$e,5,2,"button",36,Be),o()(),r(15,"button",37),f("click",function(){h(t);let i=s();return g(i.isSearch=!i.isSearch)}),r(16,"mat-icon"),m(17,"search"),o()(),r(18,"button",38),f("click",function(){h(t);let i=s();return g(i.exportVandonToExcel())}),r(19,"mat-icon"),m(20,"file_download"),o()(),r(21,"input",39,4),f("change",function(i){h(t);let l=s();return g(l.ImporExcel(i))}),o(),r(23,"span",40),m(24),v(25,Ae,2,0,"span",41),o()()()}if(a&2){let t=F(6),n=s();c(2),p("matMenuTriggerFor",t),c(11),K(n.FilterColumns),c(5),p("disabled",n.loading()),c(6),y(" ",n.CountItem," \u0110\u01A1n H\xE0ng "),c(),p("ngIf",n.loading())}}function Ne(a,e){if(a&1){let t=M();r(0,"div",44)(1,"mat-form-field",32)(2,"mat-label"),m(3,"T\xECm Ki\u1EBFm"),o(),r(4,"input",45),f("keyup",function(i){h(t);let l=s();return g(l.applyFilter(i))}),o()(),r(5,"button",46),f("click",function(){h(t);let i=s();return g(i.isSearch=!i.isSearch)}),r(6,"mat-icon"),m(7,"cancel"),o()()()}}function ze(a,e){a&1&&(r(0,"div",47)(1,"div",48),S(2,"mat-spinner",49),r(3,"p",50),m(4,"\u0110ang t\u1EA3i d\u1EEF li\u1EC7u..."),o()()())}function Re(a,e){a&1&&(r(0,"span",70),m(1,"check"),o())}function He(a,e){if(a&1&&(r(0,"span"),m(1),w(2,"date"),o()),a&2){let t=s().$implicit,n=s(2).$implicit;c(),E(k(2,1,t[n],"dd/MM/yyyy"))}}function Ke(a,e){if(a&1&&(r(0,"span"),m(1),w(2,"number"),o()),a&2){let t=s().$implicit,n=s(2).$implicit;c(),E(k(2,1,t[n],"1.0-2"))}}function Qe(a,e){if(a&1&&(r(0,"span"),m(1),w(2,"number"),o()),a&2){let t=s().$implicit,n=s(2).$implicit;c(),E(k(2,1,t[n],"1.0-2"))}}function je(a,e){if(a&1&&(r(0,"span"),m(1),w(2,"number"),o()),a&2){let t=s().$implicit,n=s(2).$implicit;c(),E(k(2,1,t[n],"1.0-2"))}}function Je(a,e){if(a&1&&(r(0,"span"),m(1),o()),a&2){let t=s().$implicit,n=s(2).$implicit,i=s();c(),E(i.Trangthaidon[t[n]]||t[n])}}function We(a,e){if(a&1&&(r(0,"span"),m(1),o()),a&2){let t=s().$implicit,n=s(2).$implicit;c(),y(" ",t[n]||"Tr\u1ED1ng","")}}function Xe(a,e){if(a&1){let t=M();r(0,"div",68),f("click",function(){let i=h(t).$implicit,l=s(2).$implicit,d=s();return g(d.ChosenItem(i,l))}),v(1,Re,2,0,"span",69)(2,He,3,4,"span")(3,Ke,3,4,"span")(4,Qe,3,4,"span")(5,je,3,4,"span")(6,Je,2,1,"span")(7,We,2,1,"span"),o()}if(a&2){let t,n=e.$implicit,i=s(2).$implicit,l=s();c(),p("ngIf",l.CheckItem(n)),c(),P((t=i)==="ngaygiao"?2:t==="sldat"?3:t==="slgiao"?4:t==="slnhan"?5:t==="status"?6:7)}}function Ze(a,e){if(a&1){let t=M();r(0,"th",53)(1,"span",54),m(2),o(),r(3,"span",55,5),m(5," filter_alt "),o(),r(6,"mat-menu",null,3)(8,"div",56),f("click",function(i){return h(t),g(i.stopPropagation())}),r(9,"div",57)(10,"input",58),f("keyup",function(i){h(t);let l=s().$implicit,d=s();return g(d.doFilterHederColumn(i,l))}),o(),r(11,"div",59)(12,"span",60),m(13,"search"),o()()(),r(14,"div",61)(15,"div",29)(16,"span",62),f("click",function(){h(t);let i=s().$implicit,l=s();return g(l.ChosenAll(l.FilterHederColumn(l.dataSource().filteredData,i)))}),m(17),o(),r(18,"span",62),f("click",function(){h(t);let i=s(2);return g(i.EmptyFiter())}),m(19,"Xo\xE1"),o()(),r(20,"span",62),f("click",function(){h(t);let i=s(2);return g(i.ResetFilter())}),m(21,"Reset"),o()(),r(22,"div",63),v(23,Xe,8,2,"div",64),o(),r(24,"div",65)(25,"button",66),f("click",function(){h(t);let i=F(4);return g(i.closeMenu())}),m(26,"\u0110\xF3ng"),o(),r(27,"button",67),f("click",function(){h(t);let i=F(4),l=s(2);return g(l.ApplyFilterColum(i))}),m(28,"\xC1p D\u1EE5ng"),o()()()()()}if(a&2){let t=F(7),n=s().$implicit,i=s();c(2),y(" ",i.ColumnName[n]," "),c(),p("matMenuTriggerFor",t),c(14),y("Ch\u1ECDn T\u1EA5t C\u1EA3 ",i.FilterHederColumn(i.dataSource().filteredData,n).length||0,""),c(6),p("ngForOf",i.FilterHederColumn(i.dataSource().filteredData,n))("ngForTrackBy",i.trackByFn)}}function Ue(a,e){if(a&1&&(r(0,"span",72),m(1),o()),a&2){let t=s().index;c(),y(" ",t+1," ")}}function Ye(a,e){if(a&1&&(r(0,"span",72),m(1),w(2,"date"),o()),a&2){let t=s().$implicit,n=s().$implicit;c(),y(" ",k(2,1,t[n],"dd/MM/yyyy")," ")}}function tn(a,e){if(a&1&&(r(0,"span",73),m(1),o()),a&2){let t=s().$implicit,n=s().$implicit,i=s();p("ngClass",st(2,Pe,t[n]==="dadat",t[n]==="dagiao",t[n]==="danhan",t[n]==="hoanthanh",t[n]==="huy")),c(),y(" ",i.Trangthaidon[t[n]]," ")}}function en(a,e){if(a&1&&(r(0,"span",74),m(1),w(2,"number"),o()),a&2){let t=s().$implicit,n=s().$implicit;c(),y(" ",k(2,1,t[n],"1.0-2")," ")}}function nn(a,e){if(a&1&&(r(0,"span",75),m(1),w(2,"number"),o()),a&2){let t=s().$implicit,n=s().$implicit;c(),y(" ",k(2,1,t[n],"1.0-2")," ")}}function an(a,e){if(a&1&&(r(0,"span",76),m(1),w(2,"number"),o()),a&2){let t=s().$implicit,n=s().$implicit;c(),y(" ",k(2,1,t[n],"1.0-2")," ")}}function rn(a,e){if(a&1&&(r(0,"span",72),m(1),o()),a&2){let t=s().$implicit,n=s().$implicit;c(),y(" ",t[n]," ")}}function on(a,e){if(a&1&&(r(0,"td",71),v(1,Ue,2,1,"span",72)(2,Ye,3,4,"span",72)(3,tn,2,8,"span",73)(4,en,3,4,"span",74)(5,nn,3,4,"span",75)(6,an,3,4,"span",76)(7,rn,2,1,"span",72),o()),a&2){let t,n=s().$implicit;c(),P((t=n)==="STT"?1:t==="ngaygiao"?2:t==="status"?3:t==="sldat"?4:t==="slgiao"?5:t==="slnhan"?6:7)}}function sn(a,e){if(a&1&&(at(0,20),v(1,Ze,29,5,"th",51)(2,on,8,1,"td",52),rt()),a&2){let t=e.$implicit;p("matColumnDef",t)}}function ln(a,e){a&1&&S(0,"tr",77)}function cn(a,e){if(a&1&&S(0,"tr",78),a&2){let t=e.$implicit,n=s();nt("hover:bg-slate-100 ",n.donhangId()==t.id?"!bg-slate-200":"",""),et("data-id",t.id)}}function mn(a,e){a&1&&(r(0,"div",81),S(1,"mat-spinner",82),r(2,"p",83),m(3,"\u0110ang t\u1EA3i d\u1EEF li\u1EC7u..."),o()())}function dn(a,e){a&1&&m(0," Kh\xF4ng t\xECm th\u1EA5y ")}function pn(a,e){if(a&1&&(r(0,"tr",79)(1,"td",80),v(2,mn,4,0,"div",81)(3,dn,1,0),o()()),a&2){let t=s();c(2),P(t.loading()?2:3)}}var L=class L{Detail={};displayedColumns=["madonhang","khachhang","title","dvt","sldat","slgiao","slnhan","ngaygiao","status"];ColumnName={madonhang:"M\xE3 \u0110\u01A1n H\xE0ng",khachhang:"Kh\xE1ch H\xE0ng",diachi:"\u0110\u1ECBa Ch\u1EC9",sdt:"S\u1ED1 \u0110i\u1EC7n Tho\u1EA1i",status:"Tr\u1EA1ng Th\xE1i",masp:"M\xE3 S\u1EA3n Ph\u1EA9m",title:"T\xEAn S\u1EA3n Ph\u1EA9m",giagoc:"Gi\xE1 G\u1ED1c",giaban:"Gi\xE1 B\xE1n",dvt:"\u0110\u01A1n V\u1ECB T\xEDnh",sldat:"SL \u0110\u1EB7t",slgiao:"SL Giao",slnhan:"SL Nh\u1EADn",slhuy:"SL H\u1EE7y",ttdat:"TT \u0110\u1EB7t",ttgiao:"TT Giao",ttnhan:"TT Nh\u1EADn",ttsauvat:"TT Sau VAT",vat:"VAT (%)",order:"Th\u1EE9 T\u1EF1",ghichu:"Ghi Ch\xFA",ngaygiao:"Ng\xE0y Giao"};FilterColumns=JSON.parse(localStorage.getItem("VandonColFilter")||"[]");Columns=[];Trangthaidon=ke;isFilter=!1;paginator;sort;drawer;filterValues={};_DonhangGraphqlService=x(z);_breakpointObserver=x(_t);_GoogleSheetService=x(ge);_router=x($);_snackBar=x(A);dataSource=lt(()=>{let e=new de(this.Listvandon);return e.filterPredicate=this.createFilter(),this.sort&&(e.sort=this.sort),e});donhangId=this._DonhangGraphqlService.donhangId;loading=this._DonhangGraphqlService.loading;error=this._DonhangGraphqlService.error;CountItem=0;SearchParams={Batdau:(0,Z.default)().toDate(),Ketthuc:(0,Z.default)().toDate(),pageSize:9999};ListDate=[{id:1,Title:"1 Ng\xE0y",value:"day"},{id:2,Title:"1 Tu\u1EA7n",value:"week"},{id:3,Title:"1 Th\xE1ng",value:"month"},{id:4,Title:"1 N\u0103m",value:"year"}];Chonthoigian="day";isSearch=!1;constructor(){this.displayedColumns.forEach(e=>{this.filterValues[e]=""})}get Listvandon(){return this._DonhangGraphqlService.ListVandon()}onSelectionChange(e){this.ngOnInit()}onDateChange(e){this.ngOnInit()}createFilter(){return(e,t)=>{let n=JSON.parse(t),i=!0;return this.displayedColumns.forEach(l=>{if(n[l]){let d=e[l]?e[l].toString().toLowerCase():"";i=i&&d.includes(n[l].toLowerCase())}}),i}}applyFilter(e){let t=e.target.value;this.dataSource().filter=t.trim().toLowerCase(),this.dataSource().paginator&&this.dataSource()?.paginator?.firstPage()}ngOnInit(){return _(this,null,function*(){try{this.initializeColumns(),this.setupDrawer(),setTimeout(()=>_(this,null,function*(){yield this._DonhangGraphqlService.searchDonhang(this.SearchParams),this.CountItem=this._DonhangGraphqlService.ListDonhang().length,requestAnimationFrame(()=>{let e=this.dataSource();e.data=this.Listvandon,e.paginator=this.paginator,this.paginator._intl.itemsPerPageLabel="S\u1ED1 l\u01B0\u1EE3ng 1 trang",this.paginator._intl.nextPageLabel="Ti\u1EBFp Theo",this.paginator._intl.previousPageLabel="V\u1EC1 Tr\u01B0\u1EDBc",this.paginator._intl.firstPageLabel="Trang \u0110\u1EA7u",this.paginator._intl.lastPageLabel="Trang Cu\u1ED1i"})}),0)}catch(e){console.error("L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u:",e)}})}refresh(){return _(this,null,function*(){yield this._DonhangGraphqlService.searchDonhang(this.SearchParams)})}initializeColumns(){let e=["madonhang","khachhang","title","dvt","sldat","slgiao","slnhan","ngaygiao","status"];this.Columns=e.map(t=>({key:t,value:this.ColumnName[t],isShow:this.displayedColumns.includes(t)})),this.FilterColumns.length===0?this.FilterColumns=this.Columns:(this.FilterColumns=this.FilterColumns.filter(t=>e.includes(t.key)),localStorage.setItem("VandonColFilter",JSON.stringify(this.FilterColumns))),this.displayedColumns=this.FilterColumns.filter(t=>t.isShow).map(t=>t.key),this.ColumnName=this.FilterColumns.reduce((t,n)=>(n.isShow&&(t[n.key]=n.value),t),{})}setupDrawer(){this._breakpointObserver.observe([ft.Handset]).subscribe(e=>{e.matches?(this.drawer.mode="over",this.paginator.hidePageSize=!0):this.drawer.mode="side"})}toggleColumn(e){let t=this.FilterColumns.find(n=>n.key===e.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("VandonColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(n=>n.value.toLowerCase().includes(t))}LoadDrive(){return _(this,null,function*(){let e={IdSheet:"15npo25qyH5FmfcEjl1uyqqyFMS_vdFnmxM_kt0KYmZk",SheetName:"SPImport",ApiKey:"AIzaSyD33kgZJKdFpv1JrKHacjCQccL_O0a2Eao"},t=yield this._GoogleSheetService.getDrive(e),n=Rt(t.values);console.log(n),this.DoImportData(n)})}DoImportData(e){console.log(e);let n=e.map(u=>({title:u.title?.trim()||"",masp:u.masp?.trim()||"",slug:`${Ht(u?.title?.trim()||"")}_${Kt(5,!1)}`,giagoc:Number(u.giagoc)||0,dvt:u.dvt||"",soluong:Number(u.soluong)||0,soluongkho:Number(u.soluongkho)||0,ghichu:u.ghichu||"",order:Number(u.order)||0})).filter((u,D,T)=>D===T.findIndex(Me=>Me.masp===u.masp)),i=n.map(u=>u.masp),l=this._DonhangGraphqlService.ListDonhang().map(u=>u.masp),d=i.filter(u=>!l.includes(u)),b=n.map(u=>_(this,null,function*(){let D=this._DonhangGraphqlService.ListDonhang().find(T=>T.masp===u.masp);if(D){let T=V(V({},D),u);yield this._DonhangGraphqlService.updateDonhang(T)}else yield this._DonhangGraphqlService.CreateDonhang(u)})),Ve=d.map(u=>_(this,null,function*(){let D=this._DonhangGraphqlService.ListDonhang().find(T=>T.masp===u);D&&(D.isActive=!1,yield this._DonhangGraphqlService.updateDonhang(D))}));Promise.all([...b,...Ve]).then(()=>{this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ImporExcel(e){return _(this,null,function*(){let t=yield he(e);this.DoImportData(t)})}ExportExcel(e,t){ue(e,t)}exportVandonToExcel(){return _(this,null,function*(){yield this._DonhangGraphqlService.exportVandonToExcel(this.dataSource().filteredData||this.Listvandon)})}exportAllToExcel(){return _(this,null,function*(){yield this._DonhangGraphqlService.exportVandonToExcel()})}FilterHederColumn(e,t){return!e||e.length===0?[]:e.filter((i,l,d)=>l===d.findIndex(b=>b[t]===i[t])).slice(0,100)}doFilterHederColumn(e,t){if(!this.Listvandon||this.Listvandon.length===0)return;let n=e.target.value.toLowerCase();n.length<2&&n.length>0||requestAnimationFrame(()=>{this.dataSource().filteredData=this.Listvandon.filter(i=>Qt(i[t]||"").toLowerCase().includes(n)||(i[t]||"").toString().toLowerCase().includes(n))})}trackByFn(e,t){return t.id}ListFilter=[];ChosenItem(e,t){if(!this.dataSource().filteredData)return;let n=this.dataSource().filteredData.filter(l=>l[t]===e[t]);this.ListFilter.filter(l=>l[t]===e[t]).length>0?this.ListFilter=this.ListFilter.filter(l=>l[t]!==e[t]):this.ListFilter=[...this.ListFilter,...n]}ChosenAll(e){e&&e.forEach(t=>{!!this.ListFilter.find(i=>i.id===t.id)?this.ListFilter=this.ListFilter.filter(i=>i.id!==t.id):this.ListFilter.push(t)})}ResetFilter(){this.ListFilter=this.Listvandon||[],this.dataSource().data=this.Listvandon||[],this.dataSource().sort=this.sort}EmptyFiter(){this.ListFilter=[]}CheckItem(e){return!!this.ListFilter.find(t=>t.id===e.id)}ApplyFilterColum(e){this.ListFilter.length===0?this.dataSource().data=[]:this.dataSource().data=this.Listvandon.filter(t=>this.ListFilter.some(n=>n.id===t.id)),this.dataSource().sort=this.sort,e.closeMenu()}static \u0275fac=function(t){return new(t||L)};static \u0275cmp=tt({type:L,selectors:[["app-vandon"]],viewQuery:function(t,n){if(t&1&&(B(O,5),B(N,5),B(Le,7)),t&2){let i;G(i=q())&&(n.paginator=i.first),G(i=q())&&(n.sort=i.first),G(i=q())&&(n.drawer=i.first)}},decls:33,vars:27,consts:[["drawer",""],["pickerBatdau",""],["pickerKetthuc",""],["menu","matMenu"],["uploadfile",""],["menuTrigger","matMenuTrigger"],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-12","w-full","p-2"],["mode","indeterminate","color","primary",4,"ngIf"],["class","bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",4,"ngIf"],["class","cursor-pointer w-full relative flex lg:flex-row lg:space-y-2 space-y-0 flex-col space-x-2 justify-between items-center p-2 bg-white rounded-lg",4,"ngIf"],["class","py-2 w-full flex flex-row space-x-2 items-center",4,"ngIf"],[1,"w-full","grid","lg:grid-cols-4","grid-cols-2","gap-2","items-center"],[3,"appearance","subscriptSizing"],["matInput","",3,"dateChange","ngModelChange","matDatepicker","ngModel","ngModelOptions"],["matIconSuffix","",3,"for"],[1,"w-full","overflow-auto","relative"],["class","absolute inset-0 bg-white bg-opacity-75 z-10 flex items-center justify-center",4,"ngIf"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"class",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSizeOptions","pageSize"],["mode","indeterminate","color","primary"],[1,"bg-red-100","border","border-red-400","text-red-700","px-4","py-3","rounded","mb-4"],[1,"font-bold"],[1,"cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","p-2","bg-white","rounded-lg"],[1,"flex","flex-row","space-x-2","items-center"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["matTooltip","T\xECm Ki\u1EBFm","color","primary","mat-icon-button","",3,"click"],["matTooltip","Xu\u1EA5t Excel (D\u1EEF li\u1EC7u hi\u1EC3n th\u1ECB)","mat-icon-button","","color","accent",3,"click","disabled"],["type","file",1,"hidden",3,"change"],[1,"lg:flex","hidden","whitespace-nowrap","p-2","rounded-lg","bg-slate-200"],["class","ml-2 animate-pulse text-blue-600",4,"ngIf"],["mat-menu-item","",3,"click"],[1,"ml-2","animate-pulse","text-blue-600"],[1,"py-2","w-full","flex","flex-row","space-x-2","items-center"],["matInput","","placeholder","Vui l\xF2ng T\xECm Ki\u1EBFm",3,"keyup"],["mat-icon-button","","color","warn",3,"click"],[1,"absolute","inset-0","bg-white","bg-opacity-75","z-10","flex","items-center","justify-center"],[1,"text-center"],["diameter","40"],[1,"mt-2","text-gray-600"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"max-w-40","line-clamp-4","me-4"],[1,"z-10","material-symbols-outlined","text-gray-500",3,"matMenuTriggerFor"],[1,"cursor-pointer","flex","flex-col","space-y-4","p-3",3,"click"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[1,"flex","flex-row","space-x-2","items-center","justify-between"],[1,"text-xs","text-blue-600","underline",3,"click"],[1,"w-full","flex","flex-col","space-y-2","max-h-44","overflow-auto"],["class","flex flex-row space-x-2 items-center p-2 rounded-lg hover:bg-slate-100",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-row","space-x-2","items-end","justify-end"],["mat-flat-button","","color","warn",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"flex","flex-row","space-x-2","items-center","p-2","rounded-lg","hover:bg-slate-100",3,"click"],["class","material-symbols-outlined text-blue-600",4,"ngIf"],[1,"material-symbols-outlined","text-blue-600"],["mat-cell",""],[1,"max-w-40","line-clamp-4"],[1,"max-w-40","line-clamp-4","font-bold",3,"ngClass"],[1,"max-w-40","line-clamp-4","text-right","text-blue-600"],[1,"max-w-40","line-clamp-4","text-right","text-orange-600"],[1,"max-w-40","line-clamp-4","text-right","text-green-600"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell","p-4"],[1,"text-center","py-4"],["diameter","30"],[1,"mt-2"]],template:function(t,n){if(t&1){let i=M();r(0,"mat-drawer-container",6)(1,"mat-drawer",7,0),S(3,"router-outlet"),o(),r(4,"div",8),v(5,Ge,1,0,"mat-progress-bar",9)(6,qe,4,1,"div",10)(7,Oe,26,4,"div",11)(8,Ne,8,0,"div",12),r(9,"div",13)(10,"mat-form-field",14)(11,"mat-label"),m(12,"B\u1EAFt \u0110\u1EA7u"),o(),r(13,"input",15),f("dateChange",function(d){return h(i),g(n.onDateChange(d))}),J("ngModelChange",function(d){return h(i),j(n.SearchParams.Batdau,d)||(n.SearchParams.Batdau=d),g(d)}),o(),S(14,"mat-datepicker-toggle",16)(15,"mat-datepicker",null,1),o(),r(17,"mat-form-field",14)(18,"mat-label"),m(19,"K\u1EBFt Th\xFAc"),o(),r(20,"input",15),f("dateChange",function(d){return h(i),g(n.onDateChange(d))}),J("ngModelChange",function(d){return h(i),j(n.SearchParams.Ketthuc,d)||(n.SearchParams.Ketthuc=d),g(d)}),o(),S(21,"mat-datepicker-toggle",16)(22,"mat-datepicker",null,2),o()(),r(24,"div",17),v(25,ze,5,0,"div",18),r(26,"table",19),H(27,sn,3,1,"ng-container",20,it),v(29,ln,1,0,"tr",21)(30,cn,1,4,"tr",22)(31,pn,4,1,"tr",23),o()(),S(32,"mat-paginator",24),o()()}if(t&2){let i=F(16),l=F(23);c(),p("position","end"),c(4),p("ngIf",n.loading()),c(),p("ngIf",n.error()),c(),p("ngIf",!n.isSearch),c(),p("ngIf",n.isSearch),c(2),p("appearance","outline")("subscriptSizing","dynamic"),c(3),p("matDatepicker",i),Q("ngModel",n.SearchParams.Batdau),p("ngModelOptions",W(23,Ee)),c(),p("for",i),c(3),p("appearance","outline")("subscriptSizing","dynamic"),c(3),p("matDatepicker",l),Q("ngModel",n.SearchParams.Ketthuc),p("ngModelOptions",W(24,Ee)),c(),p("for",l),c(4),p("ngIf",n.loading()),c(),p("dataSource",n.dataSource()),c(),K(n.displayedColumns),c(2),p("matHeaderRowDef",n.displayedColumns),c(),p("matRowDefColumns",n.displayedColumns),c(2),p("pageSizeOptions",ot(25,Ie,n.dataSource().data.length))("pageSize",50)}},dependencies:[At,$t,Bt,Gt,qt,Nt,Ot,me,Yt,ee,re,ne,te,oe,ie,ae,se,le,ce,Ut,N,Zt,Xt,O,Mt,Tt,Et,Vt,kt,St,wt,gt,Dt,bt,Ct,xt,yt,zt,ht,ct,mt,dt,ut,pt,Pt,Ft,Lt,It,Wt,Jt,ye,_e,fe,xe,ve,Ce,De,be],encapsulation:2,changeDetection:0})};R([un()],L.prototype,"FilterHederColumn",1),R([hn(500)],L.prototype,"doFilterHederColumn",1);var Te=L;function un(){return function(a,e,t){let n=t.value,i=new Map;return t.value=function(...l){let d=JSON.stringify(l);if(i.has(d))return i.get(d);let b=n.apply(this,l);return i.set(d,b),b},t}}function hn(a=300){return function(e,t,n){let i=n.value,l;return n.value=function(...d){clearTimeout(l),l=setTimeout(()=>{i.apply(this,d)},a)},n}}export{Te as VandonComponent};
