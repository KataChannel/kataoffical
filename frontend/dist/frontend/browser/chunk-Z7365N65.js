import{a as de}from"./chunk-DFEBKCCY.js";import{a as pe}from"./chunk-RRZ644JX.js";import{a as he}from"./chunk-Z4HIZU65.js";import{a as ce,b as Y}from"./chunk-NULFSBS2.js";import{c as re,f as se}from"./chunk-ESCBPH3J.js";import{a as le}from"./chunk-OVJKPLRU.js";import{a as $t,b as Gt,c as B,d as jt,e as Qt}from"./chunk-2PVH7Z6P.js";import{a as Ot}from"./chunk-SAM22JC7.js";import{c as Et,d as It,f as Dt,h as Ft}from"./chunk-EJAZH3JY.js";import{b as qt}from"./chunk-SUUFLDBI.js";import{a as X}from"./chunk-ZW44ZSN2.js";import{a as ft,b as _t,c as yt}from"./chunk-Z2ZDGSWT.js";import{a as wt,b as St,c as kt,d as vt}from"./chunk-UQRYBWA2.js";import{a as ht}from"./chunk-Q7E7WSHM.js";import{b as me}from"./chunk-EPAD3OFC.js";import{a as Ht,b as zt,c as Ut,d as Wt,e as Xt,g as Jt,h as Yt,j as Zt,k as te,m as ee,n as ie,p as ae,q as ne,r as oe,s as J}from"./chunk-POPZSE3V.js";import{b as Rt}from"./chunk-POHUA43U.js";import{b as bt,g as Kt,j as Lt,n as Mt,p as Tt,r as Pt,v as At,w as Bt,y as Nt,z as Vt}from"./chunk-A3B3GZND.js";import{a as Ct,b as xt}from"./chunk-MGAKVDEP.js";import{a as A,b as ut}from"./chunk-CBIWJPH2.js";import{a as pt,c as dt,e as gt}from"./chunk-K4TPENAW.js";import{y as ct,z as mt}from"./chunk-27DT4LBZ.js";import{b as lt,c as P}from"./chunk-VF6Z3BLE.js";import{m as ot,r as rt,v as st}from"./chunk-CNCZQRZQ.js";import{$b as M,Cc as O,Db as tt,Dc as h,Ec as T,Fc as w,Ic as H,Jc as z,Kb as x,Kc as $,Mc as G,Ra as _,Sc as j,Ub as y,Uc as Q,Xc as U,Yb as et,bc as it,cc as R,dc as q,ec as o,fc as r,gc as E,hc as at,ic as nt,ja as Z,kc as S,ld as W,pa as g,pc as C,rb as m,rc as l,xc as I,ya as u,yc as D,za as f,zc as F}from"./chunk-TAKLKH4V.js";import{a as K,b as V,h as L,j as p}from"./chunk-WJTR2IJE.js";var N=class n{_GraphqlService=g(de);_StorageService=g(ut);_router=g(P);_snackBar=g(A);_ErrorLogService=g(Ot);_sharedSocketService=g(pe);socket;ListKhachhang=_([]);DetailKhachhang=_({});page=_(1);totalPages=_(1);total=_(0);pageSize=_(50);khachhangId=_(null);loading=_(!1);error=_(null);constructor(){this.socket=this._sharedSocketService.getSocket(),this.listenKhachhangUpdates()}setKhachhangId(e){this.khachhangId.set(e)}getAllKhachhang(){return p(this,arguments,function*(e={}){try{this.loading.set(!0),this.error.set(null);let t={id:!0,makh:!0,name:!0,diachi:!0,quan:!0,email:!0,sdt:!0,mst:!0,gionhanhang:!0,loaikh:!0,ghichu:!0,isActive:!0,createdAt:!0,banggiaId:!0,banggia:{select:{id:!0,title:!0,mabanggia:!0}}},i={isActive:!0};e.subtitle&&(i.OR=[{name:{contains:e.subtitle,mode:"insensitive"}},{makh:{contains:e.subtitle,mode:"insensitive"}},{email:{contains:e.subtitle,mode:"insensitive"}},{sdt:{contains:e.subtitle,mode:"insensitive"}}]),e.loaikh&&(i.loaikh=e.loaikh),e.banggiaId&&(i.banggiaId=e.banggiaId);let a={createdAt:"desc"},s=yield this._GraphqlService.findMany("khachhang",{where:i,orderBy:a,select:t}),d=s?.length||0;return this.ListKhachhang.set(s||[]),this.total.set(d),this.totalPages.set(1),this.page.set(1),s}catch(t){throw console.error("L\u1ED7i khi l\u1EA5y danh s\xE1ch kh\xE1ch h\xE0ng:",t),this.error.set("Kh\xF4ng th\u1EC3 t\u1EA3i danh s\xE1ch kh\xE1ch h\xE0ng"),this._ErrorLogService.logError("getAllKhachhang",t),t}finally{this.loading.set(!1)}})}getKhachhangBy(e){return p(this,null,function*(){try{return yield this.getAllKhachhang(e)}catch(t){throw console.error("L\u1ED7i t\xECm ki\u1EBFm kh\xE1ch h\xE0ng:",t),t}})}getKhachhangById(e){return p(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let t={banggia:{select:{id:!0,title:!0,mabanggia:!0,type:!0,status:!0}}},i=yield this._GraphqlService.findUnique("khachhang",{id:e},{include:t});return console.log(i),i&&(this.DetailKhachhang.set(i),this.setKhachhangId(e)),i}catch(t){throw console.error("L\u1ED7i khi l\u1EA5y chi ti\u1EBFt kh\xE1ch h\xE0ng:",t),this.error.set("Kh\xF4ng th\u1EC3 t\u1EA3i th\xF4ng tin kh\xE1ch h\xE0ng"),this._ErrorLogService.logError("getKhachhangById",t),t}finally{this.loading.set(!1)}})}createKhachhang(e){return p(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let t={makh:e.makh||this.generateMaKhachHang(),subtitle:e.subtitle||"",tenfile:e.tenfile||"",name:e.name,diachi:e.diachi||"",quan:e.quan||"",email:e.email||"",sdt:e.sdt||"",mst:e.mst||"",gionhanhang:e.gionhanhang||"",loaikh:e.loaikh||"banle",ghichu:e.ghichu||"",isActive:e.isActive!==!1,isshowvat:e.isshowvat,hiengia:e.hiengia,istitle2:e.istitle2,banggiaId:e.banggiaId||null},i={banggia:{select:{id:!0,title:!0,mabanggia:!0}}},a=yield this._GraphqlService.createOne("khachhang",t,{include:i});return this.khachhangId.set(a.id),this.DetailKhachhang.set(a),yield this.getAllKhachhang(),this._snackBar.open("T\u1EA1o kh\xE1ch h\xE0ng th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),a}catch(t){throw console.error("L\u1ED7i t\u1EA1o kh\xE1ch h\xE0ng:",t),this.error.set("Kh\xF4ng th\u1EC3 t\u1EA1o kh\xE1ch h\xE0ng"),this._snackBar.open("L\u1ED7i t\u1EA1o kh\xE1ch h\xE0ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),t}finally{this.loading.set(!1)}})}updateKhachhang(e,t){return p(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let i={name:t.name,subtitle:t.subtitle,tenfile:t.tenfile,diachi:t.diachi,quan:t.quan,email:t.email,sdt:t.sdt,mst:t.mst,gionhanhang:t.gionhanhang,loaikh:t.loaikh,ghichu:t.ghichu,isActive:t.isActive,isshowvat:t.isshowvat,hiengia:t.hiengia,istitle2:t.istitle2,banggiaId:t.banggiaId},a={banggia:{select:{id:!0,title:!0,mabanggia:!0}}},s=yield this._GraphqlService.updateOne("khachhang",{id:e},i,{include:a});return this.DetailKhachhang.set(s),yield this.getAllKhachhang(),this._snackBar.open("C\u1EADp nh\u1EADt kh\xE1ch h\xE0ng th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),s}catch(i){throw console.error("L\u1ED7i c\u1EADp nh\u1EADt kh\xE1ch h\xE0ng:",i),this.error.set("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt kh\xE1ch h\xE0ng"),this._snackBar.open("L\u1ED7i c\u1EADp nh\u1EADt kh\xE1ch h\xE0ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),i}finally{this.loading.set(!1)}})}deleteKhachhang(e){return p(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let t=yield this._GraphqlService.updateOne("khachhang",{id:e},{isActive:!1});return yield this.getAllKhachhang(),this._snackBar.open("X\xF3a kh\xE1ch h\xE0ng th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),t}catch(t){throw console.error("L\u1ED7i x\xF3a kh\xE1ch h\xE0ng:",t),this.error.set("Kh\xF4ng th\u1EC3 x\xF3a kh\xE1ch h\xE0ng"),this._snackBar.open("L\u1ED7i x\xF3a kh\xE1ch h\xE0ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),t}finally{this.loading.set(!1)}})}importKhachhang(e){return p(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let t=e.map(a=>({makh:a.makh||this.generateMaKhachHang(),name:a.name,diachi:a.diachi||"",quan:a.quan||"",email:a.email||"",sdt:a.sdt||"",mst:a.mst||"",gionhanhang:a.gionhanhang||"",loaikh:a.loaikh||"banle",ghichu:a.ghichu||"",isActive:a.isActive!==!1,banggiaId:a.banggiaId||null})),i=yield this._GraphqlService.batchCreate("khachhang",t);return yield this.getAllKhachhang(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${i.length} kh\xE1ch h\xE0ng`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),i}catch(t){throw console.error("L\u1ED7i import kh\xE1ch h\xE0ng:",t),this.error.set("Kh\xF4ng th\u1EC3 import kh\xE1ch h\xE0ng"),this._snackBar.open("L\u1ED7i import kh\xE1ch h\xE0ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),t}finally{this.loading.set(!1)}})}changePage(e,t){return p(this,null,function*(){return console.log("Pagination disabled - all data loaded"),this.ListKhachhang()})}listenKhachhangUpdates(){this.socket&&(this.socket.on("khachhang:created",e=>{let t=this.ListKhachhang();this.ListKhachhang.set([e,...t]),this.total.set(this.total()+1)}),this.socket.on("khachhang:updated",e=>{let t=this.ListKhachhang(),i=t.findIndex(a=>a.id===e.id);i!==-1&&(t[i]=e,this.ListKhachhang.set([...t])),this.khachhangId()===e.id&&this.DetailKhachhang.set(e)}),this.socket.on("khachhang:deleted",e=>{let i=this.ListKhachhang().filter(a=>a.id!==e.id);this.ListKhachhang.set(i),this.total.set(this.total()-1)}))}generateMaKhachHang(){let e=Date.now().toString(36),t=Math.random().toString(36).substr(2,5);return`KH${e}${t}`.toUpperCase()}getUpdatedCodeIds(){return p(this,null,function*(){try{return yield this._GraphqlService.findMany("khachhang",{where:{isActive:!0},select:{id:!0,makh:!0},orderBy:{updatedAt:"desc"},take:100})}catch(e){return console.error("L\u1ED7i l\u1EA5y updated code IDs:",e),[]}})}clearCache(){this.ListKhachhang.set([]),this.DetailKhachhang.set({}),this.khachhangId.set(null),this.error.set(null),this.page.set(1)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=Z({token:n,factory:n.\u0275fac,providedIn:"root"})};var _e=["drawer"],ge=()=>({standalone:!0}),ye=(n,e)=>e.key;function Ce(n,e){if(n&1){let t=S();o(0,"button",31),C("click",function(){u(t);let a=l(),s=O(44);return f(a.openDeleteDialog(s))}),o(1,"mat-icon"),h(2,"delete"),r(),o(3,"span",15),h(4,"Xo\xE1"),r()()}}function xe(n,e){if(n&1){let t=S();o(0,"button",32),C("click",function(a){let s=u(t).$implicit;return l().toggleColumn(s),f(a.stopPropagation())}),o(1,"mat-icon"),h(2),r(),o(3,"span"),h(4),r()()}if(n&2){let t=e.$implicit;m(2),T(t.isShow?"check_box":"check_box_outline_blank"),m(2),T(t.value)}}function we(n,e){if(n&1&&(o(0,"th",33)(1,"span"),h(2),r()()),n&2){let t=l(2).$implicit,i=l();m(2),T(i.ColumnName[t])}}function Se(n,e){n&1&&x(0,we,3,1,"th",36)}function ke(n,e){if(n&1){let t=S();o(0,"th",34)(1,"span",38),h(2),r(),o(3,"app-searchfilter",39),C("OutFilter",function(a){u(t);let s=l(3);return f(s.onOutFilter(a))}),r()()}if(n&2){let t=l(2).$implicit,i=l();m(2),w(" ",i.ColumnName[t]," "),m(),y("icon","filter_alt")("ListItem",i.Listkhachhang())("fieldsearch",t)("ListFilter",i.ListFilter)("filterItem",i.FilterHederColumn(i.dataSource.filteredData,t))}}function ve(n,e){n&1&&x(0,ke,4,6,"th",37)}function be(n,e){if(n&1){let t=S();o(0,"span",44),C("click",function(){u(t);let a=l().$implicit,s=l(2);return f(s.goToDetail(a))}),h(1),r()}if(n&2){let t=l().$implicit,i=l().$implicit;m(),w(" ",t[i]," ")}}function Ke(n,e){if(n&1&&(o(0,"span",42),h(1),r()),n&2){let t=l().index;m(),w(" ",t+1," ")}}function Le(n,e){if(n&1&&(o(0,"span",43),h(1),j(2,"date"),r()),n&2){let t=l().$implicit,i=l().$implicit;m(),w(" ",Q(2,1,t[i],"dd/MM/yyyy")," ")}}function Me(n,e){if(n&1&&(o(0,"span",43),h(1),r()),n&2){let t=l().$implicit,i=l().$implicit;m(),w(" ",t[i]==null?null:t[i].mabanggia," ")}}function Ee(n,e){if(n&1&&(o(0,"span",43),h(1),r()),n&2){let t=l().$implicit,i=l().$implicit;m(),w(" ",t[i],"% ")}}function Ie(n,e){n&1&&(o(0,"mat-icon",45),h(1,"check_circle"),r())}function De(n,e){n&1&&(o(0,"mat-icon",46),h(1,"cancel"),r())}function Fe(n,e){if(n&1&&(o(0,"span",43),x(1,Ie,2,0,"mat-icon",45)(2,De,2,0,"mat-icon",46),r()),n&2){let t=l().$implicit,i=l().$implicit;m(),M(t[i]?1:2)}}function Te(n,e){if(n&1&&(o(0,"span",43),h(1),j(2,"date"),r()),n&2){let t=l().$implicit,i=l().$implicit;m(),w(" ",Q(2,1,t[i],"dd/MM/yyyy")," ")}}function Pe(n,e){if(n&1&&(o(0,"span",43),h(1),r()),n&2){let t=l().$implicit,i=l().$implicit;m(),w(" ",t[i]," ")}}function Ae(n,e){if(n&1&&(o(0,"td",40),x(1,be,2,1,"span",41)(2,Ke,2,1,"span",42)(3,Le,3,4,"span",43)(4,Me,2,1,"span",43)(5,Ee,2,1,"span",43)(6,Fe,3,1,"span",43)(7,Te,3,4,"span",43)(8,Pe,2,1,"span",43),r()),n&2){let t,i=l().$implicit;m(),M((t=i)==="makh"?1:t==="stt"?2:t==="createdAt"?3:t==="banggia"?4:t==="haohut"?5:t==="isActive"?6:t==="updatedAt"?7:8)}}function Be(n,e){if(n&1&&(at(0,27),x(1,Se,1,0,"th",33)(2,ve,1,0,"th",34)(3,Ae,9,1,"td",35),nt()),n&2){let t=e.$implicit;y("matColumnDef",t),m(),M(t=="stt"?1:2)}}function Ne(n,e){n&1&&E(0,"tr",47)}function Ve(n,e){if(n&1){let t=S();o(0,"tr",48),C("click",function(){let a=u(t).$implicit,s=l();return f(s.AddToEdit(a))}),r()}if(n&2){let t=e.$implicit,i=l();et("hover:bg-slate-50 ",i.CheckItemInEdit(t)?"!bg-blue-50":"","")}}function Re(n,e){n&1&&(o(0,"tr",49)(1,"td",50),h(2,"Kh\xF4ng t\xECm th\u1EA5y"),r()())}function qe(n,e){n&1&&(o(0,"mat-dialog-content")(1,"div",51)(2,"div",52),h(3,"X\xE1c Nh\u1EADn"),r(),o(4,"div"),h(5,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),r(),o(6,"div",53)(7,"button",54),h(8,"\u0110\u1ED3ng \xDD"),r(),o(9,"button",55),h(10,"Hu\u1EF7 B\u1ECF"),r()()()())}function Oe(n,e){if(n&1){let t=S();o(0,"mat-dialog-content",56)(1,"div",57)(2,"mat-form-field",19)(3,"mat-label"),h(4,"IdSheet"),r(),o(5,"input",58),$("ngModelChange",function(a){u(t);let s=l();return z(s.IdSheet,a)||(s.IdSheet=a),f(a)}),r()(),o(6,"mat-form-field",19)(7,"mat-label"),h(8,"SheetName"),r(),o(9,"input",59),$("ngModelChange",function(a){u(t);let s=l();return z(s.SheetName,a)||(s.SheetName=a),f(a)}),r()()(),E(10,"div",60),o(11,"div",61)(12,"button",54),h(13,"\u0110\u1ED3ng \xDD"),r(),o(14,"button",55),h(15,"Hu\u1EF7 B\u1ECF"),r()()()}if(n&2){let t=l();m(5),H("ngModel",t.IdSheet),y("ngModelOptions",G(4,ge)),m(4),H("ngModel",t.SheetName),y("ngModelOptions",G(5,ge))}}var v=class v{displayedColumns=[];ColumnName={stt:"#",makh:"M\xE3 KH",name:"T\xEAn KH",banggia:"B\u1EA3ng Gi\xE1",diachi:"\u0110\u1ECBa Ch\u1EC9",quan:"Qu\u1EADn",email:"Email",sdt:"SDT",mst:"MST",gionhanhang:"Gi\u1EDD Nh\u1EADn H\xE0ng",loaikh:"Lo\u1EA1i KH",ghichu:"Ghi Ch\xFA",isActive:"Tr\u1EA1ng Th\xE1i",createdAt:"Ng\xE0y T\u1EA1o"};FilterColumns=JSON.parse(localStorage.getItem("KhachhangColFilter")||"[]");Columns=[];paginator;sort;drawer;_KhachhangService=g(N);_breakpointObserver=g(ct);_GoogleSheetService=g(le);_router=g(P);_dialog=g(Et);_snackBar=g(A);Listkhachhang=this._KhachhangService.ListKhachhang;page=this._KhachhangService.page;totalPages=this._KhachhangService.totalPages;total=this._KhachhangService.total;pageSize=this._KhachhangService.pageSize;khachhangId=this._KhachhangService.khachhangId;loading=this._KhachhangService.loading;error=this._KhachhangService.error;dataSource=new J([]);EditList=[];isSearch=_(!1);searchParam={};constructor(){W(()=>{let e=this.Listkhachhang();this.dataSource.data=e,this.dataSource.sort=this.sort,this.paginator&&(this.paginator.pageIndex=0,this.paginator.pageSize=e.length||50,this.paginator.length=e.length)}),W(()=>{let e=this.error();e&&this._snackBar.open(e,"\u0110\xF3ng",{duration:5e3})})}ngOnInit(){return p(this,null,function*(){yield this._KhachhangService.getAllKhachhang(this.searchParam),this.displayedColumns=Object.keys(this.ColumnName);let e=this.Listkhachhang();this.dataSource=new J(e),this.dataSource.sort=this.sort,this.dataSource.paginator=this.paginator,this.initializeColumns(),this.setupDrawer()})}initializeColumns(){this.Columns=Object.entries(this.ColumnName).map(([e,t])=>({key:e,value:t,isShow:!0})),this.FilterColumns=this.FilterColumns.length?this.FilterColumns:this.Columns,localStorage.setItem("KhachhangColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,{key:t,value:i,isShow:a})=>a?V(K({},e),{[t]:i}):e,{})}applyFilter(e){return p(this,null,function*(){let t=e.target.value;if(t.length===0){this.dataSource.filter="";return}try{yield new Promise(a=>setTimeout(a,0));let i=X(t.trim().toLowerCase());this.dataSource.filterPredicate=(a,s)=>{let d=Object.keys(a).reduce((b,k)=>b+(a[k]?a[k].toString().toLowerCase():"")+"\u25EC","").toLowerCase(),c=X(d);return d.includes(s)||c.includes(s)},this.dataSource.filter=i,this.paginator&&this.paginator.firstPage()}catch(i){console.error("Error applying filter:",i),this._snackBar.open("L\u1ED7i khi t\xECm ki\u1EBFm","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{}})}getUpdatedCodeIds(){return p(this,null,function*(){yield this._KhachhangService.getUpdatedCodeIds()})}setupDrawer(){this._breakpointObserver.observe([mt.Handset]).subscribe(e=>{e.matches?this.drawer.mode="over":this.drawer.mode="side"})}toggleColumn(e){let t=this.FilterColumns.find(i=>i.key===e.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}FilterHederColumn(e,t){return e.filter((a,s,d)=>s===d.findIndex(c=>c[t]===a[t]))}doFilterHederColumn(e,t){this.dataSource.filteredData=this.Listkhachhang().filter(i=>i[t].toLowerCase().includes(e.target.value.toLowerCase()))}ListFilter=[];ChosenItem(e,t){let i=this.dataSource.filteredData.filter(s=>s[t]===e[t]);this.ListFilter.filter(s=>s[t]===e[t]).length>0?this.ListFilter=this.ListFilter.filter(s=>s[t]!==e[t]):this.ListFilter=[...this.ListFilter,...i]}ChosenAll(e){e.forEach(t=>{!!this.ListFilter.find(a=>a.id===t.id)?this.ListFilter=this.ListFilter.filter(a=>a.id!==t.id):this.ListFilter.push(t)})}ResetFilter(){this.ListFilter=this.Listkhachhang()}EmptyFiter(){this.ListFilter=[]}CheckItem(e){return!!this.ListFilter.find(t=>t.id===e.id)}ApplyFilterColum(e){this.dataSource.data=this.Listkhachhang().filter(t=>this.ListFilter.some(i=>i.id===t.id)),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,e.closeMenu()}onOutFilter(e){this.dataSource.data=e,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("KhachhangColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(i=>i.value.toLowerCase().includes(t))}create(){this.drawer.open(),this._router.navigate(["admin/khachhang","new"])}openDeleteDialog(e){this._dialog.open(e,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(i=>{i==="true"&&this.DeleteListItem()})}DeleteListItem(){this.EditList.forEach(e=>{this._KhachhangService.deleteKhachhang(e.id)}),this.EditList=[],this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}AddToEdit(e){this.EditList.find(i=>i.id===e.id)?this.EditList=this.EditList.filter(i=>i.id!==e.id):this.EditList.push(e)}CheckItemInEdit(e){return this.EditList.some(t=>t.id===e.id)}goToDetail(e){this.drawer.open(),this._KhachhangService.setKhachhangId(e.id),this._router.navigate(["admin/khachhang",e.id])}OpenLoadDrive(e){}IdSheet="15npo25qyH5FmfcEjl1uyqqyFMS_vdFnmxM_kt0KYmZk";SheetName="SPImport";ImportIteam=[];ImportColumnName={};ImportdisplayedColumns=[];LoadDrive(){return p(this,null,function*(){let e={IdSheet:this.IdSheet,SheetName:this.SheetName,ApiKey:ht.GSApiKey},t=yield this._GoogleSheetService.getDrive(e);this.ImportIteam=qt(t.values),this.ImportColumnName=Object.fromEntries(t.values[0].map((i,a)=>[i,t.values[1][a]])),this.ImportdisplayedColumns=t.values[0]})}DoImportData(e){return p(this,null,function*(){let t=e.map(c=>({title:c.title?.trim()||"",masp:c.masp?.trim()||"",giagoc:Number(c.giagoc)||0,dvt:c.dvt?.trim()||"",soluong:Number(c.soluong)||0,soluongkho:Number(c.soluongkho)||0,haohut:Number(c.haohut)||0,ghichu:c.ghichu?.trim()||""})),i=Array.from(new Map(t.map(c=>[c.masp,c])).values()),a=this._KhachhangService.ListKhachhang(),s=a.map(c=>c.masp),d=i.map(c=>c.masp).filter(c=>!s.includes(c));yield Promise.all(i.map(c=>p(this,null,function*(){let b=a.find(k=>k.masp===c.masp);if(b){let k=K(K({},b),c);yield this._KhachhangService.updateKhachhang(k.id,k)}else yield this._KhachhangService.createKhachhang(c)}))),yield Promise.all(a.filter(c=>!i.some(b=>b.masp===c.masp)).map(c=>this._KhachhangService.updateKhachhang(c.id,V(K({},c),{isActive:!1})))),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ImporExcel(e){return p(this,null,function*(){let t=yield se(e);this.DoImportData(t)})}ExportExcel(e,t){let i=e.map(a=>({title:a.title,masp:a.masp,giagoc:a.giagoc,dvt:a.dvt,soluong:a.soluong,soluongkho:a.soluongkho,haohut:a.haohut,ghichu:a.ghichu}));re(i,t)}trackByFn(e,t){return t.id}onPageSizeChange(e,t){return p(this,null,function*(){this.paginator&&(this.paginator.pageSize=e,this.paginator.firstPage()),this._snackBar.open(`Hi\u1EC3n th\u1ECB ${e} items m\u1ED7i trang`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),t.closeMenu()})}onPreviousPage(){return p(this,null,function*(){this.paginator&&this.paginator.hasPreviousPage()&&this.paginator.previousPage()})}onNextPage(){return p(this,null,function*(){this.paginator&&this.paginator.hasNextPage()&&this.paginator.nextPage()})}static \u0275fac=function(t){return new(t||v)};static \u0275cmp=tt({type:v,selectors:[["app-listkhachhang"]],viewQuery:function(t,i){if(t&1&&(I($t,5),I(B,5),I(_e,7)),t&2){let a;D(a=F())&&(i.paginator=a.first),D(a=F())&&(i.sort=a.first),D(a=F())&&(i.drawer=a.first)}},decls:47,vars:7,consts:[["drawer",""],["menu","matMenu"],["DeleteDialog",""],["LoadDriveDialog",""],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-16","w-full","p-2"],[1,"p-2","cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","bg-white","rounded-lg"],[1,"w-full","flex","flex-col","gap-2","lg:flex-row","lg:items-center","lg:justify-between"],[1,"flex","flex-row","space-x-2","items-center"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],["color","primary","matTooltip","Th\xEAm m\u1EDBi","mat-flat-button","",1,"flex","flex-row","items-center",3,"click"],[1,"whitespace-nowrap"],["class","flex flex-row items-center","color","warn","matTooltip","Xo\xE1","mat-flat-button","",3,"click",4,"ngIf"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["mat-icon-button","","color","primary","matTooltip","C\u1EADp Nh\u1EADt L\u1EA1i Code",3,"click"],[1,"w-full","h-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["class","border","mat-row","",3,"class","click",4,"matRowDef","matRowDefColumns"],["class","mat-row border",4,"matNoDataRow"],["color","warn","matTooltip","Xo\xE1","mat-flat-button","",1,"flex","flex-row","items-center",3,"click"],["mat-menu-item","",3,"click"],["mat-header-cell","",1,"!border","!bg-slate-100"],["mat-header-cell","","mat-sort-header","",1,"!border","whitespace-nowrap","!bg-slate-100"],["class","border","mat-cell","",4,"matCellDef"],["class","!border !bg-slate-100","mat-header-cell","",4,"matHeaderCellDef"],["class","!border whitespace-nowrap !bg-slate-100","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],[1,"max-w-40","line-clamp-4","me-4"],[3,"OutFilter","icon","ListItem","fieldsearch","ListFilter","filterItem"],["mat-cell","",1,"border"],[1,"max-w-40","line-clamp-4","font-bold","text-blue-600"],[1,"flex","text-center"],[1,"max-w-40","line-clamp-4"],[1,"max-w-40","line-clamp-4","font-bold","text-blue-600",3,"click"],[1,"text-green-500"],[1,"text-red-500"],["mat-header-row",""],["mat-row","",1,"border",3,"click"],[1,"mat-row","border"],["colspan","4",1,"mat-cell","p-4"],[1,"flex","flex-col","space-y-8","items-center","justify-center"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary","mat-dialog-close","true"],["mat-flat-button","","color","warn","mat-dialog-close","false"],[1,"!w-screen","!h-screen","!max-h-screen","!relative","!flex","flex-col","space-y-8","items-center","justify-center"],[1,"relative","flex","flex-row","space-x-2","items-center"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp IdSheet",3,"ngModelChange","ngModel","ngModelOptions"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp SheetName",3,"ngModelChange","ngModel","ngModelOptions"],[1,"relative","h-full","w-full","overflow-auto"],[1,"relative","flex","flex-row","space-x-2","items-center","justify-center"]],template:function(t,i){if(t&1){let a=S();o(0,"mat-drawer-container",4)(1,"mat-drawer",5,0),E(3,"router-outlet"),r(),o(4,"div",6)(5,"div",7)(6,"div",8)(7,"div",9)(8,"div",10)(9,"input",11),C("keyup",function(d){return u(a),f(i.applyFilter(d))}),r(),o(10,"div",12)(11,"span",13),h(12,"search"),r()()(),o(13,"button",14),C("click",function(){return u(a),f(i.create())}),o(14,"mat-icon"),h(15,"add_circle"),r(),o(16,"span",15),h(17,"T\u1EA1o M\u1EDBi"),r()(),x(18,Ce,5,0,"button",16),r(),o(19,"div",9)(20,"button",17)(21,"mat-icon"),h(22,"tune"),r()(),o(23,"mat-menu",null,1)(25,"div",18)(26,"mat-form-field",19)(27,"input",20),C("input",function(d){return u(a),f(i.doFilterColumns(d))})("click",function(d){return u(a),f(d.stopPropagation())}),r(),o(28,"mat-icon",21),h(29,"search"),r()()(),o(30,"div",22),R(31,xe,5,2,"button",23,ye),r()(),o(33,"button",24),C("click",function(){return u(a),f(i.getUpdatedCodeIds())}),o(34,"mat-icon"),h(35,"cached"),r()()()()(),o(36,"div",25)(37,"table",26),R(38,Be,4,2,"ng-container",27,it),x(40,Ne,1,0,"tr",28)(41,Ve,1,3,"tr",29)(42,Re,3,0,"tr",30),r()()()(),x(43,qe,11,0,"ng-template",null,2,U)(45,Oe,16,6,"ng-template",null,3,U)}if(t&2){let a=O(24);m(),y("position","end"),m(17),y("ngIf",i.EditList.length>0),m(2),y("matMenuTriggerFor",a),m(11),q(i.FilterColumns),m(6),y("dataSource",i.dataSource),m(),q(i.displayedColumns),m(2),y("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),m(),y("matRowDefColumns",i.displayedColumns)}},dependencies:[Bt,At,Tt,Pt,Vt,Nt,oe,Ut,Xt,te,Jt,Wt,ee,Yt,Zt,ie,ae,ne,Qt,B,jt,Gt,vt,St,wt,kt,yt,ft,_t,lt,xt,Ct,gt,pt,dt,Rt,st,ot,rt,Mt,bt,Kt,Lt,zt,Ht,Ft,It,Dt,he,me],encapsulation:2,changeDetection:0})};L([Y(100)],v.prototype,"applyFilter",1),L([ce()],v.prototype,"FilterHederColumn",1),L([Y(300)],v.prototype,"doFilterHederColumn",1);var ue=v;export{N as a,ue as b};
