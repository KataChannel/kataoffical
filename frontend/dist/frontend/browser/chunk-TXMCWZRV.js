import{a as se}from"./chunk-OFONBREU.js";import{b as We,f as Ze}from"./chunk-EHGCZ4C4.js";import{a as Ye}from"./chunk-JLMC2BDS.js";import{a as De,b as Ie,c as U,d as Ve,e as k,f as Ne,g as Ae,h as Pe,i as Oe,j as Be,k as Re,l as $e,m as ze,n as He,o as Qe,p as qe,q as Je,r as Ke,s as Ge,t as je}from"./chunk-DA5ME3V7.js";import{a as me,b as ce,c as pe}from"./chunk-I6B5OHGT.js";import{b as Fe}from"./chunk-MNBBNJWP.js";import{b as Ue,d as ke,e as Le}from"./chunk-3F7BKIWY.js";import{a as _e,b as fe,c as Ce,d as ge}from"./chunk-4MLQW4M4.js";import{a as ue,b as de}from"./chunk-XVT2LBKL.js";import{b as he,g as we,j as ye,n as xe,p as Se,q as ve,u as Me,v as Ee,x as Te,y as be}from"./chunk-TYZ34WI3.js";import{a as le}from"./chunk-CJ7XC2KQ.js";import{a as re,c as oe,e as ae}from"./chunk-ES5CQDKA.js";import{y as ie,z as ne}from"./chunk-AYYZC3MM.js";import{b as ee,c as te}from"./chunk-PBGP5HQW.js";import{l as W,m as Z,r as Y,u as X}from"./chunk-IBBIXZPE.js";import{Cc as N,Dc as c,Eb as B,Ec as F,Fc as x,Ic as J,Jc as K,Kc as G,Lb as y,Mc as A,Sc as P,Uc as O,Vb as f,Yb as R,Zb as $,_b as D,ac as z,bc as I,cc as V,dc as r,ec as a,fc as M,gc as H,gd as j,hc as Q,jc as v,oa as S,oc as C,qc as p,rb as l,uc as q,wc as E,xa as d,xc as T,ya as _,yc as b}from"./chunk-6QR2UCJZ.js";import{a as L,j as w}from"./chunk-6DYNGEAS.js";var nt=["drawer"],rt=()=>[5,10,25,100],ot=()=>({standalone:!0}),at=(n,e)=>e.key;function lt(n,e){if(n&1){let t=v();r(0,"button",31),C("click",function(o){let m=d(t).$implicit;return p().toggleColumn(m),_(o.stopPropagation())}),r(1,"mat-icon"),c(2),a(),r(3,"span"),c(4),a()()}if(n&2){let t=e.$implicit;l(2),F(t.isShow?"check_box":"check_box_outline_blank"),l(2),F(t.value)}}function st(n,e){if(n&1){let t=v();r(0,"mat-form-field",34)(1,"mat-label"),c(2),a(),r(3,"input",35),C("keyup",function(){d(t);let o=p(2);return _(o.applyFilter())}),G("ngModelChange",function(o){let m=d(t).$implicit,u=p(2);return K(u.filterValues[m],o)||(u.filterValues[m]=o),_(o)}),a()()}if(n&2){let t=e.$implicit,i=p(2);l(2),F(i.ColumnName[t]),l(),q("placeholder","Vui l\xF2ng Nh\u1EADp ",t,""),J("ngModel",i.filterValues[t]),f("ngModelOptions",A(5,ot))}}function mt(n,e){if(n&1&&(r(0,"div",32),y(1,st,4,6,"mat-form-field",33),a()),n&2){let t=p();l(),f("ngForOf",t.displayedColumns)}}function ct(n,e){if(n&1&&(r(0,"th",38)(1,"span",39),c(2),a()()),n&2){let t=p().$implicit,i=p();l(2),x(" ",i.ColumnName[t]," ")}}function pt(n,e){if(n&1&&(r(0,"span",41),c(1),a()),n&2){let t=p().index;l(),x(" ",t+1," ")}}function ut(n,e){if(n&1&&(r(0,"span",41),c(1),P(2,"date"),a()),n&2){let t=p().$implicit,i=p().$implicit;l(),x(" ",O(2,1,t[i],"dd/MM/yyyy")," ")}}function dt(n,e){n&1&&(r(0,"mat-icon",42),c(1,"check_circle"),a())}function _t(n,e){n&1&&(r(0,"mat-icon",43),c(1,"cancel"),a())}function ft(n,e){if(n&1&&(r(0,"span",41),y(1,dt,2,0,"mat-icon",42)(2,_t,2,0,"mat-icon",43),a()),n&2){let t=p().$implicit,i=p().$implicit;l(),D(t[i]?1:2)}}function Ct(n,e){if(n&1&&(r(0,"span",41),c(1),P(2,"date"),a()),n&2){let t=p().$implicit,i=p().$implicit;l(),x(" ",O(2,1,t[i],"dd/MM/yyyy")," ")}}function gt(n,e){if(n&1&&(r(0,"span",41),c(1),a()),n&2){let t=p().$implicit,i=p().$implicit;l(),x(" ",t[i]," ")}}function ht(n,e){if(n&1&&(r(0,"td",40),y(1,pt,2,1,"span",41)(2,ut,3,4,"span",41)(3,ft,3,1,"span",41)(4,Ct,3,4,"span",41)(5,gt,2,1,"span",41),a()),n&2){let t,i=p().$implicit;l(),D((t=i)==="STT"?1:t==="createdAt"?2:t==="isActive"?3:t==="updatedAt"?4:5)}}function wt(n,e){if(n&1&&(H(0,26),y(1,ct,3,1,"th",36)(2,ht,6,1,"td",37),Q()),n&2){let t=e.$implicit;f("matColumnDef",t)}}function yt(n,e){n&1&&M(0,"tr",44)}function xt(n,e){if(n&1){let t=v();r(0,"tr",45),C("click",function(){let o=d(t).$implicit,m=p();return _(m.goToDetail(o))}),a()}if(n&2){let t=e.$implicit,i=p();$("hover:bg-slate-100 ",i.userId()==t.id?"!bg-slate-200":"","")}}function St(n,e){n&1&&(r(0,"tr",46)(1,"td",47),c(2,"Kh\xF4ng t\xECm th\u1EA5y"),a()())}var Xe=class n{Detail={};displayedColumns=["STT","email","isActive","createdAt","updatedAt"];ColumnName={STT:"STT",email:"Email",isActive:"Tr\u1EA1ng Th\xE1i",createdAt:"Ng\xE0y T\u1EA1o",updatedAt:"Ng\xE0y C\u1EADp Nh\u1EADt"};FilterColumns=JSON.parse(localStorage.getItem("UserColFilter")||"[]");Columns=[];isFilter=!1;paginator;sort;drawer;filterValues={};_UserService=S(se);_breakpointObserver=S(ie);_GoogleSheetService=S(Ye);_router=S(te);Listuser=this._UserService.ListUser;dataSource=j(()=>{let e=new je(this.Listuser());return e.filterPredicate=this.createFilter(),e.paginator=this.paginator,e.sort=this.sort,e});userId=this._UserService.userId;_snackBar=S(le);CountItem=0;constructor(){this.displayedColumns.forEach(e=>{this.filterValues[e]=""})}createFilter(){return(e,t)=>{let i=JSON.parse(t),o=!0;return this.displayedColumns.forEach(m=>{if(i[m]){let u=e[m]?e[m].toString().toLowerCase():"";o=o&&u.includes(i[m].toLowerCase())}}),o}}applyFilter(){this.dataSource().filter=JSON.stringify(this.filterValues)}ngOnInit(){return w(this,null,function*(){yield this._UserService.getAllUser(),this.CountItem=this.Listuser().length,this.initializeColumns(),this.setupDrawer(),this.paginator._intl.itemsPerPageLabel="S\u1ED1 l\u01B0\u1EE3ng 1 trang",this.paginator._intl.nextPageLabel="Ti\u1EBFp Theo",this.paginator._intl.previousPageLabel="V\u1EC1 Tr\u01B0\u1EDBc",this.paginator._intl.firstPageLabel="Trang \u0110\u1EA7u",this.paginator._intl.lastPageLabel="Trang Cu\u1ED1i"})}refresh(){return w(this,null,function*(){yield this._UserService.getAllUser()})}initializeColumns(){this.Columns=Object.keys(this.ColumnName).map(e=>({key:e,value:this.ColumnName[e],isShow:!0})),this.FilterColumns.length===0?this.FilterColumns=this.Columns:localStorage.setItem("UserColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{})}setupDrawer(){this._breakpointObserver.observe([ne.Handset]).subscribe(e=>{e.matches?(this.drawer.mode="over",this.paginator.hidePageSize=!0):this.drawer.mode="side"})}toggleColumn(e){let t=this.FilterColumns.find(i=>i.key===e.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("UserColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(i=>i.value.toLowerCase().includes(t))}create(){this.drawer.open(),this._router.navigate(["admin/user",0])}goToDetail(e){this._UserService.setUserId(e.id),this.drawer.open(),this._router.navigate(["admin/user",e.id])}LoadDrive(){return w(this,null,function*(){let e={IdSheet:"15npo25qyH5FmfcEjl1uyqqyFMS_vdFnmxM_kt0KYmZk",SheetName:"SPImport",ApiKey:"AIzaSyD33kgZJKdFpv1JrKHacjCQccL_O0a2Eao"},t=yield this._GoogleSheetService.getDrive(e),i=Ue(t.values);console.log(i),this.DoImportData(i)})}DoImportData(e){console.log(e);let i=e.map(s=>({title:s.title?.trim()||"",masp:s.masp?.trim()||"",slug:`${ke(s?.title?.trim()||"")}_${Le(5,!1)}`,giagoc:Number(s.giagoc)||0,dvt:s.dvt||"",soluong:Number(s.soluong)||0,soluongkho:Number(s.soluongkho)||0,ghichu:s.ghichu||"",order:Number(s.order)||0})).filter((s,g,h)=>g===h.findIndex(it=>it.masp===s.masp)),o=i.map(s=>s.masp),m=this._UserService.ListUser().map(s=>s.masp),u=o.filter(s=>!m.includes(s)),et=i.map(s=>w(this,null,function*(){let g=this._UserService.ListUser().find(h=>h.masp===s.masp);if(g){let h=L(L({},g),s);yield this._UserService.updateUser(h)}else yield this._UserService.CreateUser(s)})),tt=u.map(s=>w(this,null,function*(){let g=this._UserService.ListUser().find(h=>h.masp===s);g.isActive=!1,yield this._UserService.updateUser(g)}));Promise.all([...et,...tt]).then(()=>{this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ImporExcel(e){return w(this,null,function*(){let t=yield Ze(e);this.DoImportData(t)})}ExportExcel(e,t){We(e,t)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=B({type:n,selectors:[["app-listuser"]],viewQuery:function(t,i){if(t&1&&(E(U,5),E(k,5),E(nt,7)),t&2){let o;T(o=b())&&(i.paginator=o.first),T(o=b())&&(i.sort=o.first),T(o=b())&&(i.drawer=o.first)}},decls:50,vars:12,consts:[["drawer",""],["menu","matMenu"],["uploadfile",""],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","lg:!w-1/2","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-12","w-full","p-2"],[1,"cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","p-2","bg-white","rounded-lg"],[1,"flex","flex-row","space-x-2","items-center"],["matTooltip","Th\xEAm m\u1EDBi","mat-flat-button","",1,"flex","flex-row","items-center","btn-primary",3,"click"],[1,"whitespace-nowrap"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["matTooltip","B\u1ED9 L\u1ECDc","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\u1EA3i file excel M\u1EABu","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\u1EA3i l\xEAn file excel","color","primary","mat-icon-button","",3,"click"],["type","file",1,"hidden",3,"change"],["matTooltip","T\u1EA3i d\u1EEF li\u1EC7u t\u1EEB drive","color","primary","mat-icon-button","",3,"click"],[1,"lg:flex","hidden","whitespace-nowrap","p-2","rounded-lg","bg-slate-200"],["class","w-full grid grid-cols-2 gap-2 lg:flex lg:flex-row lg:space-x-2 items-center",4,"ngIf"],[1,"w-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"class","click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSizeOptions"],["mat-menu-item","",3,"click"],[1,"w-full","grid","grid-cols-2","gap-2","lg:flex","lg:flex-row","lg:space-x-2","items-center"],["appearance","outline","subscriptSizing","dynamic",4,"ngFor","ngForOf"],["appearance","outline","subscriptSizing","dynamic"],["matInput","",3,"keyup","ngModelChange","ngModel","ngModelOptions","placeholder"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"max-w-40","line-clamp-4","me-4"],["mat-cell",""],[1,"max-w-40","line-clamp-4"],[1,"text-green-500"],[1,"text-red-500"],["mat-header-row",""],["mat-row","",3,"click"],[1,"mat-row"],["colspan","4",1,"mat-cell","p-4"]],template:function(t,i){if(t&1){let o=v();r(0,"mat-drawer-container",3)(1,"mat-drawer",4,0),M(3,"router-outlet"),a(),r(4,"div",5)(5,"div",6)(6,"div",7)(7,"button",8),C("click",function(){return d(o),_(i.create())}),r(8,"mat-icon"),c(9,"add_circle"),a(),r(10,"span",9),c(11,"T\u1EA1o M\u1EDBi"),a()(),r(12,"button",10)(13,"mat-icon"),c(14,"tune"),a()(),r(15,"mat-menu",null,1)(17,"div",11)(18,"mat-form-field",12)(19,"input",13),C("input",function(u){return d(o),_(i.doFilterColumns(u))})("click",function(u){return d(o),_(u.stopPropagation())}),a(),r(20,"mat-icon",14),c(21,"search"),a()()(),r(22,"div",15),I(23,lt,5,2,"button",16,at),a()(),r(25,"button",17),C("click",function(){return d(o),_(i.isFilter=!i.isFilter)}),r(26,"mat-icon"),c(27,"filter_list"),a()(),r(28,"button",18),C("click",function(){return d(o),_(i.ExportExcel(i.Listuser(),"User"))}),r(29,"mat-icon"),c(30,"file_download"),a()(),r(31,"button",19),C("click",function(){d(o);let u=N(35);return _(u.click())}),r(32,"mat-icon"),c(33,"file_upload"),a()(),r(34,"input",20,2),C("change",function(u){return d(o),_(i.ImporExcel(u))}),a(),r(36,"button",21),C("click",function(){return d(o),_(i.LoadDrive())}),r(37,"mat-icon"),c(38,"cloud_download"),a()(),r(39,"span",22),c(40),a()()(),y(41,mt,2,1,"div",23),r(42,"div",24)(43,"table",25),I(44,wt,3,1,"ng-container",26,z),y(46,yt,1,0,"tr",27)(47,xt,1,3,"tr",28)(48,St,3,0,"tr",29),a(),M(49,"mat-paginator",30),a()()()}if(t&2){let o=N(16);l(),f("position","end"),l(11),f("matMenuTriggerFor",o),l(11),V(i.FilterColumns),l(2),R(i.isFilter?"!bg-slate-200":""),l(15),x(" ",i.CountItem," S\u1EA3n Ph\u1EA9m "),l(),f("ngIf",i.isFilter),l(2),f("dataSource",i.dataSource()),l(),V(i.displayedColumns),l(2),f("matHeaderRowDef",i.displayedColumns),l(),f("matRowDefColumns",i.displayedColumns),l(2),f("pageSizeOptions",A(11,rt))}},dependencies:[Ee,Me,Se,ve,be,Te,Ge,Pe,Be,He,Re,Oe,Qe,$e,ze,qe,Je,Ke,Ae,k,Ne,Ve,U,ge,fe,_e,Ce,pe,me,ce,ee,de,ue,ae,re,oe,Fe,X,W,Z,Y,xe,he,we,ye,Ie,De],encapsulation:2})};export{Xe as a};
