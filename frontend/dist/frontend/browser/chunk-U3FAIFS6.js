import{a as _e,b as Ue}from"./chunk-3YCIOZ7J.js";import{a as fe}from"./chunk-TA3PQZJB.js";import{a as ge}from"./chunk-5YR4A3BZ.js";import"./chunk-4VT7CDYK.js";import{a as pe,b as me}from"./chunk-45R2NGF5.js";import"./chunk-ESCBPH3J.js";import"./chunk-BURIN2CY.js";import"./chunk-DCFSAVWL.js";import"./chunk-SAM22JC7.js";import{h as ne}from"./chunk-PYADMCOB.js";import{d as ce}from"./chunk-SUUFLDBI.js";import"./chunk-ZW44ZSN2.js";import"./chunk-AQE4NBKO.js";import"./chunk-6KT4XQ7E.js";import{a as M}from"./chunk-Q7E7WSHM.js";import"./chunk-SL7ME4PY.js";import"./chunk-YGTKRZ2Q.js";import"./chunk-4GW65WCG.js";import{a as de,b as ue}from"./chunk-IZCFLW2T.js";import{b as $,g as ee,j as te,n as ie,p as re,v as oe,w as ae,y as se,z as le}from"./chunk-OAFA7HHQ.js";import"./chunk-AW6ETFJX.js";import{a as Y,b as Z}from"./chunk-UOMYPXRQ.js";import{a as Q}from"./chunk-NX6TSR5R.js";import"./chunk-BXRNUIMR.js";import"./chunk-76RCOOPK.js";import"./chunk-2PPFUFFT.js";import{a as G,c as X,e as J}from"./chunk-MJAN2OV6.js";import{ia as K}from"./chunk-FYUVDT4C.js";import{a as O,c as q}from"./chunk-VF6Z3BLE.js";import{b as I,c as H}from"./chunk-HB5OTZ3Y.js";import{l as L,m as W,n as R,o as N,p as z,v as j}from"./chunk-CNCZQRZQ.js";import{Cc as V,Db as A,Dc as c,Ec as S,Fc as b,Ic as C,Jc as y,Kb as h,Kc as v,Ra as B,Ub as u,ec as r,fc as o,gc as D,hc as w,ic as k,jc as P,kc as U,ld as F,nb as T,pa as E,pc as _,rb as d,rc as s,ya as p,za as m}from"./chunk-TAKLKH4V.js";import{j as x}from"./chunk-WJTR2IJE.js";function he(a,i){if(a&1){let t=U();r(0,"button",3),_("click",function(){p(t);let n=s();return m(n.handleUserguideAction())}),r(1,"mat-icon"),c(2,"save"),o()()}}function Ce(a,i){if(a&1){let t=U();r(0,"button",3),_("click",function(){p(t);let n=s();return m(n.toggleEdit())}),r(1,"mat-icon"),c(2,"edit"),o()()}}function ye(a,i){if(a&1){let t=U();r(0,"button",3),_("click",function(){p(t);let n=s().$implicit,l=s();return m(l.removeBlock(n))}),r(1,"mat-icon"),c(2,"delete"),o()()}}function ve(a,i){if(a&1){let t=U();r(0,"button",35),_("click",function(){p(t),s();let n=V(5);return m(n.click())}),r(1,"mat-icon"),c(2,"cloud_upload"),o(),c(3," Ch\u1ECDn H\xECnh \u1EA2nh "),o()}if(a&2){let t=s(2).index,e=s();u("disabled",e.uploadProgress[t])}}function Ee(a,i){if(a&1){let t=U();r(0,"button",36),_("click",function(){p(t);let n=s(2).index,l=s();return m(l.removeMedia(n,"image"))}),r(1,"mat-icon"),c(2,"delete"),o()()}if(a&2){let t=s(2).index,e=s();u("disabled",e.uploadProgress[t])}}function be(a,i){if(a&1&&(r(0,"div",37),D(1,"mat-progress-bar",38),r(2,"div",39),c(3),o()()),a&2){let t=s(2).index,e=s();d(),u("value",e.uploadProgress[t]),d(2),b("\u0110ang t\u1EA3i l\xEAn... ",e.uploadProgress[t],"%")}}function De(a,i){if(a&1&&(r(0,"div",40),D(1,"img",41),r(2,"div",42),c(3),o()()),a&2){let t=s(2).index,e=s();d(),u("src",e.ImageURL+e.DetailUserguide().UserguidBlocks[t].imageUrl,T)("alt",e.DetailUserguide().UserguidBlocks[t].imageAlt||"Preview"),d(2),b(" ",e.DetailUserguide().UserguidBlocks[t].imageUrl," ")}}function we(a,i){if(a&1){let t=U();w(0),r(1,"div",26)(2,"div",27)(3,"div",28)(4,"input",29,0),_("change",function(n){p(t);let l=s().index,g=s();return m(g.onImageSelected(n,l))}),o(),h(6,ve,4,1,"button",30)(7,Ee,3,1,"button",31),o(),h(8,be,4,2,"div",32)(9,De,4,3,"div",33),o(),r(10,"mat-form-field",10)(11,"mat-label"),c(12,"M\xF4 t\u1EA3 h\xECnh \u1EA3nh"),o(),r(13,"input",34),v("ngModelChange",function(n){p(t);let l=s().index,g=s();return y(g.DetailUserguide().UserguidBlocks[l].imageAlt,n)||(g.DetailUserguide().UserguidBlocks[l].imageAlt=n),m(n)}),o()()(),k()}if(a&2){let t=s().index,e=s();d(6),u("ngIf",e.isEdit()),d(),u("ngIf",e.isEdit()&&e.DetailUserguide().UserguidBlocks[t].imageUrl),d(),u("ngIf",e.uploadProgress[t]),d(),u("ngIf",e.DetailUserguide().UserguidBlocks[t].imageUrl&&!e.uploadProgress[t]),d(4),C("ngModel",e.DetailUserguide().UserguidBlocks[t].imageAlt),u("disabled",!e.isEdit())}}function ke(a,i){if(a&1){let t=U();r(0,"button",35),_("click",function(){p(t),s();let n=V(5);return m(n.click())}),r(1,"mat-icon"),c(2,"videocam"),o(),c(3," Ch\u1ECDn Video "),o()}if(a&2){let t=s(2).index,e=s();u("disabled",e.uploadProgress[t])}}function Se(a,i){if(a&1){let t=U();r(0,"button",36),_("click",function(){p(t);let n=s(2).index,l=s();return m(l.removeMedia(n,"video"))}),r(1,"mat-icon"),c(2,"delete"),o()()}if(a&2){let t=s(2).index,e=s();u("disabled",e.uploadProgress[t])}}function Me(a,i){if(a&1&&(r(0,"div",37),D(1,"mat-progress-bar",38),r(2,"div",39),c(3),o()()),a&2){let t=s(2).index,e=s();d(),u("value",e.uploadProgress[t]),d(2),b("\u0110ang t\u1EA3i l\xEAn... ",e.uploadProgress[t],"%")}}function Be(a,i){if(a&1&&(r(0,"div",40)(1,"video",45),c(2," Tr\xECnh duy\u1EC7t kh\xF4ng h\u1ED7 tr\u1EE3 video. "),o(),r(3,"div",42),c(4),o()()),a&2){let t=s(2).index,e=s();d(),u("src",e.ImageURL+e.DetailUserguide().UserguidBlocks[t].videoUrl,T),d(3),b(" ",e.DetailUserguide().UserguidBlocks[t].videoUrl," ")}}function Te(a,i){if(a&1){let t=U();w(0),r(1,"div",26)(2,"div",27)(3,"div",28)(4,"input",43,1),_("change",function(n){p(t);let l=s().index,g=s();return m(g.onVideoSelected(n,l))}),o(),h(6,ke,4,1,"button",30)(7,Se,3,1,"button",31),o(),h(8,Me,4,2,"div",32)(9,Be,5,2,"div",33),o(),r(10,"mat-form-field",10)(11,"mat-label"),c(12,"Lo\u1EA1i Video"),o(),r(13,"input",44),v("ngModelChange",function(n){p(t);let l=s().index,g=s();return y(g.DetailUserguide().UserguidBlocks[l].videoType,n)||(g.DetailUserguide().UserguidBlocks[l].videoType=n),m(n)}),o()()(),k()}if(a&2){let t=s().index,e=s();d(6),u("ngIf",e.isEdit()),d(),u("ngIf",e.isEdit()&&e.DetailUserguide().UserguidBlocks[t].videoUrl),d(),u("ngIf",e.uploadProgress[t]),d(),u("ngIf",e.DetailUserguide().UserguidBlocks[t].videoUrl&&!e.uploadProgress[t]),d(4),C("ngModel",e.DetailUserguide().UserguidBlocks[t].videoType),u("disabled",!0)}}function Ve(a,i){a&1&&P(0)}function Ie(a,i){if(a&1){let t=U();r(0,"div",16)(1,"div",17)(2,"button",18),c(3),o(),h(4,ye,3,0,"button",7),o(),r(5,"mat-form-field",10)(6,"mat-label"),c(7,"Ti\xEAu \u0110\u1EC1 "),o(),r(8,"input",11),v("ngModelChange",function(n){let l=p(t).index,g=s();return y(g.DetailUserguide().UserguidBlocks[l].title,n)||(g.DetailUserguide().UserguidBlocks[l].title=n),m(n)}),o()(),r(9,"mat-form-field",10)(10,"mat-label"),c(11,"Lo\u1EA1i"),o(),r(12,"mat-select",6),v("ngModelChange",function(n){let l=p(t).index,g=s();return y(g.DetailUserguide().UserguidBlocks[l].type,n)||(g.DetailUserguide().UserguidBlocks[l].type=n),m(n)}),r(13,"mat-option",19),c(14,"text"),o(),r(15,"mat-option",20),c(16,"image"),o(),r(17,"mat-option",21),c(18,"video"),o()()(),w(19,22),h(20,we,14,6,"ng-container",23)(21,Te,14,6,"ng-container",23)(22,Ve,1,0,"ng-container",24),k(),r(23,"mat-form-field",10)(24,"mat-label"),c(25,"N\u1ED9i dung"),o(),r(26,"input",25),v("ngModelChange",function(n){let l=p(t).index,g=s();return y(g.DetailUserguide().UserguidBlocks[l].description,n)||(g.DetailUserguide().UserguidBlocks[l].description=n),m(n)}),o()()()}if(a&2){let t=i.index,e=s();d(3),S(t+1),d(),u("ngIf",e.isEdit()),d(4),C("ngModel",e.DetailUserguide().UserguidBlocks[t].title),u("disabled",!e.isEdit()),d(4),C("ngModel",e.DetailUserguide().UserguidBlocks[t].type),u("disabled",!e.isEdit()),d(7),u("ngSwitch",e.DetailUserguide().UserguidBlocks[t].type),d(),u("ngSwitchCase","image"),d(),u("ngSwitchCase","video"),d(5),C("ngModel",e.DetailUserguide().UserguidBlocks[t].description),u("disabled",!e.isEdit())}}var xe=class a{_ListUserguideComponent=E(fe);_UserguideService=E(ge);_route=E(O);_router=E(q);_snackBar=E(Q);_http=E(H);uploadProgress={};minioApiUrl=M.APIURL+"/minio/upload";constructor(){this._route.paramMap.subscribe(i=>{let t=i.get("id");this._UserguideService.setUserguideId(t)}),F(()=>x(this,null,function*(){let i=this._UserguideService.userguideId();i||(this._router.navigate(["/admin/userguide"]),this._ListUserguideComponent.drawer.close()),i==="new"?(this.DetailUserguide.set({}),this._ListUserguideComponent.drawer.open(),this.isEdit.update(t=>!t),this._router.navigate(["/admin/userguide","new"])):(yield this._UserguideService.getUserguideBy({id:i}),this._ListUserguideComponent.drawer.open(),this._router.navigate(["/admin/userguide",i]))}))}DetailUserguide=this._UserguideService.DetailUserguide;ImageURL=M.ImageURL?.replace("http://","https://")||"";isEdit=B(!1);isDelete=B(!1);userguideId=this._UserguideService.userguideId;ngOnInit(){return x(this,null,function*(){})}handleUserguideAction(){return x(this,null,function*(){this.userguideId()==="new"?yield this.createUserguide():yield this.updateUserguide()})}createUserguide(){return x(this,null,function*(){try{yield this._UserguideService.CreateUserguide(this.DetailUserguide()),this._snackBar.open("T\u1EA1o M\u1EDBi Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(i=>!i)}catch(i){console.error("L\u1ED7i khi t\u1EA1o userguide:",i)}})}updateUserguide(){return x(this,null,function*(){try{yield this._UserguideService.updateUserguide(this.DetailUserguide()),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(i=>!i)}catch(i){console.error("L\u1ED7i khi c\u1EADp nh\u1EADt userguide:",i)}})}DeleteData(){return x(this,null,function*(){try{yield this._UserguideService.DeleteUserguide(this.DetailUserguide()),this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this._router.navigate(["/admin/userguide"])}catch(i){console.error("L\u1ED7i khi x\xF3a userguide:",i)}})}goBack(){this._router.navigate(["/admin/userguide"]),this._ListUserguideComponent.drawer.close()}trackByFn(i,t){return t.id}toggleEdit(){this.isEdit.update(i=>!i)}toggleDelete(){this.isDelete.update(i=>!i)}FillSlug(){this.DetailUserguide.update(i=>(i.slug=ce(i.title),i))}addBlock(){this.DetailUserguide.update(i=>(i.UserguidBlocks||(i.UserguidBlocks=[]),i.UserguidBlocks.push({title:"",type:"text",description:""}),i))}removeBlock(i){this.DetailUserguide.update(t=>{if(t.UserguidBlocks&&t.UserguidBlocks.length>0){let e=t.UserguidBlocks.findIndex(n=>n.id===i.id);e>-1&&t.UserguidBlocks.splice(e,1)}return t})}onImageSelected(i,t){let e=i.target.files[0];e&&this.uploadImageToMinio(e,t),i.target.value=""}onVideoSelected(i,t){let e=i.target.files[0];e&&this.uploadVideoToMinio(e,t),i.target.value=""}uploadImageToMinio(i,t){return x(this,null,function*(){try{if(!i.type.startsWith("image/")){this._snackBar.open("Ch\u1EC9 \u0111\u01B0\u1EE3c upload file h\xECnh \u1EA3nh","",{duration:3e3,panelClass:["snackbar-error"]});return}if(i.size>10*1024*1024){this._snackBar.open("File qu\xE1 l\u1EDBn. T\u1ED1i \u0111a 10MB","",{duration:3e3,panelClass:["snackbar-error"]});return}let e=yield this.uploadFileToMinio(i,"userguide/images",t);console.log("Upload result:",e),e&&(this.DetailUserguide.update(n=>(n.UserguidBlocks[t].imageUrl=e.imageUrl,n.UserguidBlocks[t].imageAlt=n.UserguidBlocks[t].imageAlt||i.name,n)),this._snackBar.open("Upload h\xECnh \u1EA3nh th\xE0nh c\xF4ng","",{duration:2e3,panelClass:["snackbar-success"]}))}catch(e){console.error("Error uploading image:",e),this._snackBar.open("L\u1ED7i upload h\xECnh \u1EA3nh: "+(e.message||"Unknown error"),"",{duration:5e3,panelClass:["snackbar-error"]})}finally{delete this.uploadProgress[t]}})}uploadVideoToMinio(i,t){return x(this,null,function*(){try{if(!i.type.startsWith("video/")){this._snackBar.open("Ch\u1EC9 \u0111\u01B0\u1EE3c upload file video","",{duration:3e3,panelClass:["snackbar-error"]});return}if(i.size>100*1024*1024){this._snackBar.open("File qu\xE1 l\u1EDBn. T\u1ED1i \u0111a 100MB","",{duration:3e3,panelClass:["snackbar-error"]});return}let e=yield this.uploadFileToMinio(i,"userguide/videos",t);e&&(this.DetailUserguide.update(n=>(n.UserguidBlocks[t].videoUrl=e.imageUrl,n.UserguidBlocks[t].videoType=i.type,n)),this._snackBar.open("Upload video th\xE0nh c\xF4ng","",{duration:2e3,panelClass:["snackbar-success"]}))}catch(e){console.error("Error uploading video:",e),this._snackBar.open("L\u1ED7i upload video: "+(e.message||"Unknown error"),"",{duration:5e3,panelClass:["snackbar-error"]})}finally{delete this.uploadProgress[t]}})}uploadFileToMinio(i,t,e){return new Promise((n,l)=>{let g=new FormData;g.append("file",i),g.append("folder",t),g.append("originalName",i.name),this.uploadProgress[e]=0,this._http.post(this.minioApiUrl,g,{observe:"events",reportProgress:!0}).subscribe({next:f=>{f.type===I.UploadProgress?f.total&&(this.uploadProgress[e]=Math.round(100*f.loaded/f.total)):f.type===I.Response&&n(f.body)},error:f=>{console.error("Upload error:",f),l(f)}})})}removeMedia(i,t){this.DetailUserguide.update(e=>(t==="image"?(e.UserguidBlocks[i].imageUrl="",e.UserguidBlocks[i].imageAlt=""):t==="video"&&(e.UserguidBlocks[i].videoUrl="",e.UserguidBlocks[i].videoType=""),e)),this._snackBar.open(`\u0110\xE3 x\xF3a ${t==="image"?"h\xECnh \u1EA3nh":"video"}`,"",{duration:2e3,panelClass:["snackbar-success"]})}getMediaUrl(i){return i?i.startsWith("http://")||i.startsWith("https://")?i.replace("http://","https://"):`https://${M.APIURL.replace("http://","").replace("https://","")}/files/${i}`:""}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=A({type:a,selectors:[["app-detailuserguide"]],decls:27,vars:12,consts:[["imageInput",""],["videoInput",""],[1,"flex","flex-row","justify-between","items-center","space-x-2","p-2"],["mat-icon-button","","color","primary",3,"click"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center"],[3,"ngModelChange","ngModel","disabled"],["mat-icon-button","","color","primary",3,"click",4,"ngIf"],[1,"relative","flex","flex-col","space-y-2","w-full","p-4","overflow-auto"],[1,"w-full","flex","flex-col"],["appearance","outline"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp Ti\xEAu \u0110\u1EC1",3,"ngModelChange","ngModel","disabled"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp M\xF4 T\u1EA3",3,"ngModelChange","ngModel","disabled"],["class","grid lg:grid-cols-2 gap-2 p-2 rounded-lg border",4,"ngFor","ngForOf"],[1,"flex","flex-row","justify-center","p-4","bg-slate-50","border-dashed","border-2","border-slate-300","rounded-lg"],["mat-flat-button","","color","primary",3,"click","disabled"],[1,"grid","lg:grid-cols-2","gap-2","p-2","rounded-lg","border"],[1,"lg:col-span-2","flex","flex-row","justify-between","items-center","space-x-2"],["mat-flat-button","","color","primary"],["value","text"],["value","image"],["value","video"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp n\u1ED9i dung",3,"ngModelChange","ngModel","disabled"],[1,"lg:col-span-2","space-y-4"],[1,"flex","flex-col","space-y-2"],[1,"flex","items-center","space-x-2"],["type","file","accept","image/*",2,"display","none",3,"change"],["mat-raised-button","","color","primary",3,"disabled","click",4,"ngIf"],["mat-icon-button","","color","warn",3,"disabled","click",4,"ngIf"],["class","w-full",4,"ngIf"],["class","mt-2 p-2 border border-gray-200 rounded-lg",4,"ngIf"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp m\xF4 t\u1EA3 h\xECnh \u1EA3nh",3,"ngModelChange","ngModel","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],["mat-icon-button","","color","warn",3,"click","disabled"],[1,"w-full"],["mode","determinate",3,"value"],[1,"text-sm","text-gray-600","mt-1"],[1,"mt-2","p-2","border","border-gray-200","rounded-lg"],[1,"max-w-full","h-48","object-contain","rounded",3,"src","alt"],[1,"text-sm","text-gray-500","mt-1","break-all"],["type","file","accept","video/*",2,"display","none",3,"change"],["matInput","","placeholder","T\u1EF1 \u0111\u1ED9ng ph\xE1t hi\u1EC7n",3,"ngModelChange","ngModel","disabled"],["controls","",1,"max-w-full","h-48","rounded",3,"src"]],template:function(t,e){if(t&1&&(r(0,"div",2)(1,"button",3),_("click",function(){return e.goBack()}),r(2,"mat-icon"),c(3,"arrow_back"),o()(),r(4,"div",4),c(5),o(),r(6,"div",5)(7,"mat-slide-toggle",6),v("ngModelChange",function(l){return y(e.DetailUserguide().isActive,l)||(e.DetailUserguide().isActive=l),l}),c(8),o(),h(9,he,3,0,"button",7)(10,Ce,3,0,"button",7),o()(),r(11,"div",8)(12,"div",9)(13,"mat-form-field",10)(14,"mat-label"),c(15,"Ti\xEAu \u0110\u1EC1"),o(),r(16,"input",11),v("ngModelChange",function(l){return y(e.DetailUserguide().title,l)||(e.DetailUserguide().title=l),l}),o()(),r(17,"mat-form-field",10)(18,"mat-label"),c(19,"M\xF4 T\u1EA3"),o(),r(20,"input",12),v("ngModelChange",function(l){return y(e.DetailUserguide().description,l)||(e.DetailUserguide().description=l),l}),o()()(),h(21,Ie,27,11,"div",13),r(22,"div",14)(23,"button",15),_("click",function(){return e.addBlock()}),c(24," Th\xEAm Kh\u1ED1i "),r(25,"mat-icon"),c(26,"add"),o()()()()),t&2){let n;d(5),S(((n=e.DetailUserguide())==null?null:n.title)||"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),d(2),C("ngModel",e.DetailUserguide().isActive),u("disabled",!e.isEdit()),d(),S(e.DetailUserguide().isActive?"Hi\u1EC3n Th\u1ECB":"\u1EA8n"),d(),u("ngIf",e.isEdit()),d(),u("ngIf",!e.isEdit()),d(6),C("ngModel",e.DetailUserguide().title),u("disabled",!e.isEdit()),d(4),C("ngModel",e.DetailUserguide().description),u("disabled",!e.isEdit()),d(),u("ngForOf",e.DetailUserguide().UserguidBlocks),d(2),u("disabled",!e.isEdit())}},dependencies:[ae,oe,re,le,se,ie,$,ee,te,Z,Y,J,G,X,ue,de,K,ne,j,L,W,R,N,z,me,pe,Ue,_e],encapsulation:2})};export{xe as DetailUserguideComponent};
