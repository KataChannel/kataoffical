import{a as ce,b as me}from"./chunk-W5PJF7NG.js";import{a as pe}from"./chunk-RUJSCOEK.js";import"./chunk-RHYJKD3I.js";import"./chunk-PAQNOTG7.js";import"./chunk-3FNN46PZ.js";import"./chunk-IXY23C6B.js";import"./chunk-ZW44ZSN2.js";import"./chunk-OTBM7FCQ.js";import"./chunk-CDVLS2VJ.js";import"./chunk-3MD4EG7P.js";import{a as le,b as se}from"./chunk-A7PITCFC.js";import"./chunk-JNFQJYYE.js";import{h as Y}from"./chunk-C6ZTKERY.js";import"./chunk-H7UDLENL.js";import{a as q}from"./chunk-TXVIVA74.js";import"./chunk-KZMYTDV6.js";import"./chunk-GUGI676T.js";import{a as W,c as z}from"./chunk-PWU56VV4.js";import{a as re,b as ae}from"./chunk-MRUSYMHE.js";import"./chunk-DRGFONJ6.js";import{b as oe}from"./chunk-WGYCBDOD.js";import{b as ie,c as ne}from"./chunk-ZVLEUULZ.js";import{b as X,g as J,j as Q,p as U,r as Z,x as ee,y as te}from"./chunk-GPRU6KV3.js";import"./chunk-5HHQ5INI.js";import{a as H,b as K}from"./chunk-5BIREHNW.js";import"./chunk-PR6DE2EA.js";import"./chunk-OB6UQ2BD.js";import"./chunk-2PPFUFFT.js";import{a as j,c as O,e as $}from"./chunk-SKIRCMX2.js";import"./chunk-LXJDFCF2.js";import"./chunk-3QZHTKAG.js";import{m as A,u as N,x as G}from"./chunk-KFQ5FW2D.js";import{$b as F,Db as T,Dc as s,Ec as D,Gc as I,Ic as S,Jc as k,Kb as x,Kc as M,Ra as C,Sc as V,Tc as L,Ub as u,cc as P,dc as b,ec as r,fc as a,gc as B,hc as w,ic as E,kc as R,pa as g,pc as _,rb as l,rc as p,ya as h,za as f}from"./chunk-WYL4U5YK.js";import"./chunk-LWLSKGAV.js";import{a as v,b as y,j as d}from"./chunk-6DYNGEAS.js";var ue=(o,e)=>e.key,_e=(o,e)=>e.id;function ge(o,e){if(o&1){let t=R();r(0,"button",1),_("click",function(){h(t);let n=p();return f(n.handleRoleAction())}),r(1,"mat-icon"),s(2,"save"),a()()}}function he(o,e){if(o&1){let t=R();r(0,"button",1),_("click",function(){h(t);let n=p();return f(n.toggleEdit())}),r(1,"mat-icon"),s(2,"edit"),a()()}}function fe(o,e){if(o&1){let t=R();w(0),r(1,"div",9)(2,"div",10),s(3,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),a(),r(4,"div",11)(5,"button",12),_("click",function(){h(t);let n=p();return f(n.DeleteData())}),s(6,"\u0110\u1ED3ng \xDD"),a(),r(7,"button",13),_("click",function(){h(t);let n=p();return f(n.toggleDelete())}),s(8,"Hu\u1EF7 B\u1ECF"),a()()(),E()}}function Re(o,e){o&1&&B(0,"mat-spinner",23)}function Ce(o,e){if(o&1){let t=R();r(0,"div",21)(1,"mat-slide-toggle",22),_("change",function(){let n=h(t).$implicit,c=p(3);return f(c.togglePermission(n))}),s(2),a(),x(3,Re,1,0,"mat-spinner",23),a()}if(o&2){let t=e.$implicit,i=p(3);l(),u("disabled",!i.isEdit()||i.isTogglingPermission()===t.id)("checked",t.hasPermission),l(),I(" ",t.name," - (",t.description||"Ch\u01B0a M\xF4 T\u1EA3",") "),l(),F(i.isTogglingPermission()===t.id?3:-1)}}function ve(o,e){if(o&1&&(r(0,"div",18)(1,"h3",19),s(2),a(),r(3,"div",20),P(4,Ce,4,5,"div",21,_e),a()()),o&2){let t=e.$implicit;l(2),D(t.key),l(2),b(t.value)}}function ye(o,e){if(o&1){let t=R();w(0),r(1,"div",14)(2,"mat-form-field",15)(3,"mat-label"),s(4,"T\xEAn Nh\xF3m"),a(),r(5,"input",16),M("ngModelChange",function(n){h(t);let c=p();return k(c.DetailRole.name,n)||(c.DetailRole.name=n),f(n)}),a()()(),r(6,"div",17),P(7,ve,6,1,"div",18,ue),V(9,"keyvalue"),a(),E()}if(o&2){let t=p();l(5),S("ngModel",t.DetailRole.name),u("disabled",!t.isEdit()),l(2),b(L(9,2,t.groupedPermissions()))}}var de=class o{_ListroleComponent=g(me);_RoleService=g(ce);_PermissionService=g(pe);_route=g(W);_router=g(z);_snackBar=g(q);ListPermission=[];filterPermission=[];idRole=0;constructor(){this._route.paramMap.subscribe(e=>d(this,null,function*(){this.idRole=e.get("id")}))}DetailRole={};isEdit=C(!1);isDelete=C(!1);isTogglingPermission=C("");groupedPermissions=C({});groupPermissionsByGroup(e){let t={};return e.forEach(i=>{let n=i.group||"Other";t[n]||(t[n]=[]),t[n].push(i)}),t}ngOnInit(){return d(this,null,function*(){if(yield this._PermissionService.getAllPermission(1e3),this.ListPermission=this._PermissionService.ListPermission(),!this.idRole){this._router.navigate(["/admin/nhomuser"]),this._ListroleComponent.drawer.close();return}this.idRole==="new"?(this._ListroleComponent.drawer.open(),this.isEdit.update(e=>!e),this.filterPermission=this.ListPermission,this.groupedPermissions.set(this.groupPermissionsByGroup(this.filterPermission)),this._router.navigate(["/admin/nhomuser","new"])):(yield this._RoleService.getRoleByid(this.idRole),this.DetailRole=this._RoleService.DetailRole(),this.filterPermission=this.ListPermission.map(e=>y(v({},e),{hasPermission:this.DetailRole?.permissions?.some(t=>t.permissionId===e.id)||!1}))),this.groupedPermissions.set(this.groupPermissionsByGroup(this.filterPermission)),this._ListroleComponent.drawer.open()})}handleRoleAction(){return d(this,null,function*(){this.idRole==="new"?yield this.createRole():yield this.updateRole()})}createRole(){return d(this,null,function*(){console.log(this.DetailRole);try{yield this._RoleService.CreateRole(this.DetailRole),this._snackBar.open("T\u1EA1o M\u1EDBi Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(e=>!e)}catch(e){console.error("L\u1ED7i khi t\u1EA1o role:",e)}})}updateRole(){return d(this,null,function*(){try{yield this._RoleService.updateRole(this.DetailRole),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(e=>!e)}catch(e){console.error("L\u1ED7i khi c\u1EADp nh\u1EADt role:",e)}})}DeleteData(){return d(this,null,function*(){try{yield this._RoleService.DeleteRole(this.DetailRole),this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this._router.navigate(["/admin/nhomuser"])}catch(e){console.error("L\u1ED7i khi x\xF3a role:",e)}})}goBack(){this._router.navigate(["/admin/nhomuser"]),this._ListroleComponent.drawer.close()}trackByFn(e,t){return t.id}toggleEdit(){this.isEdit.update(e=>!e)}toggleDelete(){this.isDelete.update(e=>!e)}FillSlug(){}togglePermission(e){return d(this,null,function*(){let t=e.hasPermission,i=!e.hasPermission;this.isTogglingPermission.set(e.id),e.hasPermission=i;let n=this.groupedPermissions(),c=n[e.group||"Other"].map(m=>m.id===e.id?y(v({},m),{hasPermission:i}):m);this.groupedPermissions.set(y(v({},n),{[e.group||"Other"]:c}));try{let m;i?m=yield this._RoleService.assignPermissionToRole({roleId:this.idRole,permissionId:e.id}):m=yield this._RoleService.removePermissionFromRole({roleId:this.idRole,permissionId:e.id}),m||(e.hasPermission=t,this._snackBar.open(`L\u1ED7i khi ${i?"g\xE1n":"x\xF3a"} quy\u1EC1n. Vui l\xF2ng th\u1EED l\u1EA1i.`,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}))}catch(m){e.hasPermission=t,console.error("Error toggling permission:",m),this._snackBar.open(`L\u1ED7i khi ${i?"g\xE1n":"x\xF3a"} quy\u1EC1n: ${m}`,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isTogglingPermission.set("")}})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=T({type:o,selectors:[["app-detailrole"]],decls:17,vars:8,consts:[[1,"flex","flex-row","justify-between","items-center","space-x-2","p-2"],["mat-icon-button","","color","primary",3,"click"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center"],[3,"ngModelChange","ngModel","disabled"],["mat-icon-button","","color","primary",3,"click",4,"ngIf"],["mat-icon-button","","color","warn",3,"click"],[1,"relative","flex","flex-col","w-full","p-4","overflow-auto"],[4,"ngIf"],[1,"flex","flex-col","space-y-4","items-center","justify-center"],[1,"font-bold","text-2xl"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],[1,"w-full","flex","flex-col","space-y-2"],["appearance","outline"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp T\xEAn Nh\xF3m",3,"ngModelChange","ngModel","disabled"],[1,"space-y-6"],[1,"border-b","pb-4"],[1,"text-lg","font-semibold","mb-3","text-blue-600"],[1,"grid","grid-cols-3","gap-2"],[1,"flex","items-center","space-x-2"],[3,"change","disabled","checked"],["diameter","16",1,"ml-2"]],template:function(t,i){t&1&&(r(0,"div",0)(1,"button",1),_("click",function(){return i.goBack()}),r(2,"mat-icon"),s(3,"arrow_back"),a()(),r(4,"div",2),s(5),a(),r(6,"div",3)(7,"mat-slide-toggle",4),M("ngModelChange",function(c){return k(i.DetailRole.isActive,c)||(i.DetailRole.isActive=c),c}),s(8),a(),x(9,ge,3,0,"button",5)(10,he,3,0,"button",5),r(11,"button",6),_("click",function(){return i.toggleDelete()}),r(12,"mat-icon"),s(13,"delete"),a()()()(),r(14,"div",7),x(15,fe,9,0,"ng-container",8)(16,ye,10,4,"ng-container",8),a()),t&2&&(l(5),D((i.DetailRole==null?null:i.DetailRole.name)||"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),l(2),S("ngModel",i.DetailRole.isActive),u("disabled",!i.isEdit()),l(),D(i.DetailRole.isActive?"Hi\u1EC3n Th\u1ECB":"\u1EA8n"),l(),u("ngIf",i.isEdit()),l(),u("ngIf",!i.isEdit()),l(5),u("ngIf",i.isDelete()),l(),u("ngIf",!i.isDelete()))},dependencies:[te,ee,Z,ne,ie,U,X,J,Q,K,H,$,j,O,oe,Y,G,A,N,se,le,ae,re],encapsulation:2})};export{de as DetailRoleComponent};
