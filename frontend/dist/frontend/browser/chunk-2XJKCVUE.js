import{a as Ut}from"./chunk-T6BS64XY.js";import{a as Wt}from"./chunk-PH47GWHC.js";import{a as Xt}from"./chunk-YUYKQQ36.js";import"./chunk-ZUSEYSZF.js";import{a as Zt}from"./chunk-TZLAMMV7.js";import"./chunk-MC2RAUNI.js";import"./chunk-4ZVJO4SQ.js";import{c as Tt,d as Ft,f as Mt,h as Nt}from"./chunk-NTZ35MHO.js";import{a as Yt}from"./chunk-WQSYOWXA.js";import{c as Jt,f as Qt}from"./chunk-UECSKQ7N.js";import{a as Ht,b as Rt,c as jt,d as Kt,e as Gt,g as $t,w as qt,x as Z}from"./chunk-MYM4UK25.js";import{b as zt}from"./chunk-SUUFLDBI.js";import{a as yt,b as _t,c as Ct}from"./chunk-TUUIXDG3.js";import{b as Ot}from"./chunk-3SUPS45N.js";import{a as ne}from"./chunk-JNVUT6FC.js";import{a as St,b as bt,c as Et,d as wt}from"./chunk-4ETYZZG2.js";import{a as xt,b as J}from"./chunk-TQZJPPHT.js";import{b as vt,g as Lt,j as Dt,n as kt,r as It,v as Pt,w as Vt,y as Bt,z as At}from"./chunk-627BQ4TO.js";import"./chunk-DMBE3M7H.js";import"./chunk-Q7E7WSHM.js";import{a as q}from"./chunk-22VEXDJN.js";import"./chunk-ON6I326D.js";import"./chunk-PI2XNKI3.js";import{a as gt,c as ft,e as $}from"./chunk-NSRGTP2H.js";import"./chunk-2PPFUFFT.js";import{y as ht,z as pt}from"./chunk-OGZGEGDS.js";import{b as ct,c as dt}from"./chunk-QDKCYXS4.js";import"./chunk-3PUGGYB4.js";import{l as R,m as j,t as K,u as G}from"./chunk-5AAE55N6.js";import{Ac as z,Eb as V,Ec as H,Fc as u,Gc as I,Hc as C,Ic as at,Ja as tt,Jc as rt,Kc as ot,Lb as v,Lc as st,Mc as lt,Oc as ut,Uc as k,Vb as f,Wc as T,Yc as X,Zb as et,dc as it,ec as nt,fc as o,gc as s,hc as B,lc as w,ld as mt,oa as b,qc as y,rb as m,sc as h,wa as U,xa as p,ya as g,yc as A,zc as O}from"./chunk-JY44QJM2.js";import"./chunk-EU2KAMEK.js";import{a as D,b as P,g as ie,h as W,j as E}from"./chunk-6DYNGEAS.js";function se(c,e){if(c&1){let t=w();o(0,"th",8),y("click",function(){let n=p(t).$implicit,a=h();return g(a.FilterTable("",n))}),u(1),s()}if(c&2){let t=e.$implicit;m(),C(" ",t.name," ")}}function le(c,e){if(c&1){let t=w();o(0,"div",16),y("blur",function(n){p(t);let a=h().$implicit,r=h().index,l=h();return g(l.updateBlur(n,l.filterListSP[r],a))})("keyup.enter",function(n){p(t);let a=h().$implicit,r=h().index,l=h();return g(l.updateEnter(n,l.filterListSP[r],a))}),u(1),k(2,"number"),s()}if(c&2){let t=h().$implicit,i=h().index,n=h();f("contentEditable",!0),m(),C(" ",T(2,2,n.getSLDat(t,n.filterListSP[i]),"1.0-2")," ")}}function ue(c,e){if(c&1&&(o(0,"td",12),v(1,le,3,5,"div",15),s()),c&2){let t=e.$implicit,i=h().index,n=h();m(),f("ngIf",n.CheckSanphaminNCC(t,n.filterListSP[i]))}}function me(c,e){if(c&1){let t=w();o(0,"tr",9)(1,"td",10),y("click",function(){let n=p(t).$implicit,a=h();return g(a.FilterTable(n,""))}),o(2,"span",11),u(3),s()(),o(4,"td",12)(5,"span",13),u(6),s()(),o(7,"td",12)(8,"span",13),u(9),s()(),v(10,ue,2,1,"td",14),s()}if(c&2){let t=e.$implicit,i=h();m(3),C(" ",t.title," "),m(3),C(" ",t.masp," "),m(3),at(" ",t.goiy," (",i.DadatGoiy(t)||0,") "),m(),f("ngForOf",i.filterListNCC)}}var Q=class c{ListFindNCC=[];EditList=[];ListDathang=[];ListDathangChange=new tt;_snackBar=b(q);filterListNCC=[];filterListSP=[];ngAfterViewInit(){this.LoadTable(this.ListFindNCC,this.EditList),console.log("ListFindNCC",this.ListFindNCC),console.log("EditList",this.EditList)}LoadTable(e,t){let i=1;this.filterListNCC=e,this.filterListSP=t,this.filterListSP.forEach(n=>{let a=this.filterListNCC.findIndex(r=>r.Sanpham.some(l=>l.id===n.id));a!==-1&&this.filterListNCC[a].vitri===void 0&&(this.filterListNCC[a].vitri=i,i++)}),this.filterListNCC.sort((n,a)=>n.vitri&&a.vitri?n.vitri-a.vitri:0)}isFilter=!1;FilterTable(e,t){if(this.isFilter=!this.isFilter,this.isFilter){if(e&&Object.keys(e).length>0){let i=this.EditList.filter(a=>a.id===e.id),n=this.ListFindNCC.filter(a=>a.Sanpham.some(r=>r.id===e.id));this.LoadTable(n,i)}else if(t&&Object.keys(t).length>0){let i=this.ListFindNCC.filter(a=>a.id===t.id);i.forEach(a=>{let r=this.filterListSP.filter(l=>a.Sanpham.some(x=>x.id===l.id)).map(l=>P(D({},l),{sldat:Number(l.goiy)}));r.length>0&&(a.sanpham=r)});let n=this.ListDathang.findIndex(a=>a.id===t.id);n!==-1?this.ListDathang[n]=D(D({},this.ListDathang[n]),i[0]):this.ListDathang.push(i[0]),console.log("sanpham",e),console.log("nhacungcap",t),console.log("ListDathang",this.ListDathang),this.ListDathangChange.emit({isSubmit:!1,ListDathang:this.ListDathang}),this.LoadTable(i,i[0].sanpham)}}else this.LoadTable(this.ListFindNCC,this.EditList)}ngOnChanges(e){(e.ListFindNCC||e.EditList)&&this.LoadTable(this.ListFindNCC,this.EditList)}getSLDat(e,t){let i=e.sanpham?.find(n=>n.id===t.id);return i&&i.sldat||0}DadatGoiy(e){let t=this.ListDathang.reduce((i,n)=>{let a=n.sanpham?.find(r=>r.id===e.id);return i+(a?.sldat?Number(a.sldat):0)},0);return(Number(e.goiy)-t).toFixed(2)}trackByFn(e,t){return t.id}CheckSanphaminNCC(e,t){return!!e.Sanpham?.find(n=>n.id===t.id)}updateEnter(e,t,i){let n=["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Home","End"];if(!(e.key>="0"&&e.key<="9"||e.key>="Numpad0"&&e.key<="Numpad9"||n.includes(e.key))){e.preventDefault();return}if(e.key==="Enter"){e.preventDefault();let a=e.target.closest(".sldat-input"),r=0;if(a){let d=a.value||a.innerText;r=Number(d.trim())||0}let l=JSON.parse(JSON.stringify(this.ListDathang)),x=l.find(d=>d.id===i.id);if(x){let d=x.sanpham?.find(_=>_.id===t.id);d?d.sldat=r:(t.sldat=r,x.sanpham=x.sanpham||[],x.sanpham.push(t))}else t.sldat=r,i.sanpham=[t],i.ngaynhan=new Date,l.push(i);let S=(()=>{let d=l.reduce((_,M)=>{let N=M.sanpham?.find(Y=>Y.id===t.id);return _+(N?.sldat?Number(N.sldat):0)},0);return(Number(t.goiy)-d).toFixed(2)})();if(Number(S)<0){this._snackBar.open("S\u1ED1 l\u01B0\u1EE3ng kh\xF4ng h\u1EE3p l\u1EC7","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}let L=this.ListDathang.find(d=>d.id===i.id);if(L){let d=L.sanpham?.find(_=>_.id===t.id);d?d.sldat=r:(t.sldat=r,L.sanpham=L.sanpham||[],L.sanpham.push(t))}else t.sldat=r,i.sanpham=[t],i.ngaynhan=new Date,this.ListDathang.push(i);setTimeout(()=>{let d=Array.from(document.querySelectorAll(".sldat-input")),_=d.findIndex(M=>M===e.target);_!==-1&&_+1<d.length&&d[_+1].focus()}),this.ListDathangChange.emit({isSubmit:!1,ListDathang:this.ListDathang})}}updateBlur(e,t,i){let n=e.target.closest(".sldat-input"),a=0;if(n){let d=n.value||n.innerText;a=Number(d.trim())||0}console.log("newValue",a);let r=JSON.parse(JSON.stringify(this.ListDathang)),l=r.find(d=>d.id===i.id);if(l){let d=l.sanpham?.find(_=>_.id===t.id);d?d.sldat=a:(t.sldat=a,l.sanpham=l.sanpham||[],l.sanpham.push(t))}else t.sldat=a,i.sanpham=[t],i.ngaynhan=new Date,r.push(i);let x=(()=>{let d=r.reduce((_,M)=>{let N=M.sanpham?.find(Y=>Y.id===t.id);return _+(N?.sldat?Number(N.sldat):0)},0);return(Number(t.goiy)-d).toFixed(2)})();if(Number(x)<0){this._snackBar.open("S\u1ED1 l\u01B0\u1EE3ng kh\xF4ng h\u1EE3p l\u1EC7","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}let S=this.ListDathang.find(d=>d.id===i.id),L=0;if(S){let d=S.sanpham?.find(_=>_.id===t.id);d&&(L=d.sldat||0)}if(a!==L){if(S){let d=S.sanpham?.find(_=>_.id===t.id);d?d.sldat=a:(t.sldat=a,S.sanpham=S.sanpham||[],S.sanpham.push(t))}else t.sldat=a,i.sanpham=[t],i.ngaynhan=new Date,this.ListDathang.push(i);this.ListDathangChange.emit({isSubmit:!1,ListDathang:this.ListDathang}),console.log(this.ListDathang)}}static \u0275fac=function(t){return new(t||c)};static \u0275cmp=V({type:c,selectors:[["app-tablenhucaudathanh"]],inputs:{ListFindNCC:"ListFindNCC",EditList:"EditList",ListDathang:"ListDathang"},outputs:{ListDathangChange:"ListDathangChange"},features:[U],decls:13,vars:3,consts:[[1,"min-w-full","divide-y","divide-gray-200","border","border-gray-300","rounded-lg","shadow-md"],[1,"bg-gray-50","rounded-t-lg","cursor-pointer"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider","first:rounded-tl-lg","last:rounded-tr-lg"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],["scope","col","class","px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hover:bg-slate-50",3,"click",4,"ngFor","ngForOf"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider","last:rounded-tr-lg"],[1,"bg-white","divide-y","divide-gray-200","rounded-b-lg"],["class","last:rounded-b-lg cursor-pointer hover:bg-slate-50",4,"ngFor","ngForOf","ngForTrackBy"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider","hover:bg-slate-50",3,"click"],[1,"last:rounded-b-lg","cursor-pointer","hover:bg-slate-50"],[1,"whitespace-nowrap","first:rounded-bl-lg",3,"click"],[1,"max-w-40","line-clamp-4","p-2"],[1,"whitespace-nowrap"],[1,"max-w-40","line-clamp-4"],["class","whitespace-nowrap",4,"ngFor","ngForOf"],["class","sldat-input p-2 min-w-28 text-end bg-slate-200 focus:border rounded-lg focus:border-blue-600 focus:bg-slate-100 focus:outline-none",3,"contentEditable","blur","keyup.enter",4,"ngIf"],[1,"sldat-input","p-2","min-w-28","text-end","bg-slate-200","focus:border","rounded-lg","focus:border-blue-600","focus:bg-slate-100","focus:outline-none",3,"blur","keyup.enter","contentEditable"]],template:function(t,i){t&1&&(o(0,"table",0)(1,"thead",1)(2,"tr")(3,"th",2),u(4," T\xEAn S\u1EA3n Ph\u1EA9m "),s(),o(5,"th",3),u(6," M\xE3 S\u1EA3n Ph\u1EA9m "),s(),o(7,"th",3),u(8," G\u1EE3i \xDD "),s(),v(9,se,2,1,"th",4),B(10,"th",5),s()(),o(11,"tbody",6),v(12,me,11,5,"tr",7),s()()),t&2&&(m(9),f("ngForOf",i.filterListNCC),m(3),f("ngForOf",i.filterListSP)("ngForTrackBy",i.trackByFn))},dependencies:[G,R,j,K,J,$],encapsulation:2,changeDetection:0})};var ee=ie(ne());var ce=["drawer"],de=()=>({standalone:!0}),he=(c,e)=>e.key;function pe(c,e){if(c&1){let t=w();o(0,"button",44),y("click",function(n){let a=p(t).$implicit;return h().toggleColumn(a),g(n.stopPropagation())}),o(1,"mat-icon"),u(2),s(),o(3,"span"),u(4),s()()}if(c&2){let t=e.$implicit;m(2),I(t.isShow?"check_box":"check_box_outline_blank"),m(2),I(t.value)}}function ge(c,e){if(c&1){let t=w();o(0,"button",45),y("click",function(){p(t);let n=h(),a=H(90);return g(n.OpenTaodonDialog(a))}),u(1," T\u1EA1o M\u1EDBi "),s()}}function fe(c,e){if(c&1){let t=w();o(0,"tr",46),y("click",function(){let n=p(t).$implicit,a=h();return g(a.AddToEdit(n))}),o(1,"td",47),u(2),s(),o(3,"td",47),u(4),s(),o(5,"td",47),u(6),s(),o(7,"td",48),u(8),k(9,"number"),s(),o(10,"td",48),u(11),k(12,"number"),s(),o(13,"td",48),u(14),k(15,"number"),s(),o(16,"td",48),u(17),k(18,"number"),s(),o(19,"td",48),u(20),s()()}if(c&2){let t=e.$implicit,i=h();et("hover:bg-slate-100 ",i.CheckItemInEdit(t)?"!bg-slate-200":"",""),m(2),C(" ",t.masp," "),m(2),C(" ",t.title," "),m(2),C(" ",t.dvt," "),m(2),C(" ",T(9,11,t.slchogiao,"1.0-2")," "),m(3),C(" ",T(12,14,t.goiy,"1.0-2")," "),m(3),C(" ",T(15,17,t.slchonhap,"1.0-2")," "),m(3),C(" ",T(18,20,t.slton,"1.0-2")," "),m(3),C(" ",t.haohut,"% ")}}function ye(c,e){c&1&&(o(0,"tr")(1,"td",49),u(2," Kh\xF4ng t\xECm th\u1EA5y d\u1EEF li\u1EC7u "),s()())}function _e(c,e){c&1&&(o(0,"mat-dialog-content")(1,"div",50)(2,"div",51),u(3,"X\xE1c Nh\u1EADn"),s(),o(4,"div"),u(5,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),s(),o(6,"div",52)(7,"button",53),u(8,"\u0110\u1ED3ng \xDD"),s(),o(9,"button",54),u(10,"Hu\u1EF7 B\u1ECF"),s()()()())}function Ce(c,e){if(c&1){let t=w();o(0,"button",41),y("click",function(){p(t);let n=h(2);return g(n.CheckSubmit())}),u(1,"Ki\u1EC3m Tra"),s()}}function xe(c,e){c&1&&(o(0,"button",53),u(1,"\u0110\u1ED3ng \xDD"),s())}function Se(c,e){c&1&&(o(0,"button",54),u(1,"Hu\u1EF7 B\u1ECF"),s())}function be(c,e){if(c&1){let t=w();o(0,"mat-dialog-content",55)(1,"div",56)(2,"div",57),u(3,"\u0110\u1EB7t h\xE0ng nh\xE0 cung c\u1EA5p"),s(),o(4,"div",58)(5,"app-tablenhucaudathanh",59),y("ListDathangChange",function(n){p(t);let a=h();return g(a.onListDathangChange(n))}),s()(),o(6,"div",52),v(7,Ce,2,0,"button",60)(8,xe,2,0,"button",61)(9,Se,2,0,"button",62),s()()()}if(c&2){let t=h();m(5),f("ListFindNCC",t.ListFindNCC)("EditList",t.EditList)("ListDathang",t.ListDathang),m(2),f("ngIf",!t.isSubmit),m(),f("ngIf",t.isSubmit),m(),f("ngIf",t.isSubmit)}}var F=class F{displayedColumns=["title","masp","giagoc","dvt","slton","slchogiao","slchonhap","haohut","goiy"];ColumnName={title:"T\xEAn S\u1EA3n Ph\u1EA9m",masp:"M\xE3 S\u1EA3n Ph\u1EA9m",giagoc:"Gi\xE1 G\u1ED1c",dvt:"\u0110\u01A1n V\u1ECB T\xEDnh",slton:"T\u1ED3n",slchogiao:"Ch\u1EDD Giao",slchonhap:"Ch\u1EDD Nh\u1EADp",haohut:"Hao H\u1EE5t",goiy:"G\u1EE3i \xDD"};FilterColumns=JSON.parse(localStorage.getItem("NhucauColFilter")||"[]");Columns=[];totalItems=0;pageSize=10;currentPage=1;totalPages=1;paginator;sort;drawer;filterValues={};_SanphamService=b(Zt);_breakpointObserver=b(ht);_GoogleSheetService=b(Yt);_NhacungcapService=b(Xt);_DathangService=b(Wt);_KhoService=b(Ut);_router=b(dt);_dialog=b(Tt);Listsanpham=this._SanphamService.ListSanpham;EditList=[];dataSource=new Z;sanphamId=this._SanphamService.sanphamId;_snackBar=b(q);CountItem=0;isSearch=!1;constructor(){this.displayedColumns.forEach(e=>{this.filterValues[e]=""}),mt(()=>{this.dataSource.data=this.Listsanpham(),this.totalItems=this.Listsanpham().length,this.calculateTotalPages()})}GetGoiy(e){return parseFloat(((e.soluongkho-e.soluong)*(1+e.haohut/100)).toString()).toFixed(2)}applyFilter(e){let t=e.target.value;this.dataSource.filter=t.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}ngOnInit(){return E(this,null,function*(){this.updateDisplayData(),this._SanphamService.listenSanphamUpdates(),yield this._SanphamService.getNhucau(),this.dataSource=new Z(this.Listsanpham()),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.initializeColumns(),this.setupDrawer()})}refresh(){return E(this,null,function*(){yield this._SanphamService.getAllSanpham()})}initializeColumns(){this.Columns=Object.keys(this.ColumnName).map(e=>({key:e,value:this.ColumnName[e],isShow:!0})),this.FilterColumns.length===0?this.FilterColumns=this.Columns:localStorage.setItem("NhucauColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{})}setupDrawer(){this._breakpointObserver.observe([pt.Handset]).subscribe(e=>{e.matches?this.drawer.mode="over":this.drawer.mode="side"})}toggleColumn(e){let t=this.FilterColumns.find(i=>i.key===e.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}FilterHederColumn(e,t){return e.filter((n,a,r)=>a===r.findIndex(l=>l[t]===n[t]))}doFilterHederColumn(e,t){this.dataSource.filteredData=this.Listsanpham().filter(n=>n[t].toLowerCase().includes(e.target.value.toLowerCase()));let i=e.target.value.toLowerCase()}ListFilter=[];ChosenItem(e,t){let i=this.dataSource.filteredData.filter(a=>a[t]===e[t]);this.ListFilter.filter(a=>a[t]===e[t]).length>0?this.ListFilter=this.ListFilter.filter(a=>a[t]!==e[t]):this.ListFilter=[...this.ListFilter,...i]}ChosenAll(e){e.forEach(t=>{!!this.ListFilter.find(n=>n.id===t.id)?this.ListFilter=this.ListFilter.filter(n=>n.id!==n.id):this.ListFilter.push(t)})}ResetFilter(){this.ListFilter=this.Listsanpham(),this.dataSource.data=this.Listsanpham(),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}EmptyFiter(){this.ListFilter=[]}CheckItem(e){return!!this.ListFilter.find(t=>t.id===e.id)}ApplyFilterColum(e){this.dataSource.data=this.Listsanpham().filter(t=>this.ListFilter.some(i=>i.id===t.id)),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,e.closeMenu()}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("NhucauColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(i=>i.value.toLowerCase().includes(t))}create(){this.drawer.open(),this._router.navigate(["admin/sanpham","new"])}ListSPNCC=[];openDeleteDialog(e){return E(this,null,function*(){this._dialog.open(e,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(i=>{i=="true"&&this.DeleteListItem()})})}DeleteListItem(){this.EditList.forEach(e=>{this._SanphamService.DeleteSanpham(e)}),this.EditList=[],this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}ListFindNCC=[];ListDathang=[];isSubmit=!1;onListDathangChange(e){console.log(e),this.isSubmit=e.isSubmit,this.ListDathang=e.ListDathang,console.log(this.ListDathang)}CheckSubmit(){let e=this.ListDathang.some(t=>(t.sanpham||[]).some(i=>Number(i.sldat)<0));return console.log(e),console.log(this.ListDathang),e?(this._snackBar.open("C\xF3 s\u1EA3n ph\u1EA9m c\xF3 s\u1ED1 l\u01B0\u1EE3ng \u0111\u1EB7t \xE2m!","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),this.isSubmit=!1,!1):(this.isSubmit=!0,!0)}OpenTaodonDialog(e){return E(this,null,function*(){this.ListFindNCC=yield this._NhacungcapService.Findbyids(this.EditList.map(i=>i.id)),this.EditList=this.EditList.filter(i=>this.ListFindNCC.some(n=>n.Sanpham.some(a=>a.id===i.id))),this._dialog.open(e,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(i=>{i=="true"&&(console.log(this.ListDathang),E(this,null,function*(){for(let n of this.ListDathang)yield this._DathangService.CreateByNhucau(n),yield new Promise(a=>setTimeout(a,100))}).then(()=>{this._snackBar.open("T\u1EA1o M\u1EDBi \u0111\u1EB7t h\xE0ng th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this._router.navigate(["/admin/dathang"])}).catch(n=>{this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi T\u1EA1o M\u1EDBi \u0111\u1EB7t h\xE0ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),console.error("Error creating orders:",n)}))})})}CheckSanphaminNCC(e,t){return!!e.Sanpham?.find(n=>n.id===t.id)}updateValue(e,t,i){let n=Number(e.target.innerText.trim())||0,a=this.ListDathang.find(r=>r.id===i.id);if(console.log(a),a){let r=a.sanpham.find(l=>l.id===t.id);r?r.sldat=n:(t.sldat=n,a.Sanpham.push(t))}else t.sldat=n,i.sanpham=[t],i.ngaynhan=new Date,this.ListDathang.push(i);console.log(this.ListDathang)}AddToEdit(e){this.EditList.find(i=>i.id===e.id)?this.EditList=this.EditList.filter(i=>i.id!==e.id):this.EditList.push(e)}ChoseAllEdit(){this.EditList=this.Listsanpham()}CheckItemInEdit(e){return this.EditList.some(t=>t.id===e.id)}goToDetail(e){this.drawer.open(),this._SanphamService.setSanphamId(e.id),this._router.navigate(["admin/sanpham",e.id])}LoadDrive(){return E(this,null,function*(){let e={IdSheet:"15npo25qyH5FmfcEjl1uyqqyFMS_vdFnmxM_kt0KYmZk",SheetName:"SPImport",ApiKey:"AIzaSyD33kgZJKdFpv1JrKHacjCQccL_O0a2Eao"},t=yield this._GoogleSheetService.getDrive(e),i=zt(t.values);this.DoImportData(i)})}DoImportData(e){return E(this,null,function*(){let t=e.map(l=>({title:l.title?.trim()||"",masp:l.masp?.trim()||"",giagoc:Number(l.giagoc)||0,dvt:l.dvt?.trim()||"",soluong:Number(l.soluong)||0,soluongkho:Number(l.soluongkho)||0,haohut:Number(l.haohut)||0,ghichu:l.ghichu?.trim()||""})),i=Array.from(new Map(t.map(l=>[l.masp,l])).values()),n=this._SanphamService.ListSanpham(),a=n.map(l=>l.masp),r=i.map(l=>l.masp).filter(l=>!a.includes(l));yield Promise.all(i.map(l=>E(this,null,function*(){let x=n.find(S=>S.masp===l.masp);if(x){let S=D(D({},x),l);yield this._SanphamService.updateSanpham(S)}else yield this._SanphamService.CreateSanpham(l)}))),yield Promise.all(n.filter(l=>!i.some(x=>x.masp===l.masp)).map(l=>this._SanphamService.updateSanpham(P(D({},l),{isActive:!1})))),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ImporExcel(e){return E(this,null,function*(){let t=yield Qt(e);this.DoImportData(t)})}ExportExcel(e,t){return E(this,null,function*(){let i=yield this._KhoService.getAllKho();console.log(e);let n=e.map(r=>({ngaynhan:(0,ee.default)().format("YYYY-MM-DD"),mancc:r.mancc||"",nhacungcap:r.nhacungcap||"",masp:r.masp,title:r.title,dvt:r.dvt,slchogiao:r.slchogiao,goiy:r.goiy,slchonhap:r.slchonhap,slton:r.slton,haohut:r.haohut,ghichu:r.ghichu})),a={ngaynhan:"Ng\xE0y Nh\u1EADn",mancc:"M\xE3 Nh\xE0 Cung C\u1EA5p",nhacungcap:"Nh\xE0 Cung C\u1EA5p",masp:"M\xE3 S\u1EA3n Ph\u1EA9m",title:"T\xEAn S\u1EA3n Ph\u1EA9m",dvt:"\u0110\u01A1n V\u1ECB T\xEDnh",slchogiao:"Ch\u1EDD Giao",goiy:"G\u1EE3i \xDD",slchonhap:"Ch\u1EDD Nh\u1EADp",slton:"T\u1ED3n Kho",haohut:"Hao H\u1EE5t",ghichu:"Ghi Ch\xFA"};i.forEach(r=>{a[`makho_${r.makho}`]=r.makho}),Jt(n,t,Object.values(a),a)})}trackByFn(e,t){return t.id}calculateTotalPages(){this.totalPages=Math.ceil(this.totalItems/this.pageSize)}onPageSizeChange(e,t){e>this.Listsanpham().length?(this.pageSize=this.Listsanpham().length,this._snackBar.open(`S\u1ED1 l\u01B0\u1EE3ng t\u1ED1i \u0111a ${this.Listsanpham().length}`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})):this.pageSize=e,this.currentPage=1,this.calculateTotalPages(),this.updateDisplayData(),t.closeMenu()}onPreviousPage(){this.currentPage>1&&(this.currentPage--,this.updateDisplayData())}onNextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.updateDisplayData())}updateDisplayData(){let e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize,i=this.Listsanpham().slice(e,t);this.dataSource.data=i}static \u0275fac=function(t){return new(t||F)};static \u0275cmp=V({type:F,selectors:[["app-nhucaudathang"]],viewQuery:function(t,i){if(t&1&&(A(jt,5),A(Gt,5),A(ce,7)),t&2){let n;O(n=z())&&(i.paginator=n.first),O(n=z())&&(i.sort=n.first),O(n=z())&&(i.drawer=n.first)}},decls:91,vars:18,consts:[["drawer",""],["menu","matMenu"],["uploadfile",""],["menuHienthi","matMenuTrigger"],["DeleteDialog",""],["TaodonDialog",""],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","lg:!w-1/2","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-16","w-full","p-2"],[1,"border","p-1","cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","bg-white","rounded-lg"],[1,"w-full","flex","flex-row","space-x-2","items-center"],[1,"relative"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["matTooltip","T\u1EA3i file excel M\u1EABu","color","primary","mat-icon-button","",3,"click"],["type","file",1,"hidden",3,"change"],[1,"lg:flex","hidden","whitespace-","p-2","rounded-lg","bg-slate-200",3,"click"],["color","primary","mat-flat-button","",3,"click",4,"ngIf"],[1,"border","rounded-lg","w-full","h-full","overflow-auto"],[1,"!border","w-full","cursor-pointer"],[1,"bg-gray-50","sticky","top-0"],[1,"px-4","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider","whitespace-nowrap"],[1,"bg-white","divide-y","divide-gray-200"],[3,"class","click",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"cursor-pointer","border","rounded-lg","px-3","p-1","flex","flex-row","space-x-2","items-center","justify-between"],[1,"w-full","flex","lg:p-0","p-2","lg:flex-row","lg:space-x-2","lg:items-center","lg:justify-between","flex-col","justify-center"],[1,"w-full","text-center"],[1,"w-full","flex","flex-row","space-x-2","items-center","lg:justify-end","justify-center"],[1,"font-bold","text-blue-600",3,"matMenuTriggerFor"],[1,"w-full","flex","flex-col","space-y-2","p-4",3,"click"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp S\u1ED1 L\u01B0\u1EE3ng",3,"ngModelChange","ngModel","ngModelOptions"],["mat-flat-button","","color","primary",3,"click"],[1,"pagination-controls"],["mat-icon-button","","color","primary",3,"click","disabled"],["mat-menu-item","",3,"click"],["color","primary","mat-flat-button","",3,"click"],[3,"click"],[1,"px-4","py-4","whitespace-nowrap","text-sm","text-gray-900"],[1,"px-4","py-4","whitespace-nowrap","text-sm","text-gray-900","text-right"],["colspan","9",1,"px-4","py-4","text-center","text-sm","text-gray-500"],[1,"flex","flex-col","space-y-8","items-center","justify-center"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary","mat-dialog-close","true"],["mat-flat-button","","color","warn","mat-dialog-close","false"],[1,"!max-h-[90vh]","!h-[90vh]","!w-[90vw]"],[1,"h-full","w-full","flex","flex-col","space-y-8","items-center"],[1,"flex","font-bold"],[1,"flex","h-full","w-full","overflow-auto"],[3,"ListDathangChange","ListFindNCC","EditList","ListDathang"],["mat-flat-button","","color","primary",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","mat-dialog-close","true",4,"ngIf"],["mat-flat-button","","color","warn","mat-dialog-close","false",4,"ngIf"]],template:function(t,i){if(t&1){let n=w();o(0,"mat-drawer-container",6)(1,"mat-drawer",7,0),B(3,"router-outlet"),s(),o(4,"div",8)(5,"div",9)(6,"div",10)(7,"div",11)(8,"input",12),y("keyup",function(r){return p(n),g(i.applyFilter(r))}),s(),o(9,"div",13)(10,"span",14),u(11,"search"),s()()(),o(12,"button",15)(13,"mat-icon"),u(14,"tune"),s()(),o(15,"mat-menu",null,1)(17,"div",16)(18,"mat-form-field",17)(19,"input",18),y("input",function(r){return p(n),g(i.doFilterColumns(r))})("click",function(r){return p(n),g(r.stopPropagation())}),s(),o(20,"mat-icon",19),u(21,"search"),s()()(),o(22,"div",20),it(23,pe,5,2,"button",21,he),s()(),o(25,"button",22),y("click",function(){return p(n),g(i.ExportExcel(i.dataSource.data,"Tonghop"))}),o(26,"mat-icon"),u(27,"file_download"),s()(),o(28,"input",23,2),y("change",function(r){return p(n),g(i.ImporExcel(r))}),s(),o(30,"span",24),y("click",function(){return p(n),g(i.ChoseAllEdit())}),u(31),s(),v(32,ge,2,0,"button",25),s()(),o(33,"div",26)(34,"div",26)(35,"table",27)(36,"thead",28)(37,"tr")(38,"th",29),u(39," M\xE3 S\u1EA3n Ph\u1EA9m "),s(),o(40,"th",29),u(41," T\xEAn S\u1EA3n Ph\u1EA9m "),s(),o(42,"th",29),u(43," \u0110\u01A1n V\u1ECB T\xEDnh "),s(),o(44,"th",29),u(45," SL \u0110\u1EB7t "),s(),o(46,"th",29),u(47," SL C\u1EA7n \u0110\u1EB7t "),s(),o(48,"th",29),u(49," SL B\xE1n "),s(),o(50,"th",29),u(51," T\u1ED3n "),s(),o(52,"th",29),u(53," Hao H\u1EE5t "),s()()(),o(54,"tbody",30),v(55,fe,21,23,"tr",31)(56,ye,3,0,"tr",32),s()()()(),o(57,"div",33)(58,"div",34)(59,"span",35),u(60,"\u0110ang Xem "),o(61,"strong"),u(62),s(),u(63," - "),o(64,"strong"),u(65),s(),u(66),s(),o(67,"div",36)(68,"span",37,3),u(70),s(),o(71,"mat-menu",null,1)(73,"div",38),y("click",function(r){return p(n),g(r.stopPropagation())}),o(74,"span"),u(75,"S\u1ED1 L\u01B0\u1EE3ng"),s(),o(76,"mat-form-field",39)(77,"input",40),lt("ngModelChange",function(r){return p(n),st(i.pageSize,r)||(i.pageSize=r),g(r)}),s()(),o(78,"button",41),y("click",function(){p(n);let r=H(69);return g(i.onPageSizeChange(i.pageSize,r))}),u(79,"\xC1p D\u1EE5ng"),s()()(),o(80,"div",42)(81,"button",43),y("click",function(){return p(n),g(i.onPreviousPage())}),o(82,"mat-icon"),u(83,"keyboard_arrow_left"),s()(),o(84,"button",43),y("click",function(){return p(n),g(i.onNextPage())}),o(85,"mat-icon"),u(86,"keyboard_arrow_right"),s()()()()()()()(),v(87,_e,11,0,"ng-template",null,4,X)(89,be,10,6,"ng-template",null,5,X)}if(t&2){let n=H(16);m(),f("position","end"),m(11),f("matMenuTriggerFor",n),m(11),nt(i.FilterColumns),m(8),C(" ",i.Listsanpham().length," S\u1EA3n Ph\u1EA9m "),m(),f("ngIf",i.EditList.length>0),m(23),f("ngForOf",i.dataSource.filteredData),m(),f("ngIf",i.dataSource.filteredData.length===0),m(6),I((i.currentPage-1)*i.pageSize+1),m(3),I(i.currentPage*i.pageSize>i.totalItems?i.totalItems:i.currentPage*i.pageSize),m(),rt(" trong s\u1ED1 ",i.totalItems," m\u1EE5c, ",i.currentPage,"/",i.totalPages," Trang"),m(2),f("matMenuTriggerFor",n),m(2),C("Hi\u1EC7n Th\u1ECB : ",i.pageSize," m\u1EE5c"),m(7),ot("ngModel",i.pageSize),f("ngModelOptions",ut(17,de)),m(4),f("disabled",i.currentPage===1),m(3),f("disabled",i.currentPage===i.totalPages)}},dependencies:[Vt,Pt,It,At,Bt,qt,$t,Kt,wt,bt,St,Et,Ct,yt,_t,ct,J,xt,$,gt,ft,Ot,G,R,j,K,kt,vt,Lt,Dt,Rt,Ht,Nt,Ft,Mt,Q],encapsulation:2,changeDetection:0})};W([Ee()],F.prototype,"FilterHederColumn",1),W([we(300)],F.prototype,"doFilterHederColumn",1);var te=F;function Ee(){return function(c,e,t){let i=t.value,n=new Map;return t.value=function(...a){let r=JSON.stringify(a);if(n.has(r))return n.get(r);let l=i.apply(this,a);return n.set(r,l),l},t}}function we(c=300){return function(e,t,i){let n=i.value,a;return i.value=function(...r){clearTimeout(a),a=setTimeout(()=>{n.apply(this,r)},c)},i}}export{te as NhucaudathangComponent};
