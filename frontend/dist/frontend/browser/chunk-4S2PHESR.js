import{a as f}from"./chunk-SAM22JC7.js";import{a as c}from"./chunk-Q7E7WSHM.js";import{a as u,b as y}from"./chunk-NX6TSR5R.js";import{c as S}from"./chunk-VF6Z3BLE.js";import{Ra as s,ja as l,oa as h,pa as d}from"./chunk-TAKLKH4V.js";import{a as g,b as m,j as n}from"./chunk-WJTR2IJE.js";var P=class p{constructor(t,e,r){this._StorageService=t;this.router=e;this._ErrorLogService=r}_snackBar=d(u);ListPermission=s([]);DetailPermission=s({});page=s(1);pageCount=s(1);total=s(0);pageSize=s(10);permissionId=s(null);setPermissionId(t){this.permissionId.set(t)}CreatePermission(t){return n(this,null,function*(){try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(t)},r=yield fetch(`${c.APIURL}/permission`,e);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);let o=yield r.json();this.getAllPermission(this.pageSize()),this.permissionId.set(o.id)}catch(e){this._ErrorLogService.logError("Failed to CreatePermission",e),console.error(e)}})}getAllPermission(){return n(this,arguments,function*(t=this.pageSize(),e=!1){this.pageSize.set(t);try{let r={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},o=new URLSearchParams({page:this.page().toString(),limit:t.toString()}),a=yield fetch(`${c.APIURL}/permission?${o}`,r);a.ok||this.handleError(a.status);let i=yield a.json();return this.ListPermission.set(i.data),this.page.set(i.page||1),this.pageCount.set(i.pageCount||1),this.total.set(i.total||i.data.length),this.pageSize.set(t),i.data}catch(r){console.error(r)}})}getUpdatedCodeIds(){return n(this,null,function*(){try{let t={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},e=yield fetch(`${c.APIURL}/permission/updateCodeIds`,t);e.ok||this.handleError(e.status);let r=yield e.json();return this.getAllPermission(this.pageSize()),r.data}catch(t){this._ErrorLogService.logError("Failed to getUpdatedCodeIds",t),console.error(t)}})}getPermissionBy(r){return n(this,arguments,function*(t,e=this.pageSize()){this.pageSize.set(e);try{let o={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(m(g({},t),{page:this.page(),limit:e}))},a=yield fetch(`${c.APIURL}/permission/findby`,o);a.ok||this.handleError(a.status);let i=yield a.json();t.isOne===!0?this.DetailPermission.set(i):(this._StorageService.setItem("permissions_updatedAt",new Date().toISOString()),this.ListPermission.set(i.data),this.page.set(i.page||1),this.pageCount.set(i.pageCount||1),this.total.set(i.total||i.data.length),this.pageSize.set(e))}catch(o){console.error(o)}})}updatePermission(t){return n(this,null,function*(){try{let e={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(t)},r=yield fetch(`${c.APIURL}/permission/${t.id}`,e);r.ok||this.handleError(r.status);let o=yield r.json();this.getAllPermission(this.pageSize()),this.getPermissionBy({id:o.id,isOne:!0},this.pageSize())}catch(e){this._ErrorLogService.logError("Failed to updatePermission",e),console.error(e)}})}DeletePermission(t){return n(this,null,function*(){try{let e={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},r=yield fetch(`${c.APIURL}/permission/${t.id}`,e);r.ok||this.handleError(r.status),this.getAllPermission(this.pageSize())}catch(e){this._ErrorLogService.logError("Failed to DeletePermission",e),console.error(e)}})}handleError(t){let e="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(t){case 400:e="Th\xF4ng tin \u0111\xE3 t\u1ED3n t\u1EA1i";break;case 401:case 404:e="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:e="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:e="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}this._snackBar.open(e,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}static \u0275fac=function(e){return new(e||p)(h(y),h(S),h(f))};static \u0275prov=l({token:p,factory:p.\u0275fac,providedIn:"root"})};export{P as a};
