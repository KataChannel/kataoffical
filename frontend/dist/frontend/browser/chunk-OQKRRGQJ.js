import{a as ka}from"./chunk-T6L2KUVF.js";import{a as ba}from"./chunk-M6BUBSNO.js";import{a as ra,b as oa}from"./chunk-R6LBO2DX.js";import{a as sa,c as la}from"./chunk-CNJR64C4.js";import{a as ca,h as ha,i as $}from"./chunk-N62VL4FK.js";import{a as da}from"./chunk-4LQMUCMY.js";import{a as ga}from"./chunk-RRSGP7XF.js";import{a as ma}from"./chunk-GJD3KC5B.js";import{a as ya}from"./chunk-Q5HOUCTV.js";import{a as fa}from"./chunk-SO57OUE2.js";import{a as pa}from"./chunk-QRWS2YSB.js";import{a as ua}from"./chunk-NTGPLOCA.js";import{a as Ia}from"./chunk-JNVUT6FC.js";import{a as A}from"./chunk-ZW44ZSN2.js";import{c as Pt}from"./chunk-NBRWFLNC.js";import{d as Mt}from"./chunk-NJTM6TIW.js";import{a as Gt}from"./chunk-ZQXFRXA5.js";import{a as xt}from"./chunk-7TOGIOEW.js";import{c as Dt}from"./chunk-3ULLR243.js";import{a as ta,b as aa}from"./chunk-5D3ARLRI.js";import{a as K}from"./chunk-H7UDLENL.js";import{a as Lt}from"./chunk-2QVTWX3V.js";import{a as Tt,b as Nt,c as Ft,h as ct}from"./chunk-REZA5E6U.js";import{a as it}from"./chunk-FDTVQONQ.js";import{c as Ht,d as jt,e as qt,f as Ut,g as Wt,h as Qt,i as Xt,j as Jt,k as Zt}from"./chunk-BW5C3OCW.js";import{a as Ot,b as Yt}from"./chunk-XKWEYHLJ.js";import{a as ea}from"./chunk-K24QJB3Y.js";import{p as ia}from"./chunk-DFQ3WBEG.js";import{b as na}from"./chunk-CSLCTKA5.js";import{b as Rt}from"./chunk-WWR2OOLD.js";import{c as Vt}from"./chunk-XBYFTIM3.js";import{B as $t,C as zt,b as Bt,g as ot,j as st,s as lt,u as Kt,y as At}from"./chunk-5PCRWSUQ.js";import{a as nt,b as rt}from"./chunk-Q4HMHGF2.js";import{a as at,e as et}from"./chunk-VA3CEBIV.js";import{_ as It}from"./chunk-G22JNWMU.js";import{l as J,m as Z,s as wt,x as tt}from"./chunk-HUFFEFIS.js";import{Bc as R,Cc as m,Db as q,Dc as F,Ec as B,Fc as Et,Hc as G,Ic as O,Jc as Y,Kb as I,Lc as X,Ra as L,Rc as ut,Tc as ft,Ub as d,Xc as yt,Yb as vt,Zb as _t,dc as h,ec as c,fc as N,gc as gt,hc as dt,ja as j,jc as V,md as Ct,oa as z,oc as C,pa as D,qc as x,rb as p,wb as mt,wc as U,xc as W,ya as k,yc as Q,za as S}from"./chunk-5IRI5K5U.js";import{a as f,b as _,g as Da,j as E}from"./chunk-6DYNGEAS.js";var ht=class l{constructor(e,t,a,i){this._StorageService=e;this.router=t;this._ErrorLogService=a;this._sharedSocketService=i;this.socket=this._sharedSocketService.getSocket(),this.listenImportdataUpdates()}socket;_snackBar=D(it);ListImportdata=L([]);DetailImportdata=L({});page=L(1);pageCount=L(1);total=L(0);pageSize=L(9999);importdataId=L(null);setImportdataId(e){this.importdataId.set(e)}CreateImportdata(e){return E(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(e)},a=yield fetch(`${K.APIURL}/importdata`,t);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);let i=yield a.json();this.getAllImportdata(this.pageSize()),this.importdataId.set(i.id)}catch(t){this._ErrorLogService.logError("Failed to CreateImportdata",t),console.error(t)}})}getAllImportdata(){return E(this,arguments,function*(e=this.pageSize(),t=!1){this.pageSize.set(e);try{let a={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},i=new URLSearchParams({page:this.page().toString(),limit:e.toString()}),n=yield fetch(`${K.APIURL}/importdata?${i}`,a);n.ok||this.handleError(n.status);let o=yield n.json();return this.ListImportdata.set(o.data),this.page.set(o.page||1),this.pageCount.set(o.pageCount||1),this.total.set(o.total||o.data.length),this.pageSize.set(e),o.data}catch(a){console.error(a)}})}getUpdatedCodeIds(){return E(this,null,function*(){try{let e={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},t=yield fetch(`${K.APIURL}/importdata/updateCodeIds`,e);t.ok||this.handleError(t.status);let a=yield t.json();return this.getAllImportdata(this.pageSize()),a.data}catch(e){this._ErrorLogService.logError("Failed to getUpdatedCodeIds",e),console.error(e)}})}listenImportdataUpdates(){this.socket.off("importdata-updated"),this.socket.on("importdata-updated",()=>E(this,null,function*(){console.log("\u{1F504} D\u1EEF li\u1EC7u s\u1EA3n ph\u1EA9m thay \u0111\u1ED5i, c\u1EADp nh\u1EADt l\u1EA1i cache..."),this._StorageService.removeItem("importdatas_updatedAt"),yield this.getAllImportdata()}))}getImportdataBy(a){return E(this,arguments,function*(e,t=this.pageSize()){this.pageSize.set(t);try{let i={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(_(f({},e),{page:this.page(),limit:t}))},n=yield fetch(`${K.APIURL}/importdata/findby`,i);n.ok||this.handleError(n.status);let o=yield n.json();e.isOne===!0?this.DetailImportdata.set(o):(this._StorageService.setItem("importdatas_updatedAt",new Date().toISOString()),this.ListImportdata.set(o.data),this.page.set(o.page||1),this.pageCount.set(o.pageCount||1),this.total.set(o.total||o.data.length),this.pageSize.set(t))}catch(i){console.error(i)}})}updateImportdata(e){return E(this,null,function*(){try{let t={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(e)},a=yield fetch(`${K.APIURL}/importdata/${e.id}`,t);a.ok||this.handleError(a.status);let i=yield a.json();this.getAllImportdata(this.pageSize()),this.getImportdataBy({id:i.id,isOne:!0},this.pageSize())}catch(t){this._ErrorLogService.logError("Failed to updateImportdata",t),console.error(t)}})}DeleteImportdata(e){return E(this,null,function*(){try{let t={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},a=yield fetch(`${K.APIURL}/importdata/${e.id}`,t);a.ok||this.handleError(a.status),this.getAllImportdata(this.pageSize())}catch(t){this._ErrorLogService.logError("Failed to DeleteImportdata",t),console.error(t)}})}handleError(e){let t="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(e){case 400:t="Th\xF4ng tin \u0111\xE3 t\u1ED3n t\u1EA1i";break;case 401:case 404:t="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:t="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:t="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}this._snackBar.open(t,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}static \u0275fac=function(t){return new(t||l)(z(Lt),z(Dt),z(Gt),z(pa))};static \u0275prov=j({token:l,factory:l.\u0275fac,providedIn:"root"})};var w=Da(Ia());function Ta(l,e){if(l&1&&(h(0,"li"),m(1),c()),l&2){let t=e.$implicit,a=x(2);p(),B(" ",a.getItemDisplayName(t)," ")}}function Na(l,e){if(l&1&&(h(0,"li",17),m(1),c()),l&2){let t=x(2);p(),B(" ... v\xE0 ",t.data.duplicateItems.length-5," m\u1EE5c kh\xE1c ")}}function Fa(l,e){if(l&1&&(h(0,"div",11)(1,"p",12)(2,"mat-icon",13),m(3,"error"),c(),m(4),c(),h(5,"ul",14),I(6,Ta,2,1,"li",15)(7,Na,2,1,"li",16),c()()),l&2){let t=x();p(4),B(" Ph\xE1t hi\u1EC7n ",t.data.duplicateItems.length," m\u1EE5c tr\xF9ng l\u1EB7p: "),p(2),d("ngForOf",t.data.duplicateItems.slice(0,5)),p(),d("ngIf",t.data.duplicateItems.length>5)}}function Ka(l,e){l&1&&(h(0,"div",23),m(1," \u26A0\uFE0F D\u1EEF li\u1EC7u c\u0169 s\u1EBD b\u1ECB thay th\u1EBF b\u1EDFi d\u1EEF li\u1EC7u m\u1EDBi "),c())}function Aa(l,e){l&1&&(h(0,"div",17),m(1," \u2139\uFE0F Ch\u1EC9 th\xEAm m\u1EDBi c\xE1c m\u1EE5c ch\u01B0a t\u1ED3n t\u1EA1i, b\u1ECF qua c\xE1c m\u1EE5c tr\xF9ng l\u1EB7p "),c())}function $a(l,e){if(l&1){let t=V();h(0,"div",18)(1,"mat-checkbox",19),Y("ngModelChange",function(i){k(t);let n=x();return O(n.data.isOverwrite,i)||(n.data.isOverwrite=i),S(i)}),h(2,"span",20),m(3,"Ghi \u0111\xE8 l\xEAn d\u1EEF li\u1EC7u c\u0169 (c\xE1c m\u1EE5c tr\xF9ng l\u1EB7p s\u1EBD \u0111\u01B0\u1EE3c c\u1EADp nh\u1EADt)"),c()(),h(4,"div",21),I(5,Ka,2,0,"div",22)(6,Aa,2,0,"div",16),c()()}if(l&2){let t=x();p(),G("ngModel",t.data.isOverwrite),p(4),d("ngIf",t.data.isOverwrite),p(),d("ngIf",!t.data.isOverwrite)}}function za(l,e){l&1&&(h(0,"div",24)(1,"div",25)(2,"mat-icon",26),m(3,"check_circle"),c(),h(4,"span"),m(5,"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u tr\xF9ng l\u1EB7p. T\u1EA5t c\u1EA3 s\u1EBD \u0111\u01B0\u1EE3c th\xEAm m\u1EDBi."),c()()())}var pt=class l{constructor(e,t){this.dialogRef=e;this.data=t}getItemDisplayName(e){switch(this.data.dataType){case"S\u1EA3n Ph\u1EA9m":return`${e.masp} - ${e.title}`;case"Kh\xE1ch H\xE0ng":return`${e.makh} - ${e.name}`;case"Nh\xE0 Cung C\u1EA5p":return`${e.mancc} - ${e.name}`;case"B\u1EA3ng Gi\xE1":return`${e.mabanggia} - ${e.title}`;default:return e.name||e.title||e.id||"N/A"}}onConfirm(){this.dialogRef.close({confirmed:!0,overwrite:this.data.isOverwrite})}onCancel(){this.dialogRef.close({confirmed:!1,overwrite:!1})}static \u0275fac=function(t){return new(t||l)(mt(Tt),mt(Nt))};static \u0275cmp=q({type:l,selectors:[["app-import-confirmation-dialog"]],decls:31,vars:7,consts:[[1,"p-6","min-w-96"],[1,"flex","items-center","mb-4"],[1,"text-orange-500","mr-2"],[1,"text-lg","font-semibold"],[1,"mb-4","text-gray-700"],["class","mt-3",4,"ngIf"],["class","mb-6",4,"ngIf"],["class","mb-4 p-3 bg-green-50 border border-green-200 rounded",4,"ngIf"],[1,"flex","justify-end","space-x-3","mt-6"],["mat-button","","color","warn",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"mt-3"],[1,"text-red-600","font-medium"],[1,"text-red-500","text-sm"],[1,"list-disc","list-inside","text-sm","text-gray-600","mt-2","max-h-32","overflow-y-auto"],[4,"ngFor","ngForOf"],["class","text-blue-600",4,"ngIf"],[1,"text-blue-600"],[1,"mb-6"],[1,"text-sm",3,"ngModelChange","ngModel"],[1,"ml-2"],[1,"mt-2","text-sm","text-gray-600"],["class","text-orange-600",4,"ngIf"],[1,"text-orange-600"],[1,"mb-4","p-3","bg-green-50","border","border-green-200","rounded"],[1,"flex","items-center","text-green-700"],[1,"text-green-500","mr-2"]],template:function(t,a){t&1&&(h(0,"div",0)(1,"div",1)(2,"mat-icon",2),m(3,"warning"),c(),h(4,"h2",3),m(5,"X\xE1c nh\u1EADn Import D\u1EEF li\u1EC7u"),c()(),h(6,"div",4)(7,"p")(8,"strong"),m(9,"Lo\u1EA1i d\u1EEF li\u1EC7u:"),c(),m(10),c(),h(11,"p")(12,"strong"),m(13,"D\u1EEF li\u1EC7u hi\u1EC7n t\u1EA1i:"),c(),m(14),c(),h(15,"p")(16,"strong"),m(17,"D\u1EEF li\u1EC7u m\u1EDBi:"),c(),m(18),c(),I(19,Fa,8,3,"div",5),c(),I(20,$a,7,3,"div",6)(21,za,6,0,"div",7),h(22,"div",8)(23,"button",9),C("click",function(){return a.onCancel()}),h(24,"mat-icon"),m(25,"cancel"),c(),m(26," H\u1EE7y b\u1ECF "),c(),h(27,"button",10),C("click",function(){return a.onConfirm()}),h(28,"mat-icon"),m(29,"file_upload"),c(),m(30),c()()()),t&2&&(p(10),B(" ",a.data.dataType,""),p(4),B(" ",a.data.existingCount," m\u1EE5c"),p(4),B(" ",a.data.newCount," m\u1EE5c"),p(),d("ngIf",a.data.duplicateItems.length>0),p(),d("ngIf",a.data.duplicateItems.length>0),p(),d("ngIf",a.data.duplicateItems.length===0),p(9),B(" ",a.data.duplicateItems.length>0?a.data.isOverwrite?"Import & Ghi \u0111\xE8":"Import & B\u1ECF qua tr\xF9ng l\u1EB7p":"Import"," "))},dependencies:[ct,et,at,rt,nt,tt,J,Z,Yt,Ot,lt,ot,st],encapsulation:2})};var v=class l{static checkDuplicates(e,t,a){let i=new Set(t.map(n=>n[a]));return e.filter(n=>i.has(n[a]))}static prepareSanphamData(e,t,a){if(a)return e;{let i=new Set(t.map(n=>n.masp));return e.filter(n=>!i.has(n.masp))}}static prepareKhachhangData(e,t,a){if(a)return e;{let i=new Set(t.map(n=>n.makh));return e.filter(n=>!i.has(n.makh))}}static prepareNhacungcapData(e,t,a){if(a)return e;{let i=new Set(t.map(n=>n.mancc));return e.filter(n=>!i.has(n.mancc))}}static prepareBanggiaData(e,t,a){if(a)return e;{let i=new Set(t.map(n=>n.mabanggia));return e.filter(n=>!i.has(n.mabanggia))}}static prepareKhoData(e,t,a){if(a)return e;{let i=new Set(t.map(n=>n.makho));return e.filter(n=>!i.has(n.makho))}}static prepareGenericData(e,t,a,i){if(i)return e;{let n=new Set(t.map(o=>o[a]));return e.filter(o=>!n.has(o[a]))}}static validateRequiredFields(e,t){let a=[],i=[];return e.forEach(n=>{let o=t.filter(s=>n[s]===void 0||n[s]===null||n[s]==="");o.length===0?a.push(n):i.push(_(f({},n),{_validationErrors:o.map(s=>`Missing required field: ${s}`)}))}),{valid:a,invalid:i}}static validateDataFormat(e,t){switch(t){case"sanpham":return this.validateSanphamFormat(e);case"khachhang":return this.validateKhachhangFormat(e);case"nhacungcap":return this.validateNhacungcapFormat(e);case"banggia":return this.validateBanggiaFormat(e);case"kho":return this.validateKhoFormat(e);default:return{valid:e,invalid:[]}}}static validateSanphamFormat(e){let t=[],a=[];return e.forEach(i=>{let n=[];(!i.masp||typeof i.masp!="string")&&n.push("Invalid product code (masp)"),i.giaban&&isNaN(Number(i.giaban))&&n.push("Invalid selling price (giaban)"),i.giagoc&&isNaN(Number(i.giagoc))&&n.push("Invalid cost price (giagoc)"),n.length===0?t.push(i):a.push(_(f({},i),{_validationErrors:n}))}),{valid:t,invalid:a}}static validateKhachhangFormat(e){let t=[],a=[];return e.forEach(i=>{let n=[];(!i.makh||typeof i.makh!="string")&&n.push("Invalid customer code (makh)"),(!i.name||typeof i.name!="string")&&n.push("Invalid customer name"),i.email&&!this.isValidEmail(i.email)&&n.push("Invalid email format"),n.length===0?t.push(i):a.push(_(f({},i),{_validationErrors:n}))}),{valid:t,invalid:a}}static validateNhacungcapFormat(e){let t=[],a=[];return e.forEach(i=>{let n=[];(!i.mancc||typeof i.mancc!="string")&&n.push("Invalid supplier code (mancc)"),(!i.name||typeof i.name!="string")&&n.push("Invalid supplier name"),n.length===0?t.push(i):a.push(_(f({},i),{_validationErrors:n}))}),{valid:t,invalid:a}}static validateBanggiaFormat(e){let t=[],a=[];return e.forEach(i=>{let n=[];(!i.mabanggia||typeof i.mabanggia!="string")&&n.push("Invalid price list code (mabanggia)"),n.length===0?t.push(i):a.push(_(f({},i),{_validationErrors:n}))}),{valid:t,invalid:a}}static validateKhoFormat(e){let t=[],a=[];return e.forEach(i=>{let n=[];(!i.makho||typeof i.makho!="string")&&n.push("Invalid warehouse code (makho)"),(!i.tenkho||typeof i.tenkho!="string")&&n.push("Invalid warehouse name (tenkho)"),n.length===0?t.push(i):a.push(_(f({},i),{_validationErrors:n}))}),{valid:t,invalid:a}}static isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static getValidationSummary(e,t,a,i){return`
      T\u1ED5ng s\u1ED1 d\xF2ng: ${e}
      D\u1EEF li\u1EC7u h\u1EE3p l\u1EC7: ${t}
      D\u1EEF li\u1EC7u kh\xF4ng h\u1EE3p l\u1EC7: ${a}
      D\u1EEF li\u1EC7u tr\xF9ng l\u1EB7p: ${i}
    `}static transformDataForImport(e,t){switch(t){case"sanpham":return this.transformSanphamData(e);case"khachhang":return this.transformKhachhangData(e);case"nhacungcap":return this.transformNhacungcapData(e);case"banggia":return this.transformBanggiaData(e);case"kho":return this.transformKhoData(e);default:return e}}static transformSanphamData(e){return e.map(t=>_(f({},t),{masp:t.masp?.toString().trim()||"",subtitle:A((t.title||"")+(t.title2||"")),title:t.title?.toString().trim()||"",title2:t.title2?.toString().trim()||"",giaban:Number(t.giaban)||Number(t.giagoc)||0,giagoc:Number(t.giagoc)||0,vat:Number(t.vat)||0,dvt:t.dvt?.toString().trim()||"",haohut:Number(t.haohut)||0,loadpoint:Number(t.loadpoint)||0,ghichu:t.ghichu?.toString().trim()||""}))}static transformKhachhangData(e){return e.map(t=>_(f({},t),{makh:t.makh?.toString().trim()||"",name:t.name?.toString().trim()||"",tenfile:A(t.tenfile?.toString()||t.name?.toString()||""),subtitle:A((t.name?.toString()||"")+(t.namenn?.toString()||"")),namenn:t.namenn?.toString().trim()||"",diachi:t.diachi?.toString().trim()||"",quan:t.quan?.toString().trim()||"",email:t.email?.toString().trim()||"",sdt:t.sdt?.toString().trim()||"",mst:t.mst?.toString().trim()||"",gionhanhang:t.gionhanhang?.toString().trim()||"",loaikh:t.loaikh?.toString().trim()||"khachsi",hiengia:t.hiengia,isshowvat:t.ishowvat,ghichu:t.ghichu?.toString().trim()||"",mabanggia:t.mabanggia?.toString().trim()||""}))}static transformNhacungcapData(e){return e.map(t=>_(f({},t),{mancc:t.mancc?.toString().trim()||"",name:t.name?.toString().trim()||"",tenfile:A(t.tenfile?.toString()||t.name?.toString()||""),diachi:t.diachi?.toString().trim()||"",email:t.email?.toString().trim()||"",sdt:t.sdt?.toString().trim()||"",ghichu:t.ghichu?.toString().trim()||""}))}static transformBanggiaData(e){return e.map(t=>_(f({},t),{mabanggia:t.mabanggia?.toString().trim()||"",title:t.title?.toString().trim()||"",type:t.type?.toString().trim()||"",ghichu:t.ghichu?.toString().trim()||"",status:t.status?.toString().trim()||"active"}))}static transformKhoData(e){return e.map(t=>_(f({},t),{makho:t.makho?.toString().trim()||"",tenkho:t.tenkho?.toString().trim()||"",diachi:t.diachi?.toString().trim()||"",ghichu:t.ghichu?.toString().trim()||"",status:t.status?.toString().trim()||"active"}))}static filterValidData(e,t){return e.filter(a=>t.every(i=>a[i]!==void 0&&a[i]!==null&&a[i]!==""))}static getRequiredFields(e){switch(e){case"sanpham":return["masp","title"];case"khachhang":return["makh","name"];case"nhacungcap":return["mancc","name"];case"banggia":return["mabanggia","title"];case"kho":return["makho","tenkho"];default:return[]}}static getUniqueField(e){switch(e){case"sanpham":return"masp";case"khachhang":return"makh";case"nhacungcap":return"mancc";case"banggia":return"mabanggia";case"kho":return"makho";default:return"id"}}static \u0275fac=function(t){return new(t||l)};static \u0275prov=j({token:l,factory:l.\u0275fac,providedIn:"root"})};var Va=["drawer"],Sa=()=>({standalone:!0}),Ra=()=>[1,2,3,4,5];function Ga(l,e){if(l&1&&(h(0,"div",42)(1,"div",43),N(2,"mat-progress-spinner",44),h(3,"span",45),m(4),c()()()),l&2){let t=x();p(4),F(t.loadingMessage())}}function Oa(l,e){l&1&&(h(0,"span"),m(1,"T\u1EA3i Xu\u1ED1ng"),c())}function Ya(l,e){l&1&&(h(0,"span",46),N(1,"mat-progress-spinner",47),m(2," \u0110ang xu\u1EA5t... "),c())}function Ha(l,e){l&1&&(h(0,"mat-icon",48),m(1,"download"),c())}function ja(l,e){l&1&&(h(0,"span"),m(1,"T\u1EA3i L\xEAn"),c())}function qa(l,e){l&1&&(h(0,"span",46),N(1,"mat-progress-spinner",47),m(2," \u0110ang nh\u1EADp... "),c())}function Ua(l,e){l&1&&(h(0,"mat-icon",48),m(1,"upload"),c())}function Wa(l,e){if(l&1&&(h(0,"div",49)(1,"div",23),N(2,"mat-progress-spinner",50),h(3,"span",51),m(4),c()()()),l&2){let t=x();p(4),F(t.loadingMessage())}}function Qa(l,e){l&1&&(h(0,"mat-icon"),m(1,"check"),c())}function Xa(l,e){if(l&1){let t=V();h(0,"span",52),C("click",function(){let i=k(t).$implicit,n=x();return S(!n.isLoading()&&!n.isImporting()&&!n.isExporting()&&i.status&&n.toggleItem(i))}),I(1,Qa,2,0,"mat-icon",29),h(2,"span"),m(3),c()()}if(l&2){let t=e.$implicit,a=x();_t("",t.status?"":"hidden",` 
                   `,a.CheckItem(t)?"bg-blue-100":"",` 
                   `,a.isLoading()||a.isImporting()||a.isExporting()?"opacity-50 cursor-not-allowed":"cursor-pointer",` 
                   flex flex-row space-x-2 items-center p-4 rounded-lg border transition-all duration-200`),p(),d("ngIf",a.CheckItem(t)),p(2),F(t.title)}}function Ja(l,e){l&1&&(h(0,"div",55),N(1,"div",56)(2,"div",57)(3,"div",58),c())}function Za(l,e){l&1&&(gt(0),h(1,"div",53),I(2,Ja,4,0,"div",54),c(),dt()),l&2&&(p(2),d("ngForOf",X(1,Ra)))}function te(l,e){if(l&1&&(h(0,"div")(1,"span",60),m(2),c(),h(3,"span"),m(4),c(),h(5,"span",61),m(6),c()()),l&2){let t=e.$implicit,a=x(3);vt(`w-full flex flex-row space-x-2 items-center border p-4 rounded-lg
                    `,a.isImporting()||a.isExporting()?"opacity-50":"",""),p(2),F(t.type),p(2),F(t.title),p(2),F(t.description)}}function ae(l,e){if(l&1&&(gt(0),I(1,te,7,6,"div",59),dt()),l&2){let t=x(2);p(),d("ngForOf",t.ListImportdata())}}function ee(l,e){l&1&&(h(0,"div",62)(1,"span",63),m(2,"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),c()())}function ie(l,e){if(l&1&&I(0,ae,2,1,"ng-container",41)(1,ee,3,0,"ng-template",null,3,yt),l&2){let t=R(2),a=x();d("ngIf",a.ListImportdata().length>0)("ngIfElse",t)}}var va=class l{displayedColumns=[];ColumnName={stt:"#",codeId:"Code",name:"Ti\xEAu \u0110\u1EC1",group:"Nh\xF3m",description:"M\xF4 T\u1EA3",status:"Tr\u1EA1ng Th\xE1i",order:"Th\u1EE9 T\u1EF1",createdAt:"Ng\xE0y T\u1EA1o",updatedAt:"Ng\xE0y C\u1EADp Nh\u1EADt"};FilterColumns=JSON.parse(localStorage.getItem("ImportdataColFilter")||"[]");Columns=[];paginator;sort;drawer;_BanggiaService=D(ba);_SanphamService=D(ua);_KhachhangService=D(fa);_NhacungcapService=D(ya);_DonhangService=D(ma);_DathangService=D(ga);_PhieukhoService=D(da);_UserService=D(xt);_KhoService=D(ka);_ImportdataService=D(ht);_GraphqlService=D(ea);_dialog=D(Ft);_snackBar=D(it);isLoading=L(!1);isImporting=L(!1);isExporting=L(!1);loadingMessage=L("");batdau=new Date;ketthuc=new Date;ListImportType=L([{id:1,title:"S\u1EA3n Ph\u1EA9m",value:"sanpham",status:!0},{id:2,title:"Kh\xE1ch H\xE0ng",value:"khachhang",status:!0},{id:3,title:"Nh\xE0 Cung C\u1EA5p",value:"nhacungcap",status:!0},{id:4,title:"B\u1EA3ng Gi\xE1",value:"banggia",status:!0},{id:5,title:"\u0110\u01A1n H\xE0ng",value:"donhang",status:!0},{id:6,title:"\u0110\u1EB7t H\xE0ng",value:"dathang",status:!0},{id:7,title:"B\u1EA3ng Gi\xE1 Kh\xE1ch H\xE0ng",value:"banggiakhachhang",status:!0},{id:8,title:"B\u1EA3ng Gi\xE1 S\u1EA3n Ph\u1EA9m",value:"banggiasanpham",status:!0},{id:9,title:"Nh\xE0 Cung C\u1EA5p S\u1EA3n Ph\u1EA9m",value:"nhacungcapsanpham",status:!0},{id:10,title:"Xu\u1EA5t Nh\u1EADp T\u1ED3n",value:"xuatnhapton",status:!0},{id:11,title:"Kho",value:"kho",status:!0}]);ListEdit=L([]);ListImportdata=this._ImportdataService.ListImportdata;TitleExport="export";rawListSP=[];rawListKH=[];rawListNCC=[];rawListBG=[];rawListDH=[];rawListDathang=[];rawListTonkho=[];rawListKho=[];constructor(){let e=new Date;this.ketthuc=new Date(e),this.batdau=new Date(e),Ct(()=>E(this,null,function*(){this.isLoading.set(!0),this.loadingMessage.set("\u0110ang t\u1EA3i d\u1EEF li\u1EC7u...");try{yield this._ImportdataService.getAllImportdata(1e3,!0),yield this.loadDataWithDateRange(),this.loadingMessage.set("\u0110ang ki\u1EC3m tra quy\u1EC1n..."),yield this._UserService.getProfile();let t=this._UserService.profile()?.permissions?.map(a=>a.name)||[];this.ListImportType.update(a=>a.map(i=>_(f({},i),{status:t.includes("importdata."+i.value)})))}catch(t){console.error("Error loading data:",t),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi t\u1EA3i d\u1EEF li\u1EC7u","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isLoading.set(!1),this.loadingMessage.set("")}}))}loadDataWithDateRange(){return E(this,null,function*(){try{let e={Batdau:this.batdau,Ketthuc:this.ketthuc,pageSize:9999};this.loadingMessage.set("\u0110ang t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m..."),yield this._SanphamService.getSanphamBy({pageSize:99999}),this.rawListSP=this._SanphamService.ListSanpham(),this.loadingMessage.set("\u0110ang t\u1EA3i danh s\xE1ch kh\xE1ch h\xE0ng..."),yield this._KhachhangService.getKhachhangBy({pageSize:99999}),this.rawListKH=this._KhachhangService.ListKhachhang(),this.loadingMessage.set("\u0110ang t\u1EA3i danh s\xE1ch nh\xE0 cung c\u1EA5p...");let t=yield this._GraphqlService.findAll("nhacungcap",{take:99999,enableParallelFetch:!0,aggressiveCache:!0,select:{id:!0,name:!0,mancc:!0,Sanpham:{select:{masp:!0}}}});this.rawListNCC=t.data,this.loadingMessage.set("\u0110ang t\u1EA3i b\u1EA3ng gi\xE1..."),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),this.loadingMessage.set("\u0110ang t\u1EA3i \u0111\u01A1n h\xE0ng..."),yield this._DonhangService.searchDonhang(e),this.rawListDH=this._DonhangService.ListDonhang(),this.loadingMessage.set("\u0110ang t\u1EA3i \u0111\u1EB7t h\xE0ng..."),yield this._DathangService.searchDathang(e),this.rawListDathang=this._DathangService.ListDathang(),this.loadingMessage.set("\u0110ang t\u1EA3i t\u1ED3n kho..."),yield this._KhoService.getTonKho("1","1000").then(a=>{this.rawListTonkho=a.data}),this.loadingMessage.set("\u0110ang t\u1EA3i danh s\xE1ch kho..."),yield this._KhoService.getAllKho(),this.rawListKho=this._KhoService.ListKho()}catch(e){throw console.error("Error loading data with date range:",e),e}})}onDateChange(){return E(this,null,function*(){if(!this.isLoading()){this.isLoading.set(!0),this.loadingMessage.set("\u0110ang c\u1EADp nh\u1EADt d\u1EEF li\u1EC7u theo ng\xE0y...");try{yield this.loadDataWithDateRange()}catch(e){console.error("Error updating data with new date range:",e),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi c\u1EADp nh\u1EADt d\u1EEF li\u1EC7u","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isLoading.set(!1),this.loadingMessage.set("")}}})}applyDateFilter(){return E(this,null,function*(){yield this.onDateChange()})}setDateRange(e){return E(this,null,function*(){let t=new Date;switch(e){case"today":this.batdau=new Date(t),this.ketthuc=new Date(t);break;case"yesterday":let a=new Date(t);a.setDate(a.getDate()-1),this.batdau=new Date(a),this.ketthuc=new Date(a);break;case"last7days":this.ketthuc=new Date(t),this.batdau=new Date(t),this.batdau.setDate(this.batdau.getDate()-6);break;case"last30days":this.ketthuc=new Date(t),this.batdau=new Date(t),this.batdau.setDate(this.batdau.getDate()-29);break;case"thisMonth":this.batdau=new Date(t.getFullYear(),t.getMonth(),1),this.ketthuc=new Date(t);break;case"lastMonth":let i=new Date(t.getFullYear(),t.getMonth()-1,1);this.batdau=new Date(i),this.ketthuc=new Date(t.getFullYear(),t.getMonth(),0);break;case"thisWeek":let n=new Date(t);n.setDate(t.getDate()-t.getDay()),this.batdau=new Date(n),this.ketthuc=new Date(t);break}yield this.applyDateFilter()})}ngOnInit(){return E(this,null,function*(){this.loadDataWithDateRange()})}applyFilter(e){}toggleAll(){this.ListEdit().length===this.ListImportType().length?(this.ListEdit.set([]),this.TitleExport="export"):(this.ListEdit.set(this.ListImportType()),this.TitleExport="export_all")}toggleItem(e){this.ListEdit().findIndex(a=>a.id===e.id)===-1?(this.TitleExport+="_"+e.value,this.ListEdit.update(a=>[...a,e])):(this.TitleExport=this.TitleExport.replace("_"+e.value,""),this.ListEdit.update(a=>a.filter(i=>i.id!==e.id)))}CheckItem(e){return this.ListEdit().findIndex(a=>a.id===e.id)!==-1}ExportExcel(e){return E(this,null,function*(){if(!this.isExporting()){this.isExporting.set(!0),this.loadingMessage.set("\u0110ang chu\u1EA9n b\u1ECB d\u1EEF li\u1EC7u xu\u1EA5t theo kho\u1EA3ng th\u1EDDi gian...");try{let t=this.getFilteredExportData(),a=Array.isArray(t.ListSP)&&t.ListSP.length?t.ListSP.map(r=>({masp:r.masp,subtitle:r.subtitle,title:r.title,title2:r.title2,giaban:r.giaban,giagoc:r.giagoc,vat:r.vat,dvt:r.dvt,haohut:r.haohut,loadpoint:r.loadpoint,ghichu:r.ghichu})):[{masp:"",subtitle:"",title:"",title2:"",giaban:"",giagoc:"",vat:"",dvt:"",haohut:"",ghichu:""}],i=Array.isArray(t.ListKH)&&t.ListKH.length?t.ListKH.map(r=>({name:r.name?.trim()||"",tenfile:r.tenfile?.trim()||"",makh:r.makh?.trim()||"",namenn:r.namenn?.trim()||"",mabanggia:r.banggia?.mabanggia?.trim()||"",diachi:r.diachi?.trim()||"",quan:r.quan?.trim()||"",email:r.email?.trim()||"",sdt:r.sdt?.toString().trim()||"",mst:r.mst?.toString().trim()||"",gionhanhang:r.gionhanhang?.toString().trim()||"",loaikh:r.loaikh?.toString().trim()||"khachsi",hiengia:r.hiengia||!0,ishowvat:r.ishowvat||!1,ghichu:r.ghichu?.toString().trim()||""})):[{name:"",tenfile:"",makh:"",namenn:"",diachi:"",quan:"",email:"",sdt:"",mst:"",gionhanhang:"",loaikh:"khachsi",hiengia:!0,ishowvat:!1,ghichu:""}],n=Array.isArray(t.ListNCC)&&t.ListNCC.length>0?t.ListNCC.map(r=>({name:r.name?.trim()||"",tenfile:r.tenfile?.trim()||"",mancc:r.mancc?.trim()||"",diachi:r.diachi?.trim()||"",email:r.email?.trim()||"",sdt:r.sdt?.toString().trim()||"",ghichu:r.ghichu?.toString().trim()||""})):[{name:"",tenfile:"",mancc:"",diachi:"",email:"",sdt:"",ghichu:""}],o=Array.isArray(t.ListBG)&&t.ListBG.length>0?t.ListBG.map(r=>({title:r.title?.trim()||"",mabanggia:r.mabanggia?.trim()||"",type:r.type?.trim()||"",batdau:(0,w.default)(r.batdau).format("DD/MM/YYYY")||"",ketthuc:(0,w.default)(r.ketthuc).format("DD/MM/YYYY")||"",ghichu:r.ghichu?.trim()||"",status:r.status?.trim()||""})):[{title:"",mabanggia:"",type:"",batdau:"",ketthuc:"",ghichu:"",status:""}],s=Array.isArray(t.ListDH)&&t.ListDH.length>0?t.ListDH.flatMap(r=>Array.isArray(r.sanpham)?r.sanpham.map(y=>({ngaygiao:(0,w.default)(r.ngaygiao).format("DD/MM/YYYY"),makh:r.khachhang?.makh,name:r.khachhang?.name,mabanggia:r.khachhang?.banggia?.[0]?.mabanggia,masp:y.masp,tensp:y.title,sldat:y.sldat,slgiao:y.slgiao,slnhan:y.slnhan,ghichu:y.ghichu})):[]):[{ngaygiao:(0,w.default)().format("DD/MM/YYYY"),makh:"",mabanggia:"",masp:"",tensp:"",sldat:0,slgiao:0,slnhan:0,ghichu:""}],b=Array.isArray(t.ListDathang)&&t.ListDathang.length>0?t.ListDathang.flatMap(r=>Array.isArray(r.sanpham)?r.sanpham.map(y=>({ngaynhan:(0,w.default)(r.ngaynhan).format("DD/MM/YYYY"),mancc:r.nhacungcap?.mancc,name:r.nhacungcap?.name,mabanggia:r.banggia?.[0]?.mabanggia,masp:y.masp,tensp:y.title,sldat:Number(y.sldat)||0,slgiao:Number(y.slgiao)||0,slnhan:Number(y.slnhan)||0,gianhap:Number(y.gianhap)||0,ghichu:y.ghichu,makho:r?.kho?.makho||""})):[]):[{ngaynhan:(0,w.default)().format("DD/MM/YYYY"),mancc:"",name:"",mabanggia:"",masp:"",tensp:"",sldat:0,slgiao:0,slnhan:0,gianhap:0,ghichu:"",makho:""}],u=this.convertBGSPToExport(t.ListBG,t.ListSP);console.log("ListBGSP",u);let g=t.ListKH.map(r=>({makh:r.makh||"",name:r.name||"",mabanggia:r.banggia?.mabanggia||""})),P=t.ListSP.reduce((r,y)=>(y&&y.masp&&(r[y.masp]=""),r),{}),H=t.ListNCC.map(r=>{let y={mancc:r.mancc||"",name:r.name||""},kt=1;for(let St of Object.keys(P))r.Sanpham?.some(wa=>wa.masp===St)&&(y[kt]=St,kt++);return y}),T=t.ListTonkho.map(r=>({masp:r.masp,title:r.title,dvt:r.dvt,slton:r.slton})),_a=Array.isArray(t.ListKho)&&t.ListKho.length?t.ListKho.map(r=>({makho:r.makho||"",tenkho:r.tenkho||"",diachi:r.diachi||"",ghichu:r.ghichu||"",status:r.status||"active"})):[{makho:"",tenkho:"",diachi:"",ghichu:"",status:"active"}],M={};if(this.ListEdit().some(r=>r.value==="sanpham")&&(M.sanpham={data:a}),this.ListEdit().some(r=>r.value==="khachhang")&&(M.khachhang={data:i}),this.ListEdit().some(r=>r.value==="nhacungcap")&&(M.nhacungcap={data:n}),this.ListEdit().some(r=>r.value==="banggia")&&(M.banggia={data:o}),this.ListEdit().some(r=>r.value==="donhang")&&(M.donhang={data:s}),this.ListEdit().some(r=>r.value==="dathang")&&(M.dathang={data:b}),this.ListEdit().some(r=>r.value==="banggiasanpham")&&(M.banggiasanpham={data:u}),this.ListEdit().some(r=>r.value==="banggiakhachhang")&&(M.banggiakhachhang={data:g}),this.ListEdit().some(r=>r.value==="nhacungcapsanpham")&&(M.nhacungcapsanpham={data:H},console.log("ListNCCSP",H)),this.ListEdit().some(r=>r.value==="xuatnhapton")&&(M.xuatnhapton={data:T}),this.ListEdit().some(r=>r.value==="kho")&&(M.kho={data:_a}),Object.keys(M).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}this.loadingMessage.set("\u0110ang t\u1EA1o file Excel...");let Ea=`${this.batdau.toLocaleDateString("vi-VN").replace(/\//g,"-")}_${this.ketthuc.toLocaleDateString("vi-VN").replace(/\//g,"-")}`,Ca=`${e}_${Ea}`;ca(M,Ca),this._snackBar.open("Xu\u1EA5t d\u1EEF li\u1EC7u th\xE0nh c\xF4ng!","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(t){console.error("Error exporting Excel:",t),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi xu\u1EA5t d\u1EEF li\u1EC7u","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isExporting.set(!1),this.loadingMessage.set("")}}})}convertBGSPToExport(e,t){let a=e.filter(n=>n.mabanggia&&n.mabanggia.trim()!==""),i=new Set(a.map(n=>n.mabanggia.trim()));return console.log("Valid pricing tables for export:",Array.from(i)),console.log("listsp",t),t.map(n=>{let o={masp:n.masp||"",title:n.title||"",giaban:n.giaban?.toString()||"0"};return Array.from(i).forEach(s=>{let u=a.find(g=>g.mabanggia===s)?.sanpham?.find(g=>g.masp===n.masp);o[s]=u?.giaban?.toString()||n.giaban?.toString()||"0"}),o})}convertBGSPToImport(e){if(!e||e.length===0)return[];console.log("Raw banggiasanpham data from Excel:",e[0]);let t=Object.keys(e[0]);console.log("All keys from Excel:",t);let a=t.filter(g=>["masp","title","giagoc","giaban","batdau","ketthuc"].includes(g.toLowerCase())||g.startsWith("__EMPTY")?!1:e.some(H=>{let T=H[g];return T!=null&&T!==""&&T!==0&&T!=="0"}));if(console.log("Valid board keys (filtered __EMPTY):",a),a.length===0)return console.warn("No valid pricing tables found in import data"),[];let i=e[0],n,o,s=t.find(g=>g.toLowerCase()==="batdau");if(s&&i[s]){let g=i[s];typeof g=="number"?n=$(g):g instanceof Date?n=g:typeof g=="string"&&(n=new Date(g)),console.log("Found batdau in Excel:",g,"-> Converted to:",n)}let b=t.find(g=>g.toLowerCase()==="ketthuc");if(b&&i[b]){let g=i[b];typeof g=="number"?o=$(g):g instanceof Date?o=g:typeof g=="string"&&(o=new Date(g)),console.log("Found ketthuc in Excel:",g,"-> Converted to:",o)}let u=a.map(g=>_(f(f({mabanggia:g,title:`B\u1EA3ng gi\xE1 ${g.replace("BG","")}`},n&&{batdau:n}),o&&{ketthuc:o}),{sanpham:e.filter(P=>P.masp&&P.masp.trim()!=="").map(P=>({masp:P.masp?.toString().trim()||"",title:P.title?.toString().trim()||"",giagoc:Number(P.giagoc)||0,giaban:Number(P[g])||Number(P.giaban)||0}))}));return console.log("Converted banggiasanpham data with dates:",u),u}convertNCCSPToImport(e){if(!e||e.length===0)return[];let t=Object.keys(e[0]).filter(a=>!["mancc","name"].includes(a));return e.forEach(a=>{a.Sanpham=[];for(let i of t)a[i]!==void 0&&a[i]!==null&&a[i]!==""&&a.Sanpham.push(a[i]),delete a[i]}),e}ImportExcel(e){return E(this,null,function*(){if(!this.isImporting()){this.isImporting.set(!0),this.loadingMessage.set("\u0110ang \u0111\u1ECDc file Excel...");try{let t=yield ha(e);this.loadingMessage.set("\u0110ang x\u1EED l\xFD d\u1EEF li\u1EC7u..."),yield this.DoImportData(t)}catch(t){console.error("Error importing Excel:",t),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi \u0111\u1ECDc file Excel","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isImporting.set(!1),this.loadingMessage.set("")}}})}showImportConfirmDialog(e,t,a,i){return E(this,null,function*(){return new Promise(n=>{let o={dataType:e,existingCount:t,newCount:a,duplicateItems:i,isOverwrite:!1};this._dialog.open(pt,{width:"500px",data:o,disableClose:!0}).afterClosed().subscribe(b=>{n(b||{confirmed:!1,overwrite:!1})})})})}DoImportData(e){return E(this,null,function*(){if(Object.keys(this.ListEdit()).length===0){this._snackBar.open("Ch\u01B0a Ch\u1ECDn Lo\u1EA1i D\u1EEF Li\u1EC7u","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}if(Object.keys(e).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 nh\u1EADp","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}if(e.sanpham&&e.sanpham.length>0&&this.ListEdit().some(t=>t.value==="sanpham")){let t=v.transformDataForImport(e.sanpham,"sanpham"),a=v.filterValidData(t,v.getRequiredFields("sanpham")),i=v.checkDuplicates(a,this.rawListSP,v.getUniqueField("sanpham")),n=yield this.showImportConfirmDialog("S\u1EA3n Ph\u1EA9m",this.rawListSP.length,a.length,i);if(!n.confirmed)return;let o=v.prepareSanphamData(a,this.rawListSP,n.overwrite);if(o.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u m\u1EDBi \u0111\u1EC3 import","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let s=this._snackBar.open(`\u0110ang import ${o.length} s\u1EA3n ph\u1EA9m...`,"",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});try{yield this._SanphamService.ImportSanpham(o),s.dismiss(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${o.length} s\u1EA3n ph\u1EA9m${n.overwrite?" (ghi \u0111\xE8)":" (th\xEAm m\u1EDBi)"}!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{s.dismiss(),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(e.khachhang&&e.khachhang.length>0&&this.ListEdit().some(t=>t.value==="khachhang")){let t=v.transformDataForImport(e.khachhang,"khachhang"),a=v.filterValidData(t,v.getRequiredFields("khachhang")),i=v.checkDuplicates(a,this.rawListKH,v.getUniqueField("khachhang")),n=yield this.showImportConfirmDialog("Kh\xE1ch H\xE0ng",this.rawListKH.length,a.length,i);if(!n.confirmed)return;let o=v.prepareKhachhangData(a,this.rawListKH,n.overwrite);if(o.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u m\u1EDBi \u0111\u1EC3 import","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let s=this._snackBar.open(`\u0110ang import ${o.length} kh\xE1ch h\xE0ng...`,"",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});try{yield this._KhachhangService.ImportKhachhang(o),s.dismiss(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${o.length} kh\xE1ch h\xE0ng${n.overwrite?" (ghi \u0111\xE8)":" (th\xEAm m\u1EDBi)"}!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{s.dismiss(),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import kh\xE1ch h\xE0ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(e.nhacungcap&&e.nhacungcap.length>0&&this.ListEdit().some(t=>t.value==="nhacungcap")){let t=(e.nhacungcap||[]).map(s=>({name:s.name,tenfile:A(s.tenfile.toString()||s.name||""),mancc:s.mancc,diachi:s.diachi,email:s.email,sdt:s.sdt.toString(),ghichu:s.ghichu})).filter(s=>s.mancc!==void 0&&s.mancc!==null&&s.mancc!==""),a=v.checkDuplicates(t,this.rawListNCC,"mancc"),i=yield this.showImportConfirmDialog("Nh\xE0 Cung C\u1EA5p",this.rawListNCC.length,t.length,a);if(!i.confirmed)return;let n=v.prepareNhacungcapData(t,this.rawListNCC,i.overwrite);if(n.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u m\u1EDBi \u0111\u1EC3 import","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let o=this._snackBar.open(`\u0110ang import ${n.length} nh\xE0 cung c\u1EA5p...`,"",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});try{yield this._NhacungcapService.ImportNhacungcap(n),o.dismiss(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${n.length} nh\xE0 cung c\u1EA5p${i.overwrite?" (ghi \u0111\xE8)":" (th\xEAm m\u1EDBi)"}!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{o.dismiss(),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import nh\xE0 cung c\u1EA5p","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(e.banggia&&e.banggia.length>0&&this.ListEdit().some(t=>t.value==="banggia")){let t=(e.banggia||[]).map(s=>({title:"B\u1EA3ng Gi\xE1 "+s.mabanggia,mabanggia:s.mabanggia,type:s.type,batdau:(0,w.default)($(s.batdau)).toDate(),ketthuc:(0,w.default)($(s.ketthuc)).toDate(),ghichu:s.ghichu,status:s.status})).filter(s=>s.mabanggia!==void 0&&s.mabanggia!==null&&s.mabanggia!==""),a=v.checkDuplicates(t,this.rawListBG,"mabanggia"),i=yield this.showImportConfirmDialog("B\u1EA3ng Gi\xE1",this.rawListBG.length,t.length,a);if(!i.confirmed)return;let n=v.prepareBanggiaData(t,this.rawListBG,i.overwrite);if(n.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u m\u1EDBi \u0111\u1EC3 import","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let o=this._snackBar.open(`\u0110ang import ${n.length} b\u1EA3ng gi\xE1...`,"",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});try{yield this._BanggiaService.ImportBanggia(n),o.dismiss(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${n.length} b\u1EA3ng gi\xE1${i.overwrite?" (ghi \u0111\xE8)":" (th\xEAm m\u1EDBi)"}!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{o.dismiss(),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import b\u1EA3ng gi\xE1","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(e.kho&&e.kho.length>0&&this.ListEdit().some(t=>t.value==="kho")){let t=(e.kho||[]).map(s=>({makho:s.makho?.toString().trim()||"",tenkho:s.tenkho?.toString().trim()||"",diachi:s.diachi?.toString().trim()||"",ghichu:s.ghichu?.toString().trim()||"",status:s.status?.toString().trim()||"active"})).filter(s=>s.makho!==void 0&&s.makho!==null&&s.makho!==""),a=v.checkDuplicates(t,this.rawListKho,"makho"),i=yield this.showImportConfirmDialog("Kho",this.rawListKho.length,t.length,a);if(!i.confirmed)return;let n=v.prepareKhoData(t,this.rawListKho,i.overwrite);if(n.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u m\u1EDBi \u0111\u1EC3 import","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let o=this._snackBar.open(`\u0110ang import ${n.length} kho...`,"",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});try{let s=n.map(b=>E(this,null,function*(){let u=this.rawListKho.find(g=>g.makho===b.makho);if(u){let g=f(f({},u),b);yield this._KhoService.updateKho(g)}else yield this._KhoService.CreateKho(b)}));yield Promise.all(s),yield this._KhoService.getAllKho(),this.rawListKho=this._KhoService.ListKho(),o.dismiss(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${n.length} kho${a.length>0?` (${a.length} tr\xF9ng l\u1EB7p)`:""}!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{o.dismiss(),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import kho","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(e.donhang&&e.donhang.length>0&&this.ListEdit().some(t=>t.value==="donhang")){let t=(e.donhang||[]).map(i=>({ngay:i.ngay,makh:i.makh,mabangia:i.mabangia,masp:i.masp,sldat:Number(i.sldat),slgiao:Number(i.slgiao),slnhan:Number(i.slnhan),ghichu:i.ghichu})).filter(i=>i.makh!==void 0&&i.makh!==null&&i.makh!==""&&i.masp!==void 0&&i.masp!==null&&i.masp!==""),a=this._snackBar.open("\u0110ang import \u0110\u01A1n h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DonhangService.ImportDonhang(t),a.dismiss(),this._snackBar.open("Import \u0110\u01A1n h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.banggiasanpham&&e.banggiasanpham.length>0&&this.ListEdit().some(t=>t.value==="banggiasanpham")){console.log("Raw banggiasanpham data from Excel:",e.banggiasanpham);let t=e.banggiasanpham.filter(s=>s.masp&&s.masp.trim()!=="");if(t.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u b\u1EA3ng gi\xE1 s\u1EA3n ph\u1EA9m h\u1EE3p l\u1EC7","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}console.log("Cleaned banggiasanpham data:",t);let a=this.convertBGSPToImport(t);if(console.log("Converted BGSP for import:",a),a.length===0){this._snackBar.open("Kh\xF4ng t\xECm th\u1EA5y b\u1EA3ng gi\xE1 h\u1EE3p l\u1EC7 trong d\u1EEF li\u1EC7u import","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let i=a.find(s=>s.mabanggia==="giaban");i||console.warn("No giaban price list found, using first available price list as base");let n=a.map(s=>{if(s.mabanggia==="giaban"||!i)return s;let b=s.sanpham.map(u=>{if(u.giaban===0||u.giaban==="0"){let g=i.sanpham.find(P=>P.masp===u.masp);return _(f({},u),{giaban:g?g.giaban:u.giaban})}return u});return _(f({},s),{sanpham:b})});console.log("Final BGSP data for import:",n);let o=this._snackBar.open(`\u0110ang import ${n.length} b\u1EA3ng gi\xE1 s\u1EA3n ph\u1EA9m...`,"",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});try{yield this._BanggiaService.importSPBG(n),o.dismiss(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${n.length} b\u1EA3ng gi\xE1 s\u1EA3n ph\u1EA9m!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(s){console.error("Error importing banggiasanpham:",s),o.dismiss(),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import b\u1EA3ng gi\xE1 s\u1EA3n ph\u1EA9m","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(e.banggiakhachhang&&e.banggiakhachhang.length>0&&this.ListEdit().some(t=>t.value==="banggiakhachhang")){console.log("Importing banggiakhachhang data:",e.banggiakhachhang);let t=(e.banggiakhachhang||[]).map(a=>({makh:a.makh,name:a.name,mabanggia:a.mabanggia})).filter(a=>a.mabanggia!==void 0&&a.mabanggia!==null&&a.mabanggia!=="");console.log("Importing ListBGKH data:",t),yield this._KhachhangService.ImportKhachhang(t),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.nhacungcapsanpham&&e.nhacungcapsanpham.length>0&&this.ListEdit().some(t=>t.value==="nhacungcapsanpham")){let t=this.convertNCCSPToImport(e.nhacungcapsanpham);console.log(t);let a=t.filter(n=>n?.Sanpham?.length>0).map(n=>_(f({},n),{Sanpham:n?.Sanpham?.map(o=>this.rawListSP.find(s=>s?.masp===o))})),i=this._snackBar.open("\u0110ang import Nh\xE0 cung c\u1EA5p s\u1EA3n ph\u1EA9m...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});console.log("ListNCCSP for import:",a),yield this._NhacungcapService.ImportNhacungcap(a),i.dismiss(),this._snackBar.open("Import Nh\xE0 cung c\u1EA5p s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.xuatnhapton&&e.xuatnhapton.length>0&&this.ListEdit().some(t=>t.value==="xuatnhapton")){let t=[],a=[];console.log("Processing xuatnhapton import data:",e.xuatnhapton.length,"items"),e.xuatnhapton.forEach(i=>{if(!i.masp||i.slton===void 0||i.slton===null){console.warn("Invalid xuatnhapton item:",i);return}let n=this.rawListTonkho.find(o=>o.masp===i.masp);if(n){let o=Number(i.slton)||0,s=Number(n.slton)||0,b=o-s;if(b>0){let u=this.rawListSP.find(g=>g.masp===i.masp);u&&u.id?t.push({sanphamId:u.id,soluong:b,ghichu:`\u0110i\u1EC1u ch\u1EC9nh t\u0103ng t\u1EEB ${s} l\xEAn ${o}`}):console.warn(`S\u1EA3n ph\u1EA9m kh\xF4ng t\xECm th\u1EA5y cho m\xE3: ${i.masp}`)}else if(b<0){let u=this.rawListSP.find(g=>g.masp===i.masp);u&&u.id?a.push({sanphamId:u.id,soluong:Math.abs(b),ghichu:`\u0110i\u1EC1u ch\u1EC9nh gi\u1EA3m t\u1EEB ${s} xu\u1ED1ng ${o}`}):console.warn(`S\u1EA3n ph\u1EA9m kh\xF4ng t\xECm th\u1EA5y cho m\xE3: ${i.masp}`)}}else console.warn(`T\u1ED3n kho kh\xF4ng t\xECm th\u1EA5y cho m\xE3 s\u1EA3n ph\u1EA9m: ${i.masp}`)}),console.log(`Phi\u1EBFu nh\u1EADp: ${t.length} items, Phi\u1EBFu xu\u1EA5t: ${a.length} items`);try{if(t.length>0){let i=t.filter(n=>!n.sanphamId);if(i.length>0)throw console.warn("Invalid phieuNhapDetails items:",i),new Error(`${i.length} s\u1EA3n ph\u1EA9m nh\u1EADp kh\xF4ng h\u1EE3p l\u1EC7`)}if(a.length>0){let i=a.filter(n=>!n.sanphamId);if(i.length>0)throw console.warn("Invalid phieuXuatDetails items:",i),new Error(`${i.length} s\u1EA3n ph\u1EA9m xu\u1EA5t kh\xF4ng h\u1EE3p l\u1EC7`)}if(t.length>0){console.log("Creating phieu nhap with details:",t);let i={title:`\u0110i\u1EC1u Ch\u1EC9nh Nh\u1EADp Kho ${(0,w.default)().format("DD/MM/YYYY")}`,type:"nhap",sanpham:t,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho t\u0103ng l\xFAc ${(0,w.default)().format("HH:mm:ss DD/MM/YYYY")}`,ngay:(0,w.default)().toDate(),khoId:"4cc01811-61f5-4bdc-83de-a493764e9258",isActive:!0};yield this._PhieukhoService.CreatePhieukho(i),this._snackBar.open(`T\u1EA1o phi\u1EBFu nh\u1EADp th\xE0nh c\xF4ng v\u1EDBi ${t.length} s\u1EA3n ph\u1EA9m`,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),yield new Promise(n=>setTimeout(n,2e3))}if(a.length>0){console.log("Creating phieu xuat with details:",a);let i={title:`\u0110i\u1EC1u Ch\u1EC9nh Xu\u1EA5t Kho ${(0,w.default)().format("DD/MM/YYYY")}`,type:"xuat",sanpham:a,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho gi\u1EA3m l\xFAc ${(0,w.default)().format("HH:mm:ss DD/MM/YYYY")}`,ngay:(0,w.default)().toDate(),khoId:"4cc01811-61f5-4bdc-83de-a493764e9258",isActive:!0};yield this._PhieukhoService.CreatePhieukho(i),this._snackBar.open(`T\u1EA1o phi\u1EBFu xu\u1EA5t th\xE0nh c\xF4ng v\u1EDBi ${a.length} s\u1EA3n ph\u1EA9m`,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}t.length===0&&a.length===0&&this._snackBar.open("Kh\xF4ng c\xF3 thay \u0111\u1ED5i t\u1ED3n kho n\xE0o c\u1EA7n x\u1EED l\xFD","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-info"]})}catch(i){console.error("Error creating phieukho during xuatnhapton import:",i),this._snackBar.open(`L\u1ED7i khi t\u1EA1o phi\u1EBFu kho: ${i?.message||"Unknown error"}`,"",{duration:5e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(e.dathang&&this.ListEdit().some(t=>t.value==="dathang")){let t=(e.dathang||[]).filter(i=>i.mancc&&i.masp).map(i=>({ngaynhan:(0,w.default)($(i.ngaynhan)).toDate(),mancc:i.mancc,mabanggia:i.mabanggia,masp:i.masp,sldat:Number(i.sldat),slgiao:Number(i.sldat),slnhan:Number(i.sldat),gianhap:Number(i.gianhap),ghichu:i.ghichu})),a=this._snackBar.open("\u0110ang import \u0110\u1EB7t h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DathangService.ImportDathang(t),a.dismiss(),this._snackBar.open("Import \u0110\u1EB7t h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.donhang&&this.ListEdit().some(t=>t.value==="donhang")){let t=(e.donhang||[]).filter(i=>i.makh&&i.masp).map(i=>({ngaygiao:(0,w.default)($(i.ngaygiao)).toDate(),makh:i.makh,mabanggia:i.mabangia,masp:i.masp,sldat:Number(i.sldat),slgiao:Number(i.slgiao),slnhan:Number(i.slnhan),ghichu:i.ghichu})),a=this._snackBar.open("\u0110ang import \u0110\u01A1n h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DonhangService.ImportDonhang(t),a.dismiss(),this._snackBar.open("Import \u0110\u01A1n h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}})}trackByFn(e,t){return t.id||e}filterDataByDateRange(e,t="createdAt"){if(!e||!Array.isArray(e))return[];let a=new Date(this.batdau);a.setHours(0,0,0,0);let i=new Date(this.ketthuc);return i.setHours(23,59,59,999),e.filter(n=>{if(!n[t])return!0;let o;if(typeof n[t]=="string")o=new Date(n[t]);else if(n[t]instanceof Date)o=n[t];else return!0;return o>=a&&o<=i})}getFilteredExportData(){let e={batdau:this.batdau,ketthuc:this.ketthuc,dateRange:`${this.batdau.toLocaleDateString("vi-VN")} - ${this.ketthuc.toLocaleDateString("vi-VN")}`};return{ListSP:this.rawListSP,ListKH:this.rawListKH,ListNCC:this.rawListNCC,ListBG:this.rawListBG,ListDH:this.filterDataByDateRange(this.rawListDH,"ngaygiao"),ListDathang:this.filterDataByDateRange(this.rawListDathang,"ngaynhan"),ListTonkho:this.filterDataByDateRange(this.rawListTonkho,"createdAt"),ListKho:this.filterDataByDateRange(this.rawListKho,"createdAt"),dateInfo:e}}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=q({type:l,selectors:[["app-listimportdata"]],viewQuery:function(t,a){if(t&1&&(U(ra,5),U(sa,5),U(Va,7)),t&2){let i;W(i=Q())&&(a.paginator=i.first),W(i=Q())&&(a.sort=i.first),W(i=Q())&&(a.drawer=i.first)}},decls:73,vars:42,consts:[["dateRangePicker",""],["uploadfile",""],["dataContent",""],["noData",""],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-4"],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",4,"ngIf"],[1,"col-span-full","mb-6","p-6","bg-white","rounded-lg","shadow-sm","border"],[1,"flex","flex-col","items-center","gap-4"],[1,"flex","flex-col","lg:flex-row","lg:items-center","gap-4"],[1,"flex","flex-col","lg:flex-row","items-center","gap-2"],["appearance","outline","subscriptSizing","dynamic",1,"w-full","lg:w-auto"],[3,"rangePicker"],["matStartDate","","placeholder","T\u1EEB ng\xE0y",3,"ngModelChange","dateChange","ngModel","ngModelOptions","disabled"],["matEndDate","","placeholder","\u0110\u1EBFn ng\xE0y",3,"ngModelChange","dateChange","ngModel","ngModelOptions","disabled"],["matIconSuffix","",3,"for"],["mat-button","","matDatepickerCancel",""],["mat-raised-button","","color","primary","matDatepickerApply","",3,"click"],["mat-raised-button","","color","primary",1,"h-14",3,"click","disabled"],[1,"mr-2"],[1,"flex","flex-wrap","gap-2"],[1,"text-sm","text-gray-600","mr-2","self-center"],["mat-button","",1,"text-sm",3,"click","disabled"],[1,"mt-4","p-3","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"flex","items-center","space-x-2"],[1,"text-blue-600"],[1,"text-blue-700","font-medium"],[1,"flex","flex-col","space-y-2","p-8"],[1,"flex","flex-row","space-x-2","items-center"],["mat-flat-button","","color","primary",3,"click","disabled"],[4,"ngIf"],["class","flex items-center",4,"ngIf"],["class","ml-1",4,"ngIf"],["type","file","accept",".xlsx,.xls",1,"hidden",3,"change","disabled"],["class","w-full p-4 bg-blue-50 rounded-lg border border-blue-200",4,"ngIf"],[1,"grid","grid-cols-3","gap-4"],[3,"class","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"w-full","flex","flex-col","space-y-2","p-8"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40","disabled:bg-gray-100","disabled:cursor-not-allowed",3,"keyup","disabled"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[4,"ngIf","ngIfElse"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","flex","flex-col","items-center","space-y-4"],["diameter","50","mode","indeterminate"],[1,"text-lg","font-medium"],[1,"flex","items-center"],["diameter","20","mode","indeterminate",1,"mr-2"],[1,"ml-1"],[1,"w-full","p-4","bg-blue-50","rounded-lg","border","border-blue-200"],["diameter","20","mode","indeterminate"],[1,"text-blue-700"],[3,"click"],[1,"w-full","flex","flex-col","space-y-2"],["class","w-full flex flex-row space-x-2 items-center border p-4 rounded-lg bg-gray-100 animate-pulse",4,"ngFor","ngForOf"],[1,"w-full","flex","flex-row","space-x-2","items-center","border","p-4","rounded-lg","bg-gray-100","animate-pulse"],[1,"rounded-lg","p-2","bg-gray-300","w-16","h-8"],[1,"bg-gray-300","h-4","w-1/3","rounded"],[1,"bg-gray-300","h-3","w-1/2","rounded"],[3,"class",4,"ngFor","ngForOf"],[1,"rounded-lg","p-2","bg-blue-100"],[1,"text-sm","text-gray-600"],[1,"w-full","flex","flex-row","items-center","justify-center","border","p-4","rounded-lg","bg-gray-100"],[1,"text-gray-600"]],template:function(t,a){if(t&1){let i=V();h(0,"div",4),I(1,Ga,5,1,"div",5),h(2,"div",6)(3,"div",7)(4,"div",8)(5,"div",9)(6,"mat-form-field",10)(7,"mat-label"),m(8,"Ch\u1ECDn kho\u1EA3ng th\u1EDDi gian"),c(),h(9,"mat-date-range-input",11)(10,"input",12),Y("ngModelChange",function(o){return k(i),O(a.batdau,o)||(a.batdau=o),S(o)}),C("dateChange",function(){return k(i),S(a.onDateChange())}),c(),h(11,"input",13),Y("ngModelChange",function(o){return k(i),O(a.ketthuc,o)||(a.ketthuc=o),S(o)}),C("dateChange",function(){return k(i),S(a.onDateChange())}),c()(),N(12,"mat-datepicker-toggle",14),h(13,"mat-date-range-picker",null,0)(15,"mat-datepicker-actions")(16,"button",15),m(17,"H\u1EE7y"),c(),h(18,"button",16),C("click",function(){return k(i),S(a.applyDateFilter())}),m(19,"\xC1p d\u1EE5ng"),c()()()(),h(20,"button",17),C("click",function(){return k(i),S(a.applyDateFilter())}),h(21,"mat-icon",18),m(22,"refresh"),c(),m(23," L\xE0m m\u1EDBi "),c()()(),h(24,"div",19)(25,"span",20),m(26,"Ch\u1ECDn nhanh:"),c(),h(27,"button",21),C("click",function(){return k(i),S(a.setDateRange("today"))}),m(28," H\xF4m nay "),c(),h(29,"button",21),C("click",function(){return k(i),S(a.setDateRange("yesterday"))}),m(30," H\xF4m qua "),c(),h(31,"button",21),C("click",function(){return k(i),S(a.setDateRange("last7days"))}),m(32," 7 ng\xE0y qua "),c(),h(33,"button",21),C("click",function(){return k(i),S(a.setDateRange("last30days"))}),m(34," 30 ng\xE0y qua "),c(),h(35,"button",21),C("click",function(){return k(i),S(a.setDateRange("thisMonth"))}),m(36," Th\xE1ng n\xE0y "),c(),h(37,"button",21),C("click",function(){return k(i),S(a.setDateRange("lastMonth"))}),m(38," Th\xE1ng tr\u01B0\u1EDBc "),c()()(),h(39,"div",22)(40,"div",23)(41,"mat-icon",24),m(42,"date_range"),c(),h(43,"span",25),m(44),ut(45,"date"),ut(46,"date"),c()()()(),h(47,"div",26)(48,"div",27)(49,"button",28),C("click",function(){return k(i),S(a.ExportExcel(a.TitleExport))}),I(50,Oa,2,0,"span",29)(51,Ya,3,0,"span",30)(52,Ha,2,0,"mat-icon",31),c(),h(53,"button",28),C("click",function(){k(i);let o=R(60);return S(o.click())}),I(54,ja,2,0,"span",29)(55,qa,3,0,"span",30)(56,Ua,2,0,"mat-icon",31),c(),h(57,"button",28),C("click",function(){return k(i),S(a.toggleAll())}),m(58," Ch\u1ECDn T\u1EA5t C\u1EA3 "),c(),h(59,"input",32,1),C("change",function(o){return k(i),S(a.ImportExcel(o))}),c()(),I(61,Wa,5,1,"div",33),h(62,"div",34),I(63,Xa,4,7,"span",35),c()(),h(64,"div",36)(65,"div",37)(66,"input",38),C("keyup",function(o){return k(i),S(a.applyFilter(o))}),c(),h(67,"div",39)(68,"span",40),m(69,"search"),c()()(),I(70,Za,3,2,"ng-container",41)(71,ie,3,2,"ng-template",null,2,yt),c()()}if(t&2){let i=R(14),n=R(72);p(),d("ngIf",a.isLoading()||a.isImporting()||a.isExporting()),p(8),d("rangePicker",i),p(),G("ngModel",a.batdau),d("ngModelOptions",X(40,Sa))("disabled",a.isLoading()||a.isImporting()||a.isExporting()),p(),G("ngModel",a.ketthuc),d("ngModelOptions",X(41,Sa))("disabled",a.isLoading()||a.isImporting()||a.isExporting()),p(),d("for",i),p(8),d("disabled",a.isLoading()||a.isImporting()||a.isExporting()),p(7),d("disabled",a.isLoading()||a.isImporting()||a.isExporting()),p(2),d("disabled",a.isLoading()||a.isImporting()||a.isExporting()),p(2),d("disabled",a.isLoading()||a.isImporting()||a.isExporting()),p(2),d("disabled",a.isLoading()||a.isImporting()||a.isExporting()),p(2),d("disabled",a.isLoading()||a.isImporting()||a.isExporting()),p(2),d("disabled",a.isLoading()||a.isImporting()||a.isExporting()),p(7),Et(" \u0110ang hi\u1EC3n th\u1ECB d\u1EEF li\u1EC7u t\u1EEB ",ft(45,34,a.batdau,"dd/MM/yyyy")," \u0111\u1EBFn ",ft(46,37,a.ketthuc,"dd/MM/yyyy")," "),p(5),d("disabled",a.isLoading()||a.isImporting()||a.isExporting()),p(),d("ngIf",!a.isExporting()),p(),d("ngIf",a.isExporting()),p(),d("ngIf",!a.isExporting()),p(),d("disabled",a.isLoading()||a.isImporting()||a.isExporting()),p(),d("ngIf",!a.isImporting()),p(),d("ngIf",a.isImporting()),p(),d("ngIf",!a.isImporting()),p(),d("disabled",a.isLoading()||a.isImporting()||a.isExporting()),p(2),d("disabled",a.isLoading()||a.isImporting()||a.isExporting()),p(2),d("ngIf",a.isLoading()),p(2),d("ngForOf",a.ListImportType())("ngForTrackBy",a.trackByFn),p(3),d("disabled",a.isLoading()||a.isImporting()||a.isExporting()),p(4),d("ngIf",a.isLoading())("ngIfElse",n)}},dependencies:[zt,$t,Kt,At,Vt,ia,la,oa,Mt,Pt,rt,nt,et,at,Rt,tt,J,Z,wt,lt,Bt,ot,st,na,ct,aa,ta,Zt,Ht,jt,qt,Ut,Wt,Jt,Xt,Qt,It],encapsulation:2,changeDetection:0})};export{ht as a,va as b};
