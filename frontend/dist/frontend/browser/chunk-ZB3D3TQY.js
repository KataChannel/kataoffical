import{a as fe,b as Ct}from"./chunk-55LR2MNL.js";import{a as _e,b as ht}from"./chunk-VT6PAWTP.js";import{a as z}from"./chunk-3TWKFDIE.js";import{a as rt,b as ot}from"./chunk-DTH4QSCT.js";import"./chunk-NULFSBS2.js";import"./chunk-PAQNOTG7.js";import"./chunk-3FNN46PZ.js";import{d as it,e as nt}from"./chunk-STTHC4C4.js";import"./chunk-ZW44ZSN2.js";import"./chunk-OTBM7FCQ.js";import{a as Le,b as Ve,c as Ge,d as qe}from"./chunk-CDVLS2VJ.js";import{a as Oe}from"./chunk-3MD4EG7P.js";import{a as gt,b as _t,d as ft,f as xt}from"./chunk-ZDECDEUV.js";import{c as ut,e as pt,f as B}from"./chunk-5L43S7G4.js";import{b as Qe,c as ze,d as We,e as je}from"./chunk-ROXAFEUT.js";import{b as dt}from"./chunk-A7PITCFC.js";import"./chunk-JNFQJYYE.js";import{a as $e,b as He,c as Ke,e as Ye,f as Xe,g as Je,h as W}from"./chunk-C6ZTKERY.js";import"./chunk-H7UDLENL.js";import{a as lt}from"./chunk-RHYJKD3I.js";import"./chunk-KZMYTDV6.js";import"./chunk-GUGI676T.js";import{a as Ae,c as Be}from"./chunk-PWU56VV4.js";import{a as st,b as at}from"./chunk-MRUSYMHE.js";import{a as ce,b as de,c as ue,d as pe,f as ge,g as j}from"./chunk-3ISVO5XR.js";import{a as mt,b as ct}from"./chunk-DRGFONJ6.js";import{b as me}from"./chunk-WGYCBDOD.js";import{b as ae,c as le}from"./chunk-ZVLEUULZ.js";import{b as te,g as ie,j as ne,m as Ne,p as re,r as Ze,t as et,u as tt,x as oe,y as se}from"./chunk-GPRU6KV3.js";import"./chunk-5HHQ5INI.js";import{a as F,b as A}from"./chunk-5BIREHNW.js";import{a as ee}from"./chunk-TXVIVA74.js";import"./chunk-PR6DE2EA.js";import"./chunk-OB6UQ2BD.js";import"./chunk-2PPFUFFT.js";import{a as T,c as Q,e as I}from"./chunk-SKIRCMX2.js";import"./chunk-LXJDFCF2.js";import"./chunk-3QZHTKAG.js";import{m as q,x as U}from"./chunk-KFQ5FW2D.js";import{$b as h,Cc as J,Db as k,Dc as s,Ec as E,Fc as v,Gc as Fe,Ic as D,J as Ue,Jc as M,Kb as u,Kc as R,Na as H,Ra as x,Ub as p,Vb as Ie,Wb as X,ac as Pe,cc as S,d as Ee,dc as w,ec as o,fc as n,gc as G,hc as Se,ic as we,ja as Y,kc as y,ld as O,nd as Z,oa as Te,pa as b,pc as g,q as $,rb as m,rc as c,v as ke,ya as _,za as f}from"./chunk-WYL4U5YK.js";import"./chunk-LWLSKGAV.js";import{a as V,b as N,j as C}from"./chunk-6DYNGEAS.js";var xe=class r{constructor(t){this.storageService=t}_allRoles=x([]);_searchTerm=x("");_currentPage=x(1);_pageSize=x(50);_isLoading=x(!1);_selectedRoles=x(new Set);_statusFilter=x("all");searchResults=O(()=>{let t=this._allRoles(),e=this._searchTerm().toLowerCase();return e&&(t=t.filter(i=>i.name.toLowerCase().includes(e))),t});allRoles=this._allRoles.asReadonly();filteredRoles=this.searchResults;searchTerm=this._searchTerm.asReadonly();currentPage=this._currentPage.asReadonly();pageSize=this._pageSize.asReadonly();isLoading=this._isLoading.asReadonly();selectedRoles=this._selectedRoles.asReadonly();statusFilter=this._statusFilter.asReadonly();totalItems=O(()=>this.searchResults().length);totalPages=O(()=>Math.ceil(this.totalItems()/this._pageSize()));paginatedRoles=O(()=>{let t=(this._currentPage()-1)*this._pageSize(),e=t+this._pageSize();return this.searchResults().slice(t,e)});graphqlService=b(lt);loadAllRoles(t=!1){return C(this,null,function*(){if(!t&&this._allRoles().length>0)return this._allRoles();this._isLoading.set(!0);try{let e={orderBy:{name:"asc"},include:{permissions:{include:{permission:{select:{id:!0,name:!0,codeId:!0}}}},users:{include:{user:{include:{profile:{select:{name:!0,avatar:!0,bio:!0}}}}}}}},i=yield this.graphqlService.findMany("role",e);return this._allRoles.set(i),this._currentPage.set(1),i}catch(e){throw console.error("Error loading roles:",e),e}finally{this._isLoading.set(!1)}})}createRole(t){return C(this,null,function*(){this._isLoading.set(!0);try{let e={name:t.name},i=yield this.graphqlService.createOne("role",{data:e,include:{permissions:{include:{permission:{select:{id:!0,name:!0,codeId:!0}}}},users:{include:{user:{include:{profile:{select:{name:!0,avatar:!0,bio:!0}}}}}}}});if(t.permissionIds&&t.permissionIds.length>0){yield this.assignPermissionsToRole(i.id,t.permissionIds);let l=yield this.getRoleById(i.id);if(l){let d=this._allRoles();return this._allRoles.set([l,...d.filter(P=>P.id!==i.id)]),l}}let a=this._allRoles();return this._allRoles.set([i,...a]),i}catch(e){throw console.error("Error creating role:",e),e}finally{this._isLoading.set(!1)}})}updateRole(t,e){return C(this,null,function*(){this._isLoading.set(!0);try{let i=yield this.graphqlService.updateOne("role",{id:t},e,{include:{permissions:{include:{permission:{select:{id:!0,name:!0,codeId:!0}}}},users:{include:{user:{include:{profile:{select:{name:!0,avatar:!0,bio:!0}}}}}}}}),a=this._allRoles(),l=a.findIndex(d=>d.id===t);if(l!==-1){let d=[...a];d[l]=i,this._allRoles.set(d)}return i}catch(i){throw console.error("Error updating role:",i),i}finally{this._isLoading.set(!1)}})}deleteRole(t){return C(this,null,function*(){this._isLoading.set(!0);try{yield this.graphqlService.deleteOne("role",{id:t});let i=this._allRoles().filter(l=>l.id!==t);this._allRoles.set(i);let a=new Set(this._selectedRoles());a.delete(t),this._selectedRoles.set(a)}catch(e){throw console.error("Error deleting role:",e),e}finally{this._isLoading.set(!1)}})}getRoleById(t){return C(this,null,function*(){try{return yield this.graphqlService.findUnique("role",{id:t},{include:{permissions:{include:{permission:{select:{id:!0,name:!0,codeId:!0}}}},users:{include:{user:{include:{profile:{select:{name:!0,avatar:!0,bio:!0}}}}}}}})}catch(e){return console.error("Error getting role by id:",e),null}})}assignPermissionsToRole(t,e){return C(this,null,function*(){this._isLoading.set(!0);try{let i=e.map(l=>({roleId:t,permissionId:l}));yield this.graphqlService.batchCreate("rolePermission",i);let a=yield this.getRoleById(t);if(a){let l=this._allRoles(),d=l.findIndex(P=>P.id===t);if(d!==-1){let P=[...l];P[d]=a,this._allRoles.set(P)}}}catch(i){throw console.error("Error assigning permissions to role:",i),i}finally{this._isLoading.set(!1)}})}removePermissionFromRole(t,e){return C(this,null,function*(){this._isLoading.set(!0);try{let a=(yield this.getRoleById(t))?.permissions?.find(l=>l.permissionId===e);if(a){yield this.graphqlService.deleteOne("rolePermission",{id:a.id});let l=yield this.getRoleById(t);if(l){let d=this._allRoles(),P=d.findIndex(L=>L.id===t);if(P!==-1){let L=[...d];L[P]=l,this._allRoles.set(L)}}}}catch(i){throw console.error("Error removing permission from role:",i),i}finally{this._isLoading.set(!1)}})}setSearchTerm(t){this._searchTerm.set(t),this._currentPage.set(1)}setStatusFilter(t){this._statusFilter.set(t),this._currentPage.set(1)}setPage(t){t>=1&&t<=this.totalPages()&&this._currentPage.set(t)}setPageSize(t){this._pageSize.set(t),this._currentPage.set(1)}nextPage(){this._currentPage()<this.totalPages()&&this._currentPage.set(this._currentPage()+1)}previousPage(){this._currentPage()>1&&this._currentPage.set(this._currentPage()-1)}toggleRoleSelection(t){let e=new Set(this._selectedRoles());e.has(t)?e.delete(t):e.add(t),this._selectedRoles.set(e)}selectAllCurrentPage(){let t=new Set(this._selectedRoles());this.paginatedRoles().forEach(e=>{t.add(e.id)}),this._selectedRoles.set(t)}deselectAllCurrentPage(){let t=new Set(this._selectedRoles());this.paginatedRoles().forEach(e=>{t.delete(e.id)}),this._selectedRoles.set(t)}clearSelection(){this._selectedRoles.set(new Set)}isSelected(t){return this._selectedRoles().has(t)}get selectedCount(){return this._selectedRoles().size}get selectedIds(){return Array.from(this._selectedRoles())}findRoleById(t){return this._allRoles().find(e=>e.id===t)}getRolesByPermission(t){return this._allRoles().filter(e=>e.permissions?.some(i=>i.permissionId===t))}getRolePermissions(t){let e=this.findRoleById(t);return!e||!e.permissions?[]:e.permissions.map(i=>i.permission)}hasPermission(t,e){return this.getRolePermissions(t).some(a=>a.codeId===e)}getRolesByGroup(t){return this._allRoles().filter(e=>e.permissions?.some(i=>i.permission.group===t))}getUsersInRole(t){let e=this.findRoleById(t);return!e||!e.users?[]:e.users.map(i=>i.user)}clearCache(){this._allRoles.set([]),this._searchTerm.set(""),this._currentPage.set(1),this.clearSelection()}refreshData(){return this.loadAllRoles(!0)}static \u0275fac=function(e){return new(e||r)(Te(Oe))};static \u0275prov=Y({token:r,factory:r.\u0275fac,providedIn:"root"})};var he=class r{userPermissionService=b(_e);permissionService=b(ht);userService=b(fe);cachedUsers=new Map;cachedPermissions=[];getUserPermissionDetails(t){return!t||t==="new"?$(null):this.cachedUsers.has(t)?$(this.cachedUsers.get(t)):this.loadUserWithPermissions(t).pipe(ke(e=>(e&&this.cachedUsers.set(t,e),e)),Ue(e=>(console.error("Error loading user permission details:",e),$(null))))}getAllPermissions(){return this.cachedPermissions.length>0?$(this.cachedPermissions):new Ee(t=>{this.permissionService.loadAllPermissions().then(()=>{this.cachedPermissions=this.permissionService.allPermissions(),t.next(this.cachedPermissions),t.complete()}).catch(e=>{console.error("Error loading permissions:",e),t.next([]),t.complete()})})}getPermissionSummary(t){let e=this.extractRolePermissions(t.roles),i=t.userPermissions.filter(d=>d.isGranted),a=t.userPermissions.filter(d=>!d.isGranted),l=this.calculateEffectivePermissions(e,i.map(d=>d.permission),a.map(d=>d.permission));return{totalRolePermissions:e.length,grantedPermissions:i.length,deniedPermissions:a.length,effectivePermissions:l,rolePermissions:e,userGranted:i,userDenied:a}}clearCache(){this.cachedUsers.clear(),this.cachedPermissions=[]}clearUserCache(t){this.cachedUsers.delete(t)}loadUserWithPermissions(t){return new Ee(e=>{this.loadUserWithPermissionsAsync(t).then(i=>{e.next(i),e.complete()}).catch(i=>{console.error("Error in loadUserWithPermissions:",i),e.next(null),e.complete()})})}loadUserWithPermissionsAsync(t){return C(this,null,function*(){try{let e=yield this.userService.getUserById(t);if(!e)return null;let i=yield this.userPermissionService.getUserPermissions(t);return{id:e.id,email:e.email,SDT:e.SDT,isActive:e.isActive,profile:e.profile,roles:e.roles||[],userPermissions:i.map(l=>({id:l.id,isGranted:l.isGranted,permission:l.permission?{id:l.permission.id,name:l.permission.name,code:l.permission.codeId||"",description:l.permission.description,isActive:!0,createdAt:new Date,updatedAt:new Date}:{id:"",name:"Unknown Permission",code:"",description:"",isActive:!1,createdAt:new Date,updatedAt:new Date},createdAt:l.createdAt,updatedAt:l.updatedAt}))}}catch(e){return console.error("Error in loadUserWithPermissionsAsync:",e),null}})}extractRolePermissions(t){let e=new Map;return t.forEach(i=>{let a=i.role;a&&a.permissions&&a.permissions.forEach(l=>{if(l&&l.id){let d={id:l.id,name:l?.permission?.name,code:l?.permission?.codeId||l?.permission?.code||"",description:l.description,isActive:!0,createdAt:new Date,updatedAt:new Date};e.set(l.id,d)}})}),Array.from(e.values())}calculateEffectivePermissions(t,e,i){let a=new Map;return t.forEach(l=>{a.set(l.id,l)}),e.forEach(l=>{if(l&&l.id){let d={id:l.id,name:l.name,code:l.codeId||l.code||"",description:l.description,isActive:!0,createdAt:new Date,updatedAt:new Date};a.set(l.id,d)}}),i.forEach(l=>{l&&l.id&&a.delete(l.id)}),Array.from(a.values())}static \u0275fac=function(e){return new(e||r)};static \u0275prov=Y({token:r,factory:r.\u0275fac,providedIn:"root"})};var Et=(r,t)=>t.id||t.roleId,Pt=(r,t)=>t.id||t.name;function St(r,t){if(r&1&&(o(0,"div",7)(1,"small",8),s(2),n()()),r&2){let e,i=c();m(2),v("\u2705 UserRolesInfoComponent loaded - User: ",((e=i.user())==null?null:e.email)||((e=i.user())==null?null:e.name)||((e=i.user())==null?null:e.id),"")}}function wt(r,t){if(r&1&&(o(0,"p",14),s(1),n()),r&2){let e=c().$implicit;m(),v(" ",(e.role==null?null:e.role.description)||e.description," ")}}function Dt(r,t){if(r&1&&(o(0,"span",15),s(1),n()),r&2){let e=c().$implicit,i=c(2);m(),v(" ",i.getRolePermissions(e).length," quy\u1EC1n ")}}function Mt(r,t){if(r&1&&(o(0,"span",20),s(1),n()),r&2){let e=t.$implicit;p("title",e.description||e.name),m(),v(" ",e.permission.name," ")}}function Rt(r,t){if(r&1){let e=y();o(0,"button",22),g("click",function(){_(e);let a=c(2).$implicit,l=c(2);return f(l.toggleShowPermissions(a.id||a.roleId))}),s(1),n()}if(r&2){let e=c(2).$implicit,i=c(2);m(),v(" ",i.showAllPermissions[e.id||e.roleId]?"Thu g\u1ECDn":"..."+(i.getRolePermissions(e).length-4)+" n\u1EEFa"," ")}}function kt(r,t){if(r&1&&(o(0,"div",16)(1,"div",19),S(2,Mt,2,2,"span",20,Pt),u(4,Rt,2,1,"button",21),n()()),r&2){let e=c().$implicit,i=c(2);m(2),w(i.getRolePermissions(e).slice(0,i.showAllPermissions[e.id||e.roleId]?i.getRolePermissions(e).length:4)),m(2),h(i.getRolePermissions(e).length>4?4:-1)}}function Ut(r,t){r&1&&(o(0,"div",17)(1,"mat-icon",23),s(2,"block"),n(),o(3,"p"),s(4,"Kh\xF4ng c\xF3 quy\u1EC1n"),n()())}function Tt(r,t){if(r&1&&(o(0,"div",18)(1,"mat-icon",24),s(2,"schedule"),n(),o(3,"span",25),s(4),n()()),r&2){let e=c().$implicit,i=c(2);m(4),v(" G\xE1n l\xFAc: ",i.formatDate(e.assignedAt||e.createdAt)," ")}}function It(r,t){if(r&1&&(o(0,"div",9)(1,"div",10)(2,"div",11)(3,"mat-icon",12),s(4),n(),o(5,"div")(6,"h4",13),s(7),n(),u(8,wt,2,1,"p",14),n()(),u(9,Dt,2,1,"span",15),n(),u(10,kt,5,1,"div",16)(11,Ut,5,0,"div",17)(12,Tt,5,1,"div",18),n()),r&2){let e=t.$implicit,i=c(2);m(4),v(" ",i.getRoleIcon((e.role==null?null:e.role.name)||e.name)," "),m(3),v(" ",(e.role==null?null:e.role.name)||e.name," "),m(),h(e.role!=null&&e.role.description||e.description?8:-1),m(),h(i.getRolePermissions(e).length>0?9:-1),m(),h(i.getRolePermissions(e).length>0?10:11),m(2),h(e.assignedAt||e.createdAt?12:-1)}}function Ft(r,t){if(r&1&&(o(0,"div",5),S(1,It,13,6,"div",9,Et),n()),r&2){let e=c();m(),w(e.user().roles)}}function At(r,t){r&1&&(o(0,"div",6)(1,"mat-icon",26),s(2,"person_outline"),n(),o(3,"p",27),s(4,"Ch\u01B0a c\xF3 vai tr\xF2 n\xE0o"),n(),o(5,"p",4),s(6,"User n\xE0y ch\u01B0a \u0111\u01B0\u1EE3c g\xE1n vai tr\xF2 n\xE0o"),n()())}var Ce=class r{user=H();showAllPermissions={};constructor(){Z(()=>{})}getRolePermissions(t){return t.role?.permissions||t.permissions||t.role?.rolePermissions?.map(i=>i.permission)||[]}getRoleIcon(t){if(!t)return"person";let e=t.toLowerCase();return e.includes("admin")?"admin_panel_settings":e.includes("manager")||e.includes("qu\u1EA3n l\xFD")?"manage_accounts":e.includes("user")||e.includes("ng\u01B0\u1EDDi d\xF9ng")?"person":e.includes("guest")||e.includes("kh\xE1ch")?"person_outline":e.includes("moderator")?"gavel":e.includes("editor")?"edit":e.includes("viewer")?"visibility":"group"}toggleShowPermissions(t){this.showAllPermissions[t]=!this.showAllPermissions[t]}formatDate(t){return t?new Date(t).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=k({type:r,selectors:[["app-user-roles-info"]],inputs:{user:[1,"user"]},decls:12,vars:3,consts:[["class","mb-2 p-2 bg-blue-50 border border-blue-200 rounded",4,"ngIf"],[1,"roles-info"],[1,"text-sm","font-medium","flex","items-center"],[1,"mr-2","text-blue-500"],[1,"text-xs"],[1,"space-y-4"],[1,"text-center","py-6","text-gray-500"],[1,"mb-2","p-2","bg-blue-50","border","border-blue-200","rounded"],[1,"text-blue-700"],[1,"border","rounded-lg","p-3","bg-gray-50"],[1,"flex","items-center","justify-between","mb-2"],[1,"flex","items-center"],[1,"mr-2","text-blue-600"],[1,"font-medium","text-sm","text-gray-800"],[1,"text-xs","text-gray-600"],[1,"px-2","py-1","text-xs","bg-blue-100","text-blue-800","rounded-full"],[1,"mt-2"],[1,"text-center","text-gray-400","text-xs","py-2"],[1,"flex","items-center","mt-2","pt-2","border-t","border-gray-200"],[1,"flex","flex-wrap","gap-1"],[1,"px-2","py-1","text-xs","bg-white","border","border-blue-200","text-blue-700","rounded",3,"title"],["mat-button","",1,"!text-xs","!p-1","!min-w-0","text-blue-600"],["mat-button","",1,"!text-xs","!p-1","!min-w-0","text-blue-600",3,"click"],[1,"text-gray-300"],[1,"mr-1","text-gray-400",2,"font-size","14px"],[1,"text-xs","text-gray-500"],[1,"text-4xl","text-gray-300"],[1,"mt-2","text-sm"]],template:function(e,i){if(e&1&&(u(0,St,3,1,"div",0),o(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title",2)(4,"mat-icon",3),s(5,"groups"),n(),s(6," Vai Tr\xF2 & Quy\u1EC1n "),n(),o(7,"mat-card-subtitle",4),s(8),n()(),o(9,"mat-card-content"),u(10,Ft,3,0,"div",5)(11,At,7,0,"div",6),n()()),e&2){let a,l;p("ngIf",i.user()),m(8),v(" ",((a=i.user())==null||a.roles==null?null:a.roles.length)||0," vai tr\xF2 \u0111\u01B0\u1EE3c g\xE1n "),m(2),h((l=i.user())!=null&&l.roles&&i.user().roles.length>0?10:11)}},dependencies:[U,q,j,ce,ue,ge,pe,de,A,F,B,I,T],styles:[".roles-info[_ngcontent-%COMP%]{border-left:4px solid #2196f3}.roles-info[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{padding-bottom:8px}.roles-info[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{font-size:12px}.roles-info[_ngcontent-%COMP%]   .border[_ngcontent-%COMP%]:hover{border-color:#2196f3;background-color:#f3f4f6}"]})};var Vt=(r,t)=>t.id;function Gt(r,t){if(r&1){let e=y();o(0,"button",57),g("click",function(){_(e);let a=c();return f(a.clearSearch())}),o(1,"mat-icon"),s(2,"clear"),n()()}}function qt(r,t){r&1&&(o(0,"div",43)(1,"mat-icon",58),s(2,"search_off"),n(),o(3,"p",59),s(4,"Kh\xF4ng t\xECm th\u1EA5y quy\u1EC1n n\xE0o"),n(),o(5,"p",60),s(6,"Th\u1EED t\xECm ki\u1EBFm v\u1EDBi t\u1EEB kh\xF3a kh\xE1c"),n()())}function Qt(r,t){if(r&1&&(o(0,"p",68),s(1),n()),r&2){let e=c().$implicit;m(),v(" ",e.description," ")}}function zt(r,t){if(r&1&&(o(0,"p",69),s(1),n()),r&2){let e=c().$implicit,i=c(2);m(),v(" ID: ",i.getPermissionCode(e)," ")}}function Wt(r,t){r&1&&(o(0,"span",76)(1,"mat-icon",79),s(2,"group"),n(),s(3," T\u1EEB vai tr\xF2 "),n())}function jt(r,t){r&1&&(o(0,"span",77)(1,"mat-icon",79),s(2,"check_circle"),n(),s(3," \u0110\xE3 c\u1EA5p ri\xEAng "),n())}function Nt(r,t){r&1&&(o(0,"span",78)(1,"mat-icon",79),s(2,"block"),n(),s(3," \u0110\xE3 t\u1EEB ch\u1ED1i "),n())}function $t(r,t){if(r&1&&u(0,Wt,4,0,"span",76)(1,jt,4,0,"span",77)(2,Nt,4,0,"span",78),r&2){let e=t;h(e==="role"?0:e==="granted"?1:e==="denied"?2:-1)}}function Ht(r,t){r&1&&(o(0,"span",71)(1,"mat-icon",79),s(2,"radio_button_unchecked"),n(),s(3," Ch\u01B0a thi\u1EBFt l\u1EADp "),n())}function Kt(r,t){if(r&1&&(o(0,"span",72)(1,"mat-icon",79),s(2,"folder"),n(),s(3),n()),r&2){let e=c().$implicit,i=c(2);m(3),v(" ",i.getPermissionGroup(e)," ")}}function Yt(r,t){if(r&1){let e=y();o(0,"button",80),g("click",function(a){_(e);let l=c().$implicit;return c(2).togglePermission(l,!0),f(a.stopPropagation())}),o(1,"mat-icon",81),s(2,"add_circle_outline"),n()()}}function Xt(r,t){if(r&1){let e=y();o(0,"button",82),g("click",function(a){_(e);let l=c().$implicit;return c(2).togglePermission(l,!1),f(a.stopPropagation())}),o(1,"mat-icon",81),s(2,"remove_circle_outline"),n()()}}function Jt(r,t){if(r&1){let e=y();o(0,"div",62),g("click",function(){let a=_(e).$implicit,l=c(2);return f(l.togglePermissionByClick(a))}),o(1,"div",63)(2,"mat-checkbox",64),g("change",function(a){let l=_(e).$implicit,d=c(2);return f(d.togglePermission(l,a.checked))})("click",function(a){return _(e),f(a.stopPropagation())}),n(),o(3,"div",65)(4,"div",66)(5,"div",65)(6,"h5",67),s(7),n(),u(8,Qt,2,1,"p",68)(9,zt,2,1,"p",69),n()(),o(10,"div",70)(11,"div",26),u(12,$t,3,1)(13,Ht,4,0,"span",71)(14,Kt,4,1,"span",72),n(),o(15,"div",73),u(16,Yt,3,0,"button",74)(17,Xt,3,0,"button",75),n()()()()()}if(r&2){let e,i=t.$implicit,a=c(2);X("bg-blue-50",a.isPermissionSelected(i))("border-l-4",a.isPermissionSelected(i))("border-l-blue-500",a.isPermissionSelected(i))("shadow-sm",a.isPermissionSelected(i)),m(2),p("checked",a.isPermissionSelected(i))("disabled",a.isPermissionDisabled(i)),m(5),v(" ",i.name," "),m(),h(i.description?8:-1),m(),h(a.getPermissionCode(i)?9:-1),m(3),h((e=a.getPermissionStatus(i))?12:13,e),m(2),h(a.getPermissionGroup(i)?14:-1),m(2),h(a.isPermissionSelected(i)?17:16)}}function Zt(r,t){if(r&1&&(o(0,"div",44),S(1,Jt,18,16,"div",61,Vt),n()),r&2){let e=c();m(),w(e.filteredPermissions())}}function ei(r,t){if(r&1&&(o(0,"span",56),s(1),n()),r&2){let e=c();m(),v(" ",e.selectedPermissions().length," ")}}var ve=class r{dialogRef=b($e);data=b(He);searchTerm="";grantType="grant";reason="";selectedPermissions=x([]);filteredPermissions=x([]);permissionGroups=x([]);constructor(){this.filteredPermissions.set(this.data.availablePermissions)}filterPermissions(){let t=this.searchTerm.toLowerCase(),e=this.data.availablePermissions;t&&(e=e.filter(i=>i.name.toLowerCase().includes(t)||i.description&&i.description.toLowerCase().includes(t)||this.getPermissionGroup(i).toLowerCase().includes(t))),this.filteredPermissions.set(e)}getPermissionCode(t){return t.code||""}getPermissionGroup(t){return t.group||"Kh\xE1c"}isPermissionSelected(t){return this.selectedPermissions().some(e=>e.id===t.id)}isPermissionDisabled(t){return!1}getPermissionStatus(t){if(this.data.currentRolePermissions.some(a=>a.id===t.id))return"role";let i=this.data.currentUserPermissions.find(a=>a.permission.id===t.id);return i?i.isGranted?"granted":"denied":null}togglePermission(t,e){let i=this.selectedPermissions();e?this.isPermissionSelected(t)||this.selectedPermissions.set([...i,t]):this.selectedPermissions.set(i.filter(a=>a.id!==t.id))}clearSearch(){this.searchTerm="",this.filterPermissions()}selectAllVisible(){let t=[];this.filteredPermissions().forEach(e=>{!this.isPermissionDisabled(e)&&!this.isPermissionSelected(e)&&t.push(e)}),this.selectedPermissions.set([...this.selectedPermissions(),...t])}clearSelection(){this.selectedPermissions.set([])}isAllSelected(){let t=this.filteredPermissions().filter(e=>!this.isPermissionDisabled(e));return t.length>0&&t.every(e=>this.isPermissionSelected(e))}isAllIndeterminate(){let t=this.filteredPermissions().filter(i=>!this.isPermissionDisabled(i)),e=t.filter(i=>this.isPermissionSelected(i)).length;return e>0&&e<t.length}toggleAll(t){let e=this.filteredPermissions().filter(i=>!this.isPermissionDisabled(i));if(t){let i=e.filter(a=>!this.isPermissionSelected(a));this.selectedPermissions.set([...this.selectedPermissions(),...i])}else{let i=e.map(a=>a.id);this.selectedPermissions.set(this.selectedPermissions().filter(a=>!i.includes(a.id)))}}togglePermissionByClick(t){this.isPermissionDisabled(t)||this.togglePermission(t,!this.isPermissionSelected(t))}onCancel(){this.dialogRef.close()}onConfirm(){let t={selectedPermissions:this.selectedPermissions(),grantType:this.grantType,reason:this.reason.trim()||void 0};this.dialogRef.close(t)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=k({type:r,selectors:[["app-permission-selector-dialog"]],decls:108,vars:18,consts:[["mat-dialog-title","",1,"w-full","!flex","!items-center","!bg-gradient-to-r","!from-blue-50","!to-indigo-50","!p-6","!rounded-t-lg"],[1,"mr-3","text-blue-600","text-2xl"],[1,"text-xl","font-semibold","text-gray-800"],[1,"text-sm","text-gray-600","mt-1"],[1,"mat-typography","!p-6","!max-h-[70vh]","!overflow-y-auto"],[1,"space-y-6"],[1,"bg-white","border","border-gray-200","rounded-xl","p-4","shadow-sm"],[1,"flex","items-center","mb-3"],[1,"mr-2","text-indigo-500"],[1,"text-base","font-medium","text-gray-800"],[1,"grid","grid-cols-2","gap-3"],[1,"relative"],["type","radio","id","grant","name","grantType","value","grant",1,"sr-only","peer",3,"ngModelChange","ngModel"],["for","grant",1,"flex","items-center","justify-center","p-4","border-2","border-gray-200","rounded-lg","cursor-pointer","transition-all","duration-200","peer-checked:border-green-500","peer-checked:bg-green-50","hover:border-green-300","hover:bg-green-25"],[1,"text-center"],[1,"text-green-500","mb-2"],[1,"font-medium","text-gray-800"],[1,"text-xs","text-gray-500"],["type","radio","id","deny","name","grantType","value","deny",1,"sr-only","peer",3,"ngModelChange","ngModel"],["for","deny",1,"flex","items-center","justify-center","p-4","border-2","border-gray-200","rounded-lg","cursor-pointer","transition-all","duration-200","peer-checked:border-red-500","peer-checked:bg-red-50","hover:border-red-300","hover:bg-red-25"],[1,"text-red-500","mb-2"],["appearance","outline",1,"w-full","!mb-0"],["matInput","","placeholder","Nh\u1EADp t\xEAn quy\u1EC1n, m\xF4 t\u1EA3 ho\u1EB7c nh\xF3m quy\u1EC1n...",3,"ngModelChange","ngModel"],["matPrefix","",1,"!mr-2"],["matSuffix","","mat-icon-button",""],[1,"flex","flex-wrap","gap-2","items-center","justify-between","bg-gray-50","p-3","rounded-lg"],[1,"flex","flex-wrap","gap-2"],["mat-stroked-button","","size","small",1,"!text-blue-600","!border-blue-300",3,"click"],[1,"!text-sm","mr-1"],["mat-stroked-button","","size","small",1,"!text-gray-600","!border-gray-300",3,"click"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-blue-600"],[1,"bg-white","border","border-gray-200","rounded-xl","overflow-hidden","shadow-sm"],[1,"bg-gradient-to-r","from-blue-50","to-indigo-50","p-4","border-b","border-gray-200"],[1,"flex","items-center","justify-between"],[1,"flex","items-center"],[1,"mr-3",3,"change","checked","indeterminate"],[1,"mr-2","text-blue-600"],[1,"font-semibold","text-gray-800","text-lg"],[1,"flex","items-center","space-x-3"],[1,"text-sm","text-gray-600","bg-white","px-3","py-1","rounded-full","border"],[1,"text-xs","text-blue-600","bg-blue-100","px-2","py-1","rounded"],[1,"bg-white"],[1,"text-center","py-12","text-gray-500"],[1,"max-h-[50vh]","overflow-y-auto"],[1,"mr-2","text-amber-500"],["matInput","","rows","3","placeholder","Nh\u1EADp l\xFD do c\u1EA5p ho\u1EB7c thu h\u1ED3i quy\u1EC1n n\xE0y \u0111\u1EC3 d\u1EC5 theo d\xF5i...",3,"ngModelChange","ngModel"],["matPrefix","",1,"!mr-2","!mt-3"],[1,"!p-6","!border-t","!border-gray-200","!bg-gray-50"],[1,"flex","items-center","justify-between","w-full"],[1,"flex","items-center","space-x-4"],[1,"text-sm","text-gray-600","flex","items-center"],[1,"text-blue-600","mx-1"],["mat-stroked-button","",1,"!border-gray-300","!text-gray-700","!px-6",3,"click"],[1,"mr-1"],["mat-raised-button","","color","primary",1,"!px-6","!py-2","!shadow-lg",3,"click","disabled"],[1,"ml-1","bg-white","bg-opacity-20","px-2","py-0.5","rounded-full","text-xs"],["matSuffix","","mat-icon-button","",3,"click"],[1,"text-5xl","mb-3","text-gray-300"],[1,"text-lg","font-medium"],[1,"text-sm","mt-1"],[1,"border-b","border-gray-100","last:border-b-0","hover:bg-blue-25","transition-all","duration-200","cursor-pointer",3,"bg-blue-50","border-l-4","border-l-blue-500","shadow-sm"],[1,"border-b","border-gray-100","last:border-b-0","hover:bg-blue-25","transition-all","duration-200","cursor-pointer",3,"click"],[1,"p-4","flex","items-start","space-x-4"],[1,"!mt-1","flex-shrink-0",3,"change","click","checked","disabled"],[1,"flex-1","min-w-0"],[1,"flex","items-start","justify-between"],[1,"font-semibold","text-gray-900","text-base","truncate","hover:text-blue-600","transition-colors"],[1,"text-sm","text-gray-600","mt-1","leading-relaxed","line-clamp-2"],[1,"text-xs","text-gray-500","mt-1","font-mono","bg-gray-100","px-2","py-1","rounded","inline-block"],[1,"flex","items-center","justify-between","mt-3"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-gray-100","text-gray-600"],[1,"inline-flex","items-center","px-2","py-0.5","rounded","text-xs","font-medium","bg-purple-100","text-purple-700"],[1,"flex","items-center","space-x-1","opacity-0","group-hover:opacity-100","transition-opacity"],["mat-icon-button","","size","small","matTooltip","Ch\u1ECDn quy\u1EC1n n\xE0y",1,"!text-green-600","!w-8","!h-8"],["mat-icon-button","","size","small","matTooltip","B\u1ECF ch\u1ECDn quy\u1EC1n n\xE0y",1,"!text-red-600","!w-8","!h-8"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-blue-100","text-blue-800","animate-fade-in"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-green-100","text-green-800","animate-fade-in"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-red-100","text-red-800","animate-fade-in"],[1,"!text-xs","mr-1"],["mat-icon-button","","size","small","matTooltip","Ch\u1ECDn quy\u1EC1n n\xE0y",1,"!text-green-600","!w-8","!h-8",3,"click"],[1,"!text-lg"],["mat-icon-button","","size","small","matTooltip","B\u1ECF ch\u1ECDn quy\u1EC1n n\xE0y",1,"!text-red-600","!w-8","!h-8",3,"click"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"mat-icon",1),s(2,"security"),n(),o(3,"div")(4,"h2",2),s(5,"Qu\u1EA3n L\xFD Quy\u1EC1n Ng\u01B0\u1EDDi D\xF9ng"),n(),o(6,"p",3),s(7,"C\u1EA5p ho\u1EB7c thu h\u1ED3i quy\u1EC1n truy c\u1EADp"),n()()(),o(8,"mat-dialog-content",4)(9,"div",5)(10,"div",6)(11,"div",7)(12,"mat-icon",8),s(13,"tune"),n(),o(14,"label",9),s(15,"Lo\u1EA1i thao t\xE1c:"),n()(),o(16,"div",10)(17,"div",11)(18,"input",12),R("ngModelChange",function(l){return M(i.grantType,l)||(i.grantType=l),l}),n(),o(19,"label",13)(20,"div",14)(21,"mat-icon",15),s(22,"add_circle_outline"),n(),o(23,"div",16),s(24,"C\u1EA5p Quy\u1EC1n"),n(),o(25,"div",17),s(26,"Cho ph\xE9p truy c\u1EADp"),n()()()(),o(27,"div",11)(28,"input",18),R("ngModelChange",function(l){return M(i.grantType,l)||(i.grantType=l),l}),n(),o(29,"label",19)(30,"div",14)(31,"mat-icon",20),s(32,"remove_circle_outline"),n(),o(33,"div",16),s(34,"Thu H\u1ED3i"),n(),o(35,"div",17),s(36,"T\u1EEB ch\u1ED1i truy c\u1EADp"),n()()()()()(),o(37,"div",6)(38,"mat-form-field",21)(39,"input",22),R("ngModelChange",function(l){return M(i.searchTerm,l)||(i.searchTerm=l),l}),g("ngModelChange",function(){return i.filterPermissions()}),n(),o(40,"mat-icon",23),s(41,"search"),n(),u(42,Gt,3,0,"button",24),n()(),o(43,"div",25)(44,"div",26)(45,"button",27),g("click",function(){return i.selectAllVisible()}),o(46,"mat-icon",28),s(47,"select_all"),n(),s(48," Ch\u1ECDn t\u1EA5t c\u1EA3 "),n(),o(49,"button",29),g("click",function(){return i.clearSelection()}),o(50,"mat-icon",28),s(51,"deselect"),n(),s(52," B\u1ECF ch\u1ECDn "),n()(),o(53,"div",30),s(54," \u0110\xE3 ch\u1ECDn: "),o(55,"span",31),s(56),n(),s(57," quy\u1EC1n "),n()(),o(58,"div",32)(59,"div",33)(60,"div",34)(61,"div",35)(62,"mat-checkbox",36),g("change",function(l){return i.toggleAll(l.checked)}),n(),o(63,"div",35)(64,"mat-icon",37),s(65,"security"),n(),o(66,"h4",38),s(67,"T\u1EA5t c\u1EA3 quy\u1EC1n h\u1EC7 th\u1ED1ng"),n()()(),o(68,"div",39)(69,"span",40),s(70),n(),o(71,"span",41),s(72),n()()()(),o(73,"div",42),u(74,qt,7,0,"div",43)(75,Zt,3,0,"div",44),n()(),o(76,"div",6)(77,"div",7)(78,"mat-icon",45),s(79,"note_add"),n(),o(80,"label",9),s(81,"Ghi ch\xFA (t\xF9y ch\u1ECDn):"),n()(),o(82,"mat-form-field",21)(83,"textarea",46),R("ngModelChange",function(l){return M(i.reason,l)||(i.reason=l),l}),n(),o(84,"mat-icon",47),s(85,"edit_note"),n()()()()(),o(86,"mat-dialog-actions",48)(87,"div",49)(88,"div",50)(89,"div",51)(90,"mat-icon",28),s(91,"info"),n(),s(92," S\u1EBD th\u1EF1c hi\u1EC7n "),o(93,"strong",31),s(94),n(),o(95,"strong",52),s(96),n(),s(97," quy\u1EC1n "),n()(),o(98,"div",39)(99,"button",53),g("click",function(){return i.onCancel()}),o(100,"mat-icon",54),s(101,"close"),n(),s(102," H\u1EE7y b\u1ECF "),n(),o(103,"button",55),g("click",function(){return i.onConfirm()}),o(104,"mat-icon",54),s(105),n(),s(106),u(107,ei,2,1,"span",56),n()()()()),e&2&&(m(18),D("ngModel",i.grantType),m(10),D("ngModel",i.grantType),m(11),D("ngModel",i.searchTerm),m(3),h(i.searchTerm?42:-1),m(14),E(i.selectedPermissions().length),m(6),p("checked",i.isAllSelected())("indeterminate",i.isAllIndeterminate()),m(8),Fe(" ",i.selectedPermissions().length,"/",i.filteredPermissions().length," \u0111\xE3 ch\u1ECDn "),m(2),v(" ",i.filteredPermissions().length," quy\u1EC1n "),m(2),h(i.filteredPermissions().length===0?74:75),m(9),D("ngModel",i.reason),m(11),E(i.grantType==="grant"?"c\u1EA5p":"thu h\u1ED3i"),m(2),E(i.selectedPermissions().length),m(7),p("disabled",i.selectedPermissions().length===0),m(2),v(" ",i.grantType==="grant"?"check_circle":"cancel"," "),m(),v(" ",i.grantType==="grant"?"C\u1EA5p Quy\u1EC1n":"Thu H\u1ED3i"," "),m(),h(i.selectedPermissions().length>0?107:-1))},dependencies:[U,re,te,Ne,ie,ne,W,Ye,Je,Xe,I,T,Q,A,F,ot,rt,se,oe,et,tt,le,ae,me,B,z,ct,mt],styles:['.peer[_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]{transform:scale(1.02)}.peer[_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]:after{content:"";position:absolute;top:8px;right:8px;width:20px;height:20px;background:currentColor;border-radius:50%;opacity:.1}.transition-all[_ngcontent-%COMP%]{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.2s}.mat-mdc-checkbox.mat-primary[_ngcontent-%COMP%]   .mdc-checkbox__native-control[_ngcontent-%COMP%]:enabled ~ .mdc-checkbox__background[_ngcontent-%COMP%]   .mdc-checkbox__checkmark[_ngcontent-%COMP%]{color:#fff}.hover\\:bg-blue-25[_ngcontent-%COMP%]:hover{background-color:#eff6ff}.hover\\:bg-green-25[_ngcontent-%COMP%]:hover{background-color:#f0fdf4}.hover\\:bg-red-25[_ngcontent-%COMP%]:hover{background-color:#fef2f2}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f5f9;border-radius:4px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:4px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b8}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.bg-gradient-to-r[_ngcontent-%COMP%]{background:linear-gradient(to right,var(--tw-gradient-stops))}.mat-mdc-form-field[_ngcontent-%COMP%]:focus-within{transform:translateY(-1px);box-shadow:0 4px 12px #0000001a}.mat-mdc-raised-button[_ngcontent-%COMP%]{box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -1px #0000000f}.mat-mdc-raised-button[_ngcontent-%COMP%]:hover{box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -2px #0000000d;transform:translateY(-1px)}.permission-item[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.permission-item[_ngcontent-%COMP%]:hover{transform:translate(4px)}.permission-item.selected[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f60d,#93c5fd1a)}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.mat-mdc-checkbox[_ngcontent-%COMP%]{--mdc-checkbox-state-layer-size: 48px}.mat-mdc-checkbox[_ngcontent-%COMP%]:hover   .mdc-checkbox__ripple[_ngcontent-%COMP%]{background:#3b82f61a}.group[_ngcontent-%COMP%]:hover   .opacity-0[_ngcontent-%COMP%]{opacity:1!important}.permission-row[_ngcontent-%COMP%]{position:relative}.permission-row[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(90deg,rgba(59,130,246,.1) 0%,transparent 100%);transition:width .3s ease}.permission-row[_ngcontent-%COMP%]:hover:before{width:100%}.status-badge[_ngcontent-%COMP%]{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#ffffffe6}.border-l-blue-500[_ngcontent-%COMP%]{border-left-width:4px;border-left-color:#3b82f6}@media (max-width: 640px){[_nghost-%COMP%]{max-width:95vw}.permission-item[_ngcontent-%COMP%]{padding:12px}.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}}']})};var ye=(r,t)=>t.id;function ti(r,t){r&1&&G(0,"mat-spinner",4)}function ii(r,t){r&1&&(o(0,"div",6),G(1,"mat-spinner",10),o(2,"p",11),s(3,"\u0110ang t\u1EA3i th\xF4ng tin quy\u1EC1n..."),n()())}function ni(r,t){if(r&1){let e=y();o(0,"div",7)(1,"mat-icon",12),s(2,"error"),n(),o(3,"p",13),s(4),n(),o(5,"button",14),g("click",function(){_(e);let a=c();return f(a.loadPermissionData())}),o(6,"mat-icon"),s(7,"refresh"),n(),s(8," Th\u1EED l\u1EA1i "),n()()}if(r&2){let e=c();m(4),E(e.error())}}function ri(r,t){r&1&&(o(0,"mat-icon",58),s(1,"groups"),n(),s(2," Roles & Nh\xF3m Quy\u1EC1n "))}function oi(r,t){if(r&1&&G(0,"app-user-roles-info",59),r&2){let e=c(2);p("user",e.user())}}function si(r,t){r&1&&(o(0,"mat-icon",58),s(1,"dashboard"),n(),s(2," T\u1ED5ng Quan "))}function ai(r,t){if(r&1&&(o(0,"span",60),s(1),n()),r&2){let e=t.$implicit;p("title",e.description||e.name),m(),v(" ",e.name," ")}}function li(r,t){if(r&1&&(o(0,"div",36),S(1,ai,2,2,"span",60,ye),n()),r&2){let e=c(2);m(),w(e.currentSummary().rolePermissions)}}function mi(r,t){r&1&&(o(0,"p",37),s(1,"Kh\xF4ng c\xF3 quy\u1EC1n t\u1EEB roles"),n())}function ci(r,t){if(r&1&&(o(0,"span",61),s(1),n()),r&2){let e=t.$implicit;p("title",e.description||e.name),m(),v(" ",e.name," ")}}function di(r,t){if(r&1&&(o(0,"div",36),S(1,ci,2,2,"span",61,ye),n()),r&2){let e=c(2);m(),w(e.currentSummary().effectivePermissions)}}function ui(r,t){r&1&&(o(0,"div",9)(1,"mat-icon",62),s(2,"block"),n(),o(3,"p",63),s(4,"Ng\u01B0\u1EDDi d\xF9ng kh\xF4ng c\xF3 quy\u1EC1n n\xE0o"),n()())}function pi(r,t){r&1&&(o(0,"mat-icon",58),s(1,"settings"),n(),s(2," Qu\u1EA3n L\xFD "))}function gi(r,t){if(r&1){let e=y();o(0,"div",64)(1,"span",24),s(2),n(),o(3,"button",65),g("click",function(){let a=_(e).$implicit,l=c(3);return f(l.revokePermission(a))}),o(4,"mat-icon",5),s(5,"close"),n()()()}if(r&2){let e=t.$implicit,i=c(3);m(2),E(e.permission.name),m(),p("disabled",i.isUpdatingPermission())}}function _i(r,t){if(r&1&&(o(0,"div",36),S(1,gi,6,2,"div",64,ye),n()),r&2){let e=c(2);m(),w(e.currentSummary().userGranted)}}function fi(r,t){r&1&&(o(0,"p",45),s(1,"Ch\u01B0a c\xF3 quy\u1EC1n n\xE0o \u0111\u01B0\u1EE3c c\u1EA5p ri\xEAng"),n())}function xi(r,t){if(r&1){let e=y();o(0,"div",66)(1,"span",27),s(2),n(),o(3,"button",67),g("click",function(){let a=_(e).$implicit,l=c(3);return f(l.restorePermission(a))}),o(4,"mat-icon",5),s(5,"refresh"),n()()()}if(r&2){let e=t.$implicit,i=c(3);m(2),E(e.permission.name),m(),p("disabled",i.isUpdatingPermission())}}function hi(r,t){if(r&1&&(o(0,"div",36),S(1,xi,6,2,"div",66,ye),n()),r&2){let e=c(2);m(),w(e.currentSummary().userDenied)}}function Ci(r,t){r&1&&(o(0,"p",50),s(1,"Kh\xF4ng c\xF3 quy\u1EC1n n\xE0o b\u1ECB t\u1EEB ch\u1ED1i"),n())}function vi(r,t){if(r&1){let e=y();o(0,"mat-tab-group",8)(1,"mat-tab"),u(2,ri,3,0,"ng-template",15),o(3,"div",16),u(4,oi,1,1,"app-user-roles-info",17),n()(),o(5,"mat-tab"),u(6,si,3,0,"ng-template",15),o(7,"div",16)(8,"div",18)(9,"div",19)(10,"div",20),s(11),n(),o(12,"div",21),s(13,"T\u1EEB Roles"),n()(),o(14,"div",22)(15,"div",23),s(16),n(),o(17,"div",24),s(18,"\u0110\u01B0\u1EE3c C\u1EA5p"),n()(),o(19,"div",25)(20,"div",26),s(21),n(),o(22,"div",27),s(23,"B\u1ECB T\u1EEB Ch\u1ED1i"),n()(),o(24,"div",28)(25,"div",29),s(26),n(),o(27,"div",30),s(28,"Cu\u1ED1i C\xF9ng"),n()()(),o(29,"div",31)(30,"mat-expansion-panel",32)(31,"mat-expansion-panel-header")(32,"mat-panel-title",33)(33,"mat-icon",34),s(34,"groups"),n(),s(35),n()(),o(36,"div",35),u(37,li,3,0,"div",36)(38,mi,2,0,"p",37),n()(),o(39,"mat-expansion-panel",38)(40,"mat-expansion-panel-header")(41,"mat-panel-title",33)(42,"mat-icon",39),s(43,"verified_user"),n(),s(44),n()(),o(45,"div",35),u(46,di,3,0,"div",36)(47,ui,5,0,"div",9),n()()()()(),o(48,"mat-tab"),u(49,pi,3,0,"ng-template",15),o(50,"div",16)(51,"div",31)(52,"div",40)(53,"div",41)(54,"div",33)(55,"mat-icon",42),s(56,"add_circle"),n(),o(57,"h3",43),s(58,"Quy\u1EC1n \u0110\u01B0\u1EE3c C\u1EA5p Ri\xEAng"),n()(),o(59,"span",44),s(60),n()(),u(61,_i,3,0,"div",36)(62,fi,2,0,"p",45),n(),o(63,"div",46)(64,"div",41)(65,"div",33)(66,"mat-icon",47),s(67,"remove_circle"),n(),o(68,"h3",48),s(69,"Quy\u1EC1n B\u1ECB T\u1EEB Ch\u1ED1i"),n()(),o(70,"span",49),s(71),n()(),u(72,hi,3,0,"div",36)(73,Ci,2,0,"p",50),n(),o(74,"div",51)(75,"div",52)(76,"mat-icon",53),s(77,"add_task"),n(),o(78,"h3",54),s(79,"C\u1EA5p Quy\u1EC1n M\u1EDBi"),n()(),o(80,"div",55)(81,"p",56),s(82,"Ch\u1ECDn quy\u1EC1n \u0111\u1EC3 c\u1EA5p ri\xEAng cho ng\u01B0\u1EDDi d\xF9ng n\xE0y (override quy\u1EC1n t\u1EEB roles)"),n(),o(83,"button",57),g("click",function(){_(e);let a=c();return f(a.openPermissionSelector())}),o(84,"mat-icon"),s(85,"add"),n(),s(86," Th\xEAm Quy\u1EC1n "),n()()()()()()()}if(r&2){let e=c();m(4),p("ngIf",e.user()),m(7),E(e.currentSummary().totalRolePermissions),m(5),E(e.currentSummary().grantedPermissions),m(5),E(e.currentSummary().deniedPermissions),m(5),E(e.currentSummary().effectivePermissions.length),m(4),p("expanded",!0),m(5),v(" Quy\u1EC1n t\u1EEB Roles (",e.currentSummary().rolePermissions.length,") "),m(2),h(e.currentSummary().rolePermissions.length>0?37:38),m(7),v(" Quy\u1EC1n Cu\u1ED1i C\xF9ng (",e.currentSummary().effectivePermissions.length,") "),m(2),h(e.currentSummary().effectivePermissions.length>0?46:47),m(14),v(" ",e.currentSummary().userGranted.length," "),m(),h(e.currentSummary().userGranted.length>0?61:62),m(10),v(" ",e.currentSummary().userDenied.length," "),m(),h(e.currentSummary().userDenied.length>0?72:73),m(11),p("disabled",e.isUpdatingPermission())}}function bi(r,t){r&1&&(o(0,"div",9)(1,"mat-icon",62),s(2,"info"),n(),o(3,"p",63),s(4,"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u quy\u1EC1n"),n()())}var be=class r{userPermissionService=b(he);userPermissionGraphQLService=b(_e);dialog=b(Ke);snackBar=b(ee);userId=H.required();user=H();isLoading=x(!1);isUpdatingPermission=x(!1);summary=x(null);error=x(null);availablePermissions=x([]);currentSummary=O(()=>this.summary());constructor(){Z(()=>{let t=this.userId();t&&t!=="new"?(this.error.set(null),this.summary.set(null),setTimeout(()=>{this.loadPermissionData(),this.loadAvailablePermissions()},0)):(this.summary.set(null),this.error.set(null))})}loadPermissionData(){return C(this,null,function*(){let t=this.userId();if(!t||t==="new"){this.summary.set(null),this.error.set(null);return}this.isLoading.set(!0),this.error.set(null);try{let e=yield new Promise((i,a)=>{this.userPermissionService.getUserPermissionDetails(t).subscribe({next:l=>i(l),error:l=>a(l)})});if(e){let i=this.userPermissionService.getPermissionSummary(e);this.summary.set(i),this.error.set(null)}else this.summary.set(null),this.error.set("Kh\xF4ng t\xECm th\u1EA5y d\u1EEF li\u1EC7u ng\u01B0\u1EDDi d\xF9ng")}catch(e){console.error("Error loading permission data:",e),this.summary.set(null),this.error.set("L\u1ED7i khi t\u1EA3i th\xF4ng tin quy\u1EC1n. Vui l\xF2ng th\u1EED l\u1EA1i.")}finally{this.isLoading.set(!1)}})}loadAvailablePermissions(){return C(this,null,function*(){try{let t=yield new Promise((e,i)=>{this.userPermissionService.getAllPermissions().subscribe({next:a=>e(a),error:a=>i(a)})});this.availablePermissions.set(t)}catch(t){console.error("Error loading available permissions:",t)}})}revokePermission(t){return C(this,null,function*(){if(!(!t||this.isUpdatingPermission())){this.isUpdatingPermission.set(!0);try{yield this.userPermissionGraphQLService.updateUserPermission(t.id,{isGranted:!1,grantedBy:"system",reason:"Revoked by admin"}),yield this.loadPermissionData()}catch(e){console.error("Error revoking permission:",e),this.error.set("L\u1ED7i khi thu h\u1ED3i quy\u1EC1n")}finally{this.isUpdatingPermission.set(!1)}}})}restorePermission(t){return C(this,null,function*(){if(!(!t||this.isUpdatingPermission())){this.isUpdatingPermission.set(!0);try{yield this.userPermissionGraphQLService.updateUserPermission(t.id,{isGranted:!0,grantedBy:"system",reason:"Restored by admin"}),yield this.loadPermissionData()}catch(e){console.error("Error restoring permission:",e),this.error.set("L\u1ED7i khi kh\xF4i ph\u1EE5c quy\u1EC1n")}finally{this.isUpdatingPermission.set(!1)}}})}openPermissionSelector(){let t=this.summary();if(!t||this.isUpdatingPermission())return;this.dialog.open(ve,{width:"90vw",maxHeight:"90vh",data:{availablePermissions:this.availablePermissions(),currentUserPermissions:t.userGranted.concat(t.userDenied),currentRolePermissions:t.rolePermissions}}).afterClosed().subscribe(i=>C(this,null,function*(){i&&i.selectedPermissions.length>0&&(yield this.processPermissionChanges(i))}))}processPermissionChanges(t){return C(this,null,function*(){if(this.isUpdatingPermission())return;this.isUpdatingPermission.set(!0);let e=this.userId(),i=0,a=0;try{for(let d of t.selectedPermissions)try{let P=this.summary()?.userGranted.concat(this.summary()?.userDenied||[]).find(L=>L.permission.id===d.id);P?yield this.userPermissionGraphQLService.updateUserPermission(P.id,{isGranted:t.grantType==="grant",grantedBy:"admin",reason:t.reason}):yield this.userPermissionGraphQLService.assignPermissionToUser({userId:e,permissionId:d.id,isGranted:t.grantType==="grant",grantedBy:"admin",reason:t.reason}),i++}catch(P){console.error(`Error processing permission ${d.name}:`,P),a++}let l=t.grantType==="grant"?"c\u1EA5p":"t\u1EEB ch\u1ED1i";i>0?this.snackBar.open(`\u0110\xE3 ${l} ${i} quy\u1EC1n th\xE0nh c\xF4ng${a>0?`, ${a} l\u1ED7i`:""}`,"\u0110\xF3ng",{duration:5e3}):a>0&&this.snackBar.open(`L\u1ED7i khi ${l} quy\u1EC1n`,"\u0110\xF3ng",{duration:5e3}),yield this.loadPermissionData()}finally{this.isUpdatingPermission.set(!1)}})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=k({type:r,selectors:[["app-user-permission-overview"]],inputs:{userId:[1,"userId"],user:[1,"user"]},decls:15,vars:2,consts:[[1,"permission-overview"],[1,"permission-main-card"],[1,"text-lg","font-medium","flex","items-center"],[1,"mr-2","text-indigo-500"],["diameter","16",1,"ml-2"],[1,"text-sm"],[1,"text-center","py-8"],[1,"text-center","py-8","text-red-500"],["animationDuration","300ms"],[1,"text-center","py-8","text-gray-500"],["diameter","48"],[1,"mt-4","text-gray-600"],[1,"text-4xl","text-red-400"],[1,"mt-2","font-medium"],["mat-raised-button","","color","primary",1,"mt-4",3,"click"],["mat-tab-label",""],[1,"py-4"],[3,"user",4,"ngIf"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mb-6"],[1,"text-center","p-4","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"text-2xl","font-bold","text-blue-600"],[1,"text-sm","text-blue-800","font-medium"],[1,"text-center","p-4","bg-green-50","rounded-lg","border","border-green-200"],[1,"text-2xl","font-bold","text-green-600"],[1,"text-sm","text-green-800","font-medium"],[1,"text-center","p-4","bg-red-50","rounded-lg","border","border-red-200"],[1,"text-2xl","font-bold","text-red-600"],[1,"text-sm","text-red-800","font-medium"],[1,"text-center","p-4","bg-purple-50","rounded-lg","border","border-purple-200"],[1,"text-2xl","font-bold","text-purple-600"],[1,"text-sm","text-purple-800","font-medium"],[1,"space-y-6"],[1,"permission-section",3,"expanded"],[1,"flex","items-center"],[1,"mr-2","text-blue-500"],[1,"pt-4"],[1,"flex","flex-wrap","gap-2"],[1,"text-gray-500","text-center","py-4"],[1,"permission-section"],[1,"mr-2","text-purple-500"],[1,"bg-green-50","rounded-lg","p-4","border","border-green-200"],[1,"flex","items-center","justify-between","mb-4"],[1,"mr-2","text-green-600"],[1,"text-lg","font-medium","text-green-800"],[1,"px-3","py-1","bg-green-200","text-green-800","rounded-full","text-sm","font-medium"],[1,"text-green-700","text-center","py-4"],[1,"bg-red-50","rounded-lg","p-4","border","border-red-200"],[1,"mr-2","text-red-600"],[1,"text-lg","font-medium","text-red-800"],[1,"px-3","py-1","bg-red-200","text-red-800","rounded-full","text-sm","font-medium"],[1,"text-red-700","text-center","py-4"],[1,"bg-gray-50","rounded-lg","p-4","border","border-gray-200"],[1,"flex","items-center","mb-4"],[1,"mr-2","text-gray-600"],[1,"text-lg","font-medium","text-gray-800"],[1,"space-y-3"],[1,"text-sm","text-gray-600"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"mr-2"],[3,"user"],[1,"px-3","py-1","text-sm","bg-blue-100","text-blue-800","rounded-full","border","border-blue-200",3,"title"],[1,"px-3","py-1","text-sm","bg-purple-100","text-purple-800","rounded-full","border","border-purple-200","font-medium",3,"title"],[1,"text-4xl","text-gray-400"],[1,"mt-2"],[1,"flex","items-center","bg-white","rounded-lg","px-3","py-2","border","border-green-300"],["mat-icon-button","","color","warn","title","Thu h\u1ED3i quy\u1EC1n",1,"ml-2","w-6","h-6",3,"click","disabled"],[1,"flex","items-center","bg-white","rounded-lg","px-3","py-2","border","border-red-300"],["mat-icon-button","","color","primary","title","Kh\xF4i ph\u1EE5c quy\u1EC1n",1,"ml-2","w-6","h-6",3,"click","disabled"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title",2)(4,"mat-icon",3),s(5,"admin_panel_settings"),n(),s(6," Qu\u1EA3n L\xFD Quy\u1EC1n H\u1EA1n "),u(7,ti,1,0,"mat-spinner",4),n(),o(8,"mat-card-subtitle",5),s(9," T\xF3m t\u1EAFt v\xE0 qu\u1EA3n l\xFD quy\u1EC1n chi ti\u1EBFt cho ng\u01B0\u1EDDi d\xF9ng "),n()(),o(10,"mat-card-content"),u(11,ii,4,0,"div",6)(12,ni,9,1,"div",7)(13,vi,87,15,"mat-tab-group",8)(14,bi,5,0,"div",9),n()()()),e&2&&(m(7),h(i.isLoading()?7:-1),m(4),h(i.isLoading()?11:i.error()?12:i.currentSummary()?13:14))},dependencies:[U,q,j,ce,ue,ge,pe,de,A,F,B,at,st,I,T,Q,z,xt,gt,_t,ft,je,Qe,ze,We,W,Ce],styles:[".permission-overview[_ngcontent-%COMP%]{width:100%}.permission-main-card[_ngcontent-%COMP%]{border-left:4px solid #4f46e5;box-shadow:0 4px 6px -1px #0000001a}.permission-section[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a}.permission-section[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]{background-color:#f8fafc}  .mat-mdc-tab-group .mat-mdc-tab-header{border-bottom:2px solid #e2e8f0}"]})};function yi(r,t){if(r&1){let e=y();o(0,"button",3),g("click",function(){_(e);let a=c();return f(a.handleUserAction())}),o(1,"mat-icon"),s(2,"save"),n()()}}function Ei(r,t){if(r&1){let e=y();o(0,"button",3),g("click",function(){_(e);let a=c();return f(a.toggleEdit())}),o(1,"mat-icon"),s(2,"edit"),n()()}}function Pi(r,t){if(r&1){let e=y();o(0,"button",10),g("click",function(){_(e);let a=c();return f(a.toggleDelete())}),o(1,"mat-icon"),s(2,"delete"),n()()}}function Si(r,t){if(r&1){let e=y();Se(0),o(1,"div",11)(2,"div",12),s(3,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),n(),o(4,"div",13)(5,"button",14),g("click",function(){_(e);let a=c();return f(a.DeleteData())}),s(6,"\u0110\u1ED3ng \xDD"),n(),o(7,"button",15),g("click",function(){_(e);let a=c();return f(a.toggleDelete())}),s(8,"Hu\u1EF7 B\u1ECF"),n()()(),we()}}function wi(r,t){r&1&&(o(0,"mat-icon",40),s(1,"refresh"),n())}function Di(r,t){if(r&1){let e=y();o(0,"mat-icon",42),g("click",function(){_(e);let a=c().$implicit,l=c(3);return f(l.handleRemoveRole(a))}),s(1," close "),n()}r&2&&Ie("cursor","pointer")}function Mi(r,t){if(r&1&&(o(0,"mat-chip-listbox")(1,"mat-chip-option",37)(2,"div",38)(3,"span",39),s(4),n(),u(5,wi,2,0,"mat-icon",40)(6,Di,2,2,"mat-icon",41),n()()()),r&2){let e=t.$implicit,i=c(3);m(),X("opacity-50",i.isRemovingRole()),m(3),E((e==null||e.role==null?null:e.role.name)||(e==null?null:e.name)),m(),h(i.isRemovingRole()?5:i.isEdit()?6:-1)}}function Ri(r,t){if(r&1&&(o(0,"div",25),S(1,Mi,7,4,"mat-chip-listbox",null,Pe),n()),r&2){let e=c(2);m(),w(e.DetailUser().roles)}}function ki(r,t){if(r&1&&(o(0,"button",45)(1,"mat-icon"),s(2,"add"),n(),s(3," Th\xEAm nh\xF3m \u0111\u1EA7u ti\xEAn "),n()),r&2){c(2);let e=J(28);p("matMenuTriggerFor",e)}}function Ui(r,t){if(r&1&&(o(0,"div",26)(1,"mat-icon",43),s(2,"group_off"),n(),o(3,"p",44),s(4,"Ch\u01B0a c\xF3 nh\xF3m quy\u1EC1n n\xE0o"),n(),u(5,ki,4,1,"button",45),n()),r&2){let e=c(2);m(5),h(e.isEdit()?5:-1)}}function Ti(r,t){if(r&1){let e=y();o(0,"button",46),g("click",function(){let a=_(e).$implicit,l=c(2);return f(l.handleAddRole(a))}),s(1),n()}if(r&2){let e=t.$implicit;m(),E(e.name)}}function Ii(r,t){if(r&1&&G(0,"app-user-permission-overview",51),r&2){let e,i=c(3);p("userId",(e=i.DetailUser())==null?null:e.id)("user",i.DetailUser())}}function Fi(r,t){r&1&&(o(0,"div",52)(1,"mat-icon",53),s(2,"refresh"),n(),o(3,"p",54),s(4,"\u0110ang t\u1EA3i th\xF4ng tin quy\u1EC1n..."),n()())}function Ai(r,t){if(r&1&&(o(0,"div",47)(1,"div",48),u(2,Ii,1,2,"app-user-permission-overview",49)(3,Fi,5,0,"div",50),n()()),r&2){let e,i=c(2);m(2),p("ngIf",i.DetailUser()&&((e=i.DetailUser())==null?null:e.id)&&!i.isLoading()),m(),p("ngIf",i.isLoading())}}function Bi(r,t){r&1&&(o(0,"div",55)(1,"div",56)(2,"div",57)(3,"mat-icon",58),s(4,"info"),n(),o(5,"p",59),s(6,"L\u01B0u user tr\u01B0\u1EDBc \u0111\u1EC3 qu\u1EA3n l\xFD quy\u1EC1n \u0111\u1EB7c bi\u1EC7t"),n(),o(7,"p",60),s(8,"Sau khi t\u1EA1o user, b\u1EA1n c\xF3 th\u1EC3 c\u1EA5p/thu h\u1ED3i quy\u1EC1n ri\xEAng"),n()()()())}function Oi(r,t){if(r&1){let e=y();Se(0),o(1,"div",16)(2,"mat-form-field",17)(3,"mat-label"),s(4,"Email"),n(),o(5,"input",18),R("ngModelChange",function(a){_(e);let l=c();return M(l.DetailUser().email,a)||(l.DetailUser().email=a),f(a)}),n()(),o(6,"mat-form-field",17)(7,"mat-label"),s(8,"H\u1ECD V\xE0 T\xEAn"),n(),o(9,"input",19),g("input",function(a){_(e);let l=c();return f(l.updateUserName(a))}),n()(),o(10,"mat-form-field",17)(11,"mat-label"),s(12,"S\u1ED1 \u0110i\u1EC7n Tho\u1EA1i"),n(),o(13,"input",20),R("ngModelChange",function(a){_(e);let l=c();return M(l.DetailUser().SDT,a)||(l.DetailUser().SDT=a),f(a)}),n()(),o(14,"mat-form-field",17)(15,"mat-label"),s(16,"M\u1EADt Kh\u1EA9u "),n(),o(17,"input",21),R("ngModelChange",function(a){_(e);let l=c();return M(l.DetailUser().password,a)||(l.DetailUser().password=a),f(a)}),n()(),o(18,"div",22)(19,"button",23,0)(21,"mat-icon"),s(22,"add"),n(),s(23," Th\xEAm Nh\xF3m "),n(),o(24,"div",24),u(25,Ri,3,0,"div",25)(26,Ui,6,1,"div",26),n(),o(27,"mat-menu",null,1)(29,"div",27),g("click",function(a){return _(e),f(a.stopPropagation())}),o(30,"div",28)(31,"input",29),g("keyup",function(a){_(e);let l=c();return f(l.doFilterHederColumn(a))}),n(),o(32,"div",30)(33,"span",31),s(34,"search"),n()()(),o(35,"div",32),S(36,Ti,2,1,"button",33,Pe),n(),o(38,"div",34)(39,"button",15),g("click",function(){_(e);let a=J(20);return f(a.closeMenu())}),s(40,"\u0110\xF3ng"),n()()()()()(),u(41,Ai,4,2,"div",35)(42,Bi,9,0,"div",36),we()}if(r&2){let e,i,a,l=J(28),d=c();m(5),D("ngModel",d.DetailUser().email),p("disabled",!d.isEdit()),m(4),p("value",((e=d.DetailUser())==null?null:e.name)||"")("disabled",!d.isEdit()),m(4),D("ngModel",d.DetailUser().SDT),p("disabled",!d.isEdit()),m(4),D("ngModel",d.DetailUser().password),p("disabled",!d.isEdit()),m(2),p("disabled",!d.isEdit()||d.isAddingRole())("matMenuTriggerFor",l),m(6),h(d.DetailUser().roles&&d.DetailUser().roles.length>0?25:26),m(11),w(d.FilterRole()),m(5),p("ngIf",((i=d.DetailUser())==null?null:i.id)&&((i=d.DetailUser())==null?null:i.id)!=="new"),m(),p("ngIf",((a=d.DetailUser())==null?null:a.id)==="new")}}var bt=class r{_ListuserComponent=b(Ct);_UserGraphQLService=b(fe);_RoleGraphQLService=b(xe);_route=b(Ae);_router=b(Be);_snackBar=b(ee);constructor(){this._route.paramMap.subscribe(t=>{let e=t.get("id");e==="new"?this.userId.set(e):e&&!this._UserGraphQLService.currentUser()&&this.userId.set(e)})}DetailUser=x(null);isEdit=x(!1);isDelete=x(!1);isLoading=x(!1);isAddingRole=x(!1);isRemovingRole=x(!1);userId=x(null);ListRole=x([]);FilterRole=x([]);getUserById(t){return C(this,null,function*(){try{let e=yield this._UserGraphQLService.getUserById(t);e&&this.DetailUser.set(N(V({},e),{SDT:e.SDT||""}))}catch(e){console.error("Error loading user:",e),this._snackBar.open("L\u1ED7i khi t\u1EA3i th\xF4ng tin ng\u01B0\u1EDDi d\xF9ng","\u0110\xF3ng",{duration:3e3})}})}ngOnInit(){return C(this,null,function*(){let t=this.userId();if(!t){this._router.navigate(["/admin/user"]),this._ListuserComponent.drawer.close();return}if(t==="new")this.DetailUser.set({id:"new",email:"",password:"",SDT:"",name:"",isActive:!0,roles:[],profile:{name:"",avatar:"",bio:""}}),this._ListuserComponent?.drawer?.open(),this.isEdit.set(!0);else if(t)try{yield this.getUserById(t),this._ListuserComponent?.drawer?.open(),this._router.navigate(["/admin/user",t])}catch(e){console.error("Error loading user:",e),this._snackBar.open("L\u1ED7i khi t\u1EA3i th\xF4ng tin ng\u01B0\u1EDDi d\xF9ng","\u0110\xF3ng",{duration:3e3}),this._router.navigate(["/admin/user"]);return}try{yield this._RoleGraphQLService.loadAllRoles(),this.ListRole.set(this._RoleGraphQLService.allRoles()),this.updateFilterRole()}catch(e){console.error("Error loading roles:",e)}})}updateFilterRole(){let t=this.ListRole()||[],i=this.DetailUser()?.roles||[];if(t.length===0){this.FilterRole.set([]);return}let a=t.filter(l=>!l||!l.id?!1:!i.some(d=>d?d.roleId===l.id||d.role?.id===l.id:!1));this.FilterRole.set(a)}updateUserName(t){let e=t.target.value,i=this.DetailUser();i&&(i.name=e,this.DetailUser.set(V({},i)))}handleUserAction(){return C(this,null,function*(){this.userId()==="new"?yield this.createUser():yield this.updateUser()})}createUser(){return C(this,null,function*(){try{if(!this.DetailUser().password||this.DetailUser().password.trim()===""){this._snackBar.open("Vui l\xF2ng nh\u1EADp password","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}if(!this.DetailUser().SDT||this.DetailUser().SDT.trim()===""){this._snackBar.open("Vui l\xF2ng nh\u1EADp SDT","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}yield this._UserGraphQLService.createUser(this.DetailUser()),this._snackBar.open("T\u1EA1o M\u1EDBi Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(t=>!t)}catch(t){console.error("L\u1ED7i khi t\u1EA1o user:",t)}})}updateUser(){return C(this,null,function*(){try{yield this._UserGraphQLService.updateUser(this.DetailUser().id,this.DetailUser()),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(t=>!t)}catch(t){console.error("L\u1ED7i khi c\u1EADp nh\u1EADt user:",t)}})}DeleteData(){return C(this,null,function*(){try{yield this._UserGraphQLService.deleteUser(this.DetailUser().id),this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this._router.navigate(["/admin/user"])}catch(t){console.error("L\u1ED7i khi x\xF3a user:",t)}})}FillSlug(){this.DetailUser.update(t=>N(V({},t),{slug:it(t.title)}))}doFilterHederColumn(t){let e=this.ListRole();this.FilterRole.set(e.filter(i=>i.name.toLowerCase().includes(t.target.value.toLowerCase())))}handleAddRole(t){return C(this,null,function*(){if(!t||!t.id||this.isAddingRole()){(!t||!t.id)&&this._snackBar.open("D\u1EEF li\u1EC7u vai tr\xF2 kh\xF4ng h\u1EE3p l\u1EC7","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}this.isAddingRole.set(!0);try{if((this.DetailUser()?.roles||[]).some(a=>a.roleId===t.id||a.role?.id===t.id)){this._snackBar.open("Vai tr\xF2 \u0111\xE3 \u0111\u01B0\u1EE3c th\xEAm","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}yield this._UserGraphQLService.assignRolesToUser(this.DetailUser().id,[t.id]),this.DetailUser.update(a=>N(V({},a),{roles:[...a.roles||[],{id:nt(8,!1),userId:this.DetailUser().id,roleId:t.id,role:t}]})),this.updateFilterRole(),this._snackBar.open("Th\xEAm vai tr\xF2 th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(e){console.error("Error adding role:",e),this._snackBar.open("L\u1ED7i khi th\xEAm vai tr\xF2","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isAddingRole.set(!1)}})}handleRemoveRole(t){return C(this,null,function*(){if(!t||this.isRemovingRole()){t||this._snackBar.open("D\u1EEF li\u1EC7u vai tr\xF2 kh\xF4ng h\u1EE3p l\u1EC7","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}this.isRemovingRole.set(!0);try{let e=t.role?.id||t.roleId;if(!e){this._snackBar.open("Kh\xF4ng th\u1EC3 x\xE1c \u0111\u1ECBnh ID vai tr\xF2","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}yield this._UserGraphQLService.removeRoleFromUser(this.DetailUser().id,e),this.DetailUser.update(i=>N(V({},i),{roles:(i.roles||[]).filter(a=>(a.role?.id||a.roleId)!==e)})),this.updateFilterRole(),this._snackBar.open("X\xF3a vai tr\xF2 th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(e){console.error("Error removing role:",e),this._snackBar.open("L\u1ED7i khi x\xF3a vai tr\xF2","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isRemovingRole.set(!1)}})}goBack(){this._UserGraphQLService.clearCurrentUser(),this._ListuserComponent.drawer.close(),this._router.navigate(["/admin/user"])}trackByFn(t,e){return e.id}toggleEdit(){this.isEdit.update(t=>!t)}toggleDelete(){this.isDelete.update(t=>!t)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=k({type:r,selectors:[["app-detailuser"]],decls:13,vars:6,consts:[["menuTrigger","matMenuTrigger"],["menu","matMenu"],[1,"flex","flex-row","justify-between","items-center","space-x-2","p-2"],["mat-icon-button","","color","primary",3,"click"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center"],["mat-icon-button","","color","primary",3,"click",4,"ngIf"],["mat-icon-button","","color","warn",3,"click",4,"ngIf"],[1,"relative","flex","flex-col","w-full","p-4","overflow-auto"],[4,"ngIf"],["mat-icon-button","","color","warn",3,"click"],[1,"flex","flex-col","space-y-4","items-center","justify-center"],[1,"font-bold","text-2xl"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],[1,"w-full","grid","grid-cols-2","gap-4"],["appearance","outline"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp Email",3,"ngModelChange","ngModel","disabled"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp H\u1ECD V\xE0 T\xEAn",3,"input","value","disabled"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp S\u1ED1 \u0110i\u1EC7n Tho\u1EA1i",3,"ngModelChange","ngModel","disabled"],["matInput","","type","password","placeholder","Vui l\xF2ng nh\u1EADp M\u1EADt kh\u1EA9u",3,"ngModelChange","ngModel","disabled"],[1,"col-span-2","w-full","flex","flex-wrap","gap-2","space-x-2","items-center"],["mat-flat-button","","color","primary",1,"flex","items-center",3,"disabled","matMenuTriggerFor"],[1,""],[1,"flex","flex-row","flex-wrap","gap-2"],[1,"text-center","text-gray-500","py-4"],[1,"cursor-pointer","flex","flex-col","space-y-4","p-3",3,"click"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[1,"w-full","flex","flex-col","space-y-2","max-h-44","overflow-auto"],["mat-menu-item",""],[1,"flex","flex-row","space-x-2","items-center","justify-end"],["class","mt-8 !w-full",4,"ngIf"],["class","!w-full mt-8",4,"ngIf"],[1,"bg-blue-100"],[1,"flex","items-center"],[1,"mr-2"],[1,"animate-spin","text-gray-500","text-sm"],["color","warn",1,"text-sm","hover:text-red-600",3,"cursor"],["color","warn",1,"text-sm","hover:text-red-600",3,"click"],[1,"text-gray-400"],[1,"text-sm","mt-1"],["mat-stroked-button","","color","primary",1,"mt-2","flex","items-center",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"mt-8","!w-full"],[1,"!w-full","border-t","pt-6"],["class","!w-full",3,"userId","user",4,"ngIf"],["class","p-8 text-center",4,"ngIf"],[1,"!w-full",3,"userId","user"],[1,"p-8","text-center"],[1,"animate-spin","text-4xl","text-gray-400"],[1,"text-lg","text-gray-500","mt-4"],[1,"!w-full","mt-8"],[1,"border-t","pt-6"],[1,"text-center","text-gray-500","py-8"],[1,"text-4xl","text-gray-400"],[1,"mt-2"],[1,"text-xs"]],template:function(e,i){if(e&1&&(o(0,"div",2)(1,"button",3),g("click",function(){return i.goBack()}),o(2,"mat-icon"),s(3,"arrow_back"),n()(),o(4,"div",4),s(5),n(),o(6,"div",5),u(7,yi,3,0,"button",6)(8,Ei,3,0,"button",6)(9,Pi,3,0,"button",7),n()(),o(10,"div",8),u(11,Si,9,0,"ng-container",9)(12,Oi,43,13,"ng-container",9),n()),e&2){let a;m(5),E(((a=i.DetailUser())==null?null:a.email)||"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),m(2),p("ngIf",i.isEdit()&&i.DetailUser()),m(),p("ngIf",!i.isEdit()&&i.DetailUser()),m(),p("ngIf",i.DetailUser()),m(2),p("ngIf",i.isDelete()),m(),p("ngIf",!i.isDelete()&&i.DetailUser())}},dependencies:[se,oe,Ze,le,ae,re,te,ie,ne,A,F,I,T,Q,me,W,U,q,dt,qe,Ve,Le,Ge,j,z,B,pt,ut,be],styles:[".permission-management[_ngcontent-%COMP%]{border-left:4px solid #4caf50}.permission-management[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{padding-bottom:8px}.permission-management[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{font-size:12px}"]})};export{bt as DetailUserComponent};
