import './polyfills.server.mjs';
import{a as Jt,b as Wt}from"./chunk-NZIEYZSE.mjs";import{a as Qt}from"./chunk-KXQKI5QI.mjs";import{a as Xt}from"./chunk-WR57HKLO.mjs";import{a as $t,b as Gt}from"./chunk-56VMO5UW.mjs";import{a as Ht}from"./chunk-ZB3RNF5I.mjs";import{a as Ut}from"./chunk-3FCWHGCS.mjs";import{a as qt}from"./chunk-ZQNWSBRJ.mjs";import{a as Rt}from"./chunk-4KCGNDNT.mjs";import{a as jt}from"./chunk-KWY7EVYL.mjs";import{a as Ot}from"./chunk-KVLOYVVQ.mjs";import{a as Yt}from"./chunk-73IBRO6I.mjs";import{a as St}from"./chunk-YMIZUYN4.mjs";import{b as Ft,g as Kt,h as rt}from"./chunk-DRJ5IELA.mjs";import{a as Vt}from"./chunk-6JBFYEDD.mjs";import{b as Pt,c as Bt,d as Mt,e as Tt,g as At,w as Nt}from"./chunk-LXQF6D42.mjs";import{a as Dt}from"./chunk-VLSCJIA4.mjs";import{a as Et,b as It,c as vt,h as J}from"./chunk-T6QRM4JN.mjs";import{a as N}from"./chunk-26NM6QMQ.mjs";import{c as bt}from"./chunk-MA5QE5RX.mjs";import{b as Lt}from"./chunk-YJ6SX3X5.mjs";import{a as zt}from"./chunk-PIPB6I5U.mjs";import{a as oa}from"./chunk-MGIVCIKU.mjs";import{d as _t}from"./chunk-WATAHPR3.mjs";import{a as q,b as Q}from"./chunk-HI3FSC7Q.mjs";import{g as kt,j as Ct,n as X,v as wt,y as xt}from"./chunk-BRRNXVKE.mjs";import{a as P}from"./chunk-HX7VASDC.mjs";import{a as U,b as yt}from"./chunk-AEZIUUEM.mjs";import{a as H,e as R}from"./chunk-U7KFJFV4.mjs";import{y as ft}from"./chunk-B665T7JI.mjs";import{d as j}from"./chunk-ZZ6RE4P2.mjs";import{n as O,o as $,w as G}from"./chunk-JLZJVQWC.mjs";import{Cc as K,Dc as V,Ec as z,Gb as F,Ic as Y,Jc as h,Kc as D,Lc as x,Nb as S,Oc as pt,Pc as ht,Qc as gt,Ra as b,Sc as ut,Zb as g,ad as nt,bc as mt,cc as ct,ia as lt,jc as m,kc as l,lc as M,mc as et,na as T,nc as it,oa as d,pc as A,tb as p,uc as C,wc as _,xa as I,xd as dt,ya as v,yb as at}from"./chunk-HSX3JMXX.mjs";import{a as w,b as L,g as ra,j as y}from"./chunk-RIAI3ORJ.mjs";var W=class s{constructor(a,t,e,i){this._StorageService=a;this.router=t;this._ErrorLogService=e;this._sharedSocketService=i;this.socket=this._sharedSocketService.getSocket(),this.listenImportdataUpdates()}socket;_snackBar=d(U);ListImportdata=b([]);DetailImportdata=b({});page=b(1);pageCount=b(1);total=b(0);pageSize=b(10);importdataId=b(null);initDB(){return y(this,null,function*(){return yield Yt("ImportdataDB",4,{upgrade(a,t){t<1&&a.createObjectStore("importdatas",{keyPath:"id"}),t<3&&(a.objectStoreNames.contains("importdatas")&&a.deleteObjectStore("importdatas"),a.objectStoreNames.contains("pagination")&&a.deleteObjectStore("pagination"),a.createObjectStore("importdatas",{keyPath:"id"})),t<4}})})}setImportdataId(a){this.importdataId.set(a)}CreateImportdata(a){return y(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(a)},e=yield fetch(`${P.APIURL}/importdata`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let i=yield e.json();this.getAllImportdata(this.pageSize()),this.importdataId.set(i.id)}catch(t){this._ErrorLogService.logError("Failed to CreateImportdata",t),console.error(t)}})}getAllImportdata(){return y(this,arguments,function*(a=this.pageSize(),t=!1){this.pageSize.set(a);let e=this._StorageService.getItem("importdatas_updatedAt")||"0";try{let i={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},r=new URLSearchParams({page:this.page().toString(),limit:a.toString()}),c=yield fetch(`${P.APIURL}/importdata?${r}`,i);c.ok||this.handleError(c.status);let o=yield c.json();return this.ListImportdata.set(o.data),this.page.set(o.page||1),this.pageCount.set(o.pageCount||1),this.total.set(o.total||o.data.length),this.pageSize.set(a),o.data}catch(i){console.error(i)}})}getUpdatedCodeIds(){return y(this,null,function*(){try{let a={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},t=yield fetch(`${P.APIURL}/importdata/updateCodeIds`,a);t.ok||this.handleError(t.status);let e=yield t.json();return this.getAllImportdata(this.pageSize()),e.data}catch(a){this._ErrorLogService.logError("Failed to getUpdatedCodeIds",a),console.error(a)}})}listenImportdataUpdates(){this.socket.off("importdata-updated"),this.socket.on("importdata-updated",()=>y(this,null,function*(){console.log("\u{1F504} D\u1EEF li\u1EC7u s\u1EA3n ph\u1EA9m thay \u0111\u1ED5i, c\u1EADp nh\u1EADt l\u1EA1i cache..."),this._StorageService.removeItem("importdatas_updatedAt"),yield this.getAllImportdata()}))}getImportdataBy(e){return y(this,arguments,function*(a,t=this.pageSize()){this.pageSize.set(t);try{let i={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(L(w({},a),{page:this.page(),limit:t}))},r=yield fetch(`${P.APIURL}/importdata/findby`,i);r.ok||this.handleError(r.status);let c=yield r.json();a.isOne===!0?this.DetailImportdata.set(c):(this._StorageService.setItem("importdatas_updatedAt",new Date().toISOString()),this.ListImportdata.set(c.data),this.page.set(c.page||1),this.pageCount.set(c.pageCount||1),this.total.set(c.total||c.data.length),this.pageSize.set(t))}catch(i){console.error(i)}})}updateImportdata(a){return y(this,null,function*(){try{let t={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(a)},e=yield fetch(`${P.APIURL}/importdata/${a.id}`,t);e.ok||this.handleError(e.status);let i=yield e.json();this.getAllImportdata(this.pageSize()),this.getImportdataBy({id:i.id,isOne:!0},this.pageSize())}catch(t){this._ErrorLogService.logError("Failed to updateImportdata",t),console.error(t)}})}DeleteImportdata(a){return y(this,null,function*(){try{let t={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},e=yield fetch(`${P.APIURL}/importdata/${a.id}`,t);e.ok||this.handleError(e.status),this.getAllImportdata(this.pageSize())}catch(t){this._ErrorLogService.logError("Failed to DeleteImportdata",t),console.error(t)}})}handleError(a){let t="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(a){case 400:t="Th\xF4ng tin \u0111\xE3 t\u1ED3n t\u1EA1i";break;case 401:case 404:t="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:t="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:t="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}this._snackBar.open(t,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}static \u0275fac=function(t){return new(t||s)(T(yt),T(j),T(Dt),T(Ot))};static \u0275prov=lt({token:s,factory:s.\u0275fac,providedIn:"root"})};var f=ra(oa());function pa(s,a){if(s&1&&(m(0,"li"),h(1),l()),s&2){let t=a.$implicit,e=_(2);p(),x(" ",e.getItemDisplayName(t)," ")}}function ha(s,a){if(s&1&&(m(0,"li",17),h(1),l()),s&2){let t=_(2);p(),x(" ... v\xE0 ",t.data.duplicateItems.length-5," m\u1EE5c kh\xE1c ")}}function ga(s,a){if(s&1&&(m(0,"div",11)(1,"p",12)(2,"mat-icon",13),h(3,"error"),l(),h(4),l(),m(5,"ul",14),S(6,pa,2,1,"li",15)(7,ha,2,1,"li",16),l()()),s&2){let t=_();p(4),x(" Ph\xE1t hi\u1EC7n ",t.data.duplicateItems.length," m\u1EE5c tr\xF9ng l\u1EB7p: "),p(2),g("ngForOf",t.data.duplicateItems.slice(0,5)),p(),g("ngIf",t.data.duplicateItems.length>5)}}function ua(s,a){s&1&&(m(0,"div",23),h(1," \u26A0\uFE0F D\u1EEF li\u1EC7u c\u0169 s\u1EBD b\u1ECB thay th\u1EBF b\u1EDFi d\u1EEF li\u1EC7u m\u1EDBi "),l())}function da(s,a){s&1&&(m(0,"div",17),h(1," \u2139\uFE0F Ch\u1EC9 th\xEAm m\u1EDBi c\xE1c m\u1EE5c ch\u01B0a t\u1ED3n t\u1EA1i, b\u1ECF qua c\xE1c m\u1EE5c tr\xF9ng l\u1EB7p "),l())}function fa(s,a){if(s&1){let t=A();m(0,"div",18)(1,"mat-checkbox",19),gt("ngModelChange",function(i){I(t);let r=_();return ht(r.data.isOverwrite,i)||(r.data.isOverwrite=i),v(i)}),m(2,"span",20),h(3,"Ghi \u0111\xE8 l\xEAn d\u1EEF li\u1EC7u c\u0169 (c\xE1c m\u1EE5c tr\xF9ng l\u1EB7p s\u1EBD \u0111\u01B0\u1EE3c c\u1EADp nh\u1EADt)"),l()(),m(4,"div",21),S(5,ua,2,0,"div",22)(6,da,2,0,"div",16),l()()}if(s&2){let t=_();p(),pt("ngModel",t.data.isOverwrite),p(4),g("ngIf",t.data.isOverwrite),p(),g("ngIf",!t.data.isOverwrite)}}function ya(s,a){s&1&&(m(0,"div",24)(1,"div",25)(2,"mat-icon",26),h(3,"check_circle"),l(),m(4,"span"),h(5,"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u tr\xF9ng l\u1EB7p. T\u1EA5t c\u1EA3 s\u1EBD \u0111\u01B0\u1EE3c th\xEAm m\u1EDBi."),l()()())}var Z=class s{constructor(a,t){this.dialogRef=a;this.data=t}getItemDisplayName(a){switch(this.data.dataType){case"S\u1EA3n Ph\u1EA9m":return`${a.masp} - ${a.title}`;case"Kh\xE1ch H\xE0ng":return`${a.makh} - ${a.name}`;case"Nh\xE0 Cung C\u1EA5p":return`${a.mancc} - ${a.name}`;case"B\u1EA3ng Gi\xE1":return`${a.mabanggia} - ${a.title}`;default:return a.name||a.title||a.id||"N/A"}}onConfirm(){this.dialogRef.close({confirmed:!0,overwrite:this.data.isOverwrite})}onCancel(){this.dialogRef.close({confirmed:!1,overwrite:!1})}static \u0275fac=function(t){return new(t||s)(at(Et),at(It))};static \u0275cmp=F({type:s,selectors:[["app-import-confirmation-dialog"]],decls:31,vars:7,consts:[[1,"p-6","min-w-96"],[1,"flex","items-center","mb-4"],[1,"text-orange-500","mr-2"],[1,"text-lg","font-semibold"],[1,"mb-4","text-gray-700"],["class","mt-3",4,"ngIf"],["class","mb-6",4,"ngIf"],["class","mb-4 p-3 bg-green-50 border border-green-200 rounded",4,"ngIf"],[1,"flex","justify-end","space-x-3","mt-6"],["mat-button","","color","warn",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"mt-3"],[1,"text-red-600","font-medium"],[1,"text-red-500","text-sm"],[1,"list-disc","list-inside","text-sm","text-gray-600","mt-2","max-h-32","overflow-y-auto"],[4,"ngFor","ngForOf"],["class","text-blue-600",4,"ngIf"],[1,"text-blue-600"],[1,"mb-6"],[1,"text-sm",3,"ngModelChange","ngModel"],[1,"ml-2"],[1,"mt-2","text-sm","text-gray-600"],["class","text-orange-600",4,"ngIf"],[1,"text-orange-600"],[1,"mb-4","p-3","bg-green-50","border","border-green-200","rounded"],[1,"flex","items-center","text-green-700"],[1,"text-green-500","mr-2"]],template:function(t,e){t&1&&(m(0,"div",0)(1,"div",1)(2,"mat-icon",2),h(3,"warning"),l(),m(4,"h2",3),h(5,"X\xE1c nh\u1EADn Import D\u1EEF li\u1EC7u"),l()(),m(6,"div",4)(7,"p")(8,"strong"),h(9,"Lo\u1EA1i d\u1EEF li\u1EC7u:"),l(),h(10),l(),m(11,"p")(12,"strong"),h(13,"D\u1EEF li\u1EC7u hi\u1EC7n t\u1EA1i:"),l(),h(14),l(),m(15,"p")(16,"strong"),h(17,"D\u1EEF li\u1EC7u m\u1EDBi:"),l(),h(18),l(),S(19,ga,8,3,"div",5),l(),S(20,fa,7,3,"div",6)(21,ya,6,0,"div",7),m(22,"div",8)(23,"button",9),C("click",function(){return e.onCancel()}),m(24,"mat-icon"),h(25,"cancel"),l(),h(26," H\u1EE7y b\u1ECF "),l(),m(27,"button",10),C("click",function(){return e.onConfirm()}),m(28,"mat-icon"),h(29,"file_upload"),l(),h(30),l()()()),t&2&&(p(10),x(" ",e.data.dataType,""),p(4),x(" ",e.data.existingCount," m\u1EE5c"),p(4),x(" ",e.data.newCount," m\u1EE5c"),p(),g("ngIf",e.data.duplicateItems.length>0),p(),g("ngIf",e.data.duplicateItems.length>0),p(),g("ngIf",e.data.duplicateItems.length===0),p(9),x(" ",e.data.duplicateItems.length>0?e.data.isOverwrite?"Import & Ghi \u0111\xE8":"Import & B\u1ECF qua tr\xF9ng l\u1EB7p":"Import"," "))},dependencies:[J,R,H,Q,q,G,O,$,Wt,Jt,X,kt,Ct],encapsulation:2})};var Sa=["drawer"],ba=()=>[1,2,3,4,5];function _a(s,a){if(s&1&&(m(0,"div",21)(1,"div",22),M(2,"mat-progress-spinner",23),m(3,"span",24),h(4),l()()()),s&2){let t=_();p(4),D(t.loadingMessageValue)}}function ka(s,a){s&1&&(m(0,"span"),h(1,"T\u1EA3i Xu\u1ED1ng"),l())}function Ca(s,a){s&1&&(m(0,"span",25),M(1,"mat-progress-spinner",26),h(2," \u0110ang xu\u1EA5t... "),l())}function Ea(s,a){s&1&&(m(0,"mat-icon",27),h(1,"download"),l())}function Ia(s,a){s&1&&(m(0,"span"),h(1,"T\u1EA3i L\xEAn"),l())}function va(s,a){s&1&&(m(0,"span",25),M(1,"mat-progress-spinner",26),h(2," \u0110ang nh\u1EADp... "),l())}function wa(s,a){s&1&&(m(0,"mat-icon",27),h(1,"upload"),l())}function xa(s,a){if(s&1&&(m(0,"div",28)(1,"div",29),M(2,"mat-progress-spinner",30),m(3,"span",31),h(4),l()()()),s&2){let t=_();p(4),D(t.loadingMessageValue)}}function La(s,a){s&1&&(m(0,"mat-icon"),h(1,"check"),l())}function Da(s,a){if(s&1){let t=A();m(0,"span",32),C("click",function(){let i=I(t).$implicit,r=_();return v(!r.isLoadingValue&&!r.isImportingValue&&!r.isExportingValue&&i.status&&r.toggleItem(i))}),S(1,La,2,0,"mat-icon",8),m(2,"span"),h(3),l()()}if(s&2){let t=a.$implicit,e=_();ct("",t.status?"":"hidden",` 
                   `,e.CheckItem(t)?"bg-blue-100":"",` 
                   `,e.isLoadingValue||e.isImportingValue||e.isExportingValue?"opacity-50 cursor-not-allowed":"cursor-pointer",` 
                   flex flex-row space-x-2 items-center p-4 rounded-lg border transition-all duration-200`),p(),g("ngIf",e.CheckItem(t)),p(2),D(t.title)}}function Pa(s,a){s&1&&(m(0,"div",35),M(1,"div",36)(2,"div",37)(3,"div",38),l())}function Ba(s,a){s&1&&(et(0),m(1,"div",33),S(2,Pa,4,0,"div",34),l(),it()),s&2&&(p(2),g("ngForOf",ut(1,ba)))}function Ma(s,a){if(s&1&&(m(0,"div")(1,"span",40),h(2),l(),m(3,"span"),h(4),l(),m(5,"span",41),h(6),l()()),s&2){let t=a.$implicit,e=_(3);mt(`w-full flex flex-row space-x-2 items-center border p-4 rounded-lg
                    `,e.isImportingValue||e.isExportingValue?"opacity-50":"",""),p(2),D(t.type),p(2),D(t.title),p(2),D(t.description)}}function Ta(s,a){if(s&1&&(et(0),S(1,Ma,7,6,"div",39),it()),s&2){let t=_(2);p(),g("ngForOf",t.ListImportdata())}}function Aa(s,a){s&1&&(m(0,"div",42)(1,"span",43),h(2,"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),l()())}function Na(s,a){if(s&1&&S(0,Ta,2,1,"ng-container",20)(1,Aa,3,0,"ng-template",null,2,nt),s&2){let t=Y(2),e=_();g("ngIf",e.ListImportdata().length>0)("ngIfElse",t)}}var E=class{static checkDuplicates(a,t,e){let i=new Set(t.map(r=>r[e]));return a.filter(r=>i.has(r[e]))}static prepareSanphamData(a,t,e){if(e)return a;{let i=new Set(t.map(r=>r.masp));return a.filter(r=>!i.has(r.masp))}}static prepareKhachhangData(a,t,e){if(e)return a;{let i=new Set(t.map(r=>r.makh));return a.filter(r=>!i.has(r.makh))}}static prepareNhacungcapData(a,t,e){if(e)return a;{let i=new Set(t.map(r=>r.mancc));return a.filter(r=>!i.has(r.mancc))}}static prepareBanggiaData(a,t,e){if(e)return a;{let i=new Set(t.map(r=>r.mabanggia));return a.filter(r=>!i.has(r.mabanggia))}}},ta=class s{displayedColumns=[];ColumnName={stt:"#",codeId:"Code",name:"Ti\xEAu \u0110\u1EC1",group:"Nh\xF3m",description:"M\xF4 T\u1EA3",status:"Tr\u1EA1ng Th\xE1i",order:"Th\u1EE9 T\u1EF1",createdAt:"Ng\xE0y T\u1EA1o",updatedAt:"Ng\xE0y C\u1EADp Nh\u1EADt"};FilterColumns=JSON.parse(localStorage.getItem("ImportdataColFilter")||"[]");Columns=[];paginator;sort;drawer;_BanggiaService=d(jt);_SanphamService=d(qt);_KhachhangService=d(Rt);_NhacungcapService=d(Ut);_DonhangService=d(zt);_DathangService=d(Ht);_PhieukhoService=d(Qt);_UserService=d(St);_KhoService=d(Xt);_ImportdataService=d(W);_breakpointObserver=d(ft);_GoogleSheetService=d(Vt);_router=d(j);_dialog=d(vt);_snackBar=d(U);isLoading=b(!1);isImporting=b(!1);isExporting=b(!1);loadingMessage=b("");get isLoadingValue(){return this.isLoading()}get isImportingValue(){return this.isImporting()}get isExportingValue(){return this.isExporting()}get loadingMessageValue(){return this.loadingMessage()}get ListImportTypeValue(){return this.ListImportType()}ListImportType=b([{id:1,title:"S\u1EA3n Ph\u1EA9m",value:"sanpham",status:!0},{id:2,title:"Kh\xE1ch H\xE0ng",value:"khachhang",status:!0},{id:3,title:"Nh\xE0 Cung C\u1EA5p",value:"nhacungcap",status:!0},{id:4,title:"B\u1EA3ng Gi\xE1",value:"banggia",status:!0},{id:5,title:"\u0110\u01A1n H\xE0ng",value:"donhang",status:!0},{id:6,title:"\u0110\u1EB7t H\xE0ng",value:"dathang",status:!0},{id:7,title:"B\u1EA3ng Gi\xE1 Kh\xE1ch H\xE0ng",value:"banggiakhachhang",status:!0},{id:8,title:"B\u1EA3ng Gi\xE1 S\u1EA3n Ph\u1EA9m",value:"banggiasanpham",status:!0},{id:9,title:"Nh\xE0 Cung C\u1EA5p S\u1EA3n Ph\u1EA9m",value:"nhacungcapsanpham",status:!0},{id:10,title:"Xu\u1EA5t Nh\u1EADp T\u1ED3n",value:"xuatnhapton",status:!0}]);ListEdit=b([]);ListImportdata=this._ImportdataService.ListImportdata;TitleExport="export";rawListSP=[];rawListKH=[];rawListNCC=[];rawListBG=[];rawListDH=[];rawListDathang=[];rawListTonkho=[];constructor(){dt(()=>y(this,null,function*(){this.isLoading.set(!0),this.loadingMessage.set("\u0110ang t\u1EA3i d\u1EEF li\u1EC7u...");try{yield this._ImportdataService.getAllImportdata(100,!0),this.loadingMessage.set("\u0110ang t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m..."),yield this._SanphamService.getAllSanpham({pageSize:9999},!0),this.rawListSP=this._SanphamService.ListSanpham(),this.loadingMessage.set("\u0110ang t\u1EA3i danh s\xE1ch kh\xE1ch h\xE0ng..."),yield this._KhachhangService.getAllKhachhang({pageSize:9999},!0),this.rawListKH=this._KhachhangService.ListKhachhang(),this.loadingMessage.set("\u0110ang t\u1EA3i danh s\xE1ch nh\xE0 cung c\u1EA5p..."),yield this._NhacungcapService.getAllNhacungcap(),this.rawListNCC=this._NhacungcapService.ListNhacungcap(),this.loadingMessage.set("\u0110ang t\u1EA3i b\u1EA3ng gi\xE1..."),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),this.loadingMessage.set("\u0110ang t\u1EA3i \u0111\u01A1n h\xE0ng..."),yield this._DonhangService.getAllDonhang(),this.rawListDH=this._DonhangService.ListDonhang(),this.loadingMessage.set("\u0110ang t\u1EA3i \u0111\u1EB7t h\xE0ng..."),yield this._DathangService.getAllDathang(),this.rawListDathang=this._DathangService.ListDathang(),this.loadingMessage.set("\u0110ang t\u1EA3i t\u1ED3n kho..."),yield this._KhoService.getTonKho("1","1000").then(t=>{this.rawListTonkho=t.data}),this.loadingMessage.set("\u0110ang ki\u1EC3m tra quy\u1EC1n..."),yield this._UserService.getProfile();let a=this._UserService.profile()?.permissions?.map(t=>t.name)||[];this.ListImportType.update(t=>t.map(e=>L(w({},e),{status:a.includes("importdata."+e.value)})))}catch(a){console.error("Error loading data:",a),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi t\u1EA3i d\u1EEF li\u1EC7u","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isLoading.set(!1),this.loadingMessage.set("")}}))}ngOnInit(){return y(this,null,function*(){yield this._ImportdataService.getAllImportdata(100,!0),yield this._SanphamService.getAllSanpham(),this.rawListSP=this._SanphamService.ListSanpham(),yield this._KhachhangService.getAllKhachhang(),this.rawListKH=this._KhachhangService.ListKhachhang(),yield this._NhacungcapService.getAllNhacungcap(),this.rawListNCC=this._NhacungcapService.ListNhacungcap(),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),yield this._DonhangService.getAllDonhang(),this.rawListDH=this._DonhangService.ListDonhang(),yield this._DathangService.getAllDathang(),this.rawListDathang=this._DathangService.ListDathang(),yield this._KhoService.getTonKho("1","1000").then(a=>{this.rawListTonkho=a.data})})}applyFilter(a){}toggleAll(){this.ListEdit().length===this.ListImportType().length?(this.ListEdit.set([]),this.TitleExport="export"):(this.ListEdit.set(this.ListImportType()),this.TitleExport="export_all")}toggleItem(a){this.ListEdit().findIndex(e=>e.id===a.id)===-1?(this.TitleExport+="_"+a.value,this.ListEdit.update(e=>[...e,a])):(this.TitleExport=this.TitleExport.replace("_"+a.value,""),this.ListEdit.update(e=>e.filter(i=>i.id!==a.id)))}CheckItem(a){return this.ListEdit().findIndex(e=>e.id===a.id)!==-1}ExportExcel(a){return y(this,null,function*(){if(!this.isExporting()){this.isExporting.set(!0),this.loadingMessage.set("\u0110ang chu\u1EA9n b\u1ECB d\u1EEF li\u1EC7u xu\u1EA5t...");try{let t=Array.isArray(this.rawListSP)&&this.rawListSP.length?this.rawListSP.map(n=>({masp:n.masp,subtitle:n.subtitle,title:n.title,title2:n.title2,giaban:n.giaban,giagoc:n.giagoc,vat:n.vat,dvt:n.dvt,haohut:n.haohut,ghichu:n.ghichu})):[{masp:"",subtitle:"",title:"",title2:"",giaban:"",giagoc:"",vat:"",dvt:"",haohut:"",ghichu:""}],e=Array.isArray(this.rawListKH)&&this.rawListKH.length?this.rawListKH.map(n=>({name:n.name?.trim()||"",tenfile:n.tenfile?.trim()||"",makh:n.makh?.trim()||"",namenn:n.namenn?.trim()||"",mabanggia:n.banggia?.mabanggia?.trim()||"",diachi:n.diachi?.trim()||"",quan:n.quan?.trim()||"",email:n.email?.trim()||"",sdt:n.sdt?.toString().trim()||"",mst:n.mst?.toString().trim()||"",gionhanhang:n.gionhanhang?.toString().trim()||"",loaikh:n.loaikh?.toString().trim()||"khachsi",hiengia:n.hiengia||!0,ghichu:n.ghichu?.toString().trim()||""})):[{name:"",tenfile:"",makh:"",namenn:"",diachi:"",quan:"",email:"",sdt:"",mst:"",gionhanhang:"",loaikh:"khachsi",hiengia:!0,ghichu:""}],i=Array.isArray(this.rawListNCC)&&this.rawListNCC.length>0?this.rawListNCC.map(n=>({name:n.name?.trim()||"",tenfile:n.tenfile?.trim()||"",mancc:n.mancc?.trim()||"",diachi:n.diachi?.trim()||"",email:n.email?.trim()||"",sdt:n.sdt?.toString().trim()||"",ghichu:n.ghichu?.toString().trim()||""})):[{name:"",tenfile:"",mancc:"",diachi:"",email:"",sdt:"",ghichu:""}],r=Array.isArray(this.rawListBG)&&this.rawListBG.length>0?this.rawListBG.map(n=>({title:n.title?.trim()||"",mabanggia:n.mabanggia?.trim()||"",type:n.type?.trim()||"",batdau:(0,f.default)(n.batdau).format("DD/MM/YYYY")||"",ketthuc:(0,f.default)(n.ketthuc).format("DD/MM/YYYY")||"",ghichu:n.ghichu?.trim()||"",status:n.status?.trim()||""})):[{title:"",mabanggia:"",type:"",batdau:"",ketthuc:"",ghichu:"",status:""}],c=Array.isArray(this.rawListDH)&&this.rawListDH.length>0?this.rawListDH.flatMap(n=>Array.isArray(n.sanpham)?n.sanpham.map(u=>({ngaygiao:(0,f.default)(n.ngaygiao).format("DD/MM/YYYY"),makh:n.khachhang?.makh,name:n.khachhang?.name,mabanggia:n.khachhang?.banggia?.[0]?.mabanggia,masp:u.masp,tensp:u.title,sldat:u.sldat,slgiao:u.slgiao,slnhan:u.slnhan,ghichu:u.ghichu})):[]):[{ngaygiao:(0,f.default)().format("DD/MM/YYYY"),makh:"",mabanggia:"",masp:"",tensp:"",sldat:0,slgiao:0,slnhan:0,ghichu:""}],o=Array.isArray(this.rawListDathang)&&this.rawListDathang.length>0?this.rawListDathang.flatMap(n=>Array.isArray(n.sanpham)?n.sanpham.map(u=>({ngaynhan:(0,f.default)(n.ngaynhan).format("DD/MM/YYYY"),mancc:n.nhacungcap?.mancc,name:n.nhacungcap?.name,mabanggia:n.banggia?.[0]?.mabanggia,masp:u.masp,tensp:u.title,sldat:Number(u.sldat)||0,slgiao:Number(u.slgiao)||0,slnhan:Number(u.slnhan)||0,ghichu:u.ghichu})):[]):[{ngaynhan:(0,f.default)().format("DD/MM/YYYY"),mancc:"",name:"",mabanggia:"",masp:"",tensp:"",sldat:0,slgiao:0,slnhan:0,ghichu:""}],B=this.convertBGSPToExport(this.rawListBG,this.rawListSP),tt=this.rawListKH.map(n=>({makh:n.makh||"",name:n.name||"",mabanggia:n.banggia?.mabanggia||""})),aa=this.rawListSP.reduce((n,u)=>(u&&u.masp&&(n[u.masp]=""),n),{}),ea=this.rawListNCC.map(n=>{let u={mancc:n.mancc||"",name:n.name||""},ot=1;for(let st of Object.keys(aa))n.Sanpham?.some(na=>na.masp===st)&&(u[ot]=st,ot++);return u}),ia=this.rawListTonkho.map(n=>({masp:n.masp,title:n.title,dvt:n.dvt,slton:n.slton})),k={};if(this.ListEdit().some(n=>n.value==="sanpham")&&(k.sanpham={data:t}),this.ListEdit().some(n=>n.value==="khachhang")&&(k.khachhang={data:e}),this.ListEdit().some(n=>n.value==="nhacungcap")&&(k.nhacungcap={data:i}),this.ListEdit().some(n=>n.value==="banggia")&&(k.banggia={data:r}),this.ListEdit().some(n=>n.value==="donhang")&&(k.donhang={data:c}),this.ListEdit().some(n=>n.value==="dathang")&&(k.dathang={data:o}),this.ListEdit().some(n=>n.value==="banggiasanpham")&&(k.banggiasanpham={data:B}),this.ListEdit().some(n=>n.value==="banggiakhachhang")&&(k.banggiakhachhang={data:tt}),this.ListEdit().some(n=>n.value==="nhacungcapsanpham")&&(k.nhacungcapsanpham={data:ea}),this.ListEdit().some(n=>n.value==="xuatnhapton")&&(k.xuatnhapton={data:ia}),Object.keys(k).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}this.loadingMessage.set("\u0110ang t\u1EA1o file Excel..."),Ft(k,a),this._snackBar.open("Xu\u1EA5t d\u1EEF li\u1EC7u th\xE0nh c\xF4ng!","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(t){console.error("Error exporting Excel:",t),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi xu\u1EA5t d\u1EEF li\u1EC7u","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isExporting.set(!1),this.loadingMessage.set("")}}})}convertBGSPToExport(a,t){let e=new Set(a.map(i=>i.mabanggia));return t.map(i=>w({masp:i.masp,title:i.title,giaban:i.giaban.toString()},Array.from(e).reduce((r,c)=>(r[c]=i.giaban.toString(),r),{})))}convertBGSPToImport(a){return!a||a.length===0?[]:Object.keys(a[0]).filter(i=>!["masp","title","giagoc"].includes(i)).map(i=>({mabanggia:i,title:`B\u1EA3ng gi\xE1 ${i.replace("BG","")}`,sanpham:a.map(r=>({masp:r.masp?.toString().trim()||"",title:r.title?.toString().trim()||"",giagoc:r.giagoc||0,giaban:r[i]||0}))}))}convertNCCSPToImport(a){if(!a||a.length===0)return[];let t=Object.keys(a[0]).filter(e=>!["mancc","name"].includes(e));return a.forEach(e=>{e.Sanpham=[];for(let i of t)e[i]!==void 0&&e[i]!==null&&e[i]!==""&&e.Sanpham.push(e[i]),delete e[i]}),a}ImportExcel(a){return y(this,null,function*(){if(!this.isImporting()){this.isImporting.set(!0),this.loadingMessage.set("\u0110ang \u0111\u1ECDc file Excel...");try{let t=yield Kt(a);this.loadingMessage.set("\u0110ang x\u1EED l\xFD d\u1EEF li\u1EC7u..."),yield this.DoImportData(t)}catch(t){console.error("Error importing Excel:",t),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi \u0111\u1ECDc file Excel","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isImporting.set(!1),this.loadingMessage.set("")}}})}showImportConfirmDialog(a,t,e,i){return y(this,null,function*(){return new Promise(r=>{let c={dataType:a,existingCount:t,newCount:e,duplicateItems:i,isOverwrite:!1};this._dialog.open(Z,{width:"500px",data:c,disableClose:!0}).afterClosed().subscribe(B=>{r(B||{confirmed:!1,overwrite:!1})})})})}DoImportData(a){return y(this,null,function*(){if(Object.keys(this.ListEdit()).length===0){this._snackBar.open("Ch\u01B0a Ch\u1ECDn Lo\u1EA1i D\u1EEF Li\u1EC7u","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}if(Object.keys(a).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 nh\u1EADp","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}if(a.sanpham&&a.sanpham.length>0&&this.ListEdit().some(t=>t.value==="sanpham")){let t=(a.sanpham||[]).map(o=>({masp:o.masp,subtitle:N((o.title||"")+(o.title2||"")),title:o.title,title2:o.title2,giaban:Number(o.giaban)||Number(o.giagoc)||0,giagoc:Number(o.giagoc)||0,vat:Number(o.vat)||0,dvt:o.dvt,haohut:Number(o.haohut)||0,ghichu:o.ghichu})).filter(o=>o.masp!==void 0&&o.masp!==null&&o.masp!==""),e=E.checkDuplicates(t,this.rawListSP,"masp"),i=yield this.showImportConfirmDialog("S\u1EA3n Ph\u1EA9m",this.rawListSP.length,t.length,e);if(!i.confirmed)return;let r=E.prepareSanphamData(t,this.rawListSP,i.overwrite);if(r.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u m\u1EDBi \u0111\u1EC3 import","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let c=this._snackBar.open(`\u0110ang import ${r.length} s\u1EA3n ph\u1EA9m...`,"",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});try{yield this._SanphamService.ImportSanpham(r),c.dismiss(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${r.length} s\u1EA3n ph\u1EA9m${i.overwrite?" (ghi \u0111\xE8)":" (th\xEAm m\u1EDBi)"}!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{c.dismiss(),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(a.khachhang&&a.khachhang.length>0&&this.ListEdit().some(t=>t.value==="khachhang")){let t=(a.khachhang||[]).map(o=>({name:o.name.toString(),makh:o.makh,tenfile:N(o.tenfile.toString()||o.name.toString()||""),subtitle:N((o.name.toString()||"")+(o.namenn.toString()||"")),namenn:o.namenn.toString(),diachi:o.diachi,quan:o.quan,email:o.email,sdt:o.sdt.toString(),mst:o.mst.toString(),gionhanhang:o.gionhanhang.toString(),loaikh:o.loaikh,ghichu:o.ghichu,hiengia:o.hiengia,mabanggia:o.mabanggia})).filter(o=>o.makh!==void 0&&o.makh!==null&&o.makh!==""),e=E.checkDuplicates(t,this.rawListKH,"makh"),i=yield this.showImportConfirmDialog("Kh\xE1ch H\xE0ng",this.rawListKH.length,t.length,e);if(!i.confirmed)return;let r=E.prepareKhachhangData(t,this.rawListKH,i.overwrite);if(r.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u m\u1EDBi \u0111\u1EC3 import","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let c=this._snackBar.open(`\u0110ang import ${r.length} kh\xE1ch h\xE0ng...`,"",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});try{yield this._KhachhangService.ImportKhachhang(r),c.dismiss(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${r.length} kh\xE1ch h\xE0ng${i.overwrite?" (ghi \u0111\xE8)":" (th\xEAm m\u1EDBi)"}!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{c.dismiss(),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import kh\xE1ch h\xE0ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(a.nhacungcap&&a.nhacungcap.length>0&&this.ListEdit().some(t=>t.value==="nhacungcap")){let t=(a.nhacungcap||[]).map(o=>({name:o.name,tenfile:N(o.tenfile.toString()||o.name||""),mancc:o.mancc,diachi:o.diachi,email:o.email,sdt:o.sdt.toString(),ghichu:o.ghichu})).filter(o=>o.mancc!==void 0&&o.mancc!==null&&o.mancc!==""),e=E.checkDuplicates(t,this.rawListNCC,"mancc"),i=yield this.showImportConfirmDialog("Nh\xE0 Cung C\u1EA5p",this.rawListNCC.length,t.length,e);if(!i.confirmed)return;let r=E.prepareNhacungcapData(t,this.rawListNCC,i.overwrite);if(r.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u m\u1EDBi \u0111\u1EC3 import","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let c=this._snackBar.open(`\u0110ang import ${r.length} nh\xE0 cung c\u1EA5p...`,"",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});try{yield this._NhacungcapService.ImportNhacungcap(r),c.dismiss(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${r.length} nh\xE0 cung c\u1EA5p${i.overwrite?" (ghi \u0111\xE8)":" (th\xEAm m\u1EDBi)"}!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{c.dismiss(),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import nh\xE0 cung c\u1EA5p","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(a.banggia&&a.banggia.length>0&&this.ListEdit().some(t=>t.value==="banggia")){let t=(a.banggia||[]).map(o=>({title:"B\u1EA3ng Gi\xE1 "+o.mabanggia,mabanggia:o.mabanggia,type:o.type,batdau:(0,f.default)(o.batdau,"DD/MM/YYYY").toDate(),ketthuc:(0,f.default)(o.ketthuc,"DD/MM/YYYY").toDate(),ghichu:o.ghichu,status:o.status})).filter(o=>o.mabanggia!==void 0&&o.mabanggia!==null&&o.mabanggia!==""),e=E.checkDuplicates(t,this.rawListBG,"mabanggia"),i=yield this.showImportConfirmDialog("B\u1EA3ng Gi\xE1",this.rawListBG.length,t.length,e);if(!i.confirmed)return;let r=E.prepareBanggiaData(t,this.rawListBG,i.overwrite);if(r.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u m\u1EDBi \u0111\u1EC3 import","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let c=this._snackBar.open(`\u0110ang import ${r.length} b\u1EA3ng gi\xE1...`,"",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});try{yield this._BanggiaService.ImportBanggia(r),c.dismiss(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${r.length} b\u1EA3ng gi\xE1${i.overwrite?" (ghi \u0111\xE8)":" (th\xEAm m\u1EDBi)"}!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{c.dismiss(),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import b\u1EA3ng gi\xE1","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(a.donhang&&a.donhang.length>0&&this.ListEdit().some(t=>t.value==="donhang")){let t=(a.donhang||[]).map(i=>({ngay:i.ngay,makh:i.makh,mabangia:i.mabangia,masp:i.masp,sldat:Number(i.sldat),slgiao:Number(i.slgiao),slnhan:Number(i.slnhan),ghichu:i.ghichu})).filter(i=>i.makh!==void 0&&i.makh!==null&&i.makh!==""&&i.masp!==void 0&&i.masp!==null&&i.masp!==""),e=this._snackBar.open("\u0110ang import \u0110\u01A1n h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DonhangService.ImportDonhang(t),e.dismiss(),this._snackBar.open("Import \u0110\u01A1n h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(a.banggiasanpham&&a.banggiasanpham.length>0&&this.ListEdit().some(t=>t.value==="banggiasanpham")){let t=this.convertBGSPToImport(a.banggiasanpham),e=t.find(r=>r.mabanggia==="giaban");if(!e)return;let i=t.map(r=>{if(r.mabanggia==="giaban")return r;let c=r.sanpham.map(o=>{if(o.giaban==="0"){let B=e.sanpham.find(tt=>tt.masp===o.masp);return L(w({},o),{giaban:B?B.giaban:o.giaban})}return o});return L(w({},r),{sanpham:c})});yield this._BanggiaService.importSPBG(i)}if(a.banggiakhachhang&&a.banggiakhachhang.length>0&&this.ListEdit().some(t=>t.value==="banggiakhachhang")){console.log("Importing banggiakhachhang data:",a.banggiakhachhang);let t=(a.banggiakhachhang||[]).map(e=>({makh:e.makh,name:e.name,mabanggia:e.mabanggia})).filter(e=>e.mabanggia!==void 0&&e.mabanggia!==null&&e.mabanggia!=="");console.log("Importing ListBGKH data:",t),yield this._KhachhangService.ImportKhachhang(t),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(a.nhacungcapsanpham&&a.nhacungcapsanpham.length>0&&this.ListEdit().some(t=>t.value==="nhacungcapsanpham")){let t=this.convertNCCSPToImport(a.nhacungcapsanpham);console.log(t);let e=t.filter(r=>r?.Sanpham?.length>0).map(r=>L(w({},r),{Sanpham:r?.Sanpham?.map(c=>this.rawListSP.find(o=>o?.masp===c))})),i=this._snackBar.open("\u0110ang import Nh\xE0 cung c\u1EA5p s\u1EA3n ph\u1EA9m...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._NhacungcapService.ImportNhacungcap(e),i.dismiss(),this._snackBar.open("Import Nh\xE0 cung c\u1EA5p s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(a.xuatnhapton&&a.xuatnhapton.length>0&&this.ListEdit().some(t=>t.value==="xuatnhapton")){let t=[],e=[];a.xuatnhapton.forEach(i=>{let r=this.rawListTonkho.find(c=>c.masp===i.masp);r&&(i.slton>r.slton?t.push({sanphamId:this.rawListSP.find(c=>c.masp===i.masp).id,soluong:i.slton-r.slton}):i.slton<r.slton&&e.push({sanphamId:this.rawListSP.find(c=>c.masp===i.masp).id,soluong:r.slton-i.slton}))}),t.length>0&&(yield this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${(0,f.default)().format("DD/MM/YYYY ")}`,type:"nhap",sanpham:t,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${(0,f.default)().format("HH:mm:ss DD/MM/YYYY ")}`,ngay:(0,f.default)()}),this._snackBar.open("C\u1EADp nh\u1EADt t\u1ED3n kho th\xE0nh c\xF4ng Th\xEAm phi\u1EBFu Nh\u1EADp Kho","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})),e.length>0&&(yield this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${(0,f.default)().format("DD/MM/YYYY ")}`,type:"xuat",sanpham:e,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${(0,f.default)().format("HH:mm:ss DD/MM/YYYY ")}`,ngay:(0,f.default)()}),this._snackBar.open("C\u1EADp nh\u1EADt t\u1ED3n kho th\xE0nh c\xF4ng Th\xEAm phi\u1EBFu Xu\u1EA5t Kho","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})),t.length===0&&e.length===0&&this._snackBar.open("Kho kh\xF4ng thay \u0111\u1ED5i","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(a.dathang&&this.ListEdit().some(t=>t.value==="dathang")){let t=(a.dathang||[]).filter(i=>i.mancc&&i.masp).map(i=>({ngaynhan:(0,f.default)(rt(i.ngaynhan)).toDate(),mancc:i.mancc,mabanggia:i.mabanggia,masp:i.masp,sldat:Number(i.sldat),slgiao:Number(i.sldat),slnhan:Number(i.sldat),ghichu:i.ghichu}));console.log(t);let e=this._snackBar.open("\u0110ang import \u0110\u1EB7t h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DathangService.ImportDathang(t),e.dismiss(),this._snackBar.open("Import \u0110\u1EB7t h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(a.donhang&&this.ListEdit().some(t=>t.value==="donhang")){let t=(a.donhang||[]).filter(i=>i.makh&&i.masp).map(i=>({ngaygiao:(0,f.default)(rt(i.ngaygiao)).toDate(),makh:i.makh,mabanggia:i.mabangia,masp:i.masp,sldat:Number(i.sldat),slgiao:Number(i.slgiao),slnhan:Number(i.slnhan),ghichu:i.ghichu})),e=this._snackBar.open("\u0110ang import \u0110\u01A1n h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DonhangService.ImportDonhang(t),e.dismiss(),this._snackBar.open("Import \u0110\u01A1n h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}})}trackByFn(a,t){return t.id}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=F({type:s,selectors:[["app-listimportdata"]],viewQuery:function(t,e){if(t&1&&(K(Bt,5),K(Tt,5),K(Sa,7)),t&2){let i;V(i=z())&&(e.paginator=i.first),V(i=z())&&(e.sort=i.first),V(i=z())&&(e.drawer=i.first)}},decls:28,vars:17,consts:[["uploadfile",""],["dataContent",""],["noData",""],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-4"],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",4,"ngIf"],[1,"flex","flex-col","space-y-2","p-8"],[1,"flex","flex-row","space-x-2","items-center"],["mat-flat-button","","color","primary",3,"click","disabled"],[4,"ngIf"],["class","flex items-center",4,"ngIf"],["class","ml-1",4,"ngIf"],["type","file","accept",".xlsx,.xls",1,"hidden",3,"change","disabled"],["class","w-full p-4 bg-blue-50 rounded-lg border border-blue-200",4,"ngIf"],[1,"grid","grid-cols-3","gap-4"],[3,"class","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"w-full","flex","flex-col","space-y-2","p-8"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40","disabled:bg-gray-100","disabled:cursor-not-allowed",3,"keyup","disabled"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[4,"ngIf","ngIfElse"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","flex","flex-col","items-center","space-y-4"],["diameter","50","mode","indeterminate"],[1,"text-lg","font-medium"],[1,"flex","items-center"],["diameter","20","mode","indeterminate",1,"mr-2"],[1,"ml-1"],[1,"w-full","p-4","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"flex","items-center","space-x-2"],["diameter","20","mode","indeterminate"],[1,"text-blue-700"],[3,"click"],[1,"w-full","flex","flex-col","space-y-2"],["class","w-full flex flex-row space-x-2 items-center border p-4 rounded-lg bg-gray-100 animate-pulse",4,"ngFor","ngForOf"],[1,"w-full","flex","flex-row","space-x-2","items-center","border","p-4","rounded-lg","bg-gray-100","animate-pulse"],[1,"rounded-lg","p-2","bg-gray-300","w-16","h-8"],[1,"bg-gray-300","h-4","w-1/3","rounded"],[1,"bg-gray-300","h-3","w-1/2","rounded"],[3,"class",4,"ngFor","ngForOf"],[1,"rounded-lg","p-2","bg-blue-100"],[1,"text-sm","text-gray-600"],[1,"w-full","flex","flex-row","items-center","justify-center","border","p-4","rounded-lg","bg-gray-100"],[1,"text-gray-600"]],template:function(t,e){if(t&1){let i=A();m(0,"div",3),S(1,_a,5,1,"div",4),m(2,"div",5)(3,"div",6)(4,"button",7),C("click",function(){return I(i),v(e.ExportExcel(e.TitleExport))}),S(5,ka,2,0,"span",8)(6,Ca,3,0,"span",9)(7,Ea,2,0,"mat-icon",10),l(),m(8,"button",7),C("click",function(){I(i);let c=Y(15);return v(c.click())}),S(9,Ia,2,0,"span",8)(10,va,3,0,"span",9)(11,wa,2,0,"mat-icon",10),l(),m(12,"button",7),C("click",function(){return I(i),v(e.toggleAll())}),h(13," Ch\u1ECDn T\u1EA5t C\u1EA3 "),l(),m(14,"input",11,0),C("change",function(c){return I(i),v(e.ImportExcel(c))}),l()(),S(16,xa,5,1,"div",12),m(17,"div",13),S(18,Da,4,7,"span",14),l()(),m(19,"div",15)(20,"div",16)(21,"input",17),C("keyup",function(c){return I(i),v(e.applyFilter(c))}),l(),m(22,"div",18)(23,"span",19),h(24,"search"),l()()(),S(25,Ba,3,2,"ng-container",20)(26,Na,3,2,"ng-template",null,1,nt),l()()}if(t&2){let i=Y(27);p(),g("ngIf",e.isLoadingValue||e.isImportingValue||e.isExportingValue),p(3),g("disabled",e.isLoadingValue||e.isImportingValue||e.isExportingValue),p(),g("ngIf",!e.isExportingValue),p(),g("ngIf",e.isExportingValue),p(),g("ngIf",!e.isExportingValue),p(),g("disabled",e.isLoadingValue||e.isImportingValue||e.isExportingValue),p(),g("ngIf",!e.isImportingValue),p(),g("ngIf",e.isImportingValue),p(),g("ngIf",!e.isImportingValue),p(),g("disabled",e.isLoadingValue||e.isImportingValue||e.isExportingValue),p(2),g("disabled",e.isLoadingValue||e.isImportingValue||e.isExportingValue),p(2),g("ngIf",e.isLoadingValue),p(2),g("ngForOf",e.ListImportTypeValue)("ngForTrackBy",e.trackByFn),p(3),g("disabled",e.isLoadingValue||e.isImportingValue||e.isExportingValue),p(4),g("ngIf",e.isLoadingValue)("ngIfElse",i)}},dependencies:[wt,xt,Nt,At,Mt,_t,bt,Q,q,R,H,Lt,G,O,$,X,Pt,J,Gt,$t],encapsulation:2,changeDetection:0})};export{W as a,ta as b};
