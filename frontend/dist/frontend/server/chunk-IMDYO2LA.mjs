import './polyfills.server.mjs';
import{a as Te,b as Ee}from"./chunk-SEVQI56U.mjs";import{a as be}from"./chunk-5IGIVQ3I.mjs";import{a as z}from"./chunk-ZQEOJBNW.mjs";import{a as De}from"./chunk-NCG5CKEW.mjs";import"./chunk-AICHI2NV.mjs";import{a as ne}from"./chunk-XSDCRXGH.mjs";import{a as te,b as ee}from"./chunk-UKVYI7NX.mjs";import"./chunk-ETGHWKBN.mjs";import{a as ke}from"./chunk-2WSS3LRP.mjs";import{a as N,b as re}from"./chunk-NHBN3KVL.mjs";import{a as O,b as oe,c as se}from"./chunk-UWYQSDH5.mjs";import{a as ie,b as ae,c as le,d as ce,e as me,g as de,h as pe,j as ue,k as he,m as ge,n as _e,p as fe,q as ye,r as xe,s as Ce}from"./chunk-3WL3NMNZ.mjs";import{a as Wt}from"./chunk-U5FJLS4G.mjs";import{a as Xt,b as Zt,c as Ut,k as Yt}from"./chunk-F2MT3ZLT.mjs";import{a as Jt}from"./chunk-26NM6QMQ.mjs";import{b as Rt,d as Qt,e as jt}from"./chunk-4AA42E7K.mjs";import{a as kt,b as Dt,c as bt}from"./chunk-UYI34SQK.mjs";import{a as Vt,b as Mt,c as Ft,d as Lt}from"./chunk-OMPCUEDD.mjs";import{b as Kt}from"./chunk-N47DGJDC.mjs";import{A as zt,B as Ht,b as It,g as Pt,j as Bt,p as Gt,r as qt,t as At,u as $t,x as Nt,y as Ot}from"./chunk-GLAPW3UN.mjs";import"./chunk-J6642ETB.mjs";import{a as Tt,b as Et}from"./chunk-X7LLP2RY.mjs";import"./chunk-6EFOJMAD.mjs";import{a as wt}from"./chunk-Q5TTQGDU.mjs";import{a as $}from"./chunk-Y4GFH6XC.mjs";import"./chunk-2DIQ5JYQ.mjs";import"./chunk-RLIINVZD.mjs";import{a as Ct,c as St,e as vt}from"./chunk-7QZZCVTG.mjs";import{y as yt,z as xt}from"./chunk-LYCTG6ML.mjs";import"./chunk-7T6LZHUD.mjs";import{b as ft,d as A}from"./chunk-XSJY5HPB.mjs";import"./chunk-EMLDMP5T.mjs";import{m as dt,n as pt,o as ut,u as ht,w as gt,y as _t}from"./chunk-7VXCQSQV.mjs";import{Bc as B,Cc as G,Dc as q,Fb as nt,Gc as F,Hc as d,Ic as T,Jc as x,Mb as v,Mc as j,Nc as J,Oc as W,Qc as X,Ra as S,Rc as lt,Vc as ct,Wc as k,Xb as it,Yb as u,Yc as D,ac as at,dc as P,fc as rt,gc as R,hc as Q,ic as r,ja as et,jc as o,kc as w,lc as ot,mc as st,oc as M,pa as y,tb as m,tc as f,vc as s,wd as mt,ya as h,za as g}from"./chunk-KYBR54ZN.mjs";import"./chunk-XAZRL6IZ.mjs";import{b as ve,f as we}from"./chunk-POE2MFM3.mjs";import"./chunk-UBJTQR5H.mjs";import{a as Se}from"./chunk-MGIVCIKU.mjs";import{a as V,b as I,g as tt,h as K,j as _}from"./chunk-RIAI3ORJ.mjs";var Z=tt(Se());var H=class a{_GraphqlService=y(ne);_StorageService=y(wt);_router=y(A);_snackBar=y($);_ErrorLogService=y(Wt);_sharedSocketService=y(De);_donhangService=y(z);socket;ListDonhang=S([]);ListVandon=S([]);DetailDonhang=S({});page=S(1);totalPages=S(1);total=S(0);pageSize=S(50);donhangId=S(null);loading=S(!1);error=S(null);constructor(){this.socket=this._sharedSocketService.getSocket(),this.socket?.on("donhang:updated",e=>{this.refreshDonhangData()})}setDonhangId(e){this.donhangId.set(e),e&&this.getOneDonhang(e)}searchDonhang(e){return _(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let t={};e.Batdau&&e.Ketthuc&&(t.ngaygiao={gte:(0,Z.default)(e.Batdau).startOf("day").toISOString(),lte:(0,Z.default)(e.Ketthuc).endOf("day").toISOString()}),e.Status&&(t.status=e.Status);let n=yield this._GraphqlService.findMany("donhang",{where:t,include:{khachhang:{select:{id:!0,name:!0,sdt:!0,diachi:!0}},sanpham:{select:{id:!0,idSP:!0,sldat:!0,slgiao:!0,slnhan:!0,slhuy:!0,ttdat:!0,ttgiao:!0,ttnhan:!0,ghichu:!0,order:!0,isActive:!0,giaban:!0,ttsauvat:!0,vat:!0,sanpham:{select:{id:!0,masp:!0,title:!0,giagoc:!0,dvt:!0}}}}},orderBy:{createdAt:"desc"},take:e.pageSize||9999});this.ListDonhang.set(n||[]);let i=this.createVandonList(n||[]);return this.ListVandon.set(i),this.loading.set(!1),n}catch(t){throw this.error.set(t.message||"L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u \u0111\u01A1n h\xE0ng"),this.loading.set(!1),yield this._ErrorLogService.logError(`L\u1ED7i t\xECm ki\u1EBFm \u0111\u01A1n h\xE0ng GraphQL: ${t.message||t}`),t}})}createVandonList(e){return e.flatMap((t,n)=>(t.sanpham||[]).map(i=>({id:i.id,idSP:i.idSP,sldat:i.sldat,slgiao:i.slgiao,slnhan:i.slnhan,slhuy:i.slhuy,ttdat:i.ttdat,ttgiao:i.ttgiao,ttnhan:i.ttnhan,ghichu:i.ghichu,order:i.order,isActive:i.isActive,giaban:i.giaban,ttsauvat:i.ttsauvat,vat:i.vat,masp:i.sanpham?.masp,title:i.sanpham?.title,giagoc:i.sanpham?.giagoc,dvt:i.sanpham?.dvt,madonhang:t.madonhang,khachhang:t.khachhang?.name,sdt:t.khachhang?.sdt,diachi:t.khachhang?.diachi,createdAt:t.createdAt,ngaygiao:t.ngaygiao,status:t.status}))).map((t,n)=>I(V({},t),{stt:n+1}))}getOneDonhang(e){return _(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let t=yield this._GraphqlService.findUnique("donhang",{id:e},{include:{khachhang:{select:{id:!0,name:!0,sdt:!0,diachi:!0,email:!0}},sanpham:{select:{id:!0,idSP:!0,sldat:!0,slgiao:!0,slnhan:!0,slhuy:!0,ttdat:!0,ttgiao:!0,ttnhan:!0,ghichu:!0,order:!0,isActive:!0,giaban:!0,ttsauvat:!0,vat:!0,sanpham:{select:{id:!0,masp:!0,title:!0,giagoc:!0,dvt:!0}}}},user:{select:{id:!0,email:!0,profile:{select:{name:!0}}}}}});return this.DetailDonhang.set(t||{}),this.loading.set(!1),t}catch(t){throw this.error.set(t.message||"L\u1ED7i khi t\u1EA3i chi ti\u1EBFt \u0111\u01A1n h\xE0ng"),this.loading.set(!1),yield this._ErrorLogService.logError(`L\u1ED7i l\u1EA5y chi ti\u1EBFt \u0111\u01A1n h\xE0ng GraphQL: ${t.message||t}`),t}})}CreateDonhang(e){return _(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let t={madonhang:e.madonhang||this.generateMaDonhang(),status:e.status||"dadat",tongtien:e.tongtien||0,khachhangId:e.khachhangId,ngaygiao:e.ngaygiao?new Date(e.ngaygiao).toISOString():null,ghichu:e.ghichu||"",order:e.order||1,isActive:e.isActive!==void 0?e.isActive:!0},n=yield this._GraphqlService.createOne("donhang",t);return yield this.refreshDonhangData(),this._snackBar.open("T\u1EA1o \u0111\u01A1n h\xE0ng th\xE0nh c\xF4ng","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.loading.set(!1),n}catch(t){throw this.error.set(t.message||"L\u1ED7i khi t\u1EA1o \u0111\u01A1n h\xE0ng"),this.loading.set(!1),yield this._ErrorLogService.logError(`L\u1ED7i t\u1EA1o \u0111\u01A1n h\xE0ng GraphQL: ${t.message||t}`),this._snackBar.open("L\u1ED7i khi t\u1EA1o \u0111\u01A1n h\xE0ng: "+t.message,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),t}})}updateDonhang(e){return _(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let t={madonhang:e.madonhang,status:e.status,tongtien:e.tongtien,khachhangId:e.khachhangId,ngaygiao:e.ngaygiao?new Date(e.ngaygiao).toISOString():null,ghichu:e.ghichu,order:e.order,isActive:e.isActive},n=yield this._GraphqlService.updateOne("donhang",{id:e.id},t);return yield this.refreshDonhangData(),this._snackBar.open("C\u1EADp nh\u1EADt \u0111\u01A1n h\xE0ng th\xE0nh c\xF4ng","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.loading.set(!1),n}catch(t){throw this.error.set(t.message||"L\u1ED7i khi c\u1EADp nh\u1EADt \u0111\u01A1n h\xE0ng"),this.loading.set(!1),yield this._ErrorLogService.logError(`L\u1ED7i c\u1EADp nh\u1EADt \u0111\u01A1n h\xE0ng GraphQL: ${t.message||t}`),this._snackBar.open("L\u1ED7i khi c\u1EADp nh\u1EADt \u0111\u01A1n h\xE0ng: "+t.message,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),t}})}deleteDonhang(e){return _(this,null,function*(){try{this.loading.set(!0),this.error.set(null),yield this._GraphqlService.deleteOne("donhang",{id:e}),yield this.refreshDonhangData(),this._snackBar.open("X\xF3a \u0111\u01A1n h\xE0ng th\xE0nh c\xF4ng","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.loading.set(!1)}catch(t){throw this.error.set(t.message||"L\u1ED7i khi x\xF3a \u0111\u01A1n h\xE0ng"),this.loading.set(!1),yield this._ErrorLogService.logError(`L\u1ED7i x\xF3a \u0111\u01A1n h\xE0ng GraphQL: ${t.message||t}`),this._snackBar.open("L\u1ED7i khi x\xF3a \u0111\u01A1n h\xE0ng: "+t.message,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),t}})}refreshDonhangData(){return _(this,null,function*(){this.ListDonhang().length>0&&(yield this.searchDonhang({pageSize:9999}))})}generateMaDonhang(){let e=new Date().getTime(),t=Math.floor(Math.random()*1e3);return`DH${e}${t}`}exportVandonToExcel(e){return _(this,null,function*(){try{let t=e||this.ListVandon(),n=this._donhangService.ListDonhang();if(t.length===0&&n.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let i=t.map((c,C)=>({STT:C+1,"M\xE3 \u0110\u01A1n H\xE0ng":c.madonhang||"","Kh\xE1ch H\xE0ng":c.khachhang||"","T\xEAn S\u1EA3n Ph\u1EA9m":c.title||"","\u0110\u01A1n V\u1ECB T\xEDnh":c.dvt||"","SL \u0110\u1EB7t":Number(c.sldat)||0,"SL Giao":Number(c.slgiao)||0,"SL Nh\u1EADn":Number(c.slnhan)||0,"Ng\xE0y Giao":c.ngaygiao?new Date(c.ngaygiao).toLocaleDateString("vi-VN"):"","Tr\u1EA1ng Th\xE1i":this.getStatusLabel(c.status)||""})),l=n.map((c,C)=>({STT:C+1,"Ng\xE0y Giao":c.ngaygiao?new Date(c.ngaygiao).toLocaleString("vi-VN"):"","T\xEAn Kh\xE1ch H\xE0ng":c.name||"","S\u1ED1 L\u01B0\u1EE3ng":c.soluongtt||0,Chuy\u1EBFn:c.chuyen||"","\u0110\u1ECBa Ch\u1EC9":c.diachi||"","Li\xEAn H\u1EC7":"","S\u1ED1 \u0110i\u1EC7n Tho\u1EA1i":c.sdt||"","Gi\u1EDD Nh\u1EADn H\xE0ng":c.gionhanhang||"","T\u1ED5ng S\u1ED1 M\xF3n":c.tongsomon||0,"S\u1ED1 L\u01B0\u1EE3ng TT":c.loadpoint||0,Shipper:c.shipper||"","Gi\u1EDD \u0110i":c.giodi||"","Gi\u1EDD V\u1EC1":c.giove||"","K\xFD Nh\u1EADn":c.kynhan||""})),{writeExcelFileSheets:p}=yield import("./chunk-T2AREUUV.mjs"),b=`VanDon_PhieuChuyen_${new Date().toISOString().slice(0,10)}`;p({"V\u1EADn \u0110\u01A1n":{data:i},"Phi\u1EBFu Chuy\u1EC3n":{data:l}},b),this._snackBar.open("Xu\u1EA5t Excel th\xE0nh c\xF4ng","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(t){yield this._ErrorLogService.logError(`L\u1ED7i xu\u1EA5t Excel v\u1EADn \u0111\u01A1n: ${t.message||t}`),this._snackBar.open("L\u1ED7i khi xu\u1EA5t Excel: "+t.message,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}getStatusLabel(e){return{dadat:"\u0110\xE3 \u0110\u1EB7t",dagiao:"\u0110\xE3 Giao",danhan:"\u0110\xE3 Nh\u1EADn",hoanthanh:"Ho\xE0n Th\xE0nh",huy:"H\u1EE7y"}[e]||e}getStatistics(e){return _(this,null,function*(){try{let t={};e?.Batdau&&e?.Ketthuc&&(t.createdAt={gte:new Date(e.Batdau).toISOString(),lte:new Date(e.Ketthuc).toISOString()});let n=yield this._GraphqlService.findMany("donhang",{where:t,select:{id:!0}}),i=yield this._GraphqlService.findMany("donhang",{where:I(V({},t),{status:"hoanthanh"}),select:{id:!0}}),l=yield this._GraphqlService.findMany("donhang",{where:I(V({},t),{status:"huy"}),select:{id:!0}});return{total:n?.length||0,completed:i?.length||0,cancelled:l?.length||0,pending:(n?.length||0)-(i?.length||0)-(l?.length||0)}}catch(t){return console.error("Error getting statistics:",t),{total:0,completed:0,cancelled:0,pending:0}}})}quickSearch(e){return _(this,null,function*(){try{this.loading.set(!0);let t=yield this._GraphqlService.findMany("donhang",{where:{OR:[{madonhang:{contains:e,mode:"insensitive"}},{khachhang:{name:{contains:e,mode:"insensitive"}}},{khachhang:{sdt:{contains:e}}}]},include:{khachhang:{select:{id:!0,name:!0,sdt:!0,diachi:!0}},sanpham:{select:{id:!0,idSP:!0,sldat:!0,slgiao:!0,slnhan:!0,slhuy:!0,ttdat:!0,ttgiao:!0,ttnhan:!0,ghichu:!0,order:!0,isActive:!0,giaban:!0,ttsauvat:!0,vat:!0,sanpham:{select:{id:!0,masp:!0,title:!0,giagoc:!0,dvt:!0}}}}},orderBy:{createdAt:"desc"},take:100});this.ListDonhang.set(t||[]);let n=this.createVandonList(t||[]);return this.ListVandon.set(n),this.loading.set(!1),t}catch(t){throw this.error.set(t.message||"L\u1ED7i khi t\xECm ki\u1EBFm"),this.loading.set(!1),t}})}static \u0275fac=function(t){return new(t||a)};static \u0275prov=et({token:a,factory:a.\u0275fac,providedIn:"root"})};var U=tt(Se());var Ie=["drawer"],Ve=()=>({standalone:!0}),Pe=a=>[50,100,a],Be=(a,e,t,n,i)=>({"text-blue-500":a,"text-yellow-500":e,"text-green-500":t,"text-purple-500":n,"text-red-500":i}),Ge=(a,e)=>e.key;function qe(a,e){a&1&&w(0,"mat-progress-bar",25)}function Ae(a,e){if(a&1&&(r(0,"div",26)(1,"span",27),d(2,"L\u1ED7i:"),o(),d(3),o()),a&2){let t=s();m(3),x(" ",t.error()," ")}}function $e(a,e){if(a&1){let t=M();r(0,"button",42),f("click",function(i){let l=h(t).$implicit;return s(2).toggleColumn(l),g(i.stopPropagation())}),r(1,"mat-icon"),d(2),o(),r(3,"span"),d(4),o()()}if(a&2){let t=e.$implicit;m(2),T(t.isShow?"check_box":"check_box_outline_blank"),m(2),T(t.value)}}function Ne(a,e){a&1&&(r(0,"span",43),d(1,"(\u0110ang t\u1EA3i...)"),o())}function Oe(a,e){if(a&1){let t=M();r(0,"div",28)(1,"div",29)(2,"button",30)(3,"mat-icon"),d(4,"tune"),o()(),r(5,"mat-menu",null,3)(7,"div",31)(8,"mat-form-field",32)(9,"input",33),f("input",function(i){h(t);let l=s();return g(l.doFilterColumns(i))})("click",function(i){return h(t),g(i.stopPropagation())}),o(),r(10,"mat-icon",34),d(11,"search"),o()()(),r(12,"div",35),R(13,$e,5,2,"button",36,Ge),o()(),r(15,"button",37),f("click",function(){h(t);let i=s();return g(i.isSearch=!i.isSearch)}),r(16,"mat-icon"),d(17,"search"),o()(),r(18,"button",38),f("click",function(){h(t);let i=s();return g(i.exportVandonToExcel())}),r(19,"mat-icon"),d(20,"file_download"),o()(),r(21,"input",39,4),f("change",function(i){h(t);let l=s();return g(l.ImporExcel(i))}),o(),r(23,"span",40),d(24),v(25,Ne,2,0,"span",41),o()()()}if(a&2){let t=F(6),n=s();m(2),u("matMenuTriggerFor",t),m(11),Q(n.FilterColumns),m(5),u("disabled",n.loading()),m(6),x(" ",n.CountItem," \u0110\u01A1n H\xE0ng "),m(),u("ngIf",n.loading())}}function ze(a,e){if(a&1){let t=M();r(0,"div",44)(1,"mat-form-field",32)(2,"mat-label"),d(3,"T\xECm Ki\u1EBFm"),o(),r(4,"input",45),f("keyup",function(i){h(t);let l=s();return g(l.applyFilter(i))}),o()(),r(5,"button",46),f("click",function(){h(t);let i=s();return g(i.isSearch=!i.isSearch)}),r(6,"mat-icon"),d(7,"cancel"),o()()()}}function He(a,e){a&1&&(r(0,"div",47)(1,"div",48),w(2,"mat-spinner",49),r(3,"p",50),d(4,"\u0110ang t\u1EA3i d\u1EEF li\u1EC7u..."),o()()())}function Ke(a,e){a&1&&(r(0,"span",70),d(1,"check"),o())}function Re(a,e){if(a&1&&(r(0,"span"),d(1),k(2,"date"),o()),a&2){let t=s().$implicit,n=s(2).$implicit;m(),T(D(2,1,t[n],"dd/MM/yyyy"))}}function Qe(a,e){if(a&1&&(r(0,"span"),d(1),k(2,"number"),o()),a&2){let t=s().$implicit,n=s(2).$implicit;m(),T(D(2,1,t[n],"1.0-2"))}}function je(a,e){if(a&1&&(r(0,"span"),d(1),k(2,"number"),o()),a&2){let t=s().$implicit,n=s(2).$implicit;m(),T(D(2,1,t[n],"1.0-2"))}}function Je(a,e){if(a&1&&(r(0,"span"),d(1),k(2,"number"),o()),a&2){let t=s().$implicit,n=s(2).$implicit;m(),T(D(2,1,t[n],"1.0-2"))}}function We(a,e){if(a&1&&(r(0,"span"),d(1),o()),a&2){let t=s().$implicit,n=s(2).$implicit,i=s();m(),T(i.Trangthaidon[t[n]]||t[n])}}function Xe(a,e){if(a&1&&(r(0,"span"),d(1),o()),a&2){let t=s().$implicit,n=s(2).$implicit;m(),x(" ",t[n]||"Tr\u1ED1ng","")}}function Ze(a,e){if(a&1){let t=M();r(0,"div",68),f("click",function(){let i=h(t).$implicit,l=s(2).$implicit,p=s();return g(p.ChosenItem(i,l))}),v(1,Ke,2,0,"span",69)(2,Re,3,4,"span")(3,Qe,3,4,"span")(4,je,3,4,"span")(5,Je,3,4,"span")(6,We,2,1,"span")(7,Xe,2,1,"span"),o()}if(a&2){let t,n=e.$implicit,i=s(2).$implicit,l=s();m(),u("ngIf",l.CheckItem(n)),m(),P((t=i)==="ngaygiao"?2:t==="sldat"?3:t==="slgiao"?4:t==="slnhan"?5:t==="status"?6:7)}}function Ue(a,e){if(a&1){let t=M();r(0,"th",53)(1,"span",54),d(2),o(),r(3,"span",55,5),d(5," filter_alt "),o(),r(6,"mat-menu",null,3)(8,"div",56),f("click",function(i){return h(t),g(i.stopPropagation())}),r(9,"div",57)(10,"input",58),f("keyup",function(i){h(t);let l=s().$implicit,p=s();return g(p.doFilterHederColumn(i,l))}),o(),r(11,"div",59)(12,"span",60),d(13,"search"),o()()(),r(14,"div",61)(15,"div",29)(16,"span",62),f("click",function(){h(t);let i=s().$implicit,l=s();return g(l.ChosenAll(l.FilterHederColumn(l.dataSource().filteredData,i)))}),d(17),o(),r(18,"span",62),f("click",function(){h(t);let i=s(2);return g(i.EmptyFiter())}),d(19,"Xo\xE1"),o()(),r(20,"span",62),f("click",function(){h(t);let i=s(2);return g(i.ResetFilter())}),d(21,"Reset"),o()(),r(22,"div",63),v(23,Ze,8,2,"div",64),o(),r(24,"div",65)(25,"button",66),f("click",function(){h(t);let i=F(4);return g(i.closeMenu())}),d(26,"\u0110\xF3ng"),o(),r(27,"button",67),f("click",function(){h(t);let i=F(4),l=s(2);return g(l.ApplyFilterColum(i))}),d(28,"\xC1p D\u1EE5ng"),o()()()()()}if(a&2){let t=F(7),n=s().$implicit,i=s();m(2),x(" ",i.ColumnName[n]," "),m(),u("matMenuTriggerFor",t),m(14),x("Ch\u1ECDn T\u1EA5t C\u1EA3 ",i.FilterHederColumn(i.dataSource().filteredData,n).length||0,""),m(6),u("ngForOf",i.FilterHederColumn(i.dataSource().filteredData,n))("ngForTrackBy",i.trackByFn)}}function Ye(a,e){if(a&1&&(r(0,"span",72),d(1),o()),a&2){let t=s().index;m(),x(" ",t+1," ")}}function tn(a,e){if(a&1&&(r(0,"span",72),d(1),k(2,"date"),o()),a&2){let t=s().$implicit,n=s().$implicit;m(),x(" ",D(2,1,t[n],"dd/MM/yyyy")," ")}}function en(a,e){if(a&1&&(r(0,"span",73),d(1),o()),a&2){let t=s().$implicit,n=s().$implicit,i=s();u("ngClass",ct(2,Be,t[n]==="dadat",t[n]==="dagiao",t[n]==="danhan",t[n]==="hoanthanh",t[n]==="huy")),m(),x(" ",i.Trangthaidon[t[n]]," ")}}function nn(a,e){if(a&1&&(r(0,"span",74),d(1),k(2,"number"),o()),a&2){let t=s().$implicit,n=s().$implicit;m(),x(" ",D(2,1,t[n],"1.0-2")," ")}}function an(a,e){if(a&1&&(r(0,"span",75),d(1),k(2,"number"),o()),a&2){let t=s().$implicit,n=s().$implicit;m(),x(" ",D(2,1,t[n],"1.0-2")," ")}}function rn(a,e){if(a&1&&(r(0,"span",76),d(1),k(2,"number"),o()),a&2){let t=s().$implicit,n=s().$implicit;m(),x(" ",D(2,1,t[n],"1.0-2")," ")}}function on(a,e){if(a&1&&(r(0,"span",72),d(1),o()),a&2){let t=s().$implicit,n=s().$implicit;m(),x(" ",t[n]," ")}}function sn(a,e){if(a&1&&(r(0,"td",71),v(1,Ye,2,1,"span",72)(2,tn,3,4,"span",72)(3,en,2,8,"span",73)(4,nn,3,4,"span",74)(5,an,3,4,"span",75)(6,rn,3,4,"span",76)(7,on,2,1,"span",72),o()),a&2){let t,n=s().$implicit;m(),P((t=n)==="STT"?1:t==="ngaygiao"?2:t==="status"?3:t==="sldat"?4:t==="slgiao"?5:t==="slnhan"?6:7)}}function ln(a,e){if(a&1&&(ot(0,20),v(1,Ue,29,5,"th",51)(2,sn,8,1,"td",52),st()),a&2){let t=e.$implicit;u("matColumnDef",t)}}function cn(a,e){a&1&&w(0,"tr",77)}function mn(a,e){if(a&1&&w(0,"tr",78),a&2){let t=e.$implicit,n=s();at("hover:bg-slate-100 ",n.donhangId()==t.id?"!bg-slate-200":"",""),it("data-id",t.id)}}function dn(a,e){a&1&&(r(0,"div",81),w(1,"mat-spinner",82),r(2,"p",83),d(3,"\u0110ang t\u1EA3i d\u1EEF li\u1EC7u..."),o()())}function pn(a,e){a&1&&d(0," Kh\xF4ng t\xECm th\u1EA5y ")}function un(a,e){if(a&1&&(r(0,"tr",79)(1,"td",80),v(2,dn,4,0,"div",81)(3,pn,1,0),o()()),a&2){let t=s();m(2),P(t.loading()?2:3)}}var L=class L{Detail={};displayedColumns=["madonhang","khachhang","title","dvt","sldat","slgiao","slnhan","ngaygiao","status"];ColumnName={madonhang:"M\xE3 \u0110\u01A1n H\xE0ng",khachhang:"Kh\xE1ch H\xE0ng",diachi:"\u0110\u1ECBa Ch\u1EC9",sdt:"S\u1ED1 \u0110i\u1EC7n Tho\u1EA1i",status:"Tr\u1EA1ng Th\xE1i",masp:"M\xE3 S\u1EA3n Ph\u1EA9m",title:"T\xEAn S\u1EA3n Ph\u1EA9m",giagoc:"Gi\xE1 G\u1ED1c",giaban:"Gi\xE1 B\xE1n",dvt:"\u0110\u01A1n V\u1ECB T\xEDnh",sldat:"SL \u0110\u1EB7t",slgiao:"SL Giao",slnhan:"SL Nh\u1EADn",slhuy:"SL H\u1EE7y",ttdat:"TT \u0110\u1EB7t",ttgiao:"TT Giao",ttnhan:"TT Nh\u1EADn",ttsauvat:"TT Sau VAT",vat:"VAT (%)",order:"Th\u1EE9 T\u1EF1",ghichu:"Ghi Ch\xFA",ngaygiao:"Ng\xE0y Giao"};FilterColumns=JSON.parse(localStorage.getItem("VandonColFilter")||"[]");Columns=[];Trangthaidon=be;isFilter=!1;paginator;sort;drawer;filterValues={};_DonhangGraphqlService=y(H);_DonhangService=y(z);_breakpointObserver=y(yt);_GoogleSheetService=y(ke);_router=y(A);_snackBar=y($);dataSource=mt(()=>{let e=new Ce(this.Listvandon);return e.filterPredicate=this.createFilter(),this.sort&&(e.sort=this.sort),e});donhangId=this._DonhangGraphqlService.donhangId;loading=this._DonhangGraphqlService.loading;error=this._DonhangGraphqlService.error;CountItem=0;SearchParams={Batdau:(0,U.default)().toDate(),Ketthuc:(0,U.default)().toDate(),pageSize:9999};ListDate=[{id:1,Title:"1 Ng\xE0y",value:"day"},{id:2,Title:"1 Tu\u1EA7n",value:"week"},{id:3,Title:"1 Th\xE1ng",value:"month"},{id:4,Title:"1 N\u0103m",value:"year"}];Chonthoigian="day";isSearch=!1;constructor(){this.displayedColumns.forEach(e=>{this.filterValues[e]=""})}get Listvandon(){return this._DonhangGraphqlService.ListVandon()}onSelectionChange(e){this.ngOnInit()}onDateChange(e){this.ngOnInit()}createFilter(){return(e,t)=>{let n=JSON.parse(t),i=!0;return this.displayedColumns.forEach(l=>{if(n[l]){let p=e[l]?e[l].toString().toLowerCase():"";i=i&&p.includes(n[l].toLowerCase())}}),i}}applyFilter(e){let t=e.target.value;this.dataSource().filter=t.trim().toLowerCase(),this.dataSource().paginator&&this.dataSource()?.paginator?.firstPage()}ngOnInit(){return _(this,null,function*(){try{this.initializeColumns(),this.setupDrawer(),setTimeout(()=>_(this,null,function*(){yield this._DonhangGraphqlService.searchDonhang(this.SearchParams),yield this._DonhangService.Phieuchuyen(this.SearchParams),this.CountItem=this._DonhangGraphqlService.ListDonhang().length,requestAnimationFrame(()=>{let e=this.dataSource();e.data=this.Listvandon,e.paginator=this.paginator,this.paginator._intl.itemsPerPageLabel="S\u1ED1 l\u01B0\u1EE3ng 1 trang",this.paginator._intl.nextPageLabel="Ti\u1EBFp Theo",this.paginator._intl.previousPageLabel="V\u1EC1 Tr\u01B0\u1EDBc",this.paginator._intl.firstPageLabel="Trang \u0110\u1EA7u",this.paginator._intl.lastPageLabel="Trang Cu\u1ED1i"})}),0)}catch(e){console.error("L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u:",e)}})}refresh(){return _(this,null,function*(){yield this._DonhangGraphqlService.searchDonhang(this.SearchParams),yield this._DonhangService.Phieuchuyen(this.SearchParams)})}initializeColumns(){let e=["madonhang","khachhang","title","dvt","sldat","slgiao","slnhan","ngaygiao","status"];this.Columns=e.map(t=>({key:t,value:this.ColumnName[t],isShow:this.displayedColumns.includes(t)})),this.FilterColumns.length===0?this.FilterColumns=this.Columns:(this.FilterColumns=this.FilterColumns.filter(t=>e.includes(t.key)),localStorage.setItem("VandonColFilter",JSON.stringify(this.FilterColumns))),this.displayedColumns=this.FilterColumns.filter(t=>t.isShow).map(t=>t.key),this.ColumnName=this.FilterColumns.reduce((t,n)=>(n.isShow&&(t[n.key]=n.value),t),{})}setupDrawer(){this._breakpointObserver.observe([xt.Handset]).subscribe(e=>{e.matches?(this.drawer.mode="over",this.paginator.hidePageSize=!0):this.drawer.mode="side"})}toggleColumn(e){let t=this.FilterColumns.find(n=>n.key===e.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("VandonColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(n=>n.value.toLowerCase().includes(t))}LoadDrive(){return _(this,null,function*(){let e={IdSheet:"15npo25qyH5FmfcEjl1uyqqyFMS_vdFnmxM_kt0KYmZk",SheetName:"SPImport",ApiKey:"AIzaSyD33kgZJKdFpv1JrKHacjCQccL_O0a2Eao"},t=yield this._GoogleSheetService.getDrive(e),n=Rt(t.values);console.log(n),this.DoImportData(n)})}DoImportData(e){console.log(e);let n=e.map(c=>({title:c.title?.trim()||"",masp:c.masp?.trim()||"",slug:`${Qt(c?.title?.trim()||"")}_${jt(5,!1)}`,giagoc:Number(c.giagoc)||0,dvt:c.dvt||"",soluong:Number(c.soluong)||0,soluongkho:Number(c.soluongkho)||0,ghichu:c.ghichu||"",order:Number(c.order)||0})).filter((c,C,E)=>C===E.findIndex(Fe=>Fe.masp===c.masp)),i=n.map(c=>c.masp),l=this._DonhangGraphqlService.ListDonhang().map(c=>c.masp),p=i.filter(c=>!l.includes(c)),b=n.map(c=>_(this,null,function*(){let C=this._DonhangGraphqlService.ListDonhang().find(E=>E.masp===c.masp);if(C){let E=V(V({},C),c);yield this._DonhangGraphqlService.updateDonhang(E)}else yield this._DonhangGraphqlService.CreateDonhang(c)})),Y=p.map(c=>_(this,null,function*(){let C=this._DonhangGraphqlService.ListDonhang().find(E=>E.masp===c);C&&(C.isActive=!1,yield this._DonhangGraphqlService.updateDonhang(C))}));Promise.all([...b,...Y]).then(()=>{this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ImporExcel(e){return _(this,null,function*(){let t=yield we(e);this.DoImportData(t)})}ExportExcel(e,t){ve(e,t)}exportVandonToExcel(){return _(this,null,function*(){yield this._DonhangGraphqlService.exportVandonToExcel(this.dataSource().filteredData||this.Listvandon)})}exportAllToExcel(){return _(this,null,function*(){yield this._DonhangGraphqlService.exportVandonToExcel()})}FilterHederColumn(e,t){return!e||e.length===0?[]:e.filter((i,l,p)=>l===p.findIndex(b=>b[t]===i[t])).slice(0,100)}doFilterHederColumn(e,t){if(!this.Listvandon||this.Listvandon.length===0)return;let n=e.target.value.toLowerCase();n.length<2&&n.length>0||requestAnimationFrame(()=>{this.dataSource().filteredData=this.Listvandon.filter(i=>Jt(i[t]||"").toLowerCase().includes(n)||(i[t]||"").toString().toLowerCase().includes(n))})}trackByFn(e,t){return t.id}ListFilter=[];ChosenItem(e,t){if(!this.dataSource().filteredData)return;let n=this.dataSource().filteredData.filter(l=>l[t]===e[t]);this.ListFilter.filter(l=>l[t]===e[t]).length>0?this.ListFilter=this.ListFilter.filter(l=>l[t]!==e[t]):this.ListFilter=[...this.ListFilter,...n]}ChosenAll(e){e&&e.forEach(t=>{!!this.ListFilter.find(i=>i.id===t.id)?this.ListFilter=this.ListFilter.filter(i=>i.id!==t.id):this.ListFilter.push(t)})}ResetFilter(){this.ListFilter=this.Listvandon||[],this.dataSource().data=this.Listvandon||[],this.dataSource().sort=this.sort}EmptyFiter(){this.ListFilter=[]}CheckItem(e){return!!this.ListFilter.find(t=>t.id===e.id)}ApplyFilterColum(e){this.ListFilter.length===0?this.dataSource().data=[]:this.dataSource().data=this.Listvandon.filter(t=>this.ListFilter.some(n=>n.id===t.id)),this.dataSource().sort=this.sort,e.closeMenu()}static \u0275fac=function(t){return new(t||L)};static \u0275cmp=nt({type:L,selectors:[["app-vandon"]],viewQuery:function(t,n){if(t&1&&(B(N,5),B(O,5),B(Ie,7)),t&2){let i;G(i=q())&&(n.paginator=i.first),G(i=q())&&(n.sort=i.first),G(i=q())&&(n.drawer=i.first)}},decls:33,vars:27,consts:[["drawer",""],["pickerBatdau",""],["pickerKetthuc",""],["menu","matMenu"],["uploadfile",""],["menuTrigger","matMenuTrigger"],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-12","w-full","p-2"],["mode","indeterminate","color","primary",4,"ngIf"],["class","bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",4,"ngIf"],["class","cursor-pointer w-full relative flex lg:flex-row lg:space-y-2 space-y-0 flex-col space-x-2 justify-between items-center p-2 bg-white rounded-lg",4,"ngIf"],["class","py-2 w-full flex flex-row space-x-2 items-center",4,"ngIf"],[1,"w-full","grid","lg:grid-cols-4","grid-cols-2","gap-2","items-center"],[3,"appearance","subscriptSizing"],["matInput","",3,"dateChange","ngModelChange","matDatepicker","ngModel","ngModelOptions"],["matIconSuffix","",3,"for"],[1,"w-full","overflow-auto","relative"],["class","absolute inset-0 bg-white bg-opacity-75 z-10 flex items-center justify-center",4,"ngIf"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"class",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSizeOptions","pageSize"],["mode","indeterminate","color","primary"],[1,"bg-red-100","border","border-red-400","text-red-700","px-4","py-3","rounded","mb-4"],[1,"font-bold"],[1,"cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","p-2","bg-white","rounded-lg"],[1,"flex","flex-row","space-x-2","items-center"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["matTooltip","T\xECm Ki\u1EBFm","color","primary","mat-icon-button","",3,"click"],["matTooltip","Xu\u1EA5t Excel (2 sheet: V\u1EADn \u0111\u01A1n + Phi\u1EBFu chuy\u1EC3n)","mat-icon-button","","color","accent",3,"click","disabled"],["type","file",1,"hidden",3,"change"],[1,"lg:flex","hidden","whitespace-nowrap","p-2","rounded-lg","bg-slate-200"],["class","ml-2 animate-pulse text-blue-600",4,"ngIf"],["mat-menu-item","",3,"click"],[1,"ml-2","animate-pulse","text-blue-600"],[1,"py-2","w-full","flex","flex-row","space-x-2","items-center"],["matInput","","placeholder","Vui l\xF2ng T\xECm Ki\u1EBFm",3,"keyup"],["mat-icon-button","","color","warn",3,"click"],[1,"absolute","inset-0","bg-white","bg-opacity-75","z-10","flex","items-center","justify-center"],[1,"text-center"],["diameter","40"],[1,"mt-2","text-gray-600"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"max-w-40","line-clamp-4","me-4"],[1,"z-10","material-symbols-outlined","text-gray-500",3,"matMenuTriggerFor"],[1,"cursor-pointer","flex","flex-col","space-y-4","p-3",3,"click"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[1,"flex","flex-row","space-x-2","items-center","justify-between"],[1,"text-xs","text-blue-600","underline",3,"click"],[1,"w-full","flex","flex-col","space-y-2","max-h-44","overflow-auto"],["class","flex flex-row space-x-2 items-center p-2 rounded-lg hover:bg-slate-100",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-row","space-x-2","items-end","justify-end"],["mat-flat-button","","color","warn",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"flex","flex-row","space-x-2","items-center","p-2","rounded-lg","hover:bg-slate-100",3,"click"],["class","material-symbols-outlined text-blue-600",4,"ngIf"],[1,"material-symbols-outlined","text-blue-600"],["mat-cell",""],[1,"max-w-40","line-clamp-4"],[1,"max-w-40","line-clamp-4","font-bold",3,"ngClass"],[1,"max-w-40","line-clamp-4","text-right","text-blue-600"],[1,"max-w-40","line-clamp-4","text-right","text-orange-600"],[1,"max-w-40","line-clamp-4","text-right","text-green-600"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell","p-4"],[1,"text-center","py-4"],["diameter","30"],[1,"mt-2"]],template:function(t,n){if(t&1){let i=M();r(0,"mat-drawer-container",6)(1,"mat-drawer",7,0),w(3,"router-outlet"),o(),r(4,"div",8),v(5,qe,1,0,"mat-progress-bar",9)(6,Ae,4,1,"div",10)(7,Oe,26,4,"div",11)(8,ze,8,0,"div",12),r(9,"div",13)(10,"mat-form-field",14)(11,"mat-label"),d(12,"B\u1EAFt \u0110\u1EA7u"),o(),r(13,"input",15),f("dateChange",function(p){return h(i),g(n.onDateChange(p))}),W("ngModelChange",function(p){return h(i),J(n.SearchParams.Batdau,p)||(n.SearchParams.Batdau=p),g(p)}),o(),w(14,"mat-datepicker-toggle",16)(15,"mat-datepicker",null,1),o(),r(17,"mat-form-field",14)(18,"mat-label"),d(19,"K\u1EBFt Th\xFAc"),o(),r(20,"input",15),f("dateChange",function(p){return h(i),g(n.onDateChange(p))}),W("ngModelChange",function(p){return h(i),J(n.SearchParams.Ketthuc,p)||(n.SearchParams.Ketthuc=p),g(p)}),o(),w(21,"mat-datepicker-toggle",16)(22,"mat-datepicker",null,2),o()(),r(24,"div",17),v(25,He,5,0,"div",18),r(26,"table",19),R(27,ln,3,1,"ng-container",20,rt),v(29,cn,1,0,"tr",21)(30,mn,1,4,"tr",22)(31,un,4,1,"tr",23),o()(),w(32,"mat-paginator",24),o()()}if(t&2){let i=F(16),l=F(23);m(),u("position","end"),m(4),u("ngIf",n.loading()),m(),u("ngIf",n.error()),m(),u("ngIf",!n.isSearch),m(),u("ngIf",n.isSearch),m(2),u("appearance","outline")("subscriptSizing","dynamic"),m(3),u("matDatepicker",i),j("ngModel",n.SearchParams.Batdau),u("ngModelOptions",X(23,Ve)),m(),u("for",i),m(3),u("appearance","outline")("subscriptSizing","dynamic"),m(3),u("matDatepicker",l),j("ngModel",n.SearchParams.Ketthuc),u("ngModelOptions",X(24,Ve)),m(),u("for",l),m(4),u("ngIf",n.loading()),m(),u("dataSource",n.dataSource()),m(),Q(n.displayedColumns),m(2),u("matHeaderRowDef",n.displayedColumns),m(),u("matRowDefColumns",n.displayedColumns),m(2),u("pageSizeOptions",lt(25,Pe,n.dataSource().data.length))("pageSize",50)}},dependencies:[Ot,Nt,qt,At,$t,Ht,zt,xe,le,me,he,de,ce,ge,pe,ue,_e,fe,ye,se,O,oe,re,N,Lt,Mt,Vt,Ft,bt,kt,Dt,ft,Et,Tt,vt,Ct,St,Kt,_t,dt,pt,ut,gt,ht,Gt,It,Pt,Bt,ae,ie,Yt,Xt,Zt,Ut,ee,te,Ee,Te],encapsulation:2,changeDetection:0})};K([hn()],L.prototype,"FilterHederColumn",1),K([gn(500)],L.prototype,"doFilterHederColumn",1);var Me=L;function hn(){return function(a,e,t){let n=t.value,i=new Map;return t.value=function(...l){let p=JSON.stringify(l);if(i.has(p))return i.get(p);let b=n.apply(this,l);return i.set(p,b),b},t}}function gn(a=300){return function(e,t,n){let i=n.value,l;return n.value=function(...p){clearTimeout(l),l=setTimeout(()=>{i.apply(this,p)},a)},n}}export{Me as VandonComponent};
