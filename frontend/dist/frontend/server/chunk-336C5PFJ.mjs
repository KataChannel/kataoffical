import './polyfills.server.mjs';
import{a as u}from"./chunk-KB6T2C2W.mjs";import{a as Ut}from"./chunk-5IGIVQ3I.mjs";import{a as jt}from"./chunk-XZAGACZI.mjs";import{a as zt}from"./chunk-WD3BN2ZL.mjs";import{a as qt}from"./chunk-V3LFXOYE.mjs";import{a as Jt}from"./chunk-UIQJJCWC.mjs";import{a as Qt}from"./chunk-MUK7T4EV.mjs";import"./chunk-AICHI2NV.mjs";import"./chunk-73IBRO6I.mjs";import{a as At,b as Kt}from"./chunk-PDYHWB5Z.mjs";import{k as Ot}from"./chunk-4PSVCY4Y.mjs";import{a as $,b as Ft}from"./chunk-A56U74X5.mjs";import{a as P,b as vt,c as Tt}from"./chunk-2FLLKDTQ.mjs";import{a as Dt,b as wt,c as Mt,d as kt,e as bt,g as Et,h as Lt,j as It,k as Xt,m as $t,n as Pt,p as Yt,q as Bt,r as Vt,s as Rt}from"./chunk-7OL3A46M.mjs";import{c as ut,h as dt}from"./chunk-SQLON2R6.mjs";import{a as xt}from"./chunk-26NM6QMQ.mjs";import{a as it,b as at,c as ot}from"./chunk-FEYBIC4G.mjs";import{a as lt,b as ht,c as ct,d as pt}from"./chunk-ELAJKLT3.mjs";import{b as Ct}from"./chunk-5J65EW3V.mjs";import{n as mt,r as gt,v as _t,w as ft,y as St,z as yt}from"./chunk-GA3UYBFM.mjs";import"./chunk-J6642ETB.mjs";import{a as rt,b as st}from"./chunk-PK3DRSOU.mjs";import"./chunk-6EFOJMAD.mjs";import"./chunk-3FIPRBVQ.mjs";import{a as nt}from"./chunk-K3B42B6X.mjs";import"./chunk-B7K4I7M3.mjs";import"./chunk-FFMPUL32.mjs";import{a as Z,c as tt,e as et}from"./chunk-4I2U3JAI.mjs";import{y as W,z as G}from"./chunk-EDQTS3NM.mjs";import"./chunk-7T6LZHUD.mjs";import{b as U}from"./chunk-BAXOD54Y.mjs";import"./chunk-TSEEXHZ6.mjs";import{n as z,o as q,t as Q,v as j,x as J}from"./chunk-GTWDOMLN.mjs";import{Bc as L,Cc as I,Dc as X,Fb as H,Gc as b,Hc as p,Ic as E,Jc as d,Ka as R,Mb as w,Qc as K,Wc as C,Yb as y,Yc as x,dc as v,fc as N,gc as B,hc as V,ic as s,jc as l,kc as M,lc as O,mc as A,oc as k,pa as D,tb as c,tc as S,vc as r,ya as _,za as f}from"./chunk-KYBR54ZN.mjs";import"./chunk-XAZRL6IZ.mjs";import{d as Ht,i as Nt}from"./chunk-CX6TF4UI.mjs";import"./chunk-MGIVCIKU.mjs";import{h as Y,j as F}from"./chunk-RIAI3ORJ.mjs";var Gt=["drawer"],Zt=()=>[10,25,100],te=(o,e)=>e.key;function ee(o,e){if(o&1){let t=k();s(0,"button",25),S("click",function(i){let a=_(t).$implicit;return r().toggleColumn(a),f(i.stopPropagation())}),s(1,"mat-icon"),p(2),l(),s(3,"span"),p(4),l()()}if(o&2){let t=e.$implicit;c(2),E(t.isShow?"check_box":"check_box_outline_blank"),c(2),E(t.value)}}function ne(o,e){o&1&&(s(0,"span",42),p(1,"check"),l())}function ie(o,e){if(o&1&&(s(0,"span"),p(1),C(2,"date"),l()),o&2){let t=r().$implicit,n=r(2).$implicit;c(),E(x(2,1,t[n],"dd/MM/yyyy"))}}function ae(o,e){if(o&1&&(s(0,"span"),p(1),C(2,"date"),l()),o&2){let t=r().$implicit,n=r(2).$implicit;c(),E(x(2,1,t[n],"dd/MM/yyyy"))}}function oe(o,e){if(o&1&&(s(0,"span"),p(1),l()),o&2){let t=r().$implicit,n=r(2).$implicit;c(),d("",t[n],"%")}}function re(o,e){if(o&1&&(s(0,"span"),p(1),l()),o&2){let t=r().$implicit,n=r(2).$implicit;c(),d(" ",t[n]||"Tr\u1ED1ng","")}}function se(o,e){if(o&1){let t=k();s(0,"div",40),S("click",function(){let i=_(t).$implicit,a=r(2).$implicit,h=r();return f(h.ChosenItem(i,a))}),w(1,ne,2,0,"span",41)(2,ie,3,4,"span")(3,ae,3,4,"span")(4,oe,2,1,"span")(5,re,2,1,"span"),l()}if(o&2){let t,n=e.$implicit,i=r(2).$implicit,a=r();c(),y("ngIf",a.CheckItem(n)),c(),v((t=i)==="createdAt"?2:t==="updatedAt"?3:t==="haohut"?4:5)}}function le(o,e){if(o&1){let t=k();s(0,"th",28)(1,"span",29),p(2),l(),s(3,"span",30,2),p(5," filter_alt "),l(),s(6,"mat-menu",null,1)(8,"div",31),S("click",function(i){return _(t),f(i.stopPropagation())}),s(9,"div",32)(10,"input",8),S("keyup",function(i){_(t);let a=r().$implicit,h=r();return f(h.doFilterHederColumn(i,a))}),l(),s(11,"div",9)(12,"span",10),p(13,"search"),l()()(),s(14,"div",33)(15,"div",6)(16,"span",34),S("click",function(){_(t);let i=r().$implicit,a=r();return f(a.ChosenAll(a.FilterHederColumn(a.dataSource.filteredData,i)))}),p(17),l(),s(18,"span",34),S("click",function(){_(t);let i=r(2);return f(i.EmptyFiter())}),p(19,"Xo\xE1"),l()(),s(20,"span",34),S("click",function(){_(t);let i=r(2);return f(i.ResetFilter())}),p(21,"Reset"),l()(),s(22,"div",35),w(23,se,6,2,"div",36),l(),s(24,"div",37)(25,"button",38),S("click",function(){_(t);let i=b(4);return f(i.closeMenu())}),p(26,"\u0110\xF3ng"),l(),s(27,"button",39),S("click",function(){_(t);let i=b(4),a=r(2);return f(a.ApplyFilterColum(i))}),p(28,"\xC1p D\u1EE5ng"),l()()()()()}if(o&2){let t=b(7),n=r().$implicit,i=r();c(2),d(" ",i.ColumnName[n]," "),c(),y("matMenuTriggerFor",t),c(14),d("Ch\u1ECDn T\u1EA5t C\u1EA3 ",i.FilterHederColumn(i.dataSource.filteredData,n).length||0,""),c(6),y("ngForOf",i.FilterHederColumn(i.dataSource.filteredData,n))("ngForTrackBy",i.trackByFn)}}function he(o,e){if(o&1&&(s(0,"span",44),p(1),l()),o&2){let t=r().index;c(),d(" ",t+1," ")}}function ce(o,e){if(o&1&&(s(0,"span"),p(1),C(2,"number"),l()),o&2){let t=r(2).$implicit,n=r().$implicit;c(),d(" + ",x(2,1,t[n],"1.0-2")," ")}}function pe(o,e){if(o&1&&(p(0),C(1,"number")),o&2){let t=r(2).$implicit,n=r().$implicit;d(" ",x(1,1,t[n],"1.0-2")," ")}}function me(o,e){if(o&1&&(s(0,"span",45)(1,"span",48),w(2,ce,3,4,"span")(3,pe,2,4),s(4,"span",49),p(5),C(6,"number"),l()()()),o&2){let t=r().$implicit,n=r().$implicit;c(2),v(t[n]>0?2:3),c(3),d("(",x(6,2,t==null?null:t.slchonhaptt,"1.0-2"),")")}}function ue(o,e){if(o&1&&(s(0,"span"),p(1),C(2,"number"),l()),o&2){let t=r(2).$implicit,n=r().$implicit;c(),d("",x(2,1,t[n],"1.0-2")," ")}}function de(o,e){if(o&1&&(p(0),C(1,"number")),o&2){let t=r(2).$implicit,n=r().$implicit;d(" ",x(1,1,t[n],"1.0-2")," ")}}function ge(o,e){if(o&1&&(s(0,"span",46)(1,"span",48),w(2,ue,3,4,"span")(3,de,2,4),s(4,"span",49),p(5),C(6,"number"),l()()()),o&2){let t=r().$implicit,n=r().$implicit;c(2),v(t[n]>0?2:3),c(3),d("(",x(6,2,t==null?null:t.slchogiaott,"1.0-2"),")")}}function _e(o,e){if(o&1&&(s(0,"span",47),p(1),C(2,"date"),l()),o&2){let t=r().$implicit,n=r().$implicit;c(),d(" ",x(2,1,t[n],"HH:mm:ss dd/MM/yyyy")," ")}}function fe(o,e){o&1&&(s(0,"mat-icon",50),p(1,"check_circle"),l())}function Se(o,e){o&1&&(s(0,"mat-icon",51),p(1,"cancel"),l())}function ye(o,e){if(o&1&&(s(0,"span",44),w(1,fe,2,0,"mat-icon",50)(2,Se,2,0,"mat-icon",51),l()),o&2){let t=r().$implicit,n=r().$implicit;c(),v(t[n]?1:2)}}function Ce(o,e){if(o&1&&(s(0,"span",47),p(1),C(2,"date"),l()),o&2){let t=r().$implicit,n=r().$implicit;c(),d(" ",x(2,1,t[n],"HH:mm:ss dd/MM/yyyy")," ")}}function xe(o,e){if(o&1&&(s(0,"span",44),p(1),l()),o&2){let t=r().$implicit,n=r().$implicit;c(),d(" ",t[n]," ")}}function De(o,e){if(o&1&&(s(0,"td",43),w(1,he,2,1,"span",44)(2,me,7,5,"span",45)(3,ge,7,5,"span",46)(4,_e,3,4,"span",47)(5,ye,3,1,"span",44)(6,Ce,3,4,"span",47)(7,xe,2,1,"span",44),l()),o&2){let t,n=r().$implicit;c(),v((t=n)==="STT"?1:t==="slchonhap"?2:t==="slchogiao"?3:t==="ngaygiao"?4:t==="isActive"?5:t==="updatedAt"?6:7)}}function we(o,e){if(o&1&&(O(0,20),w(1,le,29,5,"th",26)(2,De,8,1,"td",27),A()),o&2){let t=e.$implicit;y("matColumnDef",t)}}function Fe(o,e){o&1&&M(0,"tr",52)}function ve(o,e){o&1&&M(0,"tr",53)}function Te(o,e){o&1&&(s(0,"tr",54)(1,"td",55),p(2,"Kh\xF4ng t\xECm th\u1EA5y"),l()())}var T=class T{DexuatEmit=new R;Detail={};displayedColumns=["title","masp","dvt","slton","sltontt","slhuy","chenhlech"];ColumnName={title:"T\xEAn s\u1EA3n ph\u1EA9m",masp:"M\xE3 s\u1EA3n ph\u1EA9m",dvt:"\u0110\u01A1n v\u1ECB t\xEDnh",slton:"SL t\u1ED3n",sltontt:"T\u1ED3n th\u1EF1c t\u1EBF Cu\u1ED1i Ng\xE0y",slhuy:"H\u1EE7y Cu\u1ED1i Ng\xE0y",chenhlech:"Ch\xEAnh l\u1EC7ch"};FilterColumns=JSON.parse(localStorage.getItem("TonkhoColFilter")||"[]");Columns=[];isFilter=!1;paginator;sort;drawer;filterValues={};_PhieukhoService=D(jt);_SanphamService=D(Qt);_DathangService=D(zt);_DonhangService=D(qt);_KhoService=D(Jt);_breakpointObserver=D(W);Xuatnhapton=this._PhieukhoService.ListPhieukho;dataSource=new Rt([]);_snackBar=D(nt);CountItem=0;SearchParams={Batdau:u.format(u.now(),"YYYY-MM-DD"),Ketthuc:u.format(u.add(u.now(),1,"day"),"YYYY-MM-DD"),Type:"donsi"};ListDate=[{id:1,Title:"1 Ng\xE0y",value:"day"},{id:2,Title:"1 Tu\u1EA7n",value:"week"},{id:3,Title:"1 Th\xE1ng",value:"month"},{id:4,Title:"1 N\u0103m",value:"year"}];Chonthoigian="day";isSearch=!1;ListKho=[];constructor(){this.displayedColumns.forEach(e=>{this.filterValues[e]=""})}createFilter(){return(e,t)=>{let n=JSON.parse(t),i=!0;return this.displayedColumns.forEach(a=>{if(n[a]){let h=e[a]?e[a].toString().toLowerCase():"";i=i&&h.includes(n[a].toLowerCase())}}),i}}applyFilter(e){let t=e.target.value;this.dataSource.filter=t.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource?.paginator?.firstPage()}LoadDondathang(){return F(this,null,function*(){let e=yield this._DonhangService.getSLChogiao(this.SearchParams),t=yield this._DathangService.getSLChonhap(this.SearchParams);this.dataSource.data.forEach(n=>{let i=e.find(h=>h.idSP===n.sanphamId);i?n.slchogiaott=i.slchogiaott:n.slchogiaott=0;let a=t.find(h=>h.idSP===n.sanphamId);a?n.slchonhaptt=a.slchonhaptt:n.slchonhaptt=0}),this.dataSource.data=this.dataSource.data.filter(n=>n.slchogiaott>0||n.slchonhaptt>0),this.dataSource.sort=this.sort})}ngOnInit(){return F(this,null,function*(){yield this._SanphamService.getAllSanpham(),this._KhoService.getTonKho("1","1000").then(e=>{this.Xuatnhapton.set(e.data),this.dataSource.data=this.Xuatnhapton(),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.initializeColumns(),this.setupDrawer(),this.paginator._intl.itemsPerPageLabel="S\u1ED1 l\u01B0\u1EE3ng 1 trang",this.paginator._intl.nextPageLabel="Ti\u1EBFp Theo",this.paginator._intl.previousPageLabel="V\u1EC1 Tr\u01B0\u1EDBc",this.paginator._intl.firstPageLabel="Trang \u0110\u1EA7u",this.paginator._intl.lastPageLabel="Trang Cu\u1ED1i"}),this.CountItem=this.Xuatnhapton().length})}initializeColumns(){this.Columns=Object.keys(this.ColumnName).map(e=>({key:e,value:this.ColumnName[e],isShow:!0})),this.FilterColumns.length===0?this.FilterColumns=this.Columns:localStorage.setItem("TonkhoColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{})}setupDrawer(){this._breakpointObserver.observe([G.Handset]).subscribe(e=>{e.matches?(this.drawer.mode="over",this.paginator.hidePageSize=!0):this.drawer.mode="side"})}toggleColumn(e){let t=this.FilterColumns.find(n=>n.key===e.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("TonkhoColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(n=>n.value.toLowerCase().includes(t))}FilterHederColumn(e,t){return e.filter((i,a,h)=>a===h.findIndex(m=>m[t]===i[t]))}doFilterHederColumn(e,t){let n=e.target.value.toLowerCase();console.log(n),console.log(t),this.dataSource.filteredData=this.Xuatnhapton().filter(i=>xt(i[t]).includes(n)||i[t].toLowerCase().includes(n))}trackByFn(e,t){return t.id}ListFilter=[];ChosenItem(e,t){let n=this.dataSource.filteredData.filter(a=>a[t]===e[t]);this.ListFilter.filter(a=>a[t]===e[t]).length>0?this.ListFilter=this.ListFilter.filter(a=>a[t]!==e[t]):this.ListFilter=[...this.ListFilter,...n]}ChosenAll(e){e.forEach(t=>{!!this.ListFilter.find(i=>i.id===t.id)?this.ListFilter=this.ListFilter.filter(i=>i.id!==i.id):this.ListFilter.push(t)})}ResetFilter(){this.ListFilter=this.Xuatnhapton(),this.dataSource.data=this.Xuatnhapton(),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}EmptyFiter(){this.ListFilter=[]}CheckItem(e){return!!this.ListFilter.find(t=>t.id===e.id)}ApplyFilterColum(e){this.dataSource.data=this.Xuatnhapton().filter(t=>this.ListFilter.some(n=>n.id===t.id)),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,e.closeMenu()}ExportExcel(e,t){return F(this,null,function*(){yield this._SanphamService.getAllSanpham();let n=this._SanphamService.ListSanpham().map(a=>({subtitle:a.subtitle,masp:a.masp,title:a.title,dvt:a.dvt})),i=this.Xuatnhapton().map(a=>({masp:a.masp,title:a.title,dvt:a.dvt,slton:a.slton}));Ht({SP:n,XNT:i},t)})}ImporExcel(e){return F(this,null,function*(){let t=Array.from(e.target.files),n=yield Nt(t[0],"XNT"),i=[],a=[];n.forEach(h=>{let m=this.Xuatnhapton().find(g=>g.masp===h.masp);m&&(h.slton>m.slton?i.push({sanphamId:this._SanphamService.ListSanpham().find(g=>g.masp===h.masp).id,soluong:h.slton-m.slton}):h.slton<m.slton&&a.push({sanphamId:this._SanphamService.ListSanpham().find(g=>g.masp===h.masp).id,soluong:m.slton-h.slton}))}),i.length>0&&this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${u.format(u.now(),"DD/MM/YYYY ")}`,type:"nhap",sanpham:i,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${u.format(u.now(),"HH:mm:ss DD/MM/YYYY ")}`,ngay:u.now()}),a.length>0&&this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${u.format(u.now(),"DD/MM/YYYY ")}`,type:"xuat",sanpham:a,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${u.format(u.now(),"HH:mm:ss DD/MM/YYYY ")}`,ngay:u.now()}),i.length>0&&this._snackBar.open(`\u0110i\u1EC1u ch\u1EC9nh nh\u1EADp kho v\u1EDBi ${i.length} s\u1EA3n ph\u1EA9m`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),a.length>0&&this._snackBar.open(`\u0110i\u1EC1u ch\u1EC9nh xu\u1EA5t kho v\u1EDBi ${a.length} s\u1EA3n ph\u1EA9m`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),i.length===0&&a.length===0&&this._snackBar.open("Kho kh\xF4ng thay \u0111\u1ED5i","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}_dialog=D(ut);Trangthaidon=Ut;ListDathang=[];ListDonhang=[];FilteredDathang=[];FilteredDonhang=[];dathangSortField="";dathangSortDirection="asc";selectedDathangStatus="";donhangSortField="";donhangSortDirection="asc";selectedDonhangStatus="";dathangStartDate="";dathangEndDate="";donhangStartDate="";donhangEndDate="";dathangSearchTimeout;donhangSearchTimeout;Object=Object;XemDathang(e,t){return F(this,null,function*(){this.ListDathang=yield this._DathangService.findbysanpham(e.sanphamId),console.log(this.ListDathang),this.FilteredDathang=[...this.ListDathang],this.selectedDathangStatus="",this.dathangSortField="",this.dathangSortDirection="asc",this.dathangStartDate="",this.dathangEndDate="",this._dialog.open(t,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(i=>{})})}XemDonhang(e,t){return F(this,null,function*(){this.ListDonhang=yield this._DonhangService.findbysanpham(e.sanphamId),console.log(this.ListDonhang),this.FilteredDonhang=[...this.ListDonhang],this.selectedDonhangStatus="",this.donhangSortField="",this.donhangSortDirection="asc",this.donhangStartDate="",this.donhangEndDate="",this._dialog.open(t,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(i=>{})})}TinhTong(e,t){return e?.reduce((n,i)=>n+(Number(i?.sanpham[t])||0),0)||0}gotoDexuat(){this.DexuatEmit.emit(!1)}ngOnDestroy(){this.dathangSearchTimeout&&clearTimeout(this.dathangSearchTimeout),this.donhangSearchTimeout&&clearTimeout(this.donhangSearchTimeout)}filterDathangList(e){this.dathangSearchTimeout&&clearTimeout(this.dathangSearchTimeout),this.dathangSearchTimeout=setTimeout(()=>{let t=e.target.value?.toLowerCase()||"";this.applyDathangFilters(t)},300)}filterDathangByStatus(e){this.selectedDathangStatus=e;let n=document.querySelector("#dathangSearch")?.value?.toLowerCase()||"";this.applyDathangFilters(n)}clearDathangFilter(){this.selectedDathangStatus="",this.dathangStartDate="",this.dathangEndDate="",this.dathangSortField="",this.dathangSortDirection="asc",this.applyDathangFilters("")}applyDathangFilters(e){let t=[...this.ListDathang];this.selectedDathangStatus&&(t=t.filter(n=>n.status===this.selectedDathangStatus)),(this.dathangStartDate||this.dathangEndDate)&&(t=this.applyDateRangeFilter(t,this.dathangStartDate,this.dathangEndDate)),e&&(t=this.applySearchFilter(t,e,"dathang")),this.FilteredDathang=t,this.applydathangCurrentSort()}applyDateRangeFilter(e,t,n){if(!t&&!n)return e;let i=t?new Date(t+"T00:00:00"):null,a=n?new Date(n+"T23:59:59"):null;return e.filter(h=>{let m=new Date(h.createdAt);return!(i&&m<i||a&&m>a)})}applySearchFilter(e,t,n){let i=t.toLowerCase();return e.filter(a=>(n==="dathang"?[a.title,a.madathang||a.madncc,a.khachhang?.name||a.nhacungcap?.name,a.sanpham?.sanpham?.title,this.Trangthaidon[a.status]]:[a.title,a.madonhang,a.khachhang?.name,a.sanpham?.sanpham?.title,this.Trangthaidon[a.status]]).some(m=>m?.toString().toLowerCase().includes(i)))}sortDathangData(e){this.dathangSortField===e?this.dathangSortDirection=this.dathangSortDirection==="asc"?"desc":"asc":(this.dathangSortField=e,this.dathangSortDirection="asc"),this.applydathangCurrentSort()}applydathangCurrentSort(){this.dathangSortField&&this.FilteredDathang.sort((e,t)=>{let n,i;if(this.dathangSortField.includes(".")){let h=this.dathangSortField.split(".");n=h.reduce((m,g)=>m&&m[g],e),i=h.reduce((m,g)=>m&&m[g],t)}else n=e[this.dathangSortField],i=t[this.dathangSortField];if(n==null&&i==null)return 0;if(n==null)return 1;if(i==null)return-1;n=String(n).toLowerCase(),i=String(i).toLowerCase();let a=n.localeCompare(i,"vi",{numeric:!0});return this.dathangSortDirection==="asc"?a:-a})}getDathangSortIcon(e){return this.dathangSortField!==e?"unfold_more":this.dathangSortDirection==="asc"?"keyboard_arrow_up":"keyboard_arrow_down"}exportDathangData(){if(this.FilteredDathang.length===0){alert("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t");return}let e=this.FilteredDathang.map(t=>({"Ti\xEAu \u0111\u1EC1":t.title||"","M\xE3 \u0110\u1EB7t H\xE0ng":t.madathang||"","Tr\u1EA1ng th\xE1i":this.Trangthaidon[t.status]||"","Kh\xE1ch H\xE0ng":t.khachhang?.name||"","T\xEAn S\u1EA3n Ph\u1EA9m":t.sanpham?.sanpham?.title||"","S\u1ED1 L\u01B0\u1EE3ng \u0110\u1EB7t":t.sanpham?.sldat||0,"S\u1ED1 L\u01B0\u1EE3ng Nh\u1EADn":t.sanpham?.slnhan||0,Ng\u00E0y:this.formatDate(t.createdAt)}));this.exportToExcel(e,"dathang-data")}filterDonhangList(e){this.donhangSearchTimeout&&clearTimeout(this.donhangSearchTimeout),this.donhangSearchTimeout=setTimeout(()=>{let t=e.target.value?.toLowerCase()||"";this.applyDonhangFilters(t)},300)}filterDonhangByStatus(e){this.selectedDonhangStatus=e;let n=document.querySelector("#donhangSearch")?.value?.toLowerCase()||"";this.applyDonhangFilters(n)}clearDonhangFilter(){this.selectedDonhangStatus="",this.donhangStartDate="",this.donhangEndDate="",this.donhangSortField="",this.donhangSortDirection="asc",this.applyDonhangFilters("")}applyDonhangFilters(e){let t=[...this.ListDonhang];this.selectedDonhangStatus&&(t=t.filter(n=>n.status===this.selectedDonhangStatus)),(this.donhangStartDate||this.donhangEndDate)&&(t=this.applyDateRangeFilter(t,this.donhangStartDate,this.donhangEndDate)),e&&(t=this.applySearchFilter(t,e,"donhang")),this.FilteredDonhang=t,this.applyDonhangCurrentSort()}sortDonhangData(e){this.donhangSortField===e?this.donhangSortDirection=this.donhangSortDirection==="asc"?"desc":"asc":(this.donhangSortField=e,this.donhangSortDirection="asc"),this.applyDonhangCurrentSort()}applyDonhangCurrentSort(){this.donhangSortField&&this.FilteredDonhang.sort((e,t)=>{let n,i;if(this.donhangSortField.includes(".")){let h=this.donhangSortField.split(".");n=h.reduce((m,g)=>m&&m[g],e),i=h.reduce((m,g)=>m&&m[g],t)}else n=e[this.donhangSortField],i=t[this.donhangSortField];if(n==null&&i==null)return 0;if(n==null)return 1;if(i==null)return-1;n=String(n).toLowerCase(),i=String(i).toLowerCase();let a=n.localeCompare(i,"vi",{numeric:!0});return this.donhangSortDirection==="asc"?a:-a})}getDonhangSortIcon(e){return this.donhangSortField!==e?"unfold_more":this.donhangSortDirection==="asc"?"keyboard_arrow_up":"keyboard_arrow_down"}exportDonhangData(){if(this.FilteredDonhang.length===0){alert("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t");return}let e=this.FilteredDonhang.map(t=>({"Ti\xEAu \u0111\u1EC1":t.title||"","M\xE3 \u0110\u01A1n H\xE0ng":t.madonhang||"","Tr\u1EA1ng th\xE1i":this.Trangthaidon[t.status]||"","Kh\xE1ch H\xE0ng":t.khachhang?.name||"","T\xEAn S\u1EA3n Ph\u1EA9m":t.sanpham?.sanpham?.title||"","S\u1ED1 L\u01B0\u1EE3ng \u0110\u1EB7t":t.sanpham?.sldat||0,"S\u1ED1 L\u01B0\u1EE3ng Nh\u1EADn":t.sanpham?.slnhan||0,Ng\u00E0y:this.formatDate(t.createdAt)}));this.exportToExcel(e,"donhang-data")}filterDathangByDateRange(){let t=document.querySelector("#dathangSearch")?.value?.toLowerCase()||"";this.applyDathangFilters(t)}filterDonhangByDateRange(){let t=document.querySelector("#donhangSearch")?.value?.toLowerCase()||"";this.applyDonhangFilters(t)}clearDathangDateFilter(){this.dathangStartDate="",this.dathangEndDate="",this.filterDathangByDateRange()}clearDonhangDateFilter(){this.donhangStartDate="",this.donhangEndDate="",this.filterDonhangByDateRange()}setDathangDateFilter(e){let t=u.format(u.now(),"YYYY-MM-DD"),n=u.format(u.subtract(u.now(),e,"day"),"YYYY-MM-DD");this.dathangStartDate=n,this.dathangEndDate=t,this.filterDathangByDateRange()}setDonhangDateFilter(e){let t=u.format(u.now(),"YYYY-MM-DD"),n=u.format(u.subtract(u.now(),e,"day"),"YYYY-MM-DD");this.donhangStartDate=n,this.donhangEndDate=t,this.filterDonhangByDateRange()}formatDate(e){if(!e)return"";try{return u.format(e,"DD/MM/YYYY HH:mm")}catch{return""}}exportToExcel(e,t){let n=this.convertToCSV(e),i=new Blob(["\uFEFF"+n],{type:"text/csv;charset=utf-8"}),a=document.createElement("a"),h=URL.createObjectURL(i);a.setAttribute("href",h),a.setAttribute("download",`${t}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}convertToCSV(e){if(e.length===0)return"";let t=Object.keys(e[0]),n=t.join(","),i=e.map(a=>t.map(h=>{let m=a[h];return typeof m=="string"&&(m.includes(",")||m.includes('"'))?`"${m.replace(/"/g,'""')}"`:m}).join(","));return[n,...i].join(`
`)}static \u0275fac=function(t){return new(t||T)};static \u0275cmp=H({type:T,selectors:[["app-xuatnhapton"]],viewQuery:function(t,n){if(t&1&&(L($,5),L(P,5),L(Gt,7)),t&2){let i;I(i=X())&&(n.paginator=i.first),I(i=X())&&(n.sort=i.first),I(i=X())&&(n.drawer=i.first)}},outputs:{DexuatEmit:"DexuatEmit"},decls:32,vars:7,consts:[["drawer",""],["menu","matMenu"],["menuTrigger","matMenuTrigger"],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-14","w-full","p-2"],[1,"flex","flex-row","space-x-2","items-center"],[1,"relative"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],[1,"w-full","overflow-auto"],["mat-table","","matSort","",1,"excelstyle","!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSizeOptions"],["mat-menu-item","",3,"click"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"max-w-40","line-clamp-4","me-4"],[1,"z-10","material-symbols-outlined","text-gray-500",3,"matMenuTriggerFor"],[1,"cursor-pointer","flex","flex-col","space-y-4","p-3",3,"click"],[1,"relative","w-full"],[1,"flex","flex-row","space-x-2","items-center","justify-between"],[1,"text-xs","text-blue-600","underline",3,"click"],[1,"w-full","flex","flex-col","space-y-2","max-h-44","overflow-auto"],["class","flex flex-row space-x-2 items-center p-2 rounded-lg hover:bg-slate-100",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-row","space-x-2","items-end","justify-end"],["mat-flat-button","","color","warn",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"flex","flex-row","space-x-2","items-center","p-2","rounded-lg","hover:bg-slate-100",3,"click"],["class","material-symbols-outlined text-blue-600",4,"ngIf"],[1,"material-symbols-outlined","text-blue-600"],["mat-cell",""],[1,"max-w-40","line-clamp-4"],[1,"max-w-40","line-clamp-4","text-green-700","font-bold"],[1,"max-w-40","line-clamp-4","text-red-700","font-bold"],[1,"max-w-40","line-clamp-4","text-xs"],[1,"flex","items-center","justify-between"],[1,"text-xs","text-gray-500"],[1,"text-green-500"],[1,"text-red-500"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell","p-4"]],template:function(t,n){if(t&1){let i=k();s(0,"mat-drawer-container",3)(1,"mat-drawer",4,0),M(3,"router-outlet"),l(),s(4,"div",5)(5,"div",6)(6,"div",7)(7,"input",8),S("keyup",function(h){return _(i),f(n.applyFilter(h))}),l(),s(8,"div",9)(9,"span",10),p(10,"search"),l()()(),s(11,"button",11)(12,"mat-icon"),p(13,"tune"),l()(),s(14,"mat-menu",null,1)(16,"div",12)(17,"mat-form-field",13)(18,"input",14),S("input",function(h){return _(i),f(n.doFilterColumns(h))})("click",function(h){return _(i),f(h.stopPropagation())}),l(),s(19,"mat-icon",15),p(20,"search"),l()()(),s(21,"div",16),B(22,ee,5,2,"button",17,te),l()()(),s(24,"div",18)(25,"table",19),B(26,we,3,1,"ng-container",20,N),w(28,Fe,1,0,"tr",21)(29,ve,1,0,"tr",22)(30,Te,3,0,"tr",23),l()(),M(31,"mat-paginator",24),l()()}if(t&2){let i=b(15);c(),y("position","end"),c(10),y("matMenuTriggerFor",i),c(11),V(n.FilterColumns),c(3),y("dataSource",n.dataSource),c(),V(n.displayedColumns),c(2),y("matHeaderRowDef",n.displayedColumns),c(),y("matRowDefColumns",n.displayedColumns),c(2),y("pageSizeOptions",K(6,Zt))}},dependencies:[ft,_t,gt,yt,St,Vt,Mt,bt,Xt,Et,kt,$t,Lt,It,Pt,Yt,Bt,Tt,P,vt,Ft,$,pt,ht,lt,ct,ot,it,at,U,st,rt,et,Z,tt,Ct,J,z,q,j,Q,mt,wt,Dt,Ot,dt],encapsulation:2})};Y([At()],T.prototype,"FilterHederColumn",1),Y([Kt(300)],T.prototype,"doFilterHederColumn",1);var Wt=T;export{Wt as XuatnhaptonComponent};
