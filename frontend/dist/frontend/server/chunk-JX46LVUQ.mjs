import './polyfills.server.mjs';
import{a as bt}from"./chunk-BRH7XLJP.mjs";import{b as vt,f as St}from"./chunk-53QMX2P6.mjs";import{a as Ct,b as ht}from"./chunk-TUXQOILX.mjs";import{a as dt,b as ut,c as _t,d as gt,f as xt,g as ft}from"./chunk-SGNVDP7Q.mjs";import"./chunk-N7WAOINW.mjs";import{a as mt}from"./chunk-4AA42E7K.mjs";import{b as pt,c as ct}from"./chunk-B3PX7AHP.mjs";import{b as Y,g as Z,h as tt,i as et,j as it,k as nt,o as ot,p as rt,r as at,x as lt,y as st}from"./chunk-AX7HEFN2.mjs";import"./chunk-AMJ6U7FR.mjs";import{a as Q,b as X}from"./chunk-ADGAW7R6.mjs";import"./chunk-6EFOJMAD.mjs";import"./chunk-VT4NXQX5.mjs";import{a as K,b as J}from"./chunk-P5O5LZCS.mjs";import"./chunk-6CMIKFNE.mjs";import"./chunk-PFC65XRO.mjs";import{a as q,c as G,e as O}from"./chunk-FMDQCH3J.mjs";import"./chunk-FRFHEJIU.mjs";import"./chunk-7T6LZHUD.mjs";import{a as L,d as W,e as H,h as z}from"./chunk-N6ZUYKC5.mjs";import"./chunk-5YOTNGM2.mjs";import{u as $,z as j}from"./chunk-OZK2OCZT.mjs";import{$b as F,Fb as I,Gc as U,Hc as p,Ic as g,Jc as k,Kc as A,Mb as u,Mc as B,Nc as P,Oc as R,Qc as N,Ra as C,Wc as M,Yb as x,Yc as w,dc as _,ec as V,gc as S,hc as b,ic as r,jc as o,kc as y,oc as E,pb as h,tb as a,tc as f,vc as s,ya as m,yb as v,za as d}from"./chunk-TKMPR5S6.mjs";import"./chunk-XAZRL6IZ.mjs";import{j as T}from"./chunk-RIAI3ORJ.mjs";var Et=()=>["/admin/support"],D=(i,e)=>e.id;function kt(i,e){i&1&&(r(0,"div",2),y(1,"mat-spinner"),o())}function Ft(i,e){if(i&1){let t=E();r(0,"img",26),f("click",function(){m(t);let n=s().$implicit,c=s(3);return d(c.openFile(n.fileUrl))}),o()}if(i&2){let t=s().$implicit,l=s(3);x("src",l.getFileUrl(t.fileUrl),h)("alt",t.fileName)}}function Mt(i,e){if(i&1&&y(0,"video",25),i&2){let t=s().$implicit,l=s(3);x("src",l.getFileUrl(t.fileUrl),h)}}function wt(i,e){if(i&1&&(r(0,"div",23),u(1,Ft,1,2,"img",24)(2,Mt,1,1,"video",25),o()),i&2){let t=e.$implicit;a(),_(t.fileType.startsWith("image/")?1:t.fileType.startsWith("video/")?2:-1)}}function Dt(i,e){if(i&1&&(r(0,"div",11),S(1,wt,3,1,"div",23,D),o()),i&2){let t=s(2);a(),b(t.ticket().attachments)}}function Tt(i,e){if(i&1){let t=E();r(0,"img",26),f("click",function(){m(t);let n=s().$implicit,c=s(4);return d(c.openFile(n.fileUrl))}),o()}if(i&2){let t=s().$implicit,l=s(4);x("src",l.getFileUrl(t.fileUrl),h)("alt",t.fileName)}}function It(i,e){if(i&1&&y(0,"video",25),i&2){let t=s().$implicit,l=s(4);x("src",l.getFileUrl(t.fileUrl),h)}}function Vt(i,e){if(i&1&&(r(0,"div",23),u(1,Tt,1,2,"img",24)(2,It,1,1,"video",25),o()),i&2){let t=e.$implicit;a(),_(t.fileType.startsWith("image/")?1:t.fileType.startsWith("video/")?2:-1)}}function Ut(i,e){if(i&1&&(r(0,"div",11),S(1,Vt,3,1,"div",23,D),o()),i&2){let t=s().$implicit;a(),b(t.attachments)}}function At(i,e){if(i&1&&(r(0,"mat-card")(1,"mat-card-header")(2,"mat-card-subtitle")(3,"div",27)(4,"span"),p(5),o(),r(6,"span",28),p(7),M(8,"date"),o()()()(),r(9,"mat-card-content")(10,"p",10),p(11),o(),u(12,Ut,3,0,"div",11),o()()),i&2){let t=e.$implicit;a(5),g(t.user.name),a(2),g(w(8,4,t.createdAt,"dd/MM/yyyy HH:mm")),a(4),g(t.content),a(),_(t.attachments!=null&&t.attachments.length?12:-1)}}function Bt(i,e){if(i&1){let t=E();r(0,"div",29)(1,"div",30)(2,"mat-icon",31),p(3),o(),r(4,"span",31),p(5),o()(),r(6,"button",32),f("click",function(){let n=m(t).$index,c=s(3);return d(c.removeFile(n))}),r(7,"mat-icon"),p(8,"close"),o()()()}if(i&2){let t=e.$implicit,l=s(3);a(3),g(l.getFileIcon(t.type)),a(2),g(t.name)}}function Pt(i,e){if(i&1&&(r(0,"div",20),S(1,Bt,9,2,"div",29,V),o()),i&2){let t=s(2);a(),b(t.responseFiles())}}function Rt(i,e){i&1&&y(0,"mat-spinner",22)}function Nt(i,e){i&1&&(r(0,"mat-icon"),p(1,"send"),o())}function $t(i,e){if(i&1){let t=E();r(0,"div",3)(1,"button",4)(2,"mat-icon"),p(3,"arrow_back"),o()(),r(4,"div",5)(5,"div",6)(6,"h1",7),p(7),o(),r(8,"mat-chip"),p(9),o(),r(10,"mat-chip"),p(11),o()(),r(12,"div",8),p(13),M(14,"date"),o()()(),r(15,"mat-card",9)(16,"mat-card-content")(17,"p",10),p(18),o(),u(19,Dt,3,0,"div",11),o()(),r(20,"div",12)(21,"h2",13),p(22),o(),S(23,At,13,7,"mat-card",null,D),o(),r(25,"mat-card")(26,"mat-card-header")(27,"mat-card-title"),p(28,"Th\xEAm ph\u1EA3n h\u1ED3i"),o()(),r(29,"mat-card-content")(30,"form",14),f("submit",function(n){m(t);let c=s();return d(c.onSubmitResponse(n))}),r(31,"mat-form-field",15)(32,"mat-label"),p(33,"N\u1ED9i dung ph\u1EA3n h\u1ED3i"),o(),r(34,"textarea",16),R("ngModelChange",function(n){m(t);let c=s();return P(c.responseContent,n)||(c.responseContent=n),d(n)}),o()(),r(35,"div")(36,"div",17)(37,"input",18,0),f("change",function(n){m(t);let c=s();return d(c.onFileSelected(n))}),o(),r(39,"button",19),f("click",function(){m(t);let n=U(38);return d(n.click())}),r(40,"mat-icon"),p(41,"attach_file"),o(),p(42," \u0110\xEDnh k\xE8m file "),o()(),u(43,Pt,3,0,"div",20),o(),r(44,"button",21),u(45,Rt,1,0,"mat-spinner",22)(46,Nt,2,0,"mat-icon"),p(47," G\u1EEDi ph\u1EA3n h\u1ED3i "),o()()()()}if(i&2){let t,l,n=s();a(),x("routerLink",N(20,Et)),a(6),g(n.ticket().title),a(),F(n.getStatusClass(n.ticket().status)),a(),k(" ",n.getStatusLabel(n.ticket().status)," "),a(),F(n.getPriorityClass(n.ticket().priority)),a(),k(" ",n.getPriorityLabel(n.ticket().priority)," "),a(2),A(" T\u1EA1o b\u1EDFi ",n.ticket().user.name," \u2022 ",w(14,17,n.ticket().createdAt,"dd/MM/yyyy HH:mm")," "),a(5),g(n.ticket().description),a(),_((t=n.ticket().attachments)!=null&&t.length?19:-1),a(3),k("Ph\u1EA3n h\u1ED3i (",((l=n.ticket().responses)==null?null:l.length)||0,")"),a(),b(n.ticket().responses),a(11),B("ngModel",n.responseContent),a(9),_(n.responseFiles().length>0?43:-1),a(),x("disabled",n.responding()||!n.responseContent),a(),_(n.responding()?45:46)}}var yt=class i{constructor(e,t,l,n){this.supportService=e;this.route=t;this.router=l;this.snackBar=n}ticket=C(null);loading=C(!0);responding=C(!1);responseContent="";responseFiles=C([]);ticketId="";ngOnInit(){this.route.params.subscribe(e=>{this.ticketId=e.id,this.loadTicket()})}loadTicket(){this.loading.set(!0),this.supportService.ticket(this.ticketId).subscribe({next:e=>{this.ticket.set(e.data.ticket),this.loading.set(!1)},error:()=>{this.loading.set(!1),this.snackBar.open("Kh\xF4ng t\xECm th\u1EA5y v\u1EA5n \u0111\u1EC1","\u0110\xF3ng",{duration:3e3}),this.router.navigate(["/admin/support"])}})}onFileSelected(e){let t=Array.from(e.target.files);this.responseFiles.set([...this.responseFiles(),...t])}removeFile(e){let t=this.responseFiles();t.splice(e,1),this.responseFiles.set([...t])}onSubmitResponse(e){return T(this,null,function*(){e.preventDefault(),this.responding.set(!0);try{let t=[];this.responseFiles().length>0&&(t=(yield this.supportService.uploadFiles(this.responseFiles()).toPromise())?.map(n=>n.fileUrl)||[]),yield this.supportService.addResponse(this.ticketId,{content:this.responseContent,attachmentUrls:t}).toPromise(),this.snackBar.open("\u0110\xE3 g\u1EEDi ph\u1EA3n h\u1ED3i th\xE0nh c\xF4ng!","\u0110\xF3ng",{duration:3e3}),this.responseContent="",this.responseFiles.set([]),this.loadTicket()}catch(t){console.error("Error adding response:",t),this.snackBar.open("L\u1ED7i khi g\u1EEDi ph\u1EA3n h\u1ED3i. Vui l\xF2ng th\u1EED l\u1EA1i.","\u0110\xF3ng",{duration:3e3})}finally{this.responding.set(!1)}})}getFileUrl(e){return mt(e)}openFile(e){window.open(this.getFileUrl(e),"_blank")}getFileIcon(e){return e.startsWith("image/")?"image":e.startsWith("video/")?"videocam":"attach_file"}getStatusClass(e){return{open:"bg-blue-100 text-blue-800",inProgress:"bg-yellow-100 text-yellow-800",resolved:"bg-green-100 text-green-800",closed:"bg-gray-100 text-gray-800"}[e]||"bg-gray-100"}getStatusLabel(e){return{open:"M\u1EDBi",inProgress:"\u0110ang x\u1EED l\xFD",resolved:"\u0110\xE3 gi\u1EA3i quy\u1EBFt",closed:"\u0110\xE3 \u0111\xF3ng"}[e]||e}getPriorityClass(e){return{low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"}[e]||"bg-gray-100"}getPriorityLabel(e){return{low:"Th\u1EA5p",medium:"Trung b\xECnh",high:"Cao",urgent:"Kh\u1EA9n c\u1EA5p"}[e]||e}static \u0275fac=function(t){return new(t||i)(v(bt),v(L),v(W),v(K))};static \u0275cmp=I({type:i,selectors:[["app-support-detail"]],decls:3,vars:1,consts:[["fileInput",""],[1,"container","mx-auto","p-4","max-w-4xl"],[1,"flex","justify-center","p-12"],[1,"flex","items-center","gap-4","mb-6"],["mat-icon-button","",3,"routerLink"],[1,"flex-1"],[1,"flex","items-center","gap-3"],[1,"text-2xl","font-bold"],[1,"text-sm","text-gray-500","mt-1"],[1,"mb-4"],[1,"whitespace-pre-wrap"],[1,"mt-4","grid","grid-cols-2","md:grid-cols-4","gap-2"],[1,"space-y-4","mb-6"],[1,"text-xl","font-bold"],[1,"space-y-4",3,"submit"],["appearance","outline",1,"w-full"],["matInput","","name","content","required","","rows","4","placeholder","Nh\u1EADp n\u1ED9i dung ph\u1EA3n h\u1ED3i...",3,"ngModelChange","ngModel"],[1,"border-2","border-dashed","border-gray-300","rounded-lg","p-4"],["type","file","multiple","","accept","image/*,video/*",1,"hidden",3,"change"],["mat-stroked-button","","type","button",3,"click"],[1,"mt-2","space-y-2"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20"],[1,"border","rounded-lg","overflow-hidden"],[1,"w-full","h-32","object-cover","cursor-pointer",3,"src","alt"],["controls","",1,"w-full","h-32","object-cover",3,"src"],[1,"w-full","h-32","object-cover","cursor-pointer",3,"click","src","alt"],[1,"flex","items-center","justify-between"],[1,"text-xs"],[1,"flex","items-center","justify-between","p-2","bg-gray-50","rounded"],[1,"flex","items-center","gap-2"],[1,"text-sm"],["mat-icon-button","","type","button",3,"click"]],template:function(t,l){t&1&&(r(0,"div",1),u(1,kt,2,0,"div",2)(2,$t,48,21),o()),t&2&&(a(),_(l.loading()?1:l.ticket()?2:-1))},dependencies:[j,$,rt,nt,Y,Z,tt,ot,it,et,z,H,O,q,G,ft,dt,_t,xt,gt,ut,St,vt,st,lt,at,ct,pt,X,Q,ht,Ct,J],encapsulation:2})};export{yt as SupportDetailComponent};
