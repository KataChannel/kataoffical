import './polyfills.server.mjs';
import{a as _e,b as fe}from"./chunk-KLHX3L6P.mjs";import{b as ge}from"./chunk-ERZKSYAH.mjs";import{a as de}from"./chunk-NTYP2I5F.mjs";import{b as he,d as me}from"./chunk-QBPLJZ3D.mjs";import{b as pe}from"./chunk-KDA2S5QG.mjs";import{f as ue,g as O}from"./chunk-ETGHWKBN.mjs";import{a as ft}from"./chunk-5OAQK6SW.mjs";import{a as le,b as ce}from"./chunk-PDYHWB5Z.mjs";import{a as se}from"./chunk-75S4A7ES.mjs";import{a as jt,b as qt}from"./chunk-A56U74X5.mjs";import{a as N,b as Gt,c as Kt}from"./chunk-2FLLKDTQ.mjs";import{a as Ht,b as Ut,c as Qt,d as Xt,e as Jt,g as Yt,h as Zt,j as te,k as ee,m as ie,n as oe,p as ne,q as ae,r as re,s as G}from"./chunk-7OL3A46M.mjs";import{c as Tt,d as Dt,f as Ft,h as Bt}from"./chunk-SQLON2R6.mjs";import{a as Ct,b as kt,c as xt}from"./chunk-FEYBIC4G.mjs";import{a as bt,b as St,c as wt,d as Et}from"./chunk-ELAJKLT3.mjs";import{a as Ot,b as Wt}from"./chunk-5J65EW3V.mjs";import{b as Pt,g as It,j as Lt,n as Mt,p as At,r as Vt,v as Rt,w as zt,y as $t,z as Nt}from"./chunk-GA3UYBFM.mjs";import{a as yt,b as vt}from"./chunk-PK3DRSOU.mjs";import{a as q}from"./chunk-6EFOJMAD.mjs";import{a as _t}from"./chunk-3FIPRBVQ.mjs";import{a as $}from"./chunk-K3B42B6X.mjs";import{a as ut,c as dt,e as gt}from"./chunk-4I2U3JAI.mjs";import{ka as pt,y as ht,z as mt}from"./chunk-EDQTS3NM.mjs";import{b as lt,d as ct}from"./chunk-BAXOD54Y.mjs";import{d as st}from"./chunk-TSEEXHZ6.mjs";import{m as ot,o as nt,t as at,x as rt}from"./chunk-GTWDOMLN.mjs";import{Bc as B,Cc as A,Dc as V,Fb as Q,Gc as M,Hc as s,Ic as b,Jc as _,Kc as tt,Mb as C,Mc as T,Nc as D,Oc as F,Qc as et,Ra as f,Wc as R,Yb as p,Yc as z,ac as X,ad as E,dc as w,fc as J,gc as U,hc as j,ic as n,ja as K,jc as r,kc as P,lc as Y,mc as Z,oc as k,pa as y,tb as l,tc as g,u as L,vc as h,ya as u,yd as it,za as d}from"./chunk-KYBR54ZN.mjs";import{a as v,b as S,h as H,j as m}from"./chunk-RIAI3ORJ.mjs";var W=class a{graphqlService=y(de);storageService=y(_t);userService=y(ft);snackBar=y($);http=y(st);apollo=y(ue);apiUrl=q.APIURL;modelName="chotkho";detailModelName="chotkhodetail";chotkhos=f([]);isLoading=f(!1);selectedChotkho=f(null);ListChotkho=f([]);DetailChotkho=f(null);page=f(1);totalPages=f(1);total=f(0);pageSize=f(50);chotkhoId=f(null);isRefreshing=f(!1);lastUpdated=f(null);createChotkhoWithDetails(e){return m(this,null,function*(){try{this.isLoading.set(!0);let t={ngaychot:e.ngaychot,title:e.title,ghichu:e.ghichu,userId:e.userId||(yield this.getCurrentUserId()),codeId:new Date().getTime().toString()},i=yield this.graphqlService.createOne(this.modelName,t,{select:{id:!0,ngaychot:!0,title:!0,ghichu:!0,userId:!0,codeId:!0}});if(console.log("Created chotkho master record:",i),!i||!i.id)return this.showErrorMessage("L\u1ED7i khi t\u1EA1o ch\u1ED1t kho"),!1;if(e.details&&e.details.length>0)for(let o of e.details){console.log("Creating detail record:",o);let c={chotkhoId:i.id,sanphamId:o.sanphamId,userId:e.userId||(yield this.getCurrentUserId()),sltonhethong:o.sltonhethong||0,sltonthucte:o.sltonthucte||0,slhuy:o.slhuy||0,chenhlech:this.calculateChenhLech(o.sltonhethong||0,o.sltonthucte||0,o.slhuy||0),ghichu:o.ghichu||"",isActive:!0};yield this.graphqlService.createOne(this.detailModelName,c,{select:{id:!0,sanphamId:!0,sltonhethong:!0,sltonthucte:!0,slhuy:!0,chenhlech:!0,ghichu:!0,chotkhoId:!0}})}return this.showSuccessMessage("T\u1EA1o ch\u1ED1t kho th\xE0nh c\xF4ng"),yield this.getAllChotkho(),!0}catch(t){return console.error("Error creating chotkho with details:",t),this.showErrorMessage("L\u1ED7i khi t\u1EA1o ch\u1ED1t kho"),!1}finally{this.isLoading.set(!1)}})}getAllChotkho(e){return m(this,null,function*(){try{this.isLoading.set(!0);let t="isActive: true";if(e){let o=[];e.khoId&&o.push(`khoId: "${e.khoId}"`),e.userId&&o.push(`userId: "${e.userId}"`),e.startDate&&e.endDate&&o.push(`ngaychot: { gte: "${e.startDate}", lte: "${e.endDate}" }`),e.searchText&&o.push(`OR: [
            { title: { contains: "${e.searchText}" } },
            { ghichu: { contains: "${e.searchText}" } },
            { codeId: { contains: "${e.searchText}" } }
          ]`),o.length>0&&(t=`AND: [{ isActive: true }, { ${o.join(", ")} }]`)}let i=yield this.graphqlService.findMany(this.modelName,{where:t,orderBy:{ngaychot:"desc"},skip:((e?.page||1)-1)*(e?.limit||50),take:e?.limit||50,include:{kho:{select:{id:!0,name:!0}},user:{select:{id:!0,email:!0,profile:{select:{name:!0}}}},details:{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0}}}}}});i&&(this.ListChotkho.set(i||[]),this.chotkhos.set(i||[]),this.total.set(i.length||0),this.totalPages.set(Math.ceil((i.length||0)/(e?.limit||50))),this.page.set(e?.page||1))}catch(t){console.error("Error getting chotkho data:",t),this.showErrorMessage("L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u ch\u1ED1t kho")}finally{this.isLoading.set(!1)}})}getChotkhoById(e){return m(this,null,function*(){try{this.isLoading.set(!0);let t=yield this.graphqlService.findUnique(this.modelName,{id:e},{include:{user:{select:{id:!0,email:!0,profile:{select:{name:!0}}}},details:{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0}}}}}});if(console.log("getChotkhoById result:",t),t){let i=S(v({},t),{details:t.details?.map(o=>S(v({},o),{title:o.sanpham?.title,masp:o.sanpham?.masp,dvt:o.sanpham?.dvt,sanpham:o.sanpham}))||[]});return console.log("Processed chotkho data:",i),this.selectedChotkho.set(i),this.DetailChotkho.set(i),i}return null}catch(t){return console.error("Error getting chotkho by id:",t),this.showErrorMessage("L\u1ED7i khi l\u1EA5y th\xF4ng tin ch\u1ED1t kho"),null}finally{this.isLoading.set(!1)}})}updateChotkho(e,t){return m(this,null,function*(){try{this.isLoading.set(!0);let i={ngaychot:t.ngaychot,title:t.title,ghichu:t.ghichu,isActive:t.isActive};return(yield this.graphqlService.updateOne(this.modelName,{id:e},i,{select:{id:!0,ngaychot:!0,title:!0,ghichu:!0,khoId:!0}}))?(this.showSuccessMessage("C\u1EADp nh\u1EADt ch\u1ED1t kho th\xE0nh c\xF4ng"),yield this.getAllChotkho(),!0):!1}catch(i){return console.error("Error updating chotkho:",i),this.showErrorMessage("L\u1ED7i khi c\u1EADp nh\u1EADt ch\u1ED1t kho"),!1}finally{this.isLoading.set(!1)}})}updateChotkhoWithDetails(e,t){return m(this,null,function*(){try{this.isLoading.set(!0);let i={ngaychot:t.ngaychot,title:t.title,ghichu:t.ghichu,isActive:t.isActive,details:t.details?.map(c=>({sanphamId:c.sanphamId,sltonhethong:c.sltonhethong||0,sltonthucte:c.sltonthucte||0,slhuy:c.slhuy||0,ghichu:c.ghichu||""}))};return(yield L(this.http.patch(`${q.APIURL}/chotkho/${e}/with-details`,i,{headers:{Authorization:`Bearer ${this.storageService.getItem("token")}`}})))?(this.showSuccessMessage("C\u1EADp nh\u1EADt ch\u1ED1t kho v\xE0 chi ti\u1EBFt th\xE0nh c\xF4ng"),yield this.getAllChotkho(),yield this.getChotkhoById(e),!0):!1}catch(i){return console.error("Error updating chotkho with details:",i),this.showErrorMessage("L\u1ED7i khi c\u1EADp nh\u1EADt ch\u1ED1t kho"),!1}finally{this.isLoading.set(!1)}})}deleteChotkho(e){return m(this,null,function*(){try{return this.isLoading.set(!0),(yield this.graphqlService.updateOne(this.modelName,{id:e},{isActive:!1},{select:{id:!0,isActive:!0}}))?(this.showSuccessMessage("X\xF3a ch\u1ED1t kho th\xE0nh c\xF4ng"),yield this.getAllChotkho(),!0):!1}catch(t){return console.error("Error deleting chotkho:",t),this.showErrorMessage("L\u1ED7i khi x\xF3a ch\u1ED1t kho"),!1}finally{this.isLoading.set(!1)}})}addChotkhoDetail(e,t){return m(this,null,function*(){try{let i=S(v({},t),{chotkhoId:e,userId:yield this.getCurrentUserId(),chenhlech:this.calculateChenhLech(t.sltonhethong||0,t.sltonthucte||0,t.slhuy||0)});return(yield this.graphqlService.createOne(this.detailModelName,i,{select:{id:!0,sanphamId:!0,sltonhethong:!0,sltonthucte:!0,slhuy:!0,chenhlech:!0,ghichu:!0,chotkhoId:!0}}))?(this.showSuccessMessage("Th\xEAm chi ti\u1EBFt th\xE0nh c\xF4ng"),yield this.getChotkhoById(e),!0):!1}catch(i){return console.error("Error adding chotkho detail:",i),this.showErrorMessage("L\u1ED7i khi th\xEAm chi ti\u1EBFt ch\u1ED1t kho"),!1}})}calculateChenhLech(e,t,i){return e-t-i}generateChotkhoCode(){let e=new Date,t=e.getFullYear().toString().substr(-2)+(e.getMonth()+1).toString().padStart(2,"0")+e.getDate().toString().padStart(2,"0"),i=e.getHours().toString().padStart(2,"0")+e.getMinutes().toString().padStart(2,"0");return`CK${t}${i}`}setChotkhoId(e){this.chotkhoId.set(e)}getCurrentUserId(){return m(this,null,function*(){try{return(yield this.userService.getProfile())?.id||null}catch(e){return console.error("Error getting current user:",e),null}})}showSuccessMessage(e){this.snackBar.open(e,"\u0110\xF3ng",{duration:3e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-success"]})}showErrorMessage(e){this.snackBar.open(e,"\u0110\xF3ng",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-error"]})}getUpdatedCodeIds(){return m(this,null,function*(){console.log("getUpdatedCodeIds - implement if needed")})}DeleteChotkho(e){return m(this,null,function*(){e?.id&&(yield this.deleteChotkho(e.id))})}getStatistics(){return m(this,null,function*(){return{total:this.ListChotkho().length,active:this.ListChotkho().filter(e=>e.isActive).length}})}generateReport(e){return m(this,null,function*(){return console.log("generateReport - implement if needed",e),{success:!0,message:"Report placeholder"}})}bulkUpdateStatus(e,t){return m(this,null,function*(){return console.log("bulkUpdateStatus - implement if needed",e,t),!0})}importFromExcel(e,t){return m(this,null,function*(){return console.log("importFromExcel - implement if needed",e,t),{success:!0,message:"Import placeholder"}})}backupData(e){return m(this,null,function*(){return console.log("backupData - implement if needed",e),!0})}optimizePerformance(){return m(this,null,function*(){return console.log("optimizePerformance - implement if needed"),{success:!0}})}getSystemHealth(){return m(this,null,function*(){return console.log("getSystemHealth - implement if needed"),{status:"healthy"}})}generateImportTemplate(e){return m(this,null,function*(){return console.log("generateImportTemplate - implement if needed",e),!0})}exportData(e,t){return m(this,null,function*(){return console.log("exportData - implement if needed",e,t),!0})}smartCheckChenhLech(e){return m(this,null,function*(){return console.log("smartCheckChenhLech - implement if needed",e),{success:!0}})}restoreFromBackup(e){return m(this,null,function*(){return console.log("restoreFromBackup - implement if needed",e),!0})}getAllWarehouses(){return m(this,null,function*(){let e=O`
      query chotkhoGetAllWarehouses {
        chotkhoGetAllWarehouses
      }
    `;try{return(yield L(this.apollo.query({query:e,fetchPolicy:"cache-first"}))).data.chotkhoGetAllWarehouses||[]}catch(t){throw console.error("Error getting warehouses:",t),t}})}getProductsByWarehouse(e){return m(this,null,function*(){let t=O`
      query chotkhoGetProductsByWarehouse($khoId: String!) {
        chotkhoGetProductsByWarehouse(khoId: $khoId)
      }
    `;try{return(yield L(this.apollo.query({query:t,variables:{khoId:e},fetchPolicy:"cache-first"}))).data.chotkhoGetProductsByWarehouse||[]}catch(i){throw console.error("Error getting products by warehouse:",i),i}})}getAllProducts(){return m(this,null,function*(){let e=O`
      query chotkhoGetAllProducts {
        chotkhoGetAllProducts
      }
    `;try{return(yield L(this.apollo.query({query:e,fetchPolicy:"cache-first"}))).data.chotkhoGetAllProducts||[]}catch(t){throw console.error("Error getting all products:",t),t}})}static \u0275fac=function(t){return new(t||a)};static \u0275prov=K({token:a,factory:a.\u0275fac,providedIn:"root"})};var ye=["drawer"],ve=()=>({standalone:!0}),be=(a,e)=>e.key;function Se(a,e){a&1&&(n(0,"mat-icon",42),s(1,"autorenew"),r())}function we(a,e){a&1&&(n(0,"mat-icon"),s(1,"delete"),r())}function Ee(a,e){if(a&1){let t=k();n(0,"button",41),g("click",function(){u(t);let o=h(),c=M(71);return d(o.openDeleteDialog(c))}),C(1,Se,2,0,"mat-icon",42)(2,we,2,0,"mat-icon"),n(3,"span",20),s(4),r()()}if(a&2){let t=h();p("disabled",t.isLoading()),l(),w(t.isLoading()?1:2),l(3),_("Xo\xE1 (",t.EditList.length,")")}}function Pe(a,e){if(a&1){let t=k();n(0,"button",55),g("click",function(o){u(t);let c=h().$implicit;return h(4).toggleColumn(c),d(o.stopPropagation())}),n(1,"mat-icon"),s(2),r(),n(3,"span"),s(4),r()()}if(a&2){let t=h().$implicit;p("disabled",!0),l(2),b(t.isShow?"check_box":"check_box_outline_blank"),l(2),b(t.value)}}function Ie(a,e){if(a&1){let t=k();n(0,"button",56),g("click",function(o){u(t);let c=h().$implicit;return h(4).toggleColumn(c),d(o.stopPropagation())}),n(1,"mat-icon"),s(2),r(),n(3,"span"),s(4),r()()}if(a&2){let t=h().$implicit;l(2),b(t.isShow?"check_box":"check_box_outline_blank"),l(2),b(t.value)}}function Le(a,e){if(a&1&&C(0,Pe,5,3,"button",53)(1,Ie,5,2,"button",54),a&2){let t=e.$implicit;w(t.key=="stt"?0:1)}}function Me(a,e){if(a&1){let t=k();n(0,"th",43)(1,"button",47)(2,"mat-icon"),s(3,"tune"),r()(),n(4,"mat-menu",null,8)(6,"div",48)(7,"mat-form-field",49)(8,"input",50),g("input",function(o){u(t);let c=h(3);return d(c.doFilterColumns(o))})("click",function(o){return u(t),d(o.stopPropagation())}),r(),n(9,"mat-icon",51),s(10,"search"),r()(),n(11,"button",32),g("click",function(){u(t);let o=h(3);return d(o.updateDisplayedColumns())}),n(12,"mat-icon"),s(13,"check_circle"),r()()(),n(14,"div",52),U(15,Le,2,1,null,null,be),r()()()}if(a&2){let t=M(5),i=h(3);l(),p("matMenuTriggerFor",t),l(14),j(i.FilterColumns)}}function Te(a,e){a&1&&C(0,Me,17,1,"th",46)}function De(a,e){if(a&1){let t=k();n(0,"th",44)(1,"span",58),s(2),r(),n(3,"app-searchfilter",59),g("OutFilter",function(o){u(t);let c=h(3);return d(c.onOutFilter(o))}),r()()}if(a&2){let t=h(2).$implicit,i=h();l(2),_(" ",i.ColumnName[t]," "),l(),p("icon","filter_alt")("ListItem",i.Listchotkho())("fieldsearch",t)("ListFilter",i.ListFilter)("filterItem",i.FilterHederColumn(i.dataSource.filteredData,t))}}function Fe(a,e){a&1&&C(0,De,4,6,"th",57)}function Be(a,e){if(a&1){let t=k();n(0,"span",65),g("click",function(){u(t);let o=h().$implicit,c=h(2);return d(c.goToDetail(o))}),s(1),r()}if(a&2){let t=h().$implicit,i=h().$implicit;l(),_(" ",t[i]," ")}}function Ae(a,e){a&1&&(n(0,"mat-icon"),s(1,"check"),r())}function Ve(a,e){if(a&1&&(n(0,"span"),s(1),r()),a&2){let t=h(2).index;l(),b(t+1)}}function Re(a,e){if(a&1){let t=k();n(0,"span",66),g("click",function(){u(t);let o=h().$implicit,c=h(2);return d(c.AddToEdit(o))}),C(1,Ae,2,0,"mat-icon")(2,Ve,2,1,"span"),r()}if(a&2){let t=h().$implicit,i=h(2);l(),w(i.CheckSelect(t)?1:2)}}function ze(a,e){if(a&1&&(n(0,"span",63),s(1),R(2,"date"),r()),a&2){let t=h().$implicit,i=h().$implicit;l(),_(" ",z(2,1,t[i],"HH:mm:ss dd/MM/yyyy")," ")}}function $e(a,e){if(a&1&&(n(0,"span",63),s(1),R(2,"date"),r()),a&2){let t=h().$implicit,i=h().$implicit;l(),_(" ",z(2,1,t[i],"dd/MM/yyyy")," ")}}function Ne(a,e){if(a&1&&(n(0,"span",63),s(1),r()),a&2){let t=h().$implicit;l(),_(" ",(t.kho==null?null:t.kho.name)||(t.kho==null?null:t.kho.makho)||"Ch\u01B0a ch\u1ECDn kho"," ")}}function Oe(a,e){if(a&1&&(n(0,"span",64)(1,"mat-chip",67),s(2),r()()),a&2){let t=h().$implicit;l(2),_(" ",(t.details==null?null:t.details.length)||0," SP ")}}function We(a,e){a&1&&(n(0,"mat-icon",68),s(1,"check_circle"),r())}function He(a,e){a&1&&(n(0,"mat-icon",69),s(1,"cancel"),r())}function Ue(a,e){if(a&1&&(n(0,"span",63),C(1,We,2,0,"mat-icon",68)(2,He,2,0,"mat-icon",69),r()),a&2){let t=h().$implicit,i=h().$implicit;l(),w(t[i]?1:2)}}function je(a,e){if(a&1&&(n(0,"span",63),s(1),r()),a&2){let t=h().$implicit,i=h().$implicit;l(),_(" ",t[i]," ")}}function qe(a,e){if(a&1&&(n(0,"td",60),C(1,Be,2,1,"span",61)(2,Re,3,1,"span",62)(3,ze,3,4,"span",63)(4,$e,3,4,"span",63)(5,Ne,2,1,"span",63)(6,Oe,3,1,"span",64)(7,Ue,3,1,"span",63)(8,je,2,1,"span",63),r()),a&2){let t,i=h().$implicit;l(),w((t=i)==="codeId"?1:t==="stt"?2:t==="createdAt"?3:t==="ngaychot"?4:t==="khoId"?5:t==="details"?6:t==="isActive"?7:8)}}function Ge(a,e){if(a&1&&(Y(0,37),C(1,Te,1,0,"th",43)(2,Fe,1,0,"th",44)(3,qe,9,1,"td",45),Z()),a&2){let t=e.$implicit;p("matColumnDef",t),l(),w(t=="stt"?1:2)}}function Ke(a,e){a&1&&P(0,"tr",70)}function Qe(a,e){if(a&1){let t=k();n(0,"tr",71),g("click",function(){let o=u(t).$implicit,c=h();return d(c.AddToEdit(o))}),r()}if(a&2){let t=e.$implicit,i=h();X("hover:bg-slate-100 cursor-pointer ",i.CheckItemInEdit(t)?"!bg-slate-200":"","")}}function Xe(a,e){a&1&&(n(0,"tr",72)(1,"td",73),s(2,"Kh\xF4ng t\xECm th\u1EA5y"),r()())}function Je(a,e){a&1&&(n(0,"mat-dialog-content")(1,"div",74)(2,"div",75),s(3,"X\xE1c Nh\u1EADn"),r(),n(4,"div"),s(5,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),r(),n(6,"div",76)(7,"button",77),s(8,"\u0110\u1ED3ng \xDD"),r(),n(9,"button",78),s(10,"Hu\u1EF7 B\u1ECF"),r()()()())}function Ye(a,e){if(a&1&&(n(0,"div",81),P(1,"mat-progress-bar",87),n(2,"div",88),s(3),r()()),a&2){let t=h(2);l(),p("value",t.importProgress),l(2),_("",t.importProgress,"% Complete")}}function Ze(a,e){if(a&1){let t=k();n(0,"mat-dialog-content")(1,"div",79)(2,"div",80),s(3,"Import Excel File"),r(),n(4,"div",81)(5,"input",82),g("change",function(o){u(t);let c=h();return d(c.onFileSelected(o))}),r()(),C(6,Ye,4,2,"div",83),n(7,"div",84)(8,"button",85),g("click",function(){u(t);let o=h();return d(o.startImport())}),s(9," Start Import "),r(),n(10,"button",86),s(11,"Cancel"),r()()()()}if(a&2){let t=h();l(6),p("ngIf",t.importProgress>0),l(2),p("disabled",!t.selectedFile||t.importProgress>0)}}function ti(a,e){if(a&1&&(n(0,"div",81),P(1,"mat-progress-bar",87),n(2,"div",88),s(3),r()()),a&2){let t=h(2);l(),p("value",t.exportProgress),l(2),_("",t.exportProgress,"% Complete")}}function ei(a,e){if(a&1){let t=k();n(0,"mat-dialog-content")(1,"div",79)(2,"div",80),s(3,"Export to Excel"),r(),n(4,"div",81)(5,"mat-form-field",89)(6,"mat-label"),s(7,"Export Type"),r(),n(8,"mat-select",90),F("valueChange",function(o){u(t);let c=h();return D(c.exportType,o)||(c.exportType=o),d(o)}),n(9,"mat-option",91),s(10,"All Data"),r(),n(11,"mat-option",92),s(12,"Filtered Data"),r(),n(13,"mat-option",93),s(14,"Selected Items"),r()()()(),C(15,ti,4,2,"div",83),n(16,"div",84)(17,"button",85),g("click",function(){u(t);let o=h();return d(o.startExport())}),s(18," Start Export "),r(),n(19,"button",86),s(20,"Cancel"),r()()()()}if(a&2){let t=h();l(8),T("value",t.exportType),l(7),p("ngIf",t.exportProgress>0),l(2),p("disabled",t.exportProgress>0)}}function ii(a,e){if(a&1){let t=k();n(0,"div",81)(1,"mat-form-field",89)(2,"mat-label"),s(3,"Backup Type"),r(),n(4,"mat-select",90),F("valueChange",function(o){u(t);let c=h(2);return D(c.backupType,o)||(c.backupType=o),d(o)}),n(5,"mat-option",94),s(6,"Full Backup"),r(),n(7,"mat-option",95),s(8,"Incremental Backup"),r()()(),n(9,"mat-form-field",89)(10,"mat-label"),s(11,"Backup Name"),r(),n(12,"input",96),F("ngModelChange",function(o){u(t);let c=h(2);return D(c.backupName,o)||(c.backupName=o),d(o)}),r()()()}if(a&2){let t=h(2);l(4),T("value",t.backupType),l(8),T("ngModel",t.backupName)}}function oi(a,e){if(a&1){let t=k();n(0,"div",81)(1,"input",97),g("change",function(o){u(t);let c=h(2);return d(c.onBackupFileSelected(o))}),r()()}}function ni(a,e){if(a&1&&(n(0,"div",81),P(1,"mat-progress-bar",87),n(2,"div",88),s(3),r()()),a&2){let t=h(2);l(),p("value",t.backupProgress),l(2),_("",t.backupProgress,"% Complete")}}function ai(a,e){if(a&1){let t=k();n(0,"mat-dialog-content")(1,"div",79)(2,"div",80),s(3),r(),C(4,ii,13,2,"div",83)(5,oi,2,0,"div",83)(6,ni,4,2,"div",83),n(7,"div",84)(8,"button",85),g("click",function(){u(t);let o=h();return d(o.isRestoreMode?o.startRestore():o.startBackup())}),s(9),r(),n(10,"button",86),s(11,"Cancel"),r()()()()}if(a&2){let t=h();l(3),b(t.isRestoreMode?"Restore Data":"Create Backup"),l(),p("ngIf",!t.isRestoreMode),l(),p("ngIf",t.isRestoreMode),l(),p("ngIf",t.backupProgress>0),l(2),p("disabled",t.backupProgress>0||t.isRestoreMode&&!t.selectedBackupFile||!t.isRestoreMode&&!t.backupName),l(),_(" ",t.isRestoreMode?"Start Restore":"Start Backup"," ")}}function ri(a,e){if(a&1&&(n(0,"div",101)(1,"div",102)(2,"span",103),s(3,"Database"),r(),n(4,"div",104)(5,"mat-icon",105),s(6),r(),n(7,"span",106),s(8),r()()(),n(9,"div",102)(10,"span",103),s(11,"API Server"),r(),n(12,"div",104)(13,"mat-icon",105),s(14),r(),n(15,"span",106),s(16),r()()(),n(17,"div",102)(18,"span",103),s(19,"Memory Usage"),r(),n(20,"div",104)(21,"mat-icon",105),s(22),r(),n(23,"span",106),s(24),r()()(),n(25,"div",107)(26,"span",103),s(27,"Last Check"),r(),n(28,"span",106),s(29),R(30,"date"),r()()()),a&2){let t=h(2);l(),p("ngClass",t.healthCheck.database.status==="healthy"?"bg-green-50":"bg-red-50"),l(4),p("ngClass",t.healthCheck.database.status==="healthy"?"text-green-500":"text-red-500"),l(),_(" ",t.healthCheck.database.status==="healthy"?"check_circle":"error"," "),l(2),_("",t.healthCheck.database.responseTime,"ms"),l(),p("ngClass",t.healthCheck.api.status==="healthy"?"bg-green-50":"bg-red-50"),l(4),p("ngClass",t.healthCheck.api.status==="healthy"?"text-green-500":"text-red-500"),l(),_(" ",t.healthCheck.api.status==="healthy"?"check_circle":"error"," "),l(2),_("",t.healthCheck.api.responseTime,"ms"),l(),p("ngClass",t.healthCheck.memory.status==="healthy"?"bg-green-50":"bg-yellow-50"),l(4),p("ngClass",t.healthCheck.memory.status==="healthy"?"text-green-500":"text-yellow-500"),l(),_(" ",t.healthCheck.memory.status==="healthy"?"check_circle":"warning"," "),l(2),_("",t.healthCheck.memory.usage,"%"),l(5),b(z(30,13,t.healthCheck.timestamp,"dd/MM/yyyy HH:mm:ss"))}}function si(a,e){if(a&1){let t=k();n(0,"mat-dialog-content")(1,"div",98)(2,"div",80),s(3,"System Health Status"),r(),C(4,ri,31,16,"div",99),n(5,"div",84)(6,"button",100),g("click",function(){u(t);let o=h();return d(o.checkSystemHealth())}),s(7," Refresh Status "),r(),n(8,"button",86),s(9,"Close"),r()()()()}if(a&2){let t=h();l(4),p("ngIf",t.healthCheck)}}function li(a,e){if(a&1&&(n(0,"div",108)(1,"h2",109),s(2,"X\xE1c nh\u1EADn x\xF3a"),r(),n(3,"p",110),s(4),r(),n(5,"div",111)(6,"button",77),s(7,"X\xE1c nh\u1EADn"),r(),n(8,"button",78),s(9,"H\u1EE7y b\u1ECF"),r()()()),a&2){let t=h();l(4),_(" B\u1EA1n c\xF3 ch\u1EAFc ch\u1EAFn mu\u1ED1n x\xF3a ",t.EditList.length," m\u1EE5c \u0111\xE3 ch\u1ECDn kh\xF4ng? H\xE0nh \u0111\u1ED9ng n\xE0y kh\xF4ng th\u1EC3 ho\xE0n t\xE1c. ")}}var I=class I{displayedColumns=[];ColumnName={stt:"#",codeId:"M\xE3 ch\u1ED1t kho",title:"Ti\xEAu \u0111\u1EC1",khoId:"Kho",ngaychot:"Ng\xE0y ch\u1ED1t",ghichu:"Ghi ch\xFA",isActive:"Tr\u1EA1ng th\xE1i",createdAt:"Ng\xE0y t\u1EA1o",order:"Th\u1EE9 t\u1EF1",details:"S\u1ED1 SP"};FilterColumns=JSON.parse(localStorage.getItem("ChotkhoColFilter")||"[]");Columns=[];paginator;sort;drawer;_ChotkhoService=y(W);_breakpointObserver=y(ht);_router=y(ct);_dialog=y(Tt);_snackBar=y($);Listchotkho=this._ChotkhoService.ListChotkho;page=this._ChotkhoService.page;totalPages=this._ChotkhoService.totalPages;total=this._ChotkhoService.total;pageSize=this._ChotkhoService.pageSize;chotkhoId=this._ChotkhoService.chotkhoId;isLoading=this._ChotkhoService.isLoading;isRefreshing=this._ChotkhoService.isRefreshing;lastUpdated=this._ChotkhoService.lastUpdated;dataSource=new G([]);EditList=[];isSearch=f(!1);searchParam={};performanceMetrics=f({loadTime:0,renderTime:0,totalItems:0,lastRefresh:null});selectedFile=null;selectedBackupFile=null;exportType="all";backupType="full";backupName="";isRestoreMode=!1;importProgress=0;exportProgress=0;backupProgress=0;healthCheck=null;constructor(){it(()=>{let e=performance.now();this.dataSource.data=this.Listchotkho(),this.dataSource.sort=this.sort,this.paginator&&(this.paginator.pageIndex=this.page()-1,this.paginator.pageSize=this.pageSize(),this.paginator.length=this.total());let t=performance.now();this.performanceMetrics.update(i=>S(v({},i),{renderTime:t-e,totalItems:this.Listchotkho().length,lastRefresh:new Date}))})}ngOnInit(){return m(this,null,function*(){let e=performance.now();yield this._ChotkhoService.getAllChotkho(this.searchParam),this.displayedColumns=Object.keys(this.ColumnName),this.dataSource=new G(this.Listchotkho()),this.dataSource.sort=this.sort,this.initializeColumns(),this.setupDrawer();let t=performance.now();this.performanceMetrics.update(i=>S(v({},i),{loadTime:t-e}))})}initializeColumns(){this.Columns=Object.entries(this.ColumnName).map(([e,t])=>({key:e,value:t,isShow:!0})),this.FilterColumns=this.FilterColumns.length?this.FilterColumns:this.Columns,localStorage.setItem("ChotkhoColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,{key:t,value:i,isShow:o})=>o?S(v({},e),{[t]:i}):e,{})}applyFilter(e){let t=e.target.value;this.dataSource.filter=t.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}getUpdatedCodeIds(){return m(this,null,function*(){yield this._ChotkhoService.getUpdatedCodeIds()})}setupDrawer(){this._breakpointObserver.observe([mt.Handset]).subscribe(e=>{e.matches?this.drawer.mode="over":this.drawer.mode="over"})}toggleColumn(e){let t=this.FilterColumns.find(i=>i.key===e.key);t&&(t.isShow=!t.isShow)}FilterHederColumn(e,t){return e.filter((o,c,x)=>c===x.findIndex(ke=>ke[t]===o[t]))}ListFilter=[];onOutFilter(e){this.dataSource.data=e,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("ChotkhoColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(i=>i.value.toLowerCase().includes(t))}create(){this.drawer.open(),this._router.navigate(["admin/chotkho","new"])}CheckSelect(e){return!!this.EditList.some(t=>t.id===e.id)}openDeleteDialog(e){this._dialog.open(e,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(i=>{i==="true"&&this.DeleteListItem()})}DeleteListItem(){return m(this,null,function*(){if(!this.EditList?.length){this._snackBar.open("Kh\xF4ng c\xF3 m\u1EE5c n\xE0o \u0111\u01B0\u1EE3c ch\u1ECDn \u0111\u1EC3 x\xF3a","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}this.isLoading.set(!0);try{let e=0,t=0;for(let i of this.EditList)try{yield this._ChotkhoService.deleteChotkho(i.id),e++}catch(o){console.error("Error deleting item:",o),t++}this._snackBar.open(`X\xF3a th\xE0nh c\xF4ng ${e} ch\u1ED7 kho${t>0?`, ${t} l\u1ED7i`:""}`,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.EditList=[],yield this._ChotkhoService.getAllChotkho(this.searchParam)}catch(e){console.error("Error during bulk delete:",e),this._snackBar.open(`L\u1ED7i khi x\xF3a: ${e.message}`,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isLoading.set(!1)}})}AddToEdit(e){this.EditList.find(i=>i.id===e.id)?this.EditList=this.EditList.filter(i=>i.id!==e.id):this.EditList.push(e)}CheckItemInEdit(e){return this.EditList.some(t=>t.id===e.id)}goToDetail(e){this.drawer.open(),this._ChotkhoService.setChotkhoId(e.id),this._router.navigate(["admin/chotkho",e.id])}trackByFn(e,t){return t.id}generateReport(){return m(this,null,function*(){if(yield this._ChotkhoService.getStatistics()){let t=yield this._ChotkhoService.generateReport({dateFrom:new Date(Date.now()-2592e6).toISOString(),dateTo:new Date().toISOString(),format:"json"});if(t){this._snackBar.open("B\xE1o c\xE1o \u0111\xE3 \u0111\u01B0\u1EE3c t\u1EA1o th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});let i=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=window.URL.createObjectURL(i),c=document.createElement("a");c.href=o,c.download=`bao-cao-chot-kho-${new Date().toISOString().split("T")[0]}.json`,c.click(),window.URL.revokeObjectURL(o)}}})}bulkUpdateStatus(e){return m(this,null,function*(){if(this.EditList.length===0){this._snackBar.open("Vui l\xF2ng ch\u1ECDn \xEDt nh\u1EA5t m\u1ED9t m\u1EE5c","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let t=this.EditList.map(o=>o.id);(yield this._ChotkhoService.bulkUpdateStatus(t,e))&&(this.EditList=[],this._snackBar.open(`C\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i th\xE0nh c\xF4ng cho ${t.length} m\u1EE5c`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}))})}showStatistics(){return m(this,null,function*(){let e=yield this._ChotkhoService.getStatistics();if(e){let t=`
        T\u1ED5ng s\u1ED1: ${e.total}
        \u0110ang ho\u1EA1t \u0111\u1ED9ng: ${e.active}
        Kh\xF4ng ho\u1EA1t \u0111\u1ED9ng: ${e.inactive}
        Ch\xEAnh l\u1EC7ch trung b\xECnh: ${e.averageChenhLech?.toFixed(3)||0}
      `;this._snackBar.open(t,"\u0110\xF3ng",{duration:5e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-info"]})}})}advancedSearch(e){return m(this,null,function*(){this.searchParam=v(v({},this.searchParam),e),yield this._ChotkhoService.getAllChotkho(this.searchParam)})}refreshData(){return m(this,null,function*(){this.isSearch.set(!1),this.searchParam={},this.EditList=[],yield this._ChotkhoService.getAllChotkho(),this._snackBar.open("D\u1EEF li\u1EC7u \u0111\xE3 \u0111\u01B0\u1EE3c l\xE0m m\u1EDBi","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}smartRefresh(){return m(this,null,function*(){this.isSearch.set(!1),this.searchParam={},this.EditList=[];let e=this._snackBar.open("\u0110ang c\u1EADp nh\u1EADt d\u1EEF li\u1EC7u...","",{duration:0,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-info"]});try{yield this._ChotkhoService.getAllChotkho(),e.dismiss(),this._snackBar.open("D\u1EEF li\u1EC7u \u0111\xE3 \u0111\u01B0\u1EE3c c\u1EADp nh\u1EADt","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{e.dismiss(),this._snackBar.open("L\u1ED7i c\u1EADp nh\u1EADt d\u1EEF li\u1EC7u","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}importExcel(e){return m(this,null,function*(){let t=e.target.files[0];if(!t)return;let i=this._snackBar.open("\u0110ang import d\u1EEF li\u1EC7u...","",{duration:0,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-info"]});try{let o=yield this._ChotkhoService.importFromExcel(t,{validateData:!0,skipDuplicates:!0});i.dismiss(),o&&this._snackBar.open(`Import th\xE0nh c\xF4ng ${o.successCount}/${o.totalCount} b\u1EA3n ghi`,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{i.dismiss(),this._snackBar.open("L\u1ED7i import file","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}e.target.value=""})}createBackup(e="full"){return m(this,null,function*(){let t=this._snackBar.open("\u0110ang t\u1EA1o backup...","",{duration:0,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-info"]});try{let i=yield this._ChotkhoService.backupData(e);t.dismiss(),i&&this._snackBar.open("Backup th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{t.dismiss(),this._snackBar.open("L\u1ED7i t\u1EA1o backup","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}optimizeSystem(){return m(this,null,function*(){let e=this._snackBar.open("\u0110ang t\u1ED1i \u01B0u h\xF3a h\u1EC7 th\u1ED1ng...","",{duration:0,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-info"]});try{let t=yield this._ChotkhoService.optimizePerformance();e.dismiss(),t&&this._snackBar.open("T\u1ED1i \u01B0u h\xF3a th\xE0nh c\xF4ng! C\u1EA3i thi\u1EC7n hi\u1EC7u su\u1EA5t","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{e.dismiss(),this._snackBar.open("L\u1ED7i t\u1ED1i \u01B0u h\xF3a","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}checkSystemHealth(){return m(this,null,function*(){try{let e=yield this._ChotkhoService.getSystemHealth();if(e){let t=`
\u{1F3E5} S\u1EE8C KH\u1ECEE H\u1EC6 TH\u1ED0NG:
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
\u{1F4BE} Database: ${e.database?.status||"OK"}
\u{1F504} API: ${e.api?.responseTime||"< 100"}ms
\u{1F4CA} Memory: ${e.memory?.usage||"< 80"}%
\u{1F50B} CPU: ${e.cpu?.usage||"< 60"}%
\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501
        `;this._snackBar.open(t,"\u0110\xF3ng",{duration:8e3,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-info"]})}}catch{this._snackBar.open("Kh\xF4ng th\u1EC3 ki\u1EC3m tra s\u1EE9c kh\u1ECFe h\u1EC7 th\u1ED1ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}downloadImportTemplate(e="standard"){return m(this,null,function*(){try{(yield this._ChotkhoService.generateImportTemplate(e))&&this._snackBar.open("\u0110\xE3 t\u1EA3i xu\u1ED1ng m\u1EABu import","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{this._snackBar.open("L\u1ED7i t\u1EA3i m\u1EABu import","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}exportAdvanced(e="excel"){return m(this,null,function*(){let t=this._snackBar.open(`\u0110ang export ${e.toUpperCase()}...`,"",{duration:0,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-info"]});try{let i=yield this._ChotkhoService.exportData(e,S(v({},this.searchParam),{selectedIds:this.EditList.map(o=>o.id),includeDetails:!0}));t.dismiss(),i&&this._snackBar.open(`Export ${e.toUpperCase()} th\xE0nh c\xF4ng`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{t.dismiss(),this._snackBar.open(`L\u1ED7i export ${e.toUpperCase()}`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}smartCheckChenhLech(){return m(this,null,function*(){if(!this.validateBeforeAction(this.EditList,"ki\u1EC3m tra ch\xEAnh l\u1EC7ch"))return;let e=this._snackBar.open("\u0110ang ki\u1EC3m tra ch\xEAnh l\u1EC7ch...","",{duration:0,horizontalPosition:"center",verticalPosition:"top",panelClass:["snackbar-info"]});try{let t=[];for(let o of this.EditList){let c=yield this._ChotkhoService.smartCheckChenhLech(o.id);c&&t.push(c)}e.dismiss();let i=t.reduce((o,c)=>o+(c.chenhLech||0),0);this._snackBar.open(`Ki\u1EC3m tra ho\xE0n t\u1EA5t. T\u1ED5ng ch\xEAnh l\u1EC7ch: ${i}`,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:i===0?["snackbar-success"]:["snackbar-warning"]}),yield this.smartRefresh()}catch(t){e.dismiss(),this.handleOperationError("ki\u1EC3m tra ch\xEAnh l\u1EC7ch",t)}})}handleOperationError(e,t){console.error(`L\u1ED7i ${e}:`,t),this._snackBar.open(`C\xF3 l\u1ED7i x\u1EA3y ra khi ${e}`,"Th\u1EED l\u1EA1i",{duration:5e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}).onAction().subscribe(()=>{this.smartRefresh()})}validateBeforeAction(e,t){return e.length===0?(this._snackBar.open(`Vui l\xF2ng ch\u1ECDn \xEDt nh\u1EA5t m\u1ED9t m\u1EE5c \u0111\u1EC3 ${t}`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]}),!1):!0}onPageSizeChange(e,t){let i=this.total(),o=e>i?i:e;e>i&&this._snackBar.open(`S\u1ED1 l\u01B0\u1EE3ng t\u1ED1i \u0111a ${i}`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]}),this._ChotkhoService.pageSize.set(o),this._ChotkhoService.page.set(1),this._ChotkhoService.getAllChotkho(this.searchParam),t.closeMenu()}onPreviousPage(){return m(this,null,function*(){this.page()>1&&(this._ChotkhoService.page.set(this.page()-1),yield this._ChotkhoService.getAllChotkho(this.searchParam))})}onNextPage(){return m(this,null,function*(){this.page()<this.totalPages()&&(this._ChotkhoService.page.set(this.page()+1),yield this._ChotkhoService.getAllChotkho(this.searchParam))})}onFileSelected(e){let t=e.target.files[0];t&&(t.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||t.type==="application/vnd.ms-excel")?this.selectedFile=t:this._snackBar.open("Please select a valid Excel file (.xlsx or .xls)","Close",{duration:3e3})}onBackupFileSelected(e){let t=e.target.files[0];t&&t.name.endsWith(".backup")?this.selectedBackupFile=t:this._snackBar.open("Please select a valid backup file (.backup)","Close",{duration:3e3})}startImport(){return m(this,null,function*(){if(!this.selectedFile)return;this.importProgress=0;let e=setInterval(()=>{this.importProgress+=5,this.importProgress>=95&&clearInterval(e)},100);try{yield this._ChotkhoService.importFromExcel(this.selectedFile,{}),this.importProgress=100,setTimeout(()=>{this.importProgress=0,this.selectedFile=null,this._dialog.closeAll()},500)}catch(t){clearInterval(e),this.importProgress=0,this.handleOperationError("Import failed",t)}})}startExport(){return m(this,null,function*(){this.exportProgress=0;let e=setInterval(()=>{this.exportProgress+=8,this.exportProgress>=95&&clearInterval(e)},150);try{yield this.exportExcel(),this.exportProgress=100,setTimeout(()=>{this.exportProgress=0,this._dialog.closeAll()},500)}catch(t){clearInterval(e),this.exportProgress=0,this.handleOperationError("Export failed",t)}})}startBackup(){return m(this,null,function*(){if(!this.backupName){this._snackBar.open("Please enter a backup name","Close",{duration:3e3});return}this.backupProgress=0;let e=setInterval(()=>{this.backupProgress+=6,this.backupProgress>=95&&clearInterval(e)},200);try{yield this._ChotkhoService.backupData(this.backupType),this.backupProgress=100,setTimeout(()=>{this.backupProgress=0,this.backupName="",this._dialog.closeAll()},500)}catch(t){clearInterval(e),this.backupProgress=0,this.handleOperationError("Backup failed",t)}})}startRestore(){return m(this,null,function*(){if(!this.selectedBackupFile){this._snackBar.open("Please select a backup file","Close",{duration:3e3});return}this.backupProgress=0;let e=setInterval(()=>{this.backupProgress+=7,this.backupProgress>=95&&clearInterval(e)},180);try{yield this._ChotkhoService.restoreFromBackup(this.selectedBackupFile),this.backupProgress=100,setTimeout(()=>{this.backupProgress=0,this.selectedBackupFile=null,this._dialog.closeAll()},500)}catch(t){clearInterval(e),this.backupProgress=0,this.handleOperationError("Restore failed",t)}})}exportExcel(){return m(this,null,function*(){try{let e=[];switch(this.exportType){case"all":e=this.Listchotkho();break;case"filtered":e=this.dataSource.filteredData;break;case"selected":e=this.EditList;break;default:e=this.Listchotkho()}yield this._ChotkhoService.exportData("excel",{data:e}),this._snackBar.open("Export completed successfully","Close",{duration:3e3})}catch(e){this.handleOperationError("Export failed",e)}})}clearAllCacheMethod(){return m(this,null,function*(){try{if("caches"in window){let t=yield caches.keys();yield Promise.all(t.map(i=>caches.delete(i)))}Object.keys(localStorage).forEach(t=>{(t.includes("chotkho")||t.includes("Chotkho"))&&localStorage.removeItem(t)}),yield this.smartRefresh(),this._snackBar.open("Cache cleared successfully","Close",{duration:3e3})}catch(e){this.handleOperationError("Clear cache failed",e)}})}importFromExcel(){let e=document.createElement("input");e.type="file",e.accept=".xlsx,.xls",e.onchange=t=>this.importExcel(t),e.click()}exportToExcel(){this.exportAdvanced("excel")}restoreFromBackup(){this.isRestoreMode=!0;let e=document.createElement("input");e.type="file",e.accept=".backup",e.onchange=t=>{this.onBackupFileSelected(t),this.selectedBackupFile&&this.startRestore()},e.click()}clearAllCache(){this.clearAllCacheMethod()}ToggleAll(){this.EditList.length===this.dataSource.filteredData.length?this.EditList=[]:this.EditList=[...this.dataSource.filteredData]}static \u0275fac=function(t){return new(t||I)};static \u0275cmp=Q({type:I,selectors:[["app-listchotkho"]],viewQuery:function(t,i){if(t&1&&(B(jt,5),B(N,5),B(ye,7)),t&2){let o;A(o=V())&&(i.paginator=o.first),A(o=V())&&(i.sort=o.first),A(o=V())&&(i.drawer=o.first)}},decls:82,vars:20,consts:[["drawer",""],["menuHienthi","matMenuTrigger"],["menu1","matMenu"],["DeleteDialog",""],["ImportDialog",""],["ExportDialog",""],["BackupDialog",""],["HealthDialog",""],["menu","matMenu"],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-16","w-full","p-2"],[1,"p-2","cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","bg-white","rounded-lg"],[1,"w-full","flex","flex-col","gap-2","lg:flex-row","lg:items-center","lg:justify-between"],[1,"flex","flex-row","space-x-2","items-center"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],["color","primary","matTooltip","Th\xEAm m\u1EDBi","mat-flat-button","",1,"flex","flex-row","items-center",3,"click"],[1,"whitespace-nowrap"],["color","accent","matTooltip","Ch\u1ECDn/B\u1ECF ch\u1ECDn t\u1EA5t c\u1EA3","mat-flat-button","",1,"flex","flex-row","items-center",3,"click"],["class","flex flex-row items-center","color","warn","matTooltip","Xo\xE1","mat-flat-button","",3,"disabled","click",4,"ngIf"],["color","accent","matTooltip","Smart Refresh","mat-flat-button","",1,"flex","flex-row","items-center",3,"click","disabled"],[1,"w-full","flex","flex-row","space-x-4","justify-end","items-center"],[1,"flex","items-center","text-center"],[1,"flex","items-center","justify-center"],[1,"flex","flex-row","space-x-2","justify-center","items-center"],[1,"font-bold","text-blue-600",3,"matMenuTriggerFor"],[1,"w-full","flex","flex-row","space-x-2","p-4",3,"click"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp S\u1ED1 L\u01B0\u1EE3ng",3,"ngModelChange","ngModel","ngModelOptions"],["mat-icon-button","","color","primary",3,"click"],[1,"flex","flex-row","items-center"],["mat-icon-button","","color","primary",3,"click","disabled"],[1,"w-full","h-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["class","border","mat-row","",3,"class","click",4,"matRowDef","matRowDefColumns"],["class","mat-row border",4,"matNoDataRow"],["color","warn","matTooltip","Xo\xE1","mat-flat-button","",1,"flex","flex-row","items-center",3,"click","disabled"],[1,"animate-spin"],["mat-header-cell","",1,"flex","!border","!bg-slate-100","justify-center"],["mat-header-cell","","mat-sort-header","",1,"!border","whitespace-nowrap","!bg-slate-100"],["class","border","mat-cell","",4,"matCellDef"],["class","flex !border !bg-slate-100 justify-center","mat-header-cell","",4,"matHeaderCellDef"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary",3,"matMenuTriggerFor"],[1,"flex","flex-row","space-x-2","items-center","p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item","",3,"disabled"],["mat-menu-item",""],["mat-menu-item","",3,"click","disabled"],["mat-menu-item","",3,"click"],["class","!border whitespace-nowrap !bg-slate-100","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],[1,"max-w-40","line-clamp-4","me-4"],[3,"OutFilter","icon","ListItem","fieldsearch","ListFilter","filterItem"],["mat-cell","",1,"border"],[1,"max-w-40","line-clamp-4","font-bold","text-blue-600"],[1,"flex","justify-center","items-center","font-bold","text-blue-600"],[1,"max-w-40","line-clamp-4"],[1,"max-w-40","line-clamp-4","text-center"],[1,"max-w-40","line-clamp-4","font-bold","text-blue-600",3,"click"],[1,"flex","justify-center","items-center","font-bold","text-blue-600",3,"click"],[1,"bg-blue-100","text-blue-800"],[1,"text-green-500"],[1,"text-red-500"],["mat-header-row",""],["mat-row","",1,"border",3,"click"],[1,"mat-row","border"],["colspan","4",1,"mat-cell","p-4"],[1,"flex","flex-col","space-y-8","items-center","justify-center"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary","mat-dialog-close","true"],["mat-flat-button","","color","warn","mat-dialog-close","false"],[1,"flex","flex-col","space-y-4","min-w-80"],[1,"font-bold","text-center"],[1,"flex","flex-col","space-y-2"],["type","file","accept",".xlsx,.xls",1,"block","w-full","text-sm","text-gray-500","file:mr-4","file:py-2","file:px-4","file:rounded-full","file:border-0","file:text-sm","file:font-semibold","file:bg-blue-50","file:text-blue-700","hover:file:bg-blue-100",3,"change"],["class","flex flex-col space-y-2",4,"ngIf"],[1,"flex","flex-row","space-x-2","justify-center"],["mat-flat-button","","color","primary",3,"click","disabled"],["mat-flat-button","","color","warn","mat-dialog-close",""],["mode","determinate",3,"value"],[1,"text-sm","text-center"],["appearance","outline"],[3,"valueChange","value"],["value","all"],["value","filtered"],["value","selected"],["value","full"],["value","incremental"],["matInput","","placeholder","Enter backup name",3,"ngModelChange","ngModel"],["type","file","accept",".backup",1,"block","w-full","text-sm","text-gray-500","file:mr-4","file:py-2","file:px-4","file:rounded-full","file:border-0","file:text-sm","file:font-semibold","file:bg-green-50","file:text-green-700","hover:file:bg-green-100",3,"change"],[1,"flex","flex-col","space-y-4","min-w-96"],["class","flex flex-col space-y-3",4,"ngIf"],["mat-flat-button","","color","primary",3,"click"],[1,"flex","flex-col","space-y-3"],[1,"flex","justify-between","items-center","p-2","rounded",3,"ngClass"],[1,"font-medium"],[1,"flex","items-center","space-x-2"],[3,"ngClass"],[1,"text-sm"],[1,"flex","justify-between","items-center","p-2","rounded","bg-blue-50"],[1,"p-6"],[1,"text-xl","font-semibold","text-gray-800","mb-4"],[1,"text-gray-600","mb-6"],[1,"flex","flex-row","space-x-3","justify-end"]],template:function(t,i){if(t&1){let o=k();n(0,"mat-drawer-container",9)(1,"mat-drawer",10,0),P(3,"router-outlet"),r(),n(4,"div",11)(5,"div",12)(6,"div",13)(7,"div",14)(8,"div",15)(9,"input",16),g("keyup",function(x){return u(o),d(i.applyFilter(x))}),r(),n(10,"div",17)(11,"span",18),s(12,"search"),r()()(),n(13,"button",19),g("click",function(){return u(o),d(i.create())}),n(14,"mat-icon"),s(15,"add_circle"),r(),n(16,"span",20),s(17,"T\u1EA1o M\u1EDBi"),r()(),n(18,"button",21),g("click",function(){return u(o),d(i.ToggleAll())}),n(19,"mat-icon"),s(20,"checklist"),r(),n(21,"span",20),s(22),r()(),C(23,Ee,5,3,"button",22),n(24,"button",23),g("click",function(){return u(o),d(i.smartRefresh())}),n(25,"mat-icon"),s(26,"refresh"),r(),n(27,"span",20),s(28,"Refresh"),r()()()(),n(29,"div",24)(30,"div",25)(31,"strong"),s(32),r(),s(33," - "),n(34,"strong"),s(35),r(),s(36),r(),n(37,"div",26)(38,"span"),s(39),r(),n(40,"span"),s(41,"Trang"),r()(),n(42,"div",27)(43,"span",28,1),s(45),r(),n(46,"mat-menu",null,2)(48,"div",29),g("click",function(x){return u(o),d(x.stopPropagation())}),n(49,"mat-form-field",30)(50,"mat-label"),s(51,"S\u1ED1 l\u01B0\u1EE3ng"),r(),n(52,"input",31),F("ngModelChange",function(x){return u(o),D(i.pageSize,x)||(i.pageSize=x),d(x)}),r()(),n(53,"button",32),g("click",function(){u(o);let x=M(44);return d(i.onPageSizeChange(i.pageSize(),x))}),n(54,"mat-icon"),s(55,"published_with_changes"),r()()()(),n(56,"div",33)(57,"button",34),g("click",function(){return u(o),d(i.onPreviousPage())}),n(58,"mat-icon"),s(59,"keyboard_arrow_left"),r()(),n(60,"button",34),g("click",function(){return u(o),d(i.onNextPage())}),n(61,"mat-icon"),s(62,"keyboard_arrow_right"),r()()()()()(),n(63,"div",35)(64,"table",36),U(65,Ge,4,2,"ng-container",37,J),C(67,Ke,1,0,"tr",38)(68,Qe,1,3,"tr",39)(69,Xe,3,0,"tr",40),r()()()(),C(70,Je,11,0,"ng-template",null,3,E)(72,Ze,12,2,"ng-template",null,4,E)(74,ei,21,3,"ng-template",null,5,E)(76,ai,12,6,"ng-template",null,6,E)(78,si,10,1,"ng-template",null,7,E)(80,li,10,1,"ng-template",null,3,E)}if(t&2){let o=M(47);l(),p("position","end"),l(21),b(i.EditList.length>0?"B\u1ECF ch\u1ECDn":"Ch\u1ECDn t\u1EA5t c\u1EA3"),l(),p("ngIf",i.EditList.length>0),l(),p("disabled",i.isRefreshing),l(8),b((i.page()-1)*i.pageSize()+1),l(3),b(i.page()*i.pageSize()>i.total()?i.total():i.page()*i.pageSize()),l(),_(" / ",i.total()," m\u1EE5c "),l(3),tt("",i.page(),"/",i.totalPages()," "),l(4),p("matMenuTriggerFor",o),l(2),_("",i.pageSize()," m\u1EE5c"),l(7),T("ngModel",i.pageSize),p("ngModelOptions",et(19,ve)),l(5),p("disabled",i.page()===1),l(3),p("disabled",i.page()===i.totalPages()),l(4),p("dataSource",i.dataSource),l(),j(i.displayedColumns),l(2),p("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),l(),p("matRowDefColumns",i.displayedColumns)}},dependencies:[zt,Rt,At,Vt,Nt,$t,re,Qt,Jt,ee,Yt,Xt,ie,Zt,te,oe,ne,ae,Kt,N,Gt,qt,Et,St,bt,wt,xt,Ct,kt,lt,vt,yt,gt,ut,dt,Wt,Ot,pt,rt,ot,nt,at,Mt,Pt,It,Lt,Ut,Ht,Bt,Dt,Ft,me,he,se,pe,fe,_e,ge],encapsulation:2,changeDetection:0})};H([ce(500)],I.prototype,"applyFilter",1),H([le()],I.prototype,"FilterHederColumn",1);var Ce=I;export{W as a,Ce as b};
