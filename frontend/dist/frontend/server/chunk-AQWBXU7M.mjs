import './polyfills.server.mjs';
import{a as Yt}from"./chunk-GWTEWDV7.mjs";import{a as Wt,b as Zt}from"./chunk-C4XWPE4N.mjs";import{a as jt}from"./chunk-FSTJ6JSA.mjs";import{b as Tt,d as Et,e as Ft}from"./chunk-SWDJOT3A.mjs";import{a as Lt,b as kt,c as k,d as It,e as I,f as Dt,g as Vt,h as Nt,i as $t,j as At,k as Pt,l as Ot,m as Rt,n as zt,o as Ht,p as Qt,q as qt,r as Gt,s as Jt,t as Kt}from"./chunk-E4UQHXLJ.mjs";import{a as xt}from"./chunk-N7XIKENO.mjs";import{a as pt,b as ut,c as dt,d as gt}from"./chunk-LAITRYTJ.mjs";import{a as rt,b as lt,c as st}from"./chunk-V7YBM5HH.mjs";import{h as bt}from"./chunk-KRS63GVX.mjs";import{a as mt,b as ct}from"./chunk-TAON4PQZ.mjs";import{B as Bt,C as Mt,b as at,d as ot,f as _t,k as ft,n as Ct,r as ht,t as yt,u as wt,y as St,z as vt}from"./chunk-XIST6WNA.mjs";import{b as tt,d as et}from"./chunk-5LHJPPOW.mjs";import{L as it,M as nt}from"./chunk-OFGMSNZN.mjs";import{n as Z,o as Y,q as U,s as X}from"./chunk-NAZY24PF.mjs";import{Bb as O,Bc as A,Cc as c,Dc as L,Ec as C,Hc as J,Ib as w,Ic as K,Jc as j,Lc as P,Qc as B,Sc as M,Ub as _,Xb as R,Yb as z,_b as V,ac as H,bc as N,cc as $,dc as a,ec as r,fc as b,gc as Q,hc as q,jc as v,la as S,md as W,oc as f,pb as s,qc as l,ua as d,uc as G,va as g,wc as T,xc as E,yc as F}from"./chunk-5E4SNDDT.mjs";import{a as D,i as y}from"./chunk-AFOT676I.mjs";var ie=["drawer"],ne=()=>[5,10,25,100],ae=()=>({standalone:!0}),oe=(n,e)=>e.key;function re(n,e){if(n&1){let t=v();a(0,"button",30),f("click",function(o){let m=d(t).$implicit;return l().toggleColumn(m),g(o.stopPropagation())}),a(1,"mat-icon"),c(2),r(),a(3,"span"),c(4),r()()}if(n&2){let t=e.$implicit;s(2),L(t.isShow?"check_box":"check_box_outline_blank"),s(2),L(t.value)}}function le(n,e){if(n&1){let t=v();a(0,"mat-form-field",33)(1,"mat-label"),c(2),r(),a(3,"input",34),f("keyup",function(){d(t);let o=l(2);return g(o.applyFilter())}),j("ngModelChange",function(o){let m=d(t).$implicit,u=l(2);return K(u.filterValues[m],o)||(u.filterValues[m]=o),g(o)}),r()()}if(n&2){let t=e.$implicit,i=l(2);s(2),L(i.ColumnName[t]),s(),G("placeholder","Vui l\xF2ng Nh\u1EADp ",t,""),J("ngModel",i.filterValues[t]),_("ngModelOptions",P(5,ae))}}function se(n,e){if(n&1&&(a(0,"div",31),w(1,le,4,6,"mat-form-field",32),r()),n&2){let t=l();s(),_("ngForOf",t.displayedColumns)}}function me(n,e){if(n&1&&(a(0,"th",37)(1,"span",38),c(2),r()()),n&2){let t=l().$implicit,i=l();s(2),C(" ",i.ColumnName[t]," ")}}function ce(n,e){if(n&1&&(a(0,"span",40),c(1),r()),n&2){let t=l().index;s(),C(" ",t+1," ")}}function pe(n,e){if(n&1&&(a(0,"span",40),c(1),r()),n&2){let t=l().$implicit,i=l().$implicit;s(),C(" ",t[i].length," ")}}function ue(n,e){if(n&1&&(a(0,"span",40),c(1),r()),n&2){let t,i=l().$implicit,o=l().$implicit,m=l();s(),C(" ",(t=m.getName(m.ListStatus,"value",i[o]))==null?null:t.title," ")}}function de(n,e){if(n&1&&(a(0,"span",40),c(1),B(2,"date"),r()),n&2){let t=l().$implicit,i=l().$implicit;s(),C(" ",M(2,1,t[i],"dd/MM/yyyy")," ")}}function ge(n,e){if(n&1&&(a(0,"span",40),c(1),B(2,"date"),r()),n&2){let t=l().$implicit,i=l().$implicit;s(),C(" ",M(2,1,t[i],"dd/MM/yyyy")," ")}}function _e(n,e){if(n&1&&(a(0,"span",40),c(1),B(2,"date"),r()),n&2){let t=l().$implicit,i=l().$implicit;s(),C(" ",M(2,1,t[i],"dd/MM/yyyy")," ")}}function fe(n,e){n&1&&(a(0,"mat-icon",41),c(1,"check_circle"),r())}function Ce(n,e){n&1&&(a(0,"mat-icon",42),c(1,"cancel"),r())}function he(n,e){if(n&1&&(a(0,"span",40),w(1,fe,2,0,"mat-icon",41)(2,Ce,2,0,"mat-icon",42),r()),n&2){let t=l().$implicit,i=l().$implicit;s(),V(t[i]?1:2)}}function xe(n,e){if(n&1&&(a(0,"span",40),c(1),B(2,"date"),r()),n&2){let t=l().$implicit,i=l().$implicit;s(),C(" ",M(2,1,t[i],"dd/MM/yyyy")," ")}}function ye(n,e){if(n&1&&(a(0,"span",40),c(1),r()),n&2){let t=l().$implicit,i=l().$implicit;s(),C(" ",t[i]," ")}}function we(n,e){if(n&1&&(a(0,"td",39),w(1,ce,2,1,"span",40)(2,pe,2,1,"span",40)(3,ue,2,1,"span",40)(4,de,3,4,"span",40)(5,ge,3,4,"span",40)(6,_e,3,4,"span",40)(7,he,3,1,"span",40)(8,xe,3,4,"span",40)(9,ye,2,1,"span",40),r()),n&2){let t,i=l().$implicit;s(),V((t=i)==="STT"?1:t==="sanpham"?2:t==="status"?3:t==="batdau"?4:t==="ketthuc"?5:t==="createdAt"?6:t==="isActive"?7:t==="updatedAt"?8:9)}}function Se(n,e){if(n&1&&(Q(0,25),w(1,me,3,1,"th",35)(2,we,10,1,"td",36),q()),n&2){let t=e.$implicit;_("matColumnDef",t)}}function ve(n,e){n&1&&b(0,"tr",43)}function Be(n,e){if(n&1){let t=v();a(0,"tr",44),f("click",function(){let o=d(t).$implicit,m=l();return g(m.goToDetail(o))}),r()}if(n&2){let t=e.$implicit,i=l();z("hover:bg-slate-100 ",i.banggiaId()==t.id?"!bg-slate-200":"","")}}function Me(n,e){n&1&&(a(0,"tr",45)(1,"td",46),c(2,"Kh\xF4ng t\xECm th\u1EA5y"),r()())}var Ut=class n{Detail={};displayedColumns=["STT","title","type","sanpham","batdau","ketthuc","status","createdAt","updatedAt"];ColumnName={STT:"STT",title:"Ti\xEAu \u0110\u1EC1",type:"Lo\u1EA1i",sanpham:"S\u1EA3n Ph\u1EA9m",batdau:"B\u1EAFt \u0110\u1EA7u",ketthuc:"K\u1EBFt Th\xFAc",status:"T\xECnh Tr\u1EA1ng",createdAt:"Ng\xE0y T\u1EA1o",updatedAt:"Ng\xE0y C\u1EADp Nh\u1EADt"};FilterColumns=JSON.parse(localStorage.getItem("BanggiaColFilter")||"[]");Columns=[];isFilter=!1;ListStatus=[{value:"baogia",title:"B\xE1o Gi\xE1"},{value:"dangban",title:"\u0110ang B\xE1n"},{value:"ngungban",title:"Ng\u1EEBng B\xE1n"}];paginator;sort;drawer;filterValues={};_BanggiaService=S(Yt);_breakpointObserver=S(it);_GoogleSheetService=S(jt);_router=S(et);Listbanggia=this._BanggiaService.ListBanggia;dataSource=W(()=>{let e=new Kt(this.Listbanggia());return e.filterPredicate=this.createFilter(),e.paginator=this.paginator,e.sort=this.sort,e});banggiaId=this._BanggiaService.banggiaId;_snackBar=S(xt);CountItem=0;constructor(){this.displayedColumns.forEach(e=>{this.filterValues[e]=""})}createFilter(){return(e,t)=>{let i=JSON.parse(t),o=!0;return this.displayedColumns.forEach(m=>{if(i[m]){let u=e[m]?e[m].toString().toLowerCase():"";o=o&&u.includes(i[m].toLowerCase())}}),o}}applyFilter(){this.dataSource().filter=JSON.stringify(this.filterValues)}getName(e,t,i){return e.find(o=>o[t]===i)}ngOnInit(){return y(this,null,function*(){yield this._BanggiaService.getAllBanggia(),this.CountItem=this.Listbanggia().length,this.initializeColumns(),this.setupDrawer(),this.paginator._intl.itemsPerPageLabel="S\u1ED1 l\u01B0\u1EE3ng 1 trang",this.paginator._intl.nextPageLabel="Ti\u1EBFp Theo",this.paginator._intl.previousPageLabel="V\u1EC1 Tr\u01B0\u1EDBc",this.paginator._intl.firstPageLabel="Trang \u0110\u1EA7u",this.paginator._intl.lastPageLabel="Trang Cu\u1ED1i"})}refresh(){return y(this,null,function*(){yield this._BanggiaService.getAllBanggia()})}initializeColumns(){this.Columns=Object.keys(this.ColumnName).map(e=>({key:e,value:this.ColumnName[e],isShow:!0})),this.FilterColumns.length===0?this.FilterColumns=this.Columns:localStorage.setItem("BanggiaColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{})}setupDrawer(){this._breakpointObserver.observe([nt.Handset]).subscribe(e=>{e.matches?(this.drawer.mode="over",this.paginator.hidePageSize=!0):this.drawer.mode="side"})}toggleColumn(e){let t=this.FilterColumns.find(i=>i.key===e.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("BanggiaColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(i=>i.value.toLowerCase().includes(t))}create(){this.drawer.open(),this._router.navigate(["admin/banggia",0])}goToDetail(e){this._BanggiaService.setBanggiaId(e.id),this.drawer.open(),this._router.navigate(["admin/banggia",e.id])}LoadDrive(){return y(this,null,function*(){let e={IdSheet:"15npo25qyH5FmfcEjl1uyqqyFMS_vdFnmxM_kt0KYmZk",SheetName:"BGImport",ApiKey:"AIzaSyD33kgZJKdFpv1JrKHacjCQccL_O0a2Eao"},t=yield this._GoogleSheetService.getDrive(e),i=Tt(t.values);console.log(i)})}DoImportData(e){console.log(e);let i=e.map(p=>({title:p.title?.trim()||"",masp:p.masp?.trim()||"",slug:`${Et(p?.title?.trim()||"")}_${Ft(5,!1)}`,giagoc:Number(p.giagoc)||0,dvt:p.dvt||"",soluong:Number(p.soluong)||0,soluongkho:Number(p.soluongkho)||0,ghichu:p.ghichu||"",order:Number(p.order)||0})).filter((p,h,x)=>h===x.findIndex(ee=>ee.masp===p.masp)),o=i.map(p=>p.masp),m=this._BanggiaService.ListBanggia().map(p=>p.masp),u=o.filter(p=>!m.includes(p)),Xt=i.map(p=>y(this,null,function*(){let h=this._BanggiaService.ListBanggia().find(x=>x.masp===p.masp);if(h){let x=D(D({},h),p);yield this._BanggiaService.updateBanggia(x)}else yield this._BanggiaService.CreateBanggia(p)})),te=u.map(p=>y(this,null,function*(){let h=this._BanggiaService.ListBanggia().find(x=>x.masp===p);h&&(h.isActive=!1),yield this._BanggiaService.updateBanggia(h)}));Promise.all([...Xt,...te]).then(()=>{this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ImporExcel(e){return y(this,null,function*(){let t=yield Zt(e);this.DoImportData(t)})}ExportExcel(e,t){Wt(e,t)}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=O({type:n,selectors:[["app-listbanggia"]],viewQuery:function(t,i){if(t&1&&(T(k,5),T(I,5),T(ie,7)),t&2){let o;E(o=F())&&(i.paginator=o.first),E(o=F())&&(i.sort=o.first),E(o=F())&&(i.drawer=o.first)}},decls:48,vars:12,consts:[["drawer",""],["menu","matMenu"],["uploadfile",""],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-12","w-full","p-2"],[1,"cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","p-2","bg-white","rounded-lg"],[1,"flex","flex-row","space-x-2","items-center"],["matTooltip","Th\xEAm m\u1EDBi","color","primary","mat-icon-button","",3,"click"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["matTooltip","B\u1ED9 L\u1ECDc","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\u1EA3i file excel M\u1EABu","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\u1EA3i l\xEAn file excel","color","primary","mat-icon-button","",3,"click"],["type","file",1,"hidden",3,"change"],["matTooltip","T\u1EA3i d\u1EEF li\u1EC7u t\u1EEB drive","color","primary","mat-icon-button","",3,"click"],[1,"lg:flex","hidden","whitespace-nowrap","p-2","rounded-lg","bg-slate-200"],["class","w-full grid grid-cols-2 gap-2 lg:flex lg:flex-row lg:space-x-2 items-center",4,"ngIf"],[1,"w-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"class","click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSizeOptions"],["mat-menu-item","",3,"click"],[1,"w-full","grid","grid-cols-2","gap-2","lg:flex","lg:flex-row","lg:space-x-2","items-center"],["appearance","outline","subscriptSizing","dynamic",4,"ngFor","ngForOf"],["appearance","outline","subscriptSizing","dynamic"],["matInput","",3,"keyup","ngModelChange","ngModel","ngModelOptions","placeholder"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"max-w-40","line-clamp-4","me-4"],["mat-cell",""],[1,"max-w-40","line-clamp-4"],[1,"text-green-500"],[1,"text-red-500"],["mat-header-row",""],["mat-row","",3,"click"],[1,"mat-row"],["colspan","4",1,"mat-cell","p-4"]],template:function(t,i){if(t&1){let o=v();a(0,"mat-drawer-container",3)(1,"mat-drawer",4,0),b(3,"router-outlet"),r(),a(4,"div",5)(5,"div",6)(6,"div",7)(7,"button",8),f("click",function(){return d(o),g(i.create())}),a(8,"mat-icon"),c(9,"add_circle"),r()(),a(10,"button",9)(11,"mat-icon"),c(12,"tune"),r()(),a(13,"mat-menu",null,1)(15,"div",10)(16,"mat-form-field",11)(17,"input",12),f("input",function(u){return d(o),g(i.doFilterColumns(u))})("click",function(u){return d(o),g(u.stopPropagation())}),r(),a(18,"mat-icon",13),c(19,"search"),r()()(),a(20,"div",14),N(21,re,5,2,"button",15,oe),r()(),a(23,"button",16),f("click",function(){return d(o),g(i.isFilter=!i.isFilter)}),a(24,"mat-icon"),c(25,"filter_list"),r()(),a(26,"button",17),f("click",function(){return d(o),g(i.ExportExcel(i.Listbanggia(),"Banggia"))}),a(27,"mat-icon"),c(28,"file_download"),r()(),a(29,"button",18),f("click",function(){d(o);let u=A(33);return g(u.click())}),a(30,"mat-icon"),c(31,"file_upload"),r()(),a(32,"input",19,2),f("change",function(u){return d(o),g(i.ImporExcel(u))}),r(),a(34,"button",20),f("click",function(){return d(o),g(i.LoadDrive())}),a(35,"mat-icon"),c(36,"cloud_download"),r()(),a(37,"span",21),c(38),r()()(),w(39,se,2,1,"div",22),a(40,"div",23)(41,"table",24),N(42,Se,3,1,"ng-container",25,H),w(44,ve,1,0,"tr",26)(45,Be,1,3,"tr",27)(46,Me,3,0,"tr",28),r(),b(47,"mat-paginator",29),r()()()}if(t&2){let o=A(14);s(),_("position","end"),s(9),_("matMenuTriggerFor",o),s(11),$(i.FilterColumns),s(2),R(i.isFilter?"!bg-slate-200":""),s(15),C(" ",i.CountItem," B\u1EA3ng Gi\xE1 "),s(),_("ngIf",i.isFilter),s(2),_("dataSource",i.dataSource()),s(),$(i.displayedColumns),s(2),_("matHeaderRowDef",i.displayedColumns),s(),_("matRowDefColumns",i.displayedColumns),s(2),_("pageSizeOptions",P(11,ne))}},dependencies:[vt,St,yt,wt,Mt,Bt,Jt,Nt,At,zt,Pt,$t,Ht,Ot,Rt,Qt,qt,Gt,Vt,I,Dt,It,k,gt,ut,pt,dt,st,rt,lt,tt,ct,mt,ot,at,bt,X,Z,Y,U,ht,_t,ft,Ct,kt,Lt],encapsulation:2})};export{Ut as a};
