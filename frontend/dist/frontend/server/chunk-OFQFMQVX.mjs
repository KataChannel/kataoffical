import './polyfills.server.mjs';
import{a as ht}from"./chunk-7BHYQM75.mjs";import{a as vt}from"./chunk-73IBRO6I.mjs";import{a as Ie,b as Te,c as Me,d as ke,e as Qe,f as Pe,g as Be,h as Fe,i as Ae}from"./chunk-J2X2IDOS.mjs";import{a as at}from"./chunk-JCEDEAFZ.mjs";import{c as He,d as Ge,f as Ke,h as We}from"./chunk-YMAUF7AB.mjs";import{a as pt,b as gt}from"./chunk-GP5NNPSV.mjs";import{a as ut}from"./chunk-NWO6FYKJ.mjs";import{a as nt,b as rt,c as ot,d as st,e as lt,g as dt,s as ct,t as mt}from"./chunk-F67EA2NS.mjs";import{b as Ne,c as Ve,d as Re}from"./chunk-OJPS36I7.mjs";import{a as De,b as Le,c as Ce}from"./chunk-64CFNIOZ.mjs";import{b as tt}from"./chunk-NUVKAPYJ.mjs";import{b as it,f as z}from"./chunk-LAYB64I4.mjs";import{a as xe}from"./chunk-YZI4C2XX.mjs";import{a as Se,b as Ee,d as we}from"./chunk-UNZGJYPM.mjs";import{a as ze,b as qe}from"./chunk-KGLON2GY.mjs";import{b as je,g as Oe,j as $e,n as Ue,p as Je,u as Ze,v as Xe,x as Ye,y as et}from"./chunk-SPFNVSFU.mjs";import{a as b}from"./chunk-W5HS6BR5.mjs";import{a as A}from"./chunk-3BBXLICE.mjs";import{B as ye,F as fe,N as _e,O as be,T as H,k as pe,l as ge,x as he,y as ve}from"./chunk-DJ7E7SQ6.mjs";import{b as ue,d as F}from"./chunk-OSZHILTS.mjs";import{d as le,n as de,o as ce,s as me}from"./chunk-ECFZYKDO.mjs";import{Bb as M,Bc as R,Cb as Y,Cc as o,Db as ee,Dc as _,Ec as C,Gc as re,Ha as W,Hb as te,Ib as D,Jc as j,Ka as J,Kc as O,Lc as $,Na as T,Nc as U,Ta as Z,Tb as ie,Ub as v,Vc as oe,Wb as ae,dc as n,ec as r,fa as G,fc as ne,ga as K,jc as w,ka as I,kd as B,la as u,oc as y,pb as d,qc as f,qd as se,tb as X,tc as L,ua as p,va as g,wc as k,xc as Q,yc as P}from"./chunk-SR7H3PRN.mjs";import{a as x,b as V,j as m}from"./chunk-RIAI3ORJ.mjs";var q=class s{constructor(i,e,t){this._StorageService=i;this.router=e;this._ErrorLogService=t}ListQuanlydrive=T([]);DetailQuanlydrive=T({});quanlydriveId=T(null);setQuanlydriveId(i){this.quanlydriveId.set(i)}socket=ht(`${b.APIURL}`);CreateQuanlydrive(i){return m(this,null,function*(){try{let e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)},t=yield fetch(`${b.APIURL}/quanlydrive`,e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let a=yield t.json();t.ok||this.handleError(t.status),this.getAllQuanlydrive(),this.quanlydriveId.set(a.id)}catch(e){return this._ErrorLogService.logError("Failed to CreateQuanlydrive",e),console.error(e)}})}getAllQuanlydrive(i,e){return m(this,null,function*(){e&&this._StorageService.removeItem("quanlydrives_updatedAt");let a=yield(yield this.initDB()).getAll("quanlydrives"),l=this._StorageService.getItem("quanlydrives_updatedAt")||"0";if(a.length>0&&Date.now()-new Date(l).getTime()<5*60*1e3)return this.ListQuanlydrive.set(a),a;try{let h={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},c=yield fetch(`${b.APIURL}/last-updated?table=driveItem`,h);if(!c.ok)return this.handleError(c.status),a;let{updatedAt:S}=yield c.json();if(S<=l)return this.ListQuanlydrive.set(a),a;console.log(S,l);let E=yield fetch(`${b.APIURL}/quanlydrive?driveId=${i}`,h);if(!E.ok)return this.handleError(E.status),a;let N=yield E.json();return yield this.saveQuanlydrives(N),this._StorageService.setItem("quanlydrives_updatedAt",S.toString()),this.ListQuanlydrive.set(N),N}catch(h){return this._ErrorLogService.logError("Failed to create getAllQuanlydrive",h),console.error(h),a}})}listenQuanlydriveUpdates(){this.socket.on("quanlydrive-updated",()=>m(this,null,function*(){console.log("\u{1F504} D\u1EEF li\u1EC7u s\u1EA3n ph\u1EA9m thay \u0111\u1ED5i, c\u1EADp nh\u1EADt l\u1EA1i cache..."),this._StorageService.removeItem("quanlydrives_updatedAt"),yield this.getAllQuanlydrive()}))}initDB(){return m(this,null,function*(){return yield vt("QuanlydriveDB",1,{upgrade(i){i.createObjectStore("quanlydrives",{keyPath:"id"})}})})}saveQuanlydrives(i){return m(this,null,function*(){let t=(yield this.initDB()).transaction("quanlydrives","readwrite"),a=t.objectStore("quanlydrives");yield a.clear(),i.forEach(l=>a.put(l)),yield t.done})}getQuanlydriveBy(i){return m(this,null,function*(){try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(i)},t=yield fetch(`${b.APIURL}/quanlydrive/findby`,e);t.ok||this.handleError(t.status);let a=yield t.json();this.DetailQuanlydrive.set(a)}catch(e){return this._ErrorLogService.logError("Failed to getQuanlydriveBy",e),console.error(e)}})}updateQuanlydrive(i){return m(this,null,function*(){try{let e={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)},t=yield fetch(`${b.APIURL}/quanlydrive/${i.id}`,e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let a=yield t.json();t.ok||this.handleError(t.status),this.getAllQuanlydrive(),this.getQuanlydriveBy({id:a.id})}catch(e){return this._ErrorLogService.logError("Failed to updateQuanlydrive",e),console.error(e)}})}DeleteUserDrive(i){return m(this,null,function*(){try{let e={method:"DELETE",headers:{"Content-Type":"application/json"}},t=yield fetch(`${b.APIURL}/quanlydrive/users/${i.userIdDrive}/${i.googleId}`,e);return t.ok||this.handleError(t.status),t.json()}catch(e){return this._ErrorLogService.logError("Failed to DeleteQuanlydrive",e),console.error(e)}})}DeleteQuanlydrive(i){return m(this,null,function*(){try{let e={method:"DELETE",headers:{"Content-Type":"application/json"}},t=yield fetch(`${b.APIURL}/quanlydrive/${i.id}`,e);t.ok||this.handleError(t.status),this.getAllQuanlydrive()}catch(e){return this._ErrorLogService.logError("Failed to DeleteQuanlydrive",e),console.error(e)}})}QuanlydriveQueryfolder(i){return m(this,null,function*(){try{let e={method:"GET",headers:{"Content-Type":"application/json"}},t=yield fetch(`${b.APIURL}/quanlydrive/queryfolder?query=${i.googleId}`,e);t.ok||this.handleError(t.status),this.getAllQuanlydrive()}catch(e){return this._ErrorLogService.logError("Failed to DeleteQuanlydrive",e),console.error(e)}})}ListUsersFolder(i){return m(this,null,function*(){try{let e={method:"GET",headers:{"Content-Type":"application/json"}},t=yield fetch(`${b.APIURL}/quanlydrive/listUsersFolder?query=${i.googleId}`,e);t.ok||this.handleError(t.status),this.getAllQuanlydrive()}catch(e){return this._ErrorLogService.logError("Failed to DeleteQuanlydrive",e),console.error(e)}})}handleError(i){let e="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(i){case 401:e="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:e="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:e="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}let t=JSON.stringify({code:i,title:e});this.router.navigate(["/errorserver"],{queryParams:{data:t}})}static \u0275fac=function(e){return new(e||s)(I(A),I(F),I(at))};static \u0275prov=G({token:s,factory:s.\u0275fac,providedIn:"root"})};var ft="mat-badge-content",wt=(()=>{class s{static \u0275fac=function(t){return new(t||s)};static \u0275cmp=M({type:s,selectors:[["ng-component"]],decls:0,vars:0,template:function(t,a){},styles:[".mat-badge{position:relative}.mat-badge.mat-badge{overflow:visible}.mat-badge-content{position:absolute;text-align:center;display:inline-block;transition:transform 200ms ease-in-out;transform:scale(0.6);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box;pointer-events:none;background-color:var(--mat-badge-background-color, var(--mat-sys-error));color:var(--mat-badge-text-color, var(--mat-sys-on-error));font-family:var(--mat-badge-text-font, var(--mat-sys-label-small-font));font-weight:var(--mat-badge-text-weight, var(--mat-sys-label-small-weight));border-radius:var(--mat-badge-container-shape, var(--mat-sys-corner-full))}.mat-badge-above .mat-badge-content{bottom:100%}.mat-badge-below .mat-badge-content{top:100%}.mat-badge-before .mat-badge-content{right:100%}[dir=rtl] .mat-badge-before .mat-badge-content{right:auto;left:100%}.mat-badge-after .mat-badge-content{left:100%}[dir=rtl] .mat-badge-after .mat-badge-content{left:auto;right:100%}@media(forced-colors: active){.mat-badge-content{outline:solid 1px;border-radius:0}}.mat-badge-disabled .mat-badge-content{background-color:var(--mat-badge-disabled-state-background-color, color-mix(in srgb, var(--mat-sys-error) 38%, transparent));color:var(--mat-badge-disabled-state-text-color, var(--mat-sys-on-error))}.mat-badge-hidden .mat-badge-content{display:none}.ng-animate-disabled .mat-badge-content,.mat-badge-content._mat-animation-noopable{transition:none}.mat-badge-content.mat-badge-active{transform:none}.mat-badge-small .mat-badge-content{width:var(--mat-badge-legacy-small-size-container-size, unset);height:var(--mat-badge-legacy-small-size-container-size, unset);min-width:var(--mat-badge-small-size-container-size, 6px);min-height:var(--mat-badge-small-size-container-size, 6px);line-height:var(--mat-badge-small-size-line-height, 6px);padding:var(--mat-badge-small-size-container-padding, 0);font-size:var(--mat-badge-small-size-text-size, 0);margin:var(--mat-badge-small-size-container-offset, -6px 0)}.mat-badge-small.mat-badge-overlap .mat-badge-content{margin:var(--mat-badge-small-size-container-overlap-offset, -6px)}.mat-badge-medium .mat-badge-content{width:var(--mat-badge-legacy-container-size, unset);height:var(--mat-badge-legacy-container-size, unset);min-width:var(--mat-badge-container-size, 16px);min-height:var(--mat-badge-container-size, 16px);line-height:var(--mat-badge-line-height, 16px);padding:var(--mat-badge-container-padding, 0 4px);font-size:var(--mat-badge-text-size, var(--mat-sys-label-small-size));margin:var(--mat-badge-container-offset, -12px 0)}.mat-badge-medium.mat-badge-overlap .mat-badge-content{margin:var(--mat-badge-container-overlap-offset, -12px)}.mat-badge-large .mat-badge-content{width:var(--mat-badge-legacy-large-size-container-size, unset);height:var(--mat-badge-legacy-large-size-container-size, unset);min-width:var(--mat-badge-large-size-container-size, 16px);min-height:var(--mat-badge-large-size-container-size, 16px);line-height:var(--mat-badge-large-size-line-height, 16px);padding:var(--mat-badge-large-size-container-padding, 0 4px);font-size:var(--mat-badge-large-size-text-size, var(--mat-sys-label-small-size));margin:var(--mat-badge-large-size-container-offset, -12px 0)}.mat-badge-large.mat-badge-overlap .mat-badge-content{margin:var(--mat-badge-large-size-container-overlap-offset, -12px)}"],encapsulation:2,changeDetection:0})}return s})(),_t=(()=>{class s{_ngZone=u(W);_elementRef=u(J);_ariaDescriber=u(ye);_renderer=u(X);_animationMode=u(Z,{optional:!0});_idGenerator=u(be);get color(){return this._color}set color(e){this._setColor(e),this._color=e}_color="primary";overlap=!0;disabled;position="above after";get content(){return this._content}set content(e){this._updateRenderedContent(e)}_content;get description(){return this._description}set description(e){this._updateDescription(e)}_description;size="medium";hidden;_badgeElement;_inlineBadgeDescription;_isInitialized=!1;_interactivityChecker=u(fe);_document=u(le);constructor(){let e=u(pe);e.load(wt),e.load(ge)}isAbove(){return this.position.indexOf("below")===-1}isAfter(){return this.position.indexOf("before")===-1}getBadgeElement(){return this._badgeElement}ngOnInit(){this._clearExistingBadges(),this.content&&!this._badgeElement&&(this._badgeElement=this._createBadgeElement(),this._updateRenderedContent(this.content)),this._isInitialized=!0}ngOnDestroy(){this._renderer.destroyNode&&(this._renderer.destroyNode(this._badgeElement),this._inlineBadgeDescription?.remove()),this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this.description)}_isHostInteractive(){return this._interactivityChecker.isFocusable(this._elementRef.nativeElement,{ignoreVisibility:!0})}_createBadgeElement(){let e=this._renderer.createElement("span"),t="mat-badge-active";return e.setAttribute("id",this._idGenerator.getId("mat-badge-content-")),e.setAttribute("aria-hidden","true"),e.classList.add(ft),this._animationMode==="NoopAnimations"&&e.classList.add("_mat-animation-noopable"),this._elementRef.nativeElement.appendChild(e),typeof requestAnimationFrame=="function"&&this._animationMode!=="NoopAnimations"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{e.classList.add(t)})}):e.classList.add(t),e}_updateRenderedContent(e){let t=`${e??""}`.trim();this._isInitialized&&t&&!this._badgeElement&&(this._badgeElement=this._createBadgeElement()),this._badgeElement&&(this._badgeElement.textContent=t),this._content=t}_updateDescription(e){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this.description),(!e||this._isHostInteractive())&&this._removeInlineDescription(),this._description=e,this._isHostInteractive()?this._ariaDescriber.describe(this._elementRef.nativeElement,e):this._updateInlineDescription()}_updateInlineDescription(){this._inlineBadgeDescription||(this._inlineBadgeDescription=this._document.createElement("span"),this._inlineBadgeDescription.classList.add("cdk-visually-hidden")),this._inlineBadgeDescription.textContent=this.description,this._badgeElement?.appendChild(this._inlineBadgeDescription)}_removeInlineDescription(){this._inlineBadgeDescription?.remove(),this._inlineBadgeDescription=void 0}_setColor(e){let t=this._elementRef.nativeElement.classList;t.remove(`mat-badge-${this._color}`),e&&t.add(`mat-badge-${e}`)}_clearExistingBadges(){let e=this._elementRef.nativeElement.querySelectorAll(`:scope > .${ft}`);for(let t of Array.from(e))t!==this._badgeElement&&t.remove()}static \u0275fac=function(t){return new(t||s)};static \u0275dir=ee({type:s,selectors:[["","matBadge",""]],hostAttrs:[1,"mat-badge"],hostVars:20,hostBindings:function(t,a){t&2&&ae("mat-badge-overlap",a.overlap)("mat-badge-above",a.isAbove())("mat-badge-below",!a.isAbove())("mat-badge-before",!a.isAfter())("mat-badge-after",a.isAfter())("mat-badge-small",a.size==="small")("mat-badge-medium",a.size==="medium")("mat-badge-large",a.size==="large")("mat-badge-hidden",a.hidden||!a.content)("mat-badge-disabled",a.disabled)},inputs:{color:[0,"matBadgeColor","color"],overlap:[2,"matBadgeOverlap","overlap",B],disabled:[2,"matBadgeDisabled","disabled",B],position:[0,"matBadgePosition","position"],content:[0,"matBadge","content"],description:[0,"matBadgeDescription","description"],size:[0,"matBadgeSize","size"],hidden:[2,"matBadgeHidden","hidden",B]},features:[te]})}return s})(),bt=(()=>{class s{static \u0275fac=function(t){return new(t||s)};static \u0275mod=Y({type:s});static \u0275inj=K({imports:[_e,H,H]})}return s})();var Dt=["drawer"],Et=()=>({standalone:!0});function Lt(s,i){if(s&1){let e=w();n(0,"div",28)(1,"div",29)(2,"mat-form-field",23)(3,"mat-label"),o(4,"Drive ID"),r(),n(5,"input",30),$("ngModelChange",function(a){p(e);let l=f();return O(l.driveId,a)||(l.driveId=a),g(a)}),r()(),n(6,"button",31),y("click",function(){p(e);let a=f();return g(a.LoadDulieu(a.driveId))}),n(7,"mat-icon"),o(8,"sync"),r()(),n(9,"button",32),y("click",function(){p(e);let a=f();return g(a.LoadSyncDrive(a.driveId))}),n(10,"mat-icon"),o(11,"cloud_sync"),r()(),n(12,"button",33),y("click",function(){p(e);let a=f();return g(a.isSearch=!a.isSearch)}),n(13,"mat-icon"),o(14,"search"),r()()()()}if(s&2){let e=f();d(5),j("ngModel",e.driveId),v("ngModelOptions",U(2,Et))}}function Ct(s,i){if(s&1){let e=w();n(0,"div",34)(1,"mat-form-field",35)(2,"mat-label"),o(3,"T\xECm Ki\u1EBFm"),r(),n(4,"input",36),y("keyup",function(a){p(e);let l=f();return g(l.applyFilter(a))}),r()(),n(5,"button",37),y("click",function(){p(e);let a=f();return g(a.isSearch=!a.isSearch)}),n(6,"mat-icon"),o(7,"cancel"),r()()()}}function It(s,i){if(s&1){let e=w();n(0,"tr",38)(1,"td",39),o(2),r(),n(3,"td",39),o(4),r(),n(5,"td",39),o(6),r(),n(7,"td",39),o(8),r(),n(9,"td",39),o(10),r(),n(11,"td",39),o(12),r(),n(13,"td",39)(14,"button",37),y("click",function(){let a=p(e).$implicit,l=f();return g(l.deleteItem(a))}),n(15,"mat-icon"),o(16,"delete"),r()()()()}if(s&2){let e=i.$implicit,t=i.index;d(2),_(t+1),d(2),_(e.name),d(2),_(e.emailAddress),d(2),_(e.role),d(2),_(e.userIdDrive),d(2),_(e.googleId)}}function Tt(s,i){if(s&1){let e=w();n(0,"mat-tree-node",40)(1,"div",41)(2,"div",42)(3,"button",43),y("click",function(){let a=p(e).$implicit,l=f();return g(l.LoadFolder(a.node))}),n(4,"mat-icon",44),o(5),r()(),n(6,"button",43),y("click",function(){let a=p(e).$implicit,l=f();return g(l.LoadPermission(a.node))}),n(7,"mat-icon",45),o(8,"group"),r()(),n(9,"span"),o(10),r()()()()}if(s&2){let e=i.$implicit;d(4),L("matBadge",(e==null||e.node==null||e.node.children==null?null:e.node.children.length)||0),v("color",e.node.type=="folder"?"warn":"accent"),d(),_(e.node.type=="folder"?"folder":"description"),d(2),L("matBadge",(e==null||e.node==null||e.node.permissions==null?null:e.node.permissions.length)||0),d(3),C(" ",e.name,"")}}function Mt(s,i){if(s&1){let e=w();n(0,"mat-tree-node",46)(1,"div",41)(2,"div",42)(3,"button",43),y("click",function(){let a=p(e).$implicit,l=f();return g(l.LoadFolder(a.node))}),n(4,"mat-icon",44),o(5),r()(),n(6,"button",43),y("click",function(){let a=p(e).$implicit,l=f();return g(l.LoadPermission(a.node))}),n(7,"mat-icon",45),o(8,"group"),r()(),n(9,"span"),o(10),r()(),n(11,"button",47)(12,"mat-icon"),o(13),r()()()()}if(s&2){let e=i.$implicit,t=f();v("cdkTreeNodeTypeaheadLabel",e.name),d(4),L("matBadge",(e==null||e.node==null||e.node.children==null?null:e.node.children.length)||0),v("color",e.node.type=="folder"?"warn":"primary"),d(),_(e.node.type=="folder"?"folder":"description"),d(2),L("matBadge",(e==null||e.node==null||e.node.permissions==null?null:e.node.permissions.length)||0),d(3),C(" ",e.name,""),d(),ie("aria-label","Toggle "+e.name),d(2),C(" ",t.treeControl.isExpanded(e)?"expand_more":"chevron_right"," ")}}function kt(s,i){s&1&&(n(0,"mat-dialog-content")(1,"div",48)(2,"div",49),o(3,"X\xE1c Nh\u1EADn"),r(),n(4,"div"),o(5,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),r(),n(6,"div",50)(7,"button",51),o(8,"\u0110\u1ED3ng \xDD"),r(),n(9,"button",52),o(10,"Hu\u1EF7 B\u1ECF"),r()()()())}var St=class s{_transformer=(i,e)=>({expandable:!!i.children&&i.children.length>0,node:i,name:i.name,level:e});treeControl=new Ie(i=>i.level,i=>i.expandable);treeFlattener=new Fe(this._transformer,i=>i.level,i=>i.expandable,i=>i.children);dataTreeSource=new Ae(this.treeControl,this.treeFlattener);hasChild=(i,e)=>e.expandable;totalItems=0;pageSize=10;currentPage=1;totalPages=1;driveId;paginator;sort;drawer;filterValues={};_QuanlydriveService=u(q);_breakpointObserver=u(he);_GoogleSheetService=u(ut);_StorageService=u(A);_router=u(F);_dialog=u(He);Listquanlydrive=this._QuanlydriveService.ListQuanlydrive;EditList=[];dataSource=new mt([]);quanlydriveId=this._QuanlydriveService.quanlydriveId;_snackBar=u(xe);CountItem=0;isSearch=!1;ListTimkiem=[];constructor(){se(()=>{this.dataSource.data=this.Listquanlydrive(),this.dataTreeSource.data=this.Listquanlydrive(),this.totalItems=this.Listquanlydrive().length,this.calculateTotalPages()})}applyFilter(i){let e=this.Listquanlydrive();console.log(z(e)),this.ListTimkiem=z(e).map(a=>z(a.permissions).map(h=>V(x({},h),{name:a.name}))).flat();let t=i.target.value;this.ListTimkiem=this.ListTimkiem.filter(a=>a.emailAddress?.toLowerCase().includes(t.toLowerCase())),this.dataSource.filter=t.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}deleteItem(i){return m(this,null,function*(){yield this._QuanlydriveService.DeleteUserDrive(i).then(e=>{console.log(e),(e.statusCode===204||e.statusCode===404)&&(this._QuanlydriveService.DeleteQuanlydrive(i),this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}))})})}ngOnInit(){return m(this,null,function*(){this._StorageService.getItem("driveId")?this.driveId=this._StorageService.getItem("driveId"):this.driveId=null,this.updateDisplayData(),this._QuanlydriveService.listenQuanlydriveUpdates(),yield this._QuanlydriveService.getAllQuanlydrive(),this.dataTreeSource.data=this.Listquanlydrive(),this.treeControl.collapseAll(),console.log(this.dataTreeSource.data),this.setupDrawer()})}LoadDulieu(i){return m(this,null,function*(){this._StorageService.setItem("driveId",i),this._QuanlydriveService.listenQuanlydriveUpdates();let e=yield this._QuanlydriveService.getAllQuanlydrive(i,!0);this.dataTreeSource.data=this.Listquanlydrive()})}LoadSyncDrive(i){return m(this,null,function*(){yield this._QuanlydriveService.getAllQuanlydrive(i,!0),this.dataTreeSource.data=this.Listquanlydrive()})}LoadFolder(i){console.log(i),i.type==="folder"&&this._QuanlydriveService.QuanlydriveQueryfolder(i)}LoadPermission(i){this._QuanlydriveService.ListUsersFolder(i)}setupDrawer(){this._breakpointObserver.observe([ve.Handset]).subscribe(i=>{i.matches?this.drawer.mode="over":this.drawer.mode="side"})}ListFilter=[];ChosenItem(i,e){let t=this.dataSource.filteredData.filter(l=>l[e]===i[e]);this.ListFilter.filter(l=>l[e]===i[e]).length>0?this.ListFilter=this.ListFilter.filter(l=>l[e]!==i[e]):this.ListFilter=[...this.ListFilter,...t]}ChosenAll(i){i.forEach(e=>{!!this.ListFilter.find(a=>a.id===e.id)?this.ListFilter=this.ListFilter.filter(a=>a.id!==a.id):this.ListFilter.push(e)})}ResetFilter(){this.ListFilter=this.Listquanlydrive(),this.dataSource.data=this.Listquanlydrive(),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}EmptyFiter(){this.ListFilter=[]}CheckItem(i){return!!this.ListFilter.find(e=>e.id===i.id)}ApplyFilterColum(i){this.dataSource.data=this.Listquanlydrive().filter(e=>this.ListFilter.some(t=>t.id===e.id)),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,i.closeMenu()}create(){this.drawer.open(),this._router.navigate(["admin/quanlydrive","new"])}openDeleteDialog(i){this._dialog.open(i,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(t=>{t=="true"&&this.DeleteListItem()})}DeleteListItem(){this.EditList.forEach(i=>{this._QuanlydriveService.DeleteQuanlydrive(i)}),this.EditList=[],this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}AddToEdit(i){this.EditList.find(t=>t.id===i.id)?this.EditList=this.EditList.filter(t=>t.id!==i.id):this.EditList.push(i)}CheckItemInEdit(i){return this.EditList.some(e=>e.id===i.id)}goToDetail(i){this.drawer.open(),this._QuanlydriveService.setQuanlydriveId(i.id),this._router.navigate(["admin/quanlydrive",i.id])}LoadDrive(){return m(this,null,function*(){let i={IdSheet:"15npo25qyH5FmfcEjl1uyqqyFMS_vdFnmxM_kt0KYmZk",SheetName:"SPImport",ApiKey:"AIzaSyD33kgZJKdFpv1JrKHacjCQccL_O0a2Eao"},e=yield this._GoogleSheetService.getDrive(i),t=it(e.values);this.DoImportData(t)})}DoImportData(i){return m(this,null,function*(){let e=i.map(c=>({title:c.title?.trim()||"",masp:c.masp?.trim()||"",giagoc:Number(c.giagoc)||0,dvt:c.dvt?.trim()||"",soluong:Number(c.soluong)||0,soluongkho:Number(c.soluongkho)||0,haohut:Number(c.haohut)||0,ghichu:c.ghichu?.trim()||""})),t=Array.from(new Map(e.map(c=>[c.masp,c])).values()),a=this._QuanlydriveService.ListQuanlydrive(),l=a.map(c=>c.masp),h=t.map(c=>c.masp).filter(c=>!l.includes(c));yield Promise.all(t.map(c=>m(this,null,function*(){let S=a.find(E=>E.masp===c.masp);if(S){let E=x(x({},S),c);yield this._QuanlydriveService.updateQuanlydrive(E)}else yield this._QuanlydriveService.CreateQuanlydrive(c)}))),yield Promise.all(a.filter(c=>!t.some(S=>S.masp===c.masp)).map(c=>this._QuanlydriveService.updateQuanlydrive(V(x({},c),{isActive:!1})))),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ImporExcel(i){return m(this,null,function*(){let e=yield gt(i);this.DoImportData(e)})}ExportExcel(i,e){let t=i.map(a=>({title:a.title,masp:a.masp,giagoc:a.giagoc,dvt:a.dvt,soluong:a.soluong,soluongkho:a.soluongkho,haohut:a.haohut,ghichu:a.ghichu}));pt(t,e)}trackByFn(i,e){return e.id}calculateTotalPages(){this.totalPages=Math.ceil(this.totalItems/this.pageSize)}onPageSizeChange(i,e){i>this.Listquanlydrive().length?(this.pageSize=this.Listquanlydrive().length,this._snackBar.open(`S\u1ED1 l\u01B0\u1EE3ng t\u1ED1i \u0111a ${this.Listquanlydrive().length}`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})):this.pageSize=i,this.currentPage=1,this.calculateTotalPages(),this.updateDisplayData(),e.closeMenu()}onPreviousPage(){this.currentPage>1&&(this.currentPage--,this.updateDisplayData())}onNextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.updateDisplayData())}updateDisplayData(){let i=(this.currentPage-1)*this.pageSize,e=i+this.pageSize,t=this.Listquanlydrive().slice(i,e);this.dataSource.data=t}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=M({type:s,selectors:[["app-listquanlydrive"]],viewQuery:function(e,t){if(e&1&&(k(ot,5),k(lt,5),k(Dt,7)),e&2){let a;Q(a=P())&&(t.paginator=a.first),Q(a=P())&&(t.sort=a.first),Q(a=P())&&(t.drawer=a.first)}},decls:62,vars:19,consts:[["drawer",""],["menuHienthi","matMenuTrigger"],["menu","matMenu"],["DeleteDialog",""],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","lg:!w-1/2","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-16","w-full","p-2"],["class","border p-1 cursor-pointer w-full relative flex lg:flex-row lg:space-y-2 space-y-0 flex-col space-x-2 justify-between items-center bg-white rounded-lg",4,"ngIf"],["class","border p-1 py-2 w-full flex flex-row space-x-2 items-center",4,"ngIf"],[1,"cursor-pointer","border","rounded-lg","w-full","h-full","overflow-auto","p-4"],[1,"table-auto","w-full","border-collapse","border","border-gray-300"],[1,"bg-gray-100"],[1,"border","border-gray-300","px-4","py-2","text-left"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[3,"dataSource","treeControl"],["matTreeNodePadding","",4,"matTreeNodeDef"],["matTreeNodePadding","","matTreeNodeToggle","",3,"cdkTreeNodeTypeaheadLabel",4,"matTreeNodeDef","matTreeNodeDefWhen"],[1,"cursor-pointer","border","rounded-lg","px-3","p-1","flex","flex-row","space-x-2","items-center","justify-between"],[1,"w-full","flex","lg:p-0","p-2","lg:flex-row","lg:space-x-2","lg:items-center","lg:justify-between","flex-col","justify-center"],[1,"w-full","text-center"],[1,"w-full","flex","flex-row","space-x-2","items-center","lg:justify-end","justify-center"],[1,"font-bold","text-blue-600",3,"matMenuTriggerFor"],[1,"w-full","flex","flex-col","space-y-2","p-4",3,"click"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp S\u1ED1 L\u01B0\u1EE3ng",3,"ngModelChange","ngModel","ngModelOptions"],["mat-flat-button","","color","primary",3,"click"],[1,"pagination-controls"],["mat-icon-button","","color","primary",3,"click","disabled"],[1,"border","p-1","cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","bg-white","rounded-lg"],[1,"w-full","flex","flex-row","space-x-2","items-center"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp Drive ID",3,"ngModelChange","ngModel","ngModelOptions"],["matTooltip","Load D\u1EEF Li\u1EC7u","color","primary","mat-icon-button","",3,"click"],["matTooltip","Load C\u1EADp Nh\u1EADt Drive","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\xECm Ki\u1EBFm","color","primary","mat-icon-button","",3,"click"],[1,"border","p-1","py-2","w-full","flex","flex-row","space-x-2","items-center"],["appearance","outline","subscriptSizing","dynamic",1,"lg:w-auto","w-full"],["matInput","","placeholder","Vui l\xF2ng T\xECm Ki\u1EBFm",3,"keyup"],["mat-icon-button","","color","warn",3,"click"],[1,"hover:bg-gray-50"],[1,"border","border-gray-300","px-4","py-2"],["matTreeNodePadding",""],[1,"p-2","w-full","flex","flex-row","space-x-2","items-center","justify-between","hover:bg-gray-50","rounded-lg"],[1,"flex","flex-row","space-x-3","items-center"],["mat-icon-button","","color","primary",3,"click"],["aria-hidden","false","matBadgeColor","warn",3,"color","matBadge"],["aria-hidden","false",3,"matBadge"],["matTreeNodePadding","","matTreeNodeToggle","",3,"cdkTreeNodeTypeaheadLabel"],["mat-icon-button","","color","primary","matTreeNodeToggle",""],[1,"flex","flex-col","space-y-8","items-center","justify-center"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary","mat-dialog-close","true"],["mat-flat-button","","color","warn","mat-dialog-close","false"]],template:function(e,t){if(e&1){let a=w();n(0,"mat-drawer-container",4)(1,"mat-drawer",5,0),ne(3,"router-outlet"),r(),n(4,"div",6),D(5,Lt,15,3,"div",7)(6,Ct,8,0,"div",8),n(7,"div",9)(8,"table",10)(9,"thead")(10,"tr",11)(11,"th",12),o(12,"#"),r(),n(13,"th",12),o(14,"T\xEAn"),r(),n(15,"th",12),o(16,"Email"),r(),n(17,"th",12),o(18,"Quy\u1EC1n"),r(),n(19,"th",12),o(20,"User ID Drive"),r(),n(21,"th",12),o(22,"Google ID"),r(),n(23,"th",12),o(24,"Thao T\xE1c"),r()()(),n(25,"tbody"),D(26,It,17,6,"tr",13),r()(),n(27,"mat-tree",14),D(28,Tt,11,5,"mat-tree-node",15)(29,Mt,14,8,"mat-tree-node",16),r()(),n(30,"div",17)(31,"div",18)(32,"span",19),o(33,"\u0110ang Xem "),n(34,"strong"),o(35),r(),o(36," - "),n(37,"strong"),o(38),r(),o(39),r(),n(40,"div",20)(41,"span",21,1),o(43),r(),n(44,"mat-menu",null,2)(46,"div",22),y("click",function(h){return p(a),g(h.stopPropagation())}),n(47,"span"),o(48,"S\u1ED1 L\u01B0\u1EE3ng"),r(),n(49,"mat-form-field",23)(50,"input",24),$("ngModelChange",function(h){return p(a),O(t.pageSize,h)||(t.pageSize=h),g(h)}),r()(),n(51,"button",25),y("click",function(){p(a);let h=R(42);return g(t.onPageSizeChange(t.pageSize,h))}),o(52,"\xC1p D\u1EE5ng"),r()()(),n(53,"div",26)(54,"button",27),y("click",function(){return p(a),g(t.onPreviousPage())}),n(55,"mat-icon"),o(56,"keyboard_arrow_left"),r()(),n(57,"button",27),y("click",function(){return p(a),g(t.onNextPage())}),n(58,"mat-icon"),o(59,"keyboard_arrow_right"),r()()()()()()()(),D(60,kt,11,0,"ng-template",null,3,oe)}if(e&2){let a=R(45);d(),v("position","end"),d(4),v("ngIf",!t.isSearch),d(),v("ngIf",t.isSearch),d(20),v("ngForOf",t.ListTimkiem),d(),v("dataSource",t.dataTreeSource)("treeControl",t.treeControl),d(2),v("matTreeNodeDefWhen",t.hasChild),d(6),_((t.currentPage-1)*t.pageSize+1),d(3),_(t.currentPage*t.pageSize>t.totalItems?t.totalItems:t.currentPage*t.pageSize),d(),re(" trong s\u1ED1 ",t.totalItems," m\u1EE5c, ",t.currentPage,"/",t.totalPages," Trang"),d(2),v("matMenuTriggerFor",a),d(2),C("Hi\u1EC7n Th\u1ECB : ",t.pageSize," m\u1EE5c"),d(7),j("ngModel",t.pageSize),v("ngModelOptions",U(18,Et)),d(4),v("disabled",t.currentPage===1),d(3),v("disabled",t.currentPage===t.totalPages)}},dependencies:[Xe,Ze,Je,et,Ye,ct,dt,st,Re,Ne,Ve,Ce,De,Le,ue,qe,ze,we,Se,Ee,tt,me,de,ce,Ue,je,Oe,$e,rt,nt,We,Ge,Ke,Be,Me,ke,Pe,Qe,Te,bt,_t],encapsulation:2,changeDetection:0})};export{q as a,St as b};
