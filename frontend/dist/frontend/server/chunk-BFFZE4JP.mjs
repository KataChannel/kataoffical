import './polyfills.server.mjs';
import{a as fe,b as Ct}from"./chunk-35WIEGCC.mjs";import{a as _e,b as ht}from"./chunk-R3HBMR4G.mjs";import{c as ut,e as pt,f as B}from"./chunk-75CEAGQ2.mjs";import{a as gt,b as _t,d as ft,f as xt}from"./chunk-F66R5CR3.mjs";import{a as z}from"./chunk-Z2D3DSH5.mjs";import{a as rt,b as ot}from"./chunk-4PJJXT2S.mjs";import{a as lt}from"./chunk-XSDCRXGH.mjs";import{b as Qe,c as ze,d as We,e as Ne}from"./chunk-PIBC5VRQ.mjs";import{a as st,b as at}from"./chunk-UKVYI7NX.mjs";import{a as N,b as j,c as $,d as ge,f as H,g as K}from"./chunk-QHKEBWIO.mjs";import"./chunk-ETGHWKBN.mjs";import"./chunk-PDYHWB5Z.mjs";import"./chunk-YEJQPXUS.mjs";import{b as dt}from"./chunk-GKFUPZMU.mjs";import"./chunk-NHBN3KVL.mjs";import"./chunk-UWYQSDH5.mjs";import{a as mt,b as ct}from"./chunk-3WL3NMNZ.mjs";import"./chunk-F2MT3ZLT.mjs";import{a as $e,b as He,c as Ke,e as Ye,f as Xe,g as Je,h as W}from"./chunk-KVUHCEAF.mjs";import"./chunk-26NM6QMQ.mjs";import{d as it,e as nt}from"./chunk-4AA42E7K.mjs";import"./chunk-UYI34SQK.mjs";import{a as Le,b as Ve,c as Ge,d as qe}from"./chunk-OMPCUEDD.mjs";import{b as pe}from"./chunk-N47DGJDC.mjs";import{A as de,B as ue,b as oe,g as se,j as ae,m as je,p as le,r as Ze,t as et,u as tt,x as me,y as ce}from"./chunk-GLAPW3UN.mjs";import"./chunk-J6642ETB.mjs";import{a as F,b as A}from"./chunk-X7LLP2RY.mjs";import"./chunk-6EFOJMAD.mjs";import{a as Oe}from"./chunk-Q5TTQGDU.mjs";import{a as re}from"./chunk-Y4GFH6XC.mjs";import"./chunk-2DIQ5JYQ.mjs";import"./chunk-RLIINVZD.mjs";import{a as T,c as Q,e as I}from"./chunk-7QZZCVTG.mjs";import"./chunk-LYCTG6ML.mjs";import"./chunk-7T6LZHUD.mjs";import{a as Ae,d as Be}from"./chunk-XSJY5HPB.mjs";import"./chunk-EMLDMP5T.mjs";import{o as q,y as U}from"./chunk-7VXCQSQV.mjs";import{Fb as k,Gc as ie,Hc as s,Ic as P,J as Ue,Jc as v,Kc as Fe,Mb as u,Mc as D,Na as J,Nc as M,Oc as R,Ra as h,Yb as p,Zb as Ie,_b as te,d as ye,dc as C,ec as Pe,gc as S,hc as w,ic as r,ja as ee,jc as n,kc as G,lc as Se,mc as we,oa as Te,oc as y,pa as E,q as X,tb as m,tc as _,v as ke,vc as c,wd as O,ya as f,yd as ne,za as x}from"./chunk-KYBR54ZN.mjs";import"./chunk-XAZRL6IZ.mjs";import{a as V,b as Y,j as b}from"./chunk-RIAI3ORJ.mjs";var xe=class o{constructor(t){this.storageService=t}_allRoles=h([]);_searchTerm=h("");_currentPage=h(1);_pageSize=h(50);_isLoading=h(!1);_selectedRoles=h(new Set);_statusFilter=h("all");searchResults=O(()=>{let t=this._allRoles(),e=this._searchTerm().toLowerCase();return e&&(t=t.filter(i=>i.name.toLowerCase().includes(e))),t});allRoles=this._allRoles.asReadonly();filteredRoles=this.searchResults;searchTerm=this._searchTerm.asReadonly();currentPage=this._currentPage.asReadonly();pageSize=this._pageSize.asReadonly();isLoading=this._isLoading.asReadonly();selectedRoles=this._selectedRoles.asReadonly();statusFilter=this._statusFilter.asReadonly();totalItems=O(()=>this.searchResults().length);totalPages=O(()=>Math.ceil(this.totalItems()/this._pageSize()));paginatedRoles=O(()=>{let t=(this._currentPage()-1)*this._pageSize(),e=t+this._pageSize();return this.searchResults().slice(t,e)});graphqlService=E(lt);loadAllRoles(t=!1){return b(this,null,function*(){if(!t&&this._allRoles().length>0)return this._allRoles();this._isLoading.set(!0);try{let e={orderBy:{name:"asc"},include:{permissions:{include:{permission:{select:{id:!0,name:!0,codeId:!0}}}},users:{include:{user:{include:{profile:{select:{name:!0,avatar:!0,bio:!0}}}}}}}},i=yield this.graphqlService.findMany("role",e);return this._allRoles.set(i),this._currentPage.set(1),i}catch(e){throw console.error("Error loading roles:",e),e}finally{this._isLoading.set(!1)}})}createRole(t){return b(this,null,function*(){this._isLoading.set(!0);try{let e={name:t.name},i=yield this.graphqlService.createOne("role",{data:e,include:{permissions:{include:{permission:{select:{id:!0,name:!0,codeId:!0}}}},users:{include:{user:{include:{profile:{select:{name:!0,avatar:!0,bio:!0}}}}}}}});if(t.permissionIds&&t.permissionIds.length>0){yield this.assignPermissionsToRole(i.id,t.permissionIds);let l=yield this.getRoleById(i.id);if(l){let d=this._allRoles();return this._allRoles.set([l,...d.filter(g=>g.id!==i.id)]),l}}let a=this._allRoles();return this._allRoles.set([i,...a]),i}catch(e){throw console.error("Error creating role:",e),e}finally{this._isLoading.set(!1)}})}updateRole(t,e){return b(this,null,function*(){this._isLoading.set(!0);try{let i=yield this.graphqlService.updateOne("role",{id:t},e,{include:{permissions:{include:{permission:{select:{id:!0,name:!0,codeId:!0}}}},users:{include:{user:{include:{profile:{select:{name:!0,avatar:!0,bio:!0}}}}}}}}),a=this._allRoles(),l=a.findIndex(d=>d.id===t);if(l!==-1){let d=[...a];d[l]=i,this._allRoles.set(d)}return i}catch(i){throw console.error("Error updating role:",i),i}finally{this._isLoading.set(!1)}})}deleteRole(t){return b(this,null,function*(){this._isLoading.set(!0);try{yield this.graphqlService.deleteOne("role",{id:t});let i=this._allRoles().filter(l=>l.id!==t);this._allRoles.set(i);let a=new Set(this._selectedRoles());a.delete(t),this._selectedRoles.set(a)}catch(e){throw console.error("Error deleting role:",e),e}finally{this._isLoading.set(!1)}})}getRoleById(t){return b(this,null,function*(){try{return yield this.graphqlService.findUnique("role",{id:t},{include:{permissions:{include:{permission:{select:{id:!0,name:!0,codeId:!0}}}},users:{include:{user:{include:{profile:{select:{name:!0,avatar:!0,bio:!0}}}}}}}})}catch(e){return console.error("Error getting role by id:",e),null}})}assignPermissionsToRole(t,e){return b(this,null,function*(){this._isLoading.set(!0);try{let i=e.map(l=>({roleId:t,permissionId:l}));yield this.graphqlService.batchCreate("rolePermission",i);let a=yield this.getRoleById(t);if(a){let l=this._allRoles(),d=l.findIndex(g=>g.id===t);if(d!==-1){let g=[...l];g[d]=a,this._allRoles.set(g)}}}catch(i){throw console.error("Error assigning permissions to role:",i),i}finally{this._isLoading.set(!1)}})}removePermissionFromRole(t,e){return b(this,null,function*(){this._isLoading.set(!0);try{let a=(yield this.getRoleById(t))?.permissions?.find(l=>l.permissionId===e);if(a){yield this.graphqlService.deleteOne("rolePermission",{id:a.id});let l=yield this.getRoleById(t);if(l){let d=this._allRoles(),g=d.findIndex(L=>L.id===t);if(g!==-1){let L=[...d];L[g]=l,this._allRoles.set(L)}}}}catch(i){throw console.error("Error removing permission from role:",i),i}finally{this._isLoading.set(!1)}})}setSearchTerm(t){this._searchTerm.set(t),this._currentPage.set(1)}setStatusFilter(t){this._statusFilter.set(t),this._currentPage.set(1)}setPage(t){t>=1&&t<=this.totalPages()&&this._currentPage.set(t)}setPageSize(t){this._pageSize.set(t),this._currentPage.set(1)}nextPage(){this._currentPage()<this.totalPages()&&this._currentPage.set(this._currentPage()+1)}previousPage(){this._currentPage()>1&&this._currentPage.set(this._currentPage()-1)}toggleRoleSelection(t){let e=new Set(this._selectedRoles());e.has(t)?e.delete(t):e.add(t),this._selectedRoles.set(e)}selectAllCurrentPage(){let t=new Set(this._selectedRoles());this.paginatedRoles().forEach(e=>{t.add(e.id)}),this._selectedRoles.set(t)}deselectAllCurrentPage(){let t=new Set(this._selectedRoles());this.paginatedRoles().forEach(e=>{t.delete(e.id)}),this._selectedRoles.set(t)}clearSelection(){this._selectedRoles.set(new Set)}isSelected(t){return this._selectedRoles().has(t)}get selectedCount(){return this._selectedRoles().size}get selectedIds(){return Array.from(this._selectedRoles())}findRoleById(t){return this._allRoles().find(e=>e.id===t)}getRolesByPermission(t){return this._allRoles().filter(e=>e.permissions?.some(i=>i.permissionId===t))}getRolePermissions(t){let e=this.findRoleById(t);return!e||!e.permissions?[]:e.permissions.map(i=>i.permission)}hasPermission(t,e){return this.getRolePermissions(t).some(a=>a.codeId===e)}getRolesByGroup(t){return this._allRoles().filter(e=>e.permissions?.some(i=>i.permission.group===t))}getUsersInRole(t){let e=this.findRoleById(t);return!e||!e.users?[]:e.users.map(i=>i.user)}clearCache(){this._allRoles.set([]),this._searchTerm.set(""),this._currentPage.set(1),this.clearSelection()}refreshData(){return this.loadAllRoles(!0)}static \u0275fac=function(e){return new(e||o)(Te(Oe))};static \u0275prov=ee({token:o,factory:o.\u0275fac,providedIn:"root"})};var he=class o{userPermissionService=E(_e);permissionService=E(ht);userService=E(fe);cachedUsers=new Map;cachedPermissions=[];getUserPermissionDetails(t){return!t||t==="new"?X(null):this.cachedUsers.has(t)?X(this.cachedUsers.get(t)):this.loadUserWithPermissions(t).pipe(ke(e=>(e&&this.cachedUsers.set(t,e),e)),Ue(e=>(console.error("Error loading user permission details:",e),X(null))))}getAllPermissions(){return this.cachedPermissions.length>0?X(this.cachedPermissions):new ye(t=>{this.permissionService.loadAllPermissions().then(()=>{this.cachedPermissions=this.permissionService.allPermissions(),t.next(this.cachedPermissions),t.complete()}).catch(e=>{console.error("Error loading permissions:",e),t.next([]),t.complete()})})}getPermissionSummary(t){let e=this.extractRolePermissions(t.roles),i=t.userPermissions.filter(d=>d.isGranted),a=t.userPermissions.filter(d=>!d.isGranted),l=this.calculateEffectivePermissions(e,i.map(d=>d.permission),a.map(d=>d.permission));return{totalRolePermissions:e.length,grantedPermissions:i.length,deniedPermissions:a.length,effectivePermissions:l,rolePermissions:e,userGranted:i,userDenied:a}}clearCache(){this.cachedUsers.clear(),this.cachedPermissions=[]}clearUserCache(t){this.cachedUsers.delete(t)}loadUserWithPermissions(t){return new ye(e=>{this.loadUserWithPermissionsAsync(t).then(i=>{e.next(i),e.complete()}).catch(i=>{console.error("Error in loadUserWithPermissions:",i),e.next(null),e.complete()})})}loadUserWithPermissionsAsync(t){return b(this,null,function*(){try{let e=yield this.userService.getUserById(t);if(!e)return null;let i=yield this.userPermissionService.getUserPermissions(t);return{id:e.id,email:e.email,SDT:e.SDT,isActive:e.isActive,profile:e.profile,roles:e.roles||[],userPermissions:i.map(l=>({id:l.id,isGranted:l.isGranted,permission:l.permission?{id:l.permission.id,name:l.permission.name,code:l.permission.codeId||"",description:l.permission.description,isActive:!0,createdAt:new Date,updatedAt:new Date}:{id:"",name:"Unknown Permission",code:"",description:"",isActive:!1,createdAt:new Date,updatedAt:new Date},createdAt:l.createdAt,updatedAt:l.updatedAt}))}}catch(e){return console.error("Error in loadUserWithPermissionsAsync:",e),null}})}extractRolePermissions(t){let e=new Map;return t.forEach(i=>{let a=i.role;a&&a.permissions&&a.permissions.forEach(l=>{if(l&&l.id){let d={id:l.id,name:l?.permission?.name,code:l?.permission?.codeId||l?.permission?.code||"",description:l.description,isActive:!0,createdAt:new Date,updatedAt:new Date};e.set(l.id,d)}})}),Array.from(e.values())}calculateEffectivePermissions(t,e,i){let a=new Map;return t.forEach(l=>{a.set(l.id,l)}),e.forEach(l=>{if(l&&l.id){let d={id:l.id,name:l.name,code:l.codeId||l.code||"",description:l.description,isActive:!0,createdAt:new Date,updatedAt:new Date};a.set(l.id,d)}}),i.forEach(l=>{l&&l.id&&a.delete(l.id)}),Array.from(a.values())}static \u0275fac=function(e){return new(e||o)};static \u0275prov=ee({token:o,factory:o.\u0275fac,providedIn:"root"})};var yt=(o,t)=>t.id||t.roleId,Pt=(o,t)=>t.id||t.name;function St(o,t){if(o&1&&(r(0,"div",7)(1,"small",8),s(2),n()()),o&2){let e,i=c();m(2),v("\u2705 UserRolesInfoComponent loaded - User: ",((e=i.user())==null?null:e.email)||((e=i.user())==null?null:e.name)||((e=i.user())==null?null:e.id),"")}}function wt(o,t){if(o&1&&(r(0,"p",14),s(1),n()),o&2){let e=c().$implicit;m(),v(" ",(e.role==null?null:e.role.description)||e.description," ")}}function Dt(o,t){if(o&1&&(r(0,"span",15),s(1),n()),o&2){let e=c().$implicit,i=c(2);m(),v(" ",i.getRolePermissions(e).length," quy\u1EC1n ")}}function Mt(o,t){if(o&1&&(r(0,"span",20),s(1),n()),o&2){let e=t.$implicit;p("title",e.description||e.name),m(),v(" ",e.permission.name," ")}}function Rt(o,t){if(o&1){let e=y();r(0,"button",22),_("click",function(){f(e);let a=c(2).$implicit,l=c(2);return x(l.toggleShowPermissions(a.id||a.roleId))}),s(1),n()}if(o&2){let e=c(2).$implicit,i=c(2);m(),v(" ",i.showAllPermissions[e.id||e.roleId]?"Thu g\u1ECDn":"..."+(i.getRolePermissions(e).length-4)+" n\u1EEFa"," ")}}function kt(o,t){if(o&1&&(r(0,"div",16)(1,"div",19),S(2,Mt,2,2,"span",20,Pt),u(4,Rt,2,1,"button",21),n()()),o&2){let e=c().$implicit,i=c(2);m(2),w(i.getRolePermissions(e).slice(0,i.showAllPermissions[e.id||e.roleId]?i.getRolePermissions(e).length:4)),m(2),C(i.getRolePermissions(e).length>4?4:-1)}}function Ut(o,t){o&1&&(r(0,"div",17)(1,"mat-icon",23),s(2,"block"),n(),r(3,"p"),s(4,"Kh\xF4ng c\xF3 quy\u1EC1n"),n()())}function Tt(o,t){if(o&1&&(r(0,"div",18)(1,"mat-icon",24),s(2,"schedule"),n(),r(3,"span",25),s(4),n()()),o&2){let e=c().$implicit,i=c(2);m(4),v(" G\xE1n l\xFAc: ",i.formatDate(e.assignedAt||e.createdAt)," ")}}function It(o,t){if(o&1&&(r(0,"div",9)(1,"div",10)(2,"div",11)(3,"mat-icon",12),s(4),n(),r(5,"div")(6,"h4",13),s(7),n(),u(8,wt,2,1,"p",14),n()(),u(9,Dt,2,1,"span",15),n(),u(10,kt,5,1,"div",16)(11,Ut,5,0,"div",17)(12,Tt,5,1,"div",18),n()),o&2){let e=t.$implicit,i=c(2);m(4),v(" ",i.getRoleIcon((e.role==null?null:e.role.name)||e.name)," "),m(3),v(" ",(e.role==null?null:e.role.name)||e.name," "),m(),C(e.role!=null&&e.role.description||e.description?8:-1),m(),C(i.getRolePermissions(e).length>0?9:-1),m(),C(i.getRolePermissions(e).length>0?10:11),m(2),C(e.assignedAt||e.createdAt?12:-1)}}function Ft(o,t){if(o&1&&(r(0,"div",5),S(1,It,13,6,"div",9,yt),n()),o&2){let e=c();m(),w(e.user().roles)}}function At(o,t){o&1&&(r(0,"div",6)(1,"mat-icon",26),s(2,"person_outline"),n(),r(3,"p",27),s(4,"Ch\u01B0a c\xF3 vai tr\xF2 n\xE0o"),n(),r(5,"p",4),s(6,"User n\xE0y ch\u01B0a \u0111\u01B0\u1EE3c g\xE1n vai tr\xF2 n\xE0o"),n()())}var Ce=class o{user=J();showAllPermissions={};constructor(){ne(()=>{})}getRolePermissions(t){return t.role?.permissions||t.permissions||t.role?.rolePermissions?.map(i=>i.permission)||[]}getRoleIcon(t){if(!t)return"person";let e=t.toLowerCase();return e.includes("admin")?"admin_panel_settings":e.includes("manager")||e.includes("qu\u1EA3n l\xFD")?"manage_accounts":e.includes("user")||e.includes("ng\u01B0\u1EDDi d\xF9ng")?"person":e.includes("guest")||e.includes("kh\xE1ch")?"person_outline":e.includes("moderator")?"gavel":e.includes("editor")?"edit":e.includes("viewer")?"visibility":"group"}toggleShowPermissions(t){this.showAllPermissions[t]=!this.showAllPermissions[t]}formatDate(t){return t?new Date(t).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=k({type:o,selectors:[["app-user-roles-info"]],inputs:{user:[1,"user"]},decls:12,vars:3,consts:[["class","mb-2 p-2 bg-blue-50 border border-blue-200 rounded",4,"ngIf"],[1,"roles-info"],[1,"text-sm","font-medium","flex","items-center"],[1,"mr-2","text-blue-500"],[1,"text-xs"],[1,"space-y-4"],[1,"text-center","py-6","text-gray-500"],[1,"mb-2","p-2","bg-blue-50","border","border-blue-200","rounded"],[1,"text-blue-700"],[1,"border","rounded-lg","p-3","bg-gray-50"],[1,"flex","items-center","justify-between","mb-2"],[1,"flex","items-center"],[1,"mr-2","text-blue-600"],[1,"font-medium","text-sm","text-gray-800"],[1,"text-xs","text-gray-600"],[1,"px-2","py-1","text-xs","bg-blue-100","text-blue-800","rounded-full"],[1,"mt-2"],[1,"text-center","text-gray-400","text-xs","py-2"],[1,"flex","items-center","mt-2","pt-2","border-t","border-gray-200"],[1,"flex","flex-wrap","gap-1"],[1,"px-2","py-1","text-xs","bg-white","border","border-blue-200","text-blue-700","rounded",3,"title"],["mat-button","",1,"!text-xs","!p-1","!min-w-0","text-blue-600"],["mat-button","",1,"!text-xs","!p-1","!min-w-0","text-blue-600",3,"click"],[1,"text-gray-300"],[1,"mr-1","text-gray-400",2,"font-size","14px"],[1,"text-xs","text-gray-500"],[1,"text-4xl","text-gray-300"],[1,"mt-2","text-sm"]],template:function(e,i){if(e&1&&(u(0,St,3,1,"div",0),r(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title",2)(4,"mat-icon",3),s(5,"groups"),n(),s(6," Vai Tr\xF2 & Quy\u1EC1n "),n(),r(7,"mat-card-subtitle",4),s(8),n()(),r(9,"mat-card-content"),u(10,Ft,3,0,"div",5)(11,At,7,0,"div",6),n()()),e&2){let a,l;p("ngIf",i.user()),m(8),v(" ",((a=i.user())==null||a.roles==null?null:a.roles.length)||0," vai tr\xF2 \u0111\u01B0\u1EE3c g\xE1n "),m(2),C((l=i.user())!=null&&l.roles&&i.user().roles.length>0?10:11)}},dependencies:[U,q,K,N,$,H,ge,j,A,F,B,I,T],styles:[".roles-info[_ngcontent-%COMP%]{border-left:4px solid #2196f3}.roles-info[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{padding-bottom:8px}.roles-info[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{font-size:12px}.roles-info[_ngcontent-%COMP%]   .border[_ngcontent-%COMP%]:hover{border-color:#2196f3;background-color:#f3f4f6}"]})};var Vt=(o,t)=>t.id;function Gt(o,t){if(o&1){let e=y();r(0,"button",58),_("click",function(){f(e);let a=c();return x(a.clearSearch())}),r(1,"mat-icon"),s(2,"clear"),n()()}}function qt(o,t){o&1&&(r(0,"div",44)(1,"mat-icon",59),s(2,"search_off"),n(),r(3,"p",60),s(4,"Kh\xF4ng t\xECm th\u1EA5y quy\u1EC1n n\xE0o"),n(),r(5,"p",61),s(6,"Th\u1EED t\xECm ki\u1EBFm v\u1EDBi t\u1EEB kh\xF3a kh\xE1c"),n()())}function Qt(o,t){if(o&1&&(r(0,"p",69),s(1),n()),o&2){let e=c().$implicit;m(),v(" ",e.description," ")}}function zt(o,t){if(o&1&&(r(0,"p",70),s(1),n()),o&2){let e=c().$implicit,i=c(2);m(),v(" ID: ",i.getPermissionCode(e)," ")}}function Wt(o,t){o&1&&(r(0,"span",77)(1,"mat-icon",80),s(2,"group"),n(),s(3," T\u1EEB vai tr\xF2 "),n())}function Nt(o,t){o&1&&(r(0,"span",78)(1,"mat-icon",80),s(2,"check_circle"),n(),s(3," \u0110\xE3 c\u1EA5p ri\xEAng "),n())}function jt(o,t){o&1&&(r(0,"span",79)(1,"mat-icon",80),s(2,"block"),n(),s(3," \u0110\xE3 t\u1EEB ch\u1ED1i "),n())}function $t(o,t){if(o&1&&u(0,Wt,4,0,"span",77)(1,Nt,4,0,"span",78)(2,jt,4,0,"span",79),o&2){let e=t;C(e==="role"?0:e==="granted"?1:e==="denied"?2:-1)}}function Ht(o,t){o&1&&(r(0,"span",72)(1,"mat-icon",80),s(2,"radio_button_unchecked"),n(),s(3," Ch\u01B0a thi\u1EBFt l\u1EADp "),n())}function Kt(o,t){if(o&1&&(r(0,"span",73)(1,"mat-icon",80),s(2,"folder"),n(),s(3),n()),o&2){let e=c().$implicit,i=c(2);m(3),v(" ",i.getPermissionGroup(e)," ")}}function Yt(o,t){if(o&1){let e=y();r(0,"button",81),_("click",function(a){f(e);let l=c().$implicit;return c(2).togglePermission(l,!0),x(a.stopPropagation())}),r(1,"mat-icon",82),s(2,"add_circle_outline"),n()()}}function Xt(o,t){if(o&1){let e=y();r(0,"button",83),_("click",function(a){f(e);let l=c().$implicit;return c(2).togglePermission(l,!1),x(a.stopPropagation())}),r(1,"mat-icon",82),s(2,"remove_circle_outline"),n()()}}function Jt(o,t){if(o&1){let e=y();r(0,"div",63),_("click",function(){let a=f(e).$implicit,l=c(2);return x(l.togglePermissionByClick(a))}),r(1,"div",64)(2,"mat-checkbox",65),_("change",function(a){let l=f(e).$implicit,d=c(2);return x(d.togglePermission(l,a.checked))})("click",function(a){return f(e),x(a.stopPropagation())}),n(),r(3,"div",66)(4,"div",67)(5,"div",66)(6,"h5",68),s(7),n(),u(8,Qt,2,1,"p",69)(9,zt,2,1,"p",70),n()(),r(10,"div",71)(11,"div",27),u(12,$t,3,1)(13,Ht,4,0,"span",72)(14,Kt,4,1,"span",73),n(),r(15,"div",74),u(16,Yt,3,0,"button",75)(17,Xt,3,0,"button",76),n()()()()()}if(o&2){let e,i=t.$implicit,a=c(2);te("bg-blue-50",a.isPermissionSelected(i))("border-l-4",a.isPermissionSelected(i))("border-l-blue-500",a.isPermissionSelected(i))("shadow-sm",a.isPermissionSelected(i)),m(2),p("checked",a.isPermissionSelected(i))("disabled",a.isPermissionDisabled(i)),m(5),v(" ",i.name," "),m(),C(i.description?8:-1),m(),C(a.getPermissionCode(i)?9:-1),m(3),C((e=a.getPermissionStatus(i))?12:13,e),m(2),C(a.getPermissionGroup(i)?14:-1),m(2),C(a.isPermissionSelected(i)?17:16)}}function Zt(o,t){if(o&1&&(r(0,"div",45),S(1,Jt,18,16,"div",62,Vt),n()),o&2){let e=c();m(),w(e.filteredPermissions())}}function ei(o,t){if(o&1&&(r(0,"span",57),s(1),n()),o&2){let e=c();m(),v(" ",e.selectedPermissions().length," ")}}var ve=class o{dialogRef=E($e);data=E(He);searchTerm="";grantType="grant";reason="";selectedPermissions=h([]);filteredPermissions=h([]);permissionGroups=h([]);constructor(){this.filteredPermissions.set(this.data.availablePermissions)}filterPermissions(){let t=this.searchTerm.toLowerCase(),e=this.data.availablePermissions;t&&(e=e.filter(i=>i.name.toLowerCase().includes(t)||i.description&&i.description.toLowerCase().includes(t)||this.getPermissionGroup(i).toLowerCase().includes(t))),this.filteredPermissions.set(e)}getPermissionCode(t){return t.code||""}getPermissionGroup(t){return t.group||"Kh\xE1c"}isPermissionSelected(t){return this.selectedPermissions().some(e=>e.id===t.id)}isPermissionDisabled(t){return!1}getPermissionStatus(t){if(this.data.currentRolePermissions.some(a=>a.id===t.id))return"role";let i=this.data.currentUserPermissions.find(a=>a.permission.id===t.id);return i?i.isGranted?"granted":"denied":null}togglePermission(t,e){let i=this.selectedPermissions();e?this.isPermissionSelected(t)||this.selectedPermissions.set([...i,t]):this.selectedPermissions.set(i.filter(a=>a.id!==t.id))}clearSearch(){this.searchTerm="",this.filterPermissions()}selectAllVisible(){let t=[];this.filteredPermissions().forEach(e=>{!this.isPermissionDisabled(e)&&!this.isPermissionSelected(e)&&t.push(e)}),this.selectedPermissions.set([...this.selectedPermissions(),...t])}clearSelection(){this.selectedPermissions.set([])}isAllSelected(){let t=this.filteredPermissions().filter(e=>!this.isPermissionDisabled(e));return t.length>0&&t.every(e=>this.isPermissionSelected(e))}isAllIndeterminate(){let t=this.filteredPermissions().filter(i=>!this.isPermissionDisabled(i)),e=t.filter(i=>this.isPermissionSelected(i)).length;return e>0&&e<t.length}toggleAll(t){let e=this.filteredPermissions().filter(i=>!this.isPermissionDisabled(i));if(t){let i=e.filter(a=>!this.isPermissionSelected(a));this.selectedPermissions.set([...this.selectedPermissions(),...i])}else{let i=e.map(a=>a.id);this.selectedPermissions.set(this.selectedPermissions().filter(a=>!i.includes(a.id)))}}togglePermissionByClick(t){this.isPermissionDisabled(t)||this.togglePermission(t,!this.isPermissionSelected(t))}onCancel(){this.dialogRef.close()}onConfirm(){let t={selectedPermissions:this.selectedPermissions(),grantType:this.grantType,reason:this.reason.trim()||void 0};this.dialogRef.close(t)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=k({type:o,selectors:[["app-permission-selector-dialog"]],decls:113,vars:18,consts:[["mat-dialog-title","",1,"!flex","!items-center","!bg-gradient-to-r","!from-blue-50","!to-indigo-50","!p-6","!rounded-t-lg"],[1,"mr-3","text-blue-600","text-2xl"],[1,"text-xl","font-semibold","text-gray-800"],[1,"text-sm","text-gray-600","mt-1"],[1,"mat-typography","!p-6","!max-h-[70vh]","!overflow-y-auto"],[1,"space-y-6"],[1,"bg-white","border","border-gray-200","rounded-xl","p-4","shadow-sm"],[1,"flex","items-center","mb-3"],[1,"mr-2","text-indigo-500"],[1,"text-base","font-medium","text-gray-800"],[1,"grid","grid-cols-2","gap-3"],[1,"relative"],["type","radio","id","grant","name","grantType","value","grant",1,"sr-only","peer",3,"ngModelChange","ngModel"],["for","grant",1,"flex","items-center","justify-center","p-4","border-2","border-gray-200","rounded-lg","cursor-pointer","transition-all","duration-200","peer-checked:border-green-500","peer-checked:bg-green-50","hover:border-green-300","hover:bg-green-25"],[1,"text-center"],[1,"text-green-500","mb-2"],[1,"font-medium","text-gray-800"],[1,"text-xs","text-gray-500"],["type","radio","id","deny","name","grantType","value","deny",1,"sr-only","peer",3,"ngModelChange","ngModel"],["for","deny",1,"flex","items-center","justify-center","p-4","border-2","border-gray-200","rounded-lg","cursor-pointer","transition-all","duration-200","peer-checked:border-red-500","peer-checked:bg-red-50","hover:border-red-300","hover:bg-red-25"],[1,"text-red-500","mb-2"],[1,"mr-2","text-blue-500"],["appearance","outline",1,"w-full","!mb-0"],["matInput","","placeholder","Nh\u1EADp t\xEAn quy\u1EC1n, m\xF4 t\u1EA3 ho\u1EB7c nh\xF3m quy\u1EC1n...",3,"ngModelChange","ngModel"],["matPrefix","",1,"!mr-2"],["matSuffix","","mat-icon-button",""],[1,"flex","flex-wrap","gap-2","items-center","justify-between","bg-gray-50","p-3","rounded-lg"],[1,"flex","flex-wrap","gap-2"],["mat-stroked-button","","size","small",1,"!text-blue-600","!border-blue-300",3,"click"],[1,"!text-sm","mr-1"],["mat-stroked-button","","size","small",1,"!text-gray-600","!border-gray-300",3,"click"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-blue-600"],[1,"bg-white","border","border-gray-200","rounded-xl","overflow-hidden","shadow-sm"],[1,"bg-gradient-to-r","from-blue-50","to-indigo-50","p-4","border-b","border-gray-200"],[1,"flex","items-center","justify-between"],[1,"flex","items-center"],[1,"mr-3",3,"change","checked","indeterminate"],[1,"mr-2","text-blue-600"],[1,"font-semibold","text-gray-800","text-lg"],[1,"flex","items-center","space-x-3"],[1,"text-sm","text-gray-600","bg-white","px-3","py-1","rounded-full","border"],[1,"text-xs","text-blue-600","bg-blue-100","px-2","py-1","rounded"],[1,"bg-white"],[1,"text-center","py-12","text-gray-500"],[1,"max-h-[50vh]","overflow-y-auto"],[1,"mr-2","text-amber-500"],["matInput","","rows","3","placeholder","Nh\u1EADp l\xFD do c\u1EA5p ho\u1EB7c thu h\u1ED3i quy\u1EC1n n\xE0y \u0111\u1EC3 d\u1EC5 theo d\xF5i...",3,"ngModelChange","ngModel"],["matPrefix","",1,"!mr-2","!mt-3"],[1,"!p-6","!border-t","!border-gray-200","!bg-gray-50"],[1,"flex","items-center","justify-between","w-full"],[1,"flex","items-center","space-x-4"],[1,"text-sm","text-gray-600","flex","items-center"],[1,"text-blue-600","mx-1"],["mat-stroked-button","",1,"!border-gray-300","!text-gray-700","!px-6",3,"click"],[1,"mr-1"],["mat-raised-button","","color","primary",1,"!px-6","!py-2","!shadow-lg",3,"click","disabled"],[1,"ml-1","bg-white","bg-opacity-20","px-2","py-0.5","rounded-full","text-xs"],["matSuffix","","mat-icon-button","",3,"click"],[1,"text-5xl","mb-3","text-gray-300"],[1,"text-lg","font-medium"],[1,"text-sm","mt-1"],[1,"border-b","border-gray-100","last:border-b-0","hover:bg-blue-25","transition-all","duration-200","cursor-pointer",3,"bg-blue-50","border-l-4","border-l-blue-500","shadow-sm"],[1,"border-b","border-gray-100","last:border-b-0","hover:bg-blue-25","transition-all","duration-200","cursor-pointer",3,"click"],[1,"p-4","flex","items-start","space-x-4"],[1,"!mt-1","flex-shrink-0",3,"change","click","checked","disabled"],[1,"flex-1","min-w-0"],[1,"flex","items-start","justify-between"],[1,"font-semibold","text-gray-900","text-base","truncate","hover:text-blue-600","transition-colors"],[1,"text-sm","text-gray-600","mt-1","leading-relaxed","line-clamp-2"],[1,"text-xs","text-gray-500","mt-1","font-mono","bg-gray-100","px-2","py-1","rounded","inline-block"],[1,"flex","items-center","justify-between","mt-3"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-gray-100","text-gray-600"],[1,"inline-flex","items-center","px-2","py-0.5","rounded","text-xs","font-medium","bg-purple-100","text-purple-700"],[1,"flex","items-center","space-x-1","opacity-0","group-hover:opacity-100","transition-opacity"],["mat-icon-button","","size","small","matTooltip","Ch\u1ECDn quy\u1EC1n n\xE0y",1,"!text-green-600","!w-8","!h-8"],["mat-icon-button","","size","small","matTooltip","B\u1ECF ch\u1ECDn quy\u1EC1n n\xE0y",1,"!text-red-600","!w-8","!h-8"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-blue-100","text-blue-800","animate-fade-in"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-green-100","text-green-800","animate-fade-in"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-medium","bg-red-100","text-red-800","animate-fade-in"],[1,"!text-xs","mr-1"],["mat-icon-button","","size","small","matTooltip","Ch\u1ECDn quy\u1EC1n n\xE0y",1,"!text-green-600","!w-8","!h-8",3,"click"],[1,"!text-lg"],["mat-icon-button","","size","small","matTooltip","B\u1ECF ch\u1ECDn quy\u1EC1n n\xE0y",1,"!text-red-600","!w-8","!h-8",3,"click"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"mat-icon",1),s(2,"security"),n(),r(3,"div")(4,"h2",2),s(5,"Qu\u1EA3n L\xFD Quy\u1EC1n Ng\u01B0\u1EDDi D\xF9ng"),n(),r(6,"p",3),s(7,"C\u1EA5p ho\u1EB7c thu h\u1ED3i quy\u1EC1n truy c\u1EADp"),n()()(),r(8,"mat-dialog-content",4)(9,"div",5)(10,"div",6)(11,"div",7)(12,"mat-icon",8),s(13,"tune"),n(),r(14,"label",9),s(15,"Lo\u1EA1i thao t\xE1c:"),n()(),r(16,"div",10)(17,"div",11)(18,"input",12),R("ngModelChange",function(l){return M(i.grantType,l)||(i.grantType=l),l}),n(),r(19,"label",13)(20,"div",14)(21,"mat-icon",15),s(22,"add_circle_outline"),n(),r(23,"div",16),s(24,"C\u1EA5p Quy\u1EC1n"),n(),r(25,"div",17),s(26,"Cho ph\xE9p truy c\u1EADp"),n()()()(),r(27,"div",11)(28,"input",18),R("ngModelChange",function(l){return M(i.grantType,l)||(i.grantType=l),l}),n(),r(29,"label",19)(30,"div",14)(31,"mat-icon",20),s(32,"remove_circle_outline"),n(),r(33,"div",16),s(34,"Thu H\u1ED3i"),n(),r(35,"div",17),s(36,"T\u1EEB ch\u1ED1i truy c\u1EADp"),n()()()()()(),r(37,"div",6)(38,"div",7)(39,"mat-icon",21),s(40,"search"),n(),r(41,"label",9),s(42,"T\xECm ki\u1EBFm quy\u1EC1n:"),n()(),r(43,"mat-form-field",22)(44,"input",23),R("ngModelChange",function(l){return M(i.searchTerm,l)||(i.searchTerm=l),l}),_("ngModelChange",function(){return i.filterPermissions()}),n(),r(45,"mat-icon",24),s(46,"search"),n(),u(47,Gt,3,0,"button",25),n()(),r(48,"div",26)(49,"div",27)(50,"button",28),_("click",function(){return i.selectAllVisible()}),r(51,"mat-icon",29),s(52,"select_all"),n(),s(53," Ch\u1ECDn t\u1EA5t c\u1EA3 "),n(),r(54,"button",30),_("click",function(){return i.clearSelection()}),r(55,"mat-icon",29),s(56,"deselect"),n(),s(57," B\u1ECF ch\u1ECDn "),n()(),r(58,"div",31),s(59," \u0110\xE3 ch\u1ECDn: "),r(60,"span",32),s(61),n(),s(62," quy\u1EC1n "),n()(),r(63,"div",33)(64,"div",34)(65,"div",35)(66,"div",36)(67,"mat-checkbox",37),_("change",function(l){return i.toggleAll(l.checked)}),n(),r(68,"div",36)(69,"mat-icon",38),s(70,"security"),n(),r(71,"h4",39),s(72,"T\u1EA5t c\u1EA3 quy\u1EC1n h\u1EC7 th\u1ED1ng"),n()()(),r(73,"div",40)(74,"span",41),s(75),n(),r(76,"span",42),s(77),n()()()(),r(78,"div",43),u(79,qt,7,0,"div",44)(80,Zt,3,0,"div",45),n()(),r(81,"div",6)(82,"div",7)(83,"mat-icon",46),s(84,"note_add"),n(),r(85,"label",9),s(86,"Ghi ch\xFA (t\xF9y ch\u1ECDn):"),n()(),r(87,"mat-form-field",22)(88,"textarea",47),R("ngModelChange",function(l){return M(i.reason,l)||(i.reason=l),l}),n(),r(89,"mat-icon",48),s(90,"edit_note"),n()()()()(),r(91,"mat-dialog-actions",49)(92,"div",50)(93,"div",51)(94,"div",52)(95,"mat-icon",29),s(96,"info"),n(),s(97," S\u1EBD th\u1EF1c hi\u1EC7n "),r(98,"strong",32),s(99),n(),r(100,"strong",53),s(101),n(),s(102," quy\u1EC1n "),n()(),r(103,"div",40)(104,"button",54),_("click",function(){return i.onCancel()}),r(105,"mat-icon",55),s(106,"close"),n(),s(107," H\u1EE7y b\u1ECF "),n(),r(108,"button",56),_("click",function(){return i.onConfirm()}),r(109,"mat-icon",55),s(110),n(),s(111),u(112,ei,2,1,"span",57),n()()()()),e&2&&(m(18),D("ngModel",i.grantType),m(10),D("ngModel",i.grantType),m(16),D("ngModel",i.searchTerm),m(3),C(i.searchTerm?47:-1),m(14),P(i.selectedPermissions().length),m(6),p("checked",i.isAllSelected())("indeterminate",i.isAllIndeterminate()),m(8),Fe(" ",i.selectedPermissions().length,"/",i.filteredPermissions().length," \u0111\xE3 ch\u1ECDn "),m(2),v(" ",i.filteredPermissions().length," quy\u1EC1n "),m(2),C(i.filteredPermissions().length===0?79:80),m(9),D("ngModel",i.reason),m(11),P(i.grantType==="grant"?"c\u1EA5p":"thu h\u1ED3i"),m(2),P(i.selectedPermissions().length),m(7),p("disabled",i.selectedPermissions().length===0),m(2),v(" ",i.grantType==="grant"?"check_circle":"cancel"," "),m(),v(" ",i.grantType==="grant"?"C\u1EA5p Quy\u1EC1n":"Thu H\u1ED3i"," "),m(),C(i.selectedPermissions().length>0?112:-1))},dependencies:[U,le,oe,je,se,ae,W,Ye,Je,Xe,I,T,Q,A,F,ot,rt,ce,me,et,tt,ue,de,pe,B,z,ct,mt],styles:['.peer[_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]{transform:scale(1.02)}.peer[_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]:after{content:"";position:absolute;top:8px;right:8px;width:20px;height:20px;background:currentColor;border-radius:50%;opacity:.1}.transition-all[_ngcontent-%COMP%]{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.2s}.mat-mdc-checkbox.mat-primary[_ngcontent-%COMP%]   .mdc-checkbox__native-control[_ngcontent-%COMP%]:enabled ~ .mdc-checkbox__background[_ngcontent-%COMP%]   .mdc-checkbox__checkmark[_ngcontent-%COMP%]{color:#fff}.hover\\:bg-blue-25[_ngcontent-%COMP%]:hover{background-color:#eff6ff}.hover\\:bg-green-25[_ngcontent-%COMP%]:hover{background-color:#f0fdf4}.hover\\:bg-red-25[_ngcontent-%COMP%]:hover{background-color:#fef2f2}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f5f9;border-radius:4px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:4px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b8}[_nghost-%COMP%]{display:block;width:100%;max-width:900px}.animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .3s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.bg-gradient-to-r[_ngcontent-%COMP%]{background:linear-gradient(to right,var(--tw-gradient-stops))}.mat-mdc-form-field[_ngcontent-%COMP%]:focus-within{transform:translateY(-1px);box-shadow:0 4px 12px #0000001a}.mat-mdc-raised-button[_ngcontent-%COMP%]{box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -1px #0000000f}.mat-mdc-raised-button[_ngcontent-%COMP%]:hover{box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -2px #0000000d;transform:translateY(-1px)}.permission-item[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.permission-item[_ngcontent-%COMP%]:hover{transform:translate(4px)}.permission-item.selected[_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f60d,#93c5fd1a)}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.mat-mdc-checkbox[_ngcontent-%COMP%]{--mdc-checkbox-state-layer-size: 48px}.mat-mdc-checkbox[_ngcontent-%COMP%]:hover   .mdc-checkbox__ripple[_ngcontent-%COMP%]{background:#3b82f61a}.group[_ngcontent-%COMP%]:hover   .opacity-0[_ngcontent-%COMP%]{opacity:1!important}.permission-row[_ngcontent-%COMP%]{position:relative}.permission-row[_ngcontent-%COMP%]:before{content:"";position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(90deg,rgba(59,130,246,.1) 0%,transparent 100%);transition:width .3s ease}.permission-row[_ngcontent-%COMP%]:hover:before{width:100%}.status-badge[_ngcontent-%COMP%]{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#ffffffe6}.border-l-blue-500[_ngcontent-%COMP%]{border-left-width:4px;border-left-color:#3b82f6}@media (max-width: 640px){[_nghost-%COMP%]{max-width:95vw}.permission-item[_ngcontent-%COMP%]{padding:12px}.grid-cols-2[_ngcontent-%COMP%]{grid-template-columns:1fr}}']})};var Ee=(o,t)=>t.id;function ti(o,t){o&1&&G(0,"mat-spinner",4)}function ii(o,t){o&1&&(r(0,"div",6),G(1,"mat-spinner",10),r(2,"p",11),s(3,"\u0110ang t\u1EA3i th\xF4ng tin quy\u1EC1n..."),n()())}function ni(o,t){if(o&1){let e=y();r(0,"div",7)(1,"mat-icon",12),s(2,"error"),n(),r(3,"p",13),s(4),n(),r(5,"button",14),_("click",function(){f(e);let a=c();return x(a.loadPermissionData())}),r(6,"mat-icon"),s(7,"refresh"),n(),s(8," Th\u1EED l\u1EA1i "),n()()}if(o&2){let e=c();m(4),P(e.error())}}function ri(o,t){o&1&&(r(0,"mat-icon",58),s(1,"groups"),n(),s(2," Roles & Nh\xF3m Quy\u1EC1n "))}function oi(o,t){if(o&1&&G(0,"app-user-roles-info",59),o&2){let e=c(2);p("user",e.user())}}function si(o,t){o&1&&(r(0,"mat-icon",58),s(1,"dashboard"),n(),s(2," T\u1ED5ng Quan "))}function ai(o,t){if(o&1&&(r(0,"span",60),s(1),n()),o&2){let e=t.$implicit;p("title",e.description||e.name),m(),v(" ",e.name," ")}}function li(o,t){if(o&1&&(r(0,"div",36),S(1,ai,2,2,"span",60,Ee),n()),o&2){let e=c(2);m(),w(e.currentSummary().rolePermissions)}}function mi(o,t){o&1&&(r(0,"p",37),s(1,"Kh\xF4ng c\xF3 quy\u1EC1n t\u1EEB roles"),n())}function ci(o,t){if(o&1&&(r(0,"span",61),s(1),n()),o&2){let e=t.$implicit;p("title",e.description||e.name),m(),v(" ",e.name," ")}}function di(o,t){if(o&1&&(r(0,"div",36),S(1,ci,2,2,"span",61,Ee),n()),o&2){let e=c(2);m(),w(e.currentSummary().effectivePermissions)}}function ui(o,t){o&1&&(r(0,"div",9)(1,"mat-icon",62),s(2,"block"),n(),r(3,"p",63),s(4,"Ng\u01B0\u1EDDi d\xF9ng kh\xF4ng c\xF3 quy\u1EC1n n\xE0o"),n()())}function pi(o,t){o&1&&(r(0,"mat-icon",58),s(1,"settings"),n(),s(2," Qu\u1EA3n L\xFD "))}function gi(o,t){if(o&1){let e=y();r(0,"div",64)(1,"span",24),s(2),n(),r(3,"button",65),_("click",function(){let a=f(e).$implicit,l=c(3);return x(l.revokePermission(a))}),r(4,"mat-icon",5),s(5,"close"),n()()()}if(o&2){let e=t.$implicit,i=c(3);m(2),P(e.permission.name),m(),p("disabled",i.isUpdatingPermission())}}function _i(o,t){if(o&1&&(r(0,"div",36),S(1,gi,6,2,"div",64,Ee),n()),o&2){let e=c(2);m(),w(e.currentSummary().userGranted)}}function fi(o,t){o&1&&(r(0,"p",45),s(1,"Ch\u01B0a c\xF3 quy\u1EC1n n\xE0o \u0111\u01B0\u1EE3c c\u1EA5p ri\xEAng"),n())}function xi(o,t){if(o&1){let e=y();r(0,"div",66)(1,"span",27),s(2),n(),r(3,"button",67),_("click",function(){let a=f(e).$implicit,l=c(3);return x(l.restorePermission(a))}),r(4,"mat-icon",5),s(5,"refresh"),n()()()}if(o&2){let e=t.$implicit,i=c(3);m(2),P(e.permission.name),m(),p("disabled",i.isUpdatingPermission())}}function hi(o,t){if(o&1&&(r(0,"div",36),S(1,xi,6,2,"div",66,Ee),n()),o&2){let e=c(2);m(),w(e.currentSummary().userDenied)}}function Ci(o,t){o&1&&(r(0,"p",50),s(1,"Kh\xF4ng c\xF3 quy\u1EC1n n\xE0o b\u1ECB t\u1EEB ch\u1ED1i"),n())}function vi(o,t){if(o&1){let e=y();r(0,"mat-tab-group",8)(1,"mat-tab"),u(2,ri,3,0,"ng-template",15),r(3,"div",16),u(4,oi,1,1,"app-user-roles-info",17),n()(),r(5,"mat-tab"),u(6,si,3,0,"ng-template",15),r(7,"div",16)(8,"div",18)(9,"div",19)(10,"div",20),s(11),n(),r(12,"div",21),s(13,"T\u1EEB Roles"),n()(),r(14,"div",22)(15,"div",23),s(16),n(),r(17,"div",24),s(18,"\u0110\u01B0\u1EE3c C\u1EA5p"),n()(),r(19,"div",25)(20,"div",26),s(21),n(),r(22,"div",27),s(23,"B\u1ECB T\u1EEB Ch\u1ED1i"),n()(),r(24,"div",28)(25,"div",29),s(26),n(),r(27,"div",30),s(28,"Cu\u1ED1i C\xF9ng"),n()()(),r(29,"div",31)(30,"mat-expansion-panel",32)(31,"mat-expansion-panel-header")(32,"mat-panel-title",33)(33,"mat-icon",34),s(34,"groups"),n(),s(35),n()(),r(36,"div",35),u(37,li,3,0,"div",36)(38,mi,2,0,"p",37),n()(),r(39,"mat-expansion-panel",38)(40,"mat-expansion-panel-header")(41,"mat-panel-title",33)(42,"mat-icon",39),s(43,"verified_user"),n(),s(44),n()(),r(45,"div",35),u(46,di,3,0,"div",36)(47,ui,5,0,"div",9),n()()()()(),r(48,"mat-tab"),u(49,pi,3,0,"ng-template",15),r(50,"div",16)(51,"div",31)(52,"div",40)(53,"div",41)(54,"div",33)(55,"mat-icon",42),s(56,"add_circle"),n(),r(57,"h3",43),s(58,"Quy\u1EC1n \u0110\u01B0\u1EE3c C\u1EA5p Ri\xEAng"),n()(),r(59,"span",44),s(60),n()(),u(61,_i,3,0,"div",36)(62,fi,2,0,"p",45),n(),r(63,"div",46)(64,"div",41)(65,"div",33)(66,"mat-icon",47),s(67,"remove_circle"),n(),r(68,"h3",48),s(69,"Quy\u1EC1n B\u1ECB T\u1EEB Ch\u1ED1i"),n()(),r(70,"span",49),s(71),n()(),u(72,hi,3,0,"div",36)(73,Ci,2,0,"p",50),n(),r(74,"div",51)(75,"div",52)(76,"mat-icon",53),s(77,"add_task"),n(),r(78,"h3",54),s(79,"C\u1EA5p Quy\u1EC1n M\u1EDBi"),n()(),r(80,"div",55)(81,"p",56),s(82,"Ch\u1ECDn quy\u1EC1n \u0111\u1EC3 c\u1EA5p ri\xEAng cho ng\u01B0\u1EDDi d\xF9ng n\xE0y (override quy\u1EC1n t\u1EEB roles)"),n(),r(83,"button",57),_("click",function(){f(e);let a=c();return x(a.openPermissionSelector())}),r(84,"mat-icon"),s(85,"add"),n(),s(86," Th\xEAm Quy\u1EC1n "),n()()()()()()()}if(o&2){let e=c();m(4),p("ngIf",e.user()),m(7),P(e.currentSummary().totalRolePermissions),m(5),P(e.currentSummary().grantedPermissions),m(5),P(e.currentSummary().deniedPermissions),m(5),P(e.currentSummary().effectivePermissions.length),m(4),p("expanded",!0),m(5),v(" Quy\u1EC1n t\u1EEB Roles (",e.currentSummary().rolePermissions.length,") "),m(2),C(e.currentSummary().rolePermissions.length>0?37:38),m(7),v(" Quy\u1EC1n Cu\u1ED1i C\xF9ng (",e.currentSummary().effectivePermissions.length,") "),m(2),C(e.currentSummary().effectivePermissions.length>0?46:47),m(14),v(" ",e.currentSummary().userGranted.length," "),m(),C(e.currentSummary().userGranted.length>0?61:62),m(10),v(" ",e.currentSummary().userDenied.length," "),m(),C(e.currentSummary().userDenied.length>0?72:73),m(11),p("disabled",e.isUpdatingPermission())}}function bi(o,t){o&1&&(r(0,"div",9)(1,"mat-icon",62),s(2,"info"),n(),r(3,"p",63),s(4,"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u quy\u1EC1n"),n()())}var be=class o{userPermissionService=E(he);userPermissionGraphQLService=E(_e);dialog=E(Ke);snackBar=E(re);userId=J.required();user=J();isLoading=h(!1);isUpdatingPermission=h(!1);summary=h(null);error=h(null);availablePermissions=h([]);currentSummary=O(()=>this.summary());constructor(){ne(()=>{let t=this.userId();t&&t!=="new"?(this.error.set(null),this.summary.set(null),setTimeout(()=>{this.loadPermissionData(),this.loadAvailablePermissions()},0)):(this.summary.set(null),this.error.set(null))})}loadPermissionData(){return b(this,null,function*(){let t=this.userId();if(!t||t==="new"){this.summary.set(null),this.error.set(null);return}this.isLoading.set(!0),this.error.set(null);try{let e=yield new Promise((i,a)=>{this.userPermissionService.getUserPermissionDetails(t).subscribe({next:l=>i(l),error:l=>a(l)})});if(e){let i=this.userPermissionService.getPermissionSummary(e);this.summary.set(i),this.error.set(null)}else this.summary.set(null),this.error.set("Kh\xF4ng t\xECm th\u1EA5y d\u1EEF li\u1EC7u ng\u01B0\u1EDDi d\xF9ng")}catch(e){console.error("Error loading permission data:",e),this.summary.set(null),this.error.set("L\u1ED7i khi t\u1EA3i th\xF4ng tin quy\u1EC1n. Vui l\xF2ng th\u1EED l\u1EA1i.")}finally{this.isLoading.set(!1)}})}loadAvailablePermissions(){return b(this,null,function*(){try{let t=yield new Promise((e,i)=>{this.userPermissionService.getAllPermissions().subscribe({next:a=>e(a),error:a=>i(a)})});this.availablePermissions.set(t)}catch(t){console.error("Error loading available permissions:",t)}})}revokePermission(t){return b(this,null,function*(){if(!(!t||this.isUpdatingPermission())){this.isUpdatingPermission.set(!0);try{yield this.userPermissionGraphQLService.updateUserPermission(t.id,{isGranted:!1,grantedBy:"system",reason:"Revoked by admin"}),yield this.loadPermissionData()}catch(e){console.error("Error revoking permission:",e),this.error.set("L\u1ED7i khi thu h\u1ED3i quy\u1EC1n")}finally{this.isUpdatingPermission.set(!1)}}})}restorePermission(t){return b(this,null,function*(){if(!(!t||this.isUpdatingPermission())){this.isUpdatingPermission.set(!0);try{yield this.userPermissionGraphQLService.updateUserPermission(t.id,{isGranted:!0,grantedBy:"system",reason:"Restored by admin"}),yield this.loadPermissionData()}catch(e){console.error("Error restoring permission:",e),this.error.set("L\u1ED7i khi kh\xF4i ph\u1EE5c quy\u1EC1n")}finally{this.isUpdatingPermission.set(!1)}}})}openPermissionSelector(){let t=this.summary();if(!t||this.isUpdatingPermission())return;this.dialog.open(ve,{width:"90vw",maxHeight:"90vh",data:{availablePermissions:this.availablePermissions(),currentUserPermissions:t.userGranted.concat(t.userDenied),currentRolePermissions:t.rolePermissions}}).afterClosed().subscribe(i=>b(this,null,function*(){i&&i.selectedPermissions.length>0&&(yield this.processPermissionChanges(i))}))}processPermissionChanges(t){return b(this,null,function*(){if(this.isUpdatingPermission())return;this.isUpdatingPermission.set(!0);let e=this.userId(),i=0,a=0;try{for(let d of t.selectedPermissions)try{let g=this.summary()?.userGranted.concat(this.summary()?.userDenied||[]).find(L=>L.permission.id===d.id);g?yield this.userPermissionGraphQLService.updateUserPermission(g.id,{isGranted:t.grantType==="grant",grantedBy:"admin",reason:t.reason}):yield this.userPermissionGraphQLService.assignPermissionToUser({userId:e,permissionId:d.id,isGranted:t.grantType==="grant",grantedBy:"admin",reason:t.reason}),i++}catch(g){console.error(`Error processing permission ${d.name}:`,g),a++}let l=t.grantType==="grant"?"c\u1EA5p":"t\u1EEB ch\u1ED1i";i>0?this.snackBar.open(`\u0110\xE3 ${l} ${i} quy\u1EC1n th\xE0nh c\xF4ng${a>0?`, ${a} l\u1ED7i`:""}`,"\u0110\xF3ng",{duration:5e3}):a>0&&this.snackBar.open(`L\u1ED7i khi ${l} quy\u1EC1n`,"\u0110\xF3ng",{duration:5e3}),yield this.loadPermissionData()}finally{this.isUpdatingPermission.set(!1)}})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=k({type:o,selectors:[["app-user-permission-overview"]],inputs:{userId:[1,"userId"],user:[1,"user"]},decls:15,vars:2,consts:[[1,"permission-overview"],[1,"permission-main-card"],[1,"text-lg","font-medium","flex","items-center"],[1,"mr-2","text-indigo-500"],["diameter","16",1,"ml-2"],[1,"text-sm"],[1,"text-center","py-8"],[1,"text-center","py-8","text-red-500"],["animationDuration","300ms"],[1,"text-center","py-8","text-gray-500"],["diameter","48"],[1,"mt-4","text-gray-600"],[1,"text-4xl","text-red-400"],[1,"mt-2","font-medium"],["mat-raised-button","","color","primary",1,"mt-4",3,"click"],["mat-tab-label",""],[1,"py-4"],[3,"user",4,"ngIf"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mb-6"],[1,"text-center","p-4","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"text-2xl","font-bold","text-blue-600"],[1,"text-sm","text-blue-800","font-medium"],[1,"text-center","p-4","bg-green-50","rounded-lg","border","border-green-200"],[1,"text-2xl","font-bold","text-green-600"],[1,"text-sm","text-green-800","font-medium"],[1,"text-center","p-4","bg-red-50","rounded-lg","border","border-red-200"],[1,"text-2xl","font-bold","text-red-600"],[1,"text-sm","text-red-800","font-medium"],[1,"text-center","p-4","bg-purple-50","rounded-lg","border","border-purple-200"],[1,"text-2xl","font-bold","text-purple-600"],[1,"text-sm","text-purple-800","font-medium"],[1,"space-y-6"],[1,"permission-section",3,"expanded"],[1,"flex","items-center"],[1,"mr-2","text-blue-500"],[1,"pt-4"],[1,"flex","flex-wrap","gap-2"],[1,"text-gray-500","text-center","py-4"],[1,"permission-section"],[1,"mr-2","text-purple-500"],[1,"bg-green-50","rounded-lg","p-4","border","border-green-200"],[1,"flex","items-center","justify-between","mb-4"],[1,"mr-2","text-green-600"],[1,"text-lg","font-medium","text-green-800"],[1,"px-3","py-1","bg-green-200","text-green-800","rounded-full","text-sm","font-medium"],[1,"text-green-700","text-center","py-4"],[1,"bg-red-50","rounded-lg","p-4","border","border-red-200"],[1,"mr-2","text-red-600"],[1,"text-lg","font-medium","text-red-800"],[1,"px-3","py-1","bg-red-200","text-red-800","rounded-full","text-sm","font-medium"],[1,"text-red-700","text-center","py-4"],[1,"bg-gray-50","rounded-lg","p-4","border","border-gray-200"],[1,"flex","items-center","mb-4"],[1,"mr-2","text-gray-600"],[1,"text-lg","font-medium","text-gray-800"],[1,"space-y-3"],[1,"text-sm","text-gray-600"],["mat-raised-button","","color","primary",3,"click","disabled"],[1,"mr-2"],[3,"user"],[1,"px-3","py-1","text-sm","bg-blue-100","text-blue-800","rounded-full","border","border-blue-200",3,"title"],[1,"px-3","py-1","text-sm","bg-purple-100","text-purple-800","rounded-full","border","border-purple-200","font-medium",3,"title"],[1,"text-4xl","text-gray-400"],[1,"mt-2"],[1,"flex","items-center","bg-white","rounded-lg","px-3","py-2","border","border-green-300"],["mat-icon-button","","color","warn","title","Thu h\u1ED3i quy\u1EC1n",1,"ml-2","w-6","h-6",3,"click","disabled"],[1,"flex","items-center","bg-white","rounded-lg","px-3","py-2","border","border-red-300"],["mat-icon-button","","color","primary","title","Kh\xF4i ph\u1EE5c quy\u1EC1n",1,"ml-2","w-6","h-6",3,"click","disabled"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"mat-card",1)(2,"mat-card-header")(3,"mat-card-title",2)(4,"mat-icon",3),s(5,"admin_panel_settings"),n(),s(6," Qu\u1EA3n L\xFD Quy\u1EC1n H\u1EA1n "),u(7,ti,1,0,"mat-spinner",4),n(),r(8,"mat-card-subtitle",5),s(9," T\xF3m t\u1EAFt v\xE0 qu\u1EA3n l\xFD quy\u1EC1n chi ti\u1EBFt cho ng\u01B0\u1EDDi d\xF9ng "),n()(),r(10,"mat-card-content"),u(11,ii,4,0,"div",6)(12,ni,9,1,"div",7)(13,vi,87,15,"mat-tab-group",8)(14,bi,5,0,"div",9),n()()()),e&2&&(m(7),C(i.isLoading()?7:-1),m(4),C(i.isLoading()?11:i.error()?12:i.currentSummary()?13:14))},dependencies:[U,q,K,N,$,H,ge,j,A,F,B,at,st,I,T,Q,z,xt,gt,_t,ft,Ne,Qe,ze,We,W,Ce],styles:[".permission-overview[_ngcontent-%COMP%]{width:100%}.permission-main-card[_ngcontent-%COMP%]{border-left:4px solid #4f46e5;box-shadow:0 4px 6px -1px #0000001a}.permission-section[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a}.permission-section[_ngcontent-%COMP%]   mat-expansion-panel-header[_ngcontent-%COMP%]{background-color:#f8fafc}  .mat-mdc-tab-group .mat-mdc-tab-header{border-bottom:2px solid #e2e8f0}"]})};function Ei(o,t){if(o&1){let e=y();r(0,"button",3),_("click",function(){f(e);let a=c();return x(a.handleUserAction())}),r(1,"mat-icon"),s(2,"save"),n()()}}function yi(o,t){if(o&1){let e=y();r(0,"button",3),_("click",function(){f(e);let a=c();return x(a.toggleEdit())}),r(1,"mat-icon"),s(2,"edit"),n()()}}function Pi(o,t){if(o&1){let e=y();r(0,"button",10),_("click",function(){f(e);let a=c();return x(a.toggleDelete())}),r(1,"mat-icon"),s(2,"delete"),n()()}}function Si(o,t){if(o&1){let e=y();Se(0),r(1,"div",11)(2,"div",12),s(3,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),n(),r(4,"div",13)(5,"button",14),_("click",function(){f(e);let a=c();return x(a.DeleteData())}),s(6,"\u0110\u1ED3ng \xDD"),n(),r(7,"button",15),_("click",function(){f(e);let a=c();return x(a.toggleDelete())}),s(8,"Hu\u1EF7 B\u1ECF"),n()()(),we()}}function wi(o,t){o&1&&(r(0,"mat-icon",42),s(1,"refresh"),n())}function Di(o,t){if(o&1){let e=y();r(0,"mat-icon",44),_("click",function(){f(e);let a=c().$implicit,l=c(3);return x(l.handleRemoveRole(a))}),s(1," close "),n()}o&2&&Ie("cursor","pointer")}function Mi(o,t){if(o&1&&(r(0,"mat-chip-listbox")(1,"mat-chip-option",39)(2,"div",40)(3,"span",41),s(4),n(),u(5,wi,2,0,"mat-icon",42)(6,Di,2,2,"mat-icon",43),n()()()),o&2){let e=t.$implicit,i=c(3);m(),te("opacity-50",i.isRemovingRole()),m(3),P((e==null||e.role==null?null:e.role.name)||(e==null?null:e.name)),m(),C(i.isRemovingRole()?5:i.isEdit()?6:-1)}}function Ri(o,t){if(o&1&&(r(0,"div",28),S(1,Mi,7,4,"mat-chip-listbox",null,Pe),n()),o&2){let e=c(2);m(),w(e.DetailUser().roles)}}function ki(o,t){if(o&1&&(r(0,"button",47)(1,"mat-icon"),s(2,"add"),n(),s(3," Th\xEAm nh\xF3m \u0111\u1EA7u ti\xEAn "),n()),o&2){c(2);let e=ie(35);p("matMenuTriggerFor",e)}}function Ui(o,t){if(o&1&&(r(0,"div",29)(1,"mat-icon",45),s(2,"group_off"),n(),r(3,"p",46),s(4,"Ch\u01B0a c\xF3 nh\xF3m quy\u1EC1n n\xE0o"),n(),u(5,ki,4,1,"button",47),n()),o&2){let e=c(2);m(5),C(e.isEdit()?5:-1)}}function Ti(o,t){if(o&1){let e=y();r(0,"button",48),_("click",function(){let a=f(e).$implicit,l=c(2);return x(l.handleAddRole(a))}),s(1),n()}if(o&2){let e=t.$implicit;m(),P(e.name)}}function Ii(o,t){if(o&1&&G(0,"app-user-permission-overview",53),o&2){let e,i=c(3);p("userId",(e=i.DetailUser())==null?null:e.id)("user",i.DetailUser())}}function Fi(o,t){o&1&&(r(0,"div",54)(1,"mat-icon",55),s(2,"refresh"),n(),r(3,"p",56),s(4,"\u0110ang t\u1EA3i th\xF4ng tin quy\u1EC1n..."),n()())}function Ai(o,t){if(o&1&&(r(0,"div",49)(1,"div",50),u(2,Ii,1,2,"app-user-permission-overview",51)(3,Fi,5,0,"div",52),n()()),o&2){let e,i=c(2);m(2),p("ngIf",i.DetailUser()&&((e=i.DetailUser())==null?null:e.id)&&!i.isLoading()),m(),p("ngIf",i.isLoading())}}function Bi(o,t){o&1&&(r(0,"div",49)(1,"div",50)(2,"div",57)(3,"mat-icon",58),s(4,"info"),n(),r(5,"p",59),s(6,"L\u01B0u user tr\u01B0\u1EDBc \u0111\u1EC3 qu\u1EA3n l\xFD quy\u1EC1n \u0111\u1EB7c bi\u1EC7t"),n(),r(7,"p",60),s(8,"Sau khi t\u1EA1o user, b\u1EA1n c\xF3 th\u1EC3 c\u1EA5p/thu h\u1ED3i quy\u1EC1n ri\xEAng"),n()()()())}function Oi(o,t){if(o&1){let e=y();Se(0),r(1,"div",16)(2,"mat-form-field",17)(3,"mat-label"),s(4,"Email"),n(),r(5,"input",18),R("ngModelChange",function(a){f(e);let l=c();return M(l.DetailUser().email,a)||(l.DetailUser().email=a),x(a)}),n()(),r(6,"mat-form-field",17)(7,"mat-label"),s(8,"H\u1ECD V\xE0 T\xEAn"),n(),r(9,"input",19),_("input",function(a){f(e);let l=c();return x(l.updateUserName(a))}),n()(),r(10,"mat-form-field",17)(11,"mat-label"),s(12,"S\u1ED1 \u0110i\u1EC7n Tho\u1EA1i"),n(),r(13,"input",20),R("ngModelChange",function(a){f(e);let l=c();return M(l.DetailUser().SDT,a)||(l.DetailUser().SDT=a),x(a)}),n()(),r(14,"mat-form-field",17)(15,"mat-label"),s(16,"M\u1EADt Kh\u1EA9u "),n(),r(17,"input",21),R("ngModelChange",function(a){f(e);let l=c();return M(l.DetailUser().password,a)||(l.DetailUser().password=a),x(a)}),n()(),r(18,"div",22)(19,"button",23,0)(21,"mat-icon"),s(22,"add"),n(),s(23," Th\xEAm Nh\xF3m "),n()(),r(24,"div",24)(25,"mat-card",25)(26,"mat-card-header")(27,"mat-card-title",26)(28,"mat-icon",27),s(29,"groups"),n(),s(30),n()(),r(31,"mat-card-content"),u(32,Ri,3,0,"div",28)(33,Ui,6,1,"div",29),n()()(),r(34,"mat-menu",null,1)(36,"div",30),_("click",function(a){return f(e),x(a.stopPropagation())}),r(37,"div",31)(38,"input",32),_("keyup",function(a){f(e);let l=c();return x(l.doFilterHederColumn(a))}),n(),r(39,"div",33)(40,"span",34),s(41,"search"),n()()(),r(42,"div",35),S(43,Ti,2,1,"button",36,Pe),n(),r(45,"div",37)(46,"button",15),_("click",function(){f(e);let a=ie(20);return x(a.closeMenu())}),s(47,"\u0110\xF3ng"),n()()()(),u(48,Ai,4,2,"div",38)(49,Bi,9,0,"div",38),n(),we()}if(o&2){let e,i,a,l,d=ie(35),g=c();m(5),D("ngModel",g.DetailUser().email),p("disabled",!g.isEdit()),m(4),p("value",((e=g.DetailUser())==null?null:e.name)||"")("disabled",!g.isEdit()),m(4),D("ngModel",g.DetailUser().SDT),p("disabled",!g.isEdit()),m(4),D("ngModel",g.DetailUser().password),p("disabled",!g.isEdit()),m(2),p("disabled",!g.isEdit()||g.isAddingRole())("matMenuTriggerFor",d),m(11),v(" Nh\xF3m Quy\u1EC1n (",((i=g.DetailUser().roles)==null?null:i.length)||0,") "),m(2),C(g.DetailUser().roles&&g.DetailUser().roles.length>0?32:33),m(11),w(g.FilterRole()),m(5),p("ngIf",((a=g.DetailUser())==null?null:a.id)&&((a=g.DetailUser())==null?null:a.id)!=="new"),m(),p("ngIf",((l=g.DetailUser())==null?null:l.id)==="new")}}var Et=class o{_ListuserComponent=E(Ct);_UserGraphQLService=E(fe);_RoleGraphQLService=E(xe);_route=E(Ae);_router=E(Be);_snackBar=E(re);constructor(){this._route.paramMap.subscribe(t=>{let e=t.get("id");e==="new"?this.userId.set(e):e&&!this._UserGraphQLService.currentUser()&&this.userId.set(e)})}DetailUser=h(null);isEdit=h(!1);isDelete=h(!1);isLoading=h(!1);isAddingRole=h(!1);isRemovingRole=h(!1);userId=h(null);ListRole=h([]);FilterRole=h([]);getUserById(t){return b(this,null,function*(){try{let e=yield this._UserGraphQLService.getUserById(t);e&&this.DetailUser.set(Y(V({},e),{SDT:e.SDT||""}))}catch(e){console.error("Error loading user:",e),this._snackBar.open("L\u1ED7i khi t\u1EA3i th\xF4ng tin ng\u01B0\u1EDDi d\xF9ng","\u0110\xF3ng",{duration:3e3})}})}ngOnInit(){return b(this,null,function*(){let t=this.userId();if(!t){this._router.navigate(["/admin/user"]),this._ListuserComponent.drawer.close();return}if(t==="new")this.DetailUser.set({id:"new",email:"",password:"",SDT:"",name:"",isActive:!0,roles:[],profile:{name:"",avatar:"",bio:""}}),this._ListuserComponent?.drawer?.open(),this.isEdit.set(!0);else if(t)try{yield this.getUserById(t),this._ListuserComponent?.drawer?.open(),this._router.navigate(["/admin/user",t])}catch(e){console.error("Error loading user:",e),this._snackBar.open("L\u1ED7i khi t\u1EA3i th\xF4ng tin ng\u01B0\u1EDDi d\xF9ng","\u0110\xF3ng",{duration:3e3}),this._router.navigate(["/admin/user"]);return}try{yield this._RoleGraphQLService.loadAllRoles(),this.ListRole.set(this._RoleGraphQLService.allRoles()),this.updateFilterRole()}catch(e){console.error("Error loading roles:",e)}})}updateFilterRole(){let t=this.ListRole()||[],i=this.DetailUser()?.roles||[];if(t.length===0){this.FilterRole.set([]);return}let a=t.filter(l=>!l||!l.id?!1:!i.some(d=>d?d.roleId===l.id||d.role?.id===l.id:!1));this.FilterRole.set(a)}updateUserName(t){let e=t.target.value,i=this.DetailUser();i&&(i.name=e,this.DetailUser.set(V({},i)))}handleUserAction(){return b(this,null,function*(){this.userId()==="new"?yield this.createUser():yield this.updateUser()})}createUser(){return b(this,null,function*(){try{if(!this.DetailUser().password||this.DetailUser().password.trim()===""){this._snackBar.open("Vui l\xF2ng nh\u1EADp password","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}if(!this.DetailUser().SDT||this.DetailUser().SDT.trim()===""){this._snackBar.open("Vui l\xF2ng nh\u1EADp SDT","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}yield this._UserGraphQLService.createUser(this.DetailUser()),this._snackBar.open("T\u1EA1o M\u1EDBi Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(t=>!t)}catch(t){console.error("L\u1ED7i khi t\u1EA1o user:",t)}})}updateUser(){return b(this,null,function*(){try{yield this._UserGraphQLService.updateUser(this.DetailUser().id,this.DetailUser()),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(t=>!t)}catch(t){console.error("L\u1ED7i khi c\u1EADp nh\u1EADt user:",t)}})}DeleteData(){return b(this,null,function*(){try{yield this._UserGraphQLService.deleteUser(this.DetailUser().id),this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this._router.navigate(["/admin/user"])}catch(t){console.error("L\u1ED7i khi x\xF3a user:",t)}})}FillSlug(){this.DetailUser.update(t=>Y(V({},t),{slug:it(t.title)}))}doFilterHederColumn(t){let e=this.ListRole();this.FilterRole.set(e.filter(i=>i.name.toLowerCase().includes(t.target.value.toLowerCase())))}handleAddRole(t){return b(this,null,function*(){if(!t||!t.id||this.isAddingRole()){(!t||!t.id)&&this._snackBar.open("D\u1EEF li\u1EC7u vai tr\xF2 kh\xF4ng h\u1EE3p l\u1EC7","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}this.isAddingRole.set(!0);try{if((this.DetailUser()?.roles||[]).some(a=>a.roleId===t.id||a.role?.id===t.id)){this._snackBar.open("Vai tr\xF2 \u0111\xE3 \u0111\u01B0\u1EE3c th\xEAm","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}yield this._UserGraphQLService.assignRolesToUser(this.DetailUser().id,[t.id]),this.DetailUser.update(a=>Y(V({},a),{roles:[...a.roles||[],{id:nt(8,!1),userId:this.DetailUser().id,roleId:t.id,role:t}]})),this.updateFilterRole(),this._snackBar.open("Th\xEAm vai tr\xF2 th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(e){console.error("Error adding role:",e),this._snackBar.open("L\u1ED7i khi th\xEAm vai tr\xF2","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isAddingRole.set(!1)}})}handleRemoveRole(t){return b(this,null,function*(){if(!t||this.isRemovingRole()){t||this._snackBar.open("D\u1EEF li\u1EC7u vai tr\xF2 kh\xF4ng h\u1EE3p l\u1EC7","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}this.isRemovingRole.set(!0);try{let e=t.role?.id||t.roleId;if(!e){this._snackBar.open("Kh\xF4ng th\u1EC3 x\xE1c \u0111\u1ECBnh ID vai tr\xF2","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}yield this._UserGraphQLService.removeRoleFromUser(this.DetailUser().id,e),this.DetailUser.update(i=>Y(V({},i),{roles:(i.roles||[]).filter(a=>(a.role?.id||a.roleId)!==e)})),this.updateFilterRole(),this._snackBar.open("X\xF3a vai tr\xF2 th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(e){console.error("Error removing role:",e),this._snackBar.open("L\u1ED7i khi x\xF3a vai tr\xF2","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isRemovingRole.set(!1)}})}goBack(){this._UserGraphQLService.clearCurrentUser(),this._ListuserComponent.drawer.close(),this._router.navigate(["/admin/user"])}trackByFn(t,e){return e.id}toggleEdit(){this.isEdit.update(t=>!t)}toggleDelete(){this.isDelete.update(t=>!t)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=k({type:o,selectors:[["app-detailuser"]],decls:13,vars:6,consts:[["menuTrigger","matMenuTrigger"],["menu","matMenu"],[1,"flex","flex-row","justify-between","items-center","space-x-2","p-2"],["mat-icon-button","","color","primary",3,"click"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center"],["mat-icon-button","","color","primary",3,"click",4,"ngIf"],["mat-icon-button","","color","warn",3,"click",4,"ngIf"],[1,"relative","flex","flex-col","w-full","p-4","overflow-auto"],[4,"ngIf"],["mat-icon-button","","color","warn",3,"click"],[1,"flex","flex-col","space-y-4","items-center","justify-center"],[1,"font-bold","text-2xl"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],[1,"w-full","flex","flex-col","space-y-2"],["appearance","outline"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp Email",3,"ngModelChange","ngModel","disabled"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp H\u1ECD V\xE0 T\xEAn",3,"input","value","disabled"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp S\u1ED1 \u0110i\u1EC7n Tho\u1EA1i",3,"ngModelChange","ngModel","disabled"],["matInput","","type","password","placeholder","Vui l\xF2ng nh\u1EADp M\u1EADt kh\u1EA9u",3,"ngModelChange","ngModel","disabled"],[1,"w-full","flex","flex-wrap","gap-2","space-x-2"],["mat-flat-button","","color","primary",1,"mt-2","flex","items-center",3,"disabled","matMenuTriggerFor"],[1,"mb-4"],[1,"bg-blue-50"],[1,"text-sm","font-medium","flex","items-center"],[1,"mr-2","text-blue-500"],[1,"flex","flex-row","flex-wrap","gap-2"],[1,"text-center","text-gray-500","py-4"],[1,"cursor-pointer","flex","flex-col","space-y-4","p-3",3,"click"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[1,"w-full","flex","flex-col","space-y-2","max-h-44","overflow-auto"],["mat-menu-item",""],[1,"flex","flex-row","space-x-2","items-center","justify-end"],["class","mt-8",4,"ngIf"],[1,"bg-blue-100"],[1,"flex","items-center"],[1,"mr-2"],[1,"animate-spin","text-gray-500","text-sm"],["color","warn",1,"text-sm","hover:text-red-600",3,"cursor"],["color","warn",1,"text-sm","hover:text-red-600",3,"click"],[1,"text-gray-400"],[1,"text-sm","mt-1"],["mat-stroked-button","","color","primary",1,"mt-2","flex","items-center",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"mt-8"],[1,"border-t","pt-6"],[3,"userId","user",4,"ngIf"],["class","p-8 text-center",4,"ngIf"],[3,"userId","user"],[1,"p-8","text-center"],[1,"animate-spin","text-4xl","text-gray-400"],[1,"text-lg","text-gray-500","mt-4"],[1,"text-center","text-gray-500","py-8"],[1,"text-4xl","text-gray-400"],[1,"mt-2"],[1,"text-xs"]],template:function(e,i){if(e&1&&(r(0,"div",2)(1,"button",3),_("click",function(){return i.goBack()}),r(2,"mat-icon"),s(3,"arrow_back"),n()(),r(4,"div",4),s(5),n(),r(6,"div",5),u(7,Ei,3,0,"button",6)(8,yi,3,0,"button",6)(9,Pi,3,0,"button",7),n()(),r(10,"div",8),u(11,Si,9,0,"ng-container",9)(12,Oi,50,14,"ng-container",9),n()),e&2){let a;m(5),P(((a=i.DetailUser())==null?null:a.email)||"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),m(2),p("ngIf",i.isEdit()&&i.DetailUser()),m(),p("ngIf",!i.isEdit()&&i.DetailUser()),m(),p("ngIf",i.DetailUser()),m(2),p("ngIf",i.isDelete()),m(),p("ngIf",!i.isDelete()&&i.DetailUser())}},dependencies:[ce,me,Ze,ue,de,le,oe,se,ae,A,F,I,T,Q,pe,W,U,q,dt,qe,Ve,Le,Ge,K,N,$,H,j,z,B,pt,ut,be],styles:[".permission-management[_ngcontent-%COMP%]{border-left:4px solid #4caf50}.permission-management[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{padding-bottom:8px}.permission-management[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{font-size:12px}"]})};export{Et as DetailUserComponent};
