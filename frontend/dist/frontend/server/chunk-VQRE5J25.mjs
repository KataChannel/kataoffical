import './polyfills.server.mjs';
import{a as ue}from"./chunk-AR54W5NE.mjs";import{a as de}from"./chunk-CJGHUN7A.mjs";import{a as pe,b as Z}from"./chunk-PDYHWB5Z.mjs";import{c as le,f as he}from"./chunk-UQHWVLPH.mjs";import{a as ce}from"./chunk-3CG2NQ7B.mjs";import{a as me}from"./chunk-FK4KBJCS.mjs";import{a as N,b as Qt,c as R,d as Ut,e as Xt}from"./chunk-M4J2MUAR.mjs";import{b as Ht}from"./chunk-4CVVRMK6.mjs";import{a as $t}from"./chunk-JM3RUSUW.mjs";import{c as Ft,d as Tt,f as Pt,h as At}from"./chunk-QQBP4AU2.mjs";import{a as J}from"./chunk-26NM6QMQ.mjs";import{a as Ct,b as xt,c as St}from"./chunk-QB764O3U.mjs";import{a as vt,b as bt,c as Et,d as Lt}from"./chunk-Q2TTBLPO.mjs";import{a as pt}from"./chunk-Y5GM6BPP.mjs";import{a as V,b as yt}from"./chunk-MIPBML43.mjs";import{b as ge}from"./chunk-HZUVE6S4.mjs";import{a as Gt,b as jt,c as Wt,d as Jt,e as Yt,g as Zt,h as te,j as ee,k as ie,m as ae,n as ne,p as re,q as oe,r as se,s as Y}from"./chunk-VWZQI7JC.mjs";import{b as Ot}from"./chunk-I2TU747W.mjs";import{b as Kt,g as Mt,j as It,n as Dt,p as Bt,r as zt,v as Vt,w as Nt,y as Rt,z as qt}from"./chunk-K5JBZREZ.mjs";import{a as kt,b as wt}from"./chunk-VSF3PFK7.mjs";import{a as dt,c as ft,e as _t}from"./chunk-7EPSYLRI.mjs";import{y as gt,z as ut}from"./chunk-QKIZLTPN.mjs";import{b as mt,d as z}from"./chunk-NES7BRLR.mjs";import{o as lt,t as ht,x as ct}from"./chunk-XQ6Z6XLV.mjs";import{$c as W,Bc as F,Cc as T,Dc as P,Fb as et,Gc as L,Hc as l,Ic as K,Jc as x,Lc as ot,Mb as S,Mc as G,Nc as j,Oc as Q,Qc as A,Ra as C,Wc as U,Yb as f,Yc as X,ac as it,dc as D,fc as at,gc as H,hc as $,ic as r,ja as tt,jc as o,kc as E,lc as nt,mc as rt,oc as w,pa as y,tb as h,tc as _,vc as m,vd as st,xd as B,ya as g,za as u}from"./chunk-5IMI5WTE.mjs";import{a as M,b as O,h as I,j as p}from"./chunk-RIAI3ORJ.mjs";var q=class n{_GraphqlService=y(de);_StorageService=y(yt);_router=y(z);_snackBar=y(V);_ErrorLogService=y($t);_sharedSocketService=y(ue);socket;ListKhachhang=C([]);DetailKhachhang=C({});page=C(1);totalPages=C(1);total=C(0);pageSize=C(50);khachhangId=C(null);loading=C(!1);error=C(null);constructor(){this.socket=this._sharedSocketService.getSocket(),this.listenKhachhangUpdates()}setKhachhangId(t){this.khachhangId.set(t)}getAllKhachhang(){return p(this,arguments,function*(t={}){try{this.loading.set(!0),this.error.set(null);let e={id:!0,makh:!0,name:!0,diachi:!0,quan:!0,email:!0,sdt:!0,mst:!0,gionhanhang:!0,loaikh:!0,ghichu:!0,isActive:!0,createdAt:!0,banggiaId:!0,banggia:{select:{id:!0,title:!0,mabanggia:!0}}},i={isActive:!0};t.subtitle&&(i.OR=[{name:{contains:t.subtitle,mode:"insensitive"}},{makh:{contains:t.subtitle,mode:"insensitive"}},{email:{contains:t.subtitle,mode:"insensitive"}},{sdt:{contains:t.subtitle,mode:"insensitive"}}]),t.loaikh&&(i.loaikh=t.loaikh),t.banggiaId&&(i.banggiaId=t.banggiaId);let a={createdAt:"desc"},s=yield this._GraphqlService.findMany("khachhang",{where:i,orderBy:a,select:e}),d=s?.length||0;return this.ListKhachhang.set(s||[]),this.total.set(d),this.totalPages.set(1),this.page.set(1),s}catch(e){throw console.error("L\u1ED7i khi l\u1EA5y danh s\xE1ch kh\xE1ch h\xE0ng:",e),this.error.set("Kh\xF4ng th\u1EC3 t\u1EA3i danh s\xE1ch kh\xE1ch h\xE0ng"),this._ErrorLogService.logError("getAllKhachhang",e),e}finally{this.loading.set(!1)}})}getKhachhangBy(t){return p(this,null,function*(){try{return yield this.getAllKhachhang(t)}catch(e){throw console.error("L\u1ED7i t\xECm ki\u1EBFm kh\xE1ch h\xE0ng:",e),e}})}getKhachhangById(t){return p(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let e={banggia:{select:{id:!0,title:!0,mabanggia:!0,type:!0,status:!0}}},i=yield this._GraphqlService.findUnique("khachhang",{id:t},{include:e});return console.log(i),i&&(this.DetailKhachhang.set(i),this.setKhachhangId(t)),i}catch(e){throw console.error("L\u1ED7i khi l\u1EA5y chi ti\u1EBFt kh\xE1ch h\xE0ng:",e),this.error.set("Kh\xF4ng th\u1EC3 t\u1EA3i th\xF4ng tin kh\xE1ch h\xE0ng"),this._ErrorLogService.logError("getKhachhangById",e),e}finally{this.loading.set(!1)}})}createKhachhang(t){return p(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let e={makh:t.makh||this.generateMaKhachHang(),subtitle:t.subtitle||"",tenfile:t.tenfile||"",name:t.name,diachi:t.diachi||"",quan:t.quan||"",email:t.email||"",sdt:t.sdt||"",mst:t.mst||"",gionhanhang:t.gionhanhang||"",loaikh:t.loaikh||"banle",ghichu:t.ghichu||"",isActive:t.isActive!==!1,isshowvat:t.isshowvat,hiengia:t.hiengia,istitle2:t.istitle2,banggiaId:t.banggiaId||null},i={banggia:{select:{id:!0,title:!0,mabanggia:!0}}},a=yield this._GraphqlService.createOne("khachhang",e,{include:i});return this.khachhangId.set(a.id),this.DetailKhachhang.set(a),yield this.getAllKhachhang(),this._snackBar.open("T\u1EA1o kh\xE1ch h\xE0ng th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),a}catch(e){throw console.error("L\u1ED7i t\u1EA1o kh\xE1ch h\xE0ng:",e),this.error.set("Kh\xF4ng th\u1EC3 t\u1EA1o kh\xE1ch h\xE0ng"),this._snackBar.open("L\u1ED7i t\u1EA1o kh\xE1ch h\xE0ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),e}finally{this.loading.set(!1)}})}updateKhachhang(t,e){return p(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let i={name:e.name,subtitle:e.subtitle,tenfile:e.tenfile,diachi:e.diachi,quan:e.quan,email:e.email,sdt:e.sdt,mst:e.mst,gionhanhang:e.gionhanhang,loaikh:e.loaikh,ghichu:e.ghichu,isActive:e.isActive,isshowvat:e.isshowvat,hiengia:e.hiengia,istitle2:e.istitle2,banggiaId:e.banggiaId},a={banggia:{select:{id:!0,title:!0,mabanggia:!0}}},s=yield this._GraphqlService.updateOne("khachhang",{id:t},i,{include:a});return this.DetailKhachhang.set(s),yield this.getAllKhachhang(),this._snackBar.open("C\u1EADp nh\u1EADt kh\xE1ch h\xE0ng th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),s}catch(i){throw console.error("L\u1ED7i c\u1EADp nh\u1EADt kh\xE1ch h\xE0ng:",i),this.error.set("Kh\xF4ng th\u1EC3 c\u1EADp nh\u1EADt kh\xE1ch h\xE0ng"),this._snackBar.open("L\u1ED7i c\u1EADp nh\u1EADt kh\xE1ch h\xE0ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),i}finally{this.loading.set(!1)}})}deleteKhachhang(t){return p(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let e=yield this._GraphqlService.updateOne("khachhang",{id:t},{isActive:!1});return yield this.getAllKhachhang(),this._snackBar.open("X\xF3a kh\xE1ch h\xE0ng th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),e}catch(e){throw console.error("L\u1ED7i x\xF3a kh\xE1ch h\xE0ng:",e),this.error.set("Kh\xF4ng th\u1EC3 x\xF3a kh\xE1ch h\xE0ng"),this._snackBar.open("L\u1ED7i x\xF3a kh\xE1ch h\xE0ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),e}finally{this.loading.set(!1)}})}importKhachhang(t){return p(this,null,function*(){try{this.loading.set(!0),this.error.set(null);let e=t.map(a=>({makh:a.makh||this.generateMaKhachHang(),name:a.name,diachi:a.diachi||"",quan:a.quan||"",email:a.email||"",sdt:a.sdt||"",mst:a.mst||"",gionhanhang:a.gionhanhang||"",loaikh:a.loaikh||"banle",ghichu:a.ghichu||"",isActive:a.isActive!==!1,banggiaId:a.banggiaId||null})),i=yield this._GraphqlService.batchCreate("khachhang",e);return yield this.getAllKhachhang(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${i.length} kh\xE1ch h\xE0ng`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),i}catch(e){throw console.error("L\u1ED7i import kh\xE1ch h\xE0ng:",e),this.error.set("Kh\xF4ng th\u1EC3 import kh\xE1ch h\xE0ng"),this._snackBar.open("L\u1ED7i import kh\xE1ch h\xE0ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),e}finally{this.loading.set(!1)}})}changePage(t,e){return p(this,null,function*(){return console.log("Pagination disabled - all data loaded"),this.ListKhachhang()})}listenKhachhangUpdates(){this.socket&&(this.socket.on("khachhang:created",t=>{let e=this.ListKhachhang();this.ListKhachhang.set([t,...e]),this.total.set(this.total()+1)}),this.socket.on("khachhang:updated",t=>{let e=this.ListKhachhang(),i=e.findIndex(a=>a.id===t.id);i!==-1&&(e[i]=t,this.ListKhachhang.set([...e])),this.khachhangId()===t.id&&this.DetailKhachhang.set(t)}),this.socket.on("khachhang:deleted",t=>{let i=this.ListKhachhang().filter(a=>a.id!==t.id);this.ListKhachhang.set(i),this.total.set(this.total()-1)}))}generateMaKhachHang(){let t=Date.now().toString(36),e=Math.random().toString(36).substr(2,5);return`KH${t}${e}`.toUpperCase()}getUpdatedCodeIds(){return p(this,null,function*(){try{return yield this._GraphqlService.findMany("khachhang",{where:{isActive:!0},select:{id:!0,makh:!0},orderBy:{updatedAt:"desc"},take:100})}catch(t){return console.error("L\u1ED7i l\u1EA5y updated code IDs:",t),[]}})}clearCache(){this.ListKhachhang.set([]),this.DetailKhachhang.set({}),this.khachhangId.set(null),this.error.set(null),this.page.set(1)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=tt({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ce=["drawer"],xe=()=>[25,50,100,200,500],fe=()=>({standalone:!0}),Se=(n,t)=>t.key;function ke(n,t){if(n&1){let e=w();r(0,"button",48),_("click",function(){g(e);let a=m(),s=L(81);return u(a.openDeleteDialog(s))}),r(1,"mat-icon"),l(2,"delete"),o(),r(3,"span",19),l(4,"Xo\xE1"),o()()}}function we(n,t){if(n&1){let e=w();r(0,"button",49),_("click",function(a){let s=g(e).$implicit;return m().toggleColumn(s),u(a.stopPropagation())}),r(1,"mat-icon"),l(2),o(),r(3,"span"),l(4),o()()}if(n&2){let e=t.$implicit;h(2),K(e.isShow?"check_box":"check_box_outline_blank"),h(2),K(e.value)}}function ve(n,t){if(n&1&&(r(0,"th",50)(1,"span"),l(2),o()()),n&2){let e=m(2).$implicit,i=m();h(2),K(i.ColumnName[e])}}function be(n,t){n&1&&S(0,ve,3,1,"th",53)}function Ee(n,t){if(n&1){let e=w();r(0,"th",51)(1,"span",55),l(2),o(),r(3,"app-searchfilter",56),_("OutFilter",function(a){g(e);let s=m(3);return u(s.onOutFilter(a))}),o()()}if(n&2){let e=m(2).$implicit,i=m();h(2),x(" ",i.ColumnName[e]," "),h(),f("icon","filter_alt")("ListItem",i.Listkhachhang())("fieldsearch",e)("ListFilter",i.ListFilter)("filterItem",i.FilterHederColumn(i.dataSource.filteredData,e))}}function Le(n,t){n&1&&S(0,Ee,4,6,"th",54)}function Ke(n,t){if(n&1){let e=w();r(0,"span",61),_("click",function(){g(e);let a=m().$implicit,s=m(2);return u(s.goToDetail(a))}),l(1),o()}if(n&2){let e=m().$implicit,i=m().$implicit;h(),x(" ",e[i]," ")}}function Me(n,t){if(n&1&&(r(0,"span",59),l(1),o()),n&2){let e=m().index;h(),x(" ",e+1," ")}}function Ie(n,t){if(n&1&&(r(0,"span",60),l(1),U(2,"date"),o()),n&2){let e=m().$implicit,i=m().$implicit;h(),x(" ",X(2,1,e[i],"dd/MM/yyyy")," ")}}function De(n,t){if(n&1&&(r(0,"span",60),l(1),o()),n&2){let e=m().$implicit,i=m().$implicit;h(),x(" ",e[i]==null?null:e[i].mabanggia," ")}}function Fe(n,t){if(n&1&&(r(0,"span",60),l(1),o()),n&2){let e=m().$implicit,i=m().$implicit;h(),x(" ",e[i],"% ")}}function Te(n,t){n&1&&(r(0,"mat-icon",62),l(1,"check_circle"),o())}function Pe(n,t){n&1&&(r(0,"mat-icon",63),l(1,"cancel"),o())}function Ae(n,t){if(n&1&&(r(0,"span",60),S(1,Te,2,0,"mat-icon",62)(2,Pe,2,0,"mat-icon",63),o()),n&2){let e=m().$implicit,i=m().$implicit;h(),D(e[i]?1:2)}}function Be(n,t){if(n&1&&(r(0,"span",60),l(1),U(2,"date"),o()),n&2){let e=m().$implicit,i=m().$implicit;h(),x(" ",X(2,1,e[i],"dd/MM/yyyy")," ")}}function ze(n,t){if(n&1&&(r(0,"span",60),l(1),o()),n&2){let e=m().$implicit,i=m().$implicit;h(),x(" ",e[i]," ")}}function Ve(n,t){if(n&1&&(r(0,"td",57),S(1,Ke,2,1,"span",58)(2,Me,2,1,"span",59)(3,Ie,3,4,"span",60)(4,De,2,1,"span",60)(5,Fe,2,1,"span",60)(6,Ae,3,1,"span",60)(7,Be,3,4,"span",60)(8,ze,2,1,"span",60),o()),n&2){let e,i=m().$implicit;h(),D((e=i)==="makh"?1:e==="stt"?2:e==="createdAt"?3:e==="banggia"?4:e==="haohut"?5:e==="isActive"?6:e==="updatedAt"?7:8)}}function Ne(n,t){if(n&1&&(nt(0,32),S(1,be,1,0,"th",50)(2,Le,1,0,"th",51)(3,Ve,9,1,"td",52),rt()),n&2){let e=t.$implicit;f("matColumnDef",e),h(),D(e=="stt"?1:2)}}function Re(n,t){n&1&&E(0,"tr",64)}function qe(n,t){if(n&1){let e=w();r(0,"tr",65),_("click",function(){let a=g(e).$implicit,s=m();return u(s.AddToEdit(a))}),o()}if(n&2){let e=t.$implicit,i=m();it("hover:bg-slate-50 ",i.CheckItemInEdit(e)?"!bg-blue-50":"","")}}function Oe(n,t){n&1&&(r(0,"tr",66)(1,"td",67),l(2,"Kh\xF4ng t\xECm th\u1EA5y"),o()())}function He(n,t){n&1&&(r(0,"mat-dialog-content")(1,"div",68)(2,"div",69),l(3,"X\xE1c Nh\u1EADn"),o(),r(4,"div"),l(5,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),o(),r(6,"div",70)(7,"button",71),l(8,"\u0110\u1ED3ng \xDD"),o(),r(9,"button",72),l(10,"Hu\u1EF7 B\u1ECF"),o()()()())}function $e(n,t){if(n&1){let e=w();r(0,"mat-dialog-content",73)(1,"div",74)(2,"mat-form-field",23)(3,"mat-label"),l(4,"IdSheet"),o(),r(5,"input",75),Q("ngModelChange",function(a){g(e);let s=m();return j(s.IdSheet,a)||(s.IdSheet=a),u(a)}),o()(),r(6,"mat-form-field",23)(7,"mat-label"),l(8,"SheetName"),o(),r(9,"input",76),Q("ngModelChange",function(a){g(e);let s=m();return j(s.SheetName,a)||(s.SheetName=a),u(a)}),o()()(),E(10,"div",77),r(11,"div",78)(12,"button",71),l(13,"\u0110\u1ED3ng \xDD"),o(),r(14,"button",72),l(15,"Hu\u1EF7 B\u1ECF"),o()()()}if(n&2){let e=m();h(5),G("ngModel",e.IdSheet),f("ngModelOptions",A(4,fe)),h(4),G("ngModel",e.SheetName),f("ngModelOptions",A(5,fe))}}var v=class v{displayedColumns=[];ColumnName={stt:"#",makh:"M\xE3 KH",name:"T\xEAn KH",banggia:"B\u1EA3ng Gi\xE1",diachi:"\u0110\u1ECBa Ch\u1EC9",quan:"Qu\u1EADn",email:"Email",sdt:"SDT",mst:"MST",gionhanhang:"Gi\u1EDD Nh\u1EADn H\xE0ng",loaikh:"Lo\u1EA1i KH",ghichu:"Ghi Ch\xFA",isActive:"Tr\u1EA1ng Th\xE1i",createdAt:"Ng\xE0y T\u1EA1o"};FilterColumns=JSON.parse(localStorage.getItem("KhachhangColFilter")||"[]");Columns=[];paginator;sort;drawer;_KhachhangService=y(q);_breakpointObserver=y(gt);_GoogleSheetService=y(ce);_router=y(z);_dialog=y(Ft);_snackBar=y(V);Listkhachhang=this._KhachhangService.ListKhachhang;page=this._KhachhangService.page;totalPages=this._KhachhangService.totalPages;total=this._KhachhangService.total;pageSize=this._KhachhangService.pageSize;khachhangId=this._KhachhangService.khachhangId;loading=this._KhachhangService.loading;error=this._KhachhangService.error;dataSource=new Y([]);EditList=[];isSearch=C(!1);searchParam={};paginationInfo=st(()=>{let t=this.paginator;return t?{currentPage:t.pageIndex+1,totalPages:Math.ceil(t.length/t.pageSize),pageSize:t.pageSize,totalRecords:t.length,displayStart:t.length===0?0:t.pageIndex*t.pageSize+1,displayEnd:Math.min((t.pageIndex+1)*t.pageSize,t.length)}:null});constructor(){B(()=>{let t=this.Listkhachhang();t&&t.length>0&&(this.dataSource.data=t,this.dataSource.sort=this.sort,this.paginator&&(this.paginator.pageIndex=0,this.paginator.pageSize=50,this.paginator.length=t.length,this.paginator.pageSizeOptions=[25,50,100,200,500],this.paginator.showFirstLastButtons=!0))}),B(()=>{let t=this.error();t&&this._snackBar.open(t,"",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}),B(()=>{this.loading()&&console.log("Loading kh\xE1ch h\xE0ng...")})}ngOnInit(){return p(this,null,function*(){this.initializeColumns(),this.setupDrawer();try{yield this._KhachhangService.getAllKhachhang(this.searchParam);let t=this.Listkhachhang();this.dataSource=new Y(t),this.dataSource.sort=this.sort,this.dataSource.paginator=this.paginator,this.dataSource.sortingDataAccessor=(e,i)=>{switch(i){case"banggia":return e.banggia?.title||"";case"createdAt":case"updatedAt":return new Date(e[i]);default:return e[i]||""}}}catch(t){console.error("L\u1ED7i khi load d\u1EEF li\u1EC7u kh\xE1ch h\xE0ng:",t),this._snackBar.open("Kh\xF4ng th\u1EC3 t\u1EA3i d\u1EEF li\u1EC7u kh\xE1ch h\xE0ng","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}initializeColumns(){this.Columns=Object.entries(this.ColumnName).map(([t,e])=>({key:t,value:e,isShow:!0})),this.FilterColumns=this.FilterColumns.length?this.FilterColumns:this.Columns,localStorage.setItem("KhachhangColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(t=>t.isShow).map(t=>t.key),this.ColumnName=this.FilterColumns.reduce((t,{key:e,value:i,isShow:a})=>a?O(M({},t),{[e]:i}):t,{})}applyFilter(t){return p(this,null,function*(){let e=t.target.value;if(e.length===0){this.dataSource.filter="";return}try{let i=J(e.trim().toLowerCase());this.dataSource.filterPredicate=(a,s)=>{let c=["makh","name","email","sdt","diachi","quan","loaikh","ghichu"].map(k=>k==="banggia"?a.banggia?.title||"":a[k]?a[k].toString():"").join(" ").toLowerCase(),b=J(c);return c.includes(s)||b.includes(s)},this.dataSource.filter=i,this.paginator&&this.paginator.firstPage()}catch(i){console.error("Error applying filter:",i),this._snackBar.open("L\u1ED7i khi t\xECm ki\u1EBFm","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}getUpdatedCodeIds(){return p(this,null,function*(){try{yield this._KhachhangService.getUpdatedCodeIds(),this._snackBar.open("C\u1EADp nh\u1EADt th\xE0nh c\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(t){console.error("L\u1ED7i khi c\u1EADp nh\u1EADt:",t),this._snackBar.open("L\u1ED7i khi c\u1EADp nh\u1EADt","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}refreshData(){return p(this,null,function*(){try{yield this._KhachhangService.getAllKhachhang({}),this._snackBar.open("D\u1EEF li\u1EC7u \u0111\xE3 \u0111\u01B0\u1EE3c c\u1EADp nh\u1EADt","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(t){console.error("L\u1ED7i khi refresh d\u1EEF li\u1EC7u:",t),this._snackBar.open("Kh\xF4ng th\u1EC3 refresh d\u1EEF li\u1EC7u","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}setupDrawer(){this._breakpointObserver.observe([ut.Handset]).subscribe(t=>{t.matches?this.drawer.mode="over":this.drawer.mode="side"})}toggleColumn(t){let e=this.FilterColumns.find(i=>i.key===t.key);e&&(e.isShow=!e.isShow,this.updateDisplayedColumns())}FilterHederColumn(t,e){return t.filter((a,s,d)=>s===d.findIndex(c=>c[e]===a[e]))}doFilterHederColumn(t,e){this.dataSource.filteredData=this.Listkhachhang().filter(i=>i[e].toLowerCase().includes(t.target.value.toLowerCase()))}ListFilter=[];ChosenItem(t,e){let i=this.dataSource.filteredData.filter(s=>s[e]===t[e]);this.ListFilter.filter(s=>s[e]===t[e]).length>0?this.ListFilter=this.ListFilter.filter(s=>s[e]!==t[e]):this.ListFilter=[...this.ListFilter,...i]}ChosenAll(t){t.forEach(e=>{!!this.ListFilter.find(a=>a.id===e.id)?this.ListFilter=this.ListFilter.filter(a=>a.id!==e.id):this.ListFilter.push(e)})}ResetFilter(){this.ListFilter=this.Listkhachhang()}EmptyFiter(){this.ListFilter=[]}CheckItem(t){return!!this.ListFilter.find(e=>e.id===t.id)}ApplyFilterColum(t){this.dataSource.data=this.Listkhachhang().filter(e=>this.ListFilter.some(i=>i.id===e.id)),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,t.closeMenu()}onOutFilter(t){this.dataSource.data=t,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(t=>t.isShow).map(t=>t.key),this.ColumnName=this.FilterColumns.reduce((t,e)=>(e.isShow&&(t[e.key]=e.value),t),{}),localStorage.setItem("KhachhangColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(t){let e=t.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(i=>i.value.toLowerCase().includes(e))}create(){this.drawer.open(),this._router.navigate(["admin/khachhang","new"])}openDeleteDialog(t){this._dialog.open(t,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(i=>{i==="true"&&this.DeleteListItem()})}DeleteListItem(){this.EditList.forEach(t=>{this._KhachhangService.deleteKhachhang(t.id)}),this.EditList=[],this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}AddToEdit(t){this.EditList.find(i=>i.id===t.id)?this.EditList=this.EditList.filter(i=>i.id!==t.id):this.EditList.push(t)}CheckItemInEdit(t){return this.EditList.some(e=>e.id===t.id)}goToDetail(t){this.drawer.open(),this._KhachhangService.setKhachhangId(t.id),this._router.navigate(["admin/khachhang",t.id])}OpenLoadDrive(t){}IdSheet="15npo25qyH5FmfcEjl1uyqqyFMS_vdFnmxM_kt0KYmZk";SheetName="SPImport";ImportIteam=[];ImportColumnName={};ImportdisplayedColumns=[];LoadDrive(){return p(this,null,function*(){let t={IdSheet:this.IdSheet,SheetName:this.SheetName,ApiKey:pt.GSApiKey},e=yield this._GoogleSheetService.getDrive(t);this.ImportIteam=Ht(e.values),this.ImportColumnName=Object.fromEntries(e.values[0].map((i,a)=>[i,e.values[1][a]])),this.ImportdisplayedColumns=e.values[0]})}DoImportData(t){return p(this,null,function*(){let e=t.map(c=>({title:c.title?.trim()||"",masp:c.masp?.trim()||"",giagoc:Number(c.giagoc)||0,dvt:c.dvt?.trim()||"",soluong:Number(c.soluong)||0,soluongkho:Number(c.soluongkho)||0,haohut:Number(c.haohut)||0,ghichu:c.ghichu?.trim()||""})),i=Array.from(new Map(e.map(c=>[c.masp,c])).values()),a=this._KhachhangService.ListKhachhang(),s=a.map(c=>c.masp),d=i.map(c=>c.masp).filter(c=>!s.includes(c));yield Promise.all(i.map(c=>p(this,null,function*(){let b=a.find(k=>k.masp===c.masp);if(b){let k=M(M({},b),c);yield this._KhachhangService.updateKhachhang(k.id,k)}else yield this._KhachhangService.createKhachhang(c)}))),yield Promise.all(a.filter(c=>!i.some(b=>b.masp===c.masp)).map(c=>this._KhachhangService.updateKhachhang(c.id,O(M({},c),{isActive:!1})))),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ImporExcel(t){return p(this,null,function*(){let e=yield he(t);this.DoImportData(e)})}ExportExcel(t,e){let i=t.map(a=>({title:a.title,masp:a.masp,giagoc:a.giagoc,dvt:a.dvt,soluong:a.soluong,soluongkho:a.soluongkho,haohut:a.haohut,ghichu:a.ghichu}));le(i,e)}trackByFn(t,e){return e.id||t.toString()}trackByFilteredFn=(t,e)=>`${e.id}-${e.updatedAt||e.createdAt}`;getCurrentPage(){return this.paginator?this.paginator.pageIndex+1:1}getTotalPages(){return this.paginator?Math.ceil(this.paginator.length/this.paginator.pageSize):1}getCurrentPageSize(){return this.paginator?this.paginator.pageSize:50}getDisplayStart(){return!this.paginator||this.paginator.length===0?0:this.paginator.pageIndex*this.paginator.pageSize+1}getDisplayEnd(){if(!this.paginator||this.paginator.length===0)return 0;let t=(this.paginator.pageIndex+1)*this.paginator.pageSize;return Math.min(t,this.paginator.length)}getTotalRecords(){return this.paginator?this.paginator.length:0}canGoToPrevious(){return this.paginator?this.paginator.hasPreviousPage():!1}canGoToNext(){return this.paginator?this.paginator.hasNextPage():!1}onPageSizeChange(t,e){return p(this,null,function*(){if(t<1){this._snackBar.open("S\u1ED1 l\u01B0\u1EE3ng ph\u1EA3i l\u1EDBn h\u01A1n 0","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}this.paginator&&(this.paginator.pageSize=t,this.paginator.firstPage()),this._snackBar.open(`Hi\u1EC3n th\u1ECB ${t} items m\u1ED7i trang`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),e.closeMenu()})}onPreviousPage(){return p(this,null,function*(){this.paginator&&this.paginator.hasPreviousPage()&&this.paginator.previousPage()})}onNextPage(){return p(this,null,function*(){this.paginator&&this.paginator.hasNextPage()&&this.paginator.nextPage()})}static \u0275fac=function(e){return new(e||v)};static \u0275cmp=et({type:v,selectors:[["app-listkhachhang"]],viewQuery:function(e,i){if(e&1&&(F(N,5),F(R,5),F(Ce,7)),e&2){let a;T(a=P())&&(i.paginator=a.first),T(a=P())&&(i.sort=a.first),T(a=P())&&(i.drawer=a.first)}},decls:84,vars:22,consts:[["drawer",""],["menu","matMenu"],["paginator",""],["menuHienthi","matMenuTrigger"],["menu1","matMenu"],["pageSizeInput",""],["DeleteDialog",""],["LoadDriveDialog",""],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-16","w-full","p-2"],[1,"p-2","cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","bg-white","rounded-lg"],[1,"w-full","flex","flex-col","gap-2","lg:flex-row","lg:items-center","lg:justify-between"],[1,"flex","flex-row","space-x-2","items-center"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],["color","primary","matTooltip","Th\xEAm m\u1EDBi","mat-flat-button","",1,"flex","flex-row","items-center",3,"click"],[1,"whitespace-nowrap"],["class","flex flex-row items-center","color","warn","matTooltip","Xo\xE1","mat-flat-button","",3,"click",4,"ngIf"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["mat-icon-button","","color","primary","matTooltip","C\u1EADp Nh\u1EADt L\u1EA1i Code",3,"click"],["mat-icon-button","","color","primary","matTooltip","Refresh D\u1EEF Li\u1EC7u",3,"click"],[1,"w-full","h-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["class","border","mat-row","",3,"class","click",4,"matRowDef","matRowDefColumns"],["class","mat-row border",4,"matNoDataRow"],[1,"hidden",3,"length","pageSize","pageSizeOptions","showFirstLastButtons"],[1,"cursor-pointer","border","rounded-lg","px-3","p-1","flex","flex-row","space-x-2","items-center","justify-between"],[1,"w-full","flex","lg:p-0","p-2","lg:flex-row","lg:space-x-2","lg:items-center","lg:justify-between","flex-col","justify-center"],[1,"w-full","text-center"],[1,"w-full","flex","flex-row","space-x-2","items-center","lg:justify-end","justify-center"],[1,"font-bold","text-blue-600",3,"matMenuTriggerFor"],[1,"w-full","flex","flex-row","space-x-2","p-4",3,"click"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp S\u1ED1 L\u01B0\u1EE3ng",3,"value"],["mat-icon-button","","color","primary",3,"click"],[1,"pagination-controls"],["mat-icon-button","","color","primary",3,"click","disabled"],["color","warn","matTooltip","Xo\xE1","mat-flat-button","",1,"flex","flex-row","items-center",3,"click"],["mat-menu-item","",3,"click"],["mat-header-cell","",1,"!border","!bg-slate-100"],["mat-header-cell","","mat-sort-header","",1,"!border","whitespace-nowrap","!bg-slate-100"],["class","border","mat-cell","",4,"matCellDef"],["class","!border !bg-slate-100","mat-header-cell","",4,"matHeaderCellDef"],["class","!border whitespace-nowrap !bg-slate-100","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],[1,"max-w-40","line-clamp-4","me-4"],[3,"OutFilter","icon","ListItem","fieldsearch","ListFilter","filterItem"],["mat-cell","",1,"border"],[1,"max-w-40","line-clamp-4","font-bold","text-blue-600"],[1,"flex","text-center"],[1,"max-w-40","line-clamp-4"],[1,"max-w-40","line-clamp-4","font-bold","text-blue-600",3,"click"],[1,"text-green-500"],[1,"text-red-500"],["mat-header-row",""],["mat-row","",1,"border",3,"click"],[1,"mat-row","border"],["colspan","4",1,"mat-cell","p-4"],[1,"flex","flex-col","space-y-8","items-center","justify-center"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary","mat-dialog-close","true"],["mat-flat-button","","color","warn","mat-dialog-close","false"],[1,"!w-screen","!h-screen","!max-h-screen","!relative","!flex","flex-col","space-y-8","items-center","justify-center"],[1,"relative","flex","flex-row","space-x-2","items-center"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp IdSheet",3,"ngModelChange","ngModel","ngModelOptions"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp SheetName",3,"ngModelChange","ngModel","ngModelOptions"],[1,"relative","h-full","w-full","overflow-auto"],[1,"relative","flex","flex-row","space-x-2","items-center","justify-center"]],template:function(e,i){if(e&1){let a=w();r(0,"mat-drawer-container",8)(1,"mat-drawer",9,0),E(3,"router-outlet"),o(),r(4,"div",10)(5,"div",11)(6,"div",12)(7,"div",13)(8,"div",14)(9,"input",15),_("keyup",function(d){return g(a),u(i.applyFilter(d))}),o(),r(10,"div",16)(11,"span",17),l(12,"search"),o()()(),r(13,"button",18),_("click",function(){return g(a),u(i.create())}),r(14,"mat-icon"),l(15,"add_circle"),o(),r(16,"span",19),l(17,"T\u1EA1o M\u1EDBi"),o()(),S(18,ke,5,0,"button",20),o(),r(19,"div",13)(20,"button",21)(21,"mat-icon"),l(22,"tune"),o()(),r(23,"mat-menu",null,1)(25,"div",22)(26,"mat-form-field",23)(27,"input",24),_("input",function(d){return g(a),u(i.doFilterColumns(d))})("click",function(d){return g(a),u(d.stopPropagation())}),o(),r(28,"mat-icon",25),l(29,"search"),o()()(),r(30,"div",26),H(31,we,5,2,"button",27,Se),o()(),r(33,"button",28),_("click",function(){return g(a),u(i.getUpdatedCodeIds())}),r(34,"mat-icon"),l(35,"cached"),o()(),r(36,"button",29),_("click",function(){return g(a),u(i.refreshData())}),r(37,"mat-icon"),l(38,"refresh"),o()()()()(),r(39,"div",30)(40,"table",31),H(41,Ne,4,2,"ng-container",32,at),S(43,Re,1,0,"tr",33)(44,qe,1,3,"tr",34)(45,Oe,3,0,"tr",35),o(),E(46,"mat-paginator",36,2),o(),r(48,"div",37)(49,"div",38)(50,"span",39),l(51,"\u0110ang Xem "),r(52,"strong"),l(53),o(),l(54," - "),r(55,"strong"),l(56),o(),l(57),o(),r(58,"div",40)(59,"span",41,3),l(61),o(),r(62,"mat-menu",null,4)(64,"div",42),_("click",function(d){return g(a),u(d.stopPropagation())}),r(65,"mat-form-field",43)(66,"mat-label"),l(67,"S\u1ED1 l\u01B0\u1EE3ng"),o(),E(68,"input",44,5),o(),r(70,"button",45),_("click",function(){g(a);let d=L(60),c=L(69);return u(i.onPageSizeChange(+c.value,d))}),r(71,"mat-icon"),l(72,"published_with_changes"),o()()()(),r(73,"div",46)(74,"button",47),_("click",function(){return g(a),u(i.onPreviousPage())}),r(75,"mat-icon"),l(76,"keyboard_arrow_left"),o()(),r(77,"button",47),_("click",function(){return g(a),u(i.onNextPage())}),r(78,"mat-icon"),l(79,"keyboard_arrow_right"),o()()()()()()()(),S(80,He,11,0,"ng-template",null,6,W)(82,$e,16,6,"ng-template",null,7,W)}if(e&2){let a=L(24),s=L(63);h(),f("position","end"),h(17),f("ngIf",i.EditList.length>0),h(2),f("matMenuTriggerFor",a),h(11),$(i.FilterColumns),h(9),f("dataSource",i.dataSource),h(),$(i.displayedColumns),h(2),f("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),h(),f("matRowDefColumns",i.displayedColumns),h(2),f("length",i.getTotalRecords())("pageSize",i.getCurrentPageSize())("pageSizeOptions",A(21,xe))("showFirstLastButtons",!0),h(7),K(i.getDisplayStart()),h(3),K(i.getDisplayEnd()),h(),ot(" trong s\u1ED1 ",i.getTotalRecords()," m\u1EE5c, ",i.getCurrentPage(),"/",i.getTotalPages()," Trang "),h(2),f("matMenuTriggerFor",s),h(2),x("Hi\u1EC7n Th\u1ECB : ",i.getCurrentPageSize()," m\u1EE5c"),h(7),f("value",i.getCurrentPageSize()),h(6),f("disabled",!i.canGoToPrevious()),h(3),f("disabled",!i.canGoToNext())}},dependencies:[Nt,Vt,Bt,zt,qt,Rt,se,Wt,Yt,ie,Zt,Jt,ae,te,ee,ne,re,oe,Xt,R,Ut,Qt,N,Lt,bt,vt,Et,St,Ct,xt,mt,wt,kt,_t,dt,ft,Ot,ct,lt,ht,Dt,Kt,Mt,It,jt,Gt,At,Tt,Pt,me,ge],encapsulation:2,changeDetection:0})};I([Z(300)],v.prototype,"applyFilter",1),I([pe()],v.prototype,"FilterHederColumn",1),I([Z(300)],v.prototype,"doFilterHederColumn",1);var _e=v;export{q as a,_e as b};
