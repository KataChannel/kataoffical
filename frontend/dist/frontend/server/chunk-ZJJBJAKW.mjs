import './polyfills.server.mjs';
import{a as I}from"./chunk-GS6F3HBF.mjs";import{a as m}from"./chunk-6EFOJMAD.mjs";import{a as u,d as l}from"./chunk-SYOYXCNA.mjs";import{ja as p,pa as g,u as i}from"./chunk-LL6B6DB7.mjs";import{a as d,b as h,j as n}from"./chunk-RIAI3ORJ.mjs";var b=class o{http=g(l);storageService=g(I);baseUrl=m.APIURL;getHeaders(){return new u({"Content-Type":"application/json",Authorization:"Bearer "+this.storageService.getItem("token")})}getCurrentUserId(){try{let t=this.storageService.getItem("token");if(!t)return console.warn("[PRICE-HISTORY] No token found"),null;let r=JSON.parse(atob(t.split(".")[1])),e=r.id||null;return e?console.log("[PRICE-HISTORY] Got userId from token:",e):console.warn("[PRICE-HISTORY] No userId in token payload:",r),e}catch(t){return console.error("[PRICE-HISTORY] Failed to decode token:",t),null}}getPriceHistory(t,r){return n(this,null,function*(){try{let e=`${this.baseUrl}/banggia/${t}/sanpham/${r}/price-history`;return yield i(this.http.get(e,{headers:this.getHeaders()}))}catch(e){throw console.error("Error fetching price history:",e),e}})}getCurrentPrice(t,r){return n(this,null,function*(){try{let e=`${this.baseUrl}/banggia/${t}/sanpham/${r}/current-price`;return yield i(this.http.get(e,{headers:this.getHeaders()}))}catch(e){throw console.error("Error fetching current price:",e),e}})}updateSinglePrice(t,r,e,s,c){return n(this,null,function*(){try{let a=`${this.baseUrl}/banggia/bulk-update-prices`,y=c||this.getCurrentUserId()||"system";return yield i(this.http.post(a,{updates:[{banggiaId:t,sanphamId:r,newPrice:e,reason:s||"C\u1EADp nh\u1EADt gi\xE1 t\u1EEB b\u1EA3ng gi\xE1"}],userId:y},{headers:this.getHeaders()}))}catch(a){throw console.error("Error updating single price:",a),a}})}bulkUpdatePrices(t){return n(this,null,function*(){try{let r=t.userId||this.getCurrentUserId()||"system",e=`${this.baseUrl}/banggia/bulk-update-prices`;return yield i(this.http.post(e,h(d({},t),{userId:r}),{headers:this.getHeaders()}))}catch(r){throw console.error("Error bulk updating prices:",r),r}})}verifyOrderPrices(t){return n(this,null,function*(){try{let r=`${this.baseUrl}/donhang/verify-prices/${t}`;return yield i(this.http.get(r,{headers:this.getHeaders()}))}catch(r){throw console.error("Error verifying order prices:",r),r}})}getPriceAtDate(t,r,e){return n(this,null,function*(){try{let s=e.toISOString(),c=`${this.baseUrl}/donhang/price-at-date?banggiaId=${t}&sanphamId=${r}&date=${s}`;return yield i(this.http.get(c,{headers:this.getHeaders()}))}catch(s){throw console.error("Error fetching price at date:",s),s}})}static \u0275fac=function(r){return new(r||o)};static \u0275prov=p({token:o,factory:o.\u0275fac,providedIn:"root"})};export{b as a};
