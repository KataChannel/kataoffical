import './polyfills.server.mjs';
import{a as p}from"./chunk-AICHI2NV.mjs";import{a as s}from"./chunk-6EFOJMAD.mjs";import{a as y}from"./chunk-Q5TTQGDU.mjs";import{d as u}from"./chunk-XSJY5HPB.mjs";import{Ra as i,ja as d,oa as h}from"./chunk-KYBR54ZN.mjs";import{a as c,j as r}from"./chunk-RIAI3ORJ.mjs";var l=class g{constructor(a,t,e){this._StorageService=a;this.router=t;this.timezoneService=e}ListDathang=i([]);DetailDathang=i({});page=i(1);pageCount=i(1);total=i(0);pageSize=i(50);dathangId=i(null);setDathangId(a){this.dathangId.set(a)}ImportDathang(a){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(a)},e=yield fetch(`${s.APIURL}/dathang/import`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let n=yield e.json();return e.ok||console.log(e.status),n}catch(t){throw console.error(t),t}})}CreateDathang(a){return r(this,null,function*(){try{console.log("\u{1F504} Creating dathang with enhanced date sync:",a);let t=this.timezoneService.synchronizeObjectDates(a,["ngaygiao","ngaynhan"]),e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},n=yield fetch(`${s.APIURL}/dathang`,e);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);let o=yield n.json();n.ok,this.getAllDathang(),this.dathangId.set(o.id)}catch(t){return console.error(t)}})}CreateByNhucau(a){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},e=yield fetch(`${s.APIURL}/dathang/bynhucau`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let n=yield e.json();e.ok,this.getAllDathang(),this.dathangId.set(n.id)}catch(t){return console.error(t)}})}getSLChonhap(a){return r(this,null,function*(){let t=c({},a);console.log("\u{1F504} Enhanced date sync for getSLChonhap:",t),(t.Batdau||t.Ketthuc)&&(t.Batdau=this.timezoneService.toUTC(t.Batdau,"searchStartDate"),t.Ketthuc=this.timezoneService.toUTC(t.Ketthuc,"searchEndDate"));try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},n=yield fetch(`${s.APIURL}/dathang/getchonhap`,e);return n.ok,yield n.json()}catch(e){return console.error(e)}})}searchDathang(a){return r(this,null,function*(){let t=c({},a);console.log("\u{1F504} Enhanced date sync for searchDathang:",t),(t.Batdau||t.Ketthuc)&&(t.Batdau=this.timezoneService.toUTC(t.Batdau,"searchStartDate"),t.Ketthuc=this.timezoneService.toUTC(t.Ketthuc,"searchEndDate"));try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},n=yield fetch(`${s.APIURL}/dathang/search`,e);n.ok;let o=yield n.json();return this.ListDathang.set(o.data),o}catch(e){return console.error(e)}})}getAllDathang(){return r(this,null,function*(){try{let a={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")}},t=yield fetch(`${s.APIURL}/dathang?`,a);t.ok;let e=yield t.json();return this.ListDathang.set(e),e}catch(a){return console.error(a)}})}getDathangByid(a){return r(this,null,function*(){try{let t={method:"GET",headers:{"Content-Type":"application/json"}},e=yield fetch(`${s.APIURL}/dathang/findid/${a}`,t);if(!e.ok)if(e.status===401){let o=JSON.stringify({code:e.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:o}})}else if(e.status===403){let o=JSON.stringify({code:e.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:o}})}else if(e.status===500){let o=JSON.stringify({code:e.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:o}})}else{let o=JSON.stringify({code:e.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:o}})}let n=yield e.json();this.DetailDathang.set(n)}catch(t){return console.error(t)}})}findbysanpham(a){return r(this,null,function*(){try{let t={method:"GET",headers:{"Content-Type":"application/json"}},e=yield fetch(`${s.APIURL}/dathang/findbysanpham/${a}`,t);return e.ok||this.handleError(e.status),yield e.json()}catch(t){return console.error(t)}})}updateDathang(a){return r(this,null,function*(){try{console.log("\u{1F504} Updating dathang with enhanced date sync:",a);let t=this.timezoneService.synchronizeObjectDates(a,["ngaygiao","ngaynhan"]),e={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},n=yield fetch(`${s.APIURL}/dathang/${a.id}`,e);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);let o=yield n.json();n.ok,console.log("data Update",o),this.getDathangByid(o.id)}catch(t){return console.error(t)}})}DeleteDathang(a){return r(this,null,function*(){try{let t={method:"DELETE",headers:{"Content-Type":"application/json"}};(yield fetch(`${s.APIURL}/dathang/${a.id}`,t)).ok,this.getAllDathang()}catch(t){return console.error(t)}})}getDathangBy(a){return r(this,null,function*(){if(a.Batdau||a.Ketthuc){let t=this.timezoneService.getAPIDateRange(a.Batdau,a.Ketthuc);a.Batdau=t.Batdau,a.Ketthuc=t.Ketthuc}try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(c({},a))},e=yield fetch(`${s.APIURL}/dathang/findby`,t);e.ok||this.handleError(e.status);let n=yield e.json();a.isOne===!0?this.DetailDathang.set(n):(this._StorageService.setItem("dathangs_updatedAt",this.timezoneService.nowUTC()),this.ListDathang.set(n.data),this.page.set(n.page||1),this.pageCount.set(n.pageCount||1),this.total.set(n.total||n.data.length),this.pageSize.set(this.pageSize()))}catch{}})}handleError(a){let t="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(a){case 400:t="Th\xF4ng tin \u0111\xE3 t\u1ED3n t\u1EA1i";break;case 401:case 404:t="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:t="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:t="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}}ImportDathangCu(a){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(a)},e=yield fetch(`${s.APIURL}/dathang/importcu`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let n=yield e.json();return this.getAllDathang(),n}catch(t){throw console.error("Error importing dathang:",t),t}})}DeleteBulkDathang(a){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify({ids:a})},e=yield fetch(`${s.APIURL}/dathang/deletebulk`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let n=yield e.json();return this.getAllDathang(),n}catch(t){throw console.error("Error deleting bulk dathang:",t),t}})}getNhacungcapBy(a){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(a)},e=yield fetch(`${s.APIURL}/nhacungcap/findby`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return yield e.json()}catch(t){throw console.error("Error finding nhacungcap:",t),t}})}searchCongno(a){return r(this,null,function*(){let t=c({},a);if(t.Batdau||t.Ketthuc){let e=this.timezoneService.getAPIDateRange(t.Batdau,t.Ketthuc);t.Batdau=e.Batdau,t.Ketthuc=e.Ketthuc}try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},n=yield fetch(`${s.APIURL}/dathang/congnoncc`,e);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);let o=yield n.json();return this.ListDathang.set(o),o}catch(e){return console.error("Error searching congno:",e),[]}})}static \u0275fac=function(t){return new(t||g)(h(y),h(u),h(p))};static \u0275prov=d({token:g,factory:g.\u0275fac,providedIn:"root"})};export{l as a};
