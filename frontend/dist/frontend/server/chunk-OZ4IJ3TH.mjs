import './polyfills.server.mjs';
import{a as Ut}from"./chunk-B6L3634G.mjs";import{a as Wt}from"./chunk-BYAV6JXX.mjs";import{a as Xt}from"./chunk-PULKRUFM.mjs";import{a as Zt}from"./chunk-ZQNWSBRJ.mjs";import"./chunk-KVLOYVVQ.mjs";import"./chunk-7BHYQM75.mjs";import"./chunk-73IBRO6I.mjs";import{c as Jt,f as Qt}from"./chunk-DRJ5IELA.mjs";import{a as Yt}from"./chunk-6JBFYEDD.mjs";import{a as Ht,b as Rt,c as jt,d as Kt,e as Gt,g as $t,w as qt,x as Z}from"./chunk-LXQF6D42.mjs";import{c as Tt,d as Ft,f as Mt,h as It}from"./chunk-T6QRM4JN.mjs";import{a as yt,b as _t,c as Ct}from"./chunk-MA5QE5RX.mjs";import{b as Ot}from"./chunk-YJ6SX3X5.mjs";import{b as zt}from"./chunk-ZXWUWK7D.mjs";import{a as ne}from"./chunk-MGIVCIKU.mjs";import{a as St,b as bt,c as Et,d as wt}from"./chunk-WATAHPR3.mjs";import{a as xt,b as J}from"./chunk-HI3FSC7Q.mjs";import{b as vt,g as Lt,j as Dt,n as kt,q as Nt,u as Pt,v as Vt,x as Bt,y as At}from"./chunk-BRRNXVKE.mjs";import"./chunk-UV2SGOYZ.mjs";import"./chunk-HX7VASDC.mjs";import{a as q}from"./chunk-AEZIUUEM.mjs";import"./chunk-FHGDI7JN.mjs";import"./chunk-TZWSWLDF.mjs";import{a as gt,c as ft,e as $}from"./chunk-U7KFJFV4.mjs";import{y as ht,z as pt}from"./chunk-B665T7JI.mjs";import"./chunk-7T6LZHUD.mjs";import{b as ct,d as dt}from"./chunk-ZZ6RE4P2.mjs";import"./chunk-B3NHLQAG.mjs";import{n as R,o as j,v as K,w as G}from"./chunk-JLZJVQWC.mjs";import{Cc as O,Dc as z,Ec as H,Gb as B,Ic as N,Ja as tt,Jc as u,Kc as P,Lc as C,Mc as at,Nb as v,Nc as rt,Oc as ot,Pc as st,Qc as lt,Sc as ut,Yc as k,Zb as f,_c as T,ad as X,bc as et,hc as it,ic as nt,jc as r,kc as s,lc as A,oa as b,pc as w,tb as m,uc as y,wa as U,wc as g,xa as h,xd as mt,ya as p}from"./chunk-HSX3JMXX.mjs";import"./chunk-KB5IWD3E.mjs";import{a as D,b as V,g as ie,h as W,j as E}from"./chunk-RIAI3ORJ.mjs";function se(c,e){if(c&1){let t=w();r(0,"th",8),y("click",function(){let n=h(t).$implicit,a=g();return p(a.FilterTable("",n))}),u(1),s()}if(c&2){let t=e.$implicit;m(),C(" ",t.name," ")}}function le(c,e){if(c&1){let t=w();r(0,"div",16),y("blur",function(n){h(t);let a=g().$implicit,o=g().index,l=g();return p(l.updateBlur(n,l.filterListSP[o],a))})("keyup.enter",function(n){h(t);let a=g().$implicit,o=g().index,l=g();return p(l.updateEnter(n,l.filterListSP[o],a))}),u(1),k(2,"number"),s()}if(c&2){let t=g().$implicit,i=g().index,n=g();f("contentEditable",!0),m(),C(" ",T(2,2,n.getSLDat(t,n.filterListSP[i]),"1.0-2")," ")}}function ue(c,e){if(c&1&&(r(0,"td",12),v(1,le,3,5,"div",15),s()),c&2){let t=e.$implicit,i=g().index,n=g();m(),f("ngIf",n.CheckSanphaminNCC(t,n.filterListSP[i]))}}function me(c,e){if(c&1){let t=w();r(0,"tr",9)(1,"td",10),y("click",function(){let n=h(t).$implicit,a=g();return p(a.FilterTable(n,""))}),r(2,"span",11),u(3),s()(),r(4,"td",12)(5,"span",13),u(6),s()(),r(7,"td",12)(8,"span",13),u(9),s()(),v(10,ue,2,1,"td",14),s()}if(c&2){let t=e.$implicit,i=g();m(3),C(" ",t.title," "),m(3),C(" ",t.masp," "),m(3),at(" ",t.goiy," (",i.DadatGoiy(t)||0,") "),m(),f("ngForOf",i.filterListNCC)}}var Q=class c{ListFindNCC=[];EditList=[];ListDathang=[];ListDathangChange=new tt;_snackBar=b(q);filterListNCC=[];filterListSP=[];ngAfterViewInit(){this.LoadTable(this.ListFindNCC,this.EditList),console.log("ListFindNCC",this.ListFindNCC),console.log("EditList",this.EditList)}LoadTable(e,t){let i=1;this.filterListNCC=e,this.filterListSP=t,this.filterListSP.forEach(n=>{let a=this.filterListNCC.findIndex(o=>o.Sanpham.some(l=>l.id===n.id));a!==-1&&this.filterListNCC[a].vitri===void 0&&(this.filterListNCC[a].vitri=i,i++)}),this.filterListNCC.sort((n,a)=>n.vitri&&a.vitri?n.vitri-a.vitri:0)}isFilter=!1;FilterTable(e,t){if(this.isFilter=!this.isFilter,this.isFilter){if(e&&Object.keys(e).length>0){let i=this.EditList.filter(a=>a.id===e.id),n=this.ListFindNCC.filter(a=>a.Sanpham.some(o=>o.id===e.id));this.LoadTable(n,i)}else if(t&&Object.keys(t).length>0){let i=this.ListFindNCC.filter(a=>a.id===t.id);i.forEach(a=>{let o=this.filterListSP.filter(l=>a.Sanpham.some(x=>x.id===l.id)).map(l=>V(D({},l),{sldat:Number(l.goiy)}));o.length>0&&(a.sanpham=o)});let n=this.ListDathang.findIndex(a=>a.id===t.id);n!==-1?this.ListDathang[n]=D(D({},this.ListDathang[n]),i[0]):this.ListDathang.push(i[0]),console.log("sanpham",e),console.log("nhacungcap",t),console.log("ListDathang",this.ListDathang),this.ListDathangChange.emit({isSubmit:!1,ListDathang:this.ListDathang}),this.LoadTable(i,i[0].sanpham)}}else this.LoadTable(this.ListFindNCC,this.EditList)}ngOnChanges(e){(e.ListFindNCC||e.EditList)&&this.LoadTable(this.ListFindNCC,this.EditList)}getSLDat(e,t){let i=e.sanpham?.find(n=>n.id===t.id);return i&&i.sldat||0}DadatGoiy(e){let t=this.ListDathang.reduce((i,n)=>{let a=n.sanpham?.find(o=>o.id===e.id);return i+(a?.sldat?Number(a.sldat):0)},0);return(Number(e.goiy)-t).toFixed(2)}trackByFn(e,t){return t.id}CheckSanphaminNCC(e,t){return!!e.Sanpham?.find(n=>n.id===t.id)}updateEnter(e,t,i){let n=["Backspace","Delete","ArrowLeft","ArrowRight","Tab","Home","End"];if(!(e.key>="0"&&e.key<="9"||e.key>="Numpad0"&&e.key<="Numpad9"||n.includes(e.key))){e.preventDefault();return}if(e.key==="Enter"){e.preventDefault();let a=e.target.closest(".sldat-input"),o=0;if(a){let d=a.value||a.innerText;o=Number(d.trim())||0}let l=JSON.parse(JSON.stringify(this.ListDathang)),x=l.find(d=>d.id===i.id);if(x){let d=x.sanpham?.find(_=>_.id===t.id);d?d.sldat=o:(t.sldat=o,x.sanpham=x.sanpham||[],x.sanpham.push(t))}else t.sldat=o,i.sanpham=[t],i.ngaynhan=new Date,l.push(i);let S=(()=>{let d=l.reduce((_,M)=>{let I=M.sanpham?.find(Y=>Y.id===t.id);return _+(I?.sldat?Number(I.sldat):0)},0);return(Number(t.goiy)-d).toFixed(2)})();if(Number(S)<0){this._snackBar.open("S\u1ED1 l\u01B0\u1EE3ng kh\xF4ng h\u1EE3p l\u1EC7","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}let L=this.ListDathang.find(d=>d.id===i.id);if(L){let d=L.sanpham?.find(_=>_.id===t.id);d?d.sldat=o:(t.sldat=o,L.sanpham=L.sanpham||[],L.sanpham.push(t))}else t.sldat=o,i.sanpham=[t],i.ngaynhan=new Date,this.ListDathang.push(i);setTimeout(()=>{let d=Array.from(document.querySelectorAll(".sldat-input")),_=d.findIndex(M=>M===e.target);_!==-1&&_+1<d.length&&d[_+1].focus()}),this.ListDathangChange.emit({isSubmit:!1,ListDathang:this.ListDathang})}}updateBlur(e,t,i){let n=e.target.closest(".sldat-input"),a=0;if(n){let d=n.value||n.innerText;a=Number(d.trim())||0}console.log("newValue",a);let o=JSON.parse(JSON.stringify(this.ListDathang)),l=o.find(d=>d.id===i.id);if(l){let d=l.sanpham?.find(_=>_.id===t.id);d?d.sldat=a:(t.sldat=a,l.sanpham=l.sanpham||[],l.sanpham.push(t))}else t.sldat=a,i.sanpham=[t],i.ngaynhan=new Date,o.push(i);let x=(()=>{let d=o.reduce((_,M)=>{let I=M.sanpham?.find(Y=>Y.id===t.id);return _+(I?.sldat?Number(I.sldat):0)},0);return(Number(t.goiy)-d).toFixed(2)})();if(Number(x)<0){this._snackBar.open("S\u1ED1 l\u01B0\u1EE3ng kh\xF4ng h\u1EE3p l\u1EC7","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});return}let S=this.ListDathang.find(d=>d.id===i.id),L=0;if(S){let d=S.sanpham?.find(_=>_.id===t.id);d&&(L=d.sldat||0)}if(a!==L){if(S){let d=S.sanpham?.find(_=>_.id===t.id);d?d.sldat=a:(t.sldat=a,S.sanpham=S.sanpham||[],S.sanpham.push(t))}else t.sldat=a,i.sanpham=[t],i.ngaynhan=new Date,this.ListDathang.push(i);this.ListDathangChange.emit({isSubmit:!1,ListDathang:this.ListDathang}),console.log(this.ListDathang)}}static \u0275fac=function(t){return new(t||c)};static \u0275cmp=B({type:c,selectors:[["app-tablenhucaudathanh"]],inputs:{ListFindNCC:"ListFindNCC",EditList:"EditList",ListDathang:"ListDathang"},outputs:{ListDathangChange:"ListDathangChange"},features:[U],decls:13,vars:3,consts:[[1,"min-w-full","divide-y","divide-gray-200","border","border-gray-300","rounded-lg","shadow-md"],[1,"bg-gray-50","rounded-t-lg","cursor-pointer"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider","first:rounded-tl-lg","last:rounded-tr-lg"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],["scope","col","class","px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hover:bg-slate-50",3,"click",4,"ngFor","ngForOf"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider","last:rounded-tr-lg"],[1,"bg-white","divide-y","divide-gray-200","rounded-b-lg"],["class","last:rounded-b-lg cursor-pointer hover:bg-slate-50",4,"ngFor","ngForOf","ngForTrackBy"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider","hover:bg-slate-50",3,"click"],[1,"last:rounded-b-lg","cursor-pointer","hover:bg-slate-50"],[1,"whitespace-nowrap","first:rounded-bl-lg",3,"click"],[1,"max-w-40","line-clamp-4","p-2"],[1,"whitespace-nowrap"],[1,"max-w-40","line-clamp-4"],["class","whitespace-nowrap",4,"ngFor","ngForOf"],["class","sldat-input p-2 min-w-28 text-end bg-slate-200 focus:border rounded-lg focus:border-blue-600 focus:bg-slate-100 focus:outline-none",3,"contentEditable","blur","keyup.enter",4,"ngIf"],[1,"sldat-input","p-2","min-w-28","text-end","bg-slate-200","focus:border","rounded-lg","focus:border-blue-600","focus:bg-slate-100","focus:outline-none",3,"blur","keyup.enter","contentEditable"]],template:function(t,i){t&1&&(r(0,"table",0)(1,"thead",1)(2,"tr")(3,"th",2),u(4," T\xEAn S\u1EA3n Ph\u1EA9m "),s(),r(5,"th",3),u(6," M\xE3 S\u1EA3n Ph\u1EA9m "),s(),r(7,"th",3),u(8," G\u1EE3i \xDD "),s(),v(9,se,2,1,"th",4),A(10,"th",5),s()(),r(11,"tbody",6),v(12,me,11,5,"tr",7),s()()),t&2&&(m(9),f("ngForOf",i.filterListNCC),m(3),f("ngForOf",i.filterListSP)("ngForTrackBy",i.trackByFn))},dependencies:[G,R,j,K,J,$],encapsulation:2,changeDetection:0})};var ee=ie(ne());var ce=["drawer"],de=()=>({standalone:!0}),he=(c,e)=>e.key;function pe(c,e){if(c&1){let t=w();r(0,"button",45),y("click",function(n){let a=h(t).$implicit;return g().toggleColumn(a),p(n.stopPropagation())}),r(1,"mat-icon"),u(2),s(),r(3,"span"),u(4),s()()}if(c&2){let t=e.$implicit;m(2),P(t.isShow?"check_box":"check_box_outline_blank"),m(2),P(t.value)}}function ge(c,e){if(c&1){let t=w();r(0,"button",46),y("click",function(){h(t);let n=g(),a=N(93);return p(n.OpenTaodonDialog(a))}),u(1," T\u1EA1o M\u1EDBi "),s()}}function fe(c,e){if(c&1){let t=w();r(0,"tr",47),y("click",function(){let n=h(t).$implicit,a=g();return p(a.AddToEdit(n))}),r(1,"td",48),u(2),s(),r(3,"td",48),u(4),s(),r(5,"td",48),u(6),s(),r(7,"td",49),u(8),k(9,"number"),s(),r(10,"td",49),u(11),k(12,"number"),s(),r(13,"td",49),u(14),k(15,"number"),s(),r(16,"td",49),u(17),k(18,"number"),s(),r(19,"td",49),u(20),s()()}if(c&2){let t=e.$implicit,i=g();et("hover:bg-slate-100 ",i.CheckItemInEdit(t)?"!bg-slate-200":"",""),m(2),C(" ",t.masp," "),m(2),C(" ",t.title," "),m(2),C(" ",t.dvt," "),m(2),C(" ",T(9,11,t.slchogiao,"1.0-2")," "),m(3),C(" ",T(12,14,t.goiy,"1.0-2")," "),m(3),C(" ",T(15,17,t.slchonhap,"1.0-2")," "),m(3),C(" ",T(18,20,t.slton,"1.0-2")," "),m(3),C(" ",t.haohut,"% ")}}function ye(c,e){c&1&&(r(0,"tr")(1,"td",50),u(2," Kh\xF4ng t\xECm th\u1EA5y d\u1EEF li\u1EC7u "),s()())}function _e(c,e){c&1&&(r(0,"mat-dialog-content")(1,"div",51)(2,"div",52),u(3,"X\xE1c Nh\u1EADn"),s(),r(4,"div"),u(5,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),s(),r(6,"div",53)(7,"button",54),u(8,"\u0110\u1ED3ng \xDD"),s(),r(9,"button",55),u(10,"Hu\u1EF7 B\u1ECF"),s()()()())}function Ce(c,e){if(c&1){let t=w();r(0,"button",42),y("click",function(){h(t);let n=g(2);return p(n.CheckSubmit())}),u(1,"Ki\u1EC3m Tra"),s()}}function xe(c,e){c&1&&(r(0,"button",54),u(1,"\u0110\u1ED3ng \xDD"),s())}function Se(c,e){c&1&&(r(0,"button",55),u(1,"Hu\u1EF7 B\u1ECF"),s())}function be(c,e){if(c&1){let t=w();r(0,"mat-dialog-content",56)(1,"div",57)(2,"div",58),u(3,"\u0110\u1EB7t h\xE0ng nh\xE0 cung c\u1EA5p"),s(),r(4,"div",59)(5,"app-tablenhucaudathanh",60),y("ListDathangChange",function(n){h(t);let a=g();return p(a.onListDathangChange(n))}),s()(),r(6,"div",53),v(7,Ce,2,0,"button",61)(8,xe,2,0,"button",62)(9,Se,2,0,"button",63),s()()()}if(c&2){let t=g();m(5),f("ListFindNCC",t.ListFindNCC)("EditList",t.EditList)("ListDathang",t.ListDathang),m(2),f("ngIf",!t.isSubmit),m(),f("ngIf",t.isSubmit),m(),f("ngIf",t.isSubmit)}}var F=class F{displayedColumns=["title","masp","giagoc","dvt","slton","slchogiao","slchonhap","haohut","goiy"];ColumnName={title:"T\xEAn S\u1EA3n Ph\u1EA9m",masp:"M\xE3 S\u1EA3n Ph\u1EA9m",giagoc:"Gi\xE1 G\u1ED1c",dvt:"\u0110\u01A1n V\u1ECB T\xEDnh",slton:"T\u1ED3n",slchogiao:"Ch\u1EDD Giao",slchonhap:"Ch\u1EDD Nh\u1EADp",haohut:"Hao H\u1EE5t",goiy:"G\u1EE3i \xDD"};FilterColumns=JSON.parse(localStorage.getItem("NhucauColFilter")||"[]");Columns=[];totalItems=0;pageSize=10;currentPage=1;totalPages=1;paginator;sort;drawer;filterValues={};_SanphamService=b(Zt);_breakpointObserver=b(ht);_GoogleSheetService=b(Yt);_NhacungcapService=b(Xt);_DathangService=b(Wt);_KhoService=b(Ut);_router=b(dt);_dialog=b(Tt);Listsanpham=this._SanphamService.ListSanpham;EditList=[];dataSource=new Z;sanphamId=this._SanphamService.sanphamId;_snackBar=b(q);CountItem=0;isSearch=!1;constructor(){this.displayedColumns.forEach(e=>{this.filterValues[e]=""}),mt(()=>{this.dataSource.data=this.Listsanpham(),this.totalItems=this.Listsanpham().length,this.calculateTotalPages()})}GetGoiy(e){return parseFloat(((e.soluongkho-e.soluong)*(1+e.haohut/100)).toString()).toFixed(2)}applyFilter(e){let t=e.target.value;this.dataSource.filter=t.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}ngOnInit(){return E(this,null,function*(){this.updateDisplayData(),this._SanphamService.listenSanphamUpdates(),yield this._SanphamService.getNhucau(),this.dataSource=new Z(this.Listsanpham()),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.initializeColumns(),this.setupDrawer()})}refresh(){return E(this,null,function*(){yield this._SanphamService.getAllSanpham()})}initializeColumns(){this.Columns=Object.keys(this.ColumnName).map(e=>({key:e,value:this.ColumnName[e],isShow:!0})),this.FilterColumns.length===0?this.FilterColumns=this.Columns:localStorage.setItem("NhucauColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{})}setupDrawer(){this._breakpointObserver.observe([pt.Handset]).subscribe(e=>{e.matches?this.drawer.mode="over":this.drawer.mode="side"})}toggleColumn(e){let t=this.FilterColumns.find(i=>i.key===e.key);t&&(t.isShow=!t.isShow,this.updateDisplayedColumns())}FilterHederColumn(e,t){return e.filter((n,a,o)=>a===o.findIndex(l=>l[t]===n[t]))}doFilterHederColumn(e,t){this.dataSource.filteredData=this.Listsanpham().filter(n=>n[t].toLowerCase().includes(e.target.value.toLowerCase()));let i=e.target.value.toLowerCase()}ListFilter=[];ChosenItem(e,t){let i=this.dataSource.filteredData.filter(a=>a[t]===e[t]);this.ListFilter.filter(a=>a[t]===e[t]).length>0?this.ListFilter=this.ListFilter.filter(a=>a[t]!==e[t]):this.ListFilter=[...this.ListFilter,...i]}ChosenAll(e){e.forEach(t=>{!!this.ListFilter.find(n=>n.id===t.id)?this.ListFilter=this.ListFilter.filter(n=>n.id!==n.id):this.ListFilter.push(t)})}ResetFilter(){this.ListFilter=this.Listsanpham(),this.dataSource.data=this.Listsanpham(),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}EmptyFiter(){this.ListFilter=[]}CheckItem(e){return!!this.ListFilter.find(t=>t.id===e.id)}ApplyFilterColum(e){this.dataSource.data=this.Listsanpham().filter(t=>this.ListFilter.some(i=>i.id===t.id)),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,e.closeMenu()}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(e=>e.isShow).map(e=>e.key),this.ColumnName=this.FilterColumns.reduce((e,t)=>(t.isShow&&(e[t.key]=t.value),e),{}),localStorage.setItem("NhucauColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(e){let t=e.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(i=>i.value.toLowerCase().includes(t))}create(){this.drawer.open(),this._router.navigate(["admin/sanpham","new"])}ListSPNCC=[];openDeleteDialog(e){return E(this,null,function*(){this._dialog.open(e,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(i=>{i=="true"&&this.DeleteListItem()})})}DeleteListItem(){this.EditList.forEach(e=>{this._SanphamService.DeleteSanpham(e)}),this.EditList=[],this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}ListFindNCC=[];ListDathang=[];isSubmit=!1;onListDathangChange(e){console.log(e),this.isSubmit=e.isSubmit,this.ListDathang=e.ListDathang,console.log(this.ListDathang)}CheckSubmit(){let e=this.ListDathang.some(t=>(t.sanpham||[]).some(i=>Number(i.sldat)<0));return console.log(e),console.log(this.ListDathang),e?(this._snackBar.open("C\xF3 s\u1EA3n ph\u1EA9m c\xF3 s\u1ED1 l\u01B0\u1EE3ng \u0111\u1EB7t \xE2m!","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),this.isSubmit=!1,!1):(this.isSubmit=!0,!0)}OpenTaodonDialog(e){return E(this,null,function*(){this.ListFindNCC=yield this._NhacungcapService.Findbyids(this.EditList.map(i=>i.id)),this.EditList=this.EditList.filter(i=>this.ListFindNCC.some(n=>n.Sanpham.some(a=>a.id===i.id))),this._dialog.open(e,{hasBackdrop:!0,disableClose:!0}).afterClosed().subscribe(i=>{i=="true"&&(console.log(this.ListDathang),E(this,null,function*(){for(let n of this.ListDathang)yield this._DathangService.CreateByNhucau(n),yield new Promise(a=>setTimeout(a,100))}).then(()=>{this._snackBar.open("T\u1EA1o M\u1EDBi \u0111\u1EB7t h\xE0ng th\xE0nh c\xF4ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this._router.navigate(["/admin/dathang"])}).catch(n=>{this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi T\u1EA1o M\u1EDBi \u0111\u1EB7t h\xE0ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),console.error("Error creating orders:",n)}))})})}CheckSanphaminNCC(e,t){return!!e.Sanpham?.find(n=>n.id===t.id)}updateValue(e,t,i){let n=Number(e.target.innerText.trim())||0,a=this.ListDathang.find(o=>o.id===i.id);if(console.log(a),a){let o=a.sanpham.find(l=>l.id===t.id);o?o.sldat=n:(t.sldat=n,a.Sanpham.push(t))}else t.sldat=n,i.sanpham=[t],i.ngaynhan=new Date,this.ListDathang.push(i);console.log(this.ListDathang)}AddToEdit(e){this.EditList.find(i=>i.id===e.id)?this.EditList=this.EditList.filter(i=>i.id!==e.id):this.EditList.push(e)}ChoseAllEdit(){this.EditList=this.Listsanpham()}CheckItemInEdit(e){return this.EditList.some(t=>t.id===e.id)}goToDetail(e){this.drawer.open(),this._SanphamService.setSanphamId(e.id),this._router.navigate(["admin/sanpham",e.id])}LoadDrive(){return E(this,null,function*(){let e={IdSheet:"15npo25qyH5FmfcEjl1uyqqyFMS_vdFnmxM_kt0KYmZk",SheetName:"SPImport",ApiKey:"AIzaSyD33kgZJKdFpv1JrKHacjCQccL_O0a2Eao"},t=yield this._GoogleSheetService.getDrive(e),i=zt(t.values);this.DoImportData(i)})}DoImportData(e){return E(this,null,function*(){let t=e.map(l=>({title:l.title?.trim()||"",masp:l.masp?.trim()||"",giagoc:Number(l.giagoc)||0,dvt:l.dvt?.trim()||"",soluong:Number(l.soluong)||0,soluongkho:Number(l.soluongkho)||0,haohut:Number(l.haohut)||0,ghichu:l.ghichu?.trim()||""})),i=Array.from(new Map(t.map(l=>[l.masp,l])).values()),n=this._SanphamService.ListSanpham(),a=n.map(l=>l.masp),o=i.map(l=>l.masp).filter(l=>!a.includes(l));yield Promise.all(i.map(l=>E(this,null,function*(){let x=n.find(S=>S.masp===l.masp);if(x){let S=D(D({},x),l);yield this._SanphamService.updateSanpham(S)}else yield this._SanphamService.CreateSanpham(l)}))),yield Promise.all(n.filter(l=>!i.some(x=>x.masp===l.masp)).map(l=>this._SanphamService.updateSanpham(V(D({},l),{isActive:!1})))),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ImporExcel(e){return E(this,null,function*(){let t=yield Qt(e);this.DoImportData(t)})}ExportExcel(e,t){return E(this,null,function*(){let i=yield this._KhoService.getAllKho();console.log(i);let n=e.map(o=>({ngaynhan:(0,ee.default)().format("YYYY-MM-DD"),masp:o.masp,title:o.title,dvt:o.dvt,slchogiao:o.slchogiao,goiy:o.goiy,slchonhap:o.slchonhap,slton:o.slton,haohut:o.haohut,ghichu:o.ghichu})),a={ngaynhan:"Ng\xE0y Nh\u1EADn",masp:"M\xE3 S\u1EA3n Ph\u1EA9m",title:"T\xEAn S\u1EA3n Ph\u1EA9m",dvt:"\u0110\u01A1n V\u1ECB T\xEDnh",slchogiao:"Ch\u1EDD Giao",goiy:"G\u1EE3i \xDD",slchonhap:"Ch\u1EDD Nh\u1EADp",slton:"T\u1ED3n Kho",haohut:"Hao H\u1EE5t",ghichu:"Ghi Ch\xFA"};i.forEach(o=>{a[`makho_${o.makho}`]=o.makho}),console.log(n,t,Object.keys(a),a),Jt(n,t,Object.values(a),a)})}trackByFn(e,t){return t.id}calculateTotalPages(){this.totalPages=Math.ceil(this.totalItems/this.pageSize)}onPageSizeChange(e,t){e>this.Listsanpham().length?(this.pageSize=this.Listsanpham().length,this._snackBar.open(`S\u1ED1 l\u01B0\u1EE3ng t\u1ED1i \u0111a ${this.Listsanpham().length}`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})):this.pageSize=e,this.currentPage=1,this.calculateTotalPages(),this.updateDisplayData(),t.closeMenu()}onPreviousPage(){this.currentPage>1&&(this.currentPage--,this.updateDisplayData())}onNextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.updateDisplayData())}updateDisplayData(){let e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize,i=this.Listsanpham().slice(e,t);this.dataSource.data=i}static \u0275fac=function(t){return new(t||F)};static \u0275cmp=B({type:F,selectors:[["app-nhucaudathang"]],viewQuery:function(t,i){if(t&1&&(O(jt,5),O(Gt,5),O(ce,7)),t&2){let n;z(n=H())&&(i.paginator=n.first),z(n=H())&&(i.sort=n.first),z(n=H())&&(i.drawer=n.first)}},decls:94,vars:18,consts:[["drawer",""],["menu","matMenu"],["uploadfile",""],["menuHienthi","matMenuTrigger"],["DeleteDialog",""],["TaodonDialog",""],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","lg:!w-1/2","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-16","w-full","p-2"],[1,"border","p-1","cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","bg-white","rounded-lg"],[1,"w-full","flex","flex-row","space-x-2","items-center"],[1,"relative"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["matTooltip","T\u1EA3i file excel M\u1EABu","color","primary","mat-icon-button","",3,"click"],["matTooltip","T\u1EA3i l\xEAn file excel","color","primary","mat-icon-button","",3,"click"],["type","file",1,"hidden",3,"change"],[1,"lg:flex","hidden","whitespace-","p-2","rounded-lg","bg-slate-200",3,"click"],["color","primary","mat-flat-button","",3,"click",4,"ngIf"],[1,"border","rounded-lg","w-full","h-full","overflow-auto"],[1,"!border","w-full","cursor-pointer"],[1,"bg-gray-50","sticky","top-0"],[1,"px-4","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider","whitespace-nowrap"],[1,"bg-white","divide-y","divide-gray-200"],[3,"class","click",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"cursor-pointer","border","rounded-lg","px-3","p-1","flex","flex-row","space-x-2","items-center","justify-between"],[1,"w-full","flex","lg:p-0","p-2","lg:flex-row","lg:space-x-2","lg:items-center","lg:justify-between","flex-col","justify-center"],[1,"w-full","text-center"],[1,"w-full","flex","flex-row","space-x-2","items-center","lg:justify-end","justify-center"],[1,"font-bold","text-blue-600",3,"matMenuTriggerFor"],[1,"w-full","flex","flex-col","space-y-2","p-4",3,"click"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp S\u1ED1 L\u01B0\u1EE3ng",3,"ngModelChange","ngModel","ngModelOptions"],["mat-flat-button","","color","primary",3,"click"],[1,"pagination-controls"],["mat-icon-button","","color","primary",3,"click","disabled"],["mat-menu-item","",3,"click"],["color","primary","mat-flat-button","",3,"click"],[3,"click"],[1,"px-4","py-4","whitespace-nowrap","text-sm","text-gray-900"],[1,"px-4","py-4","whitespace-nowrap","text-sm","text-gray-900","text-right"],["colspan","9",1,"px-4","py-4","text-center","text-sm","text-gray-500"],[1,"flex","flex-col","space-y-8","items-center","justify-center"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary","mat-dialog-close","true"],["mat-flat-button","","color","warn","mat-dialog-close","false"],[1,"!max-h-[90vh]","!h-[90vh]","!w-[90vw]"],[1,"h-full","w-full","flex","flex-col","space-y-8","items-center"],[1,"flex","font-bold"],[1,"flex","h-full","w-full","overflow-auto"],[3,"ListDathangChange","ListFindNCC","EditList","ListDathang"],["mat-flat-button","","color","primary",3,"click",4,"ngIf"],["mat-flat-button","","color","primary","mat-dialog-close","true",4,"ngIf"],["mat-flat-button","","color","warn","mat-dialog-close","false",4,"ngIf"]],template:function(t,i){if(t&1){let n=w();r(0,"mat-drawer-container",6)(1,"mat-drawer",7,0),A(3,"router-outlet"),s(),r(4,"div",8)(5,"div",9)(6,"div",10)(7,"div",11)(8,"input",12),y("keyup",function(o){return h(n),p(i.applyFilter(o))}),s(),r(9,"div",13)(10,"span",14),u(11,"search"),s()()(),r(12,"button",15)(13,"mat-icon"),u(14,"tune"),s()(),r(15,"mat-menu",null,1)(17,"div",16)(18,"mat-form-field",17)(19,"input",18),y("input",function(o){return h(n),p(i.doFilterColumns(o))})("click",function(o){return h(n),p(o.stopPropagation())}),s(),r(20,"mat-icon",19),u(21,"search"),s()()(),r(22,"div",20),it(23,pe,5,2,"button",21,he),s()(),r(25,"button",22),y("click",function(){return h(n),p(i.ExportExcel(i.dataSource.data,"Sanpham"))}),r(26,"mat-icon"),u(27,"file_download"),s()(),r(28,"button",23),y("click",function(){h(n);let o=N(32);return p(o.click())}),r(29,"mat-icon"),u(30,"file_upload"),s()(),r(31,"input",24,2),y("change",function(o){return h(n),p(i.ImporExcel(o))}),s(),r(33,"span",25),y("click",function(){return h(n),p(i.ChoseAllEdit())}),u(34),s(),v(35,ge,2,0,"button",26),s()(),r(36,"div",27)(37,"div",27)(38,"table",28)(39,"thead",29)(40,"tr")(41,"th",30),u(42," M\xE3 S\u1EA3n Ph\u1EA9m "),s(),r(43,"th",30),u(44," T\xEAn S\u1EA3n Ph\u1EA9m "),s(),r(45,"th",30),u(46," \u0110\u01A1n V\u1ECB T\xEDnh "),s(),r(47,"th",30),u(48," SL \u0110\u1EB7t "),s(),r(49,"th",30),u(50," SL C\u1EA7n \u0110\u1EB7t "),s(),r(51,"th",30),u(52," SL B\xE1n "),s(),r(53,"th",30),u(54," T\u1ED3n "),s(),r(55,"th",30),u(56," Hao H\u1EE5t "),s()()(),r(57,"tbody",31),v(58,fe,21,23,"tr",32)(59,ye,3,0,"tr",33),s()()()(),r(60,"div",34)(61,"div",35)(62,"span",36),u(63,"\u0110ang Xem "),r(64,"strong"),u(65),s(),u(66," - "),r(67,"strong"),u(68),s(),u(69),s(),r(70,"div",37)(71,"span",38,3),u(73),s(),r(74,"mat-menu",null,1)(76,"div",39),y("click",function(o){return h(n),p(o.stopPropagation())}),r(77,"span"),u(78,"S\u1ED1 L\u01B0\u1EE3ng"),s(),r(79,"mat-form-field",40)(80,"input",41),lt("ngModelChange",function(o){return h(n),st(i.pageSize,o)||(i.pageSize=o),p(o)}),s()(),r(81,"button",42),y("click",function(){h(n);let o=N(72);return p(i.onPageSizeChange(i.pageSize,o))}),u(82,"\xC1p D\u1EE5ng"),s()()(),r(83,"div",43)(84,"button",44),y("click",function(){return h(n),p(i.onPreviousPage())}),r(85,"mat-icon"),u(86,"keyboard_arrow_left"),s()(),r(87,"button",44),y("click",function(){return h(n),p(i.onNextPage())}),r(88,"mat-icon"),u(89,"keyboard_arrow_right"),s()()()()()()()(),v(90,_e,11,0,"ng-template",null,4,X)(92,be,10,6,"ng-template",null,5,X)}if(t&2){let n=N(16);m(),f("position","end"),m(11),f("matMenuTriggerFor",n),m(11),nt(i.FilterColumns),m(11),C(" ",i.Listsanpham().length," S\u1EA3n Ph\u1EA9m "),m(),f("ngIf",i.EditList.length>0),m(23),f("ngForOf",i.dataSource.filteredData),m(),f("ngIf",i.dataSource.filteredData.length===0),m(6),P((i.currentPage-1)*i.pageSize+1),m(3),P(i.currentPage*i.pageSize>i.totalItems?i.totalItems:i.currentPage*i.pageSize),m(),rt(" trong s\u1ED1 ",i.totalItems," m\u1EE5c, ",i.currentPage,"/",i.totalPages," Trang"),m(2),f("matMenuTriggerFor",n),m(2),C("Hi\u1EC7n Th\u1ECB : ",i.pageSize," m\u1EE5c"),m(7),ot("ngModel",i.pageSize),f("ngModelOptions",ut(17,de)),m(4),f("disabled",i.currentPage===1),m(3),f("disabled",i.currentPage===i.totalPages)}},dependencies:[Vt,Pt,Nt,At,Bt,qt,$t,Kt,wt,bt,St,Et,Ct,yt,_t,ct,J,xt,$,gt,ft,Ot,G,R,j,K,kt,vt,Lt,Dt,Rt,Ht,It,Ft,Mt,Q],encapsulation:2,changeDetection:0})};W([Ee()],F.prototype,"FilterHederColumn",1),W([we(300)],F.prototype,"doFilterHederColumn",1);var te=F;function Ee(){return function(c,e,t){let i=t.value,n=new Map;return t.value=function(...a){let o=JSON.stringify(a);if(n.has(o))return n.get(o);let l=i.apply(this,a);return n.set(o,l),l},t}}function we(c=300){return function(e,t,i){let n=i.value,a;return i.value=function(...o){clearTimeout(a),a=setTimeout(()=>{n.apply(this,o)},c)},i}}export{te as NhucaudathangComponent};
