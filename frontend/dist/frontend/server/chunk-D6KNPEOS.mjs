import './polyfills.server.mjs';
import{a as f}from"./chunk-C5YW4KVZ.mjs";import{a as p,b as y}from"./chunk-BNB7YGJH.mjs";import{Ra as h,ja as m,pa as c}from"./chunk-5IMI5WTE.mjs";import{a as n,b as l,j as a}from"./chunk-RIAI3ORJ.mjs";var w=class u{graphqlService=c(f);storageService=c(y);snackBar=c(p);modelName="chotkho";chotkhos=h([]);isLoading=h(!1);selectedChotkho=h(null);ListChotkho=h([]);DetailChotkho=h(null);page=h(1);totalPages=h(1);total=h(0);pageSize=h(50);chotkhoId=h(null);isRefreshing=h(!1);lastUpdated=h(null);constructor(){}loadAllChotkho(){return a(this,null,function*(){try{this.isLoading.set(!0);let e=yield this.graphqlService.findMany(this.modelName,{include:{user:{select:{id:!0,email:!0,profile:{select:{name:!0}}}},kho:{select:{id:!0,name:!0,makho:!0,diachi:!0}},details:{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0,giagoc:!0}},tonkho:{select:{id:!0,slton:!0,slchogiao:!0,slchonhap:!0}},phieukho:{select:{id:!0,maphieu:!0,ngay:!0,type:!0}}}}},orderBy:{order:"asc"}});this.chotkhos.set(e||[]),this.ListChotkho.set(e||[]),this.total.set(e?.length||0),this.lastUpdated.set(new Date)}catch(e){console.error("Error loading chotkho:",e),this.showErrorMessage("L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u ch\u1ED1t kho"),this.chotkhos.set([]),this.ListChotkho.set([])}finally{this.isLoading.set(!1)}})}getAllChotkho(e){return a(this,null,function*(){try{this.isLoading.set(!0),this.isRefreshing.set(!0);let t={};e&&(e.startDate&&e.endDate&&(t.ngay={gte:new Date(e.startDate),lte:new Date(e.endDate)}),e.khoId&&(t.khoId=e.khoId),e.sanphamId&&(t.details={some:{sanphamId:e.sanphamId}}),e.userId&&(t.userId=e.userId),e.searchText&&(t.OR=[{title:{contains:e.searchText,mode:"insensitive"}},{ghichu:{contains:e.searchText,mode:"insensitive"}},{details:{some:{sanpham:{title:{contains:e.searchText,mode:"insensitive"}}}}}]));let r=(this.page()-1)*this.pageSize(),s=yield this.graphqlService.findMany(this.modelName,{where:t,include:{user:{select:{id:!0,email:!0,profile:{select:{name:!0}}}},kho:{select:{id:!0,name:!0,makho:!0,diachi:!0}},details:{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0,giagoc:!0}},tonkho:{select:{id:!0,slton:!0,slchogiao:!0,slchonhap:!0}}}}},orderBy:{order:"asc"},skip:r,take:this.pageSize()}),i=yield this.graphqlService.findMany(this.modelName,{where:t,select:{id:!0}});this.ListChotkho.set(s||[]),this.total.set(i?.length||0),this.totalPages.set(Math.ceil((i?.length||0)/this.pageSize())),this.lastUpdated.set(new Date)}catch(t){console.error("Error getting all chotkho:",t),this.showErrorMessage("L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u ch\u1ED1t kho"),this.ListChotkho.set([])}finally{this.isLoading.set(!1),this.isRefreshing.set(!1)}})}getChotkhoById(e){return a(this,null,function*(){try{let t=yield this.graphqlService.findUnique(this.modelName,{id:e},{include:{user:{select:{id:!0,email:!0,profile:{select:{name:!0}}}},kho:{select:{id:!0,name:!0,makho:!0,diachi:!0}},details:{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0,giagoc:!0}},tonkho:{select:{id:!0,slton:!0,slchogiao:!0,slchonhap:!0}},phieukho:{select:{id:!0,maphieu:!0,ngay:!0,type:!0}}}}}});return t&&(this.selectedChotkho.set(t),this.DetailChotkho.set(t)),t}catch(t){return console.error("Error getting chotkho by ID:",t),this.showErrorMessage("L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u ch\u1ED1t kho"),null}})}createChotkho(e){return a(this,null,function*(){try{if(this.isLoading.set(!0),Array.isArray(e))return yield this.bulkCreateChotkho(e);let t=yield this.graphqlService.createOne(this.modelName,l(n({},e),{details:{create:e.details}}),{include:{user:{select:{id:!0,email:!0,profile:{select:{name:!0}}}},kho:{select:{id:!0,name:!0,makho:!0,diachi:!0}},details:{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0,giagoc:!0}},tonkho:{select:{id:!0,slton:!0,slchogiao:!0,slchonhap:!0}},phieukho:{select:{id:!0,maphieu:!0,ngay:!0,type:!0}}}}}});return t?(this.showSuccessMessage("T\u1EA1o ch\u1ED1t kho th\xE0nh c\xF4ng"),yield this.getAllChotkho(),{success:!0,data:t}):(this.showErrorMessage("L\u1ED7i khi t\u1EA1o ch\u1ED1t kho"),{success:!1})}catch(t){return console.error("Error creating chotkho:",t),this.showErrorMessage(t?.message||"L\u1ED7i khi t\u1EA1o ch\u1ED1t kho"),{success:!1,message:t?.message}}finally{this.isLoading.set(!1)}})}updateChotkho(e,t){return a(this,null,function*(){try{this.isLoading.set(!0);let r,s;return typeof e=="string"?(r=e,s=t):(r=e.id,s=n({},e),delete s.id),(yield this.graphqlService.updateOne(this.modelName,{id:r},s,{include:{user:{select:{id:!0,email:!0,profile:{select:{name:!0}}}},kho:{select:{id:!0,name:!0,makho:!0,diachi:!0}},sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0,giagoc:!0}},tonkho:{select:{id:!0,slton:!0,slchogiao:!0,slchonhap:!0}},phieukho:{select:{id:!0,maphieu:!0,ngay:!0,type:!0}}}}))?(this.showSuccessMessage("C\u1EADp nh\u1EADt ch\u1ED1t kho th\xE0nh c\xF4ng"),yield this.getAllChotkho(),!0):(this.showErrorMessage("L\u1ED7i khi c\u1EADp nh\u1EADt ch\u1ED1t kho"),!1)}catch(r){return console.error("Error updating chotkho:",r),this.showErrorMessage(r?.message||"L\u1ED7i khi c\u1EADp nh\u1EADt ch\u1ED1t kho"),!1}finally{this.isLoading.set(!1)}})}deleteChotkho(e){return a(this,null,function*(){try{return this.isLoading.set(!0),(yield this.graphqlService.deleteOne(this.modelName,{id:e}))?(this.showSuccessMessage("X\xF3a ch\u1ED1t kho th\xE0nh c\xF4ng"),yield this.loadAllChotkho(),{deleted:1,failed:0,restoredInventory:!0,deletedPhieukho:!0}):(this.showErrorMessage("L\u1ED7i khi x\xF3a ch\u1ED1t kho"),!1)}catch(t){return console.error("Error deleting chotkho:",t),this.showErrorMessage(t?.message||"L\u1ED7i khi x\xF3a ch\u1ED1t kho"),!1}finally{this.isLoading.set(!1)}})}createChotkhoDetail(e,t){return a(this,null,function*(){try{this.isLoading.set(!0);let r=yield this.graphqlService.createOne("chotkhodetail",l(n({},t),{chotkhoId:e,chenhlech:this.calculateChenhLech(t.slthucte,t.slhethong)}),{include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0,giagoc:!0}},tonkho:{select:{id:!0,slton:!0,slchogiao:!0,slchonhap:!0}},phieukho:{select:{id:!0,maphieu:!0,ngay:!0,type:!0}}}});return r?(this.showSuccessMessage("T\u1EA1o chi ti\u1EBFt ch\u1ED1t kho th\xE0nh c\xF4ng"),{success:!0,data:r}):(this.showErrorMessage("L\u1ED7i khi t\u1EA1o chi ti\u1EBFt ch\u1ED1t kho"),{success:!1})}catch(r){return console.error("Error creating chotkho detail:",r),this.showErrorMessage(r?.message||"L\u1ED7i khi t\u1EA1o chi ti\u1EBFt ch\u1ED1t kho"),{success:!1,message:r?.message}}finally{this.isLoading.set(!1)}})}updateChotkhoDetail(e,t){return a(this,null,function*(){try{this.isLoading.set(!0);let r=n({},t);return r.slthucte!==void 0&&r.slhethong!==void 0&&(r.chenhlech=this.calculateChenhLech(r.slthucte,r.slhethong)),(yield this.graphqlService.updateOne("chotkhodetail",{id:e},r,{include:{sanpham:!0,tonkho:!0,phieukho:!0}}))?(this.showSuccessMessage("C\u1EADp nh\u1EADt chi ti\u1EBFt ch\u1ED1t kho th\xE0nh c\xF4ng"),!0):(this.showErrorMessage("L\u1ED7i khi c\u1EADp nh\u1EADt chi ti\u1EBFt ch\u1ED1t kho"),!1)}catch(r){return console.error("Error updating chotkho detail:",r),this.showErrorMessage(r?.message||"L\u1ED7i khi c\u1EADp nh\u1EADt chi ti\u1EBFt ch\u1ED1t kho"),!1}finally{this.isLoading.set(!1)}})}deleteChotkhoDetail(e){return a(this,null,function*(){try{return this.isLoading.set(!0),(yield this.graphqlService.deleteOne("chotkhodetail",{id:e}))?(this.showSuccessMessage("X\xF3a chi ti\u1EBFt ch\u1ED1t kho th\xE0nh c\xF4ng"),!0):(this.showErrorMessage("L\u1ED7i khi x\xF3a chi ti\u1EBFt ch\u1ED1t kho"),!1)}catch(t){return console.error("Error deleting chotkho detail:",t),this.showErrorMessage(t?.message||"L\u1ED7i khi x\xF3a chi ti\u1EBFt ch\u1ED1t kho"),!1}finally{this.isLoading.set(!1)}})}getChotkhoDetailsByChotkhoId(e){return a(this,null,function*(){try{return(yield this.graphqlService.findMany("chotkhodetail",{where:{chotkhoId:e},include:{sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0,giagoc:!0}},tonkho:{select:{id:!0,slton:!0,slchogiao:!0,slchonhap:!0}},phieukho:{select:{id:!0,maphieu:!0,ngay:!0,type:!0}}},orderBy:{order:"asc"}}))||[]}catch(t){return console.error("Error getting chotkho details:",t),this.showErrorMessage("L\u1ED7i khi t\u1EA3i chi ti\u1EBFt ch\u1ED1t kho"),[]}})}bulkDeleteChotkho(e){return a(this,null,function*(){if(!e||e.length===0)return this.showErrorMessage("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 x\xF3a"),{deleted:0,failed:0,errors:["No data to delete"]};try{return this.isLoading.set(!0),(yield this.graphqlService.batchDelete(this.modelName,e))?(this.showSuccessMessage(`X\xF3a th\xE0nh c\xF4ng ${e.length} ch\u1ED1t kho`),yield this.loadAllChotkho(),{deleted:e.length,failed:0,restoredInventory:!0,deletedPhieukho:!0}):(this.showErrorMessage("L\u1ED7i khi x\xF3a nhi\u1EC1u ch\u1ED1t kho"),{deleted:0,failed:e.length,errors:["Bulk delete failed"]})}catch(t){return console.error("Error bulk deleting chotkho:",t),this.showErrorMessage("L\u1ED7i khi x\xF3a nhi\u1EC1u ch\u1ED1t kho"),{deleted:0,failed:e.length,errors:[t?.message||"Unknown error"]}}finally{this.isLoading.set(!1)}})}getChotkhoByDateRange(e){return a(this,null,function*(){try{this.isLoading.set(!0);let t={};e.startDate&&e.endDate&&(t.ngay={gte:new Date(e.startDate),lte:new Date(e.endDate)});let r=yield this.graphqlService.findMany(this.modelName,{where:t,include:{user:{select:{id:!0,email:!0,profile:{select:{name:!0}}}},kho:{select:{id:!0,name:!0,makho:!0,diachi:!0}}},orderBy:{ngay:"desc"}});return{data:r||[],total:r?.length||0}}catch(t){return console.error("Error getting chotkho by date range:",t),this.showErrorMessage("L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u ch\u1ED1t kho theo th\u1EDDi gian"),{data:[],total:0}}finally{this.isLoading.set(!1)}})}getChotkhoBy(e){return a(this,null,function*(){try{this.isLoading.set(!0);let t={};if(e.ngay){let s=new Date(e.ngay)||new Date;t.ngay=s}Object.keys(e).forEach(s=>{s!=="ngay"&&e[s]!==null&&e[s]!==void 0&&(t[s]=e[s])});let r=yield this.graphqlService.findMany(this.modelName,{where:t,include:{user:{select:{id:!0,email:!0,profile:{select:{name:!0}}}},kho:{select:{id:!0,name:!0,makho:!0,diachi:!0}}},orderBy:{order:"asc"}});return r&&r.length>0?(this.selectedChotkho.set(r[0]),this.DetailChotkho.set(r[0]),r[0]):null}catch(t){return console.error("Error getting chotkho by params:",t),this.showErrorMessage("L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u ch\u1ED1t kho"),null}finally{this.isLoading.set(!1)}})}CreateChotkho(e){return a(this,null,function*(){return yield this.createChotkho(e)})}DeleteChotkho(e){return a(this,null,function*(){return(yield this.deleteChotkho(e.id))!==!1})}getListSanphamTonKho(e){return a(this,null,function*(){try{return(yield this.graphqlService.findMany("tonkho",{where:{sanphamId:{in:e}},take:99999,include:{sanpham:!0}}))||[]}catch(t){return console.error("Error getting sanpham tonkho:",t),this.showErrorMessage("L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u t\u1ED3n kho s\u1EA3n ph\u1EA9m"),[]}})}getListSanphamByMasp(e){return a(this,null,function*(){try{return(yield this.graphqlService.findMany("sanpham",{where:{masp:{in:e}},take:99999,select:{id:!0,title:!0,masp:!0,dvt:!0}}))||[]}catch(t){return console.error("Error getting sanpham tonkho:",t),this.showErrorMessage("L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u t\u1ED3n kho s\u1EA3n ph\u1EA9m"),[]}})}bulkCreateChotkho(e){return a(this,null,function*(){try{this.isLoading.set(!0),console.log("Bulk creating chotkho with data:",e);let t=yield this.graphqlService.batchCreate(this.modelName,e);return t?(this.showSuccessMessage("T\u1EA1o ch\u1ED1t kho h\xE0ng lo\u1EA1t th\xE0nh c\xF4ng"),yield this.getAllChotkho(),{success:!0,data:t,created:t.length,failed:0}):(this.showErrorMessage("L\u1ED7i khi t\u1EA1o ch\u1ED1t kho h\xE0ng lo\u1EA1t"),{success:!1,created:0,failed:e.length})}catch(t){return console.error("Error bulk creating chotkho:",t),this.showErrorMessage("L\u1ED7i khi t\u1EA1o ch\u1ED1t kho h\xE0ng lo\u1EA1t"),{success:!1,created:0,failed:e.length,error:t?.message}}finally{this.isLoading.set(!1)}})}setSelectedChotkho(e){this.selectedChotkho.set(e),this.DetailChotkho.set(e)}clearSelectedChotkho(){this.selectedChotkho.set(null),this.DetailChotkho.set(null)}setChotkhoId(e){this.chotkhoId.set(e)}calculateChenhLech(e,t){return e-t}createChotkhoData(e){let t=e.details.map(r=>l(n({},r),{chenhlech:this.calculateChenhLech(r.slthucte,r.slhethong)}));return{khoId:e.khoId,ngay:new Date,title:e.title,ghichu:e.ghichu,userId:e.userId,details:t}}validateChotkhoData(e){let t=[];return(!e.details||e.details.length===0)&&t.push("Chi ti\u1EBFt ch\u1ED1t kho l\xE0 b\u1EAFt bu\u1ED9c"),e.details?.forEach((r,s)=>{(r.slthucte===void 0||r.slthucte===null)&&t.push(`D\xF2ng ${s+1}: S\u1ED1 l\u01B0\u1EE3ng th\u1EF1c t\u1EBF (slthucte) l\xE0 b\u1EAFt bu\u1ED9c`),(r.slhethong===void 0||r.slhethong===null)&&t.push(`D\xF2ng ${s+1}: S\u1ED1 l\u01B0\u1EE3ng h\u1EC7 th\u1ED1ng (slhethong) l\xE0 b\u1EAFt bu\u1ED9c`),(typeof r.slthucte!="number"||r.slthucte<0)&&t.push(`D\xF2ng ${s+1}: S\u1ED1 l\u01B0\u1EE3ng th\u1EF1c t\u1EBF ph\u1EA3i l\xE0 s\u1ED1 kh\xF4ng \xE2m`),(typeof r.slhethong!="number"||r.slhethong<0)&&t.push(`D\xF2ng ${s+1}: S\u1ED1 l\u01B0\u1EE3ng h\u1EC7 th\u1ED1ng ph\u1EA3i l\xE0 s\u1ED1 kh\xF4ng \xE2m`)}),{isValid:t.length===0,errors:t}}formatChotkhoForDisplay(e){let t=e.details?.reduce((i,o)=>i+(o.slthucte||0),0)||0,r=e.details?.reduce((i,o)=>i+(o.slhethong||0),0)||0,s=t-r;return{id:e.id,title:e.title||"Ch\u01B0a c\xF3 ti\xEAu \u0111\u1EC1",ngay:e.ngay?new Date(e.ngay).toLocaleDateString("vi-VN"):"",totalSlthucte:t.toLocaleString("vi-VN"),totalSlhethong:r.toLocaleString("vi-VN"),totalChenhlech:s.toLocaleString("vi-VN"),detailCount:e.details?.length||0,ghichu:e.ghichu||"",khoName:e.kho?.name||"",userName:e.user?.profile?.name||e.user?.email||"",isActive:e.isActive?"Ho\u1EA1t \u0111\u1ED9ng":"Kh\xF4ng ho\u1EA1t \u0111\u1ED9ng"}}getUpdatedCodeIds(){return a(this,null,function*(){console.log("getUpdatedCodeIds called")})}getStatistics(){return a(this,null,function*(){try{let e=yield this.graphqlService.findMany(this.modelName,{select:{id:!0}}),t=yield this.graphqlService.findMany(this.modelName,{where:{isActive:!0},select:{id:!0}}),r=yield this.graphqlService.findMany(this.modelName,{where:{isActive:!1},select:{id:!0}});return{total:e?.length||0,active:t?.length||0,inactive:r?.length||0,averageChenhLech:0}}catch(e){return console.error("Error getting statistics:",e),this.showErrorMessage("L\u1ED7i khi l\u1EA5y th\u1ED1ng k\xEA"),null}})}generateReport(e){return a(this,null,function*(){try{let t={};e.dateFrom&&e.dateTo&&(t.ngay={gte:new Date(e.dateFrom),lte:new Date(e.dateTo)});let r=yield this.graphqlService.findMany(this.modelName,{where:t,include:{user:{select:{id:!0,email:!0,profile:{select:{name:!0}}}},kho:{select:{id:!0,name:!0,makho:!0,diachi:!0}},sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0,giagoc:!0}},tonkho:{select:{id:!0,slton:!0,slchogiao:!0,slchonhap:!0}},phieukho:{select:{id:!0,maphieu:!0,ngay:!0,type:!0}}},orderBy:{ngay:"desc"}});return{data:r,total:r?.length||0,generatedAt:new Date,format:e.format||"json"}}catch(t){return console.error("Error generating report:",t),this.showErrorMessage("L\u1ED7i khi t\u1EA1o b\xE1o c\xE1o"),null}})}bulkUpdateStatus(e,t){return a(this,null,function*(){try{this.isLoading.set(!0);let r=e.map(i=>({where:{id:i},data:{isActive:t==="active",updatedAt:new Date}}));return(yield this.graphqlService.batchUpdate(this.modelName,r))?(this.showSuccessMessage("C\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i th\xE0nh c\xF4ng"),yield this.getAllChotkho(),!0):(this.showErrorMessage("L\u1ED7i khi c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i"),!1)}catch(r){return console.error("Error bulk updating status:",r),this.showErrorMessage("L\u1ED7i khi c\u1EADp nh\u1EADt tr\u1EA1ng th\xE1i h\xE0ng lo\u1EA1t"),!1}finally{this.isLoading.set(!1)}})}showSuccessMessage(e){this.snackBar.open(e,"\u0110\xF3ng",{duration:3e3,panelClass:["success-snackbar"],horizontalPosition:"end",verticalPosition:"top"})}showErrorMessage(e){this.snackBar.open(e,"\u0110\xF3ng",{duration:5e3,panelClass:["error-snackbar"],horizontalPosition:"end",verticalPosition:"top"})}getCacheHitRate(){return this.graphqlService.getCacheHitRate?.()||0}getPerformanceMetrics(){return this.graphqlService.getPerformanceMetrics?.()||[]}clearCache(){this.graphqlService.clearCache?.()}performHealthCheck(){return a(this,null,function*(){try{return(yield this.graphqlService.findMany(this.modelName,{select:{id:!0},take:1}))!==null}catch(e){return console.error("Health check failed:",e),!1}})}importFromExcel(r){return a(this,arguments,function*(e,t={}){try{return this.isLoading.set(!0),this.showErrorMessage("Import t\u1EEB Excel ch\u01B0a \u0111\u01B0\u1EE3c tri\u1EC3n khai trong GraphQL"),{success:!1,message:"Import t\u1EEB Excel ch\u01B0a \u0111\u01B0\u1EE3c tri\u1EC3n khai trong GraphQL",imported:0,failed:0,errors:[]}}catch(s){return console.error("Error importing from Excel:",s),this.showErrorMessage("L\u1ED7i khi import d\u1EEF li\u1EC7u t\u1EEB Excel"),{success:!1,message:s?.message||"Unknown error",imported:0,failed:1,errors:[s?.message||"Unknown error"]}}finally{this.isLoading.set(!1)}})}backupData(e){return a(this,null,function*(){try{this.isLoading.set(!0);let t=yield this.graphqlService.findMany(this.modelName,{include:{user:!0,kho:!0,tonkho:!0}}),r={type:e,timestamp:new Date().toISOString(),data:t,count:t?.length||0};return console.log("Backup created:",r),this.showSuccessMessage(`Backup ${e} th\xE0nh c\xF4ng - ${r.count} b\u1EA3n ghi`),!0}catch(t){return console.error("Error backing up data:",t),this.showErrorMessage("L\u1ED7i khi backup d\u1EEF li\u1EC7u"),!1}finally{this.isLoading.set(!1)}})}optimizePerformance(){return a(this,null,function*(){try{this.isLoading.set(!0),this.graphqlService.clearCache?.();let e=this.graphqlService.getPerformanceMetrics?.()||[],t=this.graphqlService.getCacheHitRate?.()||0;return this.showSuccessMessage("T\u1ED1i \u01B0u h\xF3a hi\u1EC7u su\u1EA5t th\xE0nh c\xF4ng"),{success:!0,cacheCleared:!0,cacheHitRate:t,metrics:e,timestamp:new Date}}catch(e){return console.error("Error optimizing performance:",e),this.showErrorMessage("L\u1ED7i khi t\u1ED1i \u01B0u h\xF3a hi\u1EC7u su\u1EA5t"),{success:!1,error:e?.message||"Unknown error"}}finally{this.isLoading.set(!1)}})}getSystemHealth(){return a(this,null,function*(){try{let e=yield this.performHealthCheck(),t=this.getPerformanceMetrics(),r=this.getCacheHitRate();return{healthy:e,cacheHitRate:r,metrics:t,timestamp:new Date,graphqlConnected:e}}catch(e){return console.error("Error getting system health:",e),{healthy:!1,error:e}}})}generateImportTemplate(e="standard"){return a(this,null,function*(){try{let t={success:!0,templateUrl:`/api/templates/chotkho-import-${e}.xlsx`,format:"xlsx",type:e,columns:e==="advanced"?["id","khoId","sanphamId","userId","ngay","soluong","dongia","thanhtien","ghichu","isActive"]:["id","khoId","sanphamId","userId","ngay","soluong","dongia","thanhtien","ghichu"]};return this.showSuccessMessage("Template \u0111\u01B0\u1EE3c t\u1EA1o th\xE0nh c\xF4ng"),t}catch(t){return console.error("Error generating import template:",t),this.showErrorMessage("L\u1ED7i khi t\u1EA1o template import"),{success:!1}}})}exportData(e="excel",t){return a(this,null,function*(){try{this.isLoading.set(!0);let r={};t&&t.dateFrom&&t.dateTo&&(r.ngay={gte:new Date(t.dateFrom),lte:new Date(t.dateTo)});let s=yield this.graphqlService.findMany(this.modelName,{where:r,include:{user:{select:{id:!0,email:!0,profile:{select:{name:!0}}}},kho:{select:{id:!0,name:!0,makho:!0,diachi:!0}},sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0,giagoc:!0}},tonkho:{select:{id:!0,slton:!0,slchogiao:!0,slchonhap:!0}},phieukho:{select:{id:!0,maphieu:!0,ngay:!0,type:!0}}}});return this.showSuccessMessage(`Xu\u1EA5t d\u1EEF li\u1EC7u ${e} th\xE0nh c\xF4ng`),{success:!0,data:s,format:e,count:s?.length||0,timestamp:new Date}}catch(r){return console.error("Error exporting data:",r),this.showErrorMessage("L\u1ED7i khi xu\u1EA5t d\u1EEF li\u1EC7u"),{success:!1,error:r?.message}}finally{this.isLoading.set(!1)}})}smartCheckChenhLech(e){return a(this,null,function*(){try{this.isLoading.set(!0);let t={};e&&(t.id=e);let s=(yield this.graphqlService.findMany(this.modelName,{where:t,include:{tonkho:{select:{id:!0,slton:!0,slchogiao:!0,slchonhap:!0}},sanpham:{select:{id:!0,title:!0,masp:!0,dvt:!0,giagoc:!0}},kho:{select:{id:!0,name:!0,makho:!0,diachi:!0}}}}))?.map(o=>{let C=o.tonkho?.slton||0,g=o.slthucte||0,d=o.slhethong||0,k=g-d;return l(n({},o),{expectedQty:C,actualQty:g,systemQty:d,difference:k,hasDifference:Math.abs(k)>0})})||[],i=s.filter(o=>o.hasDifference);return this.showSuccessMessage(`Ki\u1EC3m tra th\xF4ng minh ho\xE0n t\u1EA5t - ${i.length} ch\xEAnh l\u1EC7ch`),{success:!0,total:s.length,withDifferences:i.length,differences:i}}catch(t){return console.error("Error in smart check:",t),this.showErrorMessage("L\u1ED7i khi ki\u1EC3m tra ch\xEAnh l\u1EC7ch th\xF4ng minh"),{success:!1,error:t?.message}}finally{this.isLoading.set(!1)}})}restoreFromBackup(e){return a(this,null,function*(){try{return this.isLoading.set(!0),!e||!e.data?(this.showErrorMessage("D\u1EEF li\u1EC7u backup kh\xF4ng h\u1EE3p l\u1EC7"),!1):(this.showSuccessMessage(`Kh\xF4i ph\u1EE5c th\xE0nh c\xF4ng ${e.data.length} b\u1EA3n ghi`),yield this.getAllChotkho(),!0)}catch(t){return console.error("Error restoring from backup:",t),this.showErrorMessage("L\u1ED7i khi kh\xF4i ph\u1EE5c d\u1EEF li\u1EC7u"),!1}finally{this.isLoading.set(!1)}})}static \u0275fac=function(t){return new(t||u)};static \u0275prov=m({token:u,factory:u.\u0275fac,providedIn:"root"})};export{w as a};
