import './polyfills.server.mjs';
import{a as Mt}from"./chunk-EHIOJ53Q.mjs";import{a as Nt}from"./chunk-SOMYOCLA.mjs";import{a as xt}from"./chunk-HVUIG3KF.mjs";import{a as Pt}from"./chunk-IGWB5VBO.mjs";import{a as Bt}from"./chunk-ZTR7BXUL.mjs";import{a as At}from"./chunk-3ELWWSJR.mjs";import{a as Tt}from"./chunk-4NNV6NE3.mjs";import{a as Et,g as Dt,h as N}from"./chunk-BM52I7TD.mjs";import{a as vt}from"./chunk-WJ2ZWVTC.mjs";import{b as bt,c as Lt,d as _t,e as wt,g as It,s as Ct}from"./chunk-PE5EYNGJ.mjs";import{a as yt}from"./chunk-UDJCPRBF.mjs";import{c as gt,h as mt}from"./chunk-26WWJ5GO.mjs";import{a as St}from"./chunk-7BHYQM75.mjs";import{c as rt}from"./chunk-ZA5LSI2B.mjs";import{b as ut}from"./chunk-AL3ZCZTD.mjs";import{a as ft}from"./chunk-73IBRO6I.mjs";import{a as kt}from"./chunk-KPN7Z3NE.mjs";import{a as Yt}from"./chunk-MGIVCIKU.mjs";import{d as ct}from"./chunk-NCVHCAMC.mjs";import{a as st,b as ht}from"./chunk-Q2K4SCD6.mjs";import{n as pt,v as lt,y as dt}from"./chunk-IQUZIOHZ.mjs";import{a as k}from"./chunk-7ZQLLCLM.mjs";import{a as O,b as ot}from"./chunk-KOBSONV6.mjs";import{a as et,e as nt}from"./chunk-6HDYPSHY.mjs";import{y as it}from"./chunk-D22ASRXW.mjs";import{d as H}from"./chunk-2ATDIMG4.mjs";import{n as Z,o as tt,v as at}from"./chunk-6BL7Z2F4.mjs";import{Ac as K,Bc as j,Cc as F,Gb as V,Gc as U,Hc as S,Ic as T,Nb as B,Ra as y,Zb as A,Zc as X,bc as q,hc as g,ia as M,ic as l,kc as Q,lc as J,na as x,nc as R,oa as p,sc as C,tb as L,uc as z,ud as W,xa as w,ya as I}from"./chunk-GWTCN232.mjs";import{a as _,b as v,g as Ot,j as c}from"./chunk-RIAI3ORJ.mjs";var Y=class s{socket;constructor(){this.socket=St(`${k.APIURL}`,{transports:["websocket"],reconnectionAttempts:5,timeout:5e3})}getSocket(){return this.socket}static \u0275fac=function(a){return new(a||s)};static \u0275prov=M({token:s,factory:s.\u0275fac,providedIn:"root"})};var G=class s{constructor(e,a,i,t){this._StorageService=e;this.router=a;this._ErrorLogService=i;this._sharedSocketService=t;this.socket=this._sharedSocketService.getSocket(),this.listenImportdataUpdates()}socket;_snackBar=p(O);ListImportdata=y([]);DetailImportdata=y({});page=y(1);pageCount=y(1);total=y(0);pageSize=y(10);importdataId=y(null);initDB(){return c(this,null,function*(){return yield ft("ImportdataDB",4,{upgrade(e,a){a<1&&e.createObjectStore("importdatas",{keyPath:"id"}),a<3&&(e.objectStoreNames.contains("importdatas")&&e.deleteObjectStore("importdatas"),e.objectStoreNames.contains("pagination")&&e.deleteObjectStore("pagination"),e.createObjectStore("importdatas",{keyPath:"id"})),a<4}})})}saveImportdatas(e,a){return c(this,null,function*(){let t=(yield this.initDB()).transaction("importdatas","readwrite"),o=t.objectStore("importdatas");yield o.clear(),yield o.put({id:"data",importdatas:e,pagination:a}),yield t.done})}getCachedData(){return c(this,null,function*(){let a=yield(yield this.initDB()).get("importdatas","data");return a&&a.importdatas?{importdatas:a.importdatas,pagination:a.pagination||{page:1,pageCount:1,total:a.importdatas.length,pageSize:10}}:{importdatas:[],pagination:{page:1,pageCount:1,total:0,pageSize:10}}})}setImportdataId(e){this.importdataId.set(e)}CreateImportdata(e){return c(this,null,function*(){try{let a={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(e)},i=yield fetch(`${k.APIURL}/importdata`,a);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);let t=yield i.json();this.getAllImportdata(this.pageSize()),this.importdataId.set(t.id)}catch(a){this._ErrorLogService.logError("Failed to CreateImportdata",a),console.error(a)}})}getAllImportdata(){return c(this,arguments,function*(e=this.pageSize(),a=!1){this.pageSize.set(e);let i=yield this.getCachedData(),t=this._StorageService.getItem("importdatas_updatedAt")||"0";if(!a&&i.importdatas.length>0&&Date.now()-new Date(t).getTime()<5*60*1e3)return this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas;try{let o={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}};if(!a){let b=yield fetch(`${k.APIURL}/importdata/lastupdated`,o);if(!b.ok)return this.handleError(b.status),this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas;let{updatedAt:E}=yield b.json();if(E<=t)return this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas}let r=new URLSearchParams({page:this.page().toString(),limit:e.toString()}),u=yield fetch(`${k.APIURL}/importdata?${r}`,o);if(!u.ok)return this.handleError(u.status),this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas;let m=yield u.json();if(yield this.saveImportdatas(m.data,{page:m.page||1,pageCount:m.pageCount||1,total:m.total||m.data.length,pageSize:e}),a)this._StorageService.setItem("importdatas_updatedAt",new Date().toISOString());else{let b=yield fetch(`${k.APIURL}/importdata/lastupdated`,o),{updatedAt:E}=yield b.json();this._StorageService.setItem("importdatas_updatedAt",E)}return this.ListImportdata.set(m.data),this.page.set(m.page||1),this.pageCount.set(m.pageCount||1),this.total.set(m.total||m.data.length),this.pageSize.set(e),m.data}catch(o){return this._ErrorLogService.logError("Failed to getAllImportdata",o),console.error(o),this.ListImportdata.set(i.importdatas),this.page.set(i.pagination.page),this.pageCount.set(i.pagination.pageCount),this.total.set(i.pagination.total),this.pageSize.set(i.pagination.pageSize),i.importdatas}})}getUpdatedCodeIds(){return c(this,null,function*(){try{let e={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},a=yield fetch(`${k.APIURL}/importdata/updateCodeIds`,e);a.ok||this.handleError(a.status);let i=yield a.json();return this.getAllImportdata(this.pageSize()),i.data}catch(e){this._ErrorLogService.logError("Failed to getUpdatedCodeIds",e),console.error(e)}})}listenImportdataUpdates(){this.socket.off("importdata-updated"),this.socket.on("importdata-updated",()=>c(this,null,function*(){console.log("\u{1F504} D\u1EEF li\u1EC7u s\u1EA3n ph\u1EA9m thay \u0111\u1ED5i, c\u1EADp nh\u1EADt l\u1EA1i cache..."),this._StorageService.removeItem("importdatas_updatedAt"),yield this.getAllImportdata()}))}getImportdataBy(i){return c(this,arguments,function*(e,a=this.pageSize()){this.pageSize.set(a);try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(v(_({},e),{page:this.page(),limit:a}))},o=yield fetch(`${k.APIURL}/importdata/findby`,t);o.ok||this.handleError(o.status);let r=yield o.json();e.isOne===!0?this.DetailImportdata.set(r):(yield this.saveImportdatas(r.data,{page:r.page||1,pageCount:r.pageCount||1,total:r.total||r.data.length,pageSize:a}),this._StorageService.setItem("importdatas_updatedAt",new Date().toISOString()),this.ListImportdata.set(r.data),this.page.set(r.page||1),this.pageCount.set(r.pageCount||1),this.total.set(r.total||r.data.length),this.pageSize.set(a))}catch(t){this._ErrorLogService.logError("Failed to getImportdataBy",t),console.error(t);let o=yield this.getCachedData();e.isOne||(this.ListImportdata.set(o.importdatas),this.page.set(o.pagination.page),this.pageCount.set(o.pagination.pageCount),this.total.set(o.pagination.total),this.pageSize.set(o.pagination.pageSize))}})}updateImportdata(e){return c(this,null,function*(){try{let a={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(e)},i=yield fetch(`${k.APIURL}/importdata/${e.id}`,a);i.ok||this.handleError(i.status);let t=yield i.json();this.getAllImportdata(this.pageSize()),this.getImportdataBy({id:t.id,isOne:!0},this.pageSize())}catch(a){this._ErrorLogService.logError("Failed to updateImportdata",a),console.error(a)}})}DeleteImportdata(e){return c(this,null,function*(){try{let a={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},i=yield fetch(`${k.APIURL}/importdata/${e.id}`,a);i.ok||this.handleError(i.status),this.getAllImportdata(this.pageSize())}catch(a){this._ErrorLogService.logError("Failed to DeleteImportdata",a),console.error(a)}})}handleError(e){let a="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(e){case 400:a="Th\xF4ng tin \u0111\xE3 t\u1ED3n t\u1EA1i";break;case 401:case 404:a="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:a="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:a="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}this._snackBar.open(a,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}static \u0275fac=function(a){return new(a||s)(x(ot),x(H),x(yt),x(Y))};static \u0275prov=M({token:s,factory:s.\u0275fac,providedIn:"root"})};var d=Ot(Yt());var $t=["drawer"];function Rt(s,e){if(s&1&&(g(0,"div",17)(1,"span",18),S(2),l(),g(3,"span"),S(4),l(),g(5,"span",19),S(6),l()()),s&2){let a=e.$implicit;L(2),T(a.type),L(2),T(a.title),L(2),T(a.description)}}function Ut(s,e){if(s&1&&(Q(0),B(1,Rt,7,3,"div",16),J()),s&2){let a=z();L(),A("ngForOf",a.ListImportdata())}}function Vt(s,e){s&1&&(g(0,"div",20)(1,"span",21),S(2,"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),l()())}function qt(s,e){s&1&&(g(0,"mat-icon"),S(1,"check"),l())}function Qt(s,e){if(s&1){let a=R();g(0,"span",22),C("click",function(){let t=w(a).$implicit,o=z();return I(o.toggleItem(t))}),B(1,qt,2,0,"mat-icon",23),g(2,"span"),S(3),l()()}if(s&2){let a=e.$implicit,i=z();q("",i.CheckItem(a)?"bg-blue-100":""," cursor-pointer flex flex-row space-x-2 items-center p-4 rounded-lg border"),L(),A("ngIf",i.CheckItem(a)),L(2),T(a.title)}}var Kt=class s{displayedColumns=[];ColumnName={stt:"#",codeId:"Code",name:"Ti\xEAu \u0110\u1EC1",group:"Nh\xF3m",description:"M\xF4 T\u1EA3",status:"Tr\u1EA1ng Th\xE1i",order:"Th\u1EE9 T\u1EF1",createdAt:"Ng\xE0y T\u1EA1o",updatedAt:"Ng\xE0y C\u1EADp Nh\u1EADt"};FilterColumns=JSON.parse(localStorage.getItem("ImportdataColFilter")||"[]");Columns=[];paginator;sort;drawer;_BanggiaService=p(Pt);_SanphamService=p(Tt);_KhachhangService=p(Bt);_NhacungcapService=p(At);_DonhangService=p(kt);_DathangService=p(xt);_PhieukhoService=p(Nt);_KhoService=p(Mt);_ImportdataService=p(G);_breakpointObserver=p(it);_GoogleSheetService=p(vt);_router=p(H);_dialog=p(gt);_snackBar=p(O);ListImportType=y([{id:1,title:"S\u1EA3n Ph\u1EA9m",value:"sanpham",status:!0},{id:2,title:"Kh\xE1ch H\xE0ng",value:"khachhang",status:!0},{id:3,title:"Nh\xE0 Cung C\u1EA5p",value:"nhacungcap",status:!0},{id:4,title:"B\u1EA3ng Gi\xE1",value:"banggia",status:!0},{id:5,title:"\u0110\u01A1n H\xE0ng",value:"donhang",status:!0},{id:6,title:"\u0110\u1EB7t H\xE0ng",value:"dathang",status:!0},{id:7,title:"B\u1EA3ng Gi\xE1 Kh\xE1ch H\xE0ng",value:"banggiakhachhang",status:!0},{id:8,title:"B\u1EA3ng Gi\xE1 S\u1EA3n Ph\u1EA9m",value:"banggiasanpham",status:!0},{id:9,title:"Nh\xE0 Cung C\u1EA5p S\u1EA3n Ph\u1EA9m",value:"nhacungcapsanpham",status:!0},{id:10,title:"Xu\u1EA5t Nh\u1EADp T\u1ED3n",value:"xuatnhapton",status:!0}]);ListEdit=y([]);ListImportdata=this._ImportdataService.ListImportdata;TitleExport="export";rawListSP=[];rawListKH=[];rawListNCC=[];rawListBG=[];rawListDH=[];rawListDathang=[];rawListTonkho=[];constructor(){W(()=>c(this,null,function*(){yield this._ImportdataService.getAllImportdata(100,!0),yield this._SanphamService.getAllSanpham(),this.rawListSP=this._SanphamService.ListSanpham(),yield this._KhachhangService.getAllKhachhang(),this.rawListKH=this._KhachhangService.ListKhachhang(),yield this._NhacungcapService.getAllNhacungcap(),this.rawListNCC=this._NhacungcapService.ListNhacungcap(),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),yield this._DonhangService.getAllDonhang(),this.rawListDH=this._DonhangService.ListDonhang(),yield this._DathangService.getAllDathang(),this.rawListDathang=this._DathangService.ListDathang(),yield this._KhoService.getTonKho("1","1000").then(e=>{this.rawListTonkho=e.data})}))}ngOnInit(){return c(this,null,function*(){yield this._ImportdataService.getAllImportdata(100,!0),console.log(this.ListImportdata()),yield this._SanphamService.getAllSanpham(),this.rawListSP=this._SanphamService.ListSanpham(),yield this._KhachhangService.getAllKhachhang(),this.rawListKH=this._KhachhangService.ListKhachhang(),yield this._NhacungcapService.getAllNhacungcap(),this.rawListNCC=this._NhacungcapService.ListNhacungcap(),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),yield this._DonhangService.getAllDonhang(),this.rawListDH=this._DonhangService.ListDonhang(),yield this._DathangService.getAllDathang(),this.rawListDathang=this._DathangService.ListDathang(),yield this._KhoService.getTonKho("1","1000").then(e=>{this.rawListTonkho=e.data})})}applyFilter(e){}toggleAll(){this.ListEdit().length===this.ListImportType().length?(this.ListEdit.set([]),this.TitleExport="export"):(this.ListEdit.set(this.ListImportType()),this.TitleExport="export_all")}toggleItem(e){this.ListEdit().findIndex(i=>i.id===e.id)===-1?(this.TitleExport+="_"+e.value,this.ListEdit.update(i=>[...i,e])):(this.TitleExport=this.TitleExport.replace("_"+e.value,""),this.ListEdit.update(i=>i.filter(t=>t.id!==e.id)))}CheckItem(e){return this.ListEdit().findIndex(i=>i.id===e.id)!==-1}ExportExcel(e){return c(this,null,function*(){let a=Array.isArray(this.rawListSP)&&this.rawListSP.length?this.rawListSP.map(n=>({masp:n.masp,subtitle:n.subtitle,title:n.title,title2:n.title2,giaban:n.giaban,giagoc:n.giagoc,dvt:n.dvt,haohut:n.haohut,ghichu:n.ghichu})):[{masp:"",subtitle:"",title:"",title2:"",giaban:"",giagoc:"",dvt:"",haohut:"",ghichu:""}],i=Array.isArray(this.rawListKH)&&this.rawListKH.length?this.rawListKH.map(n=>({name:n.name?.trim()||"",makh:n.makh?.trim()||"",namenn:n.namenn?.trim()||"",diachi:n.diachi?.trim()||"",quan:n.quan?.trim()||"",email:n.email?.trim()||"",sdt:n.sdt?.toString().trim()||"",mst:n.mst?.toString().trim()||"",gionhanhang:n.gionhanhang?.toString().trim()||"",loaikh:n.loaikh?.toString().trim()||"khachsi",hiengia:n.hiengia||!0,ghichu:n.ghichu?.toString().trim()||""})):[{name:"",makh:"",namenn:"",diachi:"",quan:"",email:"",sdt:"",mst:"",gionhanhang:"",loaikh:"khachsi",hiengia:!0,ghichu:""}],t=Array.isArray(this.rawListNCC)&&this.rawListNCC.length>0?this.rawListNCC.map(n=>({name:n.name?.trim()||"",mancc:n.mancc?.trim()||"",diachi:n.diachi?.trim()||"",email:n.email?.trim()||"",sdt:n.sdt?.toString().trim()||"",ghichu:n.ghichu?.toString().trim()||""})):[{name:"",mancc:"",diachi:"",email:"",sdt:"",ghichu:""}],o=Array.isArray(this.rawListBG)&&this.rawListBG.length>0?this.rawListBG.map(n=>({title:n.title?.trim()||"",mabanggia:n.mabanggia?.trim()||"",type:n.type?.trim()||"",batdau:n.batdau?.trim()||"",ketthuc:n.ketthuc?.trim()||"",ghichu:n.ghichu?.trim()||"",status:n.status?.trim()||""})):[{title:"",mabanggia:"",type:"",batdau:"",ketthuc:"",ghichu:"",status:""}],r=Array.isArray(this.rawListDH)&&this.rawListDH.length>0?this.rawListDH.flatMap(n=>Array.isArray(n.sanpham)?n.sanpham.map(h=>({ngaygiao:(0,d.default)(n.ngaygiao).format("DD/MM/YYYY"),makh:n.khachhang?.makh,name:n.khachhang?.name,mabanggia:n.khachhang?.banggia?.[0]?.mabanggia,masp:h.masp,tensp:h.title,sldat:h.sldat,slgiao:h.slgiao,slnhan:h.slnhan,ghichu:h.ghichu})):[]):[{ngaygiao:(0,d.default)().format("DD/MM/YYYY"),makh:"",mabanggia:"",masp:"",tensp:"",sldat:0,slgiao:0,slnhan:0,ghichu:""}],u=Array.isArray(this.rawListDathang)&&this.rawListDathang.length>0?this.rawListDathang.flatMap(n=>Array.isArray(n.sanpham)?n.sanpham.map(h=>({ngaynhan:(0,d.default)(n.ngaynhan).format("DD/MM/YYYY"),mancc:n.nhacungcap?.mancc,name:n.nhacungcap?.name,mabanggia:n.banggia?.[0]?.mabanggia,masp:h.masp,tensp:h.title,sldat:h.sldat,slgiao:h.slgiao,slnhan:h.slnhan,ghichu:h.ghichu})):[]):[{ngaynhan:(0,d.default)().format("DD/MM/YYYY"),mancc:"",name:"",mabanggia:"",masp:"",tensp:"",sldat:0,slgiao:0,slnhan:0,ghichu:""}],m=this.convertBGSPToExport(this.rawListBG,this.rawListSP),b=this.rawListKH.map(n=>{let h={makh:n.makh||"",name:n.name||""},D=1;for(let P of this.rawListBG)n.banggia?.some($=>$.mabanggia===P.mabanggia)&&(h[D]=P.mabanggia,D++);return h}),E=this.rawListSP.reduce((n,h)=>(h&&h.masp&&(n[h.masp]=""),n),{}),jt=this.rawListNCC.map(n=>{let h={mancc:n.mancc||"",name:n.name||""},D=1;for(let P of Object.keys(E))n.Sanpham?.some($=>$.masp===P)&&(h[D]=P,D++);return h}),Ft=this.rawListTonkho.map(n=>({masp:n.masp,title:n.title,dvt:n.dvt,slton:n.slton})),f={};if(this.ListEdit().some(n=>n.value==="sanpham")&&(f.sanpham={data:a}),this.ListEdit().some(n=>n.value==="khachhang")&&(f.khachhang={data:i}),this.ListEdit().some(n=>n.value==="nhacungcap")&&(f.nhacungcap={data:t}),this.ListEdit().some(n=>n.value==="banggia")&&(f.banggia={data:o}),this.ListEdit().some(n=>n.value==="donhang")&&(f.donhang={data:r}),this.ListEdit().some(n=>n.value==="dathang")&&(f.dathang={data:u}),this.ListEdit().some(n=>n.value==="banggiasanpham")&&(f.banggiasanpham={data:m}),this.ListEdit().some(n=>n.value==="banggiakhachhang")&&(f.banggiakhachhang={data:b}),this.ListEdit().some(n=>n.value==="nhacungcapsanpham")&&(f.nhacungcapsanpham={data:jt}),this.ListEdit().some(n=>n.value==="xuatnhapton")&&(f.xuatnhapton={data:Ft}),Object.keys(f).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});return}Et(f,e)})}convertBGSPToExport(e,a){let i=new Set(e.map(t=>t.mabanggia));return a.map(t=>_({masp:t.masp,title:t.title,giaban:t.giaban.toString()},Array.from(i).reduce((o,r)=>(o[r]=t.giaban.toString(),o),{})))}convertBGSPToImport(e){return!e||e.length===0?[]:Object.keys(e[0]).filter(t=>!["masp","title","giagoc"].includes(t)).map(t=>({mabanggia:t,title:`B\u1EA3ng gi\xE1 ${t.replace("BG","")}`,sanpham:e.map(o=>({masp:o.masp,title:o.title,giagoc:o.giagoc,giaban:o[t]||0}))}))}convertBHKHToImport(e){if(!e||e.length===0)return[];let a=Object.keys(e[0]).filter(i=>!["makh","name"].includes(i));return e.forEach(i=>{i.banggia=[];for(let t of a)i[t]!==void 0&&i[t]!==null&&i[t]!==""&&i.banggia.push(i[t]),delete i[t]}),e}convertNCCSPToImport(e){if(!e||e.length===0)return[];let a=Object.keys(e[0]).filter(i=>!["mancc","name"].includes(i));return e.forEach(i=>{i.Sanpham=[];for(let t of a)i[t]!==void 0&&i[t]!==null&&i[t]!==""&&i.Sanpham.push(i[t]),delete i[t]}),e}ImportExcel(e){return c(this,null,function*(){let a=yield Dt(e);this.DoImportData(a)})}DoImportData(e){return c(this,null,function*(){if(Object.keys(this.ListEdit()).length===0){this._snackBar.open("Ch\u01B0a Ch\u1ECDn Lo\u1EA1i D\u1EEF Li\u1EC7u","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});return}if(Object.keys(e).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 nh\u1EADp","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});return}if(e.sanpham&&e.sanpham.length>0&&this.ListEdit().some(a=>a.value==="sanpham")){let a=(e.sanpham||[]).map(t=>({masp:t.masp,subtitle:t.subtitle.toString(),title:t.title,title2:t.title2,giaban:Number(t.giaban)||Number(t.giagoc)||0,giagoc:Number(t.giagoc)||0,dvt:t.dvt,haohut:Number(t.haohut)||0,ghichu:t.ghichu})).filter(t=>t.masp!==void 0&&t.masp!==null&&t.masp!==""),i=this._snackBar.open("\u0110ang import S\u1EA3n ph\u1EA9m...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._SanphamService.ImportSanpham(a),i.dismiss(),this._snackBar.open("Import S\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.khachhang&&e.khachhang.length>0&&this.ListEdit().some(a=>a.value==="khachhang")){let a=(e.khachhang||[]).map(t=>({name:t.name,makh:t.makh,namenn:t.namenn,diachi:t.diachi,quan:t.quan,email:t.email,sdt:t.sdt.toString(),mst:t.mst.toString(),gionhanhang:t.gionhanhang.toString(),loaikh:t.loaikh,ghichu:t.ghichu})).filter(t=>t.makh!==void 0&&t.makh!==null&&t.makh!==""),i=this._snackBar.open("\u0110ang import Kh\xE1ch h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._KhachhangService.ImportKhachhang(a),i.dismiss(),this._snackBar.open("Import Kh\xE1ch h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.nhacungcap&&e.nhacungcap.length>0&&this.ListEdit().some(a=>a.value==="nhacungcap")){let a=(e.nhacungcap||[]).map(t=>({name:t.name,mancc:t.mancc,diachi:t.diachi,email:t.email,sdt:t.sdt.toString(),ghichu:t.ghichu})).filter(t=>t.mancc!==void 0&&t.mancc!==null&&t.mancc!==""),i=this._snackBar.open("\u0110ang import Nh\xE0 cung c\u1EA5p...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._NhacungcapService.ImportNhacungcap(a),i.dismiss(),this._snackBar.open("Import Nh\xE0 cung c\u1EA5p th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.banggia&&e.banggia.length>0&&this.ListEdit().some(a=>a.value==="banggia")){let a=(e.banggia||[]).map(t=>({title:"B\u1EA3ng Gi\xE1 "+t.mabanggia,mabanggia:t.mabanggia,type:t.type,batdau:(0,d.default)(N(t.batdau)).toDate(),ketthuc:(0,d.default)(N(t.ketthuc)).toDate(),ghichu:t.ghichu,status:t.status})).filter(t=>t.mabanggia!==void 0&&t.mabanggia!==null&&t.mabanggia!==""),i=this._snackBar.open("\u0110ang import B\u1EA3ng gi\xE1...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._BanggiaService.ImportBanggia(a),i.dismiss(),this._snackBar.open("Import B\u1EA3ng gi\xE1 th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.donhang&&e.donhang.length>0&&this.ListEdit().some(a=>a.value==="donhang")){let a=(e.donhang||[]).map(t=>({ngay:t.ngay,makh:t.makh,mabangia:t.mabangia,masp:t.masp,sldat:Number(t.sldat),slgiao:Number(t.slgiao),slnhan:Number(t.slnhan),ghichu:t.ghichu})).filter(t=>t.makh!==void 0&&t.makh!==null&&t.makh!==""&&t.masp!==void 0&&t.masp!==null&&t.masp!==""),i=this._snackBar.open("\u0110ang import \u0110\u01A1n h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DonhangService.ImportDonhang(a),i.dismiss(),this._snackBar.open("Import \u0110\u01A1n h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.banggiasanpham&&e.banggiasanpham.length>0&&this.ListEdit().some(a=>a.value==="banggiasanpham")){let a=this.convertBGSPToImport(e.banggiasanpham);console.log(a);let i=a.find(o=>o.mabanggia==="giaban");if(!i)return;let t=a.map(o=>{if(o.mabanggia==="giaban")return o;let r=o.sanpham.map(u=>{if(u.giaban==="0"){let m=i.sanpham.find(b=>b.masp===u.masp);return v(_({},u),{giaban:m?m.giaban:u.giaban})}return u});return v(_({},o),{sanpham:r})});yield this._BanggiaService.importSPBG(t)}if(e.banggiakhachhang&&e.banggiakhachhang.length>0&&this.ListEdit().some(a=>a.value==="banggiakhachhang")){let a=this.convertBHKHToImport(e.banggiakhachhang).filter(i=>i.banggia.length>0);yield this._KhachhangService.ImportKhachhang(a),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.nhacungcapsanpham&&e.nhacungcapsanpham.length>0&&this.ListEdit().some(a=>a.value==="nhacungcapsanpham")){let a=this.convertNCCSPToImport(e.nhacungcapsanpham);console.log(a);let i=a.filter(o=>o?.Sanpham?.length>0).map(o=>v(_({},o),{Sanpham:o?.Sanpham?.map(r=>this.rawListSP.find(u=>u?.masp===r))})),t=this._snackBar.open("\u0110ang import Nh\xE0 cung c\u1EA5p s\u1EA3n ph\u1EA9m...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._NhacungcapService.ImportNhacungcap(i),t.dismiss(),this._snackBar.open("Import Nh\xE0 cung c\u1EA5p s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.xuatnhapton&&e.xuatnhapton.length>0&&this.ListEdit().some(a=>a.value==="xuatnhapton")){let a=[],i=[];e.xuatnhapton.forEach(t=>{let o=this.rawListTonkho.find(r=>r.masp===t.masp);o&&(t.slton>o.slton?a.push({sanphamId:this.rawListSP.find(r=>r.masp===t.masp).id,soluong:t.slton-o.slton}):t.slton<o.slton&&i.push({sanphamId:this.rawListSP.find(r=>r.masp===t.masp).id,soluong:o.slton-t.slton}))}),a.length>0&&this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${(0,d.default)().format("DD/MM/YYYY ")}`,type:"nhap",sanpham:a,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${(0,d.default)().format("HH:mm:ss DD/MM/YYYY ")}`,ngay:(0,d.default)()}),i.length>0&&this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${(0,d.default)().format("DD/MM/YYYY ")}`,type:"xuat",sanpham:i,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${(0,d.default)().format("HH:mm:ss DD/MM/YYYY ")}`,ngay:(0,d.default)()}),a.length===0&&i.length===0&&this._snackBar.open("Kho kh\xF4ng thay \u0111\u1ED5i","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.dathang&&this.ListEdit().some(a=>a.value==="dathang")){let a=(e.dathang||[]).map(t=>({ngaynhan:(0,d.default)(N(t.ngaynhan)).toDate(),mancc:t.mancc,mabanggia:t.mabanggia,masp:t.masp,sldat:Number(t.sldat),slgiao:Number(t.slgiao),slnhan:Number(t.slnhan),ghichu:t.ghichu}));console.log(a);let i=this._snackBar.open("\u0110ang import \u0110\u1EB7t h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DathangService.ImportDathang(a),i.dismiss(),this._snackBar.open("Import \u0110\u1EB7t h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(e.donhang&&this.ListEdit().some(a=>a.value==="donhang")){let a=(e.donhang||[]).map(t=>({ngaygiao:(0,d.default)(N(t.ngaygiao)).toDate(),makh:t.makh,mabanggia:t.mabanggia,masp:t.masp,sldat:Number(t.sldat),slgiao:Number(t.slgiao),slnhan:Number(t.slnhan),ghichu:t.ghichu})),i=this._snackBar.open("\u0110ang import \u0110\u01A1n h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DonhangService.ImportDonhang(a),i.dismiss(),this._snackBar.open("Import \u0110\u01A1n h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}})}trackByFn(e,a){return a.id}static \u0275fac=function(a){return new(a||s)};static \u0275cmp=V({type:s,selectors:[["app-listimportdata"]],viewQuery:function(a,i){if(a&1&&(K(Lt,5),K(wt,5),K($t,7)),a&2){let t;j(t=F())&&(i.paginator=t.first),j(t=F())&&(i.sort=t.first),j(t=F())&&(i.drawer=t.first)}},decls:26,vars:4,consts:[["noData",""],["uploadfile",""],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-4"],[1,"w-full","flex","flex-col","space-y-2","p-8"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[4,"ngIf","ngIfElse"],[1,"flex","flex-col","space-y-2","p-8"],[1,"flex","flex-row","space-x-2","items-center"],["mat-flat-button","","color","primary",3,"click"],[1,"ml-1"],["type","file",1,"hidden",3,"change"],[1,"grid","grid-cols-3","gap-4"],[3,"class","click",4,"ngFor","ngForOf","ngForTrackBy"],["class","w-full flex flex-row space-x-2 items-center border p-4 rounded-lg",4,"ngFor","ngForOf"],[1,"w-full","flex","flex-row","space-x-2","items-center","border","p-4","rounded-lg"],[1,"rounded-lg","p-2","bg-blue-100"],[1,"text-sm","text-gray-600"],[1,"w-full","flex","flex-row","items-center","justify-center","border","p-4","rounded-lg","bg-gray-100"],[1,"text-gray-600"],[3,"click"],[4,"ngIf"]],template:function(a,i){if(a&1){let t=R();g(0,"div",2)(1,"div",3)(2,"div",4)(3,"input",5),C("keyup",function(r){return w(t),I(i.applyFilter(r))}),l(),g(4,"div",6)(5,"span",7),S(6,"search"),l()()(),B(7,Ut,2,1,"ng-container",8)(8,Vt,3,0,"ng-template",null,0,X),l(),g(10,"div",9)(11,"div",10)(12,"button",11),C("click",function(){return w(t),I(i.ExportExcel(i.TitleExport))}),S(13," T\u1EA3i Xu\u1ED1ng "),g(14,"mat-icon",12),S(15,"download"),l()(),g(16,"button",11),C("click",function(){w(t);let r=U(23);return I(r.click())}),S(17," T\u1EA3i L\xEAn "),g(18,"mat-icon",12),S(19,"upload"),l()(),g(20,"button",11),C("click",function(){return w(t),I(i.toggleAll())}),S(21," Ch\u1ECDn T\u1EA5t C\u1EA3 "),l(),g(22,"input",13,1),C("change",function(r){return w(t),I(i.ImportExcel(r))}),l()(),g(24,"div",14),B(25,Qt,4,5,"span",15),l()()()}if(a&2){let t=U(9);L(7),A("ngIf",i.ListImportdata().length>0)("ngIfElse",t),L(18),A("ngForOf",i.ListImportType())("ngForTrackBy",i.trackByFn)}},dependencies:[lt,dt,Ct,It,_t,ct,rt,ht,st,nt,et,ut,at,Z,tt,pt,bt,mt],encapsulation:2,changeDetection:0})};export{G as a,Kt as b};
