{
  "version": 3,
  "sources": ["src/app/admin/banggia/banggia.service.ts"],
  "sourcesContent": ["import {  Injectable, signal } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { environment } from '../../../environments/environment.development';\r\nimport { StorageService } from '../../shared/utils/storage.service';\r\nimport { io } from 'socket.io-client';\r\nimport { openDB } from 'idb';\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class BanggiaService {\r\n  constructor(\r\n    private _StorageService: StorageService,\r\n    private router: Router,\r\n  ) { }\r\n  ListBanggia = signal<any[]>([]);\r\n  DetailBanggia = signal<any>({});\r\n  banggiaId = signal<string | null>(null);\r\n  setBanggiaId(id: string | null) {\r\n    this.banggiaId.set(id);\r\n  }\r\n\r\n  async importBGKH(dulieu: any) {\r\n    try {\r\n      const options = {\r\n          method:'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(dulieu),\r\n        };\r\n        const response = await fetch(`${environment.APIURL}/banggia/importbgkh`, options);\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`);\r\n        }\r\n        const data = await response.json();\r\n        if (!response.ok) {\r\n          this.handleError(response.status);\r\n        }\r\n        this.getAllBanggia()\r\n    } catch (error) {\r\n        return console.error(error);\r\n    }\r\n  }\r\n\r\n  async importSPBG(dulieu: any) {\r\n    try {\r\n      // Chia dữ liệu thành các batch 10 items\r\n      const batchSize = 10;\r\n      const batches = [];\r\n      \r\n      for (let i = 0; i < dulieu.length; i += batchSize) {\r\n        batches.push(dulieu.slice(i, i + batchSize));\r\n      }\r\n\r\n      // Gửi từng batch\r\n      for (const batch of batches) {\r\n        const options = {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(batch),\r\n        };\r\n        \r\n        const response = await fetch(`${environment.APIURL}/banggia/importspbg`, options);\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`);\r\n        }\r\n        \r\n        const data = await response.json();\r\n        if (!response.ok) {\r\n          this.handleError(response.status);\r\n        }\r\n      }\r\n      \r\n      this.getAllBanggia();\r\n    } catch (error) {\r\n      return console.error(error);\r\n    }\r\n  }\r\n\r\n  async ImportBanggia(dulieu: any) {\r\n    console.log('bg', dulieu);\r\n    \r\n    try {\r\n      const options = {\r\n          method:'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(dulieu),\r\n        };\r\n        const response = await fetch(`${environment.APIURL}/banggia/import`, options);\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`);\r\n        }\r\n        const data = await response.json();\r\n        if (!response.ok) {\r\n          this.handleError(response.status);\r\n        }\r\n        this.getAllBanggia()\r\n    } catch (error) {\r\n        return console.error(error);\r\n    }\r\n  }\r\n\r\n\r\n  async CreateBanggia(dulieu: any) {\r\n    try {\r\n      const options = {\r\n          method:'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(dulieu),\r\n        };\r\n        const response = await fetch(`${environment.APIURL}/banggia`, options);\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`);\r\n        }\r\n        const data = await response.json();\r\n        if (!response.ok) {\r\n          this.handleError(response.status);\r\n        }\r\n        this.getAllBanggia()\r\n        this.banggiaId.set(data.id)\r\n    } catch (error) {\r\n        return console.error(error);\r\n    }\r\n  }\r\n\r\n\r\n  async getAllBanggia() {\r\n    try {\r\n      // ✅ Gọi API chỉ để lấy `updatedAt` mới nhất\r\n      const options = {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${this._StorageService.getItem('token')}`\r\n        },\r\n      };\r\n\r\n      const response = await fetch(`${environment.APIURL}/banggia`, options);\r\n      if (!response.ok) {\r\n        this.handleError(response.status);\r\n\r\n      }\r\n      const data = await response.json();\r\n      this.ListBanggia.set(data);\r\n      return data;\r\n    } catch (error) {\r\n      console.error(error);\r\n\r\n    }\r\n  }\r\n  async getAllBGSP() {\r\n    try {\r\n        const options = {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${this._StorageService.getItem('token')}`\r\n        },\r\n      };\r\n      const response = await fetch(`${environment.APIURL}/banggia/getbgsp`, options);\r\n      if (!response.ok) {\r\n        this.handleError(response.status);\r\n      }\r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n  async getAllBGKH() {\r\n    try {\r\n        const options = {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${this._StorageService.getItem('token')}`\r\n        },\r\n      };\r\n      const response = await fetch(`${environment.APIURL}/banggia/getbgkh`, options);\r\n      if (!response.ok) {\r\n        this.handleError(response.status);\r\n      }\r\n      const data = await response.json();\r\n      return data;\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n\r\n  private handleError(status: number) {\r\n    let message = 'Lỗi không xác định';\r\n    switch (status) {\r\n      case 401:\r\n        message = 'Vui lòng đăng nhập lại';\r\n        break;\r\n      case 403:\r\n        message = 'Bạn không có quyền truy cập';\r\n        break;\r\n      case 500:\r\n        message = 'Lỗi máy chủ, vui lòng thử lại sau';\r\n        break;\r\n    }\r\n    const result = JSON.stringify({ code: status, title: message });\r\n    this.router.navigate(['/errorserver'], { queryParams: { data: result } });\r\n  }\r\n\r\n  async getBanggiaByid(id: any) {\r\n    try {\r\n      const options = {\r\n        method: 'GET',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n      };\r\n      const response = await fetch(`${environment.APIURL}/banggia/findid/${id}`, options);      \r\n      if (!response.ok) {\r\n        this.handleError(response.status);\r\n      }\r\n      const data = await response.json();      \r\n      this.DetailBanggia.set(data)\r\n    } catch (error) {\r\n      return console.error(error);\r\n    }\r\n  }\r\n  async updateBanggia(dulieu: any) {\r\n    try {\r\n      const options = {\r\n          method:'PATCH',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(dulieu),\r\n        };\r\n        const response = await fetch(`${environment.APIURL}/banggia/${dulieu.id}`, options);\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`);\r\n        }\r\n        const data = await response.json();\r\n        if (!response.ok) {\r\n          this.handleError(response.status);\r\n        }\r\n        this.getAllBanggia()\r\n        this.getBanggiaByid(dulieu.id)\r\n    } catch (error) {\r\n        return console.error(error);\r\n    }\r\n  }\r\n  async DeleteBanggia(item:any) {    \r\n    try {\r\n        const options = {\r\n            method:'DELETE',\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n            },\r\n          };\r\n          const response = await fetch(`${environment.APIURL}/banggia/${item.id}`, options);\r\n          if (!response.ok) {\r\n            this.handleError(response.status);\r\n          }\r\n          this.getAllBanggia()\r\n      } catch (error) {\r\n          return console.error(error);\r\n      }\r\n  }\r\n  async addKHtoBG(dulieu: any) {\r\n    try {\r\n      const options = {\r\n          method:'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(dulieu),\r\n        };\r\n        const response = await fetch(`${environment.APIURL}/banggia/addKHtoBG`, options);\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`);\r\n        }\r\n        const data = await response.json();\r\n        if (!response.ok) {\r\n\r\n        }\r\n        this.getBanggiaByid(dulieu.banggiaId)\r\n    } catch (error) {\r\n        return console.error(error);\r\n    }\r\n  }\r\n  async removeKHfromBG(dulieu: any) {\r\n    try {\r\n      const options = {\r\n          method:'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(dulieu),\r\n        };\r\n        const response = await fetch(`${environment.APIURL}/banggia/removeKHfromBG`, options);\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`);\r\n        }\r\n        const data = await response.json();\r\n        if (!response.ok) {\r\n\r\n        }\r\n        this.getBanggiaByid(dulieu.banggiaId)\r\n    } catch (error) {\r\n        return console.error(error);\r\n    }\r\n  }\r\n}"],
  "mappings": "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",
  "names": []
}
