import './polyfills.server.mjs';
import{a as we}from"./chunk-I7JRES27.mjs";import"./chunk-7BHYQM75.mjs";import{f as Te,g as E}from"./chunk-GXNN5H4H.mjs";import"./chunk-73IBRO6I.mjs";import{c as Ce,f as be}from"./chunk-OSR76MA5.mjs";import{a as ne,b as ae,c as ie,d as re,e as J,f as oe,g as se,h as le,i as ce,j as ue,l as me,m as he,o as pe,p as de,r as ge,s as fe,u as _e,v as ye,w as xe,x as at}from"./chunk-UR7YYPV6.mjs";import{c as Gt,d as Ht,f as Kt,h as Qt}from"./chunk-YJQYPN6N.mjs";import{a as At,b as Ot,c as Lt}from"./chunk-MAUBI35T.mjs";import{b as te}from"./chunk-GH557QLA.mjs";import{e as ee}from"./chunk-4CVVRMK6.mjs";import{a as Ee}from"./chunk-MGIVCIKU.mjs";import{a as $t,b as Rt,c as Yt,d as Ut}from"./chunk-L4EOLOK4.mjs";import{a as It,b as Nt}from"./chunk-42IEFVVA.mjs";import{b as Bt,g as Vt,j as zt,n as qt,r as Jt,v as jt,w as Xt,y as Wt,z as Zt}from"./chunk-QF33QXPO.mjs";import"./chunk-6NNASI4W.mjs";import"./chunk-Y5GM6BPP.mjs";import{a as kt}from"./chunk-PWQWQN5I.mjs";import"./chunk-7AAMVCPG.mjs";import"./chunk-JJXRQIWZ.mjs";import{a as Et,c as Dt,e as Pt}from"./chunk-EEWCQRMA.mjs";import{y as Ft,z as Mt}from"./chunk-MQRKXTYO.mjs";import"./chunk-7T6LZHUD.mjs";import{b as St,d as vt}from"./chunk-GQIXZEG7.mjs";import"./chunk-ZMBT5DEL.mjs";import{n as Ct,o as bt,v as wt,w as Tt}from"./chunk-MOVNJYWB.mjs";import{$b as v,Aa as b,Cc as nt,Ec as H,Fc as K,Gc as Q,Ib as st,Kc as N,Lc as m,Mc as F,Nc as S,Pb as I,Pc as ht,Qc as pt,Rc as dt,Sc as gt,Ta as V,Uc as ft,_b as lt,_c as P,ad as k,bc as z,cd as _t,gc as q,ic as ct,jc as tt,ka as B,kc as et,lc as s,mc as u,nc as G,oc as ut,pa as ot,pc as mt,qa as L,rc as $,v as M,vb as p,wc as T,xd as yt,yc as c,za as C,zd as xt}from"./chunk-UWZZ2S4W.mjs";import"./chunk-XAZRL6IZ.mjs";import{a as _,b as D,d as rt,g as Me,h as Z,j as g}from"./chunk-RIAI3ORJ.mjs";var De=E`
  query FindMany(
    $modelName: String!
    $where: JSON
    $orderBy: JSON
    $skip: Float
    $take: Float
    $include: JSON
    $select: JSON
  ) {
    findMany(
      modelName: $modelName
      where: $where
      orderBy: $orderBy
      skip: $skip
      take: $take
      include: $include
      select: $select
    )
  }
`,Pe=E`
  query FindUnique(
    $modelName: String!
    $where: JSON!
    $include: JSON
    $select: JSON
  ) {
    findUnique(
      modelName: $modelName
      where: $where
      include: $include
      select: $select
    )
  }
`,ke=E`
  mutation CreateOne(
    $modelName: String!
    $data: JSON!
    $include: JSON
    $select: JSON
  ) {
    createOne(
      modelName: $modelName
      data: $data
      include: $include
      select: $select
    )
  }
`,Ae=E`
  mutation UpdateOne(
    $modelName: String!
    $where: JSON!
    $data: JSON!
    $include: JSON
    $select: JSON
  ) {
    updateOne(
      modelName: $modelName
      where: $where
      data: $data
      include: $include
      select: $select
    )
  }
`,Oe=E`
  mutation DeleteOne(
    $modelName: String!
    $where: JSON!
  ) {
    deleteOne(
      modelName: $modelName
      where: $where
    )
  }
`,Le=E`
  mutation BatchCreate(
    $modelName: String!
    $data: [JSON!]!
  ) {
    batchCreate(
      modelName: $modelName
      data: $data
    )
  }
`,Ie=E`
  mutation BatchUpdate(
    $modelName: String!
    $operations: [JSON!]!
  ) {
    batchUpdate(
      modelName: $modelName
      operations: $operations
    )
  }
`,Ne=E`
  mutation BatchDelete(
    $modelName: String!
    $where: [JSON!]!
  ) {
    batchDelete(
      modelName: $modelName
      where: $where
    )
  }
`,$e=E`
  query HealthCheck {
    health
  }
`,Re=E`
  query GetAvailableModels {
    getAvailableModels
  }
`,Ye=E`
  query ModelMetadata($modelName: String!) {
    modelMetadata(modelName: $modelName)
  }
`,j=class i{constructor(t){this.apollo=t;this.initializeCacheCleanup(),this.performHealthCheck()}cache=new Map;DEFAULT_TTL=5*60*1e3;AGGRESSIVE_TTL=30*60*1e3;MAX_CACHE_SIZE=1e3;CLEANUP_INTERVAL=60*1e3;REQUEST_TIMEOUT=3e4;MAX_RETRIES=3;DEFAULT_BATCH_SIZE=1e3;MAX_PARALLEL_REQUESTS=5;performanceMetrics=V([]);cacheHitRate=yt(()=>{let t=this.performanceMetrics();return t.length===0?0:t.filter(n=>n.cacheHit).length/t.length*100});errors=V([]);isHealthy=V(!0);loadingStates=new Map;initializeCacheCleanup(){setInterval(()=>{this.cleanupExpiredCache()},this.CLEANUP_INTERVAL)}cleanupExpiredCache(){let t=new Date,e=[];if(this.cache.forEach((n,a)=>{t.getTime()-n.timestamp.getTime()>n.ttl&&e.push(a)}),e.forEach(n=>this.cache.delete(n)),this.cache.size>this.MAX_CACHE_SIZE){let n=Array.from(this.cache.entries()).sort((r,o)=>r[1].timestamp.getTime()-o[1].timestamp.getTime()),a=this.cache.size-this.MAX_CACHE_SIZE;for(let r=0;r<a;r++)this.cache.delete(n[r][0])}}generateCacheKey(t,e){return`${t}_${JSON.stringify(e)}`}getFromCache(t){let e=this.cache.get(t);return e?new Date().getTime()-e.timestamp.getTime()>e.ttl?(this.cache.delete(t),null):e.data:null}setCache(t,e,n=this.DEFAULT_TTL){this.cache.set(t,{data:e,timestamp:new Date,ttl:n,key:t})}invalidateCache(t){if(!t){this.cache.clear();return}let e=[];this.cache.forEach((n,a)=>{a.includes(t)&&e.push(a)}),e.forEach(n=>this.cache.delete(n))}trackPerformance(t,e,n,a,r){let o={queryTime:Date.now()-e,cacheHit:n,resultCount:a,timestamp:new Date,queryType:t,modelName:r},h=this.performanceMetrics();this.performanceMetrics.set([...h.slice(-99),o])}trackError(t,e){let n={message:t.message||"Unknown error",code:t.code||t.extensions?.code,path:t.path,timestamp:new Date},a=this.errors();this.errors.set([...a.slice(-49),n])}setLoading(t,e){this.loadingStates.set(t,e)}performHealthCheck(){return g(this,null,function*(){let t=Date.now();try{let e=yield M(this.apollo.query({query:$e,fetchPolicy:"no-cache"}));this.isHealthy.set(!0),this.trackPerformance("health_check",t,!1,1)}catch(e){this.isHealthy.set(!1),this.trackError(e,"health_check")}})}findMany(n){return g(this,arguments,function*(t,e={}){let a=Date.now(),r=this.generateCacheKey("findMany",_({modelName:t},e)),o=`findMany_${t}`,h=this.getFromCache(r);if(h)return this.trackPerformance("findMany",a,!0,h.length,t),h;this.setLoading(o,!0);let f={modelName:t,where:e.where,orderBy:e.orderBy,skip:e.skip,take:e.take,include:e.include,select:e.select};try{let d=(yield M(this.apollo.query({query:De,variables:f,fetchPolicy:"cache-first"}))).data.findMany;return this.setCache(r,d),this.trackPerformance("findMany",a,!1,d.length,t),d}catch(l){throw this.trackError(l,"findMany"),l}finally{this.setLoading(o,!1)}})}findUnique(a,r){return g(this,arguments,function*(t,e,n={}){let o=Date.now(),h=this.generateCacheKey("findUnique",_({modelName:t,where:e},n)),f=`findUnique_${t}`,l=this.getFromCache(h);if(l)return this.trackPerformance("findUnique",o,!0,1,t),l;this.setLoading(f,!0);let d={modelName:t,where:e,include:n.include,select:n.select};try{let w=(yield M(this.apollo.query({query:Pe,variables:d,fetchPolicy:"cache-first"}))).data.findUnique;return this.setCache(h,w),this.trackPerformance("findUnique",o,!1,w?1:0,t),w}catch(y){throw this.trackError(y,"findUnique"),y}finally{this.setLoading(f,!1)}})}createOne(a,r){return g(this,arguments,function*(t,e,n={}){let o=Date.now(),h=`createOne_${t}`;this.setLoading(h,!0);let f={modelName:t,data:e,include:n.include,select:n.select};try{let d=(yield M(this.apollo.mutate({mutation:ke,variables:f}))).data.createOne;return this.invalidateCache(t),this.trackPerformance("createOne",o,!1,1,t),d}catch(l){throw this.trackError(l,"createOne"),l}finally{this.setLoading(h,!1)}})}updateOne(r,o,h){return g(this,arguments,function*(t,e,n,a={}){let f=Date.now(),l=`updateOne_${t}`;this.setLoading(l,!0);let d={modelName:t,where:e,data:n,include:a.include,select:a.select};try{let w=(yield M(this.apollo.mutate({mutation:Ae,variables:d}))).data.updateOne;return this.invalidateCache(t),this.trackPerformance("updateOne",f,!1,1,t),w}catch(y){throw this.trackError(y,"updateOne"),y}finally{this.setLoading(l,!1)}})}deleteOne(t,e){return g(this,null,function*(){let n=Date.now(),a=`deleteOne_${t}`;this.setLoading(a,!0);let r={modelName:t,where:e};try{let h=(yield M(this.apollo.mutate({mutation:Oe,variables:r}))).data.deleteOne;return this.invalidateCache(t),this.trackPerformance("deleteOne",n,!1,1,t),h}catch(o){throw this.trackError(o,"deleteOne"),o}finally{this.setLoading(a,!1)}})}batchCreate(t,e){return g(this,null,function*(){let n=Date.now(),a=`batchCreate_${t}`;this.setLoading(a,!0);let r={modelName:t,data:e};try{let h=(yield M(this.apollo.mutate({mutation:Le,variables:r}))).data.batchCreate;return this.invalidateCache(t),this.trackPerformance("batchCreate",n,!1,h.length,t),h}catch(o){throw this.trackError(o,"batchCreate"),o}finally{this.setLoading(a,!1)}})}batchUpdate(t,e){return g(this,null,function*(){let n=Date.now(),a=`batchUpdate_${t}`;this.setLoading(a,!0);let r={modelName:t,operations:e};try{let h=(yield M(this.apollo.mutate({mutation:Ie,variables:r}))).data.batchUpdate;return this.invalidateCache(t),this.trackPerformance("batchUpdate",n,!1,h.length,t),h}catch(o){throw this.trackError(o,"batchUpdate"),o}finally{this.setLoading(a,!1)}})}batchDelete(t,e){return g(this,null,function*(){let n=Date.now(),a=`batchDelete_${t}`;this.setLoading(a,!0);let r={modelName:t,where:e};try{let h=(yield M(this.apollo.mutate({mutation:Ne,variables:r}))).data.batchDelete;return this.invalidateCache(t),this.trackPerformance("batchDelete",n,!1,h.length,t),h}catch(o){throw this.trackError(o,"batchDelete"),o}finally{this.setLoading(a,!1)}})}getAvailableModels(){return g(this,null,function*(){let t=Date.now(),e="getAvailableModels",n=this.getFromCache(e);if(n)return this.trackPerformance("getAvailableModels",t,!0,n.length),n;try{let r=(yield M(this.apollo.query({query:Re,fetchPolicy:"cache-first"}))).data.getAvailableModels;return this.setCache(e,r,this.DEFAULT_TTL*12),this.trackPerformance("getAvailableModels",t,!1,r.length),r}catch(a){throw this.trackError(a,"getAvailableModels"),a}})}getModelMetadata(t){return g(this,null,function*(){let e=Date.now(),n=this.generateCacheKey("modelMetadata",{modelName:t}),a=this.getFromCache(n);if(a)return this.trackPerformance("modelMetadata",e,!0,1,t),a;try{let o=(yield M(this.apollo.query({query:Ye,variables:{modelName:t},fetchPolicy:"cache-first"}))).data.modelMetadata;return this.setCache(n,o,this.DEFAULT_TTL*6),this.trackPerformance("modelMetadata",e,!1,1,t),o}catch(r){throw this.trackError(r,"modelMetadata"),r}})}findManyWithPagination(n){return g(this,arguments,function*(t,e={}){let a=e.pageSize||10,r=Math.max(1,e.page||1),o=(r-1)*a,h=D(_({},e),{skip:o,take:a}),f=D(_({},e),{select:{id:!0}});delete f.skip,delete f.take;try{let d=(yield this.findMany(t,f)).length;return{data:yield this.findMany(t,h),totalCount:d,hasNextPage:o+a<d,hasPreviousPage:r>1,currentPage:r,totalPages:Math.ceil(d/a)}}catch(l){throw l}})}getPerformanceMetrics(){return this.performanceMetrics()}getCacheHitRate(){return this.cacheHitRate()}getErrors(){return this.errors()}getHealthStatus(){return this.isHealthy()}isLoading(t,e){let n=e?`${t}_${e}`:t;return this.loadingStates.get(n)||!1}getCacheSize(){return this.cache.size}findAll(n){return g(this,arguments,function*(t,e={}){let a=Date.now(),Y=e,{enableParallelFetch:r=!0,enableStreaming:o=!0,batchSize:h=this.DEFAULT_BATCH_SIZE,maxConcurrency:f=this.MAX_PARALLEL_REQUESTS,aggressiveCache:l=!0}=Y,d=rt(Y,["enableParallelFetch","enableStreaming","batchSize","maxConcurrency","aggressiveCache"]),y=this.generateCacheKey("findAll",_({modelName:t},d)),w=l?this.AGGRESSIVE_TTL:this.DEFAULT_TTL,O=this.getFromCache(y);if(O&&l)return D(_({},O),{fetchTime:Date.now()-a,cacheHit:!0});this.setLoading(`findAll_${t}`,!0);try{let A;r?A=yield this.parallelFindAll(t,d,h,f):o?A=yield this.streamingFindAll(t,d,h):A=yield this.standardFindAll(t,d);let U=D(_({},A),{fetchTime:Date.now()-a,cacheHit:!1,parallel:r});return this.setCache(y,U,w),this.trackPerformance("findAll",a,!1,A.totalCount,t),U}catch(A){throw this.trackError(A,"findAll"),A}finally{this.setLoading(`findAll_${t}`,!1)}})}parallelFindAll(t,e,n,a){return g(this,null,function*(){let o=(yield this.findMany(t,D(_({},e),{select:{id:!0}}))).length;if(o===0)return{data:[],totalCount:0,fetchTime:0,cacheHit:!1,parallel:!0,batches:0};let h=Math.ceil(o/n),f=(y,w)=>g(this,null,function*(){return yield this.findMany(t,D(_({},e),{skip:y,take:w}))});return{data:yield g(this,null,function*(){let y=[],w=[];for(let O=0;O<h;O++){let Y=O*n,A=Math.min(n,o-Y),U=f(Y,A).then(W=>{y.push(...W)});if(w.push(U),w.length>=a){yield Promise.race(w);let W=w.filter(it=>it&&typeof it.isPending!="boolean");w.length=0,w.push(...W)}}return yield Promise.all(w),y}),totalCount:o,fetchTime:0,cacheHit:!1,parallel:!0,batches:h}})}streamingFindAll(t,e,n){return g(this,null,function*(){let a=[],r=0,o=0,h=!0,f=0;for(;h;){let l=yield this.findMany(t,D(_({},e),{skip:r,take:n}));if(l.length===0){h=!1;break}a.push(...l),o+=l.length,r+=n,f++,l.length<n&&(h=!1),f%5===0&&(yield new Promise(d=>setTimeout(d,0)))}return{data:a,totalCount:o,fetchTime:0,cacheHit:!1,parallel:!1,batches:f}})}standardFindAll(t,e){return g(this,null,function*(){let n=yield this.findMany(t,e);return{data:n,totalCount:n.length,fetchTime:0,cacheHit:!1,parallel:!1}})}findAllMultiple(n){return g(this,arguments,function*(t,e={}){let a=Date.now(),r={},o=t.map(l=>g(this,[l],function*({name:h,options:f={}}){let d=_(_({},e),f),y=yield this.findAll(h,d);return{name:h,result:y}}));try{(yield Promise.all(o)).forEach(({name:l,result:d})=>{r[l]=d});let f=Object.values(r).reduce((l,d)=>l+d.totalCount,0);return this.trackPerformance("findAllMultiple",a,!1,f,"multiple"),r}catch(h){throw this.trackError(h,"findAllMultiple"),h}})}smartFindAll(n){return g(this,arguments,function*(t,e={}){let a=yield this.getModelMetadata(t),r=a?.estimatedRecordCount||1e3,o=a?.hasComplexRelations||!1,h=D(_({},e),{enableParallelFetch:r>5e3,enableStreaming:r>1e4,batchSize:o?500:2e3,maxConcurrency:o?3:5,aggressiveCache:r<5e4});return yield this.findAll(t,h)})}clearCache(t){this.invalidateCache(t)}refreshHealthCheck(){return g(this,null,function*(){yield this.performHealthCheck()})}benchmarkFindAll(n){return g(this,arguments,function*(t,e=[]){let a=[{enableParallelFetch:!1,enableStreaming:!1},{enableParallelFetch:!0,enableStreaming:!1,batchSize:500},{enableParallelFetch:!0,enableStreaming:!1,batchSize:2e3},{enableParallelFetch:!1,enableStreaming:!0,batchSize:1e3},{enableParallelFetch:!0,enableStreaming:!1,aggressiveCache:!0}],r=e.length>0?e:a,o=[];this.clearCache(t);for(let f of r){console.log("\u{1F9EA} Testing configuration:",f);let l=Date.now(),d=yield this.findAll(t,f),y=Date.now()-l,w={totalTime:y,recordsPerSecond:Math.round(d.totalCount/(y/1e3)),cacheEfficiency:d.cacheHit?100:0};o.push({config:f,result:d,performance:w}),console.log(`\u2705 Completed: ${y}ms, ${w.recordsPerSecond} records/sec`),yield new Promise(O=>setTimeout(O,100))}let h=o.reduce((f,l)=>l.performance.recordsPerSecond>f.performance.recordsPerSecond?l:f);return{results:o,recommendation:h.config}})}findAllTonKho(){return g(this,arguments,function*(t={}){return yield this.findAll("tonkho",_({batchSize:2e3,enableParallelFetch:!0,aggressiveCache:!0,select:{id:!0,sanphamId:!0,slton:!0,slchogiao:!0,slchonhap:!0,sanpham:{select:{id:!0,ten:!0,gia:!0}}}},t))})}findAllSanpham(){return g(this,arguments,function*(t={}){return yield this.smartFindAll("sanpham",_({select:{id:!0,ten:!0,gia:!0,mota:!0,active:!0,createdAt:!0},orderBy:{ten:"asc"},aggressiveCache:!0},t))})}findAllKhachhang(){return g(this,arguments,function*(t={}){return yield this.smartFindAll("khachhang",_({select:{id:!0,ten:!0,email:!0,sdt:!0,diachi:!0,active:!0},orderBy:{ten:"asc"},batchSize:1e3,enableParallelFetch:!0},t))})}findAllDonhang(){return g(this,arguments,function*(t={}){return yield this.findAll("donhang",_({include:{khachhang:{select:{id:!0,ten:!0,sdt:!0}},donhangsanpham:{select:{id:!0,soluong:!0,gia:!0,sanpham:{select:{id:!0,ten:!0}}}}},orderBy:{createdAt:"desc"},batchSize:500,maxConcurrency:3},t))})}loadDashboardData(){return g(this,arguments,function*(t={}){let e=Date.now(),[n,a,r,o]=yield Promise.all([this.findAllSanpham(_({take:100,aggressiveCache:!0},t)),this.findAllKhachhang(_({take:50,aggressiveCache:!0},t)),this.findAllTonKho(_({take:200,aggressiveCache:!0},t)),this.findAllDonhang(_({take:20,aggressiveCache:!0},t))]);return{sanpham:n,khachhang:a,tonkho:r,donhang:o,totalLoadTime:Date.now()-e}})}getSanphamList(){return g(this,arguments,function*(t={}){return yield this.findMany("sanpham",_({orderBy:{ten:"asc"}},t))})}getSanphamById(t){return g(this,null,function*(){return yield this.findUnique("sanpham",{id:t})})}getKhachhangList(){return g(this,arguments,function*(t={}){return yield this.findMany("khachhang",_({orderBy:{ten:"asc"}},t))})}getKhachhangById(t){return g(this,null,function*(){return yield this.findUnique("khachhang",{id:t})})}getDonhangList(){return g(this,arguments,function*(t={}){return yield this.findMany("donhang",_({orderBy:{createdAt:"desc"},include:{khachhang:!0,donhangsanpham:{include:{sanpham:!0}}}},t))})}getDonhangById(t){return g(this,null,function*(){return yield this.findUnique("donhang",{id:t},{include:{khachhang:!0,donhangsanpham:{include:{sanpham:!0}}}})})}getDathangList(){return g(this,arguments,function*(t={}){return yield this.findMany("dathang",_({orderBy:{createdAt:"desc"},include:{nhacungcap:!0,dathangsanpham:{include:{sanpham:!0}}}},t))})}getUserList(){return g(this,arguments,function*(t={}){return yield this.findMany("user",_({orderBy:{ten:"asc"},select:{id:!0,ten:!0,email:!0,sdt:!0,createdAt:!0,updatedAt:!0}},t))})}getUserById(t){return g(this,null,function*(){return yield this.findUnique("user",{id:t},{include:{profile:!0,userRole:{include:{role:!0}}}})})}static \u0275fac=function(e){return new(e||i)(ot(Te))};static \u0275prov=B({token:i,factory:i.\u0275fac,providedIn:"root"})};var x=Me(Ee());var X=class i{toUTC(t){return t?typeof t=="string"&&t.match(/^\d{4}-\d{2}-\d{2}$/)?(0,x.default)(t,"YYYY-MM-DD").utc().toISOString():(0,x.default)(t).utc().toISOString():""}fromUTC(t,e="YYYY-MM-DD"){return t?x.default.utc(t).local().format(e):""}nowUTC(){return(0,x.default)().utc().toISOString()}nowLocal(t="YYYY-MM-DD"){return(0,x.default)().format(t)}isAfter(t,e){return x.default.utc(t).isAfter(x.default.utc(e))}isBefore(t,e){return x.default.utc(t).isBefore(x.default.utc(e))}isSameDay(t,e){return x.default.utc(t).format("YYYY-MM-DD")===x.default.utc(e).format("YYYY-MM-DD")}addDays(t,e,n="YYYY-MM-DD"){return x.default.utc(t).add(e,"days").format(n)}diffInDays(t,e){return x.default.utc(e).diff(x.default.utc(t),"days")}isValidDate(t,e="YYYY-MM-DD"){return(0,x.default)(t,e,!0).isValid()}formDateToUTC(t){return t?t instanceof Date?(0,x.default)(t).utc().toISOString():typeof t=="string"?this.toUTC(t):(0,x.default)(t).utc().toISOString():""}utcToFormDate(t,e=!1){return t?e?x.default.utc(t).local().toDate():x.default.utc(t).local().format("YYYY-MM-DD"):null}formatForDisplay(t,e="DD/MM/YYYY"){return t?x.default.utc(t).local().format(e):""}parseUserInputToUTC(t,e="YYYY-MM-DD"){if(!t)return"";let n=(0,x.default)(t,e);if(!n.isValid())throw new Error(`Invalid date format: ${t}`);return n.utc().toISOString()}getUTCDateRange(t,e){let n=t?this.toUTC(t):"",a=e?this.toUTC(e):"";return{startUTC:n,endUTC:a}}static \u0275fac=function(e){return new(e||i)};static \u0275prov=B({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ue=["drawer"],Be=()=>({standalone:!0}),Ve=(i,t)=>t.key;function ze(i,t){if(i&1){let e=$();s(0,"button",43),T("click",function(a){let r=C(e).$implicit;return c().toggleColumn(r),b(a.stopPropagation())}),s(1,"mat-icon"),m(2),u(),s(3,"span"),m(4),u()()}if(i&2){let e=t.$implicit;p(2),F(e.isShow?"check_box":"check_box_outline_blank"),p(2),F(e.value)}}function qe(i,t){i&1&&(s(0,"span",64),m(1,"check"),u())}function Ge(i,t){i&1&&G(0,"span",65)}function He(i,t){if(i&1&&(s(0,"span"),m(1),u()),i&2){let e=c().$implicit,n=c(2).$implicit,a=c();p(),F(a.formatDateForDisplay(e[n],"DD/MM/YYYY"))}}function Ke(i,t){if(i&1&&(s(0,"span"),m(1),u()),i&2){let e=c().$implicit,n=c(2).$implicit,a=c();p(),F(a.formatDateForDisplay(e[n],"DD/MM/YYYY"))}}function Qe(i,t){if(i&1&&(s(0,"span"),m(1),u()),i&2){let e=c().$implicit,n=c(2).$implicit,a=c();p(),F(a.formatDateForDisplay(e[n],"DD/MM/YYYY"))}}function Je(i,t){if(i&1&&(s(0,"span"),m(1),P(2,"number"),u()),i&2){let e=c().$implicit,n=c(2).$implicit;p(),F(k(2,1,e[n],"1.0-0"))}}function je(i,t){if(i&1&&(s(0,"span"),m(1),P(2,"number"),u()),i&2){let e=c().$implicit,n=c(2).$implicit;p(),F(k(2,1,e[n],"1.0-0"))}}function Xe(i,t){if(i&1&&(s(0,"span"),m(1),P(2,"number"),u()),i&2){let e=c().$implicit,n=c(2).$implicit;p(),F(k(2,1,e[n],"1.0-0"))}}function We(i,t){if(i&1&&(s(0,"span"),m(1),P(2,"number"),u()),i&2){let e=c().$implicit,n=c(2).$implicit;p(),F(k(2,1,e[n],"1.0-0"))}}function Ze(i,t){if(i&1&&(s(0,"span"),m(1),P(2,"number"),u()),i&2){let e=c().$implicit,n=c(2).$implicit;p(),F(k(2,1,e[n],"1.0-0"))}}function tn(i,t){if(i&1&&(s(0,"span"),m(1),u()),i&2){let e=c().$implicit,n=c(3);p(),F(n.GetGoiy(e))}}function en(i,t){if(i&1&&(s(0,"span"),m(1),u()),i&2){let e=c().$implicit,n=c(2).$implicit;p(),F(e[n]||"Tr\u1ED1ng")}}function nn(i,t){if(i&1){let e=$();s(0,"div",61),T("click",function(){let a=C(e).$implicit,r=c(2).$implicit,o=c();return b(o.ChosenItem(a,r))}),I(1,qe,2,0,"span",62)(2,Ge,1,0,"span",63)(3,He,2,1,"span")(4,Ke,2,1,"span")(5,Qe,2,1,"span")(6,Je,3,4,"span")(7,je,3,4,"span")(8,Xe,3,4,"span")(9,We,3,4,"span")(10,Ze,3,4,"span")(11,tn,2,1,"span")(12,en,2,1,"span"),u()}if(i&2){let e,n=t.$implicit,a=c(2).$implicit,r=c();p(),v("ngIf",r.CheckItem(n)),p(),v("ngIf",!r.CheckItem(n)),p(),q((e=a)==="createdAt"?3:e==="updatedAt"?4:e==="ngaynhan"?5:e==="slton"?6:e==="slchogiao"?7:e==="slchonhap"?8:e==="SLDat"?9:e==="SLGiao"?10:e==="goiy"?11:12)}}function an(i,t){if(i&1){let e=$();s(0,"th",46)(1,"div",47)(2,"span",48),m(3),u(),s(4,"span",49,3),m(6," filter_alt "),u()(),s(7,"mat-menu",50,6)(9,"div",51),T("click",function(a){return C(e),b(a.stopPropagation())}),s(10,"div",52)(11,"input",53),T("keyup",function(a){C(e);let r=c().$implicit,o=c();return b(o.doFilterHederColumn(a,r))}),u(),s(12,"div",14)(13,"span",15),m(14,"search"),u()()(),s(15,"div",54)(16,"div",55)(17,"span",56),T("click",function(){C(e);let a=c().$implicit,r=c();return b(r.ChosenAll(r.getCurrentFilteredData(a)))}),m(18),u(),s(19,"span",56),T("click",function(){C(e);let a=c(2);return b(a.EmptyFiter())}),m(20,"Xo\xE1"),u()(),s(21,"span",56),T("click",function(){C(e);let a=c(2);return b(a.ResetFilter())}),m(22,"Reset"),u()(),s(23,"div",57),I(24,nn,13,3,"div",58),u(),s(25,"div",59)(26,"button",60),T("click",function(){C(e);let a=N(5);return b(a.closeMenu())}),m(27,"\u0110\xF3ng"),u(),s(28,"button",40),T("click",function(){C(e);let a=N(5),r=c(2);return b(r.ApplyFilterColum(a))}),m(29,"\xC1p D\u1EE5ng"),u()()()()()}if(i&2){let e=N(8),n=c().$implicit,a=c();p(3),S(" ",a.ColumnName[n]," "),p(),nt("matTooltip","Filter ",a.ColumnName[n],""),v("matMenuTriggerFor",e),p(7),nt("placeholder","T\xECm ki\u1EBFm ",a.ColumnName[n],"..."),p(7),S(" Ch\u1ECDn T\u1EA5t C\u1EA3 (",a.getCurrentFilteredData(n).length||0,") "),p(6),v("ngForOf",a.getCurrentFilteredData(n))("ngForTrackBy",a.trackByFn)}}function rn(i,t){if(i&1&&(s(0,"span",67),m(1),u()),i&2){let e=c().index;p(),S(" ",e+1," ")}}function on(i,t){if(i&1&&(s(0,"span",68),m(1),u()),i&2){let e=c().$implicit,n=c().$implicit;v("matTooltip",e[n]),p(),S(" ",e[n]," ")}}function sn(i,t){if(i&1&&(s(0,"span",69),m(1),u()),i&2){let e=c().$implicit,n=c().$implicit;p(),S(" ",e[n]," ")}}function ln(i,t){if(i&1&&(s(0,"span",79),m(1),P(2,"number"),u()),i&2){let e=c().$implicit,n=c().$implicit;z("text-red-600",e[n]<=0)("text-green-600",e[n]>0),p(),S(" ",k(2,5,e[n],"1.0-0")," ")}}function cn(i,t){if(i&1&&(s(0,"span",71),m(1),P(2,"number"),u()),i&2){let e=c().$implicit,n=c().$implicit;p(),S(" ",k(2,1,e[n],"1.0-0")," ")}}function un(i,t){if(i&1&&(s(0,"span",72),m(1),P(2,"number"),u()),i&2){let e=c().$implicit,n=c().$implicit;p(),S(" ",k(2,1,e[n],"1.0-0")," ")}}function mn(i,t){if(i&1&&(s(0,"span",73),m(1),P(2,"number"),u()),i&2){let e=c().$implicit,n=c().$implicit;p(),S(" ",k(2,1,e[n],"1.0-0")," ")}}function hn(i,t){if(i&1&&(s(0,"span",74),m(1),P(2,"number"),u()),i&2){let e=c().$implicit,n=c().$implicit;p(),S(" ",k(2,1,e[n],"1.0-0")," ")}}function pn(i,t){if(i&1&&(s(0,"span",80),m(1),u()),i&2){let e=c().$implicit,n=c(2);z("text-red-600",n.parseFloat(n.GetGoiy(e))>0)("text-gray-400",n.parseFloat(n.GetGoiy(e))==0),p(),S(" ",n.GetGoiy(e)," ")}}function dn(i,t){if(i&1&&(s(0,"span",76),m(1),u()),i&2){let e=c().$implicit,n=c().$implicit,a=c();p(),S(" ",a.formatDateForDisplay(e[n],"DD/MM/YYYY")," ")}}function gn(i,t){if(i&1&&(s(0,"span",76),m(1),u()),i&2){let e=c().$implicit,n=c().$implicit,a=c();p(),S(" ",a.formatDateForDisplay(e[n],"DD/MM/YYYY")," ")}}function fn(i,t){if(i&1&&(s(0,"span",76),m(1),u()),i&2){let e=c().$implicit,n=c().$implicit,a=c();p(),S(" ",a.formatDateForDisplay(e[n],"DD/MM/YYYY")," ")}}function _n(i,t){i&1&&(s(0,"mat-icon",81),m(1,"check_circle"),u())}function yn(i,t){i&1&&(s(0,"mat-icon",82),m(1,"cancel"),u())}function xn(i,t){if(i&1&&(s(0,"span",77),I(1,_n,2,0,"mat-icon",81)(2,yn,2,0,"mat-icon",82),u()),i&2){let e=c().$implicit,n=c().$implicit;p(),q(e[n]?1:2)}}function Cn(i,t){if(i&1&&(s(0,"span",78),m(1),u()),i&2){let e=c().$implicit,n=c().$implicit;v("matTooltip",e[n]),p(),S(" ",e[n]," ")}}function bn(i,t){if(i&1&&(s(0,"td",66),I(1,rn,2,1,"span",67)(2,on,2,2,"span",68)(3,sn,2,1,"span",69)(4,ln,3,8,"span",70)(5,cn,3,4,"span",71)(6,un,3,4,"span",72)(7,mn,3,4,"span",73)(8,hn,3,4,"span",74)(9,pn,2,5,"span",75)(10,dn,2,1,"span",76)(11,gn,2,1,"span",76)(12,fn,2,1,"span",76)(13,xn,3,1,"span",77)(14,Cn,2,2,"span",78),u()),i&2){let e,n=c().$implicit;p(),q((e=n)==="STT"?1:e==="title"?2:e==="masp"?3:e==="slton"?4:e==="slchogiao"?5:e==="slchonhap"?6:e==="SLDat"?7:e==="SLGiao"?8:e==="goiy"?9:e==="createdAt"?10:e==="updatedAt"?11:e==="ngaynhan"?12:e==="isActive"?13:14)}}function wn(i,t){if(i&1&&(ut(0,28),I(1,an,30,9,"th",44)(2,bn,15,1,"td",45),mt()),i&2){let e=t.$implicit;v("matColumnDef",e)}}function Tn(i,t){i&1&&G(0,"tr",83)}function Sn(i,t){if(i&1){let e=$();s(0,"tr",84),T("click",function(){let a=C(e).$implicit,r=c();return b(r.AddToEdit(a))}),u()}if(i&2){let e=t.$implicit,n=c();z("bg-slate-200",n.CheckItemInEdit(e))}}function vn(i,t){if(i&1&&(s(0,"tr",85)(1,"td",86)(2,"div",87)(3,"mat-icon",88),m(4,"search_off"),u(),s(5,"span"),m(6,"Kh\xF4ng t\xECm th\u1EA5y d\u1EEF li\u1EC7u"),u()()()()),i&2){let e=c();p(),lt("colspan",e.displayedColumns.length)}}function Fn(i,t){i&1&&(s(0,"mat-dialog-content")(1,"div",89)(2,"div",90),m(3,"X\xE1c Nh\u1EADn"),u(),s(4,"div"),m(5,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),u(),s(6,"div",91)(7,"button",92),m(8,"\u0110\u1ED3ng \xDD"),u(),s(9,"button",93),m(10,"Hu\u1EF7 B\u1ECF"),u()()()())}var R=class R{displayedColumns=["title","masp","slton","slchogiao","slchonhap","SLDat","SLGiao","goiy"];ColumnName={title:"T\xEAn S\u1EA3n Ph\u1EA9m",masp:"M\xE3 S\u1EA3n Ph\u1EA9m",slton:"T\u1ED3n Kho",slchogiao:"Ch\u1EDD Giao",slchonhap:"Ch\u1EDD Nh\u1EADp",SLDat:"SL \u0110\u1EB7t (Nh\xE0 CC)",SLGiao:"SL Giao (Kh\xE1ch)",goiy:"G\u1EE3i \xDD"};FilterColumns=JSON.parse(localStorage.getItem("NhucauColFilter")||"[]");Columns=[];totalItems=0;pageSize=10;currentPage=1;totalPages=1;paginator;sort;drawer;_SanphamService=L(we);_breakpointObserver=L(Ft);_GraphqlService=L(j);_router=L(vt);_dialog=L(Gt);_timezoneService=L(X);_snackBar=L(kt);Listsanpham=this._SanphamService.ListSanpham;TonghopsFinal=[];EditList=[];dataSource=new at;ListFilter=[];ListDathang=[];isSubmit=!1;quickFilter="all";globalFilterValue="";constructor(){xt(()=>{let t=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();this.dataSource.data=t,this.totalItems=t.length,this.calculateTotalPages()})}ngOnInit(){return g(this,null,function*(){this.updateDisplayData(),this.loadDonhangWithRelations(),this._SanphamService.listenSanphamUpdates(),yield this._SanphamService.getNhucau(),this.dataSource=new at(this.Listsanpham()),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource.sortingDataAccessor=(t,e)=>{switch(e){case"slton":case"slchogiao":case"slchonhap":case"SLDat":case"SLGiao":return Number(t[e])||0;case"goiy":return parseFloat(this.GetGoiy(t));case"title":case"masp":return t[e]?.toLowerCase()||"";default:return t[e]||""}},this.initializeColumns(),this.setupDrawer()})}GetGoiy(t){let e=t.slton||0,n=t.slchogiao||0,a=t.slchonhap||0,r=t.SLGiao||0;return Math.max(0,r+n-e-a).toFixed(0)}loadDonhangWithRelations(){return g(this,null,function*(){try{let[t,e,n]=yield Promise.all([this._GraphqlService.findAll("donhang",{enableParallelFetch:!0,batchSize:1e3,aggressiveCache:!0,orderBy:{createdAt:"desc"},select:{id:!0,madonhang:!0,ngaygiao:!0,sanpham:{select:{giaban:!0,sldat:!0,slgiao:!0,slnhan:!0,sanpham:{select:{masp:!0}}}}}}),this._GraphqlService.findAll("dathang",{enableParallelFetch:!0,batchSize:1e3,aggressiveCache:!0,orderBy:{createdAt:"desc"},select:{id:!0,madncc:!0,ngaynhan:!0,nhacungcap:{select:{name:!0,mancc:!0}},sanpham:{select:{sldat:!0,slgiao:!0,slnhan:!0,sanpham:{select:{masp:!0}}}}}}),this._GraphqlService.findAllTonKho({enableParallelFetch:!0,aggressiveCache:!0,select:{id:!0,sanphamId:!0,slton:!0,slchogiao:!0,slchonhap:!0,sanpham:{select:{title:!0,masp:!0}}}})]),a=t.data.flatMap(l=>l.sanpham.map(d=>({type:"donhang",madonhang:l.madonhang,ngaygiao:l.ngaygiao,masp:d.sanpham.masp,giaban:Number(d.giaban)||0,sldat:Number(d.sldat)||0,slgiao:Number(d.slgiao)||0,slnhan:Number(d.slnhan)||0}))),r=e.data.flatMap(l=>l.sanpham.map(d=>({type:"dathang",madncc:l.madncc,mancc:l.nhacungcap.mancc,name:l.nhacungcap.name,ngaynhan:l.ngaynhan,masp:d.sanpham.masp,sldat:Number(d.sldat)||0,slgiao:Number(d.slgiao)||0,slnhan:Number(d.slnhan)||0}))),o=n.data.map(l=>({type:"tonkho",masp:l.sanpham.masp,title:l.sanpham.title,slton:Number(l.slton)||0,slchogiao:Number(l.slchogiao)||0,slchonhap:Number(l.slchonhap)||0})),h=new Map;o.forEach(l=>{h.set(l.masp,{id:ee(8,!1),ngaynhan:l.ngaynhan,mancc:l.mancc,name:l.name,masp:l.masp,title:l.title,slton:l.slton,slchogiao:l.slchogiao,slchonhap:l.slchonhap,SLDat:0,SLGiao:0})}),r.forEach(l=>{if(console.log(l),h.has(l.masp)){let d=h.get(l.masp);d.SLDat+=l.slnhan,d.ngaynhan=l.ngaynhan,d.mancc=l.mancc,d.name=l.name}}),a.forEach(l=>{if(h.has(l.masp)){let d=h.get(l.masp);d.SLGiao+=l.slnhan}});let f=Array.from(h.values());console.log(f),this.TonghopsFinal=f,this.dataSource.data=f,this.totalItems=f.length,this.calculateTotalPages(),this.updateDisplayData()}catch(t){console.error("Error loading data:",t),this._snackBar.open("L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}})}refresh(){return g(this,null,function*(){yield this._SanphamService.getAllSanpham(),yield this.loadDonhangWithRelations()})}applyFilter(t){let e=t.target.value;this.dataSource.filter=e.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}initializeColumns(){this.Columns=Object.keys(this.ColumnName).map(t=>({key:t,value:this.ColumnName[t],isShow:!0})),this.FilterColumns.length===0?this.FilterColumns=this.Columns:localStorage.setItem("NhucauColFilter",JSON.stringify(this.FilterColumns)),this.displayedColumns=this.FilterColumns.filter(t=>t.isShow).map(t=>t.key),this.ColumnName=this.FilterColumns.reduce((t,e)=>(e.isShow&&(t[e.key]=e.value),t),{})}setupDrawer(){this._breakpointObserver.observe([Mt.Handset]).subscribe(t=>{t.matches?this.drawer.mode="over":this.drawer.mode="side"})}toggleColumn(t){let e=this.FilterColumns.find(n=>n.key===t.key);e&&(e.isShow=!e.isShow,this.updateDisplayedColumns())}doFilterHederColumn(t,e){let n=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();this.dataSource.filteredData=n.filter(a=>a[e]?.toString().toLowerCase().includes(t.target.value.toLowerCase()))}applyAdvancedColumnFilter(t,e){let n=t.target.value.toLowerCase();if(!n){this.getCurrentFilteredData(e);return}let r=(this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham()).filter(o=>o[e]?.toString().toLowerCase().includes(n));this.dataSource.filteredData=r}ChosenItem(t,e){let n=this.dataSource.filteredData.filter(r=>r[e]===t[e]);this.ListFilter.filter(r=>r[e]===t[e]).length>0?this.ListFilter=this.ListFilter.filter(r=>r[e]!==t[e]):this.ListFilter=[...this.ListFilter,...n]}ChosenAll(t){t.forEach(e=>{this.ListFilter.find(a=>a.id===e.id)?this.ListFilter=this.ListFilter.filter(a=>a.id!==e.id):this.ListFilter.push(e)})}ResetFilter(){let t=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();this.ListFilter=t,this.dataSource.data=t,this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}EmptyFiter(){this.ListFilter=[]}CheckItem(t){return!!this.ListFilter.find(e=>e.masp===t.masp||e.id===t.id)}ApplyFilterColum(t){let e=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();this.dataSource.data=e.filter(n=>this.ListFilter.some(a=>a.masp===n.masp)),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,t.closeMenu()}updateDisplayedColumns(){this.displayedColumns=this.FilterColumns.filter(t=>t.isShow).map(t=>t.key),this.ColumnName=this.FilterColumns.reduce((t,e)=>(e.isShow&&(t[e.key]=e.value),t),{}),localStorage.setItem("NhucauColFilter",JSON.stringify(this.FilterColumns))}doFilterColumns(t){let e=t.target.value.toLowerCase();this.FilterColumns=this.Columns.filter(n=>n.value.toLowerCase().includes(e))}AddToEdit(t){this.EditList.find(n=>n.masp===t.masp||n.id===t.id)?this.EditList=this.EditList.filter(n=>n.masp!==t.masp&&n.id!==t.id):this.EditList.push(t)}ChoseAllEdit(){let t=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();this.EditList=t}CheckItemInEdit(t){return this.EditList.some(e=>e.masp===t.masp||e.id===t.id)}onListDathangChange(t){this.isSubmit=t.isSubmit,this.ListDathang=t.ListDathang}ImporExcel(t){return g(this,null,function*(){let n=(yield be(t)).map(o=>({title:o.title?.trim()||"",masp:o.masp?.trim()||"",giagoc:Number(o.giagoc)||0,dvt:o.dvt?.trim()||"",soluong:Number(o.soluong)||0,soluongkho:Number(o.soluongkho)||0,haohut:Number(o.haohut)||0,ghichu:o.ghichu?.trim()||""})),a=Array.from(new Map(n.map(o=>[o.masp,o])).values()),r=this._SanphamService.ListSanpham();yield Promise.all(a.map(o=>g(this,null,function*(){let h=r.find(f=>f.masp===o.masp);if(h){let f=_(_({},h),o);yield this._SanphamService.updateSanpham(f)}else yield this._SanphamService.CreateSanpham(o)}))),yield Promise.all(r.filter(o=>!a.some(h=>h.masp===o.masp)).map(o=>this._SanphamService.updateSanpham(D(_({},o),{isActive:!1})))),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}ExportExcel(t,e){return g(this,null,function*(){let n=t.map(r=>({ngaynhan:this._timezoneService.nowLocal("YYYY-MM-DD"),masp:r.masp,title:r.title,dvt:r.dvt,slchogiao:r.slchogiao,goiy:this.GetGoiy(r),slchonhap:r.slchonhap,slton:r.slton,haohut:r.haohut,ghichu:r.ghichu})),a={ngaynhan:"Ng\xE0y Nh\u1EADn",masp:"M\xE3 S\u1EA3n Ph\u1EA9m",title:"T\xEAn S\u1EA3n Ph\u1EA9m",dvt:"\u0110\u01A1n V\u1ECB T\xEDnh",slchogiao:"Ch\u1EDD Giao",goiy:"G\u1EE3i \xDD",slchonhap:"Ch\u1EDD Nh\u1EADp",slton:"T\u1ED3n Kho",haohut:"Hao H\u1EE5t",ghichu:"Ghi Ch\xFA"};Ce(n,e,Object.values(a),a)})}trackByFn(t,e){return e.masp||e.id}calculateTotalPages(){this.totalPages=Math.ceil(this.totalItems/this.pageSize)}onPageSizeChange(t,e){let n=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();t>n.length?(this.pageSize=n.length,this._snackBar.open(`S\u1ED1 l\u01B0\u1EE3ng t\u1ED1i \u0111a ${n.length}`,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})):this.pageSize=t,this.currentPage=1,this.calculateTotalPages(),this.updateDisplayData(),e.closeMenu()}onPreviousPage(){this.currentPage>1&&(this.currentPage--,this.updateDisplayData())}onNextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.updateDisplayData())}updateDisplayData(){let t=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham(),e=(this.currentPage-1)*this.pageSize,n=e+this.pageSize,a=t.slice(e,n);this.dataSource.data=a}getCurrentFilteredData(t){let e=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham(),n=new Map;return e.forEach(a=>{let r=a[t];n.has(r)||n.set(r,a)}),Array.from(n.values())}parseFloat(t){return parseFloat(t)||0}applyQuickFilter(t){this.quickFilter=t;let e=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();switch(t){case"lowStock":e=e.filter(n=>(n.slton||0)<=10);break;case"needOrder":e=e.filter(n=>parseFloat(this.GetGoiy(n))>0);break;case"pendingDelivery":e=e.filter(n=>(n.slchogiao||0)>0);break;case"all":default:break}this.globalFilterValue&&(e=this.applyGlobalFilterToData(e,this.globalFilterValue)),this.dataSource.data=e,this.totalItems=e.length,this.calculateTotalPages(),this.currentPage=1,this.updateDisplayData()}applyGlobalFilter(t){let e=t.target.value;this.globalFilterValue=e;let n=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();if(this.quickFilter!=="all"){this.applyQuickFilter(this.quickFilter);return}e&&(n=this.applyGlobalFilterToData(n,e)),this.dataSource.data=n,this.totalItems=n.length,this.calculateTotalPages(),this.currentPage=1,this.updateDisplayData()}applyGlobalFilterToData(t,e){let n=e.trim().toLowerCase();return t.filter(a=>a.title?.toLowerCase().includes(n)||a.masp?.toLowerCase().includes(n)||a.name?.toLowerCase().includes(n)||a.mancc?.toLowerCase().includes(n))}sortData(t){let e=this.dataSource.data.slice();if(!t.active||t.direction===""){this.dataSource.data=e;return}this.dataSource.data=e.sort((n,a)=>{let r=t.direction==="asc";switch(t.active){case"title":case"masp":return this.compareStrings(n[t.active],a[t.active],r);case"slton":case"slchogiao":case"slchonhap":case"SLDat":case"SLGiao":return this.compareNumbers(Number(n[t.active])||0,Number(a[t.active])||0,r);case"goiy":return this.compareNumbers(parseFloat(this.GetGoiy(n)),parseFloat(this.GetGoiy(a)),r);default:return this.compareStrings(n[t.active],a[t.active],r)}})}compareStrings(t,e,n){return(t<e?-1:1)*(n?1:-1)}compareNumbers(t,e,n){return(t-e)*(n?1:-1)}clearAllFilters(){this.quickFilter="all",this.globalFilterValue="",this.ListFilter=[];let t=this.TonghopsFinal.length>0?this.TonghopsFinal:this.Listsanpham();this.dataSource.data=t,this.totalItems=t.length,this.calculateTotalPages(),this.currentPage=1,this.updateDisplayData(),document.querySelectorAll('input[type="text"]').forEach(n=>{n.placeholder.includes("T\xECm ki\u1EBFm")&&(n.value="")})}formatDateForDisplay(t,e="DD/MM/YYYY"){return this._timezoneService.formatForDisplay(t,e)}convertFormDateToUTC(t){return this._timezoneService.formDateToUTC(t)}parseUserDateInput(t,e="YYYY-MM-DD"){try{return this._timezoneService.parseUserInputToUTC(t,e)}catch(n){return console.error("Invalid date format:",n),""}}static \u0275fac=function(e){return new(e||R)};static \u0275cmp=st({type:R,selectors:[["app-nhucaudathang"]],viewQuery:function(e,n){if(e&1&&(H(ie,5),H(J,5),H(Ue,7)),e&2){let a;K(a=Q())&&(n.paginator=a.first),K(a=Q())&&(n.sort=a.first),K(a=Q())&&(n.drawer=a.first)}},decls:71,vars:19,consts:[["drawer",""],["menu","matMenu"],["uploadfile",""],["menuTrigger","matMenuTrigger"],["menuHienthi","matMenu"],["DeleteDialog",""],["filterMenu","matMenu"],["autosize","",1,"w-full","h-full"],["mode","over",1,"flex","flex-col","lg:!w-1/2","!w-full","h-full",3,"position"],[1,"flex","flex-col","space-y-2","h-screen-16","w-full","p-2"],[1,"border","p-1","cursor-pointer","w-full","relative","flex","lg:flex-row","lg:space-y-2","space-y-0","flex-col","space-x-2","justify-between","items-center","bg-white","rounded-lg"],[1,"w-full","flex","flex-row","space-x-2","items-center"],[1,"relative"],["type","text","placeholder","T\xECm ki\u1EBFm s\u1EA3n ph\u1EA9m, m\xE3 s\u1EA3n ph\u1EA9m...",1,"block","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],["matTooltip","\u1EA8n hi\u1EC7n c\u1ED9t","mat-icon-button","","color","primary","aria-label","Example icon-button with a menu",3,"matMenuTriggerFor"],[1,"p-4"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm Ki\u1EBFm",3,"input","click"],["matPrefix",""],[1,"flex","flex-col","max-h-80","overflow-auto"],["mat-menu-item",""],["matTooltip","T\u1EA3i file excel M\u1EABu","color","primary","mat-icon-button","",3,"click"],["type","file",1,"hidden",3,"change"],[1,"lg:flex","hidden","whitespace-nowrap","p-2","rounded-lg","bg-slate-200"],[1,"border","rounded-lg","w-full","h-full","overflow-auto"],["mat-table","","matSort","",1,"!border","w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","","class","bg-gray-50",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","hover:bg-slate-100 transition-colors duration-200",3,"bg-slate-200","click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[1,"cursor-pointer","border","rounded-lg","px-3","p-1","flex","flex-row","space-x-2","items-center","justify-between"],[1,"w-full","flex","lg:p-0","p-2","lg:flex-row","lg:space-x-2","lg:items-center","lg:justify-between","flex-col","justify-center"],[1,"w-full","text-center"],[1,"w-full","flex","flex-row","space-x-2","items-center","lg:justify-end","justify-center"],[1,"font-bold","text-blue-600",3,"matMenuTriggerFor"],[1,"w-full","flex","flex-col","space-y-2","p-4",3,"click"],["appearance","outline","subscriptSizing","dynamic"],["matInput","","placeholder","Vui l\xF2ng Nh\u1EADp S\u1ED1 L\u01B0\u1EE3ng",3,"ngModelChange","ngModel","ngModelOptions"],["mat-flat-button","","color","primary",3,"click"],[1,"pagination-controls"],["mat-icon-button","","color","primary",3,"click","disabled"],["mat-menu-item","",3,"click"],["class","whitespace-nowrap","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","","class","cursor-pointer",4,"matCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap"],[1,"flex","items-center","justify-between"],[1,"max-w-32","line-clamp-2","me-2"],[1,"z-10","material-symbols-outlined","text-gray-500","cursor-pointer",3,"matMenuTriggerFor","matTooltip"],[1,"filter-menu"],[1,"cursor-pointer","flex","flex-col","space-y-4","p-3",3,"click"],[1,"relative","w-full"],["type","text",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup","placeholder"],[1,"flex","flex-row","space-x-2","items-center","justify-between"],[1,"flex","flex-row","space-x-2","items-center"],[1,"text-xs","text-blue-600","underline","cursor-pointer",3,"click"],[1,"w-full","flex","flex-col","space-y-2","max-h-44","overflow-auto"],["class","flex flex-row space-x-2 items-center p-2 rounded-lg hover:bg-slate-100 cursor-pointer",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-row","space-x-2","items-end","justify-end"],["mat-flat-button","","color","warn",3,"click"],[1,"flex","flex-row","space-x-2","items-center","p-2","rounded-lg","hover:bg-slate-100","cursor-pointer",3,"click"],["class","material-symbols-outlined text-blue-600",4,"ngIf"],["class","w-6",4,"ngIf"],[1,"material-symbols-outlined","text-blue-600"],[1,"w-6"],["mat-cell","",1,"cursor-pointer"],[1,"max-w-16","line-clamp-1"],[1,"max-w-48","line-clamp-2",3,"matTooltip"],[1,"max-w-32","line-clamp-1","font-mono","text-sm"],[1,"max-w-20","line-clamp-1","text-end","font-semibold",3,"text-red-600","text-green-600"],[1,"max-w-20","line-clamp-1","text-end","text-orange-600","font-semibold"],[1,"max-w-20","line-clamp-1","text-end","text-blue-600","font-semibold"],[1,"max-w-20","line-clamp-1","text-end","text-purple-600","font-semibold"],[1,"max-w-20","line-clamp-1","text-end","text-indigo-600","font-semibold"],[1,"max-w-20","line-clamp-1","text-end","font-bold",3,"text-red-600","text-gray-400"],[1,"max-w-28","line-clamp-1","text-sm"],[1,"max-w-16","line-clamp-1","text-center"],[1,"max-w-32","line-clamp-2",3,"matTooltip"],[1,"max-w-20","line-clamp-1","text-end","font-semibold"],[1,"max-w-20","line-clamp-1","text-end","font-bold"],[1,"text-green-500"],[1,"text-red-500"],["mat-header-row","",1,"bg-gray-50"],["mat-row","",1,"hover:bg-slate-100","transition-colors","duration-200",3,"click"],[1,"mat-row"],[1,"mat-cell","p-8","text-center","text-gray-500"],[1,"flex","flex-col","items-center","space-y-2"],[1,"text-4xl","text-gray-300"],[1,"flex","flex-col","space-y-8","items-center","justify-center"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary","mat-dialog-close","true"],["mat-flat-button","","color","warn","mat-dialog-close","false"]],template:function(e,n){if(e&1){let a=$();s(0,"mat-drawer-container",7)(1,"mat-drawer",8,0),G(3,"router-outlet"),u(),s(4,"div",9)(5,"div",10)(6,"div",11)(7,"div",12)(8,"input",13),T("keyup",function(o){return C(a),b(n.applyGlobalFilter(o))}),u(),s(9,"div",14)(10,"span",15),m(11,"search"),u()()(),s(12,"button",16)(13,"mat-icon"),m(14,"tune"),u()(),s(15,"mat-menu",null,1)(17,"div",17)(18,"mat-form-field",18)(19,"input",19),T("input",function(o){return C(a),b(n.doFilterColumns(o))})("click",function(o){return C(a),b(o.stopPropagation())}),u(),s(20,"mat-icon",20),m(21,"search"),u()()(),s(22,"div",21),tt(23,ze,5,2,"button",22,Ve),u()(),s(25,"button",23),T("click",function(){return C(a),b(n.ExportExcel(n.dataSource.data,"Tonghop"))}),s(26,"mat-icon"),m(27,"file_download"),u()(),s(28,"input",24,2),T("change",function(o){return C(a),b(n.ImporExcel(o))}),u(),s(30,"span",25),m(31),u()()(),s(32,"div",26)(33,"table",27),tt(34,wn,3,1,"ng-container",28,ct),I(36,Tn,1,0,"tr",29)(37,Sn,1,2,"tr",30)(38,vn,7,1,"tr",31),u()(),s(39,"div",32)(40,"div",33)(41,"span",34),m(42,"\u0110ang Xem "),s(43,"strong"),m(44),u(),m(45," - "),s(46,"strong"),m(47),u(),m(48),u(),s(49,"div",35)(50,"span",36,3),m(52),u(),s(53,"mat-menu",null,4)(55,"div",37),T("click",function(o){return C(a),b(o.stopPropagation())}),s(56,"span"),m(57,"S\u1ED1 L\u01B0\u1EE3ng"),u(),s(58,"mat-form-field",38)(59,"input",39),gt("ngModelChange",function(o){return C(a),dt(n.pageSize,o)||(n.pageSize=o),b(o)}),u()(),s(60,"button",40),T("click",function(){C(a);let o=N(54);return b(n.onPageSizeChange(n.pageSize,o))}),m(61,"\xC1p D\u1EE5ng"),u()()(),s(62,"div",41)(63,"button",42),T("click",function(){return C(a),b(n.onPreviousPage())}),s(64,"mat-icon"),m(65,"keyboard_arrow_left"),u()(),s(66,"button",42),T("click",function(){return C(a),b(n.onNextPage())}),s(67,"mat-icon"),m(68,"keyboard_arrow_right"),u()()()()()()()(),I(69,Fn,11,0,"ng-template",null,5,_t)}if(e&2){let a=N(16),r=N(54);p(),v("position","end"),p(11),v("matMenuTriggerFor",a),p(11),et(n.FilterColumns),p(8),S(" ",n.TonghopsFinal.length>0?n.TonghopsFinal.length:n.Listsanpham().length," S\u1EA3n Ph\u1EA9m "),p(2),v("dataSource",n.dataSource),p(),et(n.displayedColumns),p(2),v("matHeaderRowDef",n.displayedColumns)("matHeaderRowDefSticky",!0),p(),v("matRowDefColumns",n.displayedColumns),p(7),F((n.currentPage-1)*n.pageSize+1),p(3),F(n.currentPage*n.pageSize>n.totalItems?n.totalItems:n.currentPage*n.pageSize),p(),ht(" trong s\u1ED1 ",n.totalItems," m\u1EE5c, ",n.currentPage,"/",n.totalPages," Trang"),p(2),v("matMenuTriggerFor",r),p(2),S("Hi\u1EC7n Th\u1ECB : ",n.pageSize," m\u1EE5c"),p(7),pt("ngModel",n.pageSize),v("ngModelOptions",ft(18,Be)),p(4),v("disabled",n.currentPage===1),p(3),v("disabled",n.currentPage===n.totalPages)}},dependencies:[Xt,jt,Jt,Zt,Wt,xe,le,ue,de,me,ce,ge,he,pe,fe,_e,ye,se,J,oe,re,Ut,Rt,$t,Yt,Lt,At,Ot,St,Nt,It,Pt,Et,Dt,te,Tt,Ct,bt,wt,qt,Bt,Vt,zt,ae,ne,Qt,Ht,Kt],styles:[".mat-mdc-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.mat-mdc-header-cell[_ngcontent-%COMP%]{padding:8px 12px;position:sticky;top:0;background:#f8fafc;border-bottom:2px solid #e2e8f0;font-weight:600;z-index:10}.mat-mdc-cell[_ngcontent-%COMP%]{padding:8px 12px;border-bottom:1px solid #e2e8f0;vertical-align:middle}.mat-mdc-row[_ngcontent-%COMP%]:hover{background-color:#f1f5f9;transition:background-color .2s ease}.quick-filter-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap;align-items:center}.quick-filter-button[_ngcontent-%COMP%]{padding:4px 12px;font-size:12px;min-height:32px;border-radius:16px}.quick-filter-button.active[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff}.filter-menu[_ngcontent-%COMP%]{max-width:400px}.filter-menu[_ngcontent-%COMP%]   .mat-mdc-menu-content[_ngcontent-%COMP%]{padding:0}.filter-search-input[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:14px}.filter-search-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 2px #3b82f61a}.filter-options[_ngcontent-%COMP%]{max-height:200px;overflow-y:auto}.filter-option[_ngcontent-%COMP%]{padding:8px 12px;cursor:pointer;display:flex;align-items:center;gap:8px;border-radius:4px;margin:2px 4px}.filter-option[_ngcontent-%COMP%]:hover{background-color:#f1f5f9}.filter-option.selected[_ngcontent-%COMP%]{background-color:#dbeafe;color:#1d4ed8}.column-filter-icon[_ngcontent-%COMP%]{opacity:.6;transition:opacity .2s ease;cursor:pointer}.column-filter-icon[_ngcontent-%COMP%]:hover{opacity:1;color:#3b82f6}@media (max-width: 768px){.mat-mdc-header-cell[_ngcontent-%COMP%], .mat-mdc-cell[_ngcontent-%COMP%]{padding:6px 8px;font-size:13px}.quick-filter-buttons[_ngcontent-%COMP%]{gap:4px}.quick-filter-button[_ngcontent-%COMP%]{padding:3px 8px;font-size:11px;min-height:28px}}.status-low-stock[_ngcontent-%COMP%]{color:#dc2626;font-weight:600}.status-normal-stock[_ngcontent-%COMP%]{color:#059669;font-weight:600}.status-pending[_ngcontent-%COMP%]{color:#d97706;font-weight:600}.status-suggestion[_ngcontent-%COMP%]{color:#7c3aed;font-weight:600}.mat-mdc-row[_ngcontent-%COMP%]{transition:all .2s ease}.mat-mdc-row.filtered-out[_ngcontent-%COMP%]{opacity:.5;transform:scale(.98)}.search-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.search-icon[_ngcontent-%COMP%]{position:absolute;left:12px;color:#6b7280;z-index:1}.search-input[_ngcontent-%COMP%]{padding-left:40px}.pagination-info[_ngcontent-%COMP%]{font-size:14px;color:#6b7280}.pagination-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 4px}.filter-badge[_ngcontent-%COMP%]{position:absolute;top:-2px;right:-2px;background:#dc2626;color:#fff;border-radius:50%;width:16px;height:16px;font-size:10px;display:flex;align-items:center;justify-content:center}.filter-options[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.filter-options[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.filter-options[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.filter-options[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}"]})};Z([Fe(300)],R.prototype,"doFilterHederColumn",1),Z([Fe(300)],R.prototype,"applyAdvancedColumnFilter",1);var ve=R;function Fe(i=300){return function(t,e,n){let a=n.value,r;return n.value=function(...o){clearTimeout(r),r=setTimeout(()=>{a.apply(this,o)},i)},n}}export{ve as NhucaudathangComponent};
