import './polyfills.server.mjs';
import{a as w}from"./chunk-DMCBUJS2.mjs";import{d as f}from"./chunk-BH2HSQOL.mjs";import{a as S}from"./chunk-5Z34U3BE.mjs";import{a as s}from"./chunk-6EFOJMAD.mjs";import{Ra as g,ja as m,oa as u}from"./chunk-J2JCPQ23.mjs";import{a as c,j as r}from"./chunk-RIAI3ORJ.mjs";var T=class y{constructor(n,t,e){this._StorageService=n;this.router=t;this.timezoneService=e}ListDonhang=g([]);DetailDonhang=g({});page=g(1);pageCount=g(1);total=g(0);pageSize=g(50);donhangId=g(null);setDonhangId(n){this.donhangId.set(n)}ImportDonhangCu(n){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(n)},e=yield fetch(`${s.APIURL}/donhang/importold`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let o=yield e.json();return o.status==="duplicates_found"?{needsConfirmation:!0,message:o.message,duplicates:o.duplicates,pendingOrders:o.pendingOrders,processResults:o.processResults}:o}catch(t){throw console.error("Error in ImportDonhangCu:",t),t}})}ImportDonhangCuConfirmed(n,t){return r(this,null,function*(){try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify({pendingOrders:n,userChoice:t})},o=yield fetch(`${s.APIURL}/donhang/importold/confirmed`,e);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let a=yield o.json();return a.status==="completed"&&a.success>0,a}catch(e){throw console.error("Error in ImportDonhangCuConfirmed:",e),e}})}ImportDonhang(n){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(n)},e=yield fetch(`${s.APIURL}/donhang/import`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let o=yield e.json();return this.donhangId.set(o.id),o}catch(t){return console.error(t)}})}DongboGia(n){return r(this,null,function*(){let t=n.map(e=>e.id);if(t.length===0)return{status:"error",message:"Kh\xF4ng c\xF3 \u0111\u01A1n h\xE0ng n\xE0o \u0111\u01B0\u1EE3c ch\u1ECDn \u0111\u1EC3 \u0111\u1ED3ng b\u1ED9 gi\xE1"};try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},o=yield fetch(`${s.APIURL}/donhang/dongbogia`,e);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return yield o.json()}catch(e){return console.error("L\u1ED7i khi \u0111\u1ED3ng b\u1ED9 gi\xE1:",e),{status:"error",message:e.message||"L\u1ED7i khi \u0111\u1ED3ng b\u1ED9 gi\xE1 t\u1EEB server"}}})}CreateDonhang(n){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(n)},e=yield fetch(`${s.APIURL}/donhang`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let o=yield e.json();this.donhangId.set(o.id);let a=this.ListDonhang();return Array.isArray(a)&&this.ListDonhang.set([o,...a]),o}catch(t){throw console.error("Error in CreateDonhang:",t),t}})}DagiaoDonhang(n){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(n)},e=yield fetch(`${s.APIURL}/donhang/${n.id}/dagiao`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let o=yield e.json();e.ok,console.log(o)}catch(t){return console.error(t)}})}getSLChogiao(n){return r(this,null,function*(){let t=c({},n);if(t.Batdau||t.Ketthuc){let e=this.timezoneService.getAPIDateRange(t.Batdau,t.Ketthuc);t.Batdau=e.Batdau,t.Ketthuc=e.Ketthuc}try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},o=yield fetch(`${s.APIURL}/donhang/getchogiao`,e);o.ok;let a=yield o.json();return this.ListDonhang.set(a.data),this.page.set(a.pageNumber),this.pageCount.set(a.totalPages),this.total.set(a.total),this.pageSize.set(a.pageSize),a}catch(e){return console.error(e)}})}searchDonhang(n){return r(this,null,function*(){let t=c({},n);if(t.Batdau||t.Ketthuc){let e=this.timezoneService.getAPIDateRange(t.Batdau,t.Ketthuc);t.Batdau=e.Batdau,t.Ketthuc=e.Ketthuc}try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},o=yield fetch(`${s.APIURL}/donhang/search`,e);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let a=yield o.json();return Array.isArray(a.data)?this.ListDonhang.set(a.data):(console.error("searchDonhang: data.data is not an array:",a.data),this.ListDonhang.set([])),this.page.set(a.pageNumber||1),this.pageCount.set(a.totalPages||0),this.total.set(a.total||0),this.pageSize.set(a.pageSize||50),a}catch(e){return console.error("Error in searchDonhang:",e),this.ListDonhang.set([]),{data:[],pageNumber:1,totalPages:0,total:0,pageSize:50}}})}searchCongno(n){return r(this,null,function*(){let t=c({},n);if(t.Batdau||t.Ketthuc){let e=this.timezoneService.getAPIDateRange(t.Batdau,t.Ketthuc);t.Batdau=e.Batdau,t.Ketthuc=e.Ketthuc}try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},o=yield fetch(`${s.APIURL}/donhang/congnokhachhang`,e);o.ok;let a=yield o.json();return this.ListDonhang.set(a),a}catch(e){return console.error(e)}})}downloadCongno(n){return r(this,null,function*(){let t=c({},n);if(t.Batdau||t.Ketthuc){let e=this.timezoneService.getAPIDateRange(t.Batdau,t.Ketthuc);t.Batdau=e.Batdau,t.Ketthuc=e.Ketthuc}try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},o=yield fetch(`${s.APIURL}/donhang/downloadcongnokhachhang`,e);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let a=o.headers.get("Content-Disposition"),i="CongNoKhachHang.xlsx";if(a){let l=a.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);l&&l[1]&&(i=l[1].replace(/['"]/g,""))}let h=yield o.blob(),p=window.URL.createObjectURL(h),d=document.createElement("a");return d.style.display="none",d.href=p,d.download=i,document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(p),document.body.removeChild(d),{success:!0,filename:i}}catch(e){throw console.error("Error downloading congno:",e),e}})}Phieuchuyen(n){return r(this,null,function*(){let t=c({},n);if(t.Batdau||t.Ketthuc){let e=this.timezoneService.getAPIDateRange(t.Batdau,t.Ketthuc);t.Batdau=e.Batdau,t.Ketthuc=e.Ketthuc}try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},o=yield fetch(`${s.APIURL}/donhang/phieuchuyen`,e);o.ok;let a=yield o.json();this.ListDonhang.set(a)}catch(e){return console.error(e)}})}Phieugiaohang(n){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(n)},e=yield fetch(`${s.APIURL}/donhang/phieugiao`,t);e.ok;let o=yield e.json();this.DetailDonhang.set(o)}catch(t){return console.error(t)}})}findbysanpham(n){return r(this,null,function*(){try{let t={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")}},e=yield fetch(`${s.APIURL}/donhang/findbysanpham/${n}`,t);return e.ok,yield e.json()}catch(t){return console.error(t)}})}getAllDonhang(){return r(this,null,function*(){console.warn("getAllDonhang() is deprecated. Use searchDonhang() instead.");try{yield this.searchDonhang({pageSize:999999,Type:"all"})}catch(n){console.error("Error in getAllDonhang:",n),Array.isArray(this.ListDonhang())||this.ListDonhang.set([])}})}getDonhangByid(n){return r(this,null,function*(){try{let t={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")}},e=yield fetch(`${s.APIURL}/donhang/findid/${n}`,t);e.ok;let o=yield e.json();this.DetailDonhang.set(o)}catch(t){return console.error(t)}})}updateDonhang(n){return r(this,null,function*(){try{let t={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(n)},e=yield fetch(`${s.APIURL}/donhang/${n.id}`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let o=yield e.json(),a=this.ListDonhang();if(Array.isArray(a)){let i=a.findIndex(h=>h.id===n.id);i!==-1&&(a[i]=c(c({},a[i]),o),this.ListDonhang.set([...a]))}return this.getDonhangByid(n.id),o}catch(t){return console.error(t)}})}updatePhieugiao(n){return r(this,null,function*(){try{let t={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(n)},e=yield fetch(`${s.APIURL}/donhang/phieugiao/${n.id}`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let o=yield e.json();e.ok,this.Phieugiaohang({id:n.id})}catch(t){return console.error(t)}})}DeleteDonhang(n){return r(this,null,function*(){try{let t={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")}};(yield fetch(`${s.APIURL}/donhang/${n.id}`,t)).ok}catch(t){return console.error(t)}})}UpdateBulkDonhang(n){return r(this,null,function*(){try{let t={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(n)},e=yield fetch(`${s.APIURL}/donhang/bulk`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return yield e.json()}catch(t){throw console.error("Error in UpdateBulkDonhang:",t),t}})}DeleteBulkDonhang(n){return r(this,null,function*(){try{let t={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(n)},e=yield fetch(`${s.APIURL}/donhang/bulk`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return yield e.json()}catch(t){throw console.error("Error in DeleteBulkDonhang:",t),t}})}SearchField(n){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(n)},e=yield fetch(`${s.APIURL}/donhang/searchfield`,t);e.ok;let o=yield e.json();return this.DetailDonhang.set(o),o}catch(t){return console.error(t)}})}cancelDonhang(n,t){return r(this,null,function*(){try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify({lydohuy:t})},o=yield fetch(`${s.APIURL}/orders/donhang/${n}/cancel`,e);if(!o.ok){let h=yield o.json();throw new Error(h.message||`HTTP error! status: ${o.status}`)}let a=yield o.json(),i=this.ListDonhang();if(Array.isArray(i)){let h=i.findIndex(p=>p.id===n);h!==-1&&(i[h]=c(c({},i[h]),a),this.ListDonhang.set([...i]))}return a}catch(e){throw console.error("L\u1ED7i khi h\u1EE7y \u0111\u01A1n h\xE0ng:",e),e}})}static \u0275fac=function(t){return new(t||y)(u(S),u(f),u(w))};static \u0275prov=m({token:y,factory:y.\u0275fac,providedIn:"root"})};export{T as a};
