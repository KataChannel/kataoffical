{
  "version": 3,
  "sources": ["src/app/admin/nhacungcap/nhacungcap.service.ts"],
  "sourcesContent": ["import { inject, Injectable, signal, Signal } from '@angular/core';\nimport { environment } from '../../../environments/environment.development';\nimport { StorageService } from '../../shared/utils/storage.service';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { SharedSocketService } from '../../shared/services/sharedsocket.service';\nimport { openDB } from 'idb';\n@Injectable({\n  providedIn: 'root'\n})\nexport class NhacungcapService {\n  private socket: any;\n  constructor(\n    private _StorageService: StorageService,\n    private _sharedSocketService: SharedSocketService,\n  ) {\n    this.socket = this._sharedSocketService.getSocket();\n  }\n\n  private _snackBar: MatSnackBar = inject(MatSnackBar);\n  ListNhacungcap = signal<any[]>([]);\n  DetailNhacungcap = signal<any>({});\n  page = signal<number>(1);\n  totalPages = signal<number>(1);\n  total = signal<number>(0);\n  pageSize = signal<number>(50); // Mặc định 50 mục mỗi trang\n  nhacungcapId = signal<string | null>(null);\n\n\n  setNhacungcapId(id: string | null) {\n    this.nhacungcapId.set(id);\n  }\n  async ImportNhacungcap(dulieu: any) {\n    try {\n      const options = {\n          method:'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(dulieu),\n        };\n        const response = await fetch(`${environment.APIURL}/nhacungcap/import`, options);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        if (!response.ok) {\n          this.handleError(response.status);\n          return;\n        }\n        this.getAllNhacungcap()\n    } catch (error) {\n        return console.error(error);\n    }\n  }\n\n    async Findbyids(dulieu: any) {\n    try {\n      const options = {\n          method:'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(dulieu),\n        };\n        const response = await fetch(`${environment.APIURL}/nhacungcap/finbyids`, options);\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const data = await response.json();\n        if (!response.ok) {\n          this.handleError(response.status);\n          return;\n        }\n       return data.data\n    } catch (error) {\n        return console.error(error);\n    }\n  }\n\n\n  async CreateNhacungcap(dulieu: any) {\n    try {\n      const options = {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this._StorageService.getItem('token')}`\n        },\n        body: JSON.stringify(dulieu),\n      };\n      const response = await fetch(`${environment.APIURL}/nhacungcap`, options);\n      if (!response.ok) {\n        this.handleError(response.status);\n        return;\n      }\n      const data = await response.json();\n      this.getAllNhacungcap();\n      console.log(data);\n      \n      this.nhacungcapId.set(data.id);\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async getAllNhacungcap(queryParams: any = {}, forceRefresh: boolean = false) {\n    try {\n      const options = {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this._StorageService.getItem('token')}`\n        },\n      };\n\n      queryParams = {\n        page: this.page().toString(),\n        pageSize: this.pageSize().toString(),\n        ...queryParams, // Thêm các tham số khác nếu cần\n      };\n      // Tạo query string từ queryParams, chỉ thêm các giá trị có nội dung\n      const query = new URLSearchParams();\n      Object.entries(queryParams).forEach(([key, value]) => {\n        if (value) {\n          query.append(key, String(value));\n        }\n      });\n\n      // Nếu forceRefresh = true thì bỏ qua cache và tải dữ liệu mới luôn\n      const response = await fetch(`${environment.APIURL}/nhacungcap?${query}`, options);\n      if (!response.ok) {\n        this.handleError(response.status);\n      }\n      // Lưu dữ liệu mới vào cache\n      const data = await response.json();\n      // Cập nhật thời gian cache: với forceRefresh, sử dụng thời gian hiện tại\n      this.ListNhacungcap.set(data.data);\n      this.page.set(data.page || 1);\n      this.totalPages.set(data.totalPages || 1);\n      this.total.set(data.total || data.data.length);\n      this.pageSize.set(this.pageSize());\n      return data.data;\n\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async getUpdatedCodeIds() {\n    try {\n      const options = {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this._StorageService.getItem('token')}`\n        },\n      };\n      const response = await fetch(`${environment.APIURL}/nhacungcap/updateCodeIds`, options);\n      if (!response.ok) {\n        this.handleError(response.status);\n      }\n      const data = await response.json();\n      this.getAllNhacungcap(this.pageSize());\n      return data.data;\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async getNhacungcapBy(param: any, pageSize: number = this.pageSize()) {\n    this.pageSize.set(pageSize); // Cập nhật pageSize\n    try {\n      const options = {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this._StorageService.getItem('token')}`\n        },\n        body: JSON.stringify({ ...param, page: this.page()}),\n      };\n      const response = await fetch(`${environment.APIURL}/nhacungcap/findby`, options);\n      if (!response.ok) {\n        this.handleError(response.status);\n      }\n      const data = await response.json();\n      if (param.isOne === true) {\n        this.DetailNhacungcap.set(data);\n      } else {\n        this.ListNhacungcap.set(data.data);\n        this.page.set(data.page || 1);\n        this.totalPages.set(data.totalPages || 1);\n        this.total.set(data.total || data.data.length);\n        this.pageSize.set(pageSize);\n      }\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async updateNhacungcap(dulieu: any) {\n    try {\n      const options = {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this._StorageService.getItem('token')}`\n        },\n        body: JSON.stringify(dulieu),\n      };\n      const response = await fetch(`${environment.APIURL}/nhacungcap/${dulieu.id}`, options);\n      if (!response.ok) {\n        this.handleError(response.status);\n      }\n      const data = await response.json();\n      this.getAllNhacungcap(this.pageSize());\n      this.getNhacungcapBy({ id: data.id, isOne: true }, this.pageSize());\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async DeleteNhacungcap(item: any) {\n    try {\n      const options = {\n        method: 'DELETE',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this._StorageService.getItem('token')}`\n        },\n      };\n      const response = await fetch(`${environment.APIURL}/nhacungcap/${item.id}`, options);\n      if (!response.ok) {\n        this.handleError(response.status);\n      }\n      this.getAllNhacungcap(this.pageSize());\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  private handleError(status: number): void {\n    console.log(`Error: ${status}`);\n    \n    let message = 'Lỗi không xác định';\n    let panelClass = 'snackbar-error';\n    switch (status) {\n      case 400:\n        message = 'Thông tin đã tồn tại hoặc không hợp lệ';\n        break;\n      case 401:\n        message = 'Phiên đăng nhập đã hết hạn, vui lòng đăng nhập lại';\n        break;\n      case 403:\n        message = 'Bạn không có quyền thực hiện thao tác này';\n        break;\n      case 404:\n        message = 'Không tìm thấy dữ liệu yêu cầu';\n        break;\n      case 422:\n        message = 'Dữ liệu không hợp lệ';\n        break;\n      case 500:\n        message = 'Lỗi máy chủ, vui lòng thử lại sau';\n        break;\n      case 503:\n        message = 'Dịch vụ tạm thời không khả dụng';\n        break;\n      default:\n        message = `Lỗi HTTP ${status}`;\n    }\n\n    this._snackBar.open(message, 'Đóng', {\n      duration: 4000,\n      horizontalPosition: 'end',\n      verticalPosition: 'top',\n      panelClass: [panelClass],\n    });\n  }\n}"],
  "mappings": "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",
  "names": []
}
