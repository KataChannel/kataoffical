import './polyfills.server.mjs';
import{b as O}from"./chunk-NBZWX5Q6.mjs";import{B as A,a as I,c as m,l as y,n as D,u as T,w as S,x as E}from"./chunk-KFOBXJYA.mjs";import{j as h}from"./chunk-RIAI3ORJ.mjs";var q=new Map,V={activated:!1,tokenObservers:[]},G={initialized:!1,enabled:!1};function c(e){return q.get(e)||Object.assign({},V)}function $(){return G}var X="https://content-firebaseappcheck.googleapis.com/v1";var Y="exchangeDebugToken",N={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},ye=24*60*60*1e3;var _=class{constructor(n,t,r,o,i){if(this.operation=n,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=o,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=o,o>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(n){return h(this,null,function*(){this.stop();try{this.pending=new m,this.pending.promise.catch(t=>{}),yield J(this.getNextRun(n)),this.pending.resolve(),yield this.pending.promise,this.pending=new m,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(n){if(n)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function J(e){return new Promise(n=>{setTimeout(n,e)})}var Z={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},f=new D("appCheck","AppCheck",Z);function F(e){if(!c(e).activated)throw f.create("use-before-activation",{appName:e.name})}function K(r,o){return h(this,arguments,function*({url:e,body:n},t){let i={"Content-Type":"application/json"},l=t.getImmediate({optional:!0});if(l){let u=yield l.getHeartbeatsHeader();u&&(i["X-Firebase-Client"]=u)}let a={method:"POST",body:JSON.stringify(n),headers:i},s;try{s=yield fetch(e,a)}catch(u){throw f.create("fetch-network-error",{originalErrorMessage:u?.message})}if(s.status!==200)throw f.create("fetch-status-error",{httpStatus:s.status});let d;try{d=yield s.json()}catch(u){throw f.create("fetch-parse-error",{originalErrorMessage:u?.message})}let g=d.ttl.match(/^([\d.]+)(s)$/);if(!g||!g[2]||isNaN(Number(g[1])))throw f.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});let W=Number(g[1])*1e3,R=Date.now();return{token:d.token,expireTimeMillis:R+W,issuedAtTimeMillis:R}})}function L(e,n){let{projectId:t,appId:r,apiKey:o}=e.options;return{url:`${X}/projects/${t}/apps/${r}:${Y}?key=${o}`,body:{debug_token:n}}}var Q="firebase-app-check-database",ee=1,v="firebase-app-check-store";var k=null;function te(){return k||(k=new Promise((e,n)=>{try{let t=indexedDB.open(Q,ee);t.onsuccess=r=>{e(r.target.result)},t.onerror=r=>{var o;n(f.create("storage-open",{originalErrorMessage:(o=r.target.error)===null||o===void 0?void 0:o.message}))},t.onupgradeneeded=r=>{let o=r.target.result;switch(r.oldVersion){case 0:o.createObjectStore(v,{keyPath:"compositeKey"})}}}catch(t){n(f.create("storage-open",{originalErrorMessage:t?.message}))}}),k)}function re(e,n){return ne(oe(e),n)}function ne(e,n){return h(this,null,function*(){let r=(yield te()).transaction(v,"readwrite"),i=r.objectStore(v).put({compositeKey:e,value:n});return new Promise((l,a)=>{i.onsuccess=s=>{l()},r.onerror=s=>{var d;a(f.create("storage-set",{originalErrorMessage:(d=s.target.error)===null||d===void 0?void 0:d.message}))}})})}function oe(e){return`${e.options.appId}-${e.name}`}var b=new S("@firebase/app-check");function w(e,n){return y()?re(e,n).catch(t=>{b.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function B(){return $().enabled}function z(){return h(this,null,function*(){let e=$();if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var ie={error:"UNKNOWN_ERROR"};function se(e){return I.encodeString(JSON.stringify(e),!1)}function C(e,n=!1){return h(this,null,function*(){let t=e.app;F(t);let r=c(t),o=r.token,i;if(o&&!p(o)&&(r.token=void 0,o=void 0),!o){let s=yield r.cachedTokenPromise;s&&(p(s)?o=s:yield w(t,void 0))}if(!n&&o&&p(o))return{token:o.token};let l=!1;if(B()){r.exchangeTokenPromise||(r.exchangeTokenPromise=K(L(t,yield z()),e.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),l=!0);let s=yield r.exchangeTokenPromise;return yield w(t,s),r.token=s,{token:s.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),l=!0),o=yield c(t).exchangeTokenPromise}catch(s){s.code==="appCheck/throttled"?b.warn(s.message):b.error(s),i=s}let a;return o?i?p(o)?a={token:o.token,internalError:i}:a=x(i):(a={token:o.token},r.token=o,yield w(t,o)):a=x(i),l&&ue(t,a),a})}function ae(e){return h(this,null,function*(){let n=e.app;F(n);let{provider:t}=c(n);if(B()){let r=yield z(),{token:o}=yield K(L(n,r),e.heartbeatServiceProvider);return{token:o}}else{let{token:r}=yield t.getToken();return{token:r}}})}function ce(e,n,t,r){let{app:o}=e,i=c(o),l={next:t,error:r,type:n};if(i.tokenObservers=[...i.tokenObservers,l],i.token&&p(i.token)){let a=i.token;Promise.resolve().then(()=>{t({token:a.token}),M(e)}).catch(()=>{})}i.cachedTokenPromise.then(()=>M(e))}function j(e,n){let t=c(e),r=t.tokenObservers.filter(o=>o.next!==n);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function M(e){let{app:n}=e,t=c(n),r=t.tokenRefresher;r||(r=le(e),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function le(e){let{app:n}=e;return new _(()=>h(this,null,function*(){let t=c(n),r;if(t.token?r=yield C(e,!0):r=yield C(e),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=c(n);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,o=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,o),Math.max(0,r-Date.now())}else return 0},N.RETRIAL_MIN_WAIT,N.RETRIAL_MAX_WAIT)}function ue(e,n){let t=c(e).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&n.error!=null?r.error(n.error):r.next(n)}catch{}}function p(e){return e.expireTimeMillis-Date.now()>0}function x(e){return{token:se(ie),error:e}}var P=class{constructor(n,t){this.app=n,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:n}=c(this.app);for(let t of n)j(this.app,t.next);return Promise.resolve()}};function de(e,n){return new P(e,n)}function he(e){return{getToken:n=>C(e,n),getLimitedUseToken:()=>ae(e),addTokenListener:n=>ce(e,"INTERNAL",n),removeTokenListener:n=>j(e.app,n)}}var fe="@firebase/app-check",pe="0.8.11";var ge="app-check",H="app-check-internal";function ke(){E(new T(ge,e=>{let n=e.getProvider("app").getImmediate(),t=e.getProvider("heartbeat");return de(n,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,t)=>{e.getProvider(H).initialize()})),E(new T(H,e=>{let n=e.getProvider("app-check").getImmediate();return he(n)},"PUBLIC").setInstantiationMode("EXPLICIT")),A(fe,pe)}ke();var me="app-check";var U=class{constructor(){return O(me)}};var Te=["localhost","0.0.0.0","127.0.0.1"],qe=typeof window<"u"&&Te.includes(window.location.hostname);export{U as a};
