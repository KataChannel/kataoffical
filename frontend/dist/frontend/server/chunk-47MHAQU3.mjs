import './polyfills.server.mjs';
import{a as La}from"./chunk-EHIOJ53Q.mjs";import{a as Sa}from"./chunk-SOMYOCLA.mjs";import{a as ua}from"./chunk-2NXSQI6I.mjs";import{a as pa}from"./chunk-IGWB5VBO.mjs";import{a as da}from"./chunk-ZTR7BXUL.mjs";import{a as ya}from"./chunk-3ELWWSJR.mjs";import{a as fa}from"./chunk-4NNV6NE3.mjs";import{a as ca,g as la,h as k}from"./chunk-BM52I7TD.mjs";import{a as ma}from"./chunk-WJ2ZWVTC.mjs";import{b as ea,c as sa,d as ha,e as ra,g as oa,s as ga}from"./chunk-PE5EYNGJ.mjs";import{c as U,h as Z}from"./chunk-26WWJ5GO.mjs";import{c as z}from"./chunk-ZA5LSI2B.mjs";import{b as ia}from"./chunk-AL3ZCZTD.mjs";import{a as na}from"./chunk-KPN7Z3NE.mjs";import{a as Ma}from"./chunk-MGIVCIKU.mjs";import{d as J}from"./chunk-NCVHCAMC.mjs";import{a as $,b as X}from"./chunk-Q2K4SCD6.mjs";import{n as W,v as aa,y as ta}from"./chunk-IQUZIOHZ.mjs";import{a as Q}from"./chunk-KOBSONV6.mjs";import{a as j,e as q}from"./chunk-6HDYPSHY.mjs";import{y as R}from"./chunk-D22ASRXW.mjs";import{d as V}from"./chunk-2ATDIMG4.mjs";import{n as G,o as F,v as O}from"./chunk-6BL7Z2F4.mjs";import{Ac as _,Bc as w,Cc as D,Gb as N,Gc as K,Hc as p,Ic as H,Nb as x,Ra as M,Zb as B,bc as A,hc as c,ic as l,nc as T,oa as g,sc as L,tb as b,uc as P,ud as Y,xa as f,ya as S}from"./chunk-GWTCN232.mjs";import{a as I,b as v,g as Ia,j as y}from"./chunk-RIAI3ORJ.mjs";var o=Ia(Ma());var xa=["drawer"];function Ba(u,i){u&1&&(c(0,"mat-icon"),p(1,"check"),l())}function Ta(u,i){if(u&1){let n=T();c(0,"span",8),L("click",function(){let e=f(n).$implicit,s=P();return S(s.toggleItem(e))}),x(1,Ba,2,0,"mat-icon",9),c(2,"span"),p(3),l()()}if(u&2){let n=i.$implicit,a=P();A("",a.CheckItem(n)?"bg-blue-100":""," cursor-pointer flex flex-row space-x-2 items-center p-4 rounded-lg border"),b(),B("ngIf",a.CheckItem(n)),b(2),H(n.title)}}var ka=class u{displayedColumns=[];ColumnName={stt:"#",codeId:"Code",name:"Ti\xEAu \u0110\u1EC1",group:"Nh\xF3m",description:"M\xF4 T\u1EA3",status:"Tr\u1EA1ng Th\xE1i",order:"Th\u1EE9 T\u1EF1",createdAt:"Ng\xE0y T\u1EA1o",updatedAt:"Ng\xE0y C\u1EADp Nh\u1EADt"};FilterColumns=JSON.parse(localStorage.getItem("ImportdataColFilter")||"[]");Columns=[];paginator;sort;drawer;_BanggiaService=g(pa);_SanphamService=g(fa);_KhachhangService=g(da);_NhacungcapService=g(ya);_DonhangService=g(na);_DathangService=g(ua);_PhieukhoService=g(Sa);_KhoService=g(La);_breakpointObserver=g(R);_GoogleSheetService=g(ma);_router=g(V);_dialog=g(U);_snackBar=g(Q);ListImportdata=M([{id:1,title:"S\u1EA3n Ph\u1EA9m",value:"sanpham",status:!0},{id:2,title:"Kh\xE1ch H\xE0ng",value:"khachhang",status:!0},{id:3,title:"Nh\xE0 Cung C\u1EA5p",value:"nhacungcap",status:!0},{id:4,title:"B\u1EA3ng Gi\xE1",value:"banggia",status:!0},{id:5,title:"\u0110\u01A1n H\xE0ng",value:"donhang",status:!0},{id:6,title:"\u0110\u1EB7t H\xE0ng",value:"dathang",status:!0},{id:7,title:"B\u1EA3ng Gi\xE1 Kh\xE1ch H\xE0ng",value:"banggiakhachhang",status:!0},{id:8,title:"B\u1EA3ng Gi\xE1 S\u1EA3n Ph\u1EA9m",value:"banggiasanpham",status:!0},{id:9,title:"Nh\xE0 Cung C\u1EA5p S\u1EA3n Ph\u1EA9m",value:"nhacungcapsanpham",status:!0},{id:10,title:"Xu\u1EA5t Nh\u1EADp T\u1ED3n",value:"xuatnhapton",status:!0}]);ListEdit=M([]);TitleExport="export";rawListSP=[];rawListKH=[];rawListNCC=[];rawListBG=[];rawListDH=[];rawListDathang=[];rawListTonkho=[];constructor(){Y(()=>y(this,null,function*(){yield this._SanphamService.getAllSanpham(),this.rawListSP=this._SanphamService.ListSanpham(),yield this._KhachhangService.getAllKhachhang(),this.rawListKH=this._KhachhangService.ListKhachhang(),yield this._NhacungcapService.getAllNhacungcap(),this.rawListNCC=this._NhacungcapService.ListNhacungcap(),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),yield this._DonhangService.getAllDonhang(),this.rawListDH=this._DonhangService.ListDonhang(),yield this._DathangService.getAllDathang(),this.rawListDathang=this._DathangService.ListDathang(),yield this._KhoService.getTonKho("1","1000").then(i=>{this.rawListTonkho=i.data})}))}ngOnInit(){return y(this,null,function*(){yield this._SanphamService.getAllSanpham(),this.rawListSP=this._SanphamService.ListSanpham(),yield this._KhachhangService.getAllKhachhang(),this.rawListKH=this._KhachhangService.ListKhachhang(),yield this._NhacungcapService.getAllNhacungcap(),this.rawListNCC=this._NhacungcapService.ListNhacungcap(),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),yield this._DonhangService.getAllDonhang(),this.rawListDH=this._DonhangService.ListDonhang(),yield this._DathangService.getAllDathang(),this.rawListDathang=this._DathangService.ListDathang(),yield this._KhoService.getTonKho("1","1000").then(i=>{this.rawListTonkho=i.data})})}applyFilter(i){}toggleAll(){this.ListEdit().length===this.ListImportdata().length?(this.ListEdit.set([]),this.TitleExport="export"):(this.ListEdit.set(this.ListImportdata()),this.TitleExport="export_all")}toggleItem(i){this.ListEdit().findIndex(a=>a.id===i.id)===-1?(this.TitleExport+="_"+i.value,this.ListEdit.update(a=>[...a,i])):(this.TitleExport=this.TitleExport.replace("_"+i.value,""),this.ListEdit.update(a=>a.filter(e=>e.id!==i.id)))}CheckItem(i){return this.ListEdit().findIndex(a=>a.id===i.id)!==-1}ExportExcel(i){return y(this,null,function*(){let n=Array.isArray(this.rawListSP)&&this.rawListSP.length?this.rawListSP.map(t=>({masp:t.masp,subtitle:t.subtitle,title:t.title,title2:t.title2,giaban:t.giaban,giagoc:t.giagoc,dvt:t.dvt,haohut:t.haohut,ghichu:t.ghichu})):[{masp:"",subtitle:"",title:"",title2:"",giaban:"",giagoc:"",dvt:"",haohut:"",ghichu:""}],a=Array.isArray(this.rawListKH)&&this.rawListKH.length?this.rawListKH.map(t=>({name:t.name?.trim()||"",makh:t.makh?.trim()||"",namenn:t.namenn?.trim()||"",diachi:t.diachi?.trim()||"",quan:t.quan?.trim()||"",email:t.email?.trim()||"",sdt:t.sdt?.toString().trim()||"",mst:t.mst?.toString().trim()||"",gionhanhang:t.gionhanhang?.toString().trim()||"",loaikh:t.loaikh?.toString().trim()||"khachsi",hiengia:t.hiengia||!0,ghichu:t.ghichu?.toString().trim()||""})):[{name:"",makh:"",namenn:"",diachi:"",quan:"",email:"",sdt:"",mst:"",gionhanhang:"",loaikh:"khachsi",hiengia:!0,ghichu:""}],e=Array.isArray(this.rawListNCC)&&this.rawListNCC.length>0?this.rawListNCC.map(t=>({name:t.name?.trim()||"",mancc:t.mancc?.trim()||"",diachi:t.diachi?.trim()||"",email:t.email?.trim()||"",sdt:t.sdt?.toString().trim()||"",ghichu:t.ghichu?.toString().trim()||""})):[{name:"",mancc:"",diachi:"",email:"",sdt:"",ghichu:""}],s=Array.isArray(this.rawListBG)&&this.rawListBG.length>0?this.rawListBG.map(t=>({title:t.title?.trim()||"",mabanggia:t.mabanggia?.trim()||"",type:t.type?.trim()||"",batdau:t.batdau?.trim()||"",ketthuc:t.ketthuc?.trim()||"",ghichu:t.ghichu?.trim()||"",status:t.status?.trim()||""})):[{title:"",mabanggia:"",type:"",batdau:"",ketthuc:"",ghichu:"",status:""}],r=Array.isArray(this.rawListDH)&&this.rawListDH.length>0?this.rawListDH.flatMap(t=>Array.isArray(t.sanpham)?t.sanpham.map(h=>({ngaygiao:(0,o.default)(t.ngaygiao).format("DD/MM/YYYY"),makh:t.khachhang?.makh,name:t.khachhang?.name,mabanggia:t.khachhang?.banggia?.[0]?.mabanggia,masp:h.masp,tensp:h.title,sldat:h.sldat,slgiao:h.slgiao,slnhan:h.slnhan,ghichu:h.ghichu})):[]):[{ngaygiao:(0,o.default)().format("DD/MM/YYYY"),makh:"",mabanggia:"",masp:"",tensp:"",sldat:0,slgiao:0,slnhan:0,ghichu:""}],ba=Array.isArray(this.rawListDathang)&&this.rawListDathang.length>0?this.rawListDathang.flatMap(t=>Array.isArray(t.sanpham)?t.sanpham.map(h=>({ngaynhan:(0,o.default)(t.ngaynhan).format("DD/MM/YYYY"),mancc:t.nhacungcap?.mancc,name:t.nhacungcap?.name,mabanggia:t.banggia?.[0]?.mabanggia,masp:h.masp,tensp:h.title,sldat:h.sldat,slgiao:h.slgiao,slnhan:h.slnhan,ghichu:h.ghichu})):[]):[{ngaynhan:(0,o.default)().format("DD/MM/YYYY"),mancc:"",name:"",mabanggia:"",masp:"",tensp:"",sldat:0,slgiao:0,slnhan:0,ghichu:""}],_a=this.convertBGSPToExport(this.rawListBG,this.rawListSP),wa=this.rawListKH.map(t=>{let h={makh:t.makh||"",name:t.name||""};for(let d of this.rawListBG){let C=t.banggia?.some(E=>E.mabanggia===d.mabanggia);h[d.mabanggia]=C?d.mabanggia:""}return h}),Da=this.rawListSP.reduce((t,h)=>(h&&h.masp&&(t[h.masp]=""),t),{}),Ca=this.rawListNCC.map(t=>{let h={mancc:t.mancc||"",name:t.name||""};for(let d of Object.keys(Da)){let C=t.Sanpham?.some(E=>E.masp===d);h[d]=C?d:""}return h}),Ea=this.rawListTonkho.map(t=>({masp:t.masp,title:t.title,dvt:t.dvt,slton:t.slton})),m={};if(this.ListEdit().some(t=>t.value==="sanpham")&&(m.sanpham={data:n}),this.ListEdit().some(t=>t.value==="khachhang")&&(m.khachhang={data:a}),this.ListEdit().some(t=>t.value==="nhacungcap")&&(m.nhacungcap={data:e}),this.ListEdit().some(t=>t.value==="banggia")&&(m.banggia={data:s}),this.ListEdit().some(t=>t.value==="donhang")&&(m.donhang={data:r}),this.ListEdit().some(t=>t.value==="dathang")&&(m.dathang={data:ba}),this.ListEdit().some(t=>t.value==="banggiasanpham")&&(m.banggiasanpham={data:_a}),this.ListEdit().some(t=>t.value==="banggiakhachhang")&&(m.banggiakhachhang={data:wa}),this.ListEdit().some(t=>t.value==="nhacungcapsanpham")&&(m.nhacungcapsanpham={data:Ca}),this.ListEdit().some(t=>t.value==="xuatnhapton")&&(m.xuatnhapton={data:Ea}),Object.keys(m).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});return}ca(m,i)})}convertBGSPToExport(i,n){let a=new Set(i.map(e=>e.mabanggia));return n.map(e=>I({masp:e.masp,title:e.title,giaban:e.giaban.toString()},Array.from(a).reduce((s,r)=>(s[r]=e.giaban.toString(),s),{})))}convertBGSPToImport(i){return!i||i.length===0?[]:Object.keys(i[0]).filter(e=>!["masp","title","giagoc"].includes(e)).map(e=>({mabanggia:e,title:`B\u1EA3ng gi\xE1 ${e.replace("BG","")}`,sanpham:i.map(s=>({masp:s.masp,title:s.title,giagoc:s.giagoc,giaban:s[e]||0}))}))}convertBHKHToImport(i){if(!i||i.length===0)return[];let n=Object.keys(i[0]).filter(a=>!["makh","name"].includes(a));return i.forEach(a=>{console.log(a),a.banggia=[];for(let e of n)a[e]!==void 0&&a[e]!==null&&a[e]!==""&&a.banggia.push(a[e]),delete a[e]}),i}convertNCCSPToImport(i){if(!i||i.length===0)return[];let n=Object.keys(i[0]).filter(a=>!["mancc","name"].includes(a));return i.forEach(a=>{a.Sanpham=[];for(let e of n)a[e]!==void 0&&a[e]!==null&&a[e]!==""&&a.Sanpham.push(a[e]),delete a[e]}),i}ImportExcel(i){return y(this,null,function*(){let n=yield la(i);this.DoImportData(n)})}DoImportData(i){return y(this,null,function*(){if(console.log(i.dathang),Object.keys(this.ListEdit()).length===0){this._snackBar.open("Ch\u01B0a Ch\u1ECDn Lo\u1EA1i D\u1EEF Li\u1EC7u","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});return}if(Object.keys(i).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 nh\u1EADp","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]});return}if(i.sanpham&&i.sanpham.length>0&&this.ListEdit().some(n=>n.value==="sanpham")){let n=(i.sanpham||[]).map(a=>({masp:a.masp,subtitle:a.subtitle,title:a.title,title2:a.title2,giaban:a.giaban,giagoc:a.giagoc,dvt:a.dvt,haohut:a.haohut,ghichu:a.ghichu})).filter(a=>a.masp!==void 0&&a.masp!==null&&a.masp!=="");yield this._SanphamService.ImportSanpham(n)}if(i.khachhang&&i.khachhang.length>0&&this.ListEdit().some(n=>n.value==="khachhang")){let n=(i.khachhang||[]).map(a=>({name:a.name,makh:a.makh,namenn:a.namenn,diachi:a.diachi,quan:a.quan,email:a.email,sdt:a.sdt.toString(),mst:a.mst.toString(),gionhanhang:a.gionhanhang.toString(),loaikh:a.loaikh,ghichu:a.ghichu})).filter(a=>a.makh!==void 0&&a.makh!==null&&a.makh!=="");yield this._KhachhangService.ImportKhachhang(n)}if(i.nhacungcap&&i.nhacungcap.length>0&&this.ListEdit().some(n=>n.value==="nhacungcap")){let n=(i.nhacungcap||[]).map(a=>({name:a.name,mancc:a.mancc,diachi:a.diachi,email:a.email,sdt:a.sdt,ghichu:a.ghichu})).filter(a=>a.mancc!==void 0&&a.mancc!==null&&a.mancc!=="");yield this._NhacungcapService.ImportNhacungcap(n)}if(i.banggia&&i.banggia.length>0&&this.ListEdit().some(n=>n.value==="banggia")){let n=(i.banggia||[]).map(a=>({title:"B\u1EA3ng Gi\xE1 "+a.mabanggia,mabanggia:a.mabanggia,type:a.type,batdau:(0,o.default)(k(a.batdau)).toDate(),ketthuc:(0,o.default)(k(a.ketthuc)).toDate(),ghichu:a.ghichu,status:a.status})).filter(a=>a.mabanggia!==void 0&&a.mabanggia!==null&&a.mabanggia!=="");yield this._BanggiaService.ImportBanggia(n)}if(i.donhang&&i.donhang.length>0&&this.ListEdit().some(n=>n.value==="donhang")){let n=(i.donhang||[]).map(a=>({ngay:a.ngay,makh:a.makh,mabangia:a.mabangia,masp:a.masp,sldat:a.sldat,slgiao:a.slgiao,slnhan:a.slnhan,ghichu:a.ghichu})).filter(a=>a.makh!==void 0&&a.makh!==null&&a.makh!==""&&a.masp!==void 0&&a.masp!==null&&a.masp!=="");yield this._DonhangService.ImportDonhang(n)}if(i.banggiasanpham&&i.banggiasanpham.length>0&&this.ListEdit().some(n=>n.value==="banggiasanpham")){let n=this.convertBGSPToImport(i.banggiasanpham);yield this._BanggiaService.importSPBG(n)}if(i.banggiakhachhang&&i.banggiakhachhang.length>0&&this.ListEdit().some(n=>n.value==="banggiakhachhang")){let n=this.convertBHKHToImport(i.banggiakhachhang).filter(a=>a.banggia.length>0);yield this._KhachhangService.ImportKhachhang(n),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(i.nhacungcapsanpham&&i.nhacungcapsanpham.length>0&&this.ListEdit().some(n=>n.value==="nhacungcapsanpham")){let n=this.convertNCCSPToImport(i.nhacungcapsanpham);console.log(n);let a=n.filter(e=>e?.Sanpham?.length>0).map(e=>v(I({},e),{Sanpham:e?.Sanpham?.map(s=>this.rawListSP.find(r=>r?.masp===s))}));yield this._NhacungcapService.ImportNhacungcap(a),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(i.xuatnhapton&&i.xuatnhapton.length>0&&this.ListEdit().some(n=>n.value==="xuatnhapton")){let n=[],a=[];i.xuatnhapton.forEach(e=>{let s=this.rawListTonkho.find(r=>r.masp===e.masp);s&&(e.slton>s.slton?n.push({sanphamId:this.rawListSP.find(r=>r.masp===e.masp).id,soluong:e.slton-s.slton}):e.slton<s.slton&&a.push({sanphamId:this.rawListSP.find(r=>r.masp===e.masp).id,soluong:s.slton-e.slton}))}),n.length>0&&this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${(0,o.default)().format("DD/MM/YYYY ")}`,type:"nhap",sanpham:n,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${(0,o.default)().format("HH:mm:ss DD/MM/YYYY ")}`,ngay:(0,o.default)()}),a.length>0&&this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${(0,o.default)().format("DD/MM/YYYY ")}`,type:"xuat",sanpham:a,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${(0,o.default)().format("HH:mm:ss DD/MM/YYYY ")}`,ngay:(0,o.default)()}),n.length===0&&a.length===0&&this._snackBar.open("Kho kh\xF4ng thay \u0111\u1ED5i","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(i.dathang&&this.ListEdit().some(n=>n.value==="dathang")){let n=(i.dathang||[]).map(a=>({ngaynhan:(0,o.default)(k(a.ngaynhan)).toDate(),mancc:a.mancc,mabanggia:a.mabanggia,masp:a.masp,sldat:a.sldat,slgiao:a.slgiao,slnhan:a.slnhan,ghichu:a.ghichu}));console.log(n),yield this._DathangService.ImportDathang(n)}if(i.donhang&&this.ListEdit().some(n=>n.value==="donhang")){let n=(i.donhang||[]).map(a=>({ngaygiao:(0,o.default)(k(a.ngaygiao)).toDate(),makh:a.makh,mabanggia:a.mabanggia,masp:a.masp,sldat:a.sldat,slgiao:a.slgiao,slnhan:a.slnhan,ghichu:a.ghichu}));yield this._DonhangService.ImportDonhang(n)}})}trackByFn(i,n){return n.id}static \u0275fac=function(n){return new(n||u)};static \u0275cmp=N({type:u,selectors:[["app-listimportdata"]],viewQuery:function(n,a){if(n&1&&(_(sa,5),_(ra,5),_(xa,7)),n&2){let e;w(e=D())&&(a.paginator=e.first),w(e=D())&&(a.sort=e.first),w(e=D())&&(a.drawer=e.first)}},decls:16,vars:2,consts:[["uploadfile",""],[1,"flex","flex-col","space-y-2","p-8"],[1,"flex","flex-row","space-x-2","items-center"],["mat-flat-button","","color","primary",3,"click"],[1,"ml-1"],["type","file",1,"hidden",3,"change"],[1,"grid","grid-cols-3","gap-4"],[3,"class","click",4,"ngFor","ngForOf","ngForTrackBy"],[3,"click"],[4,"ngIf"]],template:function(n,a){if(n&1){let e=T();c(0,"div",1)(1,"div",2)(2,"button",3),L("click",function(){return f(e),S(a.ExportExcel(a.TitleExport))}),p(3," T\u1EA3i Xu\u1ED1ng T\u1EA5t C\u1EA3 "),c(4,"mat-icon",4),p(5,"download"),l()(),c(6,"button",3),L("click",function(){f(e);let r=K(13);return S(r.click())}),p(7," T\u1EA3i L\xEAn T\u1EA5t C\u1EA3 "),c(8,"mat-icon",4),p(9,"upload"),l()(),c(10,"button",3),L("click",function(){return f(e),S(a.toggleAll())}),p(11," Ch\u1ECDn T\u1EA5t C\u1EA3 "),l(),c(12,"input",5,0),L("change",function(r){return f(e),S(a.ImportExcel(r))}),l()(),c(14,"div",6),x(15,Ta,4,5,"span",7),l()()}n&2&&(b(15),B("ngForOf",a.ListImportdata())("ngForTrackBy",a.trackByFn))},dependencies:[aa,ta,ga,oa,ha,J,z,X,$,q,j,ia,O,G,F,W,ea,Z],encapsulation:2,changeDetection:0})};export{ka as a};
