import './polyfills.server.mjs';
import{a as ue,b as fe}from"./chunk-NZIEYZSE.mjs";import{a as he}from"./chunk-KXQKI5QI.mjs";import{a as de}from"./chunk-WR57HKLO.mjs";import{a as oe,b as se}from"./chunk-56VMO5UW.mjs";import{a as me}from"./chunk-ZB3RNF5I.mjs";import{a as pe}from"./chunk-Z5JCJXSE.mjs";import{a as ge}from"./chunk-ZQNWSBRJ.mjs";import{a as ce}from"./chunk-4KCGNDNT.mjs";import{a as le}from"./chunk-KWY7EVYL.mjs";import{a as re}from"./chunk-KVLOYVVQ.mjs";import{a as ne}from"./chunk-73IBRO6I.mjs";import{a as wt}from"./chunk-YMIZUYN4.mjs";import{b as Gt,g as jt,h as ht}from"./chunk-DRJ5IELA.mjs";import{a as qt}from"./chunk-6JBFYEDD.mjs";import{b as Rt,c as Ot,d as Yt,e as Ht,g as Vt,w as $t}from"./chunk-LXQF6D42.mjs";import{a as zt}from"./chunk-VLSCJIA4.mjs";import{a as xt,b as Mt,c as Bt,h as it}from"./chunk-T6QRM4JN.mjs";import{a as R}from"./chunk-26NM6QMQ.mjs";import{c as It}from"./chunk-MA5QE5RX.mjs";import{b as Kt}from"./chunk-YJ6SX3X5.mjs";import{a as ie}from"./chunk-PIPB6I5U.mjs";import{c as Ut,d as Wt,e as Qt,f as Xt,g as Jt,h as Zt,i as te,j as ee,k as ae}from"./chunk-3QHTXJXC.mjs";import{a as Le}from"./chunk-MGIVCIKU.mjs";import{d as vt}from"./chunk-WATAHPR3.mjs";import{a as J,b as Z}from"./chunk-HI3FSC7Q.mjs";import{b as Lt,g as tt,j as et,n as at,p as Pt,r as Tt,u as Nt,v as At,y as Ft}from"./chunk-BRRNXVKE.mjs";import{a as B}from"./chunk-HX7VASDC.mjs";import{a as X,b as Dt}from"./chunk-AEZIUUEM.mjs";import{a as W,e as Q}from"./chunk-U7KFJFV4.mjs";import{_ as Ct,y as Et}from"./chunk-B665T7JI.mjs";import{d as U}from"./chunk-ZZ6RE4P2.mjs";import{n as G,o as j,t as kt,w as q}from"./chunk-JLZJVQWC.mjs";import{Cc as Y,Dc as H,Ec as V,Gb as O,Ic as A,Jc as g,Kc as M,Lc as v,Mc as _t,Nb as k,Oc as F,Pc as K,Qc as z,Ra as E,Sc as $,Yc as ct,Zb as h,_c as pt,ad as gt,bc as yt,cc as bt,ia as ft,jc as m,kc as l,lc as x,mc as lt,na as T,nc as mt,oa as _,pc as N,tb as p,uc as b,wc as C,xa as u,xd as St,ya as f,yb as st}from"./chunk-HSX3JMXX.mjs";import{a as I,b as L,g as ve,j as y}from"./chunk-RIAI3ORJ.mjs";var nt=class s{constructor(a,t,e,i){this._StorageService=a;this.router=t;this._ErrorLogService=e;this._sharedSocketService=i;this.socket=this._sharedSocketService.getSocket(),this.listenImportdataUpdates()}socket;_snackBar=_(X);ListImportdata=E([]);DetailImportdata=E({});page=E(1);pageCount=E(1);total=E(0);pageSize=E(10);importdataId=E(null);initDB(){return y(this,null,function*(){return yield ne("ImportdataDB",4,{upgrade(a,t){t<1&&a.createObjectStore("importdatas",{keyPath:"id"}),t<3&&(a.objectStoreNames.contains("importdatas")&&a.deleteObjectStore("importdatas"),a.objectStoreNames.contains("pagination")&&a.deleteObjectStore("pagination"),a.createObjectStore("importdatas",{keyPath:"id"})),t<4}})})}setImportdataId(a){this.importdataId.set(a)}CreateImportdata(a){return y(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(a)},e=yield fetch(`${B.APIURL}/importdata`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let i=yield e.json();this.getAllImportdata(this.pageSize()),this.importdataId.set(i.id)}catch(t){this._ErrorLogService.logError("Failed to CreateImportdata",t),console.error(t)}})}getAllImportdata(){return y(this,arguments,function*(a=this.pageSize(),t=!1){this.pageSize.set(a);let e=this._StorageService.getItem("importdatas_updatedAt")||"0";try{let i={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},n=new URLSearchParams({page:this.page().toString(),limit:a.toString()}),c=yield fetch(`${B.APIURL}/importdata?${n}`,i);c.ok||this.handleError(c.status);let o=yield c.json();return this.ListImportdata.set(o.data),this.page.set(o.page||1),this.pageCount.set(o.pageCount||1),this.total.set(o.total||o.data.length),this.pageSize.set(a),o.data}catch(i){console.error(i)}})}getUpdatedCodeIds(){return y(this,null,function*(){try{let a={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},t=yield fetch(`${B.APIURL}/importdata/updateCodeIds`,a);t.ok||this.handleError(t.status);let e=yield t.json();return this.getAllImportdata(this.pageSize()),e.data}catch(a){this._ErrorLogService.logError("Failed to getUpdatedCodeIds",a),console.error(a)}})}listenImportdataUpdates(){this.socket.off("importdata-updated"),this.socket.on("importdata-updated",()=>y(this,null,function*(){console.log("\u{1F504} D\u1EEF li\u1EC7u s\u1EA3n ph\u1EA9m thay \u0111\u1ED5i, c\u1EADp nh\u1EADt l\u1EA1i cache..."),this._StorageService.removeItem("importdatas_updatedAt"),yield this.getAllImportdata()}))}getImportdataBy(e){return y(this,arguments,function*(a,t=this.pageSize()){this.pageSize.set(t);try{let i={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(L(I({},a),{page:this.page(),limit:t}))},n=yield fetch(`${B.APIURL}/importdata/findby`,i);n.ok||this.handleError(n.status);let c=yield n.json();a.isOne===!0?this.DetailImportdata.set(c):(this._StorageService.setItem("importdatas_updatedAt",new Date().toISOString()),this.ListImportdata.set(c.data),this.page.set(c.page||1),this.pageCount.set(c.pageCount||1),this.total.set(c.total||c.data.length),this.pageSize.set(t))}catch(i){console.error(i)}})}updateImportdata(a){return y(this,null,function*(){try{let t={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(a)},e=yield fetch(`${B.APIURL}/importdata/${a.id}`,t);e.ok||this.handleError(e.status);let i=yield e.json();this.getAllImportdata(this.pageSize()),this.getImportdataBy({id:i.id,isOne:!0},this.pageSize())}catch(t){this._ErrorLogService.logError("Failed to updateImportdata",t),console.error(t)}})}DeleteImportdata(a){return y(this,null,function*(){try{let t={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},e=yield fetch(`${B.APIURL}/importdata/${a.id}`,t);e.ok||this.handleError(e.status),this.getAllImportdata(this.pageSize())}catch(t){this._ErrorLogService.logError("Failed to DeleteImportdata",t),console.error(t)}})}handleError(a){let t="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(a){case 400:t="Th\xF4ng tin \u0111\xE3 t\u1ED3n t\u1EA1i";break;case 401:case 404:t="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:t="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:t="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}this._snackBar.open(t,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}static \u0275fac=function(t){return new(t||s)(T(Dt),T(U),T(zt),T(re))};static \u0275prov=ft({token:s,factory:s.\u0275fac,providedIn:"root"})};var S=ve(Le());function Ne(s,a){if(s&1&&(m(0,"li"),g(1),l()),s&2){let t=a.$implicit,e=C(2);p(),v(" ",e.getItemDisplayName(t)," ")}}function Ae(s,a){if(s&1&&(m(0,"li",17),g(1),l()),s&2){let t=C(2);p(),v(" ... v\xE0 ",t.data.duplicateItems.length-5," m\u1EE5c kh\xE1c ")}}function Fe(s,a){if(s&1&&(m(0,"div",11)(1,"p",12)(2,"mat-icon",13),g(3,"error"),l(),g(4),l(),m(5,"ul",14),k(6,Ne,2,1,"li",15)(7,Ae,2,1,"li",16),l()()),s&2){let t=C();p(4),v(" Ph\xE1t hi\u1EC7n ",t.data.duplicateItems.length," m\u1EE5c tr\xF9ng l\u1EB7p: "),p(2),h("ngForOf",t.data.duplicateItems.slice(0,5)),p(),h("ngIf",t.data.duplicateItems.length>5)}}function Ke(s,a){s&1&&(m(0,"div",23),g(1," \u26A0\uFE0F D\u1EEF li\u1EC7u c\u0169 s\u1EBD b\u1ECB thay th\u1EBF b\u1EDFi d\u1EEF li\u1EC7u m\u1EDBi "),l())}function ze(s,a){s&1&&(m(0,"div",17),g(1," \u2139\uFE0F Ch\u1EC9 th\xEAm m\u1EDBi c\xE1c m\u1EE5c ch\u01B0a t\u1ED3n t\u1EA1i, b\u1ECF qua c\xE1c m\u1EE5c tr\xF9ng l\u1EB7p "),l())}function Re(s,a){if(s&1){let t=N();m(0,"div",18)(1,"mat-checkbox",19),z("ngModelChange",function(i){u(t);let n=C();return K(n.data.isOverwrite,i)||(n.data.isOverwrite=i),f(i)}),m(2,"span",20),g(3,"Ghi \u0111\xE8 l\xEAn d\u1EEF li\u1EC7u c\u0169 (c\xE1c m\u1EE5c tr\xF9ng l\u1EB7p s\u1EBD \u0111\u01B0\u1EE3c c\u1EADp nh\u1EADt)"),l()(),m(4,"div",21),k(5,Ke,2,0,"div",22)(6,ze,2,0,"div",16),l()()}if(s&2){let t=C();p(),F("ngModel",t.data.isOverwrite),p(4),h("ngIf",t.data.isOverwrite),p(),h("ngIf",!t.data.isOverwrite)}}function Oe(s,a){s&1&&(m(0,"div",24)(1,"div",25)(2,"mat-icon",26),g(3,"check_circle"),l(),m(4,"span"),g(5,"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u tr\xF9ng l\u1EB7p. T\u1EA5t c\u1EA3 s\u1EBD \u0111\u01B0\u1EE3c th\xEAm m\u1EDBi."),l()()())}var rt=class s{constructor(a,t){this.dialogRef=a;this.data=t}getItemDisplayName(a){switch(this.data.dataType){case"S\u1EA3n Ph\u1EA9m":return`${a.masp} - ${a.title}`;case"Kh\xE1ch H\xE0ng":return`${a.makh} - ${a.name}`;case"Nh\xE0 Cung C\u1EA5p":return`${a.mancc} - ${a.name}`;case"B\u1EA3ng Gi\xE1":return`${a.mabanggia} - ${a.title}`;default:return a.name||a.title||a.id||"N/A"}}onConfirm(){this.dialogRef.close({confirmed:!0,overwrite:this.data.isOverwrite})}onCancel(){this.dialogRef.close({confirmed:!1,overwrite:!1})}static \u0275fac=function(t){return new(t||s)(st(xt),st(Mt))};static \u0275cmp=O({type:s,selectors:[["app-import-confirmation-dialog"]],decls:31,vars:7,consts:[[1,"p-6","min-w-96"],[1,"flex","items-center","mb-4"],[1,"text-orange-500","mr-2"],[1,"text-lg","font-semibold"],[1,"mb-4","text-gray-700"],["class","mt-3",4,"ngIf"],["class","mb-6",4,"ngIf"],["class","mb-4 p-3 bg-green-50 border border-green-200 rounded",4,"ngIf"],[1,"flex","justify-end","space-x-3","mt-6"],["mat-button","","color","warn",3,"click"],["mat-flat-button","","color","primary",3,"click"],[1,"mt-3"],[1,"text-red-600","font-medium"],[1,"text-red-500","text-sm"],[1,"list-disc","list-inside","text-sm","text-gray-600","mt-2","max-h-32","overflow-y-auto"],[4,"ngFor","ngForOf"],["class","text-blue-600",4,"ngIf"],[1,"text-blue-600"],[1,"mb-6"],[1,"text-sm",3,"ngModelChange","ngModel"],[1,"ml-2"],[1,"mt-2","text-sm","text-gray-600"],["class","text-orange-600",4,"ngIf"],[1,"text-orange-600"],[1,"mb-4","p-3","bg-green-50","border","border-green-200","rounded"],[1,"flex","items-center","text-green-700"],[1,"text-green-500","mr-2"]],template:function(t,e){t&1&&(m(0,"div",0)(1,"div",1)(2,"mat-icon",2),g(3,"warning"),l(),m(4,"h2",3),g(5,"X\xE1c nh\u1EADn Import D\u1EEF li\u1EC7u"),l()(),m(6,"div",4)(7,"p")(8,"strong"),g(9,"Lo\u1EA1i d\u1EEF li\u1EC7u:"),l(),g(10),l(),m(11,"p")(12,"strong"),g(13,"D\u1EEF li\u1EC7u hi\u1EC7n t\u1EA1i:"),l(),g(14),l(),m(15,"p")(16,"strong"),g(17,"D\u1EEF li\u1EC7u m\u1EDBi:"),l(),g(18),l(),k(19,Fe,8,3,"div",5),l(),k(20,Re,7,3,"div",6)(21,Oe,6,0,"div",7),m(22,"div",8)(23,"button",9),b("click",function(){return e.onCancel()}),m(24,"mat-icon"),g(25,"cancel"),l(),g(26," H\u1EE7y b\u1ECF "),l(),m(27,"button",10),b("click",function(){return e.onConfirm()}),m(28,"mat-icon"),g(29,"file_upload"),l(),g(30),l()()()),t&2&&(p(10),v(" ",e.data.dataType,""),p(4),v(" ",e.data.existingCount," m\u1EE5c"),p(4),v(" ",e.data.newCount," m\u1EE5c"),p(),h("ngIf",e.data.duplicateItems.length>0),p(),h("ngIf",e.data.duplicateItems.length>0),p(),h("ngIf",e.data.duplicateItems.length===0),p(9),v(" ",e.data.duplicateItems.length>0?e.data.isOverwrite?"Import & Ghi \u0111\xE8":"Import & B\u1ECF qua tr\xF9ng l\u1EB7p":"Import"," "))},dependencies:[it,Q,W,Z,J,q,G,j,fe,ue,at,tt,et],encapsulation:2})};var Ye=["drawer"],be=()=>({standalone:!0}),He=()=>[1,2,3,4,5];function Ve(s,a){if(s&1&&(m(0,"div",42)(1,"div",43),x(2,"mat-progress-spinner",44),m(3,"span",45),g(4),l()()()),s&2){let t=C();p(4),M(t.loadingMessage())}}function $e(s,a){s&1&&(m(0,"span"),g(1,"T\u1EA3i Xu\u1ED1ng"),l())}function Ge(s,a){s&1&&(m(0,"span",46),x(1,"mat-progress-spinner",47),g(2," \u0110ang xu\u1EA5t... "),l())}function je(s,a){s&1&&(m(0,"mat-icon",48),g(1,"download"),l())}function qe(s,a){s&1&&(m(0,"span"),g(1,"T\u1EA3i L\xEAn"),l())}function Ue(s,a){s&1&&(m(0,"span",46),x(1,"mat-progress-spinner",47),g(2," \u0110ang nh\u1EADp... "),l())}function We(s,a){s&1&&(m(0,"mat-icon",48),g(1,"upload"),l())}function Qe(s,a){if(s&1&&(m(0,"div",49)(1,"div",23),x(2,"mat-progress-spinner",50),m(3,"span",51),g(4),l()()()),s&2){let t=C();p(4),M(t.loadingMessage())}}function Xe(s,a){s&1&&(m(0,"mat-icon"),g(1,"check"),l())}function Je(s,a){if(s&1){let t=N();m(0,"span",52),b("click",function(){let i=u(t).$implicit,n=C();return f(!n.isLoading()&&!n.isImporting()&&!n.isExporting()&&i.status&&n.toggleItem(i))}),k(1,Xe,2,0,"mat-icon",29),m(2,"span"),g(3),l()()}if(s&2){let t=a.$implicit,e=C();bt("",t.status?"":"hidden",` 
                   `,e.CheckItem(t)?"bg-blue-100":"",` 
                   `,e.isLoading()||e.isImporting()||e.isExporting()?"opacity-50 cursor-not-allowed":"cursor-pointer",` 
                   flex flex-row space-x-2 items-center p-4 rounded-lg border transition-all duration-200`),p(),h("ngIf",e.CheckItem(t)),p(2),M(t.title)}}function Ze(s,a){s&1&&(m(0,"div",55),x(1,"div",56)(2,"div",57)(3,"div",58),l())}function ta(s,a){s&1&&(lt(0),m(1,"div",53),k(2,Ze,4,0,"div",54),l(),mt()),s&2&&(p(2),h("ngForOf",$(1,He)))}function ea(s,a){if(s&1&&(m(0,"div")(1,"span",60),g(2),l(),m(3,"span"),g(4),l(),m(5,"span",61),g(6),l()()),s&2){let t=a.$implicit,e=C(3);yt(`w-full flex flex-row space-x-2 items-center border p-4 rounded-lg
                    `,e.isImporting()||e.isExporting()?"opacity-50":"",""),p(2),M(t.type),p(2),M(t.title),p(2),M(t.description)}}function aa(s,a){if(s&1&&(lt(0),k(1,ea,7,6,"div",59),mt()),s&2){let t=C(2);p(),h("ngForOf",t.ListImportdata())}}function ia(s,a){s&1&&(m(0,"div",62)(1,"span",63),g(2,"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),l()())}function na(s,a){if(s&1&&k(0,aa,2,1,"ng-container",41)(1,ia,3,0,"ng-template",null,3,gt),s&2){let t=A(2),e=C();h("ngIf",e.ListImportdata().length>0)("ngIfElse",t)}}var w=class{static checkDuplicates(a,t,e){let i=new Set(t.map(n=>n[e]));return a.filter(n=>i.has(n[e]))}static prepareSanphamData(a,t,e){if(e)return a;{let i=new Set(t.map(n=>n.masp));return a.filter(n=>!i.has(n.masp))}}static prepareKhachhangData(a,t,e){if(e)return a;{let i=new Set(t.map(n=>n.makh));return a.filter(n=>!i.has(n.makh))}}static prepareNhacungcapData(a,t,e){if(e)return a;{let i=new Set(t.map(n=>n.mancc));return a.filter(n=>!i.has(n.mancc))}}static prepareBanggiaData(a,t,e){if(e)return a;{let i=new Set(t.map(n=>n.mabanggia));return a.filter(n=>!i.has(n.mabanggia))}}},_e=class s{displayedColumns=[];ColumnName={stt:"#",codeId:"Code",name:"Ti\xEAu \u0110\u1EC1",group:"Nh\xF3m",description:"M\xF4 T\u1EA3",status:"Tr\u1EA1ng Th\xE1i",order:"Th\u1EE9 T\u1EF1",createdAt:"Ng\xE0y T\u1EA1o",updatedAt:"Ng\xE0y C\u1EADp Nh\u1EADt"};FilterColumns=JSON.parse(localStorage.getItem("ImportdataColFilter")||"[]");Columns=[];paginator;sort;drawer;_BanggiaService=_(le);_SanphamService=_(ge);_KhachhangService=_(ce);_NhacungcapService=_(pe);_DonhangService=_(ie);_DathangService=_(me);_PhieukhoService=_(he);_UserService=_(wt);_KhoService=_(de);_ImportdataService=_(nt);_breakpointObserver=_(Et);_GoogleSheetService=_(qt);_router=_(U);_dialog=_(Bt);_snackBar=_(X);isLoading=E(!1);isImporting=E(!1);isExporting=E(!1);loadingMessage=E("");batdau=new Date;ketthuc=new Date;ListImportType=E([{id:1,title:"S\u1EA3n Ph\u1EA9m",value:"sanpham",status:!0},{id:2,title:"Kh\xE1ch H\xE0ng",value:"khachhang",status:!0},{id:3,title:"Nh\xE0 Cung C\u1EA5p",value:"nhacungcap",status:!0},{id:4,title:"B\u1EA3ng Gi\xE1",value:"banggia",status:!0},{id:5,title:"\u0110\u01A1n H\xE0ng",value:"donhang",status:!0},{id:6,title:"\u0110\u1EB7t H\xE0ng",value:"dathang",status:!0},{id:7,title:"B\u1EA3ng Gi\xE1 Kh\xE1ch H\xE0ng",value:"banggiakhachhang",status:!0},{id:8,title:"B\u1EA3ng Gi\xE1 S\u1EA3n Ph\u1EA9m",value:"banggiasanpham",status:!0},{id:9,title:"Nh\xE0 Cung C\u1EA5p S\u1EA3n Ph\u1EA9m",value:"nhacungcapsanpham",status:!0},{id:10,title:"Xu\u1EA5t Nh\u1EADp T\u1ED3n",value:"xuatnhapton",status:!0}]);ListEdit=E([]);ListImportdata=this._ImportdataService.ListImportdata;TitleExport="export";rawListSP=[];rawListKH=[];rawListNCC=[];rawListBG=[];rawListDH=[];rawListDathang=[];rawListTonkho=[];constructor(){let a=new Date;this.ketthuc=new Date(a),this.batdau=new Date(a),St(()=>y(this,null,function*(){this.isLoading.set(!0),this.loadingMessage.set("\u0110ang t\u1EA3i d\u1EEF li\u1EC7u...");try{yield this._ImportdataService.getAllImportdata(100,!0),yield this.loadDataWithDateRange(),this.loadingMessage.set("\u0110ang ki\u1EC3m tra quy\u1EC1n..."),yield this._UserService.getProfile();let t=this._UserService.profile()?.permissions?.map(e=>e.name)||[];this.ListImportType.update(e=>e.map(i=>L(I({},i),{status:t.includes("importdata."+i.value)})))}catch(t){console.error("Error loading data:",t),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi t\u1EA3i d\u1EEF li\u1EC7u","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isLoading.set(!1),this.loadingMessage.set("")}}))}loadDataWithDateRange(){return y(this,null,function*(){try{let a={Batdau:this.batdau,Ketthuc:this.ketthuc,pageSize:9999};this.loadingMessage.set("\u0110ang t\u1EA3i danh s\xE1ch s\u1EA3n ph\u1EA9m..."),yield this._SanphamService.getAllSanpham({pageSize:9999},!0),this.rawListSP=this._SanphamService.ListSanpham(),this.loadingMessage.set("\u0110ang t\u1EA3i danh s\xE1ch kh\xE1ch h\xE0ng..."),yield this._KhachhangService.getAllKhachhang({pageSize:9999},!0),this.rawListKH=this._KhachhangService.ListKhachhang(),this.loadingMessage.set("\u0110ang t\u1EA3i danh s\xE1ch nh\xE0 cung c\u1EA5p..."),yield this._NhacungcapService.getAllNhacungcap(),this.rawListNCC=this._NhacungcapService.ListNhacungcap(),this.loadingMessage.set("\u0110ang t\u1EA3i b\u1EA3ng gi\xE1..."),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),this.loadingMessage.set("\u0110ang t\u1EA3i \u0111\u01A1n h\xE0ng..."),yield this._DonhangService.searchDonhang({batdau:this.batdau,ketthuc:this.ketthuc}),this.rawListDH=this._DonhangService.ListDonhang(),this.loadingMessage.set("\u0110ang t\u1EA3i \u0111\u1EB7t h\xE0ng..."),yield this._DathangService.getAllDathang(),this.rawListDathang=this._DathangService.ListDathang(),this.loadingMessage.set("\u0110ang t\u1EA3i t\u1ED3n kho..."),yield this._KhoService.getTonKho("1","1000").then(t=>{this.rawListTonkho=t.data})}catch(a){throw console.error("Error loading data with date range:",a),a}})}onDateChange(){return y(this,null,function*(){if(!this.isLoading()){this.isLoading.set(!0),this.loadingMessage.set("\u0110ang c\u1EADp nh\u1EADt d\u1EEF li\u1EC7u theo ng\xE0y...");try{yield this.loadDataWithDateRange()}catch(a){console.error("Error updating data with new date range:",a),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi c\u1EADp nh\u1EADt d\u1EEF li\u1EC7u","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isLoading.set(!1),this.loadingMessage.set("")}}})}applyDateFilter(){return y(this,null,function*(){yield this.onDateChange()})}setDateRange(a){return y(this,null,function*(){let t=new Date;switch(a){case"today":this.batdau=new Date(t),this.ketthuc=new Date(t);break;case"yesterday":let e=new Date(t);e.setDate(e.getDate()-1),this.batdau=new Date(e),this.ketthuc=new Date(e);break;case"last7days":this.ketthuc=new Date(t),this.batdau=new Date(t),this.batdau.setDate(this.batdau.getDate()-6);break;case"last30days":this.ketthuc=new Date(t),this.batdau=new Date(t),this.batdau.setDate(this.batdau.getDate()-29);break;case"thisMonth":this.batdau=new Date(t.getFullYear(),t.getMonth(),1),this.ketthuc=new Date(t);break;case"lastMonth":let i=new Date(t.getFullYear(),t.getMonth()-1,1);this.batdau=new Date(i),this.ketthuc=new Date(t.getFullYear(),t.getMonth(),0);break;case"thisWeek":let n=new Date(t);n.setDate(t.getDate()-t.getDay()),this.batdau=new Date(n),this.ketthuc=new Date(t);break}yield this.applyDateFilter()})}ngOnInit(){return y(this,null,function*(){yield this._ImportdataService.getAllImportdata(100,!0),yield this._SanphamService.getAllSanpham(),this.rawListSP=this._SanphamService.ListSanpham(),yield this._KhachhangService.getAllKhachhang(),this.rawListKH=this._KhachhangService.ListKhachhang(),yield this._NhacungcapService.getAllNhacungcap(),this.rawListNCC=this._NhacungcapService.ListNhacungcap(),yield this._BanggiaService.getAllBanggia(),this.rawListBG=this._BanggiaService.ListBanggia(),yield this._DonhangService.getAllDonhang(),this.rawListDH=this._DonhangService.ListDonhang(),yield this._DathangService.getAllDathang(),this.rawListDathang=this._DathangService.ListDathang(),yield this._KhoService.getTonKho("1","1000").then(a=>{this.rawListTonkho=a.data})})}applyFilter(a){}toggleAll(){this.ListEdit().length===this.ListImportType().length?(this.ListEdit.set([]),this.TitleExport="export"):(this.ListEdit.set(this.ListImportType()),this.TitleExport="export_all")}toggleItem(a){this.ListEdit().findIndex(e=>e.id===a.id)===-1?(this.TitleExport+="_"+a.value,this.ListEdit.update(e=>[...e,a])):(this.TitleExport=this.TitleExport.replace("_"+a.value,""),this.ListEdit.update(e=>e.filter(i=>i.id!==a.id)))}CheckItem(a){return this.ListEdit().findIndex(e=>e.id===a.id)!==-1}ExportExcel(a){return y(this,null,function*(){if(!this.isExporting()){this.isExporting.set(!0),this.loadingMessage.set("\u0110ang chu\u1EA9n b\u1ECB d\u1EEF li\u1EC7u xu\u1EA5t theo kho\u1EA3ng th\u1EDDi gian...");try{let t=this.getFilteredExportData(),e=Array.isArray(t.ListSP)&&t.ListSP.length?t.ListSP.map(r=>({masp:r.masp,subtitle:r.subtitle,title:r.title,title2:r.title2,giaban:r.giaban,giagoc:r.giagoc,vat:r.vat,dvt:r.dvt,haohut:r.haohut,ghichu:r.ghichu})):[{masp:"",subtitle:"",title:"",title2:"",giaban:"",giagoc:"",vat:"",dvt:"",haohut:"",ghichu:""}],i=Array.isArray(t.ListKH)&&t.ListKH.length?t.ListKH.map(r=>({name:r.name?.trim()||"",tenfile:r.tenfile?.trim()||"",makh:r.makh?.trim()||"",namenn:r.namenn?.trim()||"",mabanggia:r.banggia?.mabanggia?.trim()||"",diachi:r.diachi?.trim()||"",quan:r.quan?.trim()||"",email:r.email?.trim()||"",sdt:r.sdt?.toString().trim()||"",mst:r.mst?.toString().trim()||"",gionhanhang:r.gionhanhang?.toString().trim()||"",loaikh:r.loaikh?.toString().trim()||"khachsi",hiengia:r.hiengia||!0,ghichu:r.ghichu?.toString().trim()||""})):[{name:"",tenfile:"",makh:"",namenn:"",diachi:"",quan:"",email:"",sdt:"",mst:"",gionhanhang:"",loaikh:"khachsi",hiengia:!0,ghichu:""}],n=Array.isArray(t.ListNCC)&&t.ListNCC.length>0?t.ListNCC.map(r=>({name:r.name?.trim()||"",tenfile:r.tenfile?.trim()||"",mancc:r.mancc?.trim()||"",diachi:r.diachi?.trim()||"",email:r.email?.trim()||"",sdt:r.sdt?.toString().trim()||"",ghichu:r.ghichu?.toString().trim()||""})):[{name:"",tenfile:"",mancc:"",diachi:"",email:"",sdt:"",ghichu:""}],c=Array.isArray(t.ListBG)&&t.ListBG.length>0?t.ListBG.map(r=>({title:r.title?.trim()||"",mabanggia:r.mabanggia?.trim()||"",type:r.type?.trim()||"",batdau:(0,S.default)(r.batdau).format("DD/MM/YYYY")||"",ketthuc:(0,S.default)(r.ketthuc).format("DD/MM/YYYY")||"",ghichu:r.ghichu?.trim()||"",status:r.status?.trim()||""})):[{title:"",mabanggia:"",type:"",batdau:"",ketthuc:"",ghichu:"",status:""}],o=Array.isArray(t.ListDH)&&t.ListDH.length>0?t.ListDH.flatMap(r=>Array.isArray(r.sanpham)?r.sanpham.map(d=>({ngaygiao:(0,S.default)(r.ngaygiao).format("DD/MM/YYYY"),makh:r.khachhang?.makh,name:r.khachhang?.name,mabanggia:r.khachhang?.banggia?.[0]?.mabanggia,masp:d.masp,tensp:d.title,sldat:d.sldat,slgiao:d.slgiao,slnhan:d.slnhan,ghichu:d.ghichu})):[]):[{ngaygiao:(0,S.default)().format("DD/MM/YYYY"),makh:"",mabanggia:"",masp:"",tensp:"",sldat:0,slgiao:0,slnhan:0,ghichu:""}],P=Array.isArray(t.ListDathang)&&t.ListDathang.length>0?t.ListDathang.flatMap(r=>Array.isArray(r.sanpham)?r.sanpham.map(d=>({ngaynhan:(0,S.default)(r.ngaynhan).format("DD/MM/YYYY"),mancc:r.nhacungcap?.mancc,name:r.nhacungcap?.name,mabanggia:r.banggia?.[0]?.mabanggia,masp:d.masp,tensp:d.title,sldat:Number(d.sldat)||0,slgiao:Number(d.slgiao)||0,slnhan:Number(d.slnhan)||0,ghichu:d.ghichu})):[]):[{ngaynhan:(0,S.default)().format("DD/MM/YYYY"),mancc:"",name:"",mabanggia:"",masp:"",tensp:"",sldat:0,slgiao:0,slnhan:0,ghichu:""}],ot=this.convertBGSPToExport(t.ListBG,t.ListSP),Se=t.ListKH.map(r=>({makh:r.makh||"",name:r.name||"",mabanggia:r.banggia?.mabanggia||""})),ke=t.ListSP.reduce((r,d)=>(d&&d.masp&&(r[d.masp]=""),r),{}),Ee=t.ListNCC.map(r=>{let d={mancc:r.mancc||"",name:r.name||""},dt=1;for(let ut of Object.keys(ke))r.Sanpham?.some(Ie=>Ie.masp===ut)&&(d[dt]=ut,dt++);return d}),Ce=t.ListTonkho.map(r=>({masp:r.masp,title:r.title,dvt:r.dvt,slton:r.slton})),D={};if(this.ListEdit().some(r=>r.value==="sanpham")&&(D.sanpham={data:e}),this.ListEdit().some(r=>r.value==="khachhang")&&(D.khachhang={data:i}),this.ListEdit().some(r=>r.value==="nhacungcap")&&(D.nhacungcap={data:n}),this.ListEdit().some(r=>r.value==="banggia")&&(D.banggia={data:c}),this.ListEdit().some(r=>r.value==="donhang")&&(D.donhang={data:o}),this.ListEdit().some(r=>r.value==="dathang")&&(D.dathang={data:P}),this.ListEdit().some(r=>r.value==="banggiasanpham")&&(D.banggiasanpham={data:ot}),this.ListEdit().some(r=>r.value==="banggiakhachhang")&&(D.banggiakhachhang={data:Se}),this.ListEdit().some(r=>r.value==="nhacungcapsanpham")&&(D.nhacungcapsanpham={data:Ee}),this.ListEdit().some(r=>r.value==="xuatnhapton")&&(D.xuatnhapton={data:Ce}),Object.keys(D).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 xu\u1EA5t","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}this.loadingMessage.set("\u0110ang t\u1EA1o file Excel...");let De=`${this.batdau.toLocaleDateString("vi-VN").replace(/\//g,"-")}_${this.ketthuc.toLocaleDateString("vi-VN").replace(/\//g,"-")}`,we=`${a}_${De}`;Gt(D,we),this._snackBar.open("Xu\u1EA5t d\u1EEF li\u1EC7u th\xE0nh c\xF4ng!","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch(t){console.error("Error exporting Excel:",t),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi xu\u1EA5t d\u1EEF li\u1EC7u","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isExporting.set(!1),this.loadingMessage.set("")}}})}convertBGSPToExport(a,t){let e=new Set(a.map(i=>i.mabanggia));return t.map(i=>I({masp:i.masp,title:i.title,giaban:i.giaban.toString()},Array.from(e).reduce((n,c)=>(n[c]=i.giaban.toString(),n),{})))}convertBGSPToImport(a){return!a||a.length===0?[]:Object.keys(a[0]).filter(i=>!["masp","title","giagoc"].includes(i)).map(i=>({mabanggia:i,title:`B\u1EA3ng gi\xE1 ${i.replace("BG","")}`,sanpham:a.map(n=>({masp:n.masp?.toString().trim()||"",title:n.title?.toString().trim()||"",giagoc:n.giagoc||0,giaban:n[i]||0}))}))}convertNCCSPToImport(a){if(!a||a.length===0)return[];let t=Object.keys(a[0]).filter(e=>!["mancc","name"].includes(e));return a.forEach(e=>{e.Sanpham=[];for(let i of t)e[i]!==void 0&&e[i]!==null&&e[i]!==""&&e.Sanpham.push(e[i]),delete e[i]}),a}ImportExcel(a){return y(this,null,function*(){if(!this.isImporting()){this.isImporting.set(!0),this.loadingMessage.set("\u0110ang \u0111\u1ECDc file Excel...");try{let t=yield jt(a);this.loadingMessage.set("\u0110ang x\u1EED l\xFD d\u1EEF li\u1EC7u..."),yield this.DoImportData(t)}catch(t){console.error("Error importing Excel:",t),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi \u0111\u1ECDc file Excel","",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}finally{this.isImporting.set(!1),this.loadingMessage.set("")}}})}showImportConfirmDialog(a,t,e,i){return y(this,null,function*(){return new Promise(n=>{let c={dataType:a,existingCount:t,newCount:e,duplicateItems:i,isOverwrite:!1};this._dialog.open(rt,{width:"500px",data:c,disableClose:!0}).afterClosed().subscribe(P=>{n(P||{confirmed:!1,overwrite:!1})})})})}DoImportData(a){return y(this,null,function*(){if(Object.keys(this.ListEdit()).length===0){this._snackBar.open("Ch\u01B0a Ch\u1ECDn Lo\u1EA1i D\u1EEF Li\u1EC7u","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}if(Object.keys(a).length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u \u0111\u1EC3 nh\u1EADp","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}if(a.sanpham&&a.sanpham.length>0&&this.ListEdit().some(t=>t.value==="sanpham")){let t=(a.sanpham||[]).map(o=>({masp:o.masp,subtitle:R((o.title||"")+(o.title2||"")),title:o.title,title2:o.title2,giaban:Number(o.giaban)||Number(o.giagoc)||0,giagoc:Number(o.giagoc)||0,vat:Number(o.vat)||0,dvt:o.dvt,haohut:Number(o.haohut)||0,ghichu:o.ghichu})).filter(o=>o.masp!==void 0&&o.masp!==null&&o.masp!==""),e=w.checkDuplicates(t,this.rawListSP,"masp"),i=yield this.showImportConfirmDialog("S\u1EA3n Ph\u1EA9m",this.rawListSP.length,t.length,e);if(!i.confirmed)return;let n=w.prepareSanphamData(t,this.rawListSP,i.overwrite);if(n.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u m\u1EDBi \u0111\u1EC3 import","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let c=this._snackBar.open(`\u0110ang import ${n.length} s\u1EA3n ph\u1EA9m...`,"",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});try{yield this._SanphamService.ImportSanpham(n),c.dismiss(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${n.length} s\u1EA3n ph\u1EA9m${i.overwrite?" (ghi \u0111\xE8)":" (th\xEAm m\u1EDBi)"}!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{c.dismiss(),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import s\u1EA3n ph\u1EA9m","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(a.khachhang&&a.khachhang.length>0&&this.ListEdit().some(t=>t.value==="khachhang")){let t=(a.khachhang||[]).map(o=>({name:o.name.toString(),makh:o.makh,tenfile:R(o.tenfile.toString()||o.name.toString()||""),subtitle:R((o.name.toString()||"")+(o.namenn.toString()||"")),namenn:o.namenn.toString(),diachi:o.diachi,quan:o.quan,email:o.email,sdt:o.sdt.toString(),mst:o.mst.toString(),gionhanhang:o.gionhanhang.toString(),loaikh:o.loaikh,ghichu:o.ghichu,hiengia:o.hiengia,mabanggia:o.mabanggia})).filter(o=>o.makh!==void 0&&o.makh!==null&&o.makh!==""),e=w.checkDuplicates(t,this.rawListKH,"makh"),i=yield this.showImportConfirmDialog("Kh\xE1ch H\xE0ng",this.rawListKH.length,t.length,e);if(!i.confirmed)return;let n=w.prepareKhachhangData(t,this.rawListKH,i.overwrite);if(n.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u m\u1EDBi \u0111\u1EC3 import","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let c=this._snackBar.open(`\u0110ang import ${n.length} kh\xE1ch h\xE0ng...`,"",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});try{yield this._KhachhangService.ImportKhachhang(n),c.dismiss(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${n.length} kh\xE1ch h\xE0ng${i.overwrite?" (ghi \u0111\xE8)":" (th\xEAm m\u1EDBi)"}!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{c.dismiss(),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import kh\xE1ch h\xE0ng","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(a.nhacungcap&&a.nhacungcap.length>0&&this.ListEdit().some(t=>t.value==="nhacungcap")){let t=(a.nhacungcap||[]).map(o=>({name:o.name,tenfile:R(o.tenfile.toString()||o.name||""),mancc:o.mancc,diachi:o.diachi,email:o.email,sdt:o.sdt.toString(),ghichu:o.ghichu})).filter(o=>o.mancc!==void 0&&o.mancc!==null&&o.mancc!==""),e=w.checkDuplicates(t,this.rawListNCC,"mancc"),i=yield this.showImportConfirmDialog("Nh\xE0 Cung C\u1EA5p",this.rawListNCC.length,t.length,e);if(!i.confirmed)return;let n=w.prepareNhacungcapData(t,this.rawListNCC,i.overwrite);if(n.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u m\u1EDBi \u0111\u1EC3 import","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let c=this._snackBar.open(`\u0110ang import ${n.length} nh\xE0 cung c\u1EA5p...`,"",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});try{yield this._NhacungcapService.ImportNhacungcap(n),c.dismiss(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${n.length} nh\xE0 cung c\u1EA5p${i.overwrite?" (ghi \u0111\xE8)":" (th\xEAm m\u1EDBi)"}!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{c.dismiss(),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import nh\xE0 cung c\u1EA5p","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(a.banggia&&a.banggia.length>0&&this.ListEdit().some(t=>t.value==="banggia")){let t=(a.banggia||[]).map(o=>({title:"B\u1EA3ng Gi\xE1 "+o.mabanggia,mabanggia:o.mabanggia,type:o.type,batdau:(0,S.default)(o.batdau,"DD/MM/YYYY").toDate(),ketthuc:(0,S.default)(o.ketthuc,"DD/MM/YYYY").toDate(),ghichu:o.ghichu,status:o.status})).filter(o=>o.mabanggia!==void 0&&o.mabanggia!==null&&o.mabanggia!==""),e=w.checkDuplicates(t,this.rawListBG,"mabanggia"),i=yield this.showImportConfirmDialog("B\u1EA3ng Gi\xE1",this.rawListBG.length,t.length,e);if(!i.confirmed)return;let n=w.prepareBanggiaData(t,this.rawListBG,i.overwrite);if(n.length===0){this._snackBar.open("Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u m\u1EDBi \u0111\u1EC3 import","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});return}let c=this._snackBar.open(`\u0110ang import ${n.length} b\u1EA3ng gi\xE1...`,"",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});try{yield this._BanggiaService.ImportBanggia(n),c.dismiss(),this._snackBar.open(`Import th\xE0nh c\xF4ng ${n.length} b\u1EA3ng gi\xE1${i.overwrite?" (ghi \u0111\xE8)":" (th\xEAm m\u1EDBi)"}!`,"",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}catch{c.dismiss(),this._snackBar.open("C\xF3 l\u1ED7i x\u1EA3y ra khi import b\u1EA3ng gi\xE1","",{duration:2e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}}if(a.donhang&&a.donhang.length>0&&this.ListEdit().some(t=>t.value==="donhang")){let t=(a.donhang||[]).map(i=>({ngay:i.ngay,makh:i.makh,mabangia:i.mabangia,masp:i.masp,sldat:Number(i.sldat),slgiao:Number(i.slgiao),slnhan:Number(i.slnhan),ghichu:i.ghichu})).filter(i=>i.makh!==void 0&&i.makh!==null&&i.makh!==""&&i.masp!==void 0&&i.masp!==null&&i.masp!==""),e=this._snackBar.open("\u0110ang import \u0110\u01A1n h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DonhangService.ImportDonhang(t),e.dismiss(),this._snackBar.open("Import \u0110\u01A1n h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(a.banggiasanpham&&a.banggiasanpham.length>0&&this.ListEdit().some(t=>t.value==="banggiasanpham")){let t=this.convertBGSPToImport(a.banggiasanpham),e=t.find(n=>n.mabanggia==="giaban");if(!e)return;let i=t.map(n=>{if(n.mabanggia==="giaban")return n;let c=n.sanpham.map(o=>{if(o.giaban==="0"){let P=e.sanpham.find(ot=>ot.masp===o.masp);return L(I({},o),{giaban:P?P.giaban:o.giaban})}return o});return L(I({},n),{sanpham:c})});yield this._BanggiaService.importSPBG(i)}if(a.banggiakhachhang&&a.banggiakhachhang.length>0&&this.ListEdit().some(t=>t.value==="banggiakhachhang")){console.log("Importing banggiakhachhang data:",a.banggiakhachhang);let t=(a.banggiakhachhang||[]).map(e=>({makh:e.makh,name:e.name,mabanggia:e.mabanggia})).filter(e=>e.mabanggia!==void 0&&e.mabanggia!==null&&e.mabanggia!=="");console.log("Importing ListBGKH data:",t),yield this._KhachhangService.ImportKhachhang(t),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(a.nhacungcapsanpham&&a.nhacungcapsanpham.length>0&&this.ListEdit().some(t=>t.value==="nhacungcapsanpham")){let t=this.convertNCCSPToImport(a.nhacungcapsanpham);console.log(t);let e=t.filter(n=>n?.Sanpham?.length>0).map(n=>L(I({},n),{Sanpham:n?.Sanpham?.map(c=>this.rawListSP.find(o=>o?.masp===c))})),i=this._snackBar.open("\u0110ang import Nh\xE0 cung c\u1EA5p s\u1EA3n ph\u1EA9m...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._NhacungcapService.ImportNhacungcap(e),i.dismiss(),this._snackBar.open("Import Nh\xE0 cung c\u1EA5p s\u1EA3n ph\u1EA9m th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(a.xuatnhapton&&a.xuatnhapton.length>0&&this.ListEdit().some(t=>t.value==="xuatnhapton")){let t=[],e=[];a.xuatnhapton.forEach(i=>{let n=this.rawListTonkho.find(c=>c.masp===i.masp);n&&(i.slton>n.slton?t.push({sanphamId:this.rawListSP.find(c=>c.masp===i.masp).id,soluong:i.slton-n.slton}):i.slton<n.slton&&e.push({sanphamId:this.rawListSP.find(c=>c.masp===i.masp).id,soluong:n.slton-i.slton}))}),t.length>0&&(yield this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${(0,S.default)().format("DD/MM/YYYY ")}`,type:"nhap",sanpham:t,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${(0,S.default)().format("HH:mm:ss DD/MM/YYYY ")}`,ngay:(0,S.default)()}),this._snackBar.open("C\u1EADp nh\u1EADt t\u1ED3n kho th\xE0nh c\xF4ng Th\xEAm phi\u1EBFu Nh\u1EADp Kho","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})),e.length>0&&(yield this._PhieukhoService.CreatePhieukho({title:`\u0110i\u1EC1u Ch\u1EC9nh Kho Ng\xE0y ${(0,S.default)().format("DD/MM/YYYY ")}`,type:"xuat",sanpham:e,ghichu:`C\u1EADp nh\u1EADt t\u1ED3n kho l\xFAc ${(0,S.default)().format("HH:mm:ss DD/MM/YYYY ")}`,ngay:(0,S.default)()}),this._snackBar.open("C\u1EADp nh\u1EADt t\u1ED3n kho th\xE0nh c\xF4ng Th\xEAm phi\u1EBFu Xu\u1EA5t Kho","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})),t.length===0&&e.length===0&&this._snackBar.open("Kho kh\xF4ng thay \u0111\u1ED5i","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(a.dathang&&this.ListEdit().some(t=>t.value==="dathang")){let t=(a.dathang||[]).filter(i=>i.mancc&&i.masp).map(i=>({ngaynhan:(0,S.default)(ht(i.ngaynhan)).toDate(),mancc:i.mancc,mabanggia:i.mabanggia,masp:i.masp,sldat:Number(i.sldat),slgiao:Number(i.sldat),slnhan:Number(i.sldat),ghichu:i.ghichu}));console.log(t);let e=this._snackBar.open("\u0110ang import \u0110\u1EB7t h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DathangService.ImportDathang(t),e.dismiss(),this._snackBar.open("Import \u0110\u1EB7t h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}if(a.donhang&&this.ListEdit().some(t=>t.value==="donhang")){let t=(a.donhang||[]).filter(i=>i.makh&&i.masp).map(i=>({ngaygiao:(0,S.default)(ht(i.ngaygiao)).toDate(),makh:i.makh,mabanggia:i.mabangia,masp:i.masp,sldat:Number(i.sldat),slgiao:Number(i.slgiao),slnhan:Number(i.slnhan),ghichu:i.ghichu})),e=this._snackBar.open("\u0110ang import \u0110\u01A1n h\xE0ng...","",{horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-warning"]});yield this._DonhangService.ImportDonhang(t),e.dismiss(),this._snackBar.open("Import \u0110\u01A1n h\xE0ng th\xE0nh c\xF4ng!","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})}})}trackByFn(a,t){return t.id||a}filterDataByDateRange(a,t="createdAt"){if(!a||!Array.isArray(a))return[];let e=new Date(this.batdau);e.setHours(0,0,0,0);let i=new Date(this.ketthuc);return i.setHours(23,59,59,999),a.filter(n=>{if(!n[t])return!0;let c;if(typeof n[t]=="string")c=new Date(n[t]);else if(n[t]instanceof Date)c=n[t];else return!0;return c>=e&&c<=i})}getFilteredExportData(){let a={batdau:this.batdau,ketthuc:this.ketthuc,dateRange:`${this.batdau.toLocaleDateString("vi-VN")} - ${this.ketthuc.toLocaleDateString("vi-VN")}`};return{ListSP:this.rawListSP,ListKH:this.rawListKH,ListNCC:this.rawListNCC,ListBG:this.rawListBG,ListDH:this.filterDataByDateRange(this.rawListDH,"ngaygiao"),ListDathang:this.filterDataByDateRange(this.rawListDathang,"ngaynhan"),ListTonkho:this.filterDataByDateRange(this.rawListTonkho,"createdAt"),dateInfo:a}}static \u0275fac=function(t){return new(t||s)};static \u0275cmp=O({type:s,selectors:[["app-listimportdata"]],viewQuery:function(t,e){if(t&1&&(Y(Ot,5),Y(Ht,5),Y(Ye,7)),t&2){let i;H(i=V())&&(e.paginator=i.first),H(i=V())&&(e.sort=i.first),H(i=V())&&(e.drawer=i.first)}},decls:73,vars:42,consts:[["dateRangePicker",""],["uploadfile",""],["dataContent",""],["noData",""],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-4"],["class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",4,"ngIf"],[1,"col-span-full","mb-6","p-6","bg-white","rounded-lg","shadow-sm","border"],[1,"flex","flex-col","items-center","gap-4"],[1,"flex","flex-col","lg:flex-row","lg:items-center","gap-4"],[1,"flex","flex-col","lg:flex-row","items-center","gap-2"],["appearance","outline","subscriptSizing","dynamic",1,"w-full","lg:w-auto"],[3,"rangePicker"],["matStartDate","","placeholder","T\u1EEB ng\xE0y",3,"ngModelChange","dateChange","ngModel","ngModelOptions","disabled"],["matEndDate","","placeholder","\u0110\u1EBFn ng\xE0y",3,"ngModelChange","dateChange","ngModel","ngModelOptions","disabled"],["matIconSuffix","",3,"for"],["mat-button","","matDatepickerCancel",""],["mat-raised-button","","color","primary","matDatepickerApply","",3,"click"],["mat-raised-button","","color","primary",1,"h-14",3,"click","disabled"],[1,"mr-2"],[1,"flex","flex-wrap","gap-2"],[1,"text-sm","text-gray-600","mr-2","self-center"],["mat-button","",1,"text-sm",3,"click","disabled"],[1,"mt-4","p-3","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"flex","items-center","space-x-2"],[1,"text-blue-600"],[1,"text-blue-700","font-medium"],[1,"flex","flex-col","space-y-2","p-8"],[1,"flex","flex-row","space-x-2","items-center"],["mat-flat-button","","color","primary",3,"click","disabled"],[4,"ngIf"],["class","flex items-center",4,"ngIf"],["class","ml-1",4,"ngIf"],["type","file","accept",".xlsx,.xls",1,"hidden",3,"change","disabled"],["class","w-full p-4 bg-blue-50 rounded-lg border border-blue-200",4,"ngIf"],[1,"grid","grid-cols-3","gap-4"],[3,"class","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"w-full","flex","flex-col","space-y-2","p-8"],[1,"relative","w-full"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","w-full","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40","disabled:bg-gray-100","disabled:cursor-not-allowed",3,"keyup","disabled"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[4,"ngIf","ngIfElse"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","flex","flex-col","items-center","space-y-4"],["diameter","50","mode","indeterminate"],[1,"text-lg","font-medium"],[1,"flex","items-center"],["diameter","20","mode","indeterminate",1,"mr-2"],[1,"ml-1"],[1,"w-full","p-4","bg-blue-50","rounded-lg","border","border-blue-200"],["diameter","20","mode","indeterminate"],[1,"text-blue-700"],[3,"click"],[1,"w-full","flex","flex-col","space-y-2"],["class","w-full flex flex-row space-x-2 items-center border p-4 rounded-lg bg-gray-100 animate-pulse",4,"ngFor","ngForOf"],[1,"w-full","flex","flex-row","space-x-2","items-center","border","p-4","rounded-lg","bg-gray-100","animate-pulse"],[1,"rounded-lg","p-2","bg-gray-300","w-16","h-8"],[1,"bg-gray-300","h-4","w-1/3","rounded"],[1,"bg-gray-300","h-3","w-1/2","rounded"],[3,"class",4,"ngFor","ngForOf"],[1,"rounded-lg","p-2","bg-blue-100"],[1,"text-sm","text-gray-600"],[1,"w-full","flex","flex-row","items-center","justify-center","border","p-4","rounded-lg","bg-gray-100"],[1,"text-gray-600"]],template:function(t,e){if(t&1){let i=N();m(0,"div",4),k(1,Ve,5,1,"div",5),m(2,"div",6)(3,"div",7)(4,"div",8)(5,"div",9)(6,"mat-form-field",10)(7,"mat-label"),g(8,"Ch\u1ECDn kho\u1EA3ng th\u1EDDi gian"),l(),m(9,"mat-date-range-input",11)(10,"input",12),z("ngModelChange",function(c){return u(i),K(e.batdau,c)||(e.batdau=c),f(c)}),b("dateChange",function(){return u(i),f(e.onDateChange())}),l(),m(11,"input",13),z("ngModelChange",function(c){return u(i),K(e.ketthuc,c)||(e.ketthuc=c),f(c)}),b("dateChange",function(){return u(i),f(e.onDateChange())}),l()(),x(12,"mat-datepicker-toggle",14),m(13,"mat-date-range-picker",null,0)(15,"mat-datepicker-actions")(16,"button",15),g(17,"H\u1EE7y"),l(),m(18,"button",16),b("click",function(){return u(i),f(e.applyDateFilter())}),g(19,"\xC1p d\u1EE5ng"),l()()()(),m(20,"button",17),b("click",function(){return u(i),f(e.applyDateFilter())}),m(21,"mat-icon",18),g(22,"refresh"),l(),g(23," L\xE0m m\u1EDBi "),l()()(),m(24,"div",19)(25,"span",20),g(26,"Ch\u1ECDn nhanh:"),l(),m(27,"button",21),b("click",function(){return u(i),f(e.setDateRange("today"))}),g(28," H\xF4m nay "),l(),m(29,"button",21),b("click",function(){return u(i),f(e.setDateRange("yesterday"))}),g(30," H\xF4m qua "),l(),m(31,"button",21),b("click",function(){return u(i),f(e.setDateRange("last7days"))}),g(32," 7 ng\xE0y qua "),l(),m(33,"button",21),b("click",function(){return u(i),f(e.setDateRange("last30days"))}),g(34," 30 ng\xE0y qua "),l(),m(35,"button",21),b("click",function(){return u(i),f(e.setDateRange("thisMonth"))}),g(36," Th\xE1ng n\xE0y "),l(),m(37,"button",21),b("click",function(){return u(i),f(e.setDateRange("lastMonth"))}),g(38," Th\xE1ng tr\u01B0\u1EDBc "),l()()(),m(39,"div",22)(40,"div",23)(41,"mat-icon",24),g(42,"date_range"),l(),m(43,"span",25),g(44),ct(45,"date"),ct(46,"date"),l()()()(),m(47,"div",26)(48,"div",27)(49,"button",28),b("click",function(){return u(i),f(e.ExportExcel(e.TitleExport))}),k(50,$e,2,0,"span",29)(51,Ge,3,0,"span",30)(52,je,2,0,"mat-icon",31),l(),m(53,"button",28),b("click",function(){u(i);let c=A(60);return f(c.click())}),k(54,qe,2,0,"span",29)(55,Ue,3,0,"span",30)(56,We,2,0,"mat-icon",31),l(),m(57,"button",28),b("click",function(){return u(i),f(e.toggleAll())}),g(58," Ch\u1ECDn T\u1EA5t C\u1EA3 "),l(),m(59,"input",32,1),b("change",function(c){return u(i),f(e.ImportExcel(c))}),l()(),k(61,Qe,5,1,"div",33),m(62,"div",34),k(63,Je,4,7,"span",35),l()(),m(64,"div",36)(65,"div",37)(66,"input",38),b("keyup",function(c){return u(i),f(e.applyFilter(c))}),l(),m(67,"div",39)(68,"span",40),g(69,"search"),l()()(),k(70,ta,3,2,"ng-container",41)(71,na,3,2,"ng-template",null,2,gt),l()()}if(t&2){let i=A(14),n=A(72);p(),h("ngIf",e.isLoading()||e.isImporting()||e.isExporting()),p(8),h("rangePicker",i),p(),F("ngModel",e.batdau),h("ngModelOptions",$(40,be))("disabled",e.isLoading()||e.isImporting()||e.isExporting()),p(),F("ngModel",e.ketthuc),h("ngModelOptions",$(41,be))("disabled",e.isLoading()||e.isImporting()||e.isExporting()),p(),h("for",i),p(8),h("disabled",e.isLoading()||e.isImporting()||e.isExporting()),p(7),h("disabled",e.isLoading()||e.isImporting()||e.isExporting()),p(2),h("disabled",e.isLoading()||e.isImporting()||e.isExporting()),p(2),h("disabled",e.isLoading()||e.isImporting()||e.isExporting()),p(2),h("disabled",e.isLoading()||e.isImporting()||e.isExporting()),p(2),h("disabled",e.isLoading()||e.isImporting()||e.isExporting()),p(2),h("disabled",e.isLoading()||e.isImporting()||e.isExporting()),p(7),_t(" \u0110ang hi\u1EC3n th\u1ECB d\u1EEF li\u1EC7u t\u1EEB ",pt(45,34,e.batdau,"dd/MM/yyyy")," \u0111\u1EBFn ",pt(46,37,e.ketthuc,"dd/MM/yyyy")," "),p(5),h("disabled",e.isLoading()||e.isImporting()||e.isExporting()),p(),h("ngIf",!e.isExporting()),p(),h("ngIf",e.isExporting()),p(),h("ngIf",!e.isExporting()),p(),h("disabled",e.isLoading()||e.isImporting()||e.isExporting()),p(),h("ngIf",!e.isImporting()),p(),h("ngIf",e.isImporting()),p(),h("ngIf",!e.isImporting()),p(),h("disabled",e.isLoading()||e.isImporting()||e.isExporting()),p(2),h("disabled",e.isLoading()||e.isImporting()||e.isExporting()),p(2),h("ngIf",e.isLoading()),p(2),h("ngForOf",e.ListImportType())("ngForTrackBy",e.trackByFn),p(3),h("disabled",e.isLoading()||e.isImporting()||e.isExporting()),p(4),h("ngIf",e.isLoading())("ngIfElse",n)}},dependencies:[At,Nt,Pt,Tt,Ft,$t,Vt,Yt,vt,It,Z,J,Q,W,Kt,q,G,j,kt,at,Lt,tt,et,Rt,it,se,oe,ae,Ut,Wt,Qt,Xt,Jt,ee,te,Zt,Ct],encapsulation:2,changeDetection:0})};export{nt as a,_e as b};
