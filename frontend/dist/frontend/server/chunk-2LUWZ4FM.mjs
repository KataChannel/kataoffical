import './polyfills.server.mjs';
import{a as S}from"./chunk-DFZSGDC4.mjs";import{a as s}from"./chunk-6EFOJMAD.mjs";import{a as f}from"./chunk-VT4NXQX5.mjs";import{d as m}from"./chunk-N6ZUYKC5.mjs";import{Ra as i,ja as l,oa as g}from"./chunk-TKMPR5S6.mjs";import{a as h,j as r}from"./chunk-RIAI3ORJ.mjs";var w=class d{constructor(o,t,e){this._StorageService=o;this.router=t;this.timezoneService=e}ListDonhang=i([]);DetailDonhang=i({});page=i(1);pageCount=i(1);total=i(0);pageSize=i(50);donhangId=i(null);setDonhangId(o){this.donhangId.set(o)}ImportDonhangCu(o){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(o)},e=yield fetch(`${s.APIURL}/donhang/importold`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let n=yield e.json();return n.status==="duplicates_found"?{needsConfirmation:!0,message:n.message,duplicates:n.duplicates,pendingOrders:n.pendingOrders,processResults:n.processResults}:n}catch(t){throw console.error("Error in ImportDonhangCu:",t),t}})}ImportDonhangCuConfirmed(o,t){return r(this,null,function*(){try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify({pendingOrders:o,userChoice:t})},n=yield fetch(`${s.APIURL}/donhang/importold/confirmed`,e);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);let a=yield n.json();return a.status==="completed"&&a.success>0,a}catch(e){throw console.error("Error in ImportDonhangCuConfirmed:",e),e}})}ImportDonhang(o){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(o)},e=yield fetch(`${s.APIURL}/donhang/import`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let n=yield e.json();return e.ok,this.getAllDonhang(),this.donhangId.set(n.id),n}catch(t){return console.error(t)}})}DongboGia(o){return r(this,null,function*(){let t=o.map(e=>e.id);if(t.length===0)return{status:"error",message:"Kh\xF4ng c\xF3 \u0111\u01A1n h\xE0ng n\xE0o \u0111\u01B0\u1EE3c ch\u1ECDn \u0111\u1EC3 \u0111\u1ED3ng b\u1ED9 gi\xE1"};try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},n=yield fetch(`${s.APIURL}/donhang/dongbogia`,e);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);let a=yield n.json();return this.getAllDonhang(),a}catch(e){return console.error("L\u1ED7i khi \u0111\u1ED3ng b\u1ED9 gi\xE1:",e),{status:"error",message:e.message||"L\u1ED7i khi \u0111\u1ED3ng b\u1ED9 gi\xE1 t\u1EEB server"}}})}CreateDonhang(o){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(o)},e=yield fetch(`${s.APIURL}/donhang`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let n=yield e.json();return e.ok,this.getAllDonhang(),this.donhangId.set(n.id),n}catch(t){return console.error(t)}})}DagiaoDonhang(o){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(o)},e=yield fetch(`${s.APIURL}/donhang/${o.id}/dagiao`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let n=yield e.json();e.ok,console.log(n)}catch(t){return console.error(t)}})}getSLChogiao(o){return r(this,null,function*(){let t=h({},o);if(t.Batdau||t.Ketthuc){let e=this.timezoneService.getAPIDateRange(t.Batdau,t.Ketthuc);t.Batdau=e.Batdau,t.Ketthuc=e.Ketthuc}try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},n=yield fetch(`${s.APIURL}/donhang/getchogiao`,e);n.ok;let a=yield n.json();return this.ListDonhang.set(a.data),this.page.set(a.pageNumber),this.pageCount.set(a.totalPages),this.total.set(a.total),this.pageSize.set(a.pageSize),a}catch(e){return console.error(e)}})}searchDonhang(o){return r(this,null,function*(){let t=h({},o);if(t.Batdau||t.Ketthuc){let e=this.timezoneService.getAPIDateRange(t.Batdau,t.Ketthuc);t.Batdau=e.Batdau,t.Ketthuc=e.Ketthuc}try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},n=yield fetch(`${s.APIURL}/donhang/search`,e);n.ok;let a=yield n.json();return this.ListDonhang.set(a.data),this.page.set(a.pageNumber),this.pageCount.set(a.totalPages),this.total.set(a.total),this.pageSize.set(a.pageSize),a}catch(e){return console.error(e)}})}searchCongno(o){return r(this,null,function*(){let t=h({},o);if(t.Batdau||t.Ketthuc){let e=this.timezoneService.getAPIDateRange(t.Batdau,t.Ketthuc);t.Batdau=e.Batdau,t.Ketthuc=e.Ketthuc}try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},n=yield fetch(`${s.APIURL}/donhang/congnokhachhang`,e);n.ok;let a=yield n.json();return this.ListDonhang.set(a),a}catch(e){return console.error(e)}})}downloadCongno(o){return r(this,null,function*(){let t=h({},o);if(t.Batdau||t.Ketthuc){let e=this.timezoneService.getAPIDateRange(t.Batdau,t.Ketthuc);t.Batdau=e.Batdau,t.Ketthuc=e.Ketthuc}try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},n=yield fetch(`${s.APIURL}/donhang/downloadcongnokhachhang`,e);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);let a=n.headers.get("Content-Disposition"),p="CongNoKhachHang.xlsx";if(a){let u=a.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);u&&u[1]&&(p=u[1].replace(/['"]/g,""))}let T=yield n.blob(),y=window.URL.createObjectURL(T),c=document.createElement("a");return c.style.display="none",c.href=y,c.download=p,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(y),document.body.removeChild(c),{success:!0,filename:p}}catch(e){throw console.error("Error downloading congno:",e),e}})}Phieuchuyen(o){return r(this,null,function*(){let t=h({},o);if(t.Batdau||t.Ketthuc){let e=this.timezoneService.getAPIDateRange(t.Batdau,t.Ketthuc);t.Batdau=e.Batdau,t.Ketthuc=e.Ketthuc}try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(t)},n=yield fetch(`${s.APIURL}/donhang/phieuchuyen`,e);n.ok;let a=yield n.json();this.ListDonhang.set(a)}catch(e){return console.error(e)}})}Phieugiaohang(o){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(o)},e=yield fetch(`${s.APIURL}/donhang/phieugiao`,t);e.ok;let n=yield e.json();this.DetailDonhang.set(n)}catch(t){return console.error(t)}})}findbysanpham(o){return r(this,null,function*(){try{let t={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")}},e=yield fetch(`${s.APIURL}/donhang/findbysanpham/${o}`,t);return e.ok,yield e.json()}catch(t){return console.error(t)}})}getAllDonhang(){return r(this,null,function*(){try{let o={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")}},t=yield fetch(`${s.APIURL}/donhang`,o);t.ok;let e=yield t.json();this.ListDonhang.set(e)}catch(o){return console.error(o)}})}getDonhangByid(o){return r(this,null,function*(){try{let t={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")}},e=yield fetch(`${s.APIURL}/donhang/findid/${o}`,t);e.ok;let n=yield e.json();this.DetailDonhang.set(n)}catch(t){return console.error(t)}})}updateDonhang(o){return r(this,null,function*(){try{let t={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(o)},e=yield fetch(`${s.APIURL}/donhang/${o.id}`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let n=yield e.json();return e.ok,this.getAllDonhang(),this.getDonhangByid(o.id),n}catch(t){return console.error(t)}})}updatePhieugiao(o){return r(this,null,function*(){try{let t={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(o)},e=yield fetch(`${s.APIURL}/donhang/phieugiao/${o.id}`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let n=yield e.json();e.ok,this.Phieugiaohang({id:o.id})}catch(t){return console.error(t)}})}DeleteDonhang(o){return r(this,null,function*(){try{let t={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")}};(yield fetch(`${s.APIURL}/donhang/${o.id}`,t)).ok}catch(t){return console.error(t)}})}UpdateBulkDonhang(o){return r(this,null,function*(){try{let t={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(o)},e=yield fetch(`${s.APIURL}/donhang/bulk`,t);return e.ok,this.getAllDonhang(),yield e.json()}catch(t){return console.error(t)}})}DeleteBulkDonhang(o){return r(this,null,function*(){try{let t={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(o)},e=yield fetch(`${s.APIURL}/donhang/bulk`,t);return e.ok,this.getAllDonhang(),yield e.json()}catch(t){return console.error(t)}})}SearchField(o){return r(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(o)},e=yield fetch(`${s.APIURL}/donhang/searchfield`,t);e.ok;let n=yield e.json();return this.DetailDonhang.set(n),n}catch(t){return console.error(t)}})}static \u0275fac=function(t){return new(t||d)(g(f),g(m),g(S))};static \u0275prov=l({token:d,factory:d.\u0275fac,providedIn:"root"})};export{w as a};
