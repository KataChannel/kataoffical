import './polyfills.server.mjs';
import{a as ut}from"./chunk-URVMDN5Q.mjs";import"./chunk-EHIOJ53Q.mjs";import"./chunk-SOMYOCLA.mjs";import"./chunk-2NXSQI6I.mjs";import"./chunk-IGWB5VBO.mjs";import"./chunk-ZTR7BXUL.mjs";import"./chunk-3ELWWSJR.mjs";import"./chunk-4NNV6NE3.mjs";import{a as ct,b as gt}from"./chunk-SWYGK4UR.mjs";import"./chunk-BM52I7TD.mjs";import"./chunk-WJ2ZWVTC.mjs";import"./chunk-PE5EYNGJ.mjs";import{a as lt}from"./chunk-UDJCPRBF.mjs";import{h as et}from"./chunk-26WWJ5GO.mjs";import{a as dt}from"./chunk-7BHYQM75.mjs";import"./chunk-ZA5LSI2B.mjs";import{b as st}from"./chunk-AL3ZCZTD.mjs";import{d as pt}from"./chunk-SWDJOT3A.mjs";import{a as mt}from"./chunk-73IBRO6I.mjs";import"./chunk-KPN7Z3NE.mjs";import"./chunk-MGIVCIKU.mjs";import"./chunk-NCVHCAMC.mjs";import{a as K,b as X}from"./chunk-Q2K4SCD6.mjs";import{b as Q,g as Y,j as Z,n as tt,p as at,u as it,v as ot,x as rt,y as nt}from"./chunk-IQUZIOHZ.mjs";import"./chunk-SDPZX77S.mjs";import{a as u}from"./chunk-7ZQLLCLM.mjs";import{a as x,b as q}from"./chunk-KOBSONV6.mjs";import"./chunk-JSSZE7PS.mjs";import{a as H,c as G,e as J}from"./chunk-6HDYPSHY.mjs";import"./chunk-IDUXSRZE.mjs";import"./chunk-D22ASRXW.mjs";import"./chunk-7T6LZHUD.mjs";import{a as $,d as M}from"./chunk-2ATDIMG4.mjs";import"./chunk-CA6MWP3S.mjs";import{o as W,v as N}from"./chunk-6BL7Z2F4.mjs";import{Gb as O,Hc as m,Ic as z,Mc as y,Nb as j,Nc as v,Oc as w,Ra as g,Zb as h,hc as r,ia as k,ic as s,kc as F,lc as P,na as D,nc as b,oa as f,sc as C,tb as l,uc as I,ud as U,xa as _,ya as S}from"./chunk-GWTCN232.mjs";import"./chunk-KB5IWD3E.mjs";import{a as V,b as R,j as p}from"./chunk-RIAI3ORJ.mjs";var A=class n{socket;constructor(){this.socket=dt(`${u.APIURL}`,{transports:["websocket"],reconnectionAttempts:5,timeout:5e3})}getSocket(){return this.socket}static \u0275fac=function(t){return new(t||n)};static \u0275prov=k({token:n,factory:n.\u0275fac,providedIn:"root"})};var L=class n{constructor(e,t,a,i){this._StorageService=e;this.router=t;this._ErrorLogService=a;this._sharedSocketService=i;this.socket=this._sharedSocketService.getSocket(),this.listenImportdataUpdates()}socket;_snackBar=f(x);ListImportdata=g([]);DetailImportdata=g({});page=g(1);pageCount=g(1);total=g(0);pageSize=g(10);importdataId=g(null);initDB(){return p(this,null,function*(){return yield mt("ImportdataDB",4,{upgrade(e,t){t<1&&e.createObjectStore("importdatas",{keyPath:"id"}),t<3&&(e.objectStoreNames.contains("importdatas")&&e.deleteObjectStore("importdatas"),e.objectStoreNames.contains("pagination")&&e.deleteObjectStore("pagination"),e.createObjectStore("importdatas",{keyPath:"id"})),t<4}})})}saveImportdatas(e,t){return p(this,null,function*(){let i=(yield this.initDB()).transaction("importdatas","readwrite"),o=i.objectStore("importdatas");yield o.clear(),yield o.put({id:"data",importdatas:e,pagination:t}),yield i.done})}getCachedData(){return p(this,null,function*(){let t=yield(yield this.initDB()).get("importdatas","data");return t&&t.importdatas?{importdatas:t.importdatas,pagination:t.pagination||{page:1,pageCount:1,total:t.importdatas.length,pageSize:10}}:{importdatas:[],pagination:{page:1,pageCount:1,total:0,pageSize:10}}})}setImportdataId(e){this.importdataId.set(e)}CreateImportdata(e){return p(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(e)},a=yield fetch(`${u.APIURL}/importdata`,t);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);let i=yield a.json();this.getAllImportdata(this.pageSize()),this.importdataId.set(i.id)}catch(t){this._ErrorLogService.logError("Failed to CreateImportdata",t),console.error(t)}})}getAllImportdata(){return p(this,arguments,function*(e=this.pageSize(),t=!1){this.pageSize.set(e);let a=yield this.getCachedData(),i=this._StorageService.getItem("importdatas_updatedAt")||"0";if(!t&&a.importdatas.length>0&&Date.now()-new Date(i).getTime()<5*60*1e3)return this.ListImportdata.set(a.importdatas),this.page.set(a.pagination.page),this.pageCount.set(a.pagination.pageCount),this.total.set(a.pagination.total),this.pageSize.set(a.pagination.pageSize),a.importdatas;try{let o={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}};if(!t){let E=yield fetch(`${u.APIURL}/importdata/lastupdated`,o);if(!E.ok)return this.handleError(E.status),this.ListImportdata.set(a.importdatas),this.page.set(a.pagination.page),this.pageCount.set(a.pagination.pageCount),this.total.set(a.pagination.total),this.pageSize.set(a.pagination.pageSize),a.importdatas;let{updatedAt:B}=yield E.json();if(B<=i)return this.ListImportdata.set(a.importdatas),this.page.set(a.pagination.page),this.pageCount.set(a.pagination.pageCount),this.total.set(a.pagination.total),this.pageSize.set(a.pagination.pageSize),a.importdatas}let d=new URLSearchParams({page:this.page().toString(),limit:e.toString()}),T=yield fetch(`${u.APIURL}/importdata?${d}`,o);if(!T.ok)return this.handleError(T.status),this.ListImportdata.set(a.importdatas),this.page.set(a.pagination.page),this.pageCount.set(a.pagination.pageCount),this.total.set(a.pagination.total),this.pageSize.set(a.pagination.pageSize),a.importdatas;let c=yield T.json();if(yield this.saveImportdatas(c.data,{page:c.page||1,pageCount:c.pageCount||1,total:c.total||c.data.length,pageSize:e}),t)this._StorageService.setItem("importdatas_updatedAt",new Date().toISOString());else{let E=yield fetch(`${u.APIURL}/importdata/lastupdated`,o),{updatedAt:B}=yield E.json();this._StorageService.setItem("importdatas_updatedAt",B)}return this.ListImportdata.set(c.data),this.page.set(c.page||1),this.pageCount.set(c.pageCount||1),this.total.set(c.total||c.data.length),this.pageSize.set(e),c.data}catch(o){return this._ErrorLogService.logError("Failed to getAllImportdata",o),console.error(o),this.ListImportdata.set(a.importdatas),this.page.set(a.pagination.page),this.pageCount.set(a.pagination.pageCount),this.total.set(a.pagination.total),this.pageSize.set(a.pagination.pageSize),a.importdatas}})}getUpdatedCodeIds(){return p(this,null,function*(){try{let e={method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},t=yield fetch(`${u.APIURL}/importdata/updateCodeIds`,e);t.ok||this.handleError(t.status);let a=yield t.json();return this.getAllImportdata(this.pageSize()),a.data}catch(e){this._ErrorLogService.logError("Failed to getUpdatedCodeIds",e),console.error(e)}})}listenImportdataUpdates(){this.socket.off("importdata-updated"),this.socket.on("importdata-updated",()=>p(this,null,function*(){console.log("\u{1F504} D\u1EEF li\u1EC7u s\u1EA3n ph\u1EA9m thay \u0111\u1ED5i, c\u1EADp nh\u1EADt l\u1EA1i cache..."),this._StorageService.removeItem("importdatas_updatedAt"),yield this.getAllImportdata()}))}getImportdataBy(a){return p(this,arguments,function*(e,t=this.pageSize()){this.pageSize.set(t);try{let i={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(R(V({},e),{page:this.page(),limit:t}))},o=yield fetch(`${u.APIURL}/importdata/findby`,i);o.ok||this.handleError(o.status);let d=yield o.json();e.isOne===!0?this.DetailImportdata.set(d):(yield this.saveImportdatas(d.data,{page:d.page||1,pageCount:d.pageCount||1,total:d.total||d.data.length,pageSize:t}),this._StorageService.setItem("importdatas_updatedAt",new Date().toISOString()),this.ListImportdata.set(d.data),this.page.set(d.page||1),this.pageCount.set(d.pageCount||1),this.total.set(d.total||d.data.length),this.pageSize.set(t))}catch(i){this._ErrorLogService.logError("Failed to getImportdataBy",i),console.error(i);let o=yield this.getCachedData();e.isOne||(this.ListImportdata.set(o.importdatas),this.page.set(o.pagination.page),this.pageCount.set(o.pagination.pageCount),this.total.set(o.pagination.total),this.pageSize.set(o.pagination.pageSize))}})}updateImportdata(e){return p(this,null,function*(){try{let t={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`},body:JSON.stringify(e)},a=yield fetch(`${u.APIURL}/importdata/${e.id}`,t);a.ok||this.handleError(a.status);let i=yield a.json();this.getAllImportdata(this.pageSize()),this.getImportdataBy({id:i.id,isOne:!0},this.pageSize())}catch(t){this._ErrorLogService.logError("Failed to updateImportdata",t),console.error(t)}})}DeleteImportdata(e){return p(this,null,function*(){try{let t={method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this._StorageService.getItem("token")}`}},a=yield fetch(`${u.APIURL}/importdata/${e.id}`,t);a.ok||this.handleError(a.status),this.getAllImportdata(this.pageSize())}catch(t){this._ErrorLogService.logError("Failed to DeleteImportdata",t),console.error(t)}})}handleError(e){let t="L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh";switch(e){case 400:t="Th\xF4ng tin \u0111\xE3 t\u1ED3n t\u1EA1i";break;case 401:case 404:t="Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i";break;case 403:t="B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp";break;case 500:t="L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau";break}this._snackBar.open(t,"",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})}static \u0275fac=function(t){return new(t||n)(D(q),D(M),D(lt),D(A))};static \u0275prov=k({token:n,factory:n.\u0275fac,providedIn:"root"})};function St(n,e){if(n&1){let t=b();r(0,"button",1),C("click",function(){_(t);let i=I();return S(i.handleImportdataAction())}),r(1,"mat-icon"),m(2,"save"),s()()}}function ft(n,e){if(n&1){let t=b();r(0,"button",1),C("click",function(){_(t);let i=I();return S(i.toggleEdit())}),r(1,"mat-icon"),m(2,"edit"),s()()}}function Ct(n,e){if(n&1){let t=b();F(0),r(1,"div",8)(2,"div",9),m(3,"B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n xo\xE1 kh\xF4ng?"),s(),r(4,"div",10)(5,"button",11),C("click",function(){_(t);let i=I();return S(i.DeleteData())}),m(6,"\u0110\u1ED3ng \xDD"),s(),r(7,"button",12),C("click",function(){_(t);let i=I();return S(i.toggleDelete())}),m(8,"Hu\u1EF7 B\u1ECF"),s()()(),P()}}function yt(n,e){if(n&1){let t=b();F(0),r(1,"div",13)(2,"mat-form-field",14)(3,"mat-label"),m(4,"Ti\xEAu \u0110\u1EC1"),s(),r(5,"input",15),w("ngModelChange",function(i){_(t);let o=I();return v(o.DetailImportdata().name,i)||(o.DetailImportdata().name=i),S(i)}),s()(),r(6,"mat-form-field",14)(7,"mat-label"),m(8,"Nh\xF3m"),s(),r(9,"input",16),w("ngModelChange",function(i){_(t);let o=I();return v(o.DetailImportdata().group,i)||(o.DetailImportdata().group=i),S(i)}),s()(),r(10,"mat-form-field",14)(11,"mat-label"),m(12,"M\xE3 S\u1EA3n Ph\u1EA9m"),s(),r(13,"input",17),w("ngModelChange",function(i){_(t);let o=I();return v(o.DetailImportdata().codeId,i)||(o.DetailImportdata().codeId=i),S(i)}),s()(),r(14,"mat-form-field",18)(15,"mat-label"),m(16,"M\xF4 T\u1EA3"),s(),r(17,"textarea",19),w("ngModelChange",function(i){_(t);let o=I();return v(o.DetailImportdata().description,i)||(o.DetailImportdata().description=i),S(i)}),s()()(),P()}if(n&2){let t=I();l(5),y("ngModel",t.DetailImportdata().name),h("disabled",!t.isEdit()),l(4),y("ngModel",t.DetailImportdata().group),h("disabled",!t.isEdit()),l(4),y("ngModel",t.DetailImportdata().codeId),h("disabled",!0),l(4),y("ngModel",t.DetailImportdata().description),h("disabled",!t.isEdit())}}var It=class n{_ListImportdataComponent=f(ut);_ImportdataService=f(L);_route=f($);_router=f(M);_snackBar=f(x);constructor(){this._route.paramMap.subscribe(e=>{let t=e.get("id");this._ImportdataService.setImportdataId(t)}),U(()=>p(this,null,function*(){let e=this._ImportdataService.importdataId();e||(this._router.navigate(["/admin/importdata"]),this._ListImportdataComponent.drawer.close()),e==="new"?(this.DetailImportdata.set({}),this._ListImportdataComponent.drawer.open(),this.isEdit.update(t=>!t),this._router.navigate(["/admin/importdata","new"])):(yield this._ImportdataService.getImportdataBy({id:e,isOne:!0}),this._ListImportdataComponent.drawer.open(),this._router.navigate(["/admin/importdata",e]))}))}DetailImportdata=this._ImportdataService.DetailImportdata;isEdit=g(!1);isDelete=g(!1);importdataId=this._ImportdataService.importdataId;ngOnInit(){return p(this,null,function*(){})}handleImportdataAction(){return p(this,null,function*(){this.importdataId()==="new"?yield this.createImportdata():yield this.updateImportdata()})}createImportdata(){return p(this,null,function*(){try{yield this._ImportdataService.CreateImportdata(this.DetailImportdata()),this._snackBar.open("T\u1EA1o M\u1EDBi Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(e=>!e)}catch(e){console.error("L\u1ED7i khi t\u1EA1o importdata:",e)}})}updateImportdata(){return p(this,null,function*(){try{yield this._ImportdataService.updateImportdata(this.DetailImportdata()),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this.isEdit.update(e=>!e)}catch(e){console.error("L\u1ED7i khi c\u1EADp nh\u1EADt importdata:",e)}})}DeleteData(){return p(this,null,function*(){try{yield this._ImportdataService.DeleteImportdata(this.DetailImportdata()),this._snackBar.open("X\xF3a Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]}),this._router.navigate(["/admin/importdata"])}catch(e){console.error("L\u1ED7i khi x\xF3a importdata:",e)}})}goBack(){this._router.navigate(["/admin/importdata"]),this._ListImportdataComponent.drawer.close()}trackByFn(e,t){return t.id}toggleEdit(){this.isEdit.update(e=>!e)}toggleDelete(){this.isDelete.update(e=>!e)}FillSlug(){this.DetailImportdata.update(e=>(e.slug=pt(e.title),e))}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=O({type:n,selectors:[["app-detailimportdata"]],decls:14,vars:8,consts:[[1,"flex","flex-row","justify-between","items-center","space-x-2","p-2"],["mat-icon-button","","color","primary",3,"click"],[1,"font-bold"],[1,"flex","flex-row","space-x-2","items-center"],[3,"ngModelChange","ngModel","disabled"],["mat-icon-button","","color","primary",3,"click",4,"ngIf"],[1,"relative","flex","flex-col","w-full","p-4","overflow-auto"],[4,"ngIf"],[1,"flex","flex-col","space-y-4","items-center","justify-center"],[1,"font-bold","text-2xl"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","primary",3,"click"],["mat-flat-button","","color","warn",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["appearance","outline"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp Ti\xEAu \u0110\u1EC1",3,"ngModelChange","ngModel","disabled"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp Nh\xF3m",3,"ngModelChange","ngModel","disabled"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp M\xE3 S\u1EA3n Ph\u1EA9m",3,"ngModelChange","ngModel","disabled"],["appearance","outline",1,"lg:col-span-2"],["matInput","","placeholder","Vui l\xF2ng nh\u1EADp M\xF4 T\u1EA3",3,"ngModelChange","ngModel","disabled"]],template:function(t,a){if(t&1&&(r(0,"div",0)(1,"button",1),C("click",function(){return a.goBack()}),r(2,"mat-icon"),m(3,"arrow_back"),s()(),r(4,"div",2),m(5),s(),r(6,"div",3)(7,"mat-slide-toggle",4),w("ngModelChange",function(o){return v(a.DetailImportdata().isActive,o)||(a.DetailImportdata().isActive=o),o}),m(8),s(),j(9,St,3,0,"button",5)(10,ft,3,0,"button",5),s()(),r(11,"div",6),j(12,Ct,9,0,"ng-container",7)(13,yt,18,8,"ng-container",7),s()),t&2){let i;l(5),z(((i=a.DetailImportdata())==null?null:i.title)||"Kh\xF4ng c\xF3 d\u1EEF li\u1EC7u"),l(2),y("ngModel",a.DetailImportdata().isActive),h("disabled",!a.isEdit()),l(),z(a.DetailImportdata().isActive?"Hi\u1EC3n Th\u1ECB":"\u1EA8n"),l(),h("ngIf",a.isEdit()),l(),h("ngIf",!a.isEdit()),l(2),h("ngIf",a.isDelete()),l(),h("ngIf",!a.isDelete())}},dependencies:[ot,it,at,nt,rt,tt,Q,Y,Z,X,K,J,H,G,st,et,N,W,gt,ct],encapsulation:2})};export{It as DetailImportdataComponent};
