<div class="dashboard-container min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
    <div class="sticky top-0 z-10 bg-white/80 backdrop-blur-sm border-b border-gray-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                <div class="flex-1">
                    <div class="text-sm text-gray-600 mt-1" *ngIf="getSummaryStats().totalCount > 0">
                        <span class="flex flex-row items-center space-x-4">
                            <span class="flex items-center rounded-lg p-2 border bg-slate-50"><mat-icon>assessment</mat-icon>{{ getSummaryStats().totalCount|number:'1.0-2' }}</span>
                            <span class="flex items-center rounded-lg p-2 border bg-slate-50"><mat-icon>trending_up</mat-icon>{{ getSummaryStats().avgPerDay|number:'1.0-2' }}/ngày</span>
                            <span class="flex items-center rounded-lg p-2 border bg-slate-50"><mat-icon>date_range</mat-icon>{{ getSummaryStats().dateRange |number:'1.0-2' }}</span>
                        </span>
                    </div>
                </div>
                
                <!-- Controls -->
                <div class="flex flex-row items-center space-x-3">
                    <mat-form-field appearance="outline" [subscriptSizing]="'dynamic'" class="w-full">
                        <mat-label>{{ config.labels.timeRange }}</mat-label>
                        <mat-select [(value)]="selectedDateRange" (selectionChange)="onDateRangeChange()">
                            <mat-option *ngFor="let option of dateRangeOptions" [value]="option.value">
                                {{ option.label }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    
                    <div class="flex items-center space-x-2" *ngIf="selectedDateRange === 'custom'">
                        <mat-form-field appearance="outline" [subscriptSizing]="'dynamic'" class="w-36">
                            <mat-label>{{ config.labels.from }}</mat-label>
                            <input matInput [matDatepicker]="startPicker" [(ngModel)]="startDay" (dateChange)="onCustomDateChange()">
                            <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                            <mat-datepicker #startPicker></mat-datepicker>
                        </mat-form-field>
                        
                        <mat-form-field appearance="outline" [subscriptSizing]="'dynamic'" class="w-36">
                            <mat-label>{{ config.labels.to }}</mat-label>
                            <input matInput [matDatepicker]="endPicker" [(ngModel)]="endDay" (dateChange)="onCustomDateChange()">
                            <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                            <mat-datepicker #endPicker></mat-datepicker>
                        </mat-form-field>
                    </div>

                    <div class="flex flex-row items-center space-x-2">
                        <button mat-icon-button class="bg-white border border-gray-200 hover:bg-gray-50 shadow-sm" 
                                        (click)="refresh()" [matTooltip]="config.labels.refreshData">
                            <mat-icon class="text-gray-600">refresh</mat-icon>
                        </button>
                        <button mat-icon-button class="bg-white border border-gray-200 hover:bg-gray-50 shadow-sm" 
                                        (click)="exportData()" [matTooltip]="config.labels.exportData">
                            <mat-icon class="text-gray-600">download</mat-icon>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-6 py-6">
        <!-- Loading State -->
        <div *ngIf="isLoading" class="flex flex-col justify-center items-center h-96">
            <div class="relative">
                <div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600"></div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <mat-icon class="text-blue-600 text-lg">analytics</mat-icon>
                </div>
            </div>
            <p class="mt-4 text-gray-600 font-medium">{{ config.labels.loadingAnalytics }}</p>
        </div>

        <!-- Error State -->
        <div *ngIf="hasError && !isLoading" class="bg-red-50 border-l-4 border-red-400 p-6 mb-6 rounded-r-lg">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <mat-icon class="text-red-400">error_outline</mat-icon>
                </div>
                <div class="ml-3 flex-1">
                    <h3 class="text-sm font-medium text-red-800">{{ config.labels.errorLoadingData }}</h3>
                    <p class="mt-1 text-sm text-red-700">{{ errorMessage }}</p>
                </div>
                <button mat-icon-button (click)="clearError()" class="text-red-400 hover:text-red-600">
                    <mat-icon>close</mat-icon>
                </button>
            </div>
        </div>

        <!-- KPI Cards -->
        <div *ngIf="!isLoading && !hasError && getSummaryStats().totalCount > 0" 
                 class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">{{ config.labels.totalCount }}</p>
                        <p class="text-3xl font-bold text-gray-900 mt-2">{{ getSummaryStats().totalCount |number:'1.0-2'}}</p>
                        <p class="text-sm text-green-600 mt-1">↗ 12% so với kỳ trước</p>
                    </div>
                    <div class="p-3 bg-blue-50 rounded-lg">
                        <mat-icon class="text-blue-600">assessment</mat-icon>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">{{ config.labels.daysActive }}</p>
                        <p class="text-3xl font-bold text-gray-900 mt-2">{{ getSummaryStats().totalDays |number:'1.0-2'}}</p>
                        <p class="text-sm text-blue-600 mt-1">{{ getSummaryStats().dateRange |number:'1.0-2'}}</p>
                    </div>
                    <div class="p-3 bg-green-50 rounded-lg">
                        <mat-icon class="text-green-600">calendar_today</mat-icon>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">{{ config.labels.dailyAverage }}</p>
                        <p class="text-3xl font-bold text-gray-900 mt-2">{{ getSummaryStats().avgPerDay |number:'1.0-2'}}</p>
                        <p class="text-sm text-purple-600 mt-1">↗ 8% hiệu suất</p>
                    </div>
                    <div class="p-3 bg-purple-50 rounded-lg">
                        <mat-icon class="text-purple-600">trending_up</mat-icon>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">{{ config.labels.peakValue }}</p>
                        <p class="text-3xl font-bold text-gray-900 mt-2">{{ getMaxValue() }}</p>
                        <p class="text-sm text-orange-600 mt-1">{{ getMaxDay() }}</p>
                    </div>
                    <div class="p-3 bg-orange-50 rounded-lg">
                        <mat-icon class="text-orange-600">star</mat-icon>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div *ngIf="!isLoading && !hasError" class="grid grid-cols-1 xl:grid-cols-2 gap-8 mb-8">
            <!-- Bar Chart -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-100 bg-gray-50/50">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">{{ config.barChartTitle || config.barChart.title }}</h3>
                            <p class="text-sm text-gray-600 mt-1">{{ config.labels.temporalAnalysis }}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="p-2 bg-blue-50 rounded-lg">
                                <mat-icon class="text-blue-600 text-lg">bar_chart</mat-icon>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <apx-chart
                        [series]="barChartSeries"
                        [chart]="barChartOptions['chart']"
                        [xaxis]="barChartOptions['xaxis']"
                        [yaxis]="barChartOptions['yaxis']"
                        [title]="barChartOptions['title']"
                        [legend]="barChartOptions['legend']"
                        [colors]="barChartOptions['colors']"
                        [dataLabels]="barChartOptions['dataLabels']"
                        [grid]="barChartOptions['grid']"
                        [plotOptions]="barChartOptions['plotOptions']"
                    ></apx-chart>
                </div>
                
                <div class="px-6 pb-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="text-xs font-medium text-gray-500 uppercase tracking-wide">{{ config.labels.peakDay }}</div>
                            <div class="text-lg font-bold text-green-600 mt-1">{{ getMaxDay() }}</div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="text-xs font-medium text-gray-500 uppercase tracking-wide">{{ config.labels.peakValue }}</div>
                            <div class="text-lg font-bold text-blue-600 mt-1">{{ getMaxValue() }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pie Chart -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-100 bg-gray-50/50">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">{{ config.pieChartTitle || config.pieChart.title }}</h3>
                            <p class="text-sm text-gray-600 mt-1">{{ config.labels.categoryBreakdown }}</p>
                        </div>
                        <div class="p-2 bg-green-50 rounded-lg">
                            <mat-icon class="text-green-600 text-lg">pie_chart</mat-icon>
                        </div>
                    </div>
                </div>
                
                <div class="p-6">
                    <apx-chart
                        [series]="pieChartSeries"
                        [chart]="pieChartOptions['chart']"
                        [labels]="pieChartOptions['labels']"
                        [title]="pieChartOptions['title']"
                        [legend]="pieChartOptions['legend']"
                        [colors]="pieChartOptions['colors']"
                        [dataLabels]="pieChartOptions['dataLabels']"
                        [responsive]="pieChartOptions['responsive']"
                        [plotOptions]="pieChartOptions['plotOptions']"
                    ></apx-chart>
                </div>
                
                <div class="px-6 pb-6" *ngIf="pieChartSeries.length > 0">
                    <div class="space-y-3">
                        <div *ngFor="let label of pieChartOptions['labels']; let i = index" 
                                 class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 rounded-full" 
                                         [style.background-color]="pieChartOptions['colors'][i]"></div>
                                <span class="font-medium text-gray-900">{{ label }}</span>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-gray-900">{{ pieChartSeries[i] }}</div>
                                <div class="text-xs text-gray-500">
                                    {{ ((pieChartSeries[i] / getSummaryStats().totalCount) * 100).toFixed(1) }}%
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Details Section -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden" 
                 *ngIf="!isLoading && !hasError && Object_keys(chartData['categoryData']).length > 0">
            <div class="px-6 py-4 border-b border-gray-100 bg-gray-50/50">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">{{ config.labels.dataInsights }}</h3>
                        <p class="text-sm text-gray-600 mt-1">{{ config.labels.detailedBreakdown }}</p>
                    </div>
                    <mat-icon class="text-gray-400">insights</mat-icon>
                </div>
            </div>
            
            <div class="p-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Category Analysis -->
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
                            <mat-icon class="text-blue-600 mr-2 text-lg">category</mat-icon>
                            {{ config.labels.categoryDistribution }}
                        </h4>
                        <div class="space-y-3">
                            <div *ngFor="let item of chartData.categoryData | keyvalue" 
                                     class="flex justify-between items-center p-4 bg-gray-50 rounded-lg border border-gray-100 hover:bg-gray-100 transition-colors">
                                <div class="flex items-center space-x-3">
                                    <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                                    <span class="font-medium text-gray-900">{{ item.key }}</span>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold text-gray-900">{{ item.value }}</div>
                                    <div class="text-xs text-gray-500">
                                        {{ ((item.value / (chartData['totalCount'] || 1)) * 100).toFixed(1) }}%
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Time Analysis -->
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
                            <mat-icon class="text-green-600 mr-2 text-lg">schedule</mat-icon>
                            {{ config.labels.timeAnalytics }}
                        </h4>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg border border-gray-100">
                                <span class="text-gray-700">{{ config.labels.activeDays }}</span>
                                <span class="font-bold text-gray-900">{{ Object_keys(chartData.timeData || {}).length }}</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg border border-gray-100">
                                <span class="text-gray-700">{{ config.labels.peakPerformanceDay }}</span>
                                <span class="font-bold text-green-600">{{ getMaxDay() }}</span>
                            </div>
                            <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg border border-gray-100">
                                <span class="text-gray-700">{{ config.labels.highestValue }}</span>
                                <span class="font-bold text-blue-600">{{ getMaxValue() }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && !hasError && getSummaryStats().totalCount === 0" 
                 class="text-center py-16">
            <div class="max-w-md mx-auto">
                <div class="p-6 bg-gray-50 rounded-full w-24 h-24 mx-auto flex items-center justify-center mb-6">
                    <mat-icon class="text-gray-400 text-4xl">analytics</mat-icon>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">{{ config.labels.noDataAvailable }}</h3>
                <p class="text-gray-600 mb-6">{{ config.labels.noDataMessage }}</p>
                <div class="flex justify-center space-x-3">
                    <button mat-raised-button color="primary" (click)="refresh()">
                        <mat-icon class="mr-2">refresh</mat-icon>
                        {{ config.labels.refreshData }}
                    </button>
                    <button mat-stroked-button (click)="exportData()">
                        <mat-icon class="mr-2">file_download</mat-icon>
                        Xuất dữ liệu
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
