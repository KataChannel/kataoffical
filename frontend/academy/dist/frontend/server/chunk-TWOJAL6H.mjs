import './polyfills.server.mjs';
import{a as M}from"./chunk-4TTMPUHC.mjs";import{a as F}from"./chunk-HWJJGIIA.mjs";import"./chunk-BHSUXMGO.mjs";import"./chunk-Q3IKPCKX.mjs";import"./chunk-WZNDKZHB.mjs";import{a as U,b as R}from"./chunk-PUB4OMG6.mjs";import"./chunk-73IBRO6I.mjs";import"./chunk-CHLRJVWI.mjs";import"./chunk-XJTULM6M.mjs";import"./chunk-RBBE3QCJ.mjs";import"./chunk-E3SZSGH4.mjs";import{c as _,h as I}from"./chunk-JIZR74UN.mjs";import"./chunk-GYDCZ3V5.mjs";import"./chunk-YQEL642S.mjs";import{e as A}from"./chunk-F2TZDQKX.mjs";import{r as P}from"./chunk-RTV26RQZ.mjs";import{$b as b,Ab as k,Ac as v,Bc as D,Ic as C,Sb as T,Tb as w,Ub as y,Yb as B,_b as h,ac as t,bc as e,cc as l,ja as E,kd as L,nb as u,yc as i,zc as p}from"./chunk-IHTIFXQI.mjs";import"./chunk-KB5IWD3E.mjs";import{j as x}from"./chunk-RIAI3ORJ.mjs";var N=()=>["../"],O=(c,a)=>a.key;function $(c,a){if(c&1&&(t(0,"div")(1,"div",52)(2,"span",53),i(3),e(),t(4,"span",54),i(5),e()(),t(6,"div",55),l(7,"div",56),e()()),c&2){let n=a.$implicit;u(3),D("",n.key," (",n==null||n.value==null?null:n.value.count," )"),u(),y("text-blue-600",n.key==="Unknown")("text-green-600",n.key==="website")("text-teal-500",n.key==="whatsapp"),u(),v(" ",n==null||n.value==null?null:n.value.ratio," "),u(2),w("width",n==null||n.value==null?null:n.value.ratio),y("bg-blue-600",n.key==="Unknown")("bg-green-600",n.key==="website")("bg-teal-500",n.key==="whatsapp")}}function K(c,a){if(c&1&&(t(0,"tr")(1,"td",57)(2,"div",58),i(3),e()(),t(4,"td",57)(5,"div",58),i(6),e()()()),c&2){let n=a.$implicit;u(3),p(n.pageIdentifier),u(3),p(n.count)}}var j=class c{_TrackingService=E(M);_UserService=E(F);profile=this._UserService.profile;ListTracking=this._TrackingService.ListTracking;Unique=0;BounceRate=0;groupedByPlatform=[];groupByPages=[];constructor(){L(()=>x(this,null,function*(){yield this._UserService.getProfile(),yield this._TrackingService.getTrackingBy({refCode:this.profile().phone,eventType:"page_view"})}))}ngOnInit(){return x(this,null,function*(){yield this._TrackingService.getTrackingBy({refCode:this.profile().phone,eventType:"page_view"}),console.log(this.ListTracking()),this.Unique=this.ListTracking().reduce((r,d)=>(r.includes(d.ipAddress)||r.push(d.ipAddress),r),[]).length,console.log("Unique IPs:",this.Unique),this.BounceRate=this.calculateBounceRate(this.ListTracking()),console.log("Bounce Rate:",this.BounceRate);let a=this.ListTracking().length,n=this.ListTracking().reduce((r,d)=>{let s=d.sharePlatform||"Unknown";return r[s]=(r[s]||0)+1,r},{});this.groupedByPlatform=Object.entries(n).reduce((r,[d,s])=>(r.push({key:d,value:{count:s,ratio:a?(s/a*100).toFixed(2)+"%":"0%"}}),r),[]);let o=this.ListTracking().reduce((r,d)=>{let s=d.pageIdentifier||"Unknown";return r[s]=(r[s]||0)+1,r},{});this.groupByPages=Object.entries(o).map(([r,d])=>({pageIdentifier:r,count:d})),console.log("Tracking events grouped by pages:",this.groupByPages),console.log("Tracking events grouped by sharePlatform with counts and ratios:",this.groupedByPlatform)})}calculateBounceRate(a){a.sort((m,g)=>new Date(m.createdAt).getTime()-new Date(g.createdAt).getTime());let n=[],o=[],r=null,d=30*60*1e3,s=(m,g)=>m.ipAddress===g.ipAddress&&m.userAgent===g.userAgent;a.forEach(m=>{let g=new Date(m.createdAt);!r||g.getTime()-r.getTime()<=d&&s(m,a[o[0]])?o.push(a.indexOf(m)):(n.push(o),o=[a.indexOf(m)]),r=g}),o.length>0&&n.push(o);let S=n.filter(m=>m.length===1).length,f=n.length,q=f>0?S/f*100:0;return{totalSessions:f,bouncedSessions:S,bounceRate:q.toFixed(2)}}static \u0275fac=function(n){return new(n||c)};static \u0275cmp=k({type:c,selectors:[["app-luottruycap"]],decls:105,vars:5,consts:[[1,"container","mx-auto","md:p-8"],[1,"flex","flex-row","space-x-2","mb-6"],["mat-icon-button","","color","primary",3,"routerLink"],[1,"flex","flex-col"],[1,"text-xl","font-bold","text-gray-800"],[1,"text-gray-600"],[1,"mb-8","p-4","bg-white","rounded-lg","shadow"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between"],[1,"text-lg","font-semibold","text-gray-700","mb-3","sm:mb-0"],[1,"flex","flex-row","items-center","gap-2"],["id","filterDay",1,"date-filter-button","bg-gray-200","hover:bg-gray-300","text-gray-700","font-medium","p-2","rounded-md","text-sm"],[1,"fas","fa-calendar-day","mr-2"],["id","filterMonth",1,"date-filter-button","bg-gray-200","hover:bg-gray-300","text-gray-700","font-medium","p-2","rounded-md","text-sm","active"],[1,"fas","fa-calendar-alt","mr-2"],["id","filterCustom",1,"date-filter-button","bg-gray-200","hover:bg-gray-300","text-gray-700","font-medium","p-2","rounded-md","text-sm"],[1,"fas","fa-calendar-edit","mr-2"],["id","customDateRange",1,"mt-4","hidden"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","items-end"],["for","startDate",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","date","id","startDate","name","startDate",1,"date-input","mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-indigo-500","focus:ring-indigo-500","sm:text-sm","p-2"],["for","endDate",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","date","id","endDate","name","endDate",1,"date-input","mt-1","block","w-full","rounded-md","border-gray-300","shadow-sm","focus:border-indigo-500","focus:ring-indigo-500","sm:text-sm","p-2"],["id","applyCustomDate",1,"bg-indigo-600","hover:bg-indigo-700","text-white","font-medium","p-2","rounded-md","text-sm","h-10","md:mt-0","mt-4"],[1,"fas","fa-check","mr-2"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6","mb-8"],[1,"metric-card","bg-white","p-6","rounded-lg","shadow-md"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-gray-500"],[1,"text-3xl","font-bold","text-indigo-600"],[1,"bg-indigo-100","p-3","rounded-full"],[1,"fas","fa-eye","fa-2x","text-indigo-600"],[1,"text-xs","text-green-500","mt-2","flex","items-center"],[1,"fas","fa-arrow-up","mr-1"],[1,"text-3xl","font-bold","text-green-600"],[1,"bg-green-100","p-3","rounded-full"],[1,"fas","fa-users","fa-2x","text-green-600"],[1,"text-3xl","font-bold","text-red-600"],[1,"bg-red-100","p-3","rounded-full"],[1,"fas","fa-sign-out-alt","fa-2x","text-red-600"],[1,"text-xs","text-red-500","mt-2","flex","items-center"],[1,"lg:col-span-2","bg-white","p-6","rounded-lg","shadow-md"],[1,"text-xl","font-semibold","text-gray-700","mb-4"],[1,"chart-placeholder","h-64","md:h-80"],[1,"text-center"],[1,"bg-white","p-6","rounded-lg","shadow-md"],[1,"space-y-4"],[1,"chart-placeholder","h-40","mt-6"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"bg-white","divide-y","divide-gray-200"],[1,"flex","justify-between","mb-1"],[1,"text-sm","font-medium","text-gray-600"],[1,"text-sm","font-medium"],[1,"w-full","bg-gray-200","rounded-full","h-2.5"],[1,"h-2.5","rounded-full"],[1,"px-6","py-4","whitespace-nowrap"],[1,"text-sm","text-gray-900"]],template:function(n,o){n&1&&(t(0,"div",0)(1,"header",1)(2,"button",2)(3,"mat-icon"),i(4,"arrow_back"),e()(),t(5,"div",3)(6,"span",4),i(7,"Landing Page"),e(),t(8,"span",5),i(9,"T\u1ED5ng quan hi\u1EC7u su\u1EA5t c\xE1c trang \u0111\xEDch c\u1EE7a b\u1EA1n."),e()()(),t(10,"section",6)(11,"div",7)(12,"h2",8),i(13,"Ch\u1ECDn Khung Th\u1EDDi Gian"),e(),t(14,"div",9)(15,"button",10),l(16,"i",11),i(17,"1 Ng\xE0y "),e(),t(18,"button",12),l(19,"i",13),i(20,"1 Th\xE1ng "),e(),t(21,"button",14),l(22,"i",15),i(23,"T\xF9y Ch\u1EC9nh "),e()()(),t(24,"div",16)(25,"div",17)(26,"div")(27,"label",18),i(28,"T\u1EEB ng\xE0y"),e(),l(29,"input",19),e(),t(30,"div")(31,"label",20),i(32,"\u0110\u1EBFn ng\xE0y"),e(),l(33,"input",21),e(),t(34,"button",22),l(35,"i",23),i(36,"\xC1p D\u1EE5ng "),e()()()(),t(37,"main")(38,"section",24)(39,"div",25)(40,"div",26)(41,"div")(42,"p",27),i(43,"T\u1ED5ng L\u01B0\u1EE3t Truy C\u1EADp"),e(),t(44,"p",28),i(45),e()(),t(46,"div",29),l(47,"i",30),e()(),t(48,"p",31),l(49,"i",32),i(50," 12.5% so v\u1EDBi k\u1EF3 tr\u01B0\u1EDBc "),e()(),t(51,"div",25)(52,"div",26)(53,"div")(54,"p",27),i(55,"Kh\xE1ch Truy C\u1EADp Duy Nh\u1EA5t"),e(),t(56,"p",33),i(57),e()(),t(58,"div",34),l(59,"i",35),e()(),t(60,"p",31),l(61,"i",32),i(62," 8.2% so v\u1EDBi k\u1EF3 tr\u01B0\u1EDBc "),e()(),t(63,"div",25)(64,"div",26)(65,"div")(66,"p",27),i(67,"T\u1EF7 L\u1EC7 Tho\xE1t"),e(),t(68,"p",36),i(69),e()(),t(70,"div",37),l(71,"i",38),e()(),t(72,"p",39),l(73,"i",32),i(74," 1.5% so v\u1EDBi k\u1EF3 tr\u01B0\u1EDBc "),e()()(),t(75,"section",24)(76,"div",40)(77,"h2",41),i(78,"Ngu\u1ED3n L\u01B0u L\u01B0\u1EE3ng Truy C\u1EADp"),e(),t(79,"div",42)(80,"p",43),i(81,"Bi\u1EC3u \u0111\u1ED3 ngu\u1ED3n l\u01B0u l\u01B0\u1EE3ng s\u1EBD \u0111\u01B0\u1EE3c hi\u1EC3n th\u1ECB \u1EDF \u0111\xE2y."),e()()(),t(82,"div",44)(83,"h2",41),i(84,"Ph\xE2n Lo\u1EA1i N\u1EC1n T\u1EA3ng"),e(),t(85,"div",45),h(86,$,8,17,"div",null,O),e(),t(88,"div",46)(89,"p",43),i(90,"Bi\u1EC3u \u0111\u1ED3 tr\xF2n ph\xE2n lo\u1EA1i thi\u1EBFt b\u1ECB."),e()()()(),t(91,"section",44)(92,"h2",41),i(93,"Top Pages"),e(),t(94,"div",47)(95,"table",48)(96,"thead",49)(97,"tr")(98,"th",50),i(99," T\xEAn Trang "),e(),t(100,"th",50),i(101," L\u01B0\u1EE3t Truy C\u1EADp "),e()()(),t(102,"tbody",51),h(103,K,7,2,"tr",null,B),e()()()()()()),n&2&&(u(2),T("routerLink",C(4,N)),u(43),p(o.ListTracking().length),u(12),p(o.Unique),u(12),v("",o.BounceRate.bounceRate,"%"),u(17),b(o.groupedByPlatform),u(17),b(o.groupByPages))},dependencies:[I,_,R,U,A,P],encapsulation:2})};export{j as LuottruycapComponent};
