import './polyfills.server.mjs';
import{a as V}from"./chunk-OZ5TZNSP.mjs";import{a as Y}from"./chunk-KN5B4D3G.mjs";import{a as U}from"./chunk-2ZSG4AWB.mjs";import{b as G}from"./chunk-HIBA6322.mjs";import{e as j}from"./chunk-QRVKSKHK.mjs";import"./chunk-HGHNDPF3.mjs";import"./chunk-I3PZA4NJ.mjs";import{a as N}from"./chunk-XMQVCJUP.mjs";import"./chunk-BHSUXMGO.mjs";import"./chunk-6LCKZQQI.mjs";import"./chunk-FS4FU3AO.mjs";import"./chunk-UKWJ22GE.mjs";import"./chunk-KRQS444O.mjs";import{l as L}from"./chunk-NJAL5H76.mjs";import"./chunk-2KMZ2LCY.mjs";import"./chunk-5HQV52D7.mjs";import{b as $}from"./chunk-RSBZIAD3.mjs";import"./chunk-P5PGSOYK.mjs";import{c as k}from"./chunk-QFSP7GWT.mjs";import"./chunk-CREX4RSV.mjs";import"./chunk-WZNDKZHB.mjs";import{c as K}from"./chunk-2EZICOK7.mjs";import{h as O}from"./chunk-DZOJ3MMY.mjs";import"./chunk-TW4NJQ6Q.mjs";import{a as H,b as P}from"./chunk-VP3Z7BXH.mjs";import"./chunk-73IBRO6I.mjs";import"./chunk-CHLRJVWI.mjs";import"./chunk-7SZX35P7.mjs";import"./chunk-4FCKCVJ7.mjs";import"./chunk-KANEWG3T.mjs";import"./chunk-5SJGQGPR.mjs";import"./chunk-RBBE3QCJ.mjs";import"./chunk-LH44QK7D.mjs";import{c as B,h as R}from"./chunk-ALQ3QCOB.mjs";import"./chunk-FIP5O6F3.mjs";import"./chunk-JFOE3Z6Z.mjs";import"./chunk-O5AANXDJ.mjs";import{e as A}from"./chunk-SIJKCCPW.mjs";import{k as w,l as M,p as I,s as _}from"./chunk-H4WI6XN2.mjs";import{Ab as E,Ac as d,Gb as p,Ic as S,Lc as b,Mc as F,Nc as v,Pc as f,Sb as m,_c as T,ac as e,bc as n,cc as C,ja as g,lc as x,nb as r,yc as a,zc as l}from"./chunk-CVMPRFIT.mjs";import"./chunk-KB5IWD3E.mjs";import{j as y}from"./chunk-RIAI3ORJ.mjs";var Q=()=>["../"],X=(u,i,t)=>({"text-green-600":u,"text-yellow-600":i,"text-red-600":t}),q=(u,i,t,o)=>({"bg-green-100 text-green-800":u,"bg-yellow-100 text-yellow-800":i,"bg-red-100 text-red-800":t,"bg-gray-100 text-gray-800":o});function J(u,i){if(u&1&&(e(0,"tr",26)(1,"td",27)(2,"div",28)(3,"div",29),a(4),n(),e(5,"span",30),a(6),n()()(),e(7,"td",31),a(8),n(),e(9,"td",32),a(10),n(),e(11,"td",33),a(12),n()()),u&2){let t=i.$implicit,o=i.index,h=x();r(4),d(" ",o+1," "),r(2),l(t.phone),r(2),l(h.formatCurrency(t.totalRevenue)),r(2),l(h.formatCurrency(t.totalCommission)),r(2),l(t.transactions)}}function W(u,i){if(u&1&&(e(0,"div",34)(1,"div",35)(2,"div",36)(3,"div",37),a(4),n(),e(5,"div",38),a(6),n(),e(7,"div",39),a(8),n()(),e(9,"div",40)(10,"div",41),a(11),n(),e(12,"div",42),a(13),v(14,"date"),n()()()()),u&2){let t=i.$implicit,o=x();r(4),l(t.phone),r(2),l(o.formatCurrency(t.amount)),r(2),d("Hoa h\u1ED3ng: ",o.formatCurrency(t.commission),""),r(2),m("ngClass",b(9,X,t.status==="Ho\xE0n th\xE0nh",t.status==="\u0110ang x\u1EED l\xFD",t.status==="\u0110\xE3 h\u1EE7y")),r(),d(" ",t.status," "),r(2),d(" ",f(14,6,t.createdAt,"dd/MM/yyyy")," ")}}function Z(u,i){if(u&1&&(e(0,"tr",43)(1,"td",44),a(2),n(),e(3,"td",45),a(4),n(),e(5,"td",46),a(6),n(),e(7,"td",47)(8,"span",48),a(9),n()(),e(10,"td",47)(11,"span",49),a(12),n()(),e(13,"td",47),a(14),v(15,"date"),n()()),u&2){let t=i.$implicit,o=x();r(2),l(t.phone),r(2),l(o.formatCurrency(t.amount)),r(2),l(o.formatCurrency(t.commission)),r(3),d(" ",t.amount>0?(t.commission/t.amount*100).toFixed(1):"0","% "),r(2),m("ngClass",F(10,q,t.status==="Ho\xE0n th\xE0nh",t.status==="\u0110ang x\u1EED l\xFD",t.status==="\u0110\xE3 h\u1EE7y",!t.status)),r(),d(" ",t.status||"Kh\xF4ng x\xE1c \u0111\u1ECBnh"," "),r(2),l(f(15,7,t.createdAt,"dd/MM/yyyy HH:mm"))}}var z=class u{cdr=g(T);chartConfig={barChartTitle:"Doanh Thu Theo Th\u1EDDi Gian",pieChartTitle:"Ph\xE2n B\u1ED1 Ngu\u1ED3n Doanh Thu",barChart:{title:"Doanh Thu Theo Th\u1EDDi Gian",yAxisTitle:"Doanh Thu (VN\u0110)",seriesName:"Doanh Thu",color:"#4CAF50"},pieChart:{title:"Ph\xE2n B\u1ED1 Ngu\u1ED3n Doanh Thu",colors:["#4CAF50","#2196F3","#FF9800","#9C27B0","#E91E63","#F44336","#00BCD4","#3F51B5"]},labels:{dashboard:"B\u1EA3ng \u0111i\u1EC1u khi\u1EC3n",analytics:"Ph\xE2n t\xEDch doanh thu",totalCount:"T\u1ED5ng doanh thu",daysActive:"Ng\xE0y c\xF3 doanh thu",dailyAverage:"Trung b\xECnh/ng\xE0y",peakValue:"Cao nh\u1EA5t trong ng\xE0y",timeRange:"Kho\u1EA3ng th\u1EDDi gian",from:"T\u1EEB ng\xE0y",to:"\u0110\u1EBFn ng\xE0y",refreshData:"L\xE0m m\u1EDBi d\u1EEF li\u1EC7u",exportData:"Xu\u1EA5t d\u1EEF li\u1EC7u",loadingAnalytics:"\u0110ang t\u1EA3i d\u1EEF li\u1EC7u doanh thu...",errorLoadingData:"L\u1ED7i khi t\u1EA3i d\u1EEF li\u1EC7u doanh thu",noDataAvailable:"Kh\xF4ng c\xF3 doanh thu",noDataMessage:"Kh\xF4ng c\xF3 doanh thu trong kho\u1EA3ng th\u1EDDi gian \u0111\xE3 ch\u1ECDn. Th\u1EED \u0111i\u1EC1u ch\u1EC9nh b\u1ED9 l\u1ECDc ho\u1EB7c l\xE0m m\u1EDBi d\u1EEF li\u1EC7u.",categoryDistribution:"Ph\xE2n b\u1ED5 theo ngu\u1ED3n",temporalAnalysis:"Ph\xE2n t\xEDch theo th\u1EDDi gian",categoryBreakdown:"Chi ti\u1EBFt ngu\u1ED3n doanh thu",peakDay:"Ng\xE0y doanh thu cao nh\u1EA5t",timeAnalytics:"Ph\xE2n t\xEDch th\u1EDDi gian",activeDays:"Ng\xE0y c\xF3 ho\u1EA1t \u0111\u1ED9ng",peakPerformanceDay:"Ng\xE0y hi\u1EC7u su\u1EA5t cao nh\u1EA5t",highestValue:"Doanh thu cao nh\u1EA5t",dataInsights:"Th\xF4ng tin chi ti\u1EBFt doanh thu",detailedBreakdown:"Ph\xE2n t\xEDch chi ti\u1EBFt v\xE0 th\u1ED1ng k\xEA doanh thu"}};chartData={timeData:{},categoryData:{},totalCount:0};_UserService=g(N);_KhachhangService=g(U);_DoanhthuService=g(V);profile=this._UserService.profile;Doanhthus={data:[],totalRevenue:0,totalCommission:0,averageRevenue:0,activeCustomers:0};ngOnInit(){return y(this,null,function*(){yield this._UserService.getProfile();let i=this.profile()?.referrals?.map(t=>t.phone);this.Doanhthus=yield this._DoanhthuService.getDoanhthuBy({listphone:i,pageSize:9999}),console.log("Doanhthus:",this.Doanhthus),this.calculateStatistics(),this.processRevenueDataForChart(),this.cdr.detectChanges()})}calculateStatistics(){let i=this.Doanhthus.data;this.Doanhthus.totalRevenue=i.reduce((t,o)=>t+(o.amount||0),0),this.Doanhthus.totalCommission=i.reduce((t,o)=>t+(o.commission||0),0),this.Doanhthus.averageRevenue=i.length>0?this.Doanhthus.totalRevenue/i.length:0,this.Doanhthus.activeCustomers=[...new Set(i.map(t=>t.phone))].length}processRevenueDataForChart(){let i=this.Doanhthus.data,t=i.reduce((h,s)=>{let c=new Date(s.createdAt),D=`${c.getDate().toString().padStart(2,"0")}/${(c.getMonth()+1).toString().padStart(2,"0")}/${c.getFullYear()}`;return h[D]=(h[D]||0)+(s.amount||0),h},{}),o=i.reduce((h,s)=>{let c=s.status||s.source||"Kh\xF4ng x\xE1c \u0111\u1ECBnh";return h[c]=(h[c]||0)+(s.amount||0),h},{});this.chartData={timeData:t,categoryData:o,totalCount:this.Doanhthus.totalRevenue}}getSummaryStats(){return{totalRevenue:this.Doanhthus.totalRevenue,totalCommission:this.Doanhthus.totalCommission,averageRevenue:this.Doanhthus.averageRevenue,activeCustomers:this.Doanhthus.activeCustomers,totalTransactions:this.Doanhthus.data.length}}getTopCustomers(i=5){let t=this.Doanhthus.data.reduce((o,h)=>{let s=h.phone;return o[s]||(o[s]={phone:s,totalRevenue:0,totalCommission:0,transactions:0}),o[s].totalRevenue+=h.amount||0,o[s].totalCommission+=h.commission||0,o[s].transactions++,o},{});return Object.values(t).sort((o,h)=>h.totalRevenue-o.totalRevenue).slice(0,i)}refreshData(){return y(this,null,function*(){yield this.ngOnInit()})}exportData(){return{summary:this.getSummaryStats(),revenue:this.Doanhthus.data,chartData:this.chartData,config:this.chartConfig,topCustomers:this.getTopCustomers()}}formatCurrency(i){return new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(i)}formatDate(i){return`${i.getDate().toString().padStart(2,"0")}/${(i.getMonth()+1).toString().padStart(2,"0")}/${i.getFullYear()}`}static \u0275fac=function(t){return new(t||u)};static \u0275cmp=E({type:u,selectors:[["app-doanhthu"]],decls:62,vars:10,consts:[[1,"container","mx-auto","bg-gray-100"],[1,"flex","flex-row","space-x-2","mb-6","items-center"],["mat-icon-button","","color","primary",3,"routerLink"],[1,"flex","flex-col"],[1,"text-xl","font-bold","text-gray-800"],[1,"text-sm","text-gray-600"],[3,"chartData","config","rawData","dateField","categoryField"],[1,"mt-8","grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"p-6","rounded-lg","shadow-md","bg-white"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold","text-gray-700"],[1,"text-gray-400"],[1,"overflow-x-auto"],[1,"w-full"],[1,"bg-gray-100","text-gray-700"],[1,"p-3","text-left"],[1,"p-3","text-center"],["class","border-b hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],[1,"space-y-3","max-h-96","overflow-y-auto"],["class","p-3 border rounded-lg hover:bg-gray-50 transition-colors",4,"ngFor","ngForOf"],[1,"mt-8","p-6","bg-white","rounded-lg","shadow-md"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-200"],[1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-700","uppercase","whitespace-nowrap"],[1,"bg-white","divide-y","divide-gray-200"],["class","hover:bg-gray-50",4,"ngFor","ngForOf"],[1,"border-b","hover:bg-gray-50","transition-colors"],[1,"p-3"],[1,"flex","items-center","space-x-2"],[1,"w-6","h-6","rounded-full","bg-blue-100","flex","items-center","justify-center","text-xs","font-bold","text-blue-600"],[1,"font-medium"],[1,"p-3","text-center","font-semibold","text-green-600"],[1,"p-3","text-center","font-semibold","text-blue-600"],[1,"p-3","text-center","text-gray-600"],[1,"p-3","border","rounded-lg","hover:bg-gray-50","transition-colors"],[1,"flex","items-center","justify-between"],[1,"flex-1"],[1,"font-medium","text-gray-900"],[1,"text-sm","text-green-600"],[1,"text-xs","text-blue-500"],[1,"text-right"],[1,"text-sm","font-medium",3,"ngClass"],[1,"text-xs","text-gray-500"],[1,"hover:bg-gray-50"],[1,"px-6","py-4","whitespace-nowrap","font-medium","text-gray-900"],[1,"px-6","py-4","font-semibold","text-green-600"],[1,"px-6","py-4","font-semibold","text-blue-600"],[1,"px-6","py-4"],[1,"px-2","py-1","text-xs","bg-gray-100","text-gray-800","rounded-full"],[1,"px-2","py-1","text-xs","rounded-full",3,"ngClass"]],template:function(t,o){t&1&&(e(0,"div",0)(1,"header",1)(2,"button",2)(3,"mat-icon"),a(4,"arrow_back"),n()(),e(5,"div",3)(6,"span",4),a(7,"B\u1EA3ng \u0110i\u1EC1u Khi\u1EC3n Doanh Thu & Hoa H\u1ED3ng"),n(),e(8,"span",5),a(9,"Qu\u1EA3n l\xFD v\xE0 ph\xE2n t\xEDch doanh thu t\u1EEB gi\u1EDBi thi\u1EC7u kh\xE1ch h\xE0ng"),n()()(),C(10,"app-customchart",6),e(11,"div",7)(12,"div",8)(13,"div",9)(14,"h2",10),a(15,"Kh\xE1ch H\xE0ng H\xE0ng \u0110\u1EA7u"),n(),e(16,"mat-icon",11),a(17,"star"),n()(),e(18,"div",12)(19,"table",13)(20,"thead")(21,"tr",14)(22,"th",15),a(23,"S\u1ED1 \u0110i\u1EC7n Tho\u1EA1i"),n(),e(24,"th",16),a(25,"Doanh Thu"),n(),e(26,"th",16),a(27,"Hoa H\u1ED3ng"),n(),e(28,"th",16),a(29,"Giao D\u1ECBch"),n()()(),e(30,"tbody"),p(31,J,13,5,"tr",17),n()()()(),e(32,"div",8)(33,"div",9)(34,"h2",10),a(35,"Giao D\u1ECBch G\u1EA7n \u0110\xE2y"),n(),e(36,"mat-icon",11),a(37,"schedule"),n()(),e(38,"div",18),p(39,W,15,13,"div",19),n()()(),e(40,"div",20)(41,"div",9)(42,"h2",10),a(43,"Chi Ti\u1EBFt Doanh Thu & Hoa H\u1ED3ng"),n()(),e(44,"div",12)(45,"table",21)(46,"thead",22)(47,"tr")(48,"th",23),a(49,"S\u1ED1 \u0110i\u1EC7n Tho\u1EA1i"),n(),e(50,"th",23),a(51,"Doanh Thu"),n(),e(52,"th",23),a(53,"Hoa H\u1ED3ng"),n(),e(54,"th",23),a(55,"T\u1EF7 L\u1EC7 (%)"),n(),e(56,"th",23),a(57,"Tr\u1EA1ng Th\xE1i"),n(),e(58,"th",23),a(59,"Ng\xE0y"),n()()(),e(60,"tbody",24),p(61,Z,16,15,"tr",25),n()()()()()),t&2&&(r(2),m("routerLink",S(9,Q)),r(8),m("chartData",o.chartData)("config",o.chartConfig)("rawData",o.Doanhthus.data)("dateField","createdAt")("categoryField","status"),r(21),m("ngForOf",o.getTopCustomers(5)),r(8),m("ngForOf",o.Doanhthus.data.slice(0,10)),r(22),m("ngForOf",o.Doanhthus.data))},dependencies:[k,O,K,$,j,L,G,P,H,R,B,A,_,w,M,I,Y],encapsulation:2})};export{z as DoanhthuComponent};
