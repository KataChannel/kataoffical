import{b as N}from"./chunk-HW6X3SQM.js";import{D as A,a as y,d as T,m as D,o as S,w as E,y as O,z as w}from"./chunk-VPNH42Q6.js";import{j as h}from"./chunk-6DNLS54U.js";var q=new Map,V={activated:!1,tokenObservers:[]},G={initialized:!1,enabled:!1};function l(e){return q.get(e)||Object.assign({},V)}function H(){return G}var X="https://content-firebaseappcheck.googleapis.com/v1";var Y="exchangeDebugToken",M={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},ye=24*60*60*1e3;var b=class{constructor(r,t,n,o,i){if(this.operation=r,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=o,this.upperBound=i,this.pending=null,this.nextErrorWaitInterval=o,o>i)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(r){return h(this,null,function*(){this.stop();try{this.pending=new T,this.pending.promise.catch(t=>{}),yield J(this.getNextRun(r)),this.pending.resolve(),yield this.pending.promise,this.pending=new T,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(r){if(r)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function J(e){return new Promise(r=>{setTimeout(r,e)})}var Z={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},f=new S("appCheck","AppCheck",Z);function F(e){if(!l(e).activated)throw f.create("use-before-activation",{appName:e.name})}function K(n,o){return h(this,arguments,function*({url:e,body:r},t){let i={"Content-Type":"application/json"},c=t.getImmediate({optional:!0});if(c){let u=yield c.getHeartbeatsHeader();u&&(i["X-Firebase-Client"]=u)}let d={method:"POST",body:JSON.stringify(r),headers:i},a;try{a=yield fetch(e,d)}catch(u){throw f.create("fetch-network-error",{originalErrorMessage:u?.message})}if(a.status!==200)throw f.create("fetch-status-error",{httpStatus:a.status});let s;try{s=yield a.json()}catch(u){throw f.create("fetch-parse-error",{originalErrorMessage:u?.message})}let k=s.ttl.match(/^([\d.]+)(s)$/);if(!k||!k[2]||isNaN(Number(k[1])))throw f.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${s.ttl}`});let W=Number(k[1])*1e3,I=Date.now();return{token:s.token,expireTimeMillis:I+W,issuedAtTimeMillis:I}})}function L(e,r){let{projectId:t,appId:n,apiKey:o}=e.options;return{url:`${X}/projects/${t}/apps/${n}:${Y}?key=${o}`,body:{debug_token:r}}}var Q="firebase-app-check-database",ee=1,C="firebase-app-check-store";var m=null;function te(){return m||(m=new Promise((e,r)=>{try{let t=indexedDB.open(Q,ee);t.onsuccess=n=>{e(n.target.result)},t.onerror=n=>{var o;r(f.create("storage-open",{originalErrorMessage:(o=n.target.error)===null||o===void 0?void 0:o.message}))},t.onupgradeneeded=n=>{let o=n.target.result;switch(n.oldVersion){case 0:o.createObjectStore(C,{keyPath:"compositeKey"})}}}catch(t){r(f.create("storage-open",{originalErrorMessage:t?.message}))}}),m)}function re(e,r){return ne(oe(e),r)}function ne(e,r){return h(this,null,function*(){let n=(yield te()).transaction(C,"readwrite"),i=n.objectStore(C).put({compositeKey:e,value:r});return new Promise((c,d)=>{i.onsuccess=a=>{c()},n.onerror=a=>{var s;d(f.create("storage-set",{originalErrorMessage:(s=a.target.error)===null||s===void 0?void 0:s.message}))}})})}function oe(e){return`${e.options.appId}-${e.name}`}var p=new O("@firebase/app-check");function _(e,r){return D()?re(e,r).catch(t=>{p.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function B(){return H().enabled}function z(){return h(this,null,function*(){let e=H();if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var ie={error:"UNKNOWN_ERROR"};function se(e){return y.encodeString(JSON.stringify(e),!1)}function P(e,r=!1,t=!1){return h(this,null,function*(){let n=e.app;F(n);let o=l(n),i=o.token,c;if(i&&!g(i)&&(o.token=void 0,i=void 0),!i){let s=yield o.cachedTokenPromise;s&&(g(s)?i=s:yield _(n,void 0))}if(!r&&i&&g(i))return{token:i.token};let d=!1;if(B())try{o.exchangeTokenPromise||(o.exchangeTokenPromise=K(L(n,yield z()),e.heartbeatServiceProvider).finally(()=>{o.exchangeTokenPromise=void 0}),d=!0);let s=yield o.exchangeTokenPromise;return yield _(n,s),o.token=s,{token:s.token}}catch(s){return s.code==="appCheck/throttled"||s.code==="appCheck/initial-throttle"?p.warn(s.message):t&&p.error(s),v(s)}try{o.exchangeTokenPromise||(o.exchangeTokenPromise=o.provider.getToken().finally(()=>{o.exchangeTokenPromise=void 0}),d=!0),i=yield l(n).exchangeTokenPromise}catch(s){s.code==="appCheck/throttled"||s.code==="appCheck/initial-throttle"?p.warn(s.message):t&&p.error(s),c=s}let a;return i?c?g(i)?a={token:i.token,internalError:c}:a=v(c):(a={token:i.token},o.token=i,yield _(n,i)):a=v(c),d&&ue(n,a),a})}function ae(e){return h(this,null,function*(){let r=e.app;F(r);let{provider:t}=l(r);if(B()){let n=yield z(),{token:o}=yield K(L(r,n),e.heartbeatServiceProvider);return{token:o}}else{let{token:n}=yield t.getToken();return{token:n}}})}function ce(e,r,t,n){let{app:o}=e,i=l(o),c={next:t,error:n,type:r};if(i.tokenObservers=[...i.tokenObservers,c],i.token&&g(i.token)){let d=i.token;Promise.resolve().then(()=>{t({token:d.token}),$(e)}).catch(()=>{})}i.cachedTokenPromise.then(()=>$(e))}function j(e,r){let t=l(e),n=t.tokenObservers.filter(o=>o.next!==r);n.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=n}function $(e){let{app:r}=e,t=l(r),n=t.tokenRefresher;n||(n=le(e),t.tokenRefresher=n),!n.isRunning()&&t.isTokenAutoRefreshEnabled&&n.start()}function le(e){let{app:r}=e;return new b(()=>h(this,null,function*(){let t=l(r),n;if(t.token?n=yield P(e,!0):n=yield P(e),n.error)throw n.error;if(n.internalError)throw n.internalError}),()=>!0,()=>{let t=l(r);if(t.token){let n=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,o=t.token.expireTimeMillis-5*60*1e3;return n=Math.min(n,o),Math.max(0,n-Date.now())}else return 0},M.RETRIAL_MIN_WAIT,M.RETRIAL_MAX_WAIT)}function ue(e,r){let t=l(e).tokenObservers;for(let n of t)try{n.type==="EXTERNAL"&&r.error!=null?n.error(r.error):n.next(r)}catch{}}function g(e){return e.expireTimeMillis-Date.now()>0}function v(e){return{token:se(ie),error:e}}var R=class{constructor(r,t){this.app=r,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:r}=l(this.app);for(let t of r)j(this.app,t.next);return Promise.resolve()}};function de(e,r){return new R(e,r)}function he(e){return{getToken:r=>P(e,r),getLimitedUseToken:()=>ae(e),addTokenListener:r=>ce(e,"INTERNAL",r),removeTokenListener:r=>j(e.app,r)}}var fe="@firebase/app-check",pe="0.8.13";var ge="app-check",x="app-check-internal";function ke(){w(new E(ge,e=>{let r=e.getProvider("app").getImmediate(),t=e.getProvider("heartbeat");return de(r,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,r,t)=>{e.getProvider(x).initialize()})),w(new E(x,e=>{let r=e.getProvider("app-check").getImmediate();return he(r)},"PUBLIC").setInstantiationMode("EXPLICIT")),A(fe,pe)}ke();var me="app-check";var U=class{constructor(){return N(me)}};var Te=["localhost","0.0.0.0","127.0.0.1"],qe=typeof window<"u"&&Te.includes(window.location.hostname);export{U as a};
