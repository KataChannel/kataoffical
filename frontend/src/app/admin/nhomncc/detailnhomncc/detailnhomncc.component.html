<div class="flex flex-row justify-between items-center space-x-2 p-2">
  <button mat-icon-button color="primary" (click)="goBack()">
    <mat-icon>arrow_back</mat-icon>
  </button>
  <div class="font-bold">{{ DetailNhomncc()?.name || 'Kh√¥ng c√≥ d·ªØ li·ªáu' }}</div>
  <div class="flex flex-row space-x-2 items-center">
    <!-- Loading indicator -->
    <mat-spinner *ngIf="isLoading()" diameter="20"></mat-spinner>
    
    <mat-slide-toggle [(ngModel)]="DetailNhomncc().isActive" [disabled]="!isEdit() || isLoading()">
      {{DetailNhomncc().isActive?'Hi·ªÉn Th·ªã':'·∫®n'}}
    </mat-slide-toggle>
    <button mat-icon-button color="primary" *ngIf="isEdit()" [disabled]="isLoading()" (click)="handleNhomnccAction()">
      <mat-icon>save</mat-icon>
    </button>
    <button mat-icon-button color="primary" *ngIf="!isEdit()" [disabled]="isLoading()" (click)="toggleEdit()">
      <mat-icon>edit</mat-icon>
    </button>
    <button mat-icon-button color="warn" [disabled]="isLoading()" (click)="toggleDelete()">
      <mat-icon>delete</mat-icon>
    </button>
  </div>
</div>

<div class="relative flex flex-col w-full p-4 overflow-auto">
  <!-- X√°c nh·∫≠n X√≥a -->
  <ng-container *ngIf="isDelete()">
    <div class="flex flex-col space-y-4 items-center justify-center">
      <div class="font-bold text-2xl">B·∫°n ch·∫Øc ch·∫Øn mu·ªën xo√° kh√¥ng?</div>
      <div class="flex flex-row space-x-2 items-center justify-center">
        <button mat-flat-button color="primary" (click)="DeleteData()">ƒê·ªìng √ù</button>
        <button mat-flat-button color="warn" (click)="toggleDelete()">Hu·ª∑ B·ªè</button>
      </div>
    </div>
  </ng-container>

  <!-- Chi ti·∫øt Nhomncc -->
  <ng-container *ngIf="!isDelete()">
    <ng-container>
      <div class="w-full flex flex-col space-y-2">
        <mat-form-field appearance="outline">
          <mat-label>Nh√≥m Nh√† Cung C·∫•p</mat-label>
          <input matInput [(ngModel)]="DetailNhomncc().name"  
                 [disabled]="!isEdit() || isLoading()" 
                 placeholder="Vui l√≤ng nh·∫≠p Nh√≥m Nh√† Cung C·∫•p"/>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>M√¥ T·∫£</mat-label>
          <input matInput [(ngModel)]="DetailNhomncc().description"
                 [disabled]="!isEdit() || isLoading()" 
                 placeholder="Vui l√≤ng nh·∫≠p M√¥ T·∫£"/>
        </mat-form-field>
        <div class="flex flex-row flex-wrap gap-2">
        <button mat-flat-button [disabled]="!isEdit() || isLoading()" color="primary" [matMenuTriggerFor]="menu" #menuTrigger="matMenuTrigger">
          {{CheckListNcc.length}} Nh√† Cung C·∫•p
        </button>
        
        <!-- üîç Debug button -->
        <!-- <button mat-stroked-button color="accent" (click)="debugRelationUpdate()" *ngIf="isEdit()">
          Debug Relations
        </button> -->
           <mat-menu  #menu="matMenu">
               <div (click)="$event.stopPropagation()"  class="cursor-pointer flex flex-col space-y-4 p-3">                                        
               <div class="relative w-full">
                   <input type="text"
                       placeholder="T√¨m Ki·∫øm..." (keyup)="doFilterNcc($event)"
                       class="block w-full pl-10 pr-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg focus:border-blue-400 focus:ring-blue-400 focus:outline-none focus:ring focus:ring-opacity-40">
                   <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                       <span class="material-symbols-outlined text-gray-500">search</span>
                   </div>
               </div>
               <div class="w-full flex flex-col space-y-2 max-h-44 overflow-auto">
                       <div *ngFor="let item of FilterNcc; trackBy:trackByFn" (click)="ChosenNcc(item)" class="flex flex-row space-x-2 items-center p-2 rounded-lg hover:bg-slate-100">
                          <span *ngIf="CheckNcc(item)" class="material-symbols-outlined text-blue-600">check</span>                        
                           {{item.name}} ({{item.mancc}})
                       </div>
               </div>
               <div class="flex flex-row space-x-2 items-end justify-end">
                   <button mat-flat-button color="warn" (click)="menuTrigger.closeMenu()">ƒê√≥ng</button>
                   <button mat-flat-button color="primary" (click)="ApplyNcc(menuTrigger)">√Åp D·ª•ng</button>
               </div>
               </div>
           </mat-menu>
           @for (item of CheckListNcc; track $index) {
               <span class="flex whitespace-nowrap p-2 rounded-lg bg-slate-200 items-center">
                <span>{{item.name}}</span> 
                <span class="material-symbols-outlined text-red-600 cursor-pointer" (click)="RemoveNcc(item)">close</span>
              </span>
           }
        </div>
      </div>
     </ng-container>

  </ng-container>
</div>