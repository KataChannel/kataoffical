# Banggia Unique Constraint - Visual Guide

## ğŸ¯ Constraint Rule

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UNIQUE CONSTRAINT: mabanggia + batdau + ketthuc            â”‚
â”‚                                                             â”‚
â”‚  âœ… Allowed: Different combinations                         â”‚
â”‚  âŒ Blocked: Same mabanggia + same dates                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Valid Scenarios (Allowed)

### Scenario 1: Same mÃ£, Different dates
```
Record 1:  BG01 | 2025-10-01 | 2025-10-31  âœ…
Record 2:  BG01 | 2025-11-01 | 2025-11-30  âœ…
           â””â”€â”¬â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚          â””â”€â”€â”€ Different dates â”€â”€â”€â”˜
             Same mÃ£
```

### Scenario 2: Different mÃ£, Same dates
```
Record 1:  BG01 | 2025-10-01 | 2025-10-31  âœ…
Record 2:  BG02 | 2025-10-01 | 2025-10-31  âœ…
           â””â”€â”¬â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚            Same dates
             Different mÃ£
```

### Scenario 3: Same mÃ£, Overlapping dates (but not exact)
```
Record 1:  BG01 | 2025-10-01 | 2025-10-31  âœ…
Record 2:  BG01 | 2025-10-15 | 2025-11-15  âœ…
           â””â”€â”¬â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚          Different start/end (not exact match)
             Same mÃ£
```

---

## âŒ Invalid Scenarios (Blocked)

### Scenario: Exact Duplicate
```
Record 1:  BG01 | 2025-10-01 | 2025-10-31  âœ…
Record 2:  BG01 | 2025-10-01 | 2025-10-31  âŒ BLOCKED!
           â””â”€â”¬â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â”‚          â””â”€â”€â”€ Exact same â”€â”€â”€â”˜
             Same mÃ£

Error: "Báº£ng giÃ¡ vá»›i mÃ£ 'BG01' vÃ  khoáº£ng thá»i gian 
        tá»« 1/10/2025 Ä‘áº¿n 31/10/2025 Ä‘Ã£ tá»“n táº¡i!"
```

---

## ğŸ”„ Validation Flow

### Create New Banggia

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks "ThÃªm má»›i"                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User enters:                                             â”‚
â”‚  - MÃ£ báº£ng giÃ¡: BG01                                     â”‚
â”‚  - Báº¯t Ä‘áº§u: 01/10/2025                                   â”‚
â”‚  - Káº¿t thÃºc: 31/10/2025                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: checkBanggiaExists(BG01, 2025-10-01, ...)      â”‚
â”‚                                                          â”‚
â”‚ Query: Find Banggia WHERE                                â”‚
â”‚   - mabanggia = 'BG01'                                   â”‚
â”‚   - batdau = '2025-10-01'                                â”‚
â”‚   - ketthuc = '2025-10-31'                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
        â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Found records  â”‚      â”‚ No records       â”‚
â”‚ (Duplicate!)   â”‚      â”‚ (Unique!)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚
        â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ Show error  â”‚      â”‚ âœ… Create new    â”‚
â”‚                â”‚      â”‚                  â”‚
â”‚ "Báº£ng giÃ¡...  â”‚      â”‚ GraphQL: create  â”‚
â”‚  Ä‘Ã£ tá»“n táº¡i!" â”‚      â”‚    â†“             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ Database check   â”‚
                        â”‚    â†“             â”‚
                        â”‚ âœ… Success!      â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Update Existing Banggia

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User opens Banggia (ID: xxx)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User changes:                                            â”‚
â”‚  - MÃ£ â†’ BG02                                             â”‚
â”‚  - Dates remain same                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: checkBanggiaExists(BG02, dates, excludeId=xxx) â”‚
â”‚                                                          â”‚
â”‚ Query: Find Banggia WHERE                                â”‚
â”‚   - mabanggia = 'BG02'                                   â”‚
â”‚   - dates match                                          â”‚
â”‚   - id != xxx  â† Exclude current record                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
        â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Found OTHER    â”‚      â”‚ Only found self  â”‚
â”‚ record         â”‚      â”‚ or nothing       â”‚
â”‚ (Duplicate!)   â”‚      â”‚ (Unique!)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚
        â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ Show error  â”‚      â”‚ âœ… Update record â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ƒï¸ Database Structure

### Before (No Constraint)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Banggia Table                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id   â”‚ mabanggiaâ”‚ batdau     â”‚ ketthuc             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1    â”‚ BG01     â”‚ 2025-10-01 â”‚ 2025-10-31          â”‚ âœ…
â”‚ 2    â”‚ BG01     â”‚ 2025-10-01 â”‚ 2025-10-31          â”‚ âœ… Duplicate!
â”‚ 3    â”‚ BG02     â”‚ 2025-11-01 â”‚ 2025-11-30          â”‚ âœ…
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     âš ï¸ PROBLEM: Duplicates allowed!
```

### After (With Constraint)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Banggia Table                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id   â”‚ mabanggiaâ”‚ batdau     â”‚ ketthuc             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1    â”‚ BG01     â”‚ 2025-10-01 â”‚ 2025-10-31          â”‚ âœ…
â”‚ â”€â”€â”€â”€ â”‚ BG01     â”‚ 2025-10-01 â”‚ 2025-10-31          â”‚ âŒ BLOCKED
â”‚ 2    â”‚ BG02     â”‚ 2025-11-01 â”‚ 2025-11-30          â”‚ âœ…
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     âœ… FIXED: Duplicates prevented!

Constraint: UNIQUE(mabanggia, batdau, ketthuc)
```

---

## ğŸ“Š Indexes Performance

### Query Without Index
```
SELECT * FROM Banggia 
WHERE mabanggia = 'BG01' 
  AND batdau = '2025-10-01'
  AND ketthuc = '2025-10-31';

Execution: FULL TABLE SCAN (slow! âŒ)
Time: ~100ms for 1000 records
```

### Query With Index
```
SELECT * FROM Banggia 
WHERE mabanggia = 'BG01' 
  AND batdau = '2025-10-01'
  AND ketthuc = '2025-10-31';

Execution: INDEX SCAN (fast! âœ…)
Time: ~1ms for 1000 records

Indexes used:
1. unique_banggia_time_range (mabanggia, batdau, ketthuc)
2. Banggia_mabanggia_idx (mabanggia)
3. Banggia_batdau_ketthuc_idx (batdau, ketthuc)
```

---

## ğŸ”§ Duplicate Resolution

### Before Fix Script
```
Database State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BG24 | 2025-10-01 | 2025-10-31                â”‚
â”‚  â”œâ”€ ID: 693b9b8c... (Created: 21/5/2025)      â”‚ Old
â”‚  â””â”€ ID: cc845265... (Created: 15/9/2025)      â”‚ New
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         âš ï¸ 2 records with same key
```

### After Fix Script
```
Database State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BG24 | 2025-10-01 | 2025-10-31                â”‚
â”‚  â””â”€ ID: cc845265... (Created: 15/9/2025)      â”‚ âœ… Kept
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         âœ… Only 1 record (newest kept)

Deleted: ID 693b9b8c... (older record)
```

---

## ğŸ’¡ Examples in Practice

### Example 1: Monthly Price Lists
```
BG-JAN2025 | 2025-01-01 | 2025-01-31  âœ…
BG-FEB2025 | 2025-02-01 | 2025-02-28  âœ…
BG-MAR2025 | 2025-03-01 | 2025-03-31  âœ…

All unique! âœ…
```

### Example 2: Promotional Pricing
```
BG-PROMO   | 2025-12-01 | 2025-12-25  âœ… (Christmas)
BG-PROMO   | 2025-12-26 | 2025-12-31  âœ… (After Xmas)
BG-PROMO   | 2025-12-01 | 2025-12-25  âŒ BLOCKED!

Third one blocked - same mÃ£ and dates as first
```

### Example 3: Customer-Specific Pricing
```
BG-VIP-001 | 2025-01-01 | 2025-12-31  âœ…
BG-VIP-002 | 2025-01-01 | 2025-12-31  âœ…

Different mÃ£ â†’ Both allowed âœ…
```

---

## ğŸ¯ Key Points

1. **Combination is unique:** mabanggia + batdau + ketthuc
2. **Any difference allows:** Change ANY field â†’ allowed
3. **Exact match blocked:** All 3 same â†’ blocked
4. **Null values:** If any NULL â†’ multiple allowed
5. **Case sensitive:** "BG01" â‰  "bg01"
6. **Time precision:** Full datetime compared

---

**Visual aid for understanding the unique constraint implementation**
