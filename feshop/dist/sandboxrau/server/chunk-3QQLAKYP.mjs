import './polyfills.server.mjs';
import{a as Qe,b as qe,c as Je}from"./chunk-G42HC2RX.mjs";import{a as Ne,b as Ke,c as $}from"./chunk-IAE56G7T.mjs";import{e as Xe}from"./chunk-W2RVPRYW.mjs";import{a as Re,b as $e,c as Ue,d as He,e as We,f as ze,g as Ge,h as Ye}from"./chunk-EPF3IGWZ.mjs";import{a as Me,b as ve,c as we,d as xe}from"./chunk-OB6WK4UN.mjs";import{a as Be}from"./chunk-BGTLNYQX.mjs";import{a as Ve,b as Ie,c as S}from"./chunk-JA5FUANC.mjs";import{a as fe,b as he,c as Se,d as ye}from"./chunk-2SPWQTUK.mjs";import{b as Pe,c as je}from"./chunk-AN7XHSP3.mjs";import{a as at}from"./chunk-DMGGUUBV.mjs";import{b as _e,c as ge}from"./chunk-TMXDKQ3S.mjs";import{b as Fe}from"./chunk-2ORIYJC7.mjs";import{a as pe,g as de}from"./chunk-BSNIFGO2.mjs";import{b as se,g as me,j as ue,r as ce}from"./chunk-UB2O3VBN.mjs";import{a as Oe}from"./chunk-7LSZI76F.mjs";import{a as Ce,b as Te,c as Ee,d as be,f as De}from"./chunk-MBT5KBOH.mjs";import{g as N,i as R}from"./chunk-WJTKY5FD.mjs";import{a as Ae,c as ke,e as Le}from"./chunk-T3MZ2PZ5.mjs";import{_ as le}from"./chunk-T45AR7GG.mjs";import{a as h}from"./chunk-VMEWTXZI.mjs";import{b as oe,s as re,v as ae}from"./chunk-CKIW7MJC.mjs";import{n as ne,u as ie}from"./chunk-SJCEIPIQ.mjs";import{Ac as J,Bb as Y,Bc as Z,Ec as M,Fc as a,Gc as v,Hc as k,Ib as y,Ic as B,Lc as L,Mc as V,Nc as I,Oc as ee,Pc as C,Qc as te,Vb as K,Wb as g,Yc as X,bc as O,f as z,fa as G,fc as o,g as b,gc as r,hc as Q,la as D,lc as x,ob as m,pb as A,qc as d,sc as f,ua as u,va as c,zc as q}from"./chunk-T45FBOIK.mjs";import{a as j,g as rt,i as _}from"./chunk-AFOT676I.mjs";var et=rt(at());var F=class s{_menus=new b(null);_menu=new b(null);_totalCount=new b(null);get menus$(){return this._menus.asObservable()}get menu$(){return this._menu.asObservable()}get totalCount$(){return this._totalCount.asObservable()}SPREADSHEET_ID="1VghpYpLVKug07LJm1-pdcpeQcEoh5VaCOgBvOfQ0-L8";SPREADSHEET_APIKEY="AIzaSyCWh10EgrjVBm8qKpnsGOgXrIsT5uqroMc";constructor(){}getDrive(){return _(this,null,function*(){try{let e={method:"GET",headers:{"Content-Type":"application/json"}};return yield(yield fetch(`https://sheets.googleapis.com/v4/spreadsheets/${this.SPREADSHEET_ID}/values/Menu?key=${this.SPREADSHEET_APIKEY}`,e)).json()}catch(e){return console.error(e)}})}getAllMenu(){return _(this,null,function*(){try{let e={method:"GET",headers:{"Content-Type":"application/json"}},n=yield(yield fetch(`${h.APIURL}/menu`,e)).json();return this._menus.next(n),n}catch(e){return console.error(e)}})}getMenuBySlug(e){return _(this,null,function*(){try{let t={method:"GET",headers:{"Content-Type":"application/json"}},i=yield(yield fetch(`${h.APIURL}/menu/findslug/${e}`,t)).json();return this._menu.next(i),i}catch(t){return console.error(t)}})}getMenuByid(e){return _(this,null,function*(){try{let t={method:"GET",headers:{"Content-Type":"application/json"}},n=yield fetch(`${h.APIURL}/menu/findid/${e}`,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);let i=yield n.json();return this._menu.next(i),i}catch(t){return console.error(t)}})}SearchMenu(e){return _(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},n=yield fetch(`${h.APIURL}/menu/search`,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);let i=yield n.json();return this._menus.next(i.items),this._totalCount.next(i.totalCount),i}catch(t){return console.error(t)}})}CreateMenu(e){return _(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},n=yield fetch(`${h.APIURL}/menu`,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return yield n.json()}catch(t){return console.error(t)}})}UpdateMenu(e){return _(this,null,function*(){try{let t={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},n=yield fetch(`${h.APIURL}/menu/${e.id}`,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);let i=yield n.json();return this._menu.next(i),i}catch(t){return console.error(t)}})}DeleteMenu(e){return _(this,null,function*(){try{let t={method:"DELETE",headers:{"Content-Type":"application/json"}};return yield(yield fetch(`${h.APIURL}/menu/${e.id}`,t)).json()}catch(t){return console.error(t)}})}static \u0275fac=function(t){return new(t||s)};static \u0275prov=G({token:s,factory:s.\u0275fac,providedIn:"root"})};var st=["drawer"],mt=()=>[10,20,50],ut=s=>[s],U=()=>({standalone:!0});function ct(s,e){s&1&&(o(0,"span",41),a(1,"check_circle"),r())}function pt(s,e){s&1&&(o(0,"span",42),a(1,"cancel"),r())}function dt(s,e){if(s&1){let t=x();o(0,"mat-tree-node",36)(1,"a",37)(2,"div",38)(3,"span"),a(4),r(),o(5,"span",39),a(6),r()(),o(7,"div",40),d("click",function(){let i=u(t).$implicit,l=f();return c(l.ChangeStatus(i,"Status"))}),y(8,ct,2,0,"span",41)(9,pt,2,0,"span",42),r()()()}if(s&2){let t=e.$implicit;m(),g("routerLink",te(4,ut,t.id)),m(3),v(t.Title),m(2),v(t.Slug),m(2),O(t.Status==1?8:9)}}function _t(s,e){s&1&&(o(0,"span",41),a(1,"check_circle"),r())}function gt(s,e){s&1&&(o(0,"span",42),a(1,"cancel"),r())}function ft(s,e){if(s&1){let t=x();o(0,"mat-tree-node",43)(1,"div",44)(2,"div",38)(3,"span"),a(4),r(),o(5,"span",39),a(6),r()(),o(7,"div",40),d("click",function(){let i=u(t).$implicit,l=f();return c(l.ChangeStatus(i,"Status"))}),y(8,_t,2,0,"span",41)(9,gt,2,0,"span",42),r(),o(10,"span",45)(11,"span",27),a(12),r()()()()}if(s&2){let t=e.$implicit,n=f();m(4),v(t.Title),m(2),v(t.Slug),m(2),O(t.Status==1?8:9),m(2),K("aria-label","Toggle "+t.Title),m(2),v(n.treeControl.isExpanded(t)?"expand_more":"navigate_next")}}function ht(s,e){if(s&1&&(o(0,"mat-option",59),a(1),r()),s&2){let t=e.$implicit;g("value",t),m(),k(" ",t.Title," ")}}function St(s,e){if(s&1){let t=x();o(0,"div",46)(1,"div",47),a(2,"Th\xEAm M\u1EDBi"),r(),o(3,"div",48)(4,"div",49)(5,"mat-form-field",50)(6,"mat-label"),a(7,"Ti\xEAu \u0110\u1EC1"),r(),o(8,"input",51),I("ngModelChange",function(i){u(t);let l=f();return V(l.Detail.Title,i)||(l.Detail.Title=i),c(i)}),d("input",function(){u(t);let i=f();return c(i.FillSlug())}),r()(),o(9,"mat-form-field",50)(10,"mat-label"),a(11,"Slug"),r(),o(12,"input",52),I("ngModelChange",function(i){u(t);let l=f();return V(l.Detail.Slug,i)||(l.Detail.Slug=i),c(i)}),r()(),o(13,"mat-form-field",50)(14,"mat-label"),a(15,"Menu Cha"),r(),o(16,"input",53),d("input",function(i){u(t);let l=f();return c(l.FilterAuto(i))}),I("ngModelChange",function(i){u(t);let l=f();return V(l.ChooseMenuCha,i)||(l.ChooseMenuCha=i),c(i)}),d("ngModelChange",function(i){u(t);let l=f();return c(l.onAutoChange(i))}),r(),o(17,"mat-autocomplete",54,5),y(19,ht,2,2,"mat-option",55),r()()(),o(20,"div",56)(21,"button",57),a(22,"Hu\u1EF7"),r(),o(23,"button",58),a(24,"\u0110\u1ED3ng \xDD"),r()()()()}if(s&2){let t=M(18),n=f();m(8),L("ngModel",n.Detail.Title),g("ngModelOptions",C(9,U)),m(4),L("ngModel",n.Detail.Slug),g("ngModelOptions",C(10,U)),m(4),L("ngModel",n.ChooseMenuCha),g("ngModelOptions",C(11,U))("matAutocomplete",t),m(),g("displayWith",n.displayFn),m(2),g("ngForOf",n.FilterLists)}}function yt(s,e){s&1&&(o(0,"div",46)(1,"div",47),a(2,"Xo\xE1"),r(),o(3,"div",48)(4,"div",49),a(5," B\u1EA1n ch\u1EAFc ch\u1EAFn mu\u1ED1n Xo\xE1? "),r(),o(6,"div",56)(7,"button",57),a(8,"Hu\u1EF7"),r(),o(9,"button",58),a(10,"\u0110\u1ED3ng \xDD"),r()()()())}var Ze=class s{constructor(e,t,n){this.dialog=e;this._snackBar=t;this.http=n}Detail={};Lists={};ChooseMenuCha={};SelectItem={};FilterLists=[];pageSizeOptions=[5];Sitemap={loc:"",priority:""};SearchParams={pageSize:10,pageNumber:0};sidebarVisible=!1;_MenuService=D(F);_DanhmucService=D(Be);_googleSheetsDbService=D($);MenusDrive=[];_unsubscribeAll=new z;drawer;data;_transformer=(e,t)=>({expandable:!!e.children&&e.children.length>0,Title:e.Title,pid:e.pid,Slug:e.Slug,level:t});treeControl=new Re(e=>e.level,e=>e.expandable);treeFlattener=new Ye(this._transformer,e=>e.level,e=>e.expandable,e=>e.children);hasChild=(e,t)=>t.expandable;dataSource;ngOnInit(){return _(this,null,function*(){this._MenuService.getAllMenu(),this._MenuService.menus$.subscribe(e=>{e&&(console.log(e),this.Lists=this.FilterLists=e,this.dataSource=e)})})}displayFn(e){return e&&e.Title?e.Title:""}FilterAuto(e){let t=e.target.value;this.FilterLists=this.Lists.filter(n=>n.Title.toLowerCase().includes(t.toLowerCase()))}FillSlug(){this.Detail.Slug=this.ChooseMenuCha.Slug?this.ChooseMenuCha.Slug+"/"+N(this.Detail.Title):N(this.Detail.Title)}onAutoChange(e){this.Detail.pid=e.id,this.Detail.Slug=this.Detail.Slug?`${e.Slug}/${this.Detail.Slug}`:"",console.log(e),console.log(this.Detail.Slug),console.log(this.Detail)}LoadDrive(){return _(this,null,function*(){let e=yield this._MenuService.getDrive();this.MenusDrive=e?.values?.slice(1).map(t=>({id:t[0],Title:t[1],Slug:t[2],pid:t[3]})),console.log(this.MenusDrive)})}SyncDrive(){return _(this,null,function*(){this.MenusDrive.forEach(e=>{let t={};t.Title=e.Title,t.Slug=e.Slug,this._MenuService.CreateMenu(t)})})}GetTenDanhmuc(e){return this.Lists.find(t=>t.id_cat==e)?.Title}ChangeStatus(e,t){e[t]=e[t]==0?1:0,this._MenuService.UpdateMenu(e).then(()=>{this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{horizontalPosition:"end",verticalPosition:"top",panelClass:"success",duration:1e3})})}applyFilter(e){let t=e.target.value;t.length>1?this.FilterLists=this.Lists.items.filter(n=>n.Title.toLowerCase().includes(t)||n.Mota.toLowerCase().includes(t)):this.FilterLists=this.Lists.items}onPageChange(e){return _(this,null,function*(){console.log(e),this.SearchParams.pageSize=e.pageSize,this.SearchParams.pageNumber=e.pageIndex,this.Lists=yield this._MenuService.SearchMenu(this.SearchParams),this.FilterLists=this.Lists.items})}openDialog(e){this.dialog.open(e,{}).afterClosed().subscribe(n=>{n=="true"&&this._MenuService.CreateMenu(this.Detail).then(()=>this.ngOnInit())})}XoaDialog(e){this.dialog.open(e,{}).afterClosed().subscribe(n=>{n=="true"&&this._MenuService.DeleteMenu(this.SelectItem).then(()=>{this.Detail={},this.ngOnInit()})})}readExcelFile(e){let t=e.target.files[0],n=new FileReader;n.onload=i=>{let l=new Uint8Array(i.target.result),p=Ve(l,{type:"array"}),w=p.SheetNames[0],P=p.SheetNames[1],tt=p.Sheets[w],nt=p.Sheets[P],H=S.sheet_to_json(tt,{raw:!0}),W=S.sheet_to_json(nt,{raw:!0});console.log(H),console.log(R(W)),H.forEach((T,it)=>{setTimeout(()=>{let E={},Mt={Main:T.photo,Thumb:T.thumb};E.id=T.id,E.Giagoc=R(W).find(ot=>ot.idSP==T.id).children||[],this._MenuService.UpdateMenu(E),console.log(E)},100*it)})},n.readAsArrayBuffer(t)}writeExcelFile(){let e=[],t={};this.FilterLists.forEach(w=>{t.idSP=w.id,t.TenSP=w.Title,w.Giagoc.forEach(P=>{t=j(j({},t),P),e.push(t)})});let n=S.book_new(),i=S.json_to_sheet(this.FilterLists),l=S.json_to_sheet(e);S.book_append_sheet(n,i,"Menu"),S.book_append_sheet(n,l,"Giagoc");let p=Ie(n,{bookType:"xlsx",type:"array"});this.saveAsExcelFile(p,"Menu_"+(0,et.default)().format("DD_MM_YYYY"))}saveAsExcelFile(e,t){let n=new Blob([e],{type:"application/octet-stream"}),i=window.URL.createObjectURL(n),l=document.createElement("a");l.href=i,l.download=`${t}.xlsx`,l.click(),window.URL.revokeObjectURL(i),l.remove()}UpdateStatusMenu(e){e.Status=0,this._MenuService.UpdateMenu(e).then(()=>this.ngOnInit())}static \u0275fac=function(t){return new(t||s)(A(Ce),A(Oe),A(oe))};static \u0275cmp=Y({type:s,selectors:[["app-menu"]],viewQuery:function(t,n){if(t&1&&q(st,7),t&2){let i;J(i=Z())&&(n.drawer=i.first)}},features:[ee([{provide:Ke,useValue:"AIzaSyCWh10EgrjVBm8qKpnsGOgXrIsT5uqroMc"},$])],decls:83,vars:15,consts:[["drawer",""],["menu","matMenu"],["uploadfile",""],["dialogTemplate",""],["XoaTeamplate",""],["autoComplete","matAutocomplete"],["autosize","",1,"example-container","w-full","h-full"],["mode","side","position","end",1,"!flex","flex-col","flex-auto","min-w-0","relative","h-full","w-full"],[1,"relative","flex","flex-col","h-full","w-full","overflow-auto"],[1,"!flex","flex-col","flex-auto","min-w-0","relative","!h-[90vh]"],[1,"relative","flex","flex-col"],[1,"flex","justify-between","items-center","space-x-2","m-2","bg-white","p-3","rounded-lg"],[1,"flex","flex-row","space-x-3","justify-center","items-center"],[1,"relative","mt-1","lg:w-80"],["type","text","name","email","id","topbar-search","placeholder","T\xECm Ki\u1EBFm",1,"bg-gray-50","border","border-gray-300","text-gray-900","sm:text-sm","rounded-lg","focus:ring-2","focus:ring-fuchsia-50","focus:border-fuchsia-300","block","w-full","p-2.5",3,"keyup"],["mat-menu-item",""],[1,"flex","flex-row","space-x-2","items-center","justify-center",3,"click"],["matTooltip","Upload File",1,"material-symbols-outlined","text-xl"],[1,"text-xs"],["type","file",1,"hidden",3,"change"],["matTooltip","Drive",1,"material-symbols-outlined","text-xl"],[1,"flex","flex-col","items-center","p-2","text-center","justify-center","hover:bg-gray-200","rounded-lg",3,"click"],[1,"hidden","lg:flex","flex-row","space-x-3"],[1,"flex","flex-col","items-center","p-2","hover:bg-gray-200","rounded-lg",3,"click"],[1,"flex","flex-row","space-x-2","items-center"],["mat-flat-button","","color","primary"],[1,"flex","flex-row","items-center",3,"click"],[1,"material-symbols-outlined"],[1,"hidden","lg:flex"],["mat-icon-button","",1,"lg:!hidden","flex",3,"matMenuTriggerFor"],[1,"flex","flex-col","my-6","mx-2","rounded-lg","shadow-xl","shadow-gray-200"],[1,"!bg-white","rounded-lg","p-4",3,"dataSource","treeControl"],["matTreeNodePadding","",4,"matTreeNodeDef"],["matTreeNodePadding","","class","pl-2",4,"matTreeNodeDef","matTreeNodeDefWhen"],[1,"flex","justify-between","items-center","mx-4","mt-4","mb-6","bg-white","p-3","rounded-lg"],[1,"w-full",3,"page","pageSizeOptions","pageSize","pageIndex"],["matTreeNodePadding",""],["routerLinkActive","bg-gray-100 font-bold",1,"cursor-pointer","flex","flex-row","space-x-2","justify-between","p-3","w-full","rounded-lg","hover:bg-gray-200","hover:font-bold",3,"routerLink"],[1,"flex","flex-col","space-y-2"],[1,"italic"],[3,"click"],[1,"material-symbols-outlined","text-blue-500"],[1,"material-symbols-outlined","text-red-500"],["matTreeNodePadding","",1,"pl-2"],[1,"cursor-pointer","flex","flex-row","space-x-2","items-center","justify-between","p-3","w-full","rounded-lg","hover:bg-gray-100","hover:font-bold"],["mat-icon-button","","matTreeNodeToggle",""],[1,"lg:w-[40vw]","p-2","flex","flex-col","space-y-3"],["mat-dialog-title",""],["mat-dialog-content",""],[1,"flex","flex-col","w-full","space-y-4","lg:p-4"],["appearance","outline",1,"w-full"],["matInput","","placeholder","Ti\xEAu \u0110\u1EC1",3,"ngModelChange","input","ngModel","ngModelOptions"],["matInput","","placeholder","Slug",3,"ngModelChange","ngModel","ngModelOptions"],["type","text","matInput","","placeholder","Ch\u1ECDn Menu",3,"input","ngModelChange","ngModel","ngModelOptions","matAutocomplete"],[3,"displayWith"],[3,"value",4,"ngFor","ngForOf"],[1,"flex","flex-row","space-x-2","items-center","justify-center"],["mat-flat-button","","color","warn","mat-dialog-close","false"],["mat-flat-button","","color","primary","mat-dialog-close","true"],[3,"value"]],template:function(t,n){if(t&1){let i=x();o(0,"mat-drawer-container",6)(1,"mat-drawer",7,0)(3,"div",8),Q(4,"router-outlet"),r()(),o(5,"mat-drawer-content",9)(6,"div",10)(7,"div",11)(8,"div",12)(9,"div",13)(10,"input",14),d("keyup",function(p){return u(i),c(n.applyFilter(p))}),r()(),o(11,"mat-menu",null,1)(13,"button",15)(14,"div",16),d("click",function(){return u(i),c(n.writeExcelFile())}),o(15,"span",17),a(16,"file_download"),r(),o(17,"span",18),a(18,"Download"),r()()(),o(19,"button",15)(20,"div",16),d("click",function(){u(i);let p=M(26);return c(p.click())}),o(21,"span",17),a(22,"file_upload"),r(),o(23,"span",18),a(24,"Upload"),r(),o(25,"input",19,2),d("change",function(p){return u(i),c(n.readExcelFile(p))}),r()()(),o(27,"button",15)(28,"div",16),d("click",function(){return u(i),c(n.LoadDrive())}),o(29,"span",20),a(30,"cloud_download"),r(),o(31,"span",18),a(32),r()()(),o(33,"button",15)(34,"div",21),d("click",function(){return u(i),c(n.SyncDrive())}),o(35,"span",20),a(36,"cloud_sync"),r(),o(37,"span",18),a(38),r()()()(),o(39,"div",22)(40,"div",23),d("click",function(){return u(i),c(n.writeExcelFile())}),o(41,"span",17),a(42,"file_download"),r(),o(43,"span",18),a(44,"Download"),r()(),o(45,"div",23),d("click",function(){u(i);let p=M(26);return c(p.click())}),o(46,"span",17),a(47,"file_upload"),r(),o(48,"span",18),a(49,"Upload"),r(),o(50,"input",19,2),d("change",function(p){return u(i),c(n.readExcelFile(p))}),r()(),o(52,"div",21),d("click",function(){return u(i),c(n.LoadDrive())}),o(53,"span",20),a(54,"cloud_download"),r(),o(55,"span",18),a(56),r()(),o(57,"div",21),d("click",function(){return u(i),c(n.SyncDrive())}),o(58,"span",20),a(59,"cloud_sync"),r(),o(60,"span",18),a(61),r()()()(),o(62,"div",24)(63,"button",25)(64,"div",26),d("click",function(){u(i);let p=M(80);return c(n.openDialog(p))}),o(65,"span",27),a(66,"add"),r(),o(67,"span",28),a(68,"Th\xEAm"),r()()(),o(69,"button",29)(70,"span",27),a(71,"more_vert"),r()()()()(),o(72,"div",8)(73,"div",30)(74,"mat-tree",31),y(75,dt,10,6,"mat-tree-node",32)(76,ft,13,5,"mat-tree-node",33),r()()(),o(77,"div",34)(78,"mat-paginator",35),d("page",function(p){return u(i),c(n.onPageChange(p))}),r()()()(),y(79,St,25,12,"ng-template",null,3,X)(81,yt,11,0,"ng-template",null,4,X)}if(t&2){let i=M(12);m(32),k("Drive (",n.MenusDrive.length||0,")"),m(6),B("Sync (",(n.Lists==null||n.Lists.items==null?null:n.Lists.items.length)||0,"/",n.MenusDrive.length||0,")"),m(18),k("Drive (",n.MenusDrive.length||0,")"),m(5),B("Sync (",(n.Lists==null||n.Lists.items==null?null:n.Lists.items.length)||0,"/",n.MenusDrive.length||0,")"),m(8),g("matMenuTriggerFor",i),m(5),g("dataSource",n.dataSource)("treeControl",n.treeControl),m(2),g("matTreeNodeDefWhen",n.hasChild),m(2),g("pageSizeOptions",C(14,mt))("pageSize",n.SearchParams.pageSize)("pageSizeOptions",n.pageSizeOptions)("pageIndex",n.SearchParams.pageNumber)}},dependencies:[xe,ve,we,Me,ge,_e,de,pe,re,ye,he,fe,Se,ae,ie,ne,ce,se,me,ue,De,Te,Ee,be,Le,Ae,ke,je,Pe,Xe,Fe,le,Ne,Ge,Ue,He,ze,We,$e,Je,Qe,qe],encapsulation:2})};export{F as a,Ze as b};
