import './polyfills.server.mjs';
import{a as m}from"./chunk-AF4BUXQF.mjs";import{a}from"./chunk-VMEWTXZI.mjs";import{u as f}from"./chunk-CKIW7MJC.mjs";import{x as y}from"./chunk-SJCEIPIQ.mjs";import{Oa as g,fa as d,ka as h,o as i,wb as l}from"./chunk-T45FBOIK.mjs";import{i as n}from"./chunk-AFOT676I.mjs";var p=class{constructor(){}static isTokenExpired(r,t){if(!r||r==="")return!0;let e=this._getTokenExpirationDate(r);return t=t||0,e===null?!0:!(e.valueOf()>new Date().valueOf()+t*1e3)}static _b64decode(r){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="";if(r=String(r).replace(/=+$/,""),r.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let s=0,o,c,w=0;c=r.charAt(w++);~c&&(o=s%4?o*64+c:c,s++%4)?e+=String.fromCharCode(255&o>>(-2*s&6)):0)c=t.indexOf(c);return e}static _b64DecodeUnicode(r){return decodeURIComponent(Array.prototype.map.call(this._b64decode(r),t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))}static _urlBase64Decode(r){let t=r.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:{t+="==";break}case 3:{t+="=";break}default:throw Error("Illegal base64url string!")}return this._b64DecodeUnicode(t)}static _decodeToken(r){if(!r)return null;let t=r.split(".");if(t.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let e=this._urlBase64Decode(t[1]);if(!e)throw new Error("Cannot decode the token.");return JSON.parse(e)}static _getTokenExpirationDate(r){let t=this._decodeToken(r);if(!t.hasOwnProperty("exp"))return null;let e=new Date(0);return e.setUTCSeconds(t.exp),e}};var v=class u{constructor(r,t,e){this._StorageService=r;this.platformId=t;this.router=e;this.isBrowser=y(this.platformId)}_secret;_authenticated=!1;APIURL=a.APIURL;isBrowser;profile=l({});ListUser=l([]);User=l({});getUsers(){return n(this,null,function*(){try{let r={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")}},t=yield fetch(`${a.APIURL}/users`,r);if(!t.ok)if(t.status===401){let s=JSON.stringify({code:t.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:s}}),this.Dangxuat()}else if(t.status===403){let s=JSON.stringify({code:t.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:s}}),this.Dangxuat()}else if(t.status===500){let s=JSON.stringify({code:t.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}else{let s=JSON.stringify({code:t.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:s}})}let e=yield t.json();return this.ListUser.set(e),e}catch(r){return console.error(r)}})}getAdmin(){return n(this,null,function*(){try{let r={method:"GET",headers:{"Content-Type":"application/json"}};return yield(yield fetch(`${a.APIURL}/users/get/admin`,r)).json()}catch(r){return console.error(r)}})}Dangky(r){return n(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},e=yield fetch(`${a.APIURL}/users/dangky`,t);if(!e.ok)if(e.status===401){let o=JSON.stringify({code:e.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:o}}),this.Dangxuat()}else if(e.status===403){let o=JSON.stringify({code:e.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:o}}),this.Dangxuat()}else if(e.status===500){let o=JSON.stringify({code:e.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:o}})}else{let o=JSON.stringify({code:e.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:o}})}let s=yield e.json();return console.log(s),s}catch(t){return console.error(t)}})}getUserByid(r){return n(this,null,function*(){try{let t={method:"GET",headers:{"Content-Type":"application/json"}},e=yield fetch(`${a.APIURL}/users/findid/${r}`,t);if(!e.ok)if(e.status===401){let o=JSON.stringify({code:e.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:o}}),this.Dangxuat()}else if(e.status===403){let o=JSON.stringify({code:e.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:o}}),this.Dangxuat()}else if(e.status===500){let o=JSON.stringify({code:e.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:o}})}else{let o=JSON.stringify({code:e.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:o}})}let s=yield e.json();return this.User.set(s),s}catch(t){return console.error(t)}})}updateOneUser(r){return n(this,null,function*(){try{let t={method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(r)},e=yield fetch(`${a.APIURL}/users/${r.id}`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return yield e.json()}catch(t){return console.error(t)}})}changepass(r){return n(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},e=yield fetch(`${a.APIURL}/users/changepass`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return yield e.json()}catch(t){return console.error(t)}})}Randompass(r){return n(this,null,function*(){try{let t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},e=yield fetch(`${a.APIURL}/users/randompass`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let s=yield e.json();return console.log(s),s}catch(t){return console.error(t)}})}getProfile(){return n(this,null,function*(){try{let r={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")}},e=yield(yield fetch(`${a.APIURL}/users/profile`,r)).json();return this.profile.set(e),e}catch(r){return console.error(r)}})}set accessToken(r){this.isBrowser&&this._StorageService.setItem("token",r)}get accessToken(){return this.isBrowser?this._StorageService.getItem("token")??"":""}Dangnhap(r){return n(this,null,function*(){if(this._authenticated)return i([!1,"User \u0110\xE3 \u0110\u0103ng Nh\u1EADp"]);try{let t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},e=yield fetch(`${a.APIURL}/users/login`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let s=yield e.json();return s[0]==200&&(this._authenticated=!0,this.accessToken=s[1].access_token,console.log(s)),s}catch(t){return console.error(t)}})}LoginByGoogle(r){return n(this,null,function*(){if(this._authenticated)return i([!1,"User \u0110\xE3 \u0110\u0103ng Nh\u1EADp"]);try{let t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},e=yield fetch(`${a.APIURL}/users/loginbygoogle`,t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);let s=yield e.json();return this._authenticated=!0,this.accessToken=s[1].access_token,console.log(s),[!0,this.accessToken]}catch(t){return console.error(t)}})}checkDangnhap(){return this._authenticated?i(!0):!this.accessToken||this.accessToken==="undefined"?(this.isBrowser&&this._StorageService.removeItem("token"),i(!1)):p.isTokenExpired(this.accessToken)?i(!1):i(!0)}Dangxuat(){return this.isBrowser&&this._StorageService.removeItem("token"),this._authenticated=!1,i(!0)}static \u0275fac=function(t){return new(t||u)(h(m),h(g),h(f))};static \u0275prov=d({token:u,factory:u.\u0275fac,providedIn:"root"})};export{p as a,v as b};
