import './polyfills.server.mjs';
import{c}from"./chunk-WJTKY5FD.mjs";import{a as y}from"./chunk-AF4BUXQF.mjs";import{a as t}from"./chunk-VMEWTXZI.mjs";import{fa as g,g as s,la as u}from"./chunk-T45FBOIK.mjs";import{i as h}from"./chunk-AFOT676I.mjs";var l=class i{_LocalStorageService=u(y);_giohang=new s(null);_donhang=new s(null);_addonhangs=new s(null);_addonhang=new s(null);Donhang;get addonhangs$(){return this._addonhangs.asObservable()}get addonhang$(){return this._addonhang.asObservable()}get giohang$(){return this._giohang.asObservable()}get donhang$(){return this._donhang.asObservable()}getSoluongDon(){return h(this,null,function*(){try{let n={method:"GET",headers:{"Content-Type":"application/json"}},a=yield fetch(`${t.APIURL}/donhang/getSoluong`,n);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return(yield a.json())[1]}catch(n){return console.error(n)}})}getGiohangs(){return h(this,null,function*(){try{let n={method:"GET",headers:{"Content-Type":"application/json"}},a=yield fetch(`${t.APIURL}/giohang`,n);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);let o=yield a.json()}catch(n){return console.error(n)}})}getGiohangByUser(n){return h(this,null,function*(){try{let a={method:"GET",headers:{"Content-Type":"application/json"}},o=yield fetch(`${t.APIURL}/giohang/findUser/${n}`,a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let e=yield o.json();this._giohang.next(e)}catch(a){return console.error(a)}})}getAdDonhangs(){return h(this,null,function*(){try{let n={method:"GET",headers:{"Content-Type":"application/json"}},a=yield fetch(`${t.APIURL}/donhang`,n);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);let o=yield a.json();this._addonhangs.next(o)}catch(n){return console.error(n)}})}getAdDonhangByid(n){return h(this,null,function*(){try{let a={method:"GET",headers:{"Content-Type":"application/json"}},o=yield fetch(`${t.APIURL}/donhang/findid/${n}`,a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let e=yield o.json();this.DonHangAdmin(e)}catch(a){return console.error(a)}})}getDonhangByid(n){return h(this,null,function*(){try{let a={method:"GET",headers:{"Content-Type":"application/json"}},o=yield fetch(`${t.APIURL}/donhang/findid/${n}`,a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let e=yield o.json();this._donhang.next(e)}catch(a){return console.error(a)}})}getDonhangByMaDonHang(n){return h(this,null,function*(){try{let a={method:"GET",headers:{"Content-Type":"application/json"}},o=yield fetch(`${t.APIURL}/donhang/findmadonhang/${n}`,a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let e=yield o.json();return this._donhang.next(e),e}catch(a){return console.error(a)}})}getDonhangByUser(n){return h(this,null,function*(){this._donhang.next(this.Donhang);try{let a={method:"GET",headers:{"Content-Type":"application/json"}},o=yield fetch(`${t.APIURL}/donhang/findUser/${n}`,a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let e=yield o.json()}catch(a){return console.error(a)}})}UpdateGiamgia(n){return h(this,null,function*(){this._donhang.next(n),this.getDonhang()})}CreateDonhang(n){return h(this,null,function*(){n.Giohangs.Sanpham=n.Giohangs.Sanpham.map(a=>({id:a.id,id_cat:a.id_cat,Title:a.Title,Danhmuc:a.Danhmuc,Slug:a.Slug,Giachon:a.Giachon,Giagoc:a.Giagoc,Image:a.Image,Soluong:a.Soluong}));try{let a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},o=yield fetch(`${t.APIURL}/donhang`,a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return yield o.json()}catch(a){return console.error(a)}})}UpdateDonhang(n){return h(this,null,function*(){console.log(n);try{let a={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},o=yield fetch(`${t.APIURL}/donhang/${n.id}`,a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let e=yield o.json();return console.log(e),this._donhang.next(e),e}catch(a){return console.error(a)}})}DeleteDonhang(n){return h(this,null,function*(){try{let a={method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},o=yield fetch(`${t.APIURL}/donhang/${n.id}`,a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let e=yield o.json();return console.log(e),e}catch(a){return console.error(a)}})}addToCart(n){return h(this,null,function*(){if(console.log(n),!this.Donhang.hasOwnProperty("MaDonHang"))this.Donhang.Khachhang={Hoten:""},this.Donhang.Thanhtoan={},this.Donhang.Vanchuyen={Phivanchuyen:0},this.Donhang.Status=0,this.Donhang.Giohangs.Sanpham=[n],yield this.getDonhang(),this._donhang.next(this.Donhang);else{let a=this.Donhang.Giohangs.Sanpham.findIndex(o=>o.id===n.id&&o.Giachon?.id==n?.Giachon?.id);console.log(a),a!==-1?(this.Donhang.Giohangs.Sanpham[a].Soluong+=Number(n.Soluong),this.Donhang.Giohangs.Sanpham[a].Giachon.SLTT+=(Number(n.Soluong)*Number(n.Giachon.khoiluong)).toFixed(3)):this.Donhang.Giohangs.Sanpham.push(n),yield this.getDonhang(),this._donhang.next(this.Donhang)}})}Crement(n){return h(this,null,function*(){if(console.log(n),!this.Donhang.hasOwnProperty("MaDonHang"))this.Donhang.Khachhang={Hoten:""},this.Donhang.Thanhtoan={},this.Donhang.Vanchuyen={Phivanchuyen:0},this.Donhang.Status=0,this.Donhang.Giohangs.Sanpham=[n],this.getDonhang();else{let a=this.Donhang.Giohangs.Sanpham.findIndex(o=>o.id===n.id&&o.Giachon?.id==n?.Giachon?.id);a!==-1?(this.Donhang.Giohangs.Sanpham[a].Soluong=Number(n.Soluong),this.Donhang.Giohangs.Sanpham[a].Giachon.SLTT=(Number(n.Soluong)*Number(n.Giachon.khoiluong)).toFixed(3)):this.Donhang.Giohangs.Sanpham.push(n),this.getDonhang()}})}removeFromCart(n){return h(this,null,function*(){let a=this.Donhang.Giohangs.Sanpham.findIndex(o=>o.id===n.id&&o.Giachon?.id==n?.Giachon?.id);a!==-1&&this.Donhang.Giohangs.Sanpham.splice(a,1),this._donhang.next(this.Donhang)})}clearCart(){return h(this,null,function*(){this._donhang.next({Giohangs:{Sanpham:[]},Khachhang:{},Thanhtoan:{},Vanchuyen:{Phivanchuyen:0}})})}SearchDonhang(n){return h(this,null,function*(){try{let a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},e=yield(yield fetch(`${t.APIURL}/donhang/search`,a)).json();return this._donhang.next(e.items[0]),e}catch(a){return console.error(a)}})}getGiamgia(){if(this.Donhang.hasOwnProperty("Khuyenmai")){if(this.Donhang.Khuyenmai.Type.Value=="phantram")return this.Donhang.Giamgia=this.Donhang.SubTotal*(Number(this.Donhang.Khuyenmai.Value)/100),this.Donhang.Giamgia;this.Donhang.Khuyenmai.Value>this.Donhang.SubTotal?this.Donhang.Giamgia=0:this.Donhang.Giamgia=this.Donhang.Khuyenmai.Value}else this.Donhang.Giamgia=0}getSum(n,a,o){return o?n?.reduce((e,r)=>e+r[a]*r.Giachon[o],0)||0:n?.reduce((e,r)=>e+r[a],0)||0}getSumThucte(n,a,o){return o?n?.reduce((e,r)=>e+r[a]*r[o],0)||0:n?.reduce((e,r)=>e+r[a],0)||0}getDonhang(){return h(this,null,function*(){this.DonHangAdmin(this.Donhang)})}TinhGiamgia(n){return h(this,null,function*(){return n.hasOwnProperty("Khuyenmai")&&Object.entries(n.Khuyenmai).length!==0?n?.Khuyenmai?.Type?.Value=="phantram"?Number(n?.Khuyenmai?.Value)/100:Number(n?.Khuyenmai?.Value)>Number(n?.SubTotal)?0:n?.Khuyenmai?.Value:0})}DonHangSite(n){return h(this,null,function*(){n.MaDonHang=c((yield this.getSoluongDon())+1),n?.Khuyenmai?.Type?.Value=="free"?n.Vanchuyen.Phivanchuyen=0:n.Vanchuyen.Phivanchuyen=Math.round(n.Vanchuyen.Phivanchuyen/1e3)*1e3,n.Giamgia=yield this.TinhGiamgia(n),n.SubTotal=n.Giohangs.reduce((a,o)=>a+o.Soluong*o.Giachon?.gia,0),n.SubTotalTT=n.Giohangs.reduce((a,o)=>a+o.Giachon.SLTT*o.Giachon.GiaCoSo,0),n?.Khuyenmai?.Type?.Value=="phantram"?(n.Total=n.SubTotal*(1-Number(n.Giamgia))+n.Vanchuyen.Phivanchuyen,n.TotalTT=n.SubTotalTT*(1-Number(n.Giamgia))+n.Vanchuyen.Phivanchuyen):(n.Total=n.SubTotal+n.Vanchuyen.Phivanchuyen-n.Giamgia||0,n.TotalTT=n.SubTotalTT+n.Vanchuyen.Phivanchuyen-Number(n.Giamgia)||0),this._donhang.next(n),this._addonhang.next(n)})}DonHangAdmin(n){return h(this,null,function*(){n?.Giohangs?.Sanpham&&(n.MaDonHang||(n.MaDonHang=c((yield this.getSoluongDon())+1)),n?.Khuyenmai?.Type?.Value=="free"?n.Vanchuyen.Phivanchuyen=0:n.Vanchuyen.Phivanchuyen=Math.round(n.Vanchuyen.Phivanchuyen/1e3)*1e3,n.Giamgia=yield this.TinhGiamgia(n),n.SubTotal=n?.Giohangs?.Sanpham?.reduce((a,o)=>a+o.Soluong*o.Giachon?.gia,0),n.SubTotalTT=n?.Giohangs?.Sanpham?.reduce((a,o)=>a+o.Giachon.SLTT*o.Giachon.GiaCoSo,0),n?.Khuyenmai?.Type?.Value=="phantram"?(n.Total=n.SubTotal*(1-Number(n.Giamgia))+n.Vanchuyen.Phivanchuyen,n.TotalTT=n.SubTotalTT*(1-Number(n.Giamgia))+n.Vanchuyen.Phivanchuyen):(n.Total=n.SubTotal+n.Vanchuyen.Phivanchuyen-n.Giamgia||0,n.TotalTT=n.SubTotalTT+n.Vanchuyen.Phivanchuyen-Number(n.Giamgia)||0),this._donhang.next(n),this._addonhang.next(n))})}static \u0275fac=function(a){return new(a||i)};static \u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"})};export{l as a};
