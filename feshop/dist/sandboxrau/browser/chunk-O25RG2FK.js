import{a as O,b as In,c as Vn,d as Bn,e as jn,f as An,g as $n,h as Rn,i as Hn,j as On,k as Un,l as Xn,m as zn,n as Wn,o as qn,p as Kn,q as Qn,s as Jn,t as E}from"./chunk-G2W2EW2N.js";import{a as vn,b as Ln,c as on}from"./chunk-ZAG3K7T2.js";import{d as En}from"./chunk-PGBUMDHU.js";import{b as ne}from"./chunk-RYZLHJBJ.js";import{a as oe,b as ie}from"./chunk-OQYJVBVR.js";import{a as ce}from"./chunk-AUNJNMHO.js";import{b as en,c as bn}from"./chunk-G2JGHO3B.js";import{c as Pn}from"./chunk-OPSDER4V.js";import{a as Gn,c as yn,d as wn,g as nn,h as Dn}from"./chunk-HNUPK34J.js";import{b as fn,g as Cn,j as xn,l as Sn,r as Tn}from"./chunk-DXUZJIEG.js";import{a as Mn,b as kn,f as Fn}from"./chunk-L2LY7JSF.js";import{b as Yn}from"./chunk-7PW7EJWC.js";import{a as an,b as ee}from"./chunk-BALLAHYH.js";import{a as Zn}from"./chunk-UHVDGNAF.js";import{a as te}from"./chunk-47N5HEQD.js";import{c as tn,e as Nn}from"./chunk-ACURKAFZ.js";import{a as w}from"./chunk-KQPDVZYA.js";import{m as un,r as Z,s as dn}from"./chunk-UAZLFQKL.js";import{$b as N,Ac as hn,Bc as m,Cc as J,Dc as x,Fa as R,Fc as Y,Gb as d,Hb as cn,Hc as I,Ic as V,Jc as B,K as rn,Lc as j,Ob as mn,Pb as _n,Rc as G,Sb as f,Tc as y,Uc as gn,Zb as T,Zc as pn,_b as F,ac as v,bc as s,cc as l,dc as b,ec as L,fa as sn,fc as P,g as A,hb as W,hc as C,la as $,mb as _,mc as u,nb as H,oc as r,ua as h,va as g,vc as q,wc as K,xc as Q,zb as ln}from"./chunk-QJD4TKMG.js";import{g as le,i as S}from"./chunk-66YHNWRR.js";var U=class i{_sanphams=new A(null);_sanpham=new A(null);_totalCount=new A(null);get sanphams$(){return this._sanphams.asObservable()}get sanpham$(){return this._sanpham.asObservable()}get totalCount$(){return this._totalCount.asObservable()}constructor(){}getDrive(){return S(this,null,function*(){try{return yield(yield fetch("https://sheets.googleapis.com/v4/spreadsheets/1rCAjdZ22Y_btU9GmdMXX_UXP1iVPM1ByuIERrwcEzSg/values/Update?key=AIzaSyCWh10EgrjVBm8qKpnsGOgXrIsT5uqroMc",{method:"GET",headers:{"Content-Type":"application/json"}})).json()}catch(e){return console.error(e)}})}getAllSanpham(){return S(this,null,function*(){try{let e={method:"GET",headers:{"Content-Type":"application/json"}},o=yield(yield fetch(`${w.APIURL}/sanpham`,e)).json();return this._sanphams.next(o),o}catch(e){return console.error(e)}})}getSanphamBySlug(e){return S(this,null,function*(){try{let n={method:"GET",headers:{"Content-Type":"application/json"}},t=yield(yield fetch(`${w.APIURL}/sanpham/findslug/${e}`,n)).json();return this._sanpham.next(t),t}catch(n){return console.error(n)}})}getSanphamByid(e){return S(this,null,function*(){try{let n={method:"GET",headers:{"Content-Type":"application/json"}},o=yield fetch(`${w.APIURL}/sanpham/findid/${e}`,n);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let t=yield o.json();return this._sanpham.next(t),t}catch(n){return console.error(n)}})}SearchSanpham(e){return S(this,null,function*(){try{let n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},o=yield fetch(`${w.APIURL}/sanpham/search`,n);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let t=yield o.json();return this._sanphams.next(t.items),this._totalCount.next(t.totalCount),t}catch(n){return console.error(n)}})}CreateSanpham(e){return S(this,null,function*(){try{let n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},o=yield fetch(`${w.APIURL}/sanpham`,n);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let t=yield o.json();return console.log(t),t}catch(n){return console.error(n)}})}SyncSanpham(e){return S(this,null,function*(){try{let n={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},o=yield fetch(`${w.APIURL}/sanpham/sync`,n);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let t=yield o.json();return console.log(t),t}catch(n){return console.error(n)}})}UpdateSanpham(e){return S(this,null,function*(){let n=yield this.sanphams$.pipe(rn(1)).toPromise();try{let o={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},t=yield fetch(`${w.APIURL}/sanpham/${e.id}`,o);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let a=yield t.json();this._sanpham.next(a);let c=n.map(M=>M.id===a.id?a:M);return this._sanphams.next(c),a}catch(o){return console.error(o)}})}DeleteSanpham(e){return S(this,null,function*(){try{let n={method:"DELETE",headers:{"Content-Type":"application/json"}};return yield(yield fetch(`${w.APIURL}/sanpham/${e.id}`,n)).json()}catch(n){return console.error(n)}})}static \u0275fac=function(n){return new(n||i)};static \u0275prov=sn({token:i,factory:i.\u0275fac,providedIn:"root"})};var re=le(ce());var _e=["ChonSanphamDialog"],he=()=>[nn,Gn,yn,wn,en,Bn,An,Xn,Rn,jn,Wn,$n,zn,Hn,Un,On,qn,Qn,Kn,O,In,an,tn,fn,Sn,Cn,xn,un,Z],X=()=>({standalone:!0});function ge(i,e){if(i&1&&(s(0,"th",31),m(1),l()),i&2){let n=r().$implicit,o=r(2);_(),x("",o.ColumnName[n]," ")}}function pe(i,e){if(i&1){let n=C();s(0,"div",33)(1,"span"),m(2),l(),s(3,"button",17),u("click",function(){h(n);let t=r().$implicit,a=r(3);return g(a.Xoasanpham(t))}),s(4,"mat-icon"),m(5,"do_not_disturb_on"),l()()()}if(i&2){let n=r().index;_(2),x(" ",n+1," ")}}function ue(i,e){if(i&1&&b(0,"img",34),i&2){let n=r(2).$implicit,o=r().$implicit;f("src",n[o],W)}}function de(i,e){i&1&&b(0,"img",35)}function fe(i,e){if(i&1&&d(0,ue,1,1,"img",34)(1,de,1,0,"img",35),i&2){let n=r().$implicit,o=r().$implicit;T(n[o]?0:1)}}function Ce(i,e){if(i&1){let n=C();s(0,"mat-form-field",36)(1,"mat-label"),m(2,"Ghi Ch\xFA"),l(),s(3,"input",37),B("ngModelChange",function(t){h(n);let a=r(2).index,c=r(3);return V(c.Donhang.Giohangs[a].Ghichu,t)||(c.Donhang.Giohangs[a].Ghichu=t),g(t)}),l()()}if(i&2){let n=r(2).index,o=r(3);_(3),I("ngModel",o.Donhang.Giohangs[n].Ghichu),f("ngModelOptions",j(3,X))("placeholder","Ghi Ch\xFA")}}function xe(i,e){if(i&1&&m(0),i&2){let n=r(2).$implicit,o=r().$implicit;x(" ",n[o]||""," ")}}function Se(i,e){if(i&1&&d(0,Ce,4,4,"mat-form-field",36)(1,xe,1,1),i&2){let n=r(4);T(n.isEdit?0:1)}}function Te(i,e){if(i&1){let n=C();L(0),s(1,"button",41),u("click",function(){h(n);let t=r(3).index,a=r(3);return g(a.ChangeSoluong(t,"giam","Tongtien","Soluong"))}),s(2,"mat-icon"),m(3,"do_not_disturb_on"),l()(),s(4,"button",42),u("click",function(){h(n);let t=r(3).index,a=r(3);return g(a.ChangeSoluong(t,"tang","Tongtien","Soluong"))}),s(5,"mat-icon"),m(6,"add_circle"),l()(),P()}}function Ge(i,e){if(i&1){let n=C();s(0,"mat-form-field",38)(1,"input",39),u("change",function(t){h(n);let a=r(2).index,c=r(3);return g(c.onValueChange(t,a,"Soluong","Tongtien"))}),B("ngModelChange",function(t){h(n);let a=r(2).index,c=r(3);return V(c.Donhang.Giohangs[a].Soluong,t)||(c.Donhang.Giohangs[a].Soluong=t),g(t)}),l(),d(2,Te,7,0,"ng-container",40),l()}if(i&2){let n=r(2).index,o=r(3);_(),I("ngModel",o.Donhang.Giohangs[n].Soluong),f("ngModelOptions",j(3,X)),_(),f("ngIf",o.isShowCrease)}}function ye(i,e){if(i&1&&(m(0),G(1,"number")),i&2){let n=r(2).$implicit,o=r().$implicit;x(" ",y(1,1,n[o]||0,"1.0-2")," ")}}function we(i,e){if(i&1&&d(0,Ge,3,4,"mat-form-field",38)(1,ye,2,4),i&2){let n=r(4);T(n.isEdit?0:1)}}function De(i,e){if(i&1){let n=C();L(0),s(1,"button",41),u("click",function(){h(n);let t=r(3).index,a=r(3);return g(a.ChangeSoluong(t,"giam","TongtienG","SLTG"))}),s(2,"mat-icon"),m(3,"do_not_disturb_on"),l()(),s(4,"button",42),u("click",function(){h(n);let t=r(3).index,a=r(3);return g(a.ChangeSoluong(t,"tang","TongtienG","SLTG"))}),s(5,"mat-icon"),m(6,"add_circle"),l()(),P()}}function be(i,e){if(i&1){let n=C();s(0,"mat-form-field",38)(1,"input",39),u("change",function(t){h(n);let a=r(2).index,c=r(3);return g(c.onValueChange(t,a,"SLTG","TongtienG"))}),B("ngModelChange",function(t){h(n);let a=r(2).index,c=r(3);return V(c.Donhang.Giohangs[a].SLTG,t)||(c.Donhang.Giohangs[a].SLTG=t),g(t)}),l(),d(2,De,7,0,"ng-container",40),l()}if(i&2){let n=r(2).index,o=r(3);_(),I("ngModel",o.Donhang.Giohangs[n].SLTG),f("ngModelOptions",j(3,X)),_(),f("ngIf",o.isShowCrease)}}function Ee(i,e){if(i&1&&(m(0),G(1,"number")),i&2){let n=r(2).$implicit,o=r().$implicit;x(" ",y(1,1,n[o]||0,"1.0-2")," ")}}function Me(i,e){if(i&1&&d(0,be,3,4,"mat-form-field",38)(1,Ee,2,4),i&2){let n=r(4);T(n.isEdit?0:1)}}function ke(i,e){if(i&1){let n=C();L(0),s(1,"button",41),u("click",function(){h(n);let t=r(3).index,a=r(3);return g(a.ChangeSoluong(t,"giam","TongtienN","SLTN"))}),s(2,"mat-icon"),m(3,"do_not_disturb_on"),l()(),s(4,"button",42),u("click",function(){h(n);let t=r(3).index,a=r(3);return g(a.ChangeSoluong(t,"tang","TongtienN","SLTN"))}),s(5,"mat-icon"),m(6,"add_circle"),l()(),P()}}function Fe(i,e){if(i&1){let n=C();s(0,"mat-form-field",38)(1,"input",39),u("change",function(t){h(n);let a=r(2).index,c=r(3);return g(c.onValueChange(t,a,"SLTN","TongtienN"))}),B("ngModelChange",function(t){h(n);let a=r(2).index,c=r(3);return V(c.Donhang.Giohangs[a].SLTN,t)||(c.Donhang.Giohangs[a].SLTN=t),g(t)}),l(),d(2,ke,7,0,"ng-container",40),l()}if(i&2){let n=r(2).index,o=r(3);_(),I("ngModel",o.Donhang.Giohangs[n].SLTN),f("ngModelOptions",j(3,X)),_(),f("ngIf",o.isShowCrease)}}function Ne(i,e){if(i&1&&(m(0),G(1,"number")),i&2){let n=r(2).$implicit,o=r().$implicit;x(" ",y(1,1,n[o]||0,"1.0-2")," ")}}function ve(i,e){if(i&1&&d(0,Fe,3,4,"mat-form-field",38)(1,Ne,2,4),i&2){let n=r(4);T(n.isEdit?0:1)}}function Le(i,e){if(i&1&&(m(0),G(1,"number")),i&2){let n=r().$implicit,o=r().$implicit;x(" ",y(1,1,n[o]||0,"1.0-2"),"\u0111 ")}}function Pe(i,e){if(i&1&&m(0),i&2){let n=r().$implicit,o=r().$implicit;x(" ",n[o]," ")}}function Ie(i,e){if(i&1&&(s(0,"td",32),d(1,pe,6,1,"div",33)(2,fe,2,1)(3,Se,2,1)(4,we,2,1)(5,Me,2,1)(6,ve,2,1)(7,Le,2,4)(8,Pe,1,1),l()),i&2){let n=r().$implicit;_(),T(n==="STT"?1:n==="Image"?2:n==="Ghichu"?3:n==="Soluong"?4:n==="SLTG"?5:n==="SLTN"?6:n==="Tongtien"||n==="TongtienG"||n==="TongtienN"?7:8)}}function Ve(i,e){i&1&&m(0," T\u1ED5ng C\u1ED9ng ")}function Be(i,e){if(i&1&&(m(0),G(1,"number")),i&2){let n=r(4);x(" ",y(1,1,n.TinhTongSub(n.Donhang.Giohangs,"Soluong"),"1.0-2")," ")}}function je(i,e){if(i&1&&(m(0),G(1,"number")),i&2){let n=r(4);x(" ",y(1,1,n.TinhTongSub(n.Donhang.Giohangs,"SLTN"),"1.0-2")," ")}}function Ae(i,e){if(i&1&&(m(0),G(1,"number")),i&2){let n=r(4);x(" ",y(1,1,n.TinhTongSub(n.Donhang.Giohangs,"SLTG"),"1.0-2")," ")}}function $e(i,e){}function Re(i,e){if(i&1&&(s(0,"td",43),d(1,Ve,1,0)(2,Be,2,4)(3,je,2,4)(4,Ae,2,4)(5,$e,0,0),l()),i&2){let n=r().$implicit;_(),T(n==="STT"?1:n==="Soluong"?2:n==="SLTN"?3:n==="SLTG"?4:5)}}function He(i,e){if(i&1&&(L(0,20),d(1,ge,2,1,"th",28)(2,Ie,9,1,"td",29)(3,Re,6,1,"td",30),P()),i&2){let n=e.$implicit;f("matColumnDef",n)}}function Oe(i,e){i&1&&b(0,"tr",44)}function Ue(i,e){i&1&&b(0,"tr",45)}function Xe(i,e){i&1&&b(0,"tr",46)}function ze(i,e){}function We(i,e){i&1&&(s(0,"a",27)(1,"span"),m(2,"C\u1EEDa H\xE0ng"),l()())}function qe(i,e){if(i&1){let n=C();s(0,"div",18)(1,"table",19),N(2,He,4,1,"ng-container",20,F),d(4,Oe,1,0,"tr",21)(5,Ue,1,0,"tr",22)(6,Xe,1,0,"tr",23),l()(),s(7,"div",24)(8,"div",25),u("click",function(){h(n);let t=r();return g(t.AddSanpham())}),s(9,"span"),m(10,"Th\xEAm S\u1EA3n Ph\u1EA9m"),l(),s(11,"span",26),m(12," add_circle "),l()(),d(13,ze,0,0)(14,We,3,0,"a",27),l()}if(i&2){let n=r();_(),f("dataSource",n.dataSource),_(),v(n.displayedColumns),_(2),f("matHeaderRowDef",n.displayedColumns),_(),f("matRowDefColumns",n.displayedColumns),_(),f("matFooterRowDef",n.displayedColumns),_(7),T(n.isAdmin?13:14)}}function Ke(i,e){i&1&&(s(0,"div",47)(1,"span"),m(2,"\u0110ang T\u1EA3i D\u1EEF Li\u1EC7u "),l(),b(3,"mat-spinner"),l())}function Qe(i,e){i&1&&(s(0,"p"),m(1,"Error loading About Component"),l())}function Je(i,e){if(i&1){let n=C();s(0,"div",60),u("click",function(t){let a=h(n).$implicit,c=r().$implicit;return r(3).Chonsanpham(c,a),g(t.stopPropagation())}),m(1),l()}if(i&2){let n=e.$implicit;_(),Y(" ",n.khoiluong," ",n.dvt," - ",n.gia," ")}}function Ye(i,e){if(i&1&&(s(0,"div",56),b(1,"img",57),s(2,"div"),m(3),l(),s(4,"div"),m(5),l(),s(6,"div",58),N(7,Je,2,3,"div",59,F),l()()),i&2){let n=e.$implicit;_(),f("src",n==null||n.Image==null||n.Image.Hinhchinh==null?null:n.Image.Hinhchinh.src,W),_(2),J(n.Title),_(2),J(n.MaSP),_(2),v(n.Giagoc)}}function Ze(i,e){if(i&1&&(s(0,"div",55),N(1,Ye,9,3,"div",56,F),l()),i&2){let n=r(2);_(),v(n.FilterSanphamsBansi)}}function nt(i,e){if(i&1){let n=C();s(0,"div",62),u("click",function(t){let a=h(n).$implicit;return r(3).ChonsanphamSi(a),g(t.stopPropagation())}),s(1,"div"),m(2),l(),s(3,"div",63),m(4),G(5,"number"),l()()}if(i&2){let n=e.$implicit;_(2),Y("(",n.MaSP,") - ",n.Title," - ",n.dvt,""),_(2),x("",y(5,4,n.giagoc,"1.0-2"),"\u0111")}}function et(i,e){if(i&1&&N(0,nt,6,7,"div",61,F),i&2){let n=r(2);v(n.FilterSanphamsBansi)}}function tt(i,e){if(i&1){let n=C();s(0,"div",48)(1,"div",49)(2,"mat-form-field",50)(3,"input",51),u("keyup",function(t){h(n);let a=r();return g(a.DoSearchSanpham(t))}),l()(),s(4,"span",52),m(5,"ESC"),l()(),s(6,"div",53)(7,"span",54),m(8),l(),d(9,Ze,3,0,"div",55)(10,et,2,0),l()()}if(i&2){let n=r();_(8),x("T\xECm Th\u1EA5y ",n.FilterSanphamsBansi.length||0," S\u1EA3n Ph\u1EA9m"),_(),T(n.Type=="banle"?9:10)}}var ae=class i{constructor(e,n,o){this.dialog=e;this._snackBar=n;this.cdr=o}Donhang={Giohangs:[]};isEdit=!1;isAdmin=!1;isShowCrease=!0;Type="banle";HideColumns=[];Sanphams=[];TongcongEmit=new R;GiohangsEmit=new R;UpdateValue=new R;FilterSanphamsBansi=[];dataSource;dialogRef;displayedColumns=["STT","Image","MaSP","Title","dvt","Soluong","Tongtien","SLTG","TongtienG","SLTN","TongtienN","Ghichu"];ColumnName={STT:"STT",Image:"H\xECnh \u1EA2nh",MaSP:"M\xE3 S\u1EA3n Ph\u1EA9m",Title:"T\xEAn S\u1EA3n Ph\u1EA9m",dvt:"\u0110\u01A1n V\u1ECB T\xEDnh",Soluong:"SL \u0110\u1EB7t",Tongtien:"T\u1ED5ng Ti\u1EC1n",SLTG:"SL Giao",TongtienG:"TT Giao",SLTN:"SL Nh\u1EADn",TongtienN:"TT Nh\u1EADn",Ghichu:"Ghi Ch\xFA"};ChonSanphamDialog;_SanphamService=$(U);_DonhangsService=$(te);_UsersService=$(ne);sort;ngOnInit(){return S(this,null,function*(){console.log(this.Sanphams),this.cdr.markForCheck(),this.displayedColumns=this.displayedColumns.filter(e=>!this.HideColumns.includes(e)),this.ColumnName=Object.fromEntries(Object.entries(this.ColumnName).filter(([e])=>!this.HideColumns.includes(e))),this.isAdmin||(this.displayedColumns=["STT","Image","MaSP","Title","Soluong","Tongtien"],this.ColumnName={STT:"STT",Image:"H\xECnh \u1EA2nh",MaSP:"M\xE3 S\u1EA3n Ph\u1EA9m",Title:"T\xEAn S\u1EA3n Ph\u1EA9m",Soluong:"S\u1ED1 L\u01B0\u1EE3ng",Tongtien:"T\u1ED5ng Ti\u1EC1n"}),this.dataSource=new E(this.Donhang.Giohangs),this.dataSource.sort=this.sort,this.sort&&(this.dataSource.sort=this.sort,console.log(this.dataSource.sort)),this.FilterSanphamsBansi=this.Sanphams.filter(e=>!this.Donhang.Giohangs.some(n=>n.MaSP===e.MaSP)).map(e=>({id:e.id,MaSP:e.MaSP,giagoc:Number(e.giagoc),dvt:e.dvt,Soluong:1,Title:e.Title,SLTT:Number(e.Soluong),Tongtien:e.Soluong*Number(e.giagoc),SLTG:0,TongtienG:0,SLTN:0,TongtienN:0,Ghichu:""})),console.log(this.Sanphams),console.log(this.FilterSanphamsBansi),console.log(this.Donhang.Giohangs)})}ngAfterViewInit(){}applyFilter(e){let n=e.target.value;this.dataSource.filter=n.trim().toLowerCase()}onValueChange(e,n,o,t){let a=e.target,c=Number(a.value);switch(c<=0?(this.Donhang.Giohangs[n][o]=1,this._snackBar.open("Gi\xE1 tr\u1ECB ph\u1EA3i l\u1EDBn h\u01A1n 0","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]})):this.Donhang.Giohangs[n][o]=c,o){case"Soluong":this.Donhang.Giohangs[n].SLTG=c,this.Donhang.Giohangs[n].Tongtien=this.Donhang.Giohangs[n].TongtienG=c*this.Donhang.Giohangs[n].giagoc;break;case"SLTG":this.Donhang.Giohangs[n].SLTN=c,this.Donhang.Giohangs[n].TongtienG=this.Donhang.Giohangs[n].TongtienN=c*this.Donhang.Giohangs[n].giagoc;break;default:this.Donhang.Giohangs[n][t]=c*this.Donhang.Giohangs[n].giagoc;break}this.GiohangsEmit.emit(this.Donhang.Giohangs)}ChangeSoluong(e,n,o,t){switch(t){case"Soluong":if(this.Donhang.Giohangs[e].Soluong=Number(this.Donhang.Giohangs[e][t])||0,this.Donhang.Giohangs[e][t]<=0&&n==="giam")this._snackBar.open("Gi\xE1 tr\u1ECB ph\u1EA3i l\u1EDBn h\u01A1n 0","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),this.Donhang.Giohangs[e][t]=1;else{let a=n==="giam"?-1:1;this.Donhang.Giohangs[e].Soluong+=a,this.Donhang.Giohangs[e].SLTG=this.Donhang.Giohangs[e].SLTN=this.Donhang.Giohangs[e].Soluong,this.Donhang.Giohangs[e].Tongtien=this.Donhang.Giohangs[e].TongtienG=this.Donhang.Giohangs[e].TongtienN=this.Donhang.Giohangs[e].Soluong*this.Donhang.Giohangs[e].giagoc}break;case"SLTG":if(this.Donhang.Giohangs[e].SLTG=Number(this.Donhang.Giohangs[e][t])||0,this.Donhang.Giohangs[e][t]<=0&&n==="giam")this._snackBar.open("Gi\xE1 tr\u1ECB ph\u1EA3i l\u1EDBn h\u01A1n 0","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),this.Donhang.Giohangs[e][t]=1;else{let a=n==="giam"?-1:1;this.Donhang.Giohangs[e].SLTG+=a,this.Donhang.Giohangs[e].SLTN=this.Donhang.Giohangs[e].SLTG,this.Donhang.Giohangs[e].TongtienG=this.Donhang.Giohangs[e].TongtienN=this.Donhang.Giohangs[e].SLTG*this.Donhang.Giohangs[e].giagoc}break;default:if(this.Donhang.Giohangs[e][t]=Number(this.Donhang.Giohangs[e][t])||0,this.Donhang.Giohangs[e][t]<=0&&n==="giam")this._snackBar.open("Gi\xE1 tr\u1ECB ph\u1EA3i l\u1EDBn h\u01A1n 0","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]}),this.Donhang.Giohangs[e][t]=1;else{let a=n==="giam"?-1:1;this.Donhang.Giohangs[e][t]+=a,this.Donhang.Giohangs[e][o]=this.Donhang.Giohangs[e][t]*this.Donhang.Giohangs[e].giagoc}}this.GiohangsEmit.emit(this.Donhang.Giohangs)}AddSanpham(){this.dialogRef=this.dialog.open(this.ChonSanphamDialog),this.dialogRef.afterClosed().subscribe(e=>{e=="true"&&this._snackBar.open("Th\xEAm Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}DoSearchSanpham(e){let n=e.target.value;this.FilterSanphamsBansi=this.Sanphams.filter(o=>o?.Title?.toLowerCase().includes(n.toLowerCase())||o?.MaSP?.toLowerCase().includes(n.toLowerCase())),console.log(this.FilterSanphamsBansi)}Chonsanpham(e,n){console.log(e);let o={};if(o=n,o.MaSP=="-1")this._snackBar.open("L\u1ED7i S\u1EA3n Ph\u1EA9m","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-error"]});else{o.Soluong=1,o.Title=e.Title,o.Image=e?.Image?.Hinhchinh?.src;let t=this.Donhang.Giohangs?.findIndex(a=>a.MaSP===e.MaSP);t!==-1?(this.Donhang.Giohangs[t].Soluong+=Number(o.Soluong),this.Donhang.Giohangs[t].SLTT+=Number(o.Soluong)*parseFloat(Number(o.khoiluong).toFixed(3)),this.Donhang.Giohangs[t].Tongtien=this.Donhang.Giohangs[t].SLTT*this.Donhang.Giohangs[t].giagoc):(o.SLTT=Number(o.khoiluong),o.Tongtien=o.SLTT*o.giagoc,o.SLTG=0,o.TongtienG=0,o.SLTN=0,o.TongtienN=0,this.Donhang.Giohangs.push(o)),console.log(o),console.log(this.Donhang.Giohangs),this.dataSource=new E(this.Donhang.Giohangs),this.GiohangsEmit.emit(this.Donhang.Giohangs)}}ChonsanphamSi(e){console.log(e);let n={};n=e,n.Soluong=1,n.Title=e.Title,n.SLTT=1,n.Tongtien=Number(n.Soluong)*Number(n.giagoc),n.SLTG=1,n.TongtienG=Number(n.Soluong)*Number(n.giagoc),n.SLTN=1,n.TongtienN=Number(n.Soluong)*Number(n.giagoc),this.Donhang.Giohangs.push(n),console.log(n),console.log(this.Donhang.Giohangs),this.dataSource=new E(this.Donhang.Giohangs),this.GiohangsEmit.emit(this.Donhang.Giohangs),this.FilterSanphamsBansi=this.Sanphams.filter(o=>!this.Donhang.Giohangs.some(t=>t.MaSP===o.MaSP))}Xoasanpham(e){console.log(e),this.Donhang.Giohangs=this.Donhang.Giohangs.filter(n=>n.MaSP!=e.MaSP),this.dataSource=new E(this.Donhang.Giohangs),this.GiohangsEmit.emit(this.Donhang.Giohangs)}Xoagiohang(){this.Donhang.Giohangs=[],this.dataSource=new E(this.Donhang.Giohangs),this.GiohangsEmit.emit(this.Donhang.Giohangs)}TinhTong(e,n){let o=e?.reduce((k,D)=>k+(D.Tongtien||0),0)||0,t=this.Donhang?.Vanchuyen?.Phivanchuyen||0,a=this.Donhang?.Khuyenmai?.value||0,c=this.Donhang?.Thue||0,M=o+t+a+c;return this.TongcongEmit.emit({Tongcong:M,Tong:o}),e?.reduce((k,D)=>k+D[n],0)}TinhTongSub(e,n){return e?.reduce((o,t)=>o+(t[n]||0),0)||0}LoadDrive(){return S(this,null,function*(){let e={IdSheet:"15npo25qyH5FmfcEjl1uyqqyFMS_vdFnmxM_kt0KYmZk",SheetName:"Giohangimport",ApiKey:"AIzaSyD33kgZJKdFpv1JrKHacjCQccL_O0a2Eao"},n=yield this._DonhangsService.getDrive(e);console.log(n);let o=Yn(n.values);console.log(o),o.forEach(t=>{let a=this.Sanphams.find(c=>c.MaSP===t.MaSP);a&&(t.id=a.id,t.Title=a.Title,t.MaSP=t.MaSP,t.dvt=t.dvt,t.giagoc=Number(t.giagoc),t.Soluong=Number(t.Soluong),t.Tongtien=Number(t.Tongtien),t.SLTG=Number(t.SLTG),t.TongtienG=Number(t.TongtienG),t.SLTN=Number(t.SLTN),t.TongtienN=Number(t.TongtienN),t.Ghichu=t.Ghichu||"")}),this.Donhang.Giohangs=o,this.dataSource=new E(this.Donhang.Giohangs),this.GiohangsEmit.emit(this.Donhang.Giohangs),console.log(this.Donhang.Giohangs),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})})}readExcelFile(e){let n=e.target.files[0],o=new FileReader;o.onload=t=>{let a=new Uint8Array(t.target.result),c=vn(a,{type:"array"}),M=c.SheetNames[0],k=c.Sheets[M],D=on.sheet_to_json(k,{raw:!0});console.log(D),D.forEach(p=>{let z=this.Sanphams.find(se=>se.MaSP===p.MaSP);z&&(p.id=z.id,p.Title=z.Title,p.MaSP=p.MaSP,p.dvt=p.dvt,p.giagoc=Number(p.giagoc),p.Soluong=Number(p.Soluong),p.Tongtien=Number(p.Tongtien),p.SLTG=Number(p.SLTG),p.TongtienG=Number(p.TongtienG),p.SLTN=Number(p.SLTN),p.TongtienN=Number(p.TongtienN),p.Ghichu=p.Ghichu||"")}),console.log(D),this.Donhang.Giohangs=D,this.dataSource=new E(this.Donhang.Giohangs),this.GiohangsEmit.emit(this.Donhang.Giohangs),this._snackBar.open("C\u1EADp Nh\u1EADt Th\xE0nh C\xF4ng","",{duration:1e3,horizontalPosition:"end",verticalPosition:"top",panelClass:["snackbar-success"]})},o.readAsArrayBuffer(n)}writeExcelFile(){let e=this.Donhang.Giohangs.map(a=>({MaSP:a.MaSP,dvt:a.dvt,giagoc:Number(a.giagoc),Soluong:Number(a.Soluong),Tongtien:Number(a.Tongtien),SLTG:Number(a.SLTG),TongtienG:Number(a.TongtienG),SLTN:Number(a.SLTN),TongtienN:Number(a.TongtienN),Ghichu:a.Ghichu||""})),o={Sheets:{Sheet1:on.json_to_sheet(e)},SheetNames:["Sheet1"]},t=Ln(o,{bookType:"xlsx",type:"array"});this.saveAsExcelFile(t,"giohang_"+(0,re.default)().format("DD_MM_YYYY"))}saveAsExcelFile(e,n){let o=new Blob([e],{type:"application/octet-stream"}),t=window.URL.createObjectURL(o),a=document.createElement("a");a.href=t,a.download=`${n}.xlsx`,a.click(),window.URL.revokeObjectURL(t),a.remove()}static \u0275fac=function(n){return new(n||i)(H(Mn),H(Zn),H(pn))};static \u0275cmp=ln({type:i,selectors:[["app-giohangcommon"]],viewQuery:function(n,o){if(n&1&&(q(_e,5),q(O,5)),n&2){let t;K(t=Q())&&(o.ChonSanphamDialog=t.first),K(t=Q())&&(o.sort=t.first)}},inputs:{Donhang:"Donhang",isEdit:"isEdit",isAdmin:"isAdmin",isShowCrease:"isShowCrease",Type:"Type",HideColumns:"HideColumns",Sanphams:"Sanphams"},outputs:{TongcongEmit:"TongcongEmit",GiohangsEmit:"GiohangsEmit",UpdateValue:"UpdateValue"},decls:36,vars:0,consts:[["input",""],["uploadfile",""],["ChonSanphamDialog",""],[500,null],[1,"bg-white","rounded-lg","border","border-default-200","col-span-2"],[1,"p-4","border-b","border-default-200","flex","flex-row","space-x-2","justify-between","items-center"],[1,"!text-lg","!font-semibold","text-default-800"],[1,"relative"],["type","text","placeholder","T\xECm Ki\u1EBFm...",1,"block","pl-10","pr-4","py-2","text-gray-700","bg-white","border","border-gray-300","rounded-lg","focus:border-blue-400","focus:ring-blue-400","focus:outline-none","focus:ring","focus:ring-opacity-40",3,"keyup"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none"],[1,"material-symbols-outlined","text-gray-500"],[1,"flex","flex-row","space-x-1","cursor-pointer"],[1,"flex","flex-col","items-center","p-2","hover:bg-gray-200","rounded-lg",3,"click"],["matTooltip","Upload File",1,"material-symbols-outlined","text-xl"],[1,"text-xs"],["type","file",1,"hidden",3,"change"],["color","primary","mat-icon-button","",3,"click"],["color","warn","mat-icon-button","",3,"click"],[1,"w-full","overflow-auto"],["mat-table","","matSort","",1,"w-full","cursor-pointer",3,"dataSource"],[3,"matColumnDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-footer-row","",4,"matFooterRowDef"],[1,"flex","flex-row","space-x-2","justify-between","items-center","p-4"],[1,"cursor-pointer","flex-row","inline-flex","space-x-2","bg-slate-200","text-blue-500","hover:bg-blue-500","hover:text-white","justify-center","items-center","m-2","px-4","py-2","border","rounded-lg",3,"click"],[1,"material-symbols-outlined"],["href","/danh-muc",1,"cursor-pointer","flex-row","inline-flex","space-x-2","bg-slate-200","text-blue-500","hover:bg-blue-500","hover:text-white","justify-center","items-center","m-2","px-4","py-2","border","rounded-lg"],["class","whitespace-nowrap !bg-slate-300","mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","whitespace-nowrap text-center","mat-cell","",4,"matCellDef"],["class","font-bold","mat-footer-cell","",4,"matFooterCellDef"],["mat-header-cell","","mat-sort-header","",1,"whitespace-nowrap","!bg-slate-300"],["mat-cell","",1,"whitespace-nowrap","text-center"],[1,"flex","flex-row","items-center","px-2"],["loading","lazy",1,"border","rounded-lg","h-20","w-20",3,"src"],["loading","lazy","src","assets/images/noimage.png",1,"border","h-20","w-20","rounded-lg"],["appearance","outline","appearance","outline","subscriptSizing","dynamic"],["matInput","",3,"ngModelChange","ngModel","ngModelOptions","placeholder"],["appearance","outline","subscriptSizing","dynamic",1,"!w-24","text-sm"],["matInput","","type","number",3,"change","ngModelChange","ngModel","ngModelOptions"],[4,"ngIf"],["color","primary","matPrefix","","mat-icon-button","",1,"text-md",3,"click"],["color","primary","matSuffix","","mat-icon-button","",1,"text-md",3,"click"],["mat-footer-cell","",1,"font-bold"],["mat-header-row",""],["mat-row",""],["mat-footer-row",""],[1,"flex","flex-row","space-x-2","items-center","justify-center","p-4"],[1,"lg:w-[70vw]","w-[90vw]","h-[90vh]","p-4","flex","flex-col","space-y-3"],[1,"px-4","flex","flex-row","items-center","space-x-2","justify-between"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","T\xECm S\u1EA3n Ph\u1EA9m",3,"keyup"],["mat-dialog-close","false",1,"cursor-pointer","border","p-2","rounded-lg","hover:border-2"],[1,"overflow-auto","flex","flex-col","w-full","space-y-2","lg:p-4"],[1,"text-red-500"],[1,"grid","lg:grid-cols-4","grid-cols-2","gap-4"],[1,"flex","flex-col","space-y-2","rounded-lg","border","p-2"],[1,"m-auto","h-20","w-20",3,"src"],[1,"cursor-pointer","flex","flex-row","space-x-2"],[1,"p-2","rounded-lg","bg-slate-100","hover:bg-slate-300","font-bold"],[1,"p-2","rounded-lg","bg-slate-100","hover:bg-slate-300","font-bold",3,"click"],[1,"cursor-pointer","flex","flex-row","justify-between","space-x-2","items-center","border","p-3","rounded-lg","hover:bg-slate-300"],[1,"cursor-pointer","flex","flex-row","justify-between","space-x-2","items-center","border","p-3","rounded-lg","hover:bg-slate-300",3,"click"],[1,"font-bold"]],template:function(n,o){if(n&1){let t=C();s(0,"div",4)(1,"div",5)(2,"span",6),m(3,"Gi\u1ECF H\xE0ng"),l(),s(4,"div",7)(5,"input",8,0),u("keyup",function(c){return h(t),g(o.applyFilter(c))}),l(),s(7,"div",9)(8,"span",10),m(9,"search"),l()()(),s(10,"div",11)(11,"div",12),u("click",function(){return h(t),g(o.writeExcelFile())}),s(12,"span",13),m(13,"file_download"),l(),s(14,"span",14),m(15,"Download"),l()(),s(16,"div",12),u("click",function(){h(t);let c=hn(22);return g(c.click())}),s(17,"span",13),m(18,"file_upload"),l(),s(19,"span",14),m(20,"Upload"),l(),s(21,"input",15,1),u("change",function(c){return h(t),g(o.readExcelFile(c))}),l()(),s(23,"button",16),u("click",function(){return h(t),g(o.LoadDrive())}),s(24,"mat-icon"),m(25,"cloud_download"),l()(),s(26,"button",17),u("click",function(){return h(t),g(o.Xoagiohang())}),s(27,"mat-icon"),m(28,"delete"),l()()()(),d(29,qe,15,5)(30,Ke,4,0)(31,Qe,2,0),mn(32,29,he,30,null,31,3,null,cn),_n(),l(),d(34,tt,11,2,"ng-template",null,2,gn)}},dependencies:[Dn,nn,bn,en,Jn,Vn,Pn,En,ee,an,Nn,tn,Tn,Fn,kn,dn,Z,ie,oe],encapsulation:2})};export{ae as a};
