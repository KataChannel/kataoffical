import{a as d}from"./chunk-UJFQ3LGV.js";import{a as o}from"./chunk-KQPDVZYA.js";import{p as y}from"./chunk-XPJYUAXQ.js";import{u as l}from"./chunk-UAZLFQKL.js";import{Oa as u,fa as g,ka as i,ub as c}from"./chunk-QJD4TKMG.js";import{i as s}from"./chunk-66YHNWRR.js";var p=class h{constructor(r,e,t){this._StorageService=r;this.platformId=e;this.router=t;this.isBrowser=l(this.platformId)}_authenticated=!1;APIURL=o.APIURL;isBrowser;ListDonhang=c([]);Donhang=c({});getAllDonhang(){return s(this,null,function*(){try{let r={method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")}},e=yield fetch(`${o.APIURL}/donhang`,r);e.ok;let t=yield e.json();return this.ListDonhang.set(t),t}catch(r){return console.error(r)}})}createDonhang(r){return s(this,null,function*(){try{let e={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+this._StorageService.getItem("token")},body:JSON.stringify(r)},t=yield fetch(`${o.APIURL}/donhang`,e);return t.ok,yield t.json()}catch(e){return console.error(e)}})}SearchDonhang(r){return s(this,null,function*(){try{let e={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},t=yield fetch(`${o.APIURL}/donhang/search`,e);if(!t.ok)if(t.status===401){let a=JSON.stringify({code:t.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else if(t.status===403){let a=JSON.stringify({code:t.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else if(t.status===500){let a=JSON.stringify({code:t.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else{let a=JSON.stringify({code:t.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}let n=yield t.json();return this.ListDonhang.set(n.items),n}catch(e){return console.error(e)}})}getDonhangByid(r){return s(this,null,function*(){try{let e={method:"GET",headers:{"Content-Type":"application/json"}},t=yield fetch(`${o.APIURL}/donhang/findid/${r}`,e);if(!t.ok)if(t.status===401){let a=JSON.stringify({code:t.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else if(t.status===403){let a=JSON.stringify({code:t.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else if(t.status===500){let a=JSON.stringify({code:t.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else{let a=JSON.stringify({code:t.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}let n=yield t.json();return this.Donhang.set(n),n}catch(e){return console.error(e)}})}getDonhangByidUser(r){return s(this,null,function*(){try{let e={method:"GET",headers:{"Content-Type":"application/json"}},t=yield fetch(`${o.APIURL}/donhang/findbyuser/${r}`,e);if(!t.ok)if(t.status===401){let a=JSON.stringify({code:t.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else if(t.status===403){let a=JSON.stringify({code:t.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else if(t.status===500){let a=JSON.stringify({code:t.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}else{let a=JSON.stringify({code:t.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:a}})}let n=yield t.json();return this.Donhang.set(n),n}catch(e){return console.error(e)}})}updateOneDonhang(r){return s(this,null,function*(){try{let e={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},t=yield fetch(`${o.APIURL}/donhang/${r.id}`,e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);let n=yield t.json();return t.ok,this.getAllDonhang(),this.Donhang.set(n),n}catch(e){return console.error(e)}})}DeleteDonhang(r){return s(this,null,function*(){try{let e={method:"DELETE",headers:{"Content-Type":"application/json"}},t=yield fetch(`${o.APIURL}/donhang/${r.id}`,e);if(!t.ok)if(t.status===401){let n=JSON.stringify({code:t.status,title:"Vui l\xF2ng \u0111\u0103ng nh\u1EADp l\u1EA1i"});this.router.navigate(["/errorserver"],{queryParams:{data:n}})}else if(t.status===403){let n=JSON.stringify({code:t.status,title:"B\u1EA1n kh\xF4ng c\xF3 quy\u1EC1n truy c\u1EADp"});this.router.navigate(["/errorserver"],{queryParams:{data:n}})}else if(t.status===500){let n=JSON.stringify({code:t.status,title:"L\u1ED7i m\xE1y ch\u1EE7, vui l\xF2ng th\u1EED l\u1EA1i sau"});this.router.navigate(["/errorserver"],{queryParams:{data:n}})}else{let n=JSON.stringify({code:t.status,title:"L\u1ED7i kh\xF4ng x\xE1c \u0111\u1ECBnh"});this.router.navigate(["/errorserver"],{queryParams:{data:n}})}return this.getAllDonhang(),yield t.json()}catch(e){return console.error(e)}})}addToCart(r){return s(this,null,function*(){let e=this._StorageService.getItem("Donhang")||{Giohangs:[],Khachhang:{Hoten:"",SDT:"",Email:""},Diachis:[],Vanchuyen:{Diachi:""},Thanhtoan:{Hinhthuc:"COD"},Khuyenmai:{}};e.Giohangs=e?.Giohangs?.length>0?e.Giohangs:[],console.log(e),console.log(r);let t=e?.Giohangs?.findIndex(n=>n.MaSP===r.MaSP);t!==-1?(e.Giohangs[t].Soluong+=Number(r.Soluong),e.Giohangs[t].SLTT+=Number(r.Soluong)*parseFloat(Number(r.khoiluong).toFixed(3)),e.Giohangs[t].Tongtien=e.Giohangs[t].SLTT*e.Giohangs[t].GiaCoSo):(r.SLTT=parseFloat(Number(r.khoiluong).toFixed(3)),r.Tongtien=r.SLTT*r.GiaCoSo,r.SLTG=0,r.TongtienG=0,r.SLTN=0,r.TongtienN=0,e.Giohangs.push(r)),this._StorageService.setItem("Donhang",e),this.Donhang.set(e)})}DonhangInit(){let r=this._StorageService.getItem("Donhang")||{Giohangs:[],Khachhang:{Hoten:"",SDT:"",Email:""},Diachis:[],Vanchuyen:{Diachi:""},Thanhtoan:{Hinhthuc:"COD"},Khuyenmai:{}};this.Donhang.set(r)}UpdateDonhang(r){return s(this,null,function*(){this._StorageService.setItem("Donhang",r),this.Donhang.set(r)})}ClearDonhang(){return s(this,null,function*(){this._StorageService.removeItem("Donhang"),this.Donhang.set({})})}getPhiship(r){return s(this,null,function*(){let e="119 L\xFD Ch\xEDnh Th\u1EAFng, Ph\u01B0\u1EDDng V\xF5 Th\u1ECB S\xE1u, Qu\u1EADn 3, TPHCM";try{let t={method:"GET",headers:{"Content-Type":"application/json"}},n=yield fetch(`https://api.distancematrix.ai/maps/api/distancematrix/json?origins=${e}&destinations=${r}&key=Dph8tdiphuew12KNWnm1gkfBRQJo2x89sBDfgEn9GAY7LEzhhiyxrbodoGhBw3BF`,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return(yield n.json()).rows[0].elements[0]}catch(t){return console.error(t)}})}getDrive(r){return s(this,null,function*(){try{let e={method:"GET",headers:{"Content-Type":"application/json"}};return yield(yield fetch(`https://sheets.googleapis.com/v4/spreadsheets/${r.IdSheet}/values/${r.SheetName}?key=${r.ApiKey}`,e)).json()}catch(e){return console.error(e)}})}static \u0275fac=function(e){return new(e||h)(i(d),i(u),i(y))};static \u0275prov=g({token:h,factory:h.\u0275fac,providedIn:"root"})};export{p as a};
