generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client/vttech"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_VTTECH")
}

model ProcessedPost {
      id             Int      @id @default(autoincrement()) // Hoặc dùng CUID/UUID
      source_id      Int      @unique // ID gốc từ API, đảm bảo không trùng
      title          String?  // Cho phép null nếu có thể
      content_length Int
      user_ref       Int?
      extracted_at   DateTime @default(now())
      processed_at   DateTime @updatedAt // Tự động cập nhật khi bản ghi thay đổi
      @@map("processed_posts") // Đặt tên bảng trong DB (tùy chọn)
  }

  model Customer {
    id              Int       @id @default(autoincrement())
    source_id       String?   @unique // ID from external source
    name            String?
    code            String?   @unique
    codeOld         String?
    docCode         String?
    email           String?
    phone           String?
    phone2          String?
    birthday        DateTime?
    gender          String?
    address         String?
    commune         String?
    district        String?
    city            String?  
    // Citizen Identity
    citizenIdentity String?
    identityGrantDate DateTime?
    identityIssuedBy  String?
    customerSource  String?
    customerGroup   String?
    branchId        Int?
    // Dates
    firstPaidDate      DateTime?
    firstCheckinDate   DateTime?
    firstTreatmentDate DateTime?
    lastTreatmentDate  DateTime?
    lastCheckinDate    DateTime?
    // Staff references
    ccStaffId       Int?
    caringStaffCode String?
    marStaffId      Int?
    marStaffCode    String?
    staffId         Int?
    staffCode       String?
    gclid           String?
    state           Int?
    createdDate     DateTime @default(now())
    createdBy       String?
    modifiedDate    DateTime @updatedAt
    modifiedBy      String?
    extractedAt     DateTime @default(now())
    @@map("customers")
  }

  model Revenue {
    id              Int       @id @default(autoincrement())
    source_id       String    @unique
    code            String?
    TabCode         String?
    TabCardCode     String?
    TabMedicineCode String?
    branchId        Int?
    custCode        String?
    custName        String?
    custPhone       String?
    custAddress     String?
    custBirthday    DateTime?
    depositId       Int?
    paidAmount      Float?
    discountAmount  Float     @default(0)
    depositAmountUsing Float   @default(0)
    totalPaid       Float     @default(0)
    debtAmount      Float     @default(0)
    methodName      String?
    content         String?
    serviceId       Int       @default(0)
    isProduct       Int       @default(0)
    quantity        Float     @default(0)
    priceRoot       Float     @default(0)
    priceUnit       Float     @default(0)
    price           Float     @default(0)
    amount          Float     @default(0)
    timeToTreatment Int       @default(0)
    percentOfService Float     @default(0)
    treatIndex      Int       @default(0)
    type            String?
    typeName        String?
    consultId1      Int       @default(0)
    consultId2      Int       @default(0)
    consultId3      Int       @default(0)
    consultId4      Int       @default(0)
    techId          Int       @default(0)
    tele1           Int       @default(0)
    tele2           Int       @default(0)
    createdDate     DateTime?
    createdBy       String?
    modifiedDate    DateTime?
    state           Int?
    extractedAt     DateTime  @default(now())
    @@map("revenues")
  }


  model Treatment {
    id              Int       @id @default(autoincrement())
    source_id       String    @unique
    name            String?
    code            String?
    codeOld         String?
    docCode         String?
    email           String?
    phone           String?
    phone2          String?
    birthday        DateTime?
    gender          String?
    address         String?
    commune         String?
    district        String?
    city            String?
    
    // Service details
    serviceId       Int       @default(0)
    serviceTypeId   Int       @default(0)
    serviceCode     String?
    tabId           Int       @default(0)
    tabCode         String?
    comboId         Int       @default(0)
    comboCode       String?
    serviceName     String?
    timeIndex       String?
    timeToTreatment Int       @default(0)
    teethChoosing   String?
    priceUnit       Float     @default(0)
    quantity        Float     @default(0)
    discount        Float     @default(0)
    priceRoot       Float     @default(0)
    priceDiscounted Float     @default(0)
    
    // Participation information
    doctor          Int       @default(0)
    doctor2         Int       @default(0)
    doctor3         Int       @default(0)
    doctor4         Int       @default(0)
    assistant       Int       @default(0)
    assistant2      Int       @default(0)
    assistant3      Int       @default(0)
    assistant4      Int       @default(0)
    technician      Int       @default(0)
    technician2     Int       @default(0)
    
    // Treatment details
    timeTreatIndex  Int       @default(0)
    percent         Float     @default(0)
    percentNew      Float     @default(0)
    percentStage    Float     @default(0)
    percentNewStage Float     @default(0)
    note            String?
    content         String?
    contentNext     String?
    symptoms        String?
    treatDateNext   DateTime?
    branchId        Int       @default(0)
    
    // Metadata
    createdDate     DateTime?
    createdBy       String?
    modifiedDate    DateTime?
    modifiedBy      Int?      @default(0)
    state           Int       @default(0)
    extractedAt     DateTime  @default(now())
    @@unique([code, serviceCode, createdDate])
    @@map("treatment")
  }

  model Appointment {
    id              Int       @id @default(autoincrement())
    source_id       String    @unique
    custId          String?
    custCode        String?
    custName        String?
    dateFrom        DateTime?
    statusId        Int       @default(0)
    statusName      String?
    statusTime      DateTime?
    isCancel        Int       @default(0)
    branchId        Int       @default(0)
    branchName      String?
    content         String?
    note            String?
    noteForBranch   String?
    consultId       Int       @default(0)
    doctorId        Int       @default(0)
    doctorId2       Int       @default(0)
    assistantId     Int       @default(0)
    roomId          Int       @default(0)
    room            String?
    remindContent   String?
    reasonCancelId  Int       @default(0)
    typeId          Int       @default(0)
    typeDetailId    Int       @default(0)
    serviceCareId   String?
    serviceCare     String?
    state           Int       @default(0)
    createdDate     DateTime?
    createdBy       String?
    modifiedDate    DateTime?
    modifiedBy      String?
    extractedAt     DateTime  @default(now())

    @@map("appointments")
  }
  
  model Dichvu {
    id               Int      @id @default(autoincrement())
    source_id        String?    @unique
    name             String?
    code             String?
    codeOld          String?
    docCode          String?
    email            String?
    phone            String?
    phone2           String?
    birthday         DateTime?
    gender           String?
    address          String?
    commune          String?
    district         String?
    city             String?
    // Service Fields
    serviceId        Int
    serviceTypeId    Int
    serviceCode      String
    tabId            Int
    tabCode          String
    comboId          Int
    comboCode        String?
    serviceName      String
    timeIndex        String?
    timeToTreatment  Int
    teethChoosing    String?
    priceUnit        Float
    quantity         Float
    discount         Float
    priceRoot        Float
    priceDiscounted  Float
    // Participate Fields
    doctor           Int
    doctor2          Int
    doctor3          Int
    doctor4          Int
    assistant        Int
    assistant2       Int
    assistant3       Int
    assistant4       Int
    technician       Int
    technician2      Int
    // Additional Fields
    timeTreatIndex   Int
    percent          Float
    percentNew       Float
    percentStage     Float
    percentNewStage  Float
    note             String?
    content          String?
    contentNext      String?
    symptoms         String?
    treatDateNext    DateTime?
    branchId         Int
    createdDate      DateTime
    createdBy        Int
    modifiedDate     DateTime
    modifiedBy       Int
    state            Int
    extractedAt      DateTime @default(now())
    @@map("dichvu")
  }
